(function(B){"use strict";function N(a){return function(){var b=arguments[0],d;d="["+(a?a+":":"")+b+"] http://errors.angularjs.org/1.5.9/"+(a?a+"/":"")+b;for(b=1;b<arguments.length;b++){d=d+(1==b?"?":"&")+"p"+(b-1)+"=";var c=encodeURIComponent,e;e=arguments[b];e="function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof e?"undefined":"string"!=typeof e?JSON.stringify(e):e;d+=c(e)}return Error(d)}}function ra(a){if(null==a||Xa(a))return!1;if(K(a)||H(a)||E&&a instanceof E)return!0;var b="length"in Object(a)&&a.length;return Z(b)&&(0<=b&&(b-1 in a||a instanceof Array)||"function"===typeof a.item)}function q(a,b,d){var c,e;if(a)if(F(a))for(c in a)"prototype"===c||"length"===c||"name"===c||a.hasOwnProperty&&!a.hasOwnProperty(c)||b.call(d,a[c],c,a);else if(K(a)||ra(a)){var f="object"!==typeof a;c=0;for(e=a.length;c<e;c++)(f||c in a)&&b.call(d,a[c],c,a)}else if(a.forEach&&a.forEach!==q)a.forEach(b,d,a);else if(zc(a))for(c in a)b.call(d,a[c],c,a);else if("function"===typeof a.hasOwnProperty)for(c in a)a.hasOwnProperty(c)&&b.call(d,a[c],c,a);else for(c in a)sa.call(a,c)&&b.call(d,a[c],c,a);return a}function Ac(a,b,d){for(var c=Object.keys(a).sort(),e=0;e<c.length;e++)b.call(d,a[c[e]],c[e]);return c}function Bc(a){return function(b,d){a(d,b)}}function me(){return++sb}function Sb(a,b,d){for(var c=a.$$hashKey,e=0,f=b.length;e<f;++e){var g=b[e];if(I(g)||F(g))for(var h=Object.keys(g),k=0,l=h.length;k<l;k++){var m=h[k],n=g[m];d&&I(n)?ba(n)?a[m]=new Date(n.valueOf()):Ya(n)?a[m]=new RegExp(n):n.nodeName?a[m]=n.cloneNode(!0):Tb(n)?a[m]=n.clone():(I(a[m])||(a[m]=K(n)?[]:{}),Sb(a[m],[n],!0)):a[m]=n}}c?a.$$hashKey=c:delete a.$$hashKey;return a}function R(a){return Sb(a,ta.call(arguments,1),!1)}function ne(a){return Sb(a,ta.call(arguments,1),!0)}function aa(a){return parseInt(a,10)}function Ub(a,b){return R(Object.create(a),b)}function C(){}function Za(a){return a}function ma(a){return function(){return a}}function Cc(a){return F(a.toString)&&a.toString!==na}function z(a){return"undefined"===typeof a}function u(a){return"undefined"!==typeof a}function I(a){return null!==a&&"object"===typeof a}function zc(a){return null!==a&&"object"===typeof a&&!Dc(a)}function H(a){return"string"===typeof a}function Z(a){return"number"===typeof a}function ba(a){return"[object Date]"===na.call(a)}function F(a){return"function"===typeof a}function Ya(a){return"[object RegExp]"===na.call(a)}function Xa(a){return a&&a.window===a}function $a(a){return a&&a.$evalAsync&&a.$watch}function Ia(a){return"boolean"===typeof a}function oe(a){return a&&Z(a.length)&&pe.test(na.call(a))}function Tb(a){return!(!a||!(a.nodeName||a.prop&&a.attr&&a.find))}function qe(a){var b={};a=a.split(",");var d;for(d=0;d<a.length;d++)b[a[d]]=!0;return b}function ua(a){return P(a.nodeName||a[0]&&a[0].nodeName)}function ab(a,b){var d=a.indexOf(b);0<=d&&a.splice(d,1);return d}function pa(a,b){function d(a,b){var d=b.$$hashKey,e;if(K(a)){e=0;for(var f=a.length;e<f;e++)b.push(c(a[e]))}else if(zc(a))for(e in a)b[e]=c(a[e]);else if(a&&"function"===typeof a.hasOwnProperty)for(e in a)a.hasOwnProperty(e)&&(b[e]=c(a[e]));else for(e in a)sa.call(a,e)&&(b[e]=c(a[e]));d?b.$$hashKey=d:delete b.$$hashKey;return b}function c(a){if(!I(a))return a;var b=f.indexOf(a);if(-1!==b)return g[b];if(Xa(a)||$a(a))throw va("cpws");var b=!1,c=e(a);void 0===c&&(c=K(a)?[]:Object.create(Dc(a)),b=!0);f.push(a);g.push(c);return b?d(a,c):c}function e(a){switch(na.call(a)){case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return new a.constructor(c(a.buffer),a.byteOffset,a.length);case"[object ArrayBuffer]":if(!a.slice){var b=new ArrayBuffer(a.byteLength);new Uint8Array(b).set(new Uint8Array(a));return b}return a.slice(0);case"[object Boolean]":case"[object Number]":case"[object String]":case"[object Date]":return new a.constructor(a.valueOf());case"[object RegExp]":return b=new RegExp(a.source,a.toString().match(/[^\/]*$/)[0]),b.lastIndex=a.lastIndex,b;case"[object Blob]":return new a.constructor([a],{type:a.type})}if(F(a.cloneNode))return a.cloneNode(!0)}var f=[],g=[];if(b){if(oe(b)||"[object ArrayBuffer]"===na.call(b))throw va("cpta");if(a===b)throw va("cpi");K(b)?b.length=0:q(b,function(a,d){"$$hashKey"!==d&&delete b[d]});f.push(a);g.push(b);return d(a,b)}return c(a)}function oa(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var d=typeof a,c;if(d===typeof b&&"object"===d)if(K(a)){if(!K(b))return!1;if((d=a.length)===b.length){for(c=0;c<d;c++)if(!oa(a[c],b[c]))return!1;return!0}}else{if(ba(a))return ba(b)?oa(a.getTime(),b.getTime()):!1;if(Ya(a))return Ya(b)?a.toString()===b.toString():!1;if($a(a)||$a(b)||Xa(a)||Xa(b)||K(b)||ba(b)||Ya(b))return!1;d=S();for(c in a)if("$"!==c.charAt(0)&&!F(a[c])){if(!oa(a[c],b[c]))return!1;d[c]=!0}for(c in b)if(!(c in d)&&"$"!==c.charAt(0)&&u(b[c])&&!F(b[c]))return!1;return!0}return!1}function bb(a,b,d){return a.concat(ta.call(b,d))}function cb(a,b){var d=2<arguments.length?ta.call(arguments,2):[];return!F(b)||b instanceof RegExp?b:d.length?function(){return arguments.length?b.apply(a,bb(d,arguments,0)):b.apply(a,d)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}}function re(a,b){var d=b;"string"===typeof a&&"$"===a.charAt(0)&&"$"===a.charAt(1)?d=void 0:Xa(b)?d="$WINDOW":b&&B.document===b?d="$DOCUMENT":$a(b)&&(d="$SCOPE");return d}function db(a,b){if(!z(a))return Z(b)||(b=b?2:null),JSON.stringify(a,re,b)}function Ec(a){return H(a)?JSON.parse(a):a}function Fc(a,b){a=a.replace(se,"");var d=Date.parse("Jan 01, 1970 00:00:00 "+a)/6e4;return X(d)?b:d}function Vb(a,b,d){d=d?-1:1;var c=a.getTimezoneOffset();b=Fc(b,c);d*=b-c;a=new Date(a.getTime());a.setMinutes(a.getMinutes()+d);return a}function wa(a){a=E(a).clone();try{a.empty()}catch(b){}var d=E("<div>").append(a).html();try{return a[0].nodeType===Ma?P(d):d.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+P(b)})}catch(c){return P(d)}}function Gc(a){try{return decodeURIComponent(a)}catch(b){}}function Hc(a){var b={};q((a||"").split("&"),function(a){var c,e,f;a&&(e=a=a.replace(/\+/g,"%20"),c=a.indexOf("="),-1!==c&&(e=a.substring(0,c),f=a.substring(c+1)),e=Gc(e),u(e)&&(f=u(f)?Gc(f):!0,sa.call(b,e)?K(b[e])?b[e].push(f):b[e]=[b[e],f]:b[e]=f))});return b}function Wb(a){var b=[];q(a,function(a,c){K(a)?q(a,function(a){b.push(ca(c,!0)+(!0===a?"":"="+ca(a,!0)))}):b.push(ca(c,!0)+(!0===a?"":"="+ca(a,!0)))});return b.length?b.join("&"):""}function tb(a){return ca(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function ca(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,b?"%20":"+")}function te(a,b){var d,c,e=Na.length;for(c=0;c<e;++c)if(d=Na[c]+b,H(d=a.getAttribute(d)))return d;return null}function ue(a,b){var d,c,e={};q(Na,function(b){b+="app";!d&&a.hasAttribute&&a.hasAttribute(b)&&(d=a,c=a.getAttribute(b))});q(Na,function(b){b+="app";var e;!d&&(e=a.querySelector("["+b.replace(":","\\:")+"]"))&&(d=e,c=e.getAttribute(b))});d&&(ve?(e.strictDi=null!==te(d,"strict-di"),b(d,c?[c]:[],e)):B.console.error("Angular: disabling automatic bootstrap. <script> protocol indicates an extension, document.location.href does not match."))}function Ic(a,b,d){I(d)||(d={});d=R({strictDi:!1},d);var c=function(){a=E(a);if(a.injector()){var c=a[0]===B.document?"document":wa(a);throw va("btstrpd",c.replace(/</,"&lt;").replace(/>/,"&gt;"))}b=b||[];b.unshift(["$provide",function(b){b.value("$rootElement",a)}]);d.debugInfoEnabled&&b.push(["$compileProvider",function(a){a.debugInfoEnabled(!0)}]);b.unshift("ng");c=eb(b,d.strictDi);c.invoke(["$rootScope","$rootElement","$compile","$injector",function(a,b,c,d){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return c},e=/^NG_ENABLE_DEBUG_INFO!/,f=/^NG_DEFER_BOOTSTRAP!/;B&&e.test(B.name)&&(d.debugInfoEnabled=!0,B.name=B.name.replace(e,""));if(B&&!f.test(B.name))return c();B.name=B.name.replace(f,"");ga.resumeBootstrap=function(a){q(a,function(a){b.push(a)});return c()};F(ga.resumeDeferredBootstrap)&&ga.resumeDeferredBootstrap()}function we(){B.name="NG_ENABLE_DEBUG_INFO!"+B.name;B.location.reload()}function xe(a){a=ga.element(a).injector();if(!a)throw va("test");return a.get("$$testability")}function Jc(a,b){b=b||"_";return a.replace(ye,function(a,c){return(c?b:"")+a.toLowerCase()})}function ze(){var a;if(!Kc){var b=ub();(xa=z(b)?B.jQuery:b?B[b]:void 0)&&xa.fn.on?(E=xa,R(xa.fn,{scope:Oa.scope,isolateScope:Oa.isolateScope,controller:Oa.controller,injector:Oa.injector,inheritedData:Oa.inheritedData}),a=xa.cleanData,xa.cleanData=function(b){for(var c,e=0,f;null!=(f=b[e]);e++)(c=xa._data(f,"events"))&&c.$destroy&&xa(f).triggerHandler("$destroy");a(b)}):E=T;ga.element=E;Kc=!0}}function vb(a,b,d){if(!a)throw va("areq",b||"?",d||"required");return a}function Pa(a,b,d){d&&K(a)&&(a=a[a.length-1]);vb(F(a),b,"not a function, got "+(a&&"object"===typeof a?a.constructor.name||"Object":typeof a));return a}function Qa(a,b){if("hasOwnProperty"===a)throw va("badname",b)}function Lc(a,b,d){if(!b)return a;b=b.split(".");for(var c,e=a,f=b.length,g=0;g<f;g++)c=b[g],a&&(a=(e=a)[c]);return!d&&F(a)?cb(e,a):a}function wb(a){for(var b=a[0],d=a[a.length-1],c,e=1;b!==d&&(b=b.nextSibling);e++)if(c||a[e]!==b)c||(c=E(ta.call(a,0,e))),c.push(b);return c||a}function S(){return Object.create(null)}function Ae(a){function b(a,b,c){return a[b]||(a[b]=c())}var d=N("$injector"),c=N("ng");a=b(a,"angular",Object);a.$$minErr=a.$$minErr||N;return b(a,"module",function(){var a={};return function(f,g,h){if("hasOwnProperty"===f)throw c("badname","module");g&&a.hasOwnProperty(f)&&(a[f]=null);return b(a,f,function(){function a(b,d,e,f){f||(f=c);return function(){f[e||"push"]([b,d,arguments]);return J}}function b(a,d){return function(b,e){e&&F(e)&&(e.$$moduleName=f);c.push([a,d,arguments]);return J}}if(!g)throw d("nomod",f);var c=[],e=[],p=[],x=a("$injector","invoke","push",e),J={_invokeQueue:c,_configBlocks:e,_runBlocks:p,requires:g,name:f,provider:b("$provide","provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:a("$provide","value"),constant:a("$provide","constant","unshift"),decorator:b("$provide","decorator"),animation:b("$animateProvider","register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),component:b("$compileProvider","component"),config:x,run:function(a){p.push(a);return this}};h&&x(h);return J})}})}function ia(a,b){if(K(a)){b=b||[];for(var d=0,c=a.length;d<c;d++)b[d]=a[d]}else if(I(a))for(d in b=b||{},a)if("$"!==d.charAt(0)||"$"!==d.charAt(1))b[d]=a[d];return b||a}function Be(a){R(a,{bootstrap:Ic,copy:pa,extend:R,merge:ne,equals:oa,element:E,forEach:q,injector:eb,noop:C,bind:cb,toJson:db,fromJson:Ec,identity:Za,isUndefined:z,isDefined:u,isString:H,isFunction:F,isObject:I,isNumber:Z,isElement:Tb,isArray:K,version:Ce,isDate:ba,lowercase:P,uppercase:xb,callbacks:{$$counter:0},getTestability:xe,$$minErr:N,$$csp:ya,reloadWithDebugInfo:we});Xb=Ae(B);Xb("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:De});a.provider("$compile",Mc).directive({a:Ee,input:Nc,textarea:Nc,form:Fe,script:Ge,select:He,option:Ie,ngBind:Je,ngBindHtml:Ke,ngBindTemplate:Le,ngClass:Me,ngClassEven:Ne,ngClassOdd:Oe,ngCloak:Pe,ngController:Qe,ngForm:Re,ngHide:Se,ngIf:Te,ngInclude:Ue,ngInit:Ve,ngNonBindable:We,ngPluralize:Xe,ngRepeat:Ye,ngShow:Ze,ngStyle:$e,ngSwitch:af,ngSwitchWhen:bf,ngSwitchDefault:cf,ngOptions:df,ngTransclude:ef,ngModel:ff,ngList:gf,ngChange:hf,pattern:Oc,ngPattern:Oc,required:Pc,ngRequired:Pc,minlength:Qc,ngMinlength:Qc,maxlength:Rc,ngMaxlength:Rc,ngValue:jf,ngModelOptions:kf}).directive({ngInclude:lf}).directive(yb).directive(Sc);a.provider({$anchorScroll:mf,$animate:nf,$animateCss:of,$$animateJs:pf,$$animateQueue:qf,$$AnimateRunner:rf,$$animateAsyncRun:sf,$browser:tf,$cacheFactory:uf,$controller:vf,$document:wf,$exceptionHandler:xf,$filter:Tc,$$forceReflow:yf,$interpolate:zf,$interval:Af,$http:Bf,$httpParamSerializer:Cf,$httpParamSerializerJQLike:Df,$httpBackend:Ef,$xhrFactory:Ff,$jsonpCallbacks:Gf,$location:Hf,$log:If,$parse:Jf,$rootScope:Kf,$q:Lf,$$q:Mf,$sce:Nf,$sceDelegate:Of,$sniffer:Pf,$templateCache:Qf,$templateRequest:Rf,$$testability:Sf,$timeout:Tf,$window:Uf,$$rAF:Vf,$$jqLite:Wf,$$HashMap:Xf,$$cookieReader:Yf})}])}function fb(a){return a.replace(Zf,function(a,d,c,e){return e?c.toUpperCase():c}).replace($f,"Moz$1")}function Uc(a){a=a.nodeType;return 1===a||!a||9===a}function Vc(a,b){var d,c,e=b.createDocumentFragment(),f=[];if(Yb.test(a)){d=e.appendChild(b.createElement("div"));c=(ag.exec(a)||["",""])[1].toLowerCase();c=ja[c]||ja._default;d.innerHTML=c[1]+a.replace(bg,"<$1></$2>")+c[2];for(c=c[0];c--;)d=d.lastChild;f=bb(f,d.childNodes);d=e.firstChild;d.textContent=""}else f.push(b.createTextNode(a));e.textContent="";e.innerHTML="";q(f,function(a){e.appendChild(a)});return e}function Wc(a,b){var d=a.parentNode;d&&d.replaceChild(b,a);b.appendChild(a)}function T(a){if(a instanceof T)return a;var b;H(a)&&(a=U(a),b=!0);if(!(this instanceof T)){if(b&&"<"!==a.charAt(0))throw Zb("nosel");return new T(a)}if(b){b=B.document;var d;a=(d=cg.exec(a))?[b.createElement(d[1])]:(d=Vc(a,b))?d.childNodes:[]}Xc(this,a)}function $b(a){return a.cloneNode(!0)}function zb(a,b){b||gb(a);if(a.querySelectorAll)for(var d=a.querySelectorAll("*"),c=0,e=d.length;c<e;c++)gb(d[c])}function Yc(a,b,d,c){if(u(c))throw Zb("offargs");var e=(c=Ab(a))&&c.events,f=c&&c.handle;if(f)if(b){var g=function(b){var c=e[b];u(d)&&ab(c||[],d);u(d)&&c&&0<c.length||(a.removeEventListener(b,f,!1),delete e[b])};q(b.split(" "),function(a){g(a);Bb[a]&&g(Bb[a])})}else for(b in e)"$destroy"!==b&&a.removeEventListener(b,f,!1),delete e[b]}function gb(a,b){var d=a.ng339,c=d&&hb[d];c&&(b?delete c.data[b]:(c.handle&&(c.events.$destroy&&c.handle({},"$destroy"),Yc(a)),delete hb[d],a.ng339=void 0))}function Ab(a,b){var d=a.ng339,d=d&&hb[d];b&&!d&&(a.ng339=d=++dg,d=hb[d]={events:{},data:{},handle:void 0});return d}function ac(a,b,d){if(Uc(a)){var c=u(d),e=!c&&b&&!I(b),f=!b;a=(a=Ab(a,!e))&&a.data;if(c)a[b]=d;else{if(f)return a;if(e)return a&&a[b];R(a,b)}}}function Cb(a,b){return a.getAttribute?-1<(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" "):!1}function Db(a,b){b&&a.setAttribute&&q(b.split(" "),function(b){a.setAttribute("class",U((" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+U(b)+" "," ")))})}function Eb(a,b){if(b&&a.setAttribute){var d=(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");q(b.split(" "),function(a){a=U(a);-1===d.indexOf(" "+a+" ")&&(d+=a+" ")});a.setAttribute("class",U(d))}}function Xc(a,b){if(b)if(b.nodeType)a[a.length++]=b;else{var d=b.length;if("number"===typeof d&&b.window!==b){if(d)for(var c=0;c<d;c++)a[a.length++]=b[c]}else a[a.length++]=b}}function Zc(a,b){return Fb(a,"$"+(b||"ngController")+"Controller")}function Fb(a,b,d){9===a.nodeType&&(a=a.documentElement);for(b=K(b)?b:[b];a;){for(var c=0,e=b.length;c<e;c++)if(u(d=E.data(a,b[c])))return d;a=a.parentNode||11===a.nodeType&&a.host}}function $c(a){for(zb(a,!0);a.firstChild;)a.removeChild(a.firstChild)}function Gb(a,b){b||zb(a);var d=a.parentNode;d&&d.removeChild(a)}function eg(a,b){b=b||B;if("complete"===b.document.readyState)b.setTimeout(a);else E(b).on("load",a)}function ad(a,b){var d=Hb[b.toLowerCase()];return d&&bd[ua(a)]&&d}function fg(a,b){var d=function(c,d){c.isDefaultPrevented=function(){return c.defaultPrevented};var f=b[d||c.type],g=f?f.length:0;if(g){if(z(c.immediatePropagationStopped)){var h=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){c.immediatePropagationStopped=!0;c.stopPropagation&&c.stopPropagation();h&&h.call(c)}}c.isImmediatePropagationStopped=function(){return!0===c.immediatePropagationStopped};var k=f.specialHandlerWrapper||gg;1<g&&(f=ia(f));for(var l=0;l<g;l++)c.isImmediatePropagationStopped()||k(a,c,f[l])}};d.elem=a;return d}function gg(a,b,d){d.call(a,b)}function hg(a,b,d){var c=b.relatedTarget;c&&(c===a||ig.call(a,c))||d.call(a,b)}function Wf(){this.$get=function(){return R(T,{hasClass:function(a,b){a.attr&&(a=a[0]);return Cb(a,b)},addClass:function(a,b){a.attr&&(a=a[0]);return Eb(a,b)},removeClass:function(a,b){a.attr&&(a=a[0]);return Db(a,b)}})}}function za(a,b){var d=a&&a.$$hashKey;if(d)return"function"===typeof d&&(d=a.$$hashKey()),d;d=typeof a;return d="function"===d||"object"===d&&null!==a?a.$$hashKey=d+":"+(b||me)():d+":"+a}function Ra(a,b){if(b){var d=0;this.nextUid=function(){return++d}}q(a,this.put,this)}function cd(a){a=(Function.prototype.toString.call(a)+" ").replace(jg,"");return a.match(kg)||a.match(lg)}function mg(a){return(a=cd(a))?"function("+(a[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function eb(a,b){function d(a){return function(b,c){if(I(b))q(b,Bc(a));else return a(b,c)}}function c(a,b){Qa(a,"service");if(F(b)||K(b))b=p.instantiate(b);if(!b.$get)throw Da("pget",a);return n[a+"Provider"]=b}function e(a,b){return function(){var c=t.invoke(b,this);if(z(c))throw Da("undef",a);return c}}function f(a,b,d){return c(a,{$get:!1!==d?e(a,b):b})}function g(a){vb(z(a)||K(a),"modulesToLoad","not an array");var b=[],c;q(a,function(a){function d(a){var b,c;b=0;for(c=a.length;b<c;b++){var e=a[b],f=p.get(e[0]);f[e[1]].apply(f,e[2])}}if(!m.get(a)){m.put(a,!0);try{H(a)?(c=Xb(a),b=b.concat(g(c.requires)).concat(c._runBlocks),d(c._invokeQueue),d(c._configBlocks)):F(a)?b.push(p.invoke(a)):K(a)?b.push(p.invoke(a)):Pa(a,"module")}catch(e){throw K(a)&&(a=a[a.length-1]),e.message&&e.stack&&-1===e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),Da("modulerr",a,e.stack||e.message||e)}}});return b}function h(a,c){function d(b,e){if(a.hasOwnProperty(b)){if(a[b]===k)throw Da("cdep",b+" <- "+l.join(" <- "));return a[b]}try{return l.unshift(b),a[b]=k,a[b]=c(b,e),a[b]}catch(f){throw a[b]===k&&delete a[b],f}finally{l.shift()}}function e(a,c,f){var g=[];a=eb.$$annotate(a,b,f);for(var h=0,k=a.length;h<k;h++){var l=a[h];if("string"!==typeof l)throw Da("itkn",l);g.push(c&&c.hasOwnProperty(l)?c[l]:d(l,f))}return g}return{invoke:function(a,b,c,d){"string"===typeof c&&(d=c,c=null);c=e(a,c,d);K(a)&&(a=a[a.length-1]);d=11>=Fa?!1:"function"===typeof a&&/^(?:class\b|constructor\()/.test(Function.prototype.toString.call(a)+" ");return d?(c.unshift(null),new(Function.prototype.bind.apply(a,c))):a.apply(b,c)},instantiate:function(a,b,c){var d=K(a)?a[a.length-1]:a;a=e(a,b,c);a.unshift(null);return new(Function.prototype.bind.apply(d,a))},get:d,annotate:eb.$$annotate,has:function(b){return n.hasOwnProperty(b+"Provider")||a.hasOwnProperty(b)}}}b=!0===b;var k={},l=[],m=new Ra([],(!0)),n={$provide:{provider:d(c),factory:d(f),service:d(function(a,b){return f(a,["$injector",function(a){return a.instantiate(b)}])}),value:d(function(a,b){return f(a,ma(b),!1)}),constant:d(function(a,b){Qa(a,"constant");n[a]=b;x[a]=b}),decorator:function(a,b){var c=p.get(a+"Provider"),d=c.$get;c.$get=function(){var a=t.invoke(d,c);return t.invoke(b,null,{$delegate:a})}}}},p=n.$injector=h(n,function(a,b){ga.isString(b)&&l.push(b);throw Da("unpr",l.join(" <- "))}),x={},J=h(x,function(a,b){var c=p.get(a+"Provider",b);return t.invoke(c.$get,c,void 0,a)}),t=J;n.$injectorProvider={$get:ma(J)};var s=g(a),t=J.get("$injector");t.strictDi=b;q(s,function(a){a&&t.invoke(a)});return t}function mf(){var a=!0;this.disableAutoScrolling=function(){a=!1};this.$get=["$window","$location","$rootScope",function(b,d,c){function e(a){var b=null;Array.prototype.some.call(a,function(a){if("a"===ua(a))return b=a,!0});return b}function f(a){if(a){a.scrollIntoView();var c;c=g.yOffset;F(c)?c=c():Tb(c)?(c=c[0],c="fixed"!==b.getComputedStyle(c).position?0:c.getBoundingClientRect().bottom):Z(c)||(c=0);c&&(a=a.getBoundingClientRect().top,b.scrollBy(0,a-c))}else b.scrollTo(0,0)}function g(a){a=H(a)?a:d.hash();var b;a?(b=h.getElementById(a))?f(b):(b=e(h.getElementsByName(a)))?f(b):"top"===a&&f(null):f(null)}var h=b.document;a&&c.$watch(function(){return d.hash()},function(a,b){a===b&&""===a||eg(function(){c.$evalAsync(g)})});return g}]}function jb(a,b){if(!a&&!b)return"";if(!a)return b;if(!b)return a;K(a)&&(a=a.join(" "));K(b)&&(b=b.join(" "));return a+" "+b}function ng(a){H(a)&&(a=a.split(" "));var b=S();q(a,function(a){a.length&&(b[a]=!0)});return b}function Ea(a){return I(a)?a:{}}function og(a,b,d,c){function e(a){try{a.apply(null,ta.call(arguments,1))}finally{if(J--,0===J)for(;t.length;)try{t.pop()()}catch(b){d.error(b)}}}function f(){w=null;g();h()}function g(){s=O();s=z(s)?null:s;oa(s,A)&&(s=A);A=s}function h(){if(y!==k.url()||D!==s)y=k.url(),D=s,q(L,function(a){a(k.url(),s)})}var k=this,l=a.location,m=a.history,n=a.setTimeout,p=a.clearTimeout,x={};k.isMock=!1;var J=0,t=[];k.$$completeOutstandingRequest=e;k.$$incOutstandingRequestCount=function(){J++};k.notifyWhenNoOutstandingRequests=function(a){0===J?a():t.push(a)};var s,D,y=l.href,ib=b.find("base"),w=null,O=c.history?function(){try{return m.state}catch(a){}}:C;g();D=s;k.url=function(b,d,e){z(e)&&(e=null);l!==a.location&&(l=a.location);m!==a.history&&(m=a.history);if(b){var f=D===e;if(y===b&&(!c.history||f))return k;var h=y&&Ja(y)===Ja(b);y=b;D=e;!c.history||h&&f?(h||(w=b),d?l.replace(b):h?(d=l,e=b.indexOf("#"),e=-1===e?"":b.substr(e),d.hash=e):l.href=b,l.href!==b&&(w=b)):(m[d?"replaceState":"pushState"](e,"",b),g(),D=s);w&&(w=b);return k}return w||l.href.replace(/%27/g,"'")};k.state=function(){return s};var L=[],Q=!1,A=null;k.onUrlChange=function(b){if(!Q){if(c.history)E(a).on("popstate",f);E(a).on("hashchange",f);Q=!0}L.push(b);return b};k.$$applicationDestroyed=function(){E(a).off("hashchange popstate",f)};k.$$checkUrlChange=h;k.baseHref=function(){var a=ib.attr("href");return a?a.replace(/^(https?:)?\/\/[^\/]*/,""):""};k.defer=function(a,b){var c;J++;c=n(function(){delete x[c];e(a)},b||0);x[c]=!0;return c};k.defer.cancel=function(a){return x[a]?(delete x[a],p(a),e(C),!0):!1}}function tf(){this.$get=["$window","$log","$sniffer","$document",function(a,b,d,c){return new og(a,c,b,d)}]}function uf(){this.$get=function(){function a(a,c){function e(a){a!==n&&(p?p===a&&(p=a.n):p=a,f(a.n,a.p),f(a,n),n=a,n.n=null)}function f(a,b){a!==b&&(a&&(a.p=b),b&&(b.n=a))}if(a in b)throw N("$cacheFactory")("iid",a);var g=0,h=R({},c,{id:a}),k=S(),l=c&&c.capacity||Number.MAX_VALUE,m=S(),n=null,p=null;return b[a]={put:function(a,b){if(!z(b)){if(l<Number.MAX_VALUE){var c=m[a]||(m[a]={key:a});e(c)}a in k||g++;k[a]=b;g>l&&this.remove(p.key);return b}},get:function(a){if(l<Number.MAX_VALUE){var b=m[a];if(!b)return;e(b)}return k[a]},remove:function(a){if(l<Number.MAX_VALUE){var b=m[a];if(!b)return;b===n&&(n=b.p);b===p&&(p=b.n);f(b.n,b.p);delete m[a]}a in k&&(delete k[a],g--)},removeAll:function(){k=S();g=0;m=S();n=p=null},destroy:function(){m=h=k=null;delete b[a]},info:function(){return R({},h,{size:g})}}}var b={};a.info=function(){var a={};q(b,function(b,e){a[e]=b.info()});return a};a.get=function(a){return b[a]};return a}}function Qf(){this.$get=["$cacheFactory",function(a){return a("templates")}]}function Mc(a,b){function d(a,b,c){var d=/^\s*([@&<]|=(\*?))(\??)\s*(\w*)\s*$/,e=S();q(a,function(a,f){if(a in n)e[f]=n[a];else{var g=a.match(d);if(!g)throw da("iscp",b,f,a,c?"controller bindings definition":"isolate scope definition");e[f]={mode:g[1][0],collection:"*"===g[2],optional:"?"===g[3],attrName:g[4]||f};g[4]&&(n[a]=e[f])}});return e}function c(a){var b=a.charAt(0);if(!b||b!==P(b))throw da("baddir",a);if(a!==a.trim())throw da("baddir",a)}function e(a){var b=a.require||a.controller&&a.name;!K(b)&&I(b)&&q(b,function(a,c){var d=a.match(l);a.substring(d[0].length)||(b[c]=d[0]+c)});return b}var f={},g=/^\s*directive:\s*([\w\-]+)\s+(.*)$/,h=/(([\w\-]+)(?::([^;]+))?;?)/,k=qe("ngSrc,ngSrcset,src,srcset"),l=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,m=/^(on[a-z]+|formaction)$/,n=S();this.directive=function D(b,d){Qa(b,"directive");H(b)?(c(b),vb(d,"directiveFactory"),f.hasOwnProperty(b)||(f[b]=[],a.factory(b+"Directive",["$injector","$exceptionHandler",function(a,c){var d=[];q(f[b],function(f,g){try{var h=a.invoke(f);F(h)?h={compile:ma(h)}:!h.compile&&h.link&&(h.compile=ma(h.link));h.priority=h.priority||0;h.index=g;h.name=h.name||b;h.require=e(h);h.restrict=h.restrict||"EA";h.$$moduleName=f.$$moduleName;d.push(h)}catch(k){c(k)}});return d}])),f[b].push(d)):q(b,Bc(D));return this};this.component=function(a,b){function c(a){function e(b){return F(b)||K(b)?function(c,d){return a.invoke(b,this,{$element:c,$attrs:d})}:b}var f=b.template||b.templateUrl?b.template:"",g={controller:d,controllerAs:dd(b.controller)||b.controllerAs||"$ctrl",template:e(f),templateUrl:e(b.templateUrl),transclude:b.transclude,scope:{},bindToController:b.bindings||{},restrict:"E",require:b.require};q(b,function(a,b){"$"===b.charAt(0)&&(g[b]=a)});return g}var d=b.controller||function(){};q(b,function(a,b){"$"===b.charAt(0)&&(c[b]=a,F(d)&&(d[b]=a))});c.$inject=["$injector"];return this.directive(a,c)};this.aHrefSanitizationWhitelist=function(a){return u(a)?(b.aHrefSanitizationWhitelist(a),this):b.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(a){return u(a)?(b.imgSrcSanitizationWhitelist(a),this):b.imgSrcSanitizationWhitelist()};var p=!0;this.debugInfoEnabled=function(a){return u(a)?(p=a,this):p};var x=10;this.onChangesTtl=function(a){return arguments.length?(x=a,this):x};var J=!0;this.commentDirectivesEnabled=function(a){return arguments.length?(J=a,this):J};var t=!0;this.cssClassDirectivesEnabled=function(a){return arguments.length?(t=a,this):t};this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$sce","$animate","$$sanitizeUri",function(a,b,c,e,n,L,Q,A,G,v){function M(){try{if(!--qa)throw fa=void 0,da("infchng",x);Q.$apply(function(){for(var a=[],b=0,c=fa.length;b<c;++b)try{fa[b]()}catch(d){a.push(d)}fa=void 0;if(a.length)throw a})}finally{qa++}}function bc(a,b){if(b){var c=Object.keys(b),d,e,f;d=0;for(e=c.length;d<e;d++)f=c[d],this[f]=b[f]}else this.$attr={};this.$$element=a}function r(a,b,c){pa.innerHTML="<span "+b+">";b=pa.firstChild.attributes;var d=b[0];b.removeNamedItem(d.name);d.value=c;a.attributes.setNamedItem(d)}function Ha(a,b){try{a.addClass(b)}catch(c){}}function $(a,b,c,d,e){a instanceof E||(a=E(a));for(var f=/\S+/,g=0,h=a.length;g<h;g++){var k=a[g];k.nodeType===Ma&&k.nodeValue.match(f)&&Wc(k,a[g]=B.document.createElement("span"))}var l=Aa(a,b,a,c,d,e);$.$$addScopeClass(a);var m=null;return function(b,c,d){vb(b,"scope");e&&e.needsNewScope&&(b=b.$parent.$new());d=d||{};var f=d.parentBoundTranscludeFn,g=d.transcludeControllers;d=d.futureParentElement;f&&f.$$boundTransclude&&(f=f.$$boundTransclude);m||(m=(d=d&&d[0])?"foreignobject"!==ua(d)&&na.call(d).match(/SVG/)?"svg":"html":"html");d="html"!==m?E(ba(m,E("<div>").append(a).html())):c?Oa.clone.call(a):a;if(g)for(var h in g)d.data("$"+h+"Controller",g[h].instance);$.$$addScopeInfo(d,b);c&&c(d,b);l&&l(b,d,d,f);return d}}function Aa(a,b,c,d,e,f){function g(a,c,d,e){var f,k,l,m,p,y,x;if(n)for(x=Array(c.length),m=0;m<h.length;m+=3)f=h[m],x[f]=c[f];else x=c;m=0;for(p=h.length;m<p;)k=x[h[m++]],c=h[m++],f=h[m++],c?(c.scope?(l=a.$new(),$.$$addScopeInfo(E(k),l)):l=a,y=c.transcludeOnThisElement?ha(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?ha(a,b):null,c(f,l,k,d,y)):f&&f(a,k.childNodes,void 0,e)}for(var h=[],k,l,m,p,n,y=0;y<a.length;y++){k=new bc;l=dc(a[y],[],k,0===y?d:void 0,e);(f=l.length?Sa(l,a[y],k,b,c,null,[],[],f):null)&&f.scope&&$.$$addScopeClass(k.$$element);k=f&&f.terminal||!(m=a[y].childNodes)||!m.length?null:Aa(m,f?(f.transcludeOnThisElement||!f.templateOnThisElement)&&f.transclude:b);if(f||k)h.push(y,f,k),p=!0,n=n||f;f=null}return p?g:null}function ha(a,b,c){function d(e,f,g,h,k){e||(e=a.$new(!1,k),e.$$transcluded=!0);return b(e,f,{parentBoundTranscludeFn:c,transcludeControllers:g,futureParentElement:h})}var e=d.$$slots=S(),f;for(f in b.$$slots)e[f]=b.$$slots[f]?ha(a,b.$$slots[f],c):null;return d}function dc(a,b,c,d,e){var f=c.$attr,g;switch(a.nodeType){case 1:g=ua(a);V(b,Ba(g),"E",d,e);for(var k,l,m,p,n=a.attributes,y=0,x=n&&n.length;y<x;y++){var A=!1,L=!1;k=n[y];l=k.name;m=U(k.value);k=Ba(l);(p=Da.test(k))&&(l=l.replace(ed,"").substr(8).replace(/_(.)/g,function(a,b){return b.toUpperCase()}));(k=k.match(Ea))&&Y(k[1])&&(A=l,L=l.substr(0,l.length-5)+"end",l=l.substr(0,l.length-6));k=Ba(l.toLowerCase());f[k]=l;if(p||!c.hasOwnProperty(k))c[k]=m,ad(a,k)&&(c[k]=!0);ma(a,b,m,k,p);V(b,k,"A",d,e,A,L)}"input"===g&&"hidden"===a.getAttribute("type")&&a.setAttribute("autocomplete","off");if(!Ca)break;f=a.className;I(f)&&(f=f.animVal);if(H(f)&&""!==f)for(;a=h.exec(f);)k=Ba(a[2]),V(b,k,"C",d,e)&&(c[k]=U(a[3])),f=f.substr(a.index+a[0].length);break;case Ma:if(11===Fa)for(;a.parentNode&&a.nextSibling&&a.nextSibling.nodeType===Ma;)a.nodeValue+=a.nextSibling.nodeValue,a.parentNode.removeChild(a.nextSibling);ga(b,a.nodeValue);break;case 8:if(!xa)break;N(a,b,c,d,e)}b.sort(ea);return b}function N(a,b,c,d,e){try{var f=g.exec(a.nodeValue);if(f){var h=Ba(f[1]);V(b,h,"M",d,e)&&(c[h]=U(f[2]))}}catch(k){}}function fd(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw da("uterdir",b,c);1===a.nodeType&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return E(d)}function gd(a,b,c){return function(d,e,f,g,h){e=fd(e[0],b,c);return a(d,e,f,g,h)}}function fc(a,b,c,d,e,f){var g;return a?$(b,c,d,e,f):function(){g||(g=$(b,c,d,e,f),b=c=f=null);return g.apply(this,arguments)}}function Sa(a,b,d,e,f,g,h,k,l){function m(a,b,c,d){if(a){c&&(a=gd(a,c,d));a.require=v.require;a.directiveName=w;if(A===v||v.$$isolateScope)a=ja(a,{isolateScope:!0});h.push(a)}if(b){c&&(b=gd(b,c,d));b.require=v.require;b.directiveName=w;if(A===v||v.$$isolateScope)b=ja(b,{isolateScope:!0});k.push(b)}}function p(a,e,f,g,l){function m(a,b,c,d){var e;$a(a)||(d=c,c=b,b=a,a=void 0);J&&(e=D);c||(c=J?M.parent():M);if(d){var f=l.$$slots[d];if(f)return f(a,b,e,c,r);if(z(f))throw da("noslot",d,wa(M))}else return l(a,b,e,c,r)}var n,v,t,G,Q,D,w,M;b===f?(g=d,M=d.$$element):(M=E(f),g=new bc(M,d));Q=e;A?G=e.$new(!0):y&&(Q=e.$parent);l&&(w=m,w.$$boundTransclude=l,w.isSlotFilled=function(a){return!!l.$$slots[a]});x&&(D=T(M,g,w,x,G,e,A));A&&($.$$addScopeInfo(M,G,!0,!(L&&(L===A||L===A.$$originalDirective))),$.$$addScopeClass(M,!0),G.$$isolateBindings=A.$$isolateBindings,v=ka(e,g,G,G.$$isolateBindings,A),v.removeWatches&&G.$on("$destroy",v.removeWatches));for(n in D){v=x[n];t=D[n];var cc=v.$$bindings.bindToController;t.bindingInfo=t.identifier&&cc?ka(Q,g,t.instance,cc,v):{};var O=t();O!==t.instance&&(t.instance=O,M.data("$"+v.name+"Controller",O),t.bindingInfo.removeWatches&&t.bindingInfo.removeWatches(),t.bindingInfo=ka(Q,g,t.instance,cc,v))}q(x,function(a,b){var c=a.require;a.bindToController&&!K(c)&&I(c)&&R(D[b].instance,kb(b,c,M,D))});q(D,function(a){var b=a.instance;if(F(b.$onChanges))try{b.$onChanges(a.bindingInfo.initialChanges)}catch(d){c(d)}if(F(b.$onInit))try{b.$onInit()}catch(e){c(e)}F(b.$doCheck)&&(Q.$watch(function(){b.$doCheck()}),b.$doCheck());F(b.$onDestroy)&&Q.$on("$destroy",function(){b.$onDestroy()})});n=0;for(v=h.length;n<v;n++)t=h[n],la(t,t.isolateScope?G:e,M,g,t.require&&kb(t.directiveName,t.require,M,D),w);var r=e;A&&(A.template||null===A.templateUrl)&&(r=G);a&&a(r,f.childNodes,void 0,l);for(n=k.length-1;0<=n;n--)t=k[n],la(t,t.isolateScope?G:e,M,g,t.require&&kb(t.directiveName,t.require,M,D),w);q(D,function(a){a=a.instance;F(a.$postLink)&&a.$postLink()})}l=l||{};for(var n=-Number.MAX_VALUE,y=l.newScopeDirective,x=l.controllerDirectives,A=l.newIsolateScopeDirective,L=l.templateDirective,t=l.nonTlbTranscludeDirective,Q=!1,D=!1,J=l.hasElementTranscludeDirective,G=d.$$element=E(b),v,w,M,O=e,r,Ga=!1,Ha=!1,u,C=0,Aa=a.length;C<Aa;C++){v=a[C];var B=v.$$start,H=v.$$end;B&&(G=fd(b,B,H));M=void 0;if(n>v.priority)break;
if(u=v.scope)v.templateUrl||(I(u)?(X("new/isolated scope",A||y,v,G),A=v):X("new/isolated scope",A,v,G)),y=y||v;w=v.name;if(!Ga&&(v.replace&&(v.templateUrl||v.template)||v.transclude&&!v.$$tlb)){for(u=C+1;Ga=a[u++];)if(Ga.transclude&&!Ga.$$tlb||Ga.replace&&(Ga.templateUrl||Ga.template)){Ha=!0;break}Ga=!0}!v.templateUrl&&v.controller&&(u=v.controller,x=x||S(),X("'"+w+"' controller",x[w],v,G),x[w]=v);if(u=v.transclude)if(Q=!0,v.$$tlb||(X("transclusion",t,v,G),t=v),"element"===u)J=!0,n=v.priority,M=G,G=d.$$element=E($.$$createComment(w,d[w])),b=G[0],ca(f,ta.call(M,0),b),M[0].$$parentNode=M[0].parentNode,O=fc(Ha,M,e,n,g&&g.name,{nonTlbTranscludeDirective:t});else{var ha=S();M=E($b(b)).contents();if(I(u)){M=[];var N=S(),P=S();q(u,function(a,b){var c="?"===a.charAt(0);a=c?a.substring(1):a;N[a]=b;ha[b]=null;P[b]=c});q(G.contents(),function(a){var b=N[Ba(ua(a))];b?(P[b]=!0,ha[b]=ha[b]||[],ha[b].push(a)):M.push(a)});q(P,function(a,b){if(!a)throw da("reqslot",b)});for(var Sa in ha)ha[Sa]&&(ha[Sa]=fc(Ha,ha[Sa],e))}G.empty();O=fc(Ha,M,e,void 0,void 0,{needsNewScope:v.$$isolateScope||v.$$newScope});O.$$slots=ha}if(v.template)if(D=!0,X("template",L,v,G),L=v,u=F(v.template)?v.template(G,d):v.template,u=za(u),v.replace){g=v;M=Yb.test(u)?hd(ba(v.templateNamespace,U(u))):[];b=M[0];if(1!==M.length||1!==b.nodeType)throw da("tplrt",w,"");ca(f,G,b);Aa={$attr:{}};u=dc(b,[],Aa);var V=a.splice(C+1,a.length-(C+1));(A||y)&&W(u,A,y);a=a.concat(u).concat(V);Z(d,Aa);Aa=a.length}else G.html(u);if(v.templateUrl)D=!0,X("template",L,v,G),L=v,v.replace&&(g=v),p=aa(a.splice(C,a.length-C),G,d,f,Q&&O,h,k,{controllerDirectives:x,newScopeDirective:y!==v&&y,newIsolateScopeDirective:A,templateDirective:L,nonTlbTranscludeDirective:t}),Aa=a.length;else if(v.compile)try{r=v.compile(G,d,O);var ec=v.$$originalDirective||v;F(r)?m(null,cb(ec,r),B,H):r&&m(cb(ec,r.pre),cb(ec,r.post),B,H)}catch(Y){c(Y,wa(G))}v.terminal&&(p.terminal=!0,n=Math.max(n,v.priority))}p.scope=y&&!0===y.scope;p.transcludeOnThisElement=Q;p.templateOnThisElement=D;p.transclude=O;l.hasElementTranscludeDirective=J;return p}function kb(a,b,c,d){var e;if(H(b)){var f=b.match(l);b=b.substring(f[0].length);var g=f[1]||f[3],f="?"===f[2];"^^"===g?c=c.parent():e=(e=d&&d[b])&&e.instance;if(!e){var h="$"+b+"Controller";e=g?c.inheritedData(h):c.data(h)}if(!e&&!f)throw da("ctreq",b,a)}else if(K(b))for(e=[],g=0,f=b.length;g<f;g++)e[g]=kb(a,b[g],c,d);else I(b)&&(e={},q(b,function(b,f){e[f]=kb(a,b,c,d)}));return e||null}function T(a,b,c,d,e,f,g){var h=S(),k;for(k in d){var l=d[k],m={$scope:l===g||l.$$isolateScope?e:f,$element:a,$attrs:b,$transclude:c},p=l.controller;"@"===p&&(p=b[l.name]);m=L(p,m,!0,l.controllerAs);h[l.name]=m;a.data("$"+l.name+"Controller",m.instance)}return h}function W(a,b,c){for(var d=0,e=a.length;d<e;d++)a[d]=Ub(a[d],{$$isolateScope:b,$$newScope:c})}function V(b,e,g,h,k,l,m){if(e===k)return null;k=null;if(f.hasOwnProperty(e)){var p;e=a.get(e+"Directive");for(var n=0,y=e.length;n<y;n++)try{if(p=e[n],(z(h)||h>p.priority)&&-1!==p.restrict.indexOf(g)){l&&(p=Ub(p,{$$start:l,$$end:m}));if(!p.$$bindings){var x=p,v=p,A=p.name,t={isolateScope:null,bindToController:null};I(v.scope)&&(!0===v.bindToController?(t.bindToController=d(v.scope,A,!0),t.isolateScope={}):t.isolateScope=d(v.scope,A,!1));I(v.bindToController)&&(t.bindToController=d(v.bindToController,A,!0));if(I(t.bindToController)){var L=v.controller,G=v.controllerAs;if(!L)throw da("noctrl",A);if(!dd(L,G))throw da("noident",A)}var Q=x.$$bindings=t;I(Q.isolateScope)&&(p.$$isolateBindings=Q.isolateScope)}b.push(p);k=p}}catch(J){c(J)}}return k}function Y(b){if(f.hasOwnProperty(b))for(var c=a.get(b+"Directive"),d=0,e=c.length;d<e;d++)if(b=c[d],b.multiElement)return!0;return!1}function Z(a,b){var c=b.$attr,d=a.$attr;q(a,function(d,e){"$"!==e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});q(b,function(b,e){a.hasOwnProperty(e)||"$"===e.charAt(0)||(a[e]=b,"class"!==e&&"style"!==e&&(d[e]=c[e]))})}function aa(a,b,c,d,f,g,h,k){var l=[],m,p,n=b[0],y=a.shift(),x=Ub(y,{templateUrl:null,transclude:null,replace:null,$$originalDirective:y}),v=F(y.templateUrl)?y.templateUrl(b,c):y.templateUrl,A=y.templateNamespace;b.empty();e(v).then(function(e){var t,L;e=za(e);if(y.replace){e=Yb.test(e)?hd(ba(A,U(e))):[];t=e[0];if(1!==e.length||1!==t.nodeType)throw da("tplrt",y.name,v);e={$attr:{}};ca(d,b,t);var G=dc(t,[],e);I(y.scope)&&W(G,!0);a=G.concat(a);Z(c,e)}else t=n,b.html(e);a.unshift(x);m=Sa(a,t,c,f,b,y,g,h,k);q(d,function(a,c){a===t&&(d[c]=b[0])});for(p=Aa(b[0].childNodes,f);l.length;){e=l.shift();L=l.shift();var Q=l.shift(),D=l.shift(),G=b[0];if(!e.$$destroyed){if(L!==n){var J=L.className;k.hasElementTranscludeDirective&&y.replace||(G=$b(t));ca(Q,E(L),G);Ha(E(G),J)}L=m.transcludeOnThisElement?ha(e,m.transclude,D):D;m(p,e,G,d,L)}}l=null});return function(a,b,c,d,e){a=e;b.$$destroyed||(l?l.push(b,c,d,a):(m.transcludeOnThisElement&&(a=ha(b,m.transclude,e)),m(p,b,c,d,a)))}}function ea(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function X(a,b,c,d){function e(a){return a?" (module: "+a+")":""}if(b)throw da("multidir",b.name,e(b.$$moduleName),c.name,e(c.$$moduleName),a,wa(d))}function ga(a,c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){a=a.parent();var b=!!a.length;b&&$.$$addBindingClass(a);return function(a,c){var e=c.parent();b||$.$$addBindingClass(e);$.$$addBindingInfo(e,d.expressions);a.$watch(d,function(a){c[0].nodeValue=a})}}})}function ba(a,b){a=P(a||"html");switch(a){case"svg":case"math":var c=B.document.createElement("div");c.innerHTML="<"+a+">"+b+"</"+a+">";return c.childNodes[0].childNodes;default:return b}}function ia(a,b){if("srcdoc"===b)return A.HTML;var c=ua(a);if("src"===b||"ngSrc"===b){if(-1===["img","video","audio","source","track"].indexOf(c))return A.RESOURCE_URL}else if("xlinkHref"===b||"form"===c&&"action"===b)return A.RESOURCE_URL}function ma(a,c,d,e,f){var g=ia(a,e);f=k[e]||f;var h=b(d,!0,g,f);if(h){if("multiple"===e&&"select"===ua(a))throw da("selmulti",wa(a));c.push({priority:100,compile:function(){return{pre:function(a,c,k){c=k.$$observers||(k.$$observers=S());if(m.test(e))throw da("nodomevents");var l=k[e];l!==d&&(h=l&&b(l,!0,g,f),d=l);h&&(k[e]=h(a),(c[e]||(c[e]=[])).$$inter=!0,(k.$$observers&&k.$$observers[e].$$scope||a).$watch(h,function(a,b){"class"===e&&a!==b?k.$updateClass(a,b):k.$set(e,a)}))}}}})}}function ca(a,b,c){var d=b[0],e=b.length,f=d.parentNode,g,h;if(a)for(g=0,h=a.length;g<h;g++)if(a[g]===d){a[g++]=c;h=g+e-1;for(var k=a.length;g<k;g++,h++)h<k?a[g]=a[h]:delete a[g];a.length-=e-1;a.context===d&&(a.context=c);break}f&&f.replaceChild(c,d);a=B.document.createDocumentFragment();for(g=0;g<e;g++)a.appendChild(b[g]);E.hasData(d)&&(E.data(c,E.data(d)),E(d).off("$destroy"));E.cleanData(a.querySelectorAll("*"));for(g=1;g<e;g++)delete b[g];b[0]=c;b.length=1}function ja(a,b){return R(function(){return a.apply(null,arguments)},a,b)}function la(a,b,d,e,f,g){try{a(b,d,e,f,g)}catch(h){c(h,wa(d))}}function ka(a,c,d,e,f){function g(b,c,e){F(d.$onChanges)&&c!==e&&(fa||(a.$$postDigest(M),fa=[]),m||(m={},fa.push(h)),m[b]&&(e=m[b].previousValue),m[b]=new Ib(e,c))}function h(){d.$onChanges(m);m=void 0}var k=[],l={},m;q(e,function(e,h){var m=e.attrName,p=e.optional,x,v,t,A;switch(e.mode){case"@":p||sa.call(c,m)||(d[h]=c[m]=void 0);c.$observe(m,function(a){if(H(a)||Ia(a))g(h,a,d[h]),d[h]=a});c.$$observers[m].$$scope=a;x=c[m];H(x)?d[h]=b(x)(a):Ia(x)&&(d[h]=x);l[h]=new Ib(gc,d[h]);break;case"=":if(!sa.call(c,m)){if(p)break;c[m]=void 0}if(p&&!c[m])break;v=n(c[m]);A=v.literal?oa:function(a,b){return a===b||a!==a&&b!==b};t=v.assign||function(){x=d[h]=v(a);throw da("nonassign",c[m],m,f.name)};x=d[h]=v(a);p=function(b){A(b,d[h])||(A(b,x)?t(a,b=d[h]):d[h]=b);return x=b};p.$stateful=!0;p=e.collection?a.$watchCollection(c[m],p):a.$watch(n(c[m],p),null,v.literal);k.push(p);break;case"<":if(!sa.call(c,m)){if(p)break;c[m]=void 0}if(p&&!c[m])break;v=n(c[m]);var L=d[h]=v(a);l[h]=new Ib(gc,d[h]);p=a.$watch(v,function(a,b){if(b===a){if(b===L)return;b=L}g(h,a,b);d[h]=a},v.literal);k.push(p);break;case"&":v=c.hasOwnProperty(m)?n(c[m]):C;if(v===C&&p)break;d[h]=function(b){return v(a,b)}}});return{initialChanges:l,removeWatches:k.length&&function(){for(var a=0,b=k.length;a<b;++a)k[a]()}}}var ra=/^\w/,pa=B.document.createElement("div"),xa=J,Ca=t,qa=x,fa;bc.prototype={$normalize:Ba,$addClass:function(a){a&&0<a.length&&G.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&G.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=id(a,b);c&&c.length&&G.addClass(this.$$element,c);(c=id(b,a))&&c.length&&G.removeClass(this.$$element,c)},$set:function(a,b,d,e){var f=ad(this.$$element[0],a),g=jd[a],h=a;f?(this.$$element.prop(a,b),e=f):g&&(this[g]=b,h=g);this[a]=b;e?this.$attr[a]=e:(e=this.$attr[a])||(this.$attr[a]=e=Jc(a,"-"));f=ua(this.$$element);if("a"===f&&("href"===a||"xlinkHref"===a)||"img"===f&&"src"===a)this[a]=b=v(b,"src"===a);else if("img"===f&&"srcset"===a&&u(b)){for(var f="",g=U(b),k=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,k=/\s/.test(g)?k:/(,)/,g=g.split(k),k=Math.floor(g.length/2),l=0;l<k;l++)var m=2*l,f=f+v(U(g[m]),!0),f=f+(" "+U(g[m+1]));g=U(g[2*l]).split(/\s/);f+=v(U(g[0]),!0);2===g.length&&(f+=" "+U(g[1]));this[a]=b=f}!1!==d&&(null===b||z(b)?this.$$element.removeAttr(e):ra.test(e)?this.$$element.attr(e,b):r(this.$$element[0],e,b));(a=this.$$observers)&&q(a[h],function(a){try{a(b)}catch(d){c(d)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers=S()),e=d[a]||(d[a]=[]);e.push(b);Q.$evalAsync(function(){e.$$inter||!c.hasOwnProperty(a)||z(c[a])||b(c[a])});return function(){ab(e,b)}}};var va=b.startSymbol(),ya=b.endSymbol(),za="{{"===va&&"}}"===ya?Za:function(a){return a.replace(/\{\{/g,va).replace(/}}/g,ya)},Da=/^ngAttr[A-Z]/,Ea=/^(.+)Start$/;$.$$addBindingInfo=p?function(a,b){var c=a.data("$binding")||[];K(b)?c=c.concat(b):c.push(b);a.data("$binding",c)}:C;$.$$addBindingClass=p?function(a){Ha(a,"ng-binding")}:C;$.$$addScopeInfo=p?function(a,b,c,d){a.data(c?d?"$isolateScopeNoTemplate":"$isolateScope":"$scope",b)}:C;$.$$addScopeClass=p?function(a,b){Ha(a,b?"ng-isolate-scope":"ng-scope")}:C;$.$$createComment=function(a,b){var c="";p&&(c=" "+(a||"")+": ",b&&(c+=b+" "));return B.document.createComment(c)};return $}]}function Ib(a,b){this.previousValue=a;this.currentValue=b}function Ba(a){return fb(a.replace(ed,""))}function id(a,b){var d="",c=a.split(/\s+/),e=b.split(/\s+/),f=0;a:for(;f<c.length;f++){for(var g=c[f],h=0;h<e.length;h++)if(g===e[h])continue a;d+=(0<d.length?" ":"")+g}return d}function hd(a){a=E(a);var b=a.length;if(1>=b)return a;for(;b--;)8===a[b].nodeType&&pg.call(a,b,1);return a}function dd(a,b){if(b&&H(b))return b;if(H(a)){var d=kd.exec(a);if(d)return d[3]}}function vf(){var a={},b=!1;this.has=function(b){return a.hasOwnProperty(b)};this.register=function(b,c){Qa(b,"controller");I(b)?R(a,b):a[b]=c};this.allowGlobals=function(){b=!0};this.$get=["$injector","$window",function(d,c){function e(a,b,c,d){if(!a||!I(a.$scope))throw N("$controller")("noscp",d,b);a.$scope[b]=c}return function(f,g,h,k){var l,m,n;h=!0===h;k&&H(k)&&(n=k);if(H(f)){k=f.match(kd);if(!k)throw qg("ctrlfmt",f);m=k[1];n=n||k[3];f=a.hasOwnProperty(m)?a[m]:Lc(g.$scope,m,!0)||(b?Lc(c,m,!0):void 0);Pa(f,m,!0)}if(h)return h=(K(f)?f[f.length-1]:f).prototype,l=Object.create(h||null),n&&e(g,n,l,m||f.name),R(function(){var a=d.invoke(f,l,g,m);a!==l&&(I(a)||F(a))&&(l=a,n&&e(g,n,l,m||f.name));return l},{instance:l,identifier:n});l=d.instantiate(f,g,m);n&&e(g,n,l,m||f.name);return l}}]}function wf(){this.$get=["$window",function(a){return E(a.document)}]}function xf(){this.$get=["$log",function(a){return function(b,d){a.error.apply(a,arguments)}}]}function hc(a){return I(a)?ba(a)?a.toISOString():db(a):a}function Cf(){this.$get=function(){return function(a){if(!a)return"";var b=[];Ac(a,function(a,c){null===a||z(a)||(K(a)?q(a,function(a){b.push(ca(c)+"="+ca(hc(a)))}):b.push(ca(c)+"="+ca(hc(a))))});return b.join("&")}}}function Df(){this.$get=function(){return function(a){function b(a,e,f){null===a||z(a)||(K(a)?q(a,function(a,c){b(a,e+"["+(I(a)?c:"")+"]")}):I(a)&&!ba(a)?Ac(a,function(a,c){b(a,e+(f?"":"[")+c+(f?"":"]"))}):d.push(ca(e)+"="+ca(hc(a))))}if(!a)return"";var d=[];b(a,"",!0);return d.join("&")}}}function ic(a,b){if(H(a)){var d=a.replace(rg,"").trim();if(d){var c=b("Content-Type");(c=c&&0===c.indexOf(ld))||(c=(c=d.match(sg))&&tg[c[0]].test(d));c&&(a=Ec(d))}}return a}function md(a){var b=S(),d;H(a)?q(a.split("\n"),function(a){d=a.indexOf(":");var e=P(U(a.substr(0,d)));a=U(a.substr(d+1));e&&(b[e]=b[e]?b[e]+", "+a:a)}):I(a)&&q(a,function(a,d){var f=P(d),g=U(a);f&&(b[f]=b[f]?b[f]+", "+g:g)});return b}function nd(a){var b;return function(d){b||(b=md(a));return d?(d=b[P(d)],void 0===d&&(d=null),d):b}}function od(a,b,d,c){if(F(c))return c(a,b,d);q(c,function(c){a=c(a,b,d)});return a}function Bf(){var a=this.defaults={transformResponse:[ic],transformRequest:[function(a){return I(a)&&"[object File]"!==na.call(a)&&"[object Blob]"!==na.call(a)&&"[object FormData]"!==na.call(a)?db(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ia(jc),put:ia(jc),patch:ia(jc)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer"},b=!1;this.useApplyAsync=function(a){return u(a)?(b=!!a,this):b};var d=!0;this.useLegacyPromiseExtensions=function(a){return u(a)?(d=!!a,this):d};var c=this.interceptors=[];this.$get=["$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector",function(e,f,g,h,k,l){function m(b){function c(a,b){for(var d=0,e=b.length;d<e;){var f=b[d++],g=b[d++];a=a.then(f,g)}b.length=0;return a}function e(a,b){var c,d={};q(a,function(a,e){F(a)?(c=a(b),null!=c&&(d[e]=c)):d[e]=a});return d}function f(a){var b=R({},a);b.data=od(a.data,a.headers,a.status,g.transformResponse);a=a.status;return 200<=a&&300>a?b:k.reject(b)}if(!I(b))throw N("$http")("badreq",b);if(!H(b.url))throw N("$http")("badreq",b.url);var g=R({method:"get",transformRequest:a.transformRequest,transformResponse:a.transformResponse,paramSerializer:a.paramSerializer},b);g.headers=function(b){var c=a.headers,d=R({},b.headers),f,g,h,c=R({},c.common,c[P(b.method)]);a:for(f in c){g=P(f);for(h in d)if(P(h)===g)continue a;d[f]=c[f]}return e(d,ia(b))}(b);g.method=xb(g.method);g.paramSerializer=H(g.paramSerializer)?l.get(g.paramSerializer):g.paramSerializer;var h=[],m=[],p=k.when(g);q(J,function(a){(a.request||a.requestError)&&h.unshift(a.request,a.requestError);(a.response||a.responseError)&&m.push(a.response,a.responseError)});p=c(p,h);p=p.then(function(b){var c=b.headers,d=od(b.data,nd(c),void 0,b.transformRequest);z(d)&&q(c,function(a,b){"content-type"===P(b)&&delete c[b]});z(b.withCredentials)&&!z(a.withCredentials)&&(b.withCredentials=a.withCredentials);return n(b,d).then(f,f)});p=c(p,m);d?(p.success=function(a){Pa(a,"fn");p.then(function(b){a(b.data,b.status,b.headers,g)});return p},p.error=function(a){Pa(a,"fn");p.then(null,function(b){a(b.data,b.status,b.headers,g)});return p}):(p.success=pd("success"),p.error=pd("error"));return p}function n(c,d){function g(a){if(a){var c={};q(a,function(a,d){c[d]=function(c){function d(){a(c)}b?h.$applyAsync(d):h.$$phase?d():h.$apply(d)}});return c}}function l(a,c,d,e){function f(){n(c,a,d,e)}A&&(200<=a&&300>a?A.put(M,[a,c,md(d),e]):A.remove(M));b?h.$applyAsync(f):(f(),h.$$phase||h.$apply())}function n(a,b,d,e){b=-1<=b?b:0;(200<=b&&300>b?L.resolve:L.reject)({data:a,status:b,headers:nd(d),config:c,statusText:e})}function J(a){n(a.data,a.status,ia(a.headers()),a.statusText)}function O(){var a=m.pendingRequests.indexOf(c);-1!==a&&m.pendingRequests.splice(a,1)}var L=k.defer(),Q=L.promise,A,G,v=c.headers,M=p(c.url,c.paramSerializer(c.params));m.pendingRequests.push(c);Q.then(O,O);!c.cache&&!a.cache||!1===c.cache||"GET"!==c.method&&"JSONP"!==c.method||(A=I(c.cache)?c.cache:I(a.cache)?a.cache:x);A&&(G=A.get(M),u(G)?G&&F(G.then)?G.then(J,J):K(G)?n(G[1],G[0],ia(G[2]),G[3]):n(G,200,{},"OK"):A.put(M,Q));z(G)&&((G=qd(c.url)?f()[c.xsrfCookieName||a.xsrfCookieName]:void 0)&&(v[c.xsrfHeaderName||a.xsrfHeaderName]=G),e(c.method,M,d,l,v,c.timeout,c.withCredentials,c.responseType,g(c.eventHandlers),g(c.uploadEventHandlers)));return Q}function p(a,b){0<b.length&&(a+=(-1===a.indexOf("?")?"?":"&")+b);return a}var x=g("$http");a.paramSerializer=H(a.paramSerializer)?l.get(a.paramSerializer):a.paramSerializer;var J=[];q(c,function(a){J.unshift(H(a)?l.get(a):l.invoke(a))});m.pendingRequests=[];(function(a){q(arguments,function(a){m[a]=function(b,c){return m(R({},c||{},{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){q(arguments,function(a){m[a]=function(b,c,d){return m(R({},d||{},{method:a,url:b,data:c}))}})})("post","put","patch");m.defaults=a;return m}]}function Ff(){this.$get=function(){return function(){return new B.XMLHttpRequest}}}function Ef(){this.$get=["$browser","$jsonpCallbacks","$document","$xhrFactory",function(a,b,d,c){return ug(a,c,a.defer,b,d[0])}]}function ug(a,b,d,c,e){function f(a,b,d){a=a.replace("JSON_CALLBACK",b);var f=e.createElement("script"),m=null;f.type="text/javascript";f.src=a;f.async=!0;m=function(a){f.removeEventListener("load",m,!1);f.removeEventListener("error",m,!1);e.body.removeChild(f);f=null;var g=-1,x="unknown";a&&("load"!==a.type||c.wasCalled(b)||(a={type:"error"}),x=a.type,g="error"===a.type?404:200);d&&d(g,x)};f.addEventListener("load",m,!1);f.addEventListener("error",m,!1);e.body.appendChild(f);return m}return function(e,h,k,l,m,n,p,x,J,t){function s(){ib&&ib();w&&w.abort()}function D(b,c,e,f,g){u(L)&&d.cancel(L);ib=w=null;b(c,e,f,g);a.$$completeOutstandingRequest(C)}a.$$incOutstandingRequestCount();h=h||a.url();if("jsonp"===P(e))var y=c.createCallback(h),ib=f(h,y,function(a,b){var d=200===a&&c.getResponse(y);D(l,a,d,"",b);c.removeCallback(y)});else{var w=b(e,h);w.open(e,h,!0);q(m,function(a,b){u(a)&&w.setRequestHeader(b,a)});w.onload=function(){var a=w.statusText||"",b="response"in w?w.response:w.responseText,c=1223===w.status?204:w.status;0===c&&(c=b?200:"file"===Ca(h).protocol?404:0);D(l,c,b,w.getAllResponseHeaders(),a)};e=function(){D(l,-1,null,null,"")};w.onerror=e;w.onabort=e;w.ontimeout=e;q(J,function(a,b){w.addEventListener(b,a)});q(t,function(a,b){w.upload.addEventListener(b,a)});p&&(w.withCredentials=!0);if(x)try{w.responseType=x}catch(O){if("json"!==x)throw O}w.send(z(k)?null:k)}if(0<n)var L=d(s,n);else n&&F(n.then)&&n.then(s)}}function zf(){var a="{{",b="}}";this.startSymbol=function(b){return b?(a=b,this):a};this.endSymbol=function(a){return a?(b=a,this):b};this.$get=["$parse","$exceptionHandler","$sce",function(d,c,e){function f(a){return"\\\\\\"+a}function g(c){return c.replace(n,a).replace(p,b)}function h(a,b,c,d){var e=a.$watch(function(a){e();return d(a)},b,c);return e}function k(f,k,p,n){function D(a){try{var b=a;a=p?e.getTrusted(p,b):e.valueOf(b);var d;if(n&&!u(a))d=a;else if(null==a)d="";else{switch(typeof a){case"string":break;case"number":a=""+a;break;default:a=db(a)}d=a}return d}catch(g){c(Ka.interr(f,g))}}if(!f.length||-1===f.indexOf(a)){var y;k||(k=g(f),y=ma(k),y.exp=f,y.expressions=[],y.$$watchDelegate=h);return y}n=!!n;var q,w,O=0,L=[],Q=[];y=f.length;for(var A=[],G=[];O<y;)if(-1!==(q=f.indexOf(a,O))&&-1!==(w=f.indexOf(b,q+l)))O!==q&&A.push(g(f.substring(O,q))),O=f.substring(q+l,w),L.push(O),Q.push(d(O,D)),O=w+m,G.push(A.length),A.push("");else{O!==y&&A.push(g(f.substring(O)));break}p&&1<A.length&&Ka.throwNoconcat(f);if(!k||L.length){var v=function(a){for(var b=0,c=L.length;b<c;b++){if(n&&z(a[b]))return;A[G[b]]=a[b]}return A.join("")};return R(function(a){var b=0,d=L.length,e=Array(d);try{for(;b<d;b++)e[b]=Q[b](a);return v(e)}catch(g){c(Ka.interr(f,g))}},{exp:f,expressions:L,$$watchDelegate:function(a,b){var c;return a.$watchGroup(Q,function(d,e){var f=v(d);F(b)&&b.call(this,f,d!==e?c:f,a);c=f})}})}}var l=a.length,m=b.length,n=new RegExp(a.replace(/./g,f),"g"),p=new RegExp(b.replace(/./g,f),"g");k.startSymbol=function(){return a};k.endSymbol=function(){return b};return k}]}function Af(){this.$get=["$rootScope","$window","$q","$$q","$browser",function(a,b,d,c,e){function f(f,k,l,m){function n(){p?f.apply(null,x):f(s)}var p=4<arguments.length,x=p?ta.call(arguments,4):[],J=b.setInterval,t=b.clearInterval,s=0,D=u(m)&&!m,y=(D?c:d).defer(),q=y.promise;l=u(l)?l:0;q.$$intervalId=J(function(){D?e.defer(n):a.$evalAsync(n);y.notify(s++);0<l&&s>=l&&(y.resolve(s),t(q.$$intervalId),delete g[q.$$intervalId]);D||a.$apply()},k);g[q.$$intervalId]=y;return q}var g={};f.cancel=function(a){return a&&a.$$intervalId in g?(g[a.$$intervalId].reject("canceled"),b.clearInterval(a.$$intervalId),delete g[a.$$intervalId],!0):!1};return f}]}function kc(a){a=a.split("/");for(var b=a.length;b--;)a[b]=tb(a[b]);return a.join("/")}function rd(a,b){var d=Ca(a);b.$$protocol=d.protocol;b.$$host=d.hostname;b.$$port=aa(d.port)||vg[d.protocol]||null}function sd(a,b){if(wg.test(a))throw lb("badpath",a);var d="/"!==a.charAt(0);d&&(a="/"+a);var c=Ca(a);b.$$path=decodeURIComponent(d&&"/"===c.pathname.charAt(0)?c.pathname.substring(1):c.pathname);b.$$search=Hc(c.search);b.$$hash=decodeURIComponent(c.hash);b.$$path&&"/"!==b.$$path.charAt(0)&&(b.$$path="/"+b.$$path)}function ka(a,b){if(0===b.lastIndexOf(a,0))return b.substr(a.length)}function Ja(a){var b=a.indexOf("#");return-1===b?a:a.substr(0,b)}function mb(a){return a.replace(/(#.+)|#$/,"$1")}function lc(a,b,d){this.$$html5=!0;d=d||"";rd(a,this);this.$$parse=function(a){var d=ka(b,a);if(!H(d))throw lb("ipthprfx",a,b);sd(d,this);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var a=Wb(this.$$search),d=this.$$hash?"#"+tb(this.$$hash):"";this.$$url=kc(this.$$path)+(a?"?"+a:"")+d;this.$$absUrl=b+this.$$url.substr(1)};this.$$parseLinkUrl=function(c,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;u(f=ka(a,c))?(g=f,g=d&&u(f=ka(d,f))?b+(ka("/",f)||f):a+g):u(f=ka(b,c))?g=b+f:b===c+"/"&&(g=b);g&&this.$$parse(g);return!!g}}function mc(a,b,d){rd(a,this);this.$$parse=function(c){var e=ka(a,c)||ka(b,c),f;z(e)||"#"!==e.charAt(0)?this.$$html5?f=e:(f="",z(e)&&(a=c,this.replace())):(f=ka(d,e),z(f)&&(f=e));sd(f,this);c=this.$$path;var e=a,g=/^\/[A-Z]:(\/.*)/;0===f.lastIndexOf(e,0)&&(f=f.replace(e,""));g.exec(f)||(c=(f=g.exec(c))?f[1]:c);this.$$path=c;this.$$compose()};this.$$compose=function(){var b=Wb(this.$$search),e=this.$$hash?"#"+tb(this.$$hash):"";this.$$url=kc(this.$$path)+(b?"?"+b:"")+e;this.$$absUrl=a+(this.$$url?d+this.$$url:"")};this.$$parseLinkUrl=function(b,d){return Ja(a)===Ja(b)?(this.$$parse(b),!0):!1}}function td(a,b,d){this.$$html5=!0;mc.apply(this,arguments);this.$$parseLinkUrl=function(c,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;a===Ja(c)?f=c:(g=ka(b,c))?f=a+d+g:b===c+"/"&&(f=b);f&&this.$$parse(f);return!!f};this.$$compose=function(){var b=Wb(this.$$search),e=this.$$hash?"#"+tb(this.$$hash):"";this.$$url=kc(this.$$path)+(b?"?"+b:"")+e;this.$$absUrl=a+d+this.$$url}}function Jb(a){return function(){return this[a]}}function ud(a,b){return function(d){if(z(d))return this[a];this[a]=b(d);this.$$compose();return this}}function Hf(){var a="",b={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(b){return u(b)?(a=b,this):a};this.html5Mode=function(a){return Ia(a)?(b.enabled=a,this):I(a)?(Ia(a.enabled)&&(b.enabled=a.enabled),Ia(a.requireBase)&&(b.requireBase=a.requireBase),Ia(a.rewriteLinks)&&(b.rewriteLinks=a.rewriteLinks),this):b};this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function(d,c,e,f,g){function h(a,b,d){var e=l.url(),f=l.$$state;try{c.url(a,b,d),l.$$state=c.state()}catch(g){throw l.url(e),l.$$state=f,g}}function k(a,b){d.$broadcast("$locationChangeSuccess",l.absUrl(),a,l.$$state,b)}var l,m;m=c.baseHref();var n=c.url(),p;if(b.enabled){if(!m&&b.requireBase)throw lb("nobase");p=n.substring(0,n.indexOf("/",n.indexOf("//")+2))+(m||"/");m=e.history?lc:td}else p=Ja(n),m=mc;var x=p.substr(0,Ja(p).lastIndexOf("/")+1);l=new m(p,x,"#"+a);l.$$parseLinkUrl(n,n);l.$$state=c.state();var J=/^\s*(javascript|mailto):/i;f.on("click",function(a){if(b.rewriteLinks&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&2!==a.which&&2!==a.button){for(var e=E(a.target);"a"!==ua(e[0]);)if(e[0]===f[0]||!(e=e.parent())[0])return;var h=e.prop("href"),k=e.attr("href")||e.attr("xlink:href");I(h)&&"[object SVGAnimatedString]"===h.toString()&&(h=Ca(h.animVal).href);J.test(h)||!h||e.attr("target")||a.isDefaultPrevented()||!l.$$parseLinkUrl(h,k)||(a.preventDefault(),l.absUrl()!==c.url()&&(d.$apply(),g.angular["ff-684208-preventDefault"]=!0))}});mb(l.absUrl())!==mb(n)&&c.url(l.absUrl(),!0);var t=!0;c.onUrlChange(function(a,b){z(ka(x,a))?g.location.href=a:(d.$evalAsync(function(){var c=l.absUrl(),e=l.$$state,f;a=mb(a);l.$$parse(a);l.$$state=b;f=d.$broadcast("$locationChangeStart",a,c,b,e).defaultPrevented;l.absUrl()===a&&(f?(l.$$parse(c),l.$$state=e,h(c,!1,e)):(t=!1,k(c,e)))}),d.$$phase||d.$digest())});d.$watch(function(){var a=mb(c.url()),b=mb(l.absUrl()),f=c.state(),g=l.$$replace,m=a!==b||l.$$html5&&e.history&&f!==l.$$state;if(t||m)t=!1,d.$evalAsync(function(){var b=l.absUrl(),c=d.$broadcast("$locationChangeStart",b,a,l.$$state,f).defaultPrevented;l.absUrl()===b&&(c?(l.$$parse(a),l.$$state=f):(m&&h(b,g,f===l.$$state?null:l.$$state),k(a,f)))});l.$$replace=!1});return l}]}function If(){var a=!0,b=this;this.debugEnabled=function(b){return u(b)?(a=b,this):a};this.$get=["$window",function(d){function c(a){a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line));return a}function e(a){var b=d.console||{},e=b[a]||b.log||C;a=!1;try{a=!!e.apply}catch(k){}return a?function(){var a=[];q(arguments,function(b){a.push(c(b))});return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){a&&c.apply(b,arguments)}}()}}]}function Ta(a,b){if("__defineGetter__"===a||"__defineSetter__"===a||"__lookupGetter__"===a||"__lookupSetter__"===a||"__proto__"===a)throw ea("isecfld",b);return a}function xg(a){return a+""}function qa(a,b){if(a){if(a.constructor===a)throw ea("isecfn",b);if(a.window===a)throw ea("isecwindow",b);if(a.children&&(a.nodeName||a.prop&&a.attr&&a.find))throw ea("isecdom",b);if(a===Object)throw ea("isecobj",b)}return a}function vd(a,b){if(a){if(a.constructor===a)throw ea("isecfn",b);if(a===yg||a===zg||a===Ag)throw ea("isecff",b)}}function Kb(a,b){if(a&&(a===wd||a===xd||a===yd||a===zd||a===Ad||a===Bd||a===Bg||a===Cg||a===Lb||a===Dg||a===Cd||a===Eg))throw ea("isecaf",b)}function Fg(a,b){return"undefined"!==typeof a?a:b}function Dd(a,b){return"undefined"===typeof a?b:"undefined"===typeof b?a:a+b}function W(a,b){var d,c,e;switch(a.type){case r.Program:d=!0;q(a.body,function(a){W(a.expression,b);d=d&&a.expression.constant});a.constant=d;break;case r.Literal:a.constant=!0;a.toWatch=[];break;case r.UnaryExpression:W(a.argument,b);a.constant=a.argument.constant;a.toWatch=a.argument.toWatch;break;case r.BinaryExpression:W(a.left,b);W(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=a.left.toWatch.concat(a.right.toWatch);break;case r.LogicalExpression:W(a.left,b);W(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=a.constant?[]:[a];break;case r.ConditionalExpression:W(a.test,b);W(a.alternate,b);W(a.consequent,b);a.constant=a.test.constant&&a.alternate.constant&&a.consequent.constant;a.toWatch=a.constant?[]:[a];break;case r.Identifier:a.constant=!1;a.toWatch=[a];break;case r.MemberExpression:W(a.object,b);a.computed&&W(a.property,b);a.constant=a.object.constant&&(!a.computed||a.property.constant);a.toWatch=[a];break;case r.CallExpression:d=e=a.filter?!b(a.callee.name).$stateful:!1;c=[];q(a.arguments,function(a){W(a,b);d=d&&a.constant;a.constant||c.push.apply(c,a.toWatch)});a.constant=d;a.toWatch=e?c:[a];break;case r.AssignmentExpression:W(a.left,b);W(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=[a];break;case r.ArrayExpression:d=!0;c=[];q(a.elements,function(a){W(a,b);d=d&&a.constant;a.constant||c.push.apply(c,a.toWatch)});a.constant=d;a.toWatch=c;break;case r.ObjectExpression:d=!0;c=[];q(a.properties,function(a){W(a.value,b);d=d&&a.value.constant&&!a.computed;a.value.constant||c.push.apply(c,a.value.toWatch)});a.constant=d;a.toWatch=c;break;case r.ThisExpression:a.constant=!1;a.toWatch=[];break;case r.LocalsExpression:a.constant=!1,a.toWatch=[]}}function Ed(a){if(1===a.length){a=a[0].expression;var b=a.toWatch;return 1!==b.length?b:b[0]!==a?b:void 0}}function Fd(a){return a.type===r.Identifier||a.type===r.MemberExpression}function Gd(a){if(1===a.body.length&&Fd(a.body[0].expression))return{type:r.AssignmentExpression,left:a.body[0].expression,right:{type:r.NGValueParameter},operator:"="}}function Hd(a){return 0===a.body.length||1===a.body.length&&(a.body[0].expression.type===r.Literal||a.body[0].expression.type===r.ArrayExpression||a.body[0].expression.type===r.ObjectExpression)}function Id(a,b){this.astBuilder=a;this.$filter=b}function Jd(a,b){this.astBuilder=a;this.$filter=b}function Mb(a){return"constructor"===a}function nc(a){return F(a.valueOf)?a.valueOf():Gg.call(a)}function Jf(){var a=S(),b=S(),d={"true":!0,"false":!1,"null":null,undefined:void 0},c,e;this.addLiteral=function(a,b){d[a]=b};this.setIdentifierFns=function(a,b){c=a;e=b;return this};this.$get=["$filter",function(f){function g(c,d,e){var g,k,J;e=e||D;switch(typeof c){case"string":J=c=c.trim();var A=e?b:a;g=A[J];if(!g){":"===c.charAt(0)&&":"===c.charAt(1)&&(k=!0,c=c.substring(2));g=e?s:t;var G=new oc(g);g=new pc(G,f,g).parse(c);g.constant?g.$$watchDelegate=p:k?g.$$watchDelegate=g.literal?n:m:g.inputs&&(g.$$watchDelegate=l);e&&(g=h(g));A[J]=g}return x(g,d);case"function":return x(c,d);default:return x(C,d)}}function h(a){function b(c,d,e,f){var g=D;D=!0;try{return a(c,d,e,f)}finally{D=g}}if(!a)return a;b.$$watchDelegate=a.$$watchDelegate;b.assign=h(a.assign);b.constant=a.constant;b.literal=a.literal;for(var c=0;a.inputs&&c<a.inputs.length;++c)a.inputs[c]=h(a.inputs[c]);b.inputs=a.inputs;return b}function k(a,b){return null==a||null==b?a===b:"object"===typeof a&&(a=nc(a),"object"===typeof a)?!1:a===b||a!==a&&b!==b}function l(a,b,c,d,e){var f=d.inputs,g;if(1===f.length){var h=k,f=f[0];return a.$watch(function(a){var b=f(a);k(b,h)||(g=d(a,void 0,void 0,[b]),h=b&&nc(b));return g},b,c,e)}for(var l=[],m=[],p=0,n=f.length;p<n;p++)l[p]=k,m[p]=null;return a.$watch(function(a){for(var b=!1,c=0,e=f.length;c<e;c++){var h=f[c](a);if(b||(b=!k(h,l[c])))m[c]=h,l[c]=h&&nc(h)}b&&(g=d(a,void 0,void 0,m));return g},b,c,e)}function m(a,b,c,d){var e,f;return e=a.$watch(function(a){return d(a)},function(a,c,d){f=a;F(b)&&b.apply(this,arguments);u(a)&&d.$$postDigest(function(){u(f)&&e()})},c)}function n(a,b,c,d){function e(a){var b=!0;q(a,function(a){u(a)||(b=!1)});return b}var f,g;return f=a.$watch(function(a){return d(a)},function(a,c,d){g=a;F(b)&&b.call(this,a,c,d);e(a)&&d.$$postDigest(function(){e(g)&&f()})},c)}function p(a,b,c,d){var e=a.$watch(function(a){e();return d(a)},b,c);return e}function x(a,b){if(!b)return a;var c=a.$$watchDelegate,d=!1,c=c!==n&&c!==m?function(c,e,f,g){f=d&&g?g[0]:a(c,e,f,g);return b(f,c,e)}:function(c,d,e,f){e=a(c,d,e,f);c=b(e,c,d);return u(e)?c:e};a.$$watchDelegate&&a.$$watchDelegate!==l?c.$$watchDelegate=a.$$watchDelegate:b.$stateful||(c.$$watchDelegate=l,d=!a.inputs,c.inputs=a.inputs?a.inputs:[a]);return c}var J=ya().noUnsafeEval,t={csp:J,expensiveChecks:!1,literals:pa(d),isIdentifierStart:F(c)&&c,isIdentifierContinue:F(e)&&e},s={csp:J,expensiveChecks:!0,literals:pa(d),isIdentifierStart:F(c)&&c,isIdentifierContinue:F(e)&&e},D=!1;g.$$runningExpensiveChecks=function(){return D};return g}]}function Lf(){this.$get=["$rootScope","$exceptionHandler",function(a,b){return Kd(function(b){a.$evalAsync(b)},b)}]}function Mf(){this.$get=["$browser","$exceptionHandler",function(a,b){return Kd(function(b){a.defer(b)},b)}]}function Kd(a,b){
function d(){this.$$state={status:0}}function c(a,b){return function(c){b.call(a,c)}}function e(c){!c.processScheduled&&c.pending&&(c.processScheduled=!0,a(function(){var a,d,e;e=c.pending;c.processScheduled=!1;c.pending=void 0;for(var f=0,g=e.length;f<g;++f){d=e[f][0];a=e[f][c.status];try{F(a)?d.resolve(a(c.value)):1===c.status?d.resolve(c.value):d.reject(c.value)}catch(h){d.reject(h),b(h)}}}))}function f(){this.promise=new d}var g=N("$q",TypeError),h=function(){var a=new f;a.resolve=c(a,a.resolve);a.reject=c(a,a.reject);a.notify=c(a,a.notify);return a};R(d.prototype,{then:function(a,b,c){if(z(a)&&z(b)&&z(c))return this;var d=new f;this.$$state.pending=this.$$state.pending||[];this.$$state.pending.push([d,a,b,c]);0<this.$$state.status&&e(this.$$state);return d.promise},"catch":function(a){return this.then(null,a)},"finally":function(a,b){return this.then(function(b){return l(b,!0,a)},function(b){return l(b,!1,a)},b)}});R(f.prototype,{resolve:function(a){this.promise.$$state.status||(a===this.promise?this.$$reject(g("qcycle",a)):this.$$resolve(a))},$$resolve:function(a){function d(a){k||(k=!0,h.$$resolve(a))}function f(a){k||(k=!0,h.$$reject(a))}var g,h=this,k=!1;try{if(I(a)||F(a))g=a&&a.then;F(g)?(this.promise.$$state.status=-1,g.call(a,d,f,c(this,this.notify))):(this.promise.$$state.value=a,this.promise.$$state.status=1,e(this.promise.$$state))}catch(l){f(l),b(l)}},reject:function(a){this.promise.$$state.status||this.$$reject(a)},$$reject:function(a){this.promise.$$state.value=a;this.promise.$$state.status=2;e(this.promise.$$state)},notify:function(c){var d=this.promise.$$state.pending;0>=this.promise.$$state.status&&d&&d.length&&a(function(){for(var a,e,f=0,g=d.length;f<g;f++){e=d[f][0];a=d[f][3];try{e.notify(F(a)?a(c):c)}catch(h){b(h)}}})}});var k=function(a,b){var c=new f;b?c.resolve(a):c.reject(a);return c.promise},l=function(a,b,c){var d=null;try{F(c)&&(d=c())}catch(e){return k(e,!1)}return d&&F(d.then)?d.then(function(){return k(a,b)},function(a){return k(a,!1)}):k(a,b)},m=function(a,b,c,d){var e=new f;e.resolve(a);return e.promise.then(b,c,d)},n=function(a){if(!F(a))throw g("norslvr",a);var b=new f;a(function(a){b.resolve(a)},function(a){b.reject(a)});return b.promise};n.prototype=d.prototype;n.defer=h;n.reject=function(a){var b=new f;b.reject(a);return b.promise};n.when=m;n.resolve=m;n.all=function(a){var b=new f,c=0,d=K(a)?[]:{};q(a,function(a,e){c++;m(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise};n.race=function(a){var b=h();q(a,function(a){m(a).then(b.resolve,b.reject)});return b.promise};return n}function Vf(){this.$get=["$window","$timeout",function(a,b){var d=a.requestAnimationFrame||a.webkitRequestAnimationFrame,c=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame,e=!!d,f=e?function(a){var b=d(a);return function(){c(b)}}:function(a){var c=b(a,16.66,!1);return function(){b.cancel(c)}};f.supported=e;return f}]}function Kf(){function a(a){function b(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=0;this.$id=++sb;this.$$ChildScope=null}b.prototype=a;return b}var b=10,d=N("$rootScope"),c=null,e=null;this.digestTtl=function(a){arguments.length&&(b=a);return b};this.$get=["$exceptionHandler","$parse","$browser",function(f,g,h){function k(a){a.currentScope.$$destroyed=!0}function l(a){9===Fa&&(a.$$childHead&&l(a.$$childHead),a.$$nextSibling&&l(a.$$nextSibling));a.$parent=a.$$nextSibling=a.$$prevSibling=a.$$childHead=a.$$childTail=a.$root=a.$$watchers=null}function m(){this.$id=++sb;this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this.$root=this;this.$$destroyed=!1;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=0;this.$$isolateBindings=null}function n(a){if(D.$$phase)throw d("inprog",D.$$phase);D.$$phase=a}function p(a,b){do a.$$watchersCount+=b;while(a=a.$parent)}function x(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function J(){}function t(){for(;w.length;)try{w.shift()()}catch(a){f(a)}e=null}function s(){null===e&&(e=h.defer(function(){D.$apply(t)}))}m.prototype={constructor:m,$new:function(b,c){var d;c=c||this;b?(d=new m,d.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=a(this)),d=new this.$$ChildScope);d.$parent=c;d.$$prevSibling=c.$$childTail;c.$$childHead?(c.$$childTail.$$nextSibling=d,c.$$childTail=d):c.$$childHead=c.$$childTail=d;(b||c!==this)&&d.$on("$destroy",k);return d},$watch:function(a,b,d,e){var f=g(a);if(f.$$watchDelegate)return f.$$watchDelegate(this,b,d,f,a);var h=this,k=h.$$watchers,l={fn:b,last:J,get:f,exp:e||a,eq:!!d};c=null;F(b)||(l.fn=C);k||(k=h.$$watchers=[]);k.unshift(l);p(this,1);return function(){0<=ab(k,l)&&p(h,-1);c=null}},$watchGroup:function(a,b){function c(){h=!1;k?(k=!1,b(e,e,g)):b(e,d,g)}var d=Array(a.length),e=Array(a.length),f=[],g=this,h=!1,k=!0;if(!a.length){var l=!0;g.$evalAsync(function(){l&&b(e,e,g)});return function(){l=!1}}if(1===a.length)return this.$watch(a[0],function(a,c,f){e[0]=a;d[0]=c;b(e,a===c?e:d,f)});q(a,function(a,b){var k=g.$watch(a,function(a,f){e[b]=a;d[b]=f;h||(h=!0,g.$evalAsync(c))});f.push(k)});return function(){for(;f.length;)f.shift()()}},$watchCollection:function(a,b){function c(a){e=a;var b,d,g,h;if(!z(e)){if(I(e))if(ra(e))for(f!==n&&(f=n,s=f.length=0,l++),a=e.length,s!==a&&(l++,f.length=s=a),b=0;b<a;b++)h=f[b],g=e[b],d=h!==h&&g!==g,d||h===g||(l++,f[b]=g);else{f!==p&&(f=p={},s=0,l++);a=0;for(b in e)sa.call(e,b)&&(a++,g=e[b],h=f[b],b in f?(d=h!==h&&g!==g,d||h===g||(l++,f[b]=g)):(s++,f[b]=g,l++));if(s>a)for(b in l++,f)sa.call(e,b)||(s--,delete f[b])}else f!==e&&(f=e,l++);return l}}c.$stateful=!0;var d=this,e,f,h,k=1<b.length,l=0,m=g(a,c),n=[],p={},x=!0,s=0;return this.$watch(m,function(){x?(x=!1,b(e,e,d)):b(e,h,d);if(k)if(I(e))if(ra(e)){h=Array(e.length);for(var a=0;a<e.length;a++)h[a]=e[a]}else for(a in h={},e)sa.call(e,a)&&(h[a]=e[a]);else h=e})},$digest:function(){var a,g,k,l,m,p,x,s,q=b,w,u=[],z,C;n("$digest");h.$$checkUrlChange();this===D&&null!==e&&(h.defer.cancel(e),t());c=null;do{s=!1;w=this;for(p=0;p<y.length;p++){try{C=y[p],C.scope.$eval(C.expression,C.locals)}catch(B){f(B)}c=null}y.length=0;a:do{if(p=w.$$watchers)for(x=p.length;x--;)try{if(a=p[x])if(m=a.get,(g=m(w))!==(k=a.last)&&!(a.eq?oa(g,k):X(g)&&X(k)))s=!0,c=a,a.last=a.eq?pa(g,null):g,l=a.fn,l(g,k===J?g:k,w),5>q&&(z=4-q,u[z]||(u[z]=[]),u[z].push({msg:F(a.exp)?"fn: "+(a.exp.name||a.exp.toString()):a.exp,newVal:g,oldVal:k}));else if(a===c){s=!1;break a}}catch(E){f(E)}if(!(p=w.$$watchersCount&&w.$$childHead||w!==this&&w.$$nextSibling))for(;w!==this&&!(p=w.$$nextSibling);)w=w.$parent}while(w=p);if((s||y.length)&&!q--)throw D.$$phase=null,d("infdig",b,u)}while(s||y.length);for(D.$$phase=null;O<r.length;)try{r[O++]()}catch(H){f(H)}r.length=O=0},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");this.$$destroyed=!0;this===D&&h.$$applicationDestroyed();p(this,-this.$$watchersCount);for(var b in this.$$listenerCount)x(this,this.$$listenerCount[b],b);a&&a.$$childHead===this&&(a.$$childHead=this.$$nextSibling);a&&a.$$childTail===this&&(a.$$childTail=this.$$prevSibling);this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling);this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling);this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=C;this.$on=this.$watch=this.$watchGroup=function(){return C};this.$$listeners={};this.$$nextSibling=null;l(this)}},$eval:function(a,b){return g(a)(this,b)},$evalAsync:function(a,b){D.$$phase||y.length||h.defer(function(){y.length&&D.$digest()});y.push({scope:this,expression:g(a),locals:b})},$$postDigest:function(a){r.push(a)},$apply:function(a){try{n("$apply");try{return this.$eval(a)}finally{D.$$phase=null}}catch(b){f(b)}finally{try{D.$digest()}catch(c){throw f(c),c}}},$applyAsync:function(a){function b(){c.$eval(a)}var c=this;a&&w.push(b);a=g(a);s()},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){var d=c.indexOf(b);-1!==d&&(c[d]=null,x(e,1,a))}},$emit:function(a,b){var c=[],d,e=this,g=!1,h={name:a,targetScope:e,stopPropagation:function(){g=!0},preventDefault:function(){h.defaultPrevented=!0},defaultPrevented:!1},k=bb([h],arguments,1),l,m;do{d=e.$$listeners[a]||c;h.currentScope=e;l=0;for(m=d.length;l<m;l++)if(d[l])try{d[l].apply(null,k)}catch(n){f(n)}else d.splice(l,1),l--,m--;if(g)return h.currentScope=null,h;e=e.$parent}while(e);h.currentScope=null;return h},$broadcast:function(a,b){var c=this,d=this,e={name:a,targetScope:this,preventDefault:function(){e.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[a])return e;for(var g=bb([e],arguments,1),h,k;c=d;){e.currentScope=c;d=c.$$listeners[a]||[];h=0;for(k=d.length;h<k;h++)if(d[h])try{d[h].apply(null,g)}catch(l){f(l)}else d.splice(h,1),h--,k--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}e.currentScope=null;return e}};var D=new m,y=D.$$asyncQueue=[],r=D.$$postDigestQueue=[],w=D.$$applyAsyncQueue=[],O=0;return D}]}function De(){var a=/^\s*(https?|ftp|mailto|tel|file):/,b=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(b){return u(b)?(a=b,this):a};this.imgSrcSanitizationWhitelist=function(a){return u(a)?(b=a,this):b};this.$get=function(){return function(d,c){var e=c?b:a,f;f=Ca(d).href;return""===f||f.match(e)?d:"unsafe:"+f}}}function Hg(a){if("self"===a)return a;if(H(a)){if(-1<a.indexOf("***"))throw fa("iwcard",a);a=Ld(a).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return new RegExp("^"+a+"$")}if(Ya(a))return new RegExp("^"+a.source+"$");throw fa("imatcher")}function Md(a){var b=[];u(a)&&q(a,function(a){b.push(Hg(a))});return b}function Of(){this.SCE_CONTEXTS=la;var a=["self"],b=[];this.resourceUrlWhitelist=function(b){arguments.length&&(a=Md(b));return a};this.resourceUrlBlacklist=function(a){arguments.length&&(b=Md(a));return b};this.$get=["$injector",function(d){function c(a,b){return"self"===a?qd(b):!!a.exec(b.href)}function e(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};a&&(b.prototype=new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};return b}var f=function(a){throw fa("unsafe")};d.has("$sanitize")&&(f=d.get("$sanitize"));var g=e(),h={};h[la.HTML]=e(g);h[la.CSS]=e(g);h[la.URL]=e(g);h[la.JS]=e(g);h[la.RESOURCE_URL]=e(h[la.URL]);return{trustAs:function(a,b){var c=h.hasOwnProperty(a)?h[a]:null;if(!c)throw fa("icontext",a,b);if(null===b||z(b)||""===b)return b;if("string"!==typeof b)throw fa("itype",a);return new c(b)},getTrusted:function(d,e){if(null===e||z(e)||""===e)return e;var g=h.hasOwnProperty(d)?h[d]:null;if(g&&e instanceof g)return e.$$unwrapTrustedValue();if(d===la.RESOURCE_URL){var g=Ca(e.toString()),n,p,x=!1;n=0;for(p=a.length;n<p;n++)if(c(a[n],g)){x=!0;break}if(x)for(n=0,p=b.length;n<p;n++)if(c(b[n],g)){x=!1;break}if(x)return e;throw fa("insecurl",e.toString())}if(d===la.HTML)return f(e);throw fa("unsafe")},valueOf:function(a){return a instanceof g?a.$$unwrapTrustedValue():a}}}]}function Nf(){var a=!0;this.enabled=function(b){arguments.length&&(a=!!b);return a};this.$get=["$parse","$sceDelegate",function(b,d){if(a&&8>Fa)throw fa("iequirks");var c=ia(la);c.isEnabled=function(){return a};c.trustAs=d.trustAs;c.getTrusted=d.getTrusted;c.valueOf=d.valueOf;a||(c.trustAs=c.getTrusted=function(a,b){return b},c.valueOf=Za);c.parseAs=function(a,d){var e=b(d);return e.literal&&e.constant?e:b(d,function(b){return c.getTrusted(a,b)})};var e=c.parseAs,f=c.getTrusted,g=c.trustAs;q(la,function(a,b){var d=P(b);c[fb("parse_as_"+d)]=function(b){return e(a,b)};c[fb("get_trusted_"+d)]=function(b){return f(a,b)};c[fb("trust_as_"+d)]=function(b){return g(a,b)}});return c}]}function Pf(){this.$get=["$window","$document",function(a,b){var d={},c=!(a.chrome&&(a.chrome.app&&a.chrome.app.runtime||!a.chrome.app&&a.chrome.runtime&&a.chrome.runtime.id))&&a.history&&a.history.pushState,e=aa((/android (\d+)/.exec(P((a.navigator||{}).userAgent))||[])[1]),f=/Boxee/i.test((a.navigator||{}).userAgent),g=b[0]||{},h,k=/^(Moz|webkit|ms)(?=[A-Z])/,l=g.body&&g.body.style,m=!1,n=!1;if(l){for(var p in l)if(m=k.exec(p)){h=m[0];h=h[0].toUpperCase()+h.substr(1);break}h||(h="WebkitOpacity"in l&&"webkit");m=!!("transition"in l||h+"Transition"in l);n=!!("animation"in l||h+"Animation"in l);!e||m&&n||(m=H(l.webkitTransition),n=H(l.webkitAnimation))}return{history:!(!c||4>e||f),hasEvent:function(a){if("input"===a&&11>=Fa)return!1;if(z(d[a])){var b=g.createElement("div");d[a]="on"+a in b}return d[a]},csp:ya(),vendorPrefix:h,transitions:m,animations:n,android:e}}]}function Rf(){var a;this.httpOptions=function(b){return b?(a=b,this):a};this.$get=["$templateCache","$http","$q","$sce",function(b,d,c,e){function f(g,h){f.totalPendingRequests++;if(!H(g)||z(b.get(g)))g=e.getTrustedResourceUrl(g);var k=d.defaults&&d.defaults.transformResponse;K(k)?k=k.filter(function(a){return a!==ic}):k===ic&&(k=null);return d.get(g,R({cache:b,transformResponse:k},a))["finally"](function(){f.totalPendingRequests--}).then(function(a){b.put(g,a.data);return a.data},function(a){if(!h)throw Ig("tpload",g,a.status,a.statusText);return c.reject(a)})}f.totalPendingRequests=0;return f}]}function Sf(){this.$get=["$rootScope","$browser","$location",function(a,b,d){return{findBindings:function(a,b,d){a=a.getElementsByClassName("ng-binding");var g=[];q(a,function(a){var c=ga.element(a).data("$binding");c&&q(c,function(c){d?new RegExp("(^|\\s)"+Ld(b)+"(\\s|\\||$)").test(c)&&g.push(a):-1!==c.indexOf(b)&&g.push(a)})});return g},findModels:function(a,b,d){for(var g=["ng-","data-ng-","ng\\:"],h=0;h<g.length;++h){var k=a.querySelectorAll("["+g[h]+"model"+(d?"=":"*=")+'"'+b+'"]');if(k.length)return k}},getLocation:function(){return d.url()},setLocation:function(b){b!==d.url()&&(d.url(b),a.$digest())},whenStable:function(a){b.notifyWhenNoOutstandingRequests(a)}}}]}function Tf(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function(a,b,d,c,e){function f(f,k,l){F(f)||(l=k,k=f,f=C);var m=ta.call(arguments,3),n=u(l)&&!l,p=(n?c:d).defer(),x=p.promise,q;q=b.defer(function(){try{p.resolve(f.apply(null,m))}catch(b){p.reject(b),e(b)}finally{delete g[x.$$timeoutId]}n||a.$apply()},k);x.$$timeoutId=q;g[q]=p;return x}var g={};f.cancel=function(a){return a&&a.$$timeoutId in g?(g[a.$$timeoutId].reject("canceled"),delete g[a.$$timeoutId],b.defer.cancel(a.$$timeoutId)):!1};return f}]}function Ca(a){Fa&&(V.setAttribute("href",a),a=V.href);V.setAttribute("href",a);return{href:V.href,protocol:V.protocol?V.protocol.replace(/:$/,""):"",host:V.host,search:V.search?V.search.replace(/^\?/,""):"",hash:V.hash?V.hash.replace(/^#/,""):"",hostname:V.hostname,port:V.port,pathname:"/"===V.pathname.charAt(0)?V.pathname:"/"+V.pathname}}function qd(a){a=H(a)?Ca(a):a;return a.protocol===Nd.protocol&&a.host===Nd.host}function Uf(){this.$get=ma(B)}function Od(a){function b(a){try{return decodeURIComponent(a)}catch(b){return a}}var d=a[0]||{},c={},e="";return function(){var a,g,h,k,l;a=d.cookie||"";if(a!==e)for(e=a,a=e.split("; "),c={},h=0;h<a.length;h++)g=a[h],k=g.indexOf("="),0<k&&(l=b(g.substring(0,k)),z(c[l])&&(c[l]=b(g.substring(k+1))));return c}}function Yf(){this.$get=Od}function Tc(a){function b(d,c){if(I(d)){var e={};q(d,function(a,c){e[c]=b(c,a)});return e}return a.factory(d+"Filter",c)}this.register=b;this.$get=["$injector",function(a){return function(b){return a.get(b+"Filter")}}];b("currency",Pd);b("date",Qd);b("filter",Jg);b("json",Kg);b("limitTo",Lg);b("lowercase",Mg);b("number",Rd);b("orderBy",Sd);b("uppercase",Ng)}function Jg(){return function(a,b,d,c){if(!ra(a)){if(null==a)return a;throw N("filter")("notarray",a)}c=c||"$";var e;switch(qc(b)){case"function":break;case"boolean":case"null":case"number":case"string":e=!0;case"object":b=Og(b,d,c,e);break;default:return a}return Array.prototype.filter.call(a,b)}}function Og(a,b,d,c){var e=I(a)&&d in a;!0===b?b=oa:F(b)||(b=function(a,b){if(z(a))return!1;if(null===a||null===b)return a===b;if(I(b)||I(a)&&!Cc(a))return!1;a=P(""+a);b=P(""+b);return-1!==a.indexOf(b)});return function(f){return e&&!I(f)?La(f,a[d],b,d,!1):La(f,a,b,d,c)}}function La(a,b,d,c,e,f){var g=qc(a),h=qc(b);if("string"===h&&"!"===b.charAt(0))return!La(a,b.substring(1),d,c,e);if(K(a))return a.some(function(a){return La(a,b,d,c,e)});switch(g){case"object":var k;if(e){for(k in a)if("$"!==k.charAt(0)&&La(a[k],b,d,c,!0))return!0;return f?!1:La(a,b,d,c,!1)}if("object"===h){for(k in b)if(f=b[k],!F(f)&&!z(f)&&(g=k===c,!La(g?a:a[k],f,d,c,g,g)))return!1;return!0}return d(a,b);case"function":return!1;default:return d(a,b)}}function qc(a){return null===a?"null":typeof a}function Pd(a){var b=a.NUMBER_FORMATS;return function(a,c,e){z(c)&&(c=b.CURRENCY_SYM);z(e)&&(e=b.PATTERNS[1].maxFrac);return null==a?a:Td(a,b.PATTERNS[1],b.GROUP_SEP,b.DECIMAL_SEP,e).replace(/\u00A4/g,c)}}function Rd(a){var b=a.NUMBER_FORMATS;return function(a,c){return null==a?a:Td(a,b.PATTERNS[0],b.GROUP_SEP,b.DECIMAL_SEP,c)}}function Pg(a){var b=0,d,c,e,f,g;-1<(c=a.indexOf(Ud))&&(a=a.replace(Ud,""));0<(e=a.search(/e/i))?(0>c&&(c=e),c+=+a.slice(e+1),a=a.substring(0,e)):0>c&&(c=a.length);for(e=0;a.charAt(e)===rc;e++);if(e===(g=a.length))d=[0],c=1;else{for(g--;a.charAt(g)===rc;)g--;c-=e;d=[];for(f=0;e<=g;e++,f++)d[f]=+a.charAt(e)}c>Vd&&(d=d.splice(0,Vd-1),b=c-1,c=1);return{d:d,e:b,i:c}}function Qg(a,b,d,c){var e=a.d,f=e.length-a.i;b=z(b)?Math.min(Math.max(d,f),c):+b;d=b+a.i;c=e[d];if(0<d){e.splice(Math.max(a.i,d));for(var g=d;g<e.length;g++)e[g]=0}else for(f=Math.max(0,f),a.i=1,e.length=Math.max(1,d=b+1),e[0]=0,g=1;g<d;g++)e[g]=0;if(5<=c)if(0>d-1){for(c=0;c>d;c--)e.unshift(0),a.i++;e.unshift(1);a.i++}else e[d-1]++;for(;f<Math.max(0,b);f++)e.push(0);if(b=e.reduceRight(function(a,b,c,d){b+=a;d[c]=b%10;return Math.floor(b/10)},0))e.unshift(b),a.i++}function Td(a,b,d,c,e){if(!H(a)&&!Z(a)||isNaN(a))return"";var f=!isFinite(a),g=!1,h=Math.abs(a)+"",k="";if(f)k="∞";else{g=Pg(h);Qg(g,e,b.minFrac,b.maxFrac);k=g.d;h=g.i;e=g.e;f=[];for(g=k.reduce(function(a,b){return a&&!b},!0);0>h;)k.unshift(0),h++;0<h?f=k.splice(h,k.length):(f=k,k=[0]);h=[];for(k.length>=b.lgSize&&h.unshift(k.splice(-b.lgSize,k.length).join(""));k.length>b.gSize;)h.unshift(k.splice(-b.gSize,k.length).join(""));k.length&&h.unshift(k.join(""));k=h.join(d);f.length&&(k+=c+f.join(""));e&&(k+="e+"+e)}return 0>a&&!g?b.negPre+k+b.negSuf:b.posPre+k+b.posSuf}function Nb(a,b,d,c){var e="";if(0>a||c&&0>=a)c?a=-a+1:(a=-a,e="-");for(a=""+a;a.length<b;)a=rc+a;d&&(a=a.substr(a.length-b));return e+a}function Y(a,b,d,c,e){d=d||0;return function(f){f=f["get"+a]();if(0<d||f>-d)f+=d;0===f&&-12===d&&(f=12);return Nb(f,b,c,e)}}function nb(a,b,d){return function(c,e){var f=c["get"+a](),g=xb((d?"STANDALONE":"")+(b?"SHORT":"")+a);return e[g][f]}}function Wd(a){var b=new Date(a,0,1).getDay();return new Date(a,0,(4>=b?5:12)-b)}function Xd(a){return function(b){var d=Wd(b.getFullYear());b=+new Date(b.getFullYear(),b.getMonth(),b.getDate()+(4-b.getDay()))-+d;b=1+Math.round(b/6048e5);return Nb(b,a)}}function sc(a,b){return 0>=a.getFullYear()?b.ERAS[0]:b.ERAS[1]}function Qd(a){function b(a){var b;if(b=a.match(d)){a=new Date(0);var f=0,g=0,h=b[8]?a.setUTCFullYear:a.setFullYear,k=b[8]?a.setUTCHours:a.setHours;b[9]&&(f=aa(b[9]+b[10]),g=aa(b[9]+b[11]));h.call(a,aa(b[1]),aa(b[2])-1,aa(b[3]));f=aa(b[4]||0)-f;g=aa(b[5]||0)-g;h=aa(b[6]||0);b=Math.round(1e3*parseFloat("0."+(b[7]||0)));k.call(a,f,g,h,b)}return a}var d=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,d,f){var g="",h=[],k,l;d=d||"mediumDate";d=a.DATETIME_FORMATS[d]||d;H(c)&&(c=Rg.test(c)?aa(c):b(c));Z(c)&&(c=new Date(c));if(!ba(c)||!isFinite(c.getTime()))return c;for(;d;)(l=Sg.exec(d))?(h=bb(h,l,1),d=h.pop()):(h.push(d),d=null);var m=c.getTimezoneOffset();f&&(m=Fc(f,m),c=Vb(c,f,!0));q(h,function(b){k=Tg[b];g+=k?k(c,a.DATETIME_FORMATS,m):"''"===b?"'":b.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return g}}function Kg(){return function(a,b){z(b)&&(b=2);return db(a,b)}}function Lg(){return function(a,b,d){b=Infinity===Math.abs(Number(b))?Number(b):aa(b);if(X(b))return a;Z(a)&&(a=a.toString());if(!ra(a))return a;d=!d||isNaN(d)?0:aa(d);d=0>d?Math.max(0,a.length+d):d;return 0<=b?tc(a,d,d+b):0===d?tc(a,b,a.length):tc(a,Math.max(0,d+b),d)}}function tc(a,b,d){return H(a)?a.slice(b,d):ta.call(a,b,d)}function Sd(a){function b(b){return b.map(function(b){var c=1,d=Za;if(F(b))d=b;else if(H(b)){if("+"===b.charAt(0)||"-"===b.charAt(0))c="-"===b.charAt(0)?-1:1,b=b.substring(1);if(""!==b&&(d=a(b),d.constant))var e=d(),d=function(a){return a[e]}}return{get:d,descending:c}})}function d(a){switch(typeof a){case"number":case"boolean":case"string":return!0;default:return!1}}function c(a,b){var c=0,d=a.type,k=b.type;if(d===k){var k=a.value,l=b.value;"string"===d?(k=k.toLowerCase(),l=l.toLowerCase()):"object"===d&&(I(k)&&(k=a.index),I(l)&&(l=b.index));k!==l&&(c=k<l?-1:1)}else c=d<k?-1:1;return c}return function(a,f,g,h){if(null==a)return a;if(!ra(a))throw N("orderBy")("notarray",a);K(f)||(f=[f]);0===f.length&&(f=["+"]);var k=b(f),l=g?-1:1,m=F(h)?h:c;a=Array.prototype.map.call(a,function(a,b){return{value:a,tieBreaker:{value:b,type:"number",index:b},predicateValues:k.map(function(c){var e=c.get(a);c=typeof e;if(null===e)c="string",e="null";else if("object"===c)a:{if(F(e.valueOf)&&(e=e.valueOf(),d(e)))break a;Cc(e)&&(e=e.toString(),d(e))}return{value:e,type:c,index:b}})}});a.sort(function(a,b){for(var c=0,d=k.length;c<d;c++){var e=m(a.predicateValues[c],b.predicateValues[c]);if(e)return e*k[c].descending*l}return m(a.tieBreaker,b.tieBreaker)*l});return a=a.map(function(a){return a.value})}}function Ua(a){F(a)&&(a={link:a});a.restrict=a.restrict||"AC";return ma(a)}function Yd(a,b,d,c,e){var f=this,g=[];f.$error={};f.$$success={};f.$pending=void 0;f.$name=e(b.name||b.ngForm||"")(d);f.$dirty=!1;f.$pristine=!0;f.$valid=!0;f.$invalid=!1;f.$submitted=!1;f.$$parentForm=Ob;f.$rollbackViewValue=function(){q(g,function(a){a.$rollbackViewValue()})};f.$commitViewValue=function(){q(g,function(a){a.$commitViewValue()})};f.$addControl=function(a){Qa(a.$name,"input");g.push(a);a.$name&&(f[a.$name]=a);a.$$parentForm=f};f.$$renameControl=function(a,b){var c=a.$name;f[c]===a&&delete f[c];f[b]=a;a.$name=b};f.$removeControl=function(a){a.$name&&f[a.$name]===a&&delete f[a.$name];q(f.$pending,function(b,c){f.$setValidity(c,null,a)});q(f.$error,function(b,c){f.$setValidity(c,null,a)});q(f.$$success,function(b,c){f.$setValidity(c,null,a)});ab(g,a);a.$$parentForm=Ob};Zd({ctrl:this,$element:a,set:function(a,b,c){var d=a[b];d?-1===d.indexOf(c)&&d.push(c):a[b]=[c]},unset:function(a,b,c){var d=a[b];d&&(ab(d,c),0===d.length&&delete a[b])},$animate:c});f.$setDirty=function(){c.removeClass(a,Va);c.addClass(a,Pb);f.$dirty=!0;f.$pristine=!1;f.$$parentForm.$setDirty()};f.$setPristine=function(){c.setClass(a,Va,Pb+" ng-submitted");f.$dirty=!1;f.$pristine=!0;f.$submitted=!1;q(g,function(a){a.$setPristine()})};f.$setUntouched=function(){q(g,function(a){a.$setUntouched()})};f.$setSubmitted=function(){c.addClass(a,"ng-submitted");f.$submitted=!0;f.$$parentForm.$setSubmitted()}}function uc(a){a.$formatters.push(function(b){return a.$isEmpty(b)?b:b.toString()})}function Wa(a,b,d,c,e,f){var g=P(b[0].type);if(!e.android){var h=!1;b.on("compositionstart",function(){h=!0});b.on("compositionend",function(){h=!1;l()})}var k,l=function(a){k&&(f.defer.cancel(k),k=null);if(!h){var e=b.val();a=a&&a.type;"password"===g||d.ngTrim&&"false"===d.ngTrim||(e=U(e));(c.$viewValue!==e||""===e&&c.$$hasNativeValidators)&&c.$setViewValue(e,a)}};if(e.hasEvent("input"))b.on("input",l);else{var m=function(a,b,c){k||(k=f.defer(function(){k=null;b&&b.value===c||l(a)}))};b.on("keydown",function(a){var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||m(a,this,this.value)});if(e.hasEvent("paste"))b.on("paste cut",m)}b.on("change",l);if($d[g]&&c.$$hasNativeValidators&&g===d.type)b.on("keydown wheel mousedown",function(a){if(!k){var b=this.validity,c=b.badInput,d=b.typeMismatch;k=f.defer(function(){k=null;b.badInput===c&&b.typeMismatch===d||l(a)})}});c.$render=function(){var a=c.$isEmpty(c.$viewValue)?"":c.$viewValue;b.val()!==a&&b.val(a)}}function Qb(a,b){return function(d,c){var e,f;if(ba(d))return d;if(H(d)){'"'===d.charAt(0)&&'"'===d.charAt(d.length-1)&&(d=d.substring(1,d.length-1));if(Ug.test(d))return new Date(d);a.lastIndex=0;if(e=a.exec(d))return e.shift(),f=c?{yyyy:c.getFullYear(),MM:c.getMonth()+1,dd:c.getDate(),HH:c.getHours(),mm:c.getMinutes(),ss:c.getSeconds(),sss:c.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},q(e,function(a,c){c<b.length&&(f[b[c]]=+a)}),new Date(f.yyyy,f.MM-1,f.dd,f.HH,f.mm,f.ss||0,1e3*f.sss||0)}return NaN}}function ob(a,b,d,c){return function(e,f,g,h,k,l,m){function n(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())}function p(a){return u(a)&&!ba(a)?d(a)||void 0:a}vc(e,f,g,h);Wa(e,f,g,h,k,l);var x=h&&h.$options&&h.$options.timezone,q;h.$$parserName=a;h.$parsers.push(function(a){if(h.$isEmpty(a))return null;if(b.test(a))return a=d(a,q),x&&(a=Vb(a,x)),a});h.$formatters.push(function(a){if(a&&!ba(a))throw pb("datefmt",a);if(n(a))return(q=a)&&x&&(q=Vb(q,x,!0)),m("date")(a,c,x);q=null;return""});if(u(g.min)||g.ngMin){var t;h.$validators.min=function(a){return!n(a)||z(t)||d(a)>=t};g.$observe("min",function(a){t=p(a);h.$validate()})}if(u(g.max)||g.ngMax){var s;h.$validators.max=function(a){return!n(a)||z(s)||d(a)<=s};g.$observe("max",function(a){s=p(a);h.$validate()})}}}function vc(a,b,d,c){(c.$$hasNativeValidators=I(b[0].validity))&&c.$parsers.push(function(a){var c=b.prop("validity")||{};return c.badInput||c.typeMismatch?void 0:a})}function ae(a){a.$$parserName="number";a.$parsers.push(function(b){if(a.$isEmpty(b))return null;if(Vg.test(b))return parseFloat(b)});a.$formatters.push(function(b){if(!a.$isEmpty(b)){if(!Z(b))throw pb("numfmt",b);b=b.toString()}return b})}function qb(a){u(a)&&!Z(a)&&(a=parseFloat(a));return X(a)?void 0:a}function wc(a){var b=a.toString(),d=b.indexOf(".");return-1===d?-1<a&&1>a&&(a=/e-(\d+)$/.exec(b))?Number(a[1]):0:b.length-d-1}function be(a,b,d,c,e){if(u(c)){a=a(c);if(!a.constant)throw pb("constexpr",d,c);return a(b)}return e}function xc(a,b){a="ngClass"+a;return["$animate",function(d){function c(a,b){var c=[],d=0;a:for(;d<a.length;d++){for(var e=a[d],m=0;m<b.length;m++)if(e===b[m])continue a;c.push(e)}return c}function e(a){var b=[];return K(a)?(q(a,function(a){b=b.concat(e(a))}),b):H(a)?a.split(" "):I(a)?(q(a,function(a,c){a&&(b=b.concat(c.split(" ")))}),b):a}return{restrict:"AC",link:function(f,g,h){function k(a){a=l(a,1);h.$addClass(a)}function l(a,b){var c=g.data("$classCounts")||S(),d=[];q(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<b)&&d.push(a)});g.data("$classCounts",c);return d.join(" ")}function m(a,b){var e=c(b,a),f=c(a,b),e=l(e,1),f=l(f,-1);e&&e.length&&d.addClass(g,e);f&&f.length&&d.removeClass(g,f)}function n(a){if(!0===b||(f.$index&1)===b){var c=e(a||[]);if(!p)k(c);else if(!oa(a,p)){var d=e(p);m(d,c)}}p=K(a)?a.map(function(a){return ia(a)}):ia(a)}var p;f.$watch(h[a],n,!0);h.$observe("class",function(b){n(f.$eval(h[a]))});"ngClass"!==a&&f.$watch("$index",function(c,d){var g=c&1;if(g!==(d&1)){var m=e(f.$eval(h[a]));g===b?k(m):(g=l(m,-1),h.$removeClass(g))}})}}}]}function Zd(a){function b(a,b){b&&!f[a]?(k.addClass(e,a),f[a]=!0):!b&&f[a]&&(k.removeClass(e,a),f[a]=!1)}function d(a,c){a=a?"-"+Jc(a,"-"):"";b(rb+a,!0===c);b(ce+a,!1===c)}var c=a.ctrl,e=a.$element,f={},g=a.set,h=a.unset,k=a.$animate;f[ce]=!(f[rb]=e.hasClass(rb));c.$setValidity=function(a,e,f){z(e)?(c.$pending||(c.$pending={}),g(c.$pending,a,f)):(c.$pending&&h(c.$pending,a,f),de(c.$pending)&&(c.$pending=void 0));Ia(e)?e?(h(c.$error,a,f),g(c.$$success,a,f)):(g(c.$error,a,f),h(c.$$success,a,f)):(h(c.$error,a,f),h(c.$$success,a,f));c.$pending?(b(ee,!0),c.$valid=c.$invalid=void 0,d("",null)):(b(ee,!1),c.$valid=de(c.$error),c.$invalid=!c.$valid,d("",c.$valid));e=c.$pending&&c.$pending[a]?void 0:c.$error[a]?!1:c.$$success[a]?!0:null;d(a,e);c.$$parentForm.$setValidity(a,e,c)}}function de(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var Wg=/^\/(.+)\/([a-z]*)$/,sa=Object.prototype.hasOwnProperty,P=function(a){return H(a)?a.toLowerCase():a},xb=function(a){return H(a)?a.toUpperCase():a},Fa,E,xa,ta=[].slice,pg=[].splice,Xg=[].push,na=Object.prototype.toString,Dc=Object.getPrototypeOf,va=N("ng"),ga=B.angular||(B.angular={}),Xb,sb=0;Fa=B.document.documentMode;var X=Number.isNaN||function(a){return a!==a};C.$inject=[];Za.$inject=[];var K=Array.isArray,pe=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array\]$/,U=function(a){return H(a)?a.trim():a},Ld=function(a){return a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},ya=function(){if(!u(ya.rules)){var a=B.document.querySelector("[ng-csp]")||B.document.querySelector("[data-ng-csp]");if(a){var b=a.getAttribute("ng-csp")||a.getAttribute("data-ng-csp");ya.rules={noUnsafeEval:!b||-1!==b.indexOf("no-unsafe-eval"),noInlineStyle:!b||-1!==b.indexOf("no-inline-style")}}else{a=ya;try{new Function(""),b=!1}catch(d){b=!0}a.rules={noUnsafeEval:b,noInlineStyle:!1}}}return ya.rules},ub=function(){if(u(ub.name_))return ub.name_;var a,b,d=Na.length,c,e;for(b=0;b<d;++b)if(c=Na[b],a=B.document.querySelector("["+c.replace(":","\\:")+"jq]")){e=a.getAttribute(c+"jq");break}return ub.name_=e},se=/:/g,Na=["ng-","data-ng-","ng:","x-ng-"],ve=function(a){if(!a.currentScript)return!0;var b=a.currentScript.getAttribute("src"),d=a.createElement("a");d.href=b;b=d.protocol;if(a.location.protocol===b)return!0;switch(b){case"http:":case"https:":case"ftp:":case"blob:":case"file:":case"data:":return!0;default:return!1}}(B.document),ye=/[A-Z]/g,Kc=!1,Ma=3,Ce={full:"1.5.9",major:1,minor:5,dot:9,codeName:"timeturning-lockdown"};T.expando="ng339";var hb=T.cache={},dg=1;T._data=function(a){return this.cache[a[this.expando]]||{}};var Zf=/([:\-_]+(.))/g,$f=/^moz([A-Z])/,Bb={mouseleave:"mouseout",mouseenter:"mouseover"},Zb=N("jqLite"),cg=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,Yb=/<|&#?\w+;/,ag=/<([\w:-]+)/,bg=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,ja={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ja.optgroup=ja.option;ja.tbody=ja.tfoot=ja.colgroup=ja.caption=ja.thead;ja.th=ja.td;var ig=B.Node.prototype.contains||function(a){return!!(this.compareDocumentPosition(a)&16)},Oa=T.prototype={ready:function(a){function b(){d||(d=!0,a())}var d=!1;"complete"===B.document.readyState?B.setTimeout(b):(this.on("DOMContentLoaded",b),T(B).on("load",b))},toString:function(){var a=[];q(this,function(b){a.push(""+b)});return"["+a.join(", ")+"]"},eq:function(a){return 0<=a?E(this[a]):E(this[this.length+a])},length:0,push:Xg,sort:[].sort,splice:[].splice},Hb={};q("multiple selected checked disabled readOnly required open".split(" "),function(a){Hb[P(a)]=a});var bd={};q("input select option textarea button form details".split(" "),function(a){bd[a]=!0});var jd={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};q({data:ac,removeData:gb,hasData:function(a){for(var b in hb[a.ng339])return!0;return!1},cleanData:function(a){for(var b=0,d=a.length;b<d;b++)gb(a[b])}},function(a,b){T[b]=a});q({data:ac,inheritedData:Fb,scope:function(a){return E.data(a,"$scope")||Fb(a.parentNode||a,["$isolateScope","$scope"]);
},isolateScope:function(a){return E.data(a,"$isolateScope")||E.data(a,"$isolateScopeNoTemplate")},controller:Zc,injector:function(a){return Fb(a,"$injector")},removeAttr:function(a,b){a.removeAttribute(b)},hasClass:Cb,css:function(a,b,d){b=fb(b);if(u(d))a.style[b]=d;else return a.style[b]},attr:function(a,b,d){var c=a.nodeType;if(c!==Ma&&2!==c&&8!==c)if(c=P(b),Hb[c])if(u(d))d?(a[b]=!0,a.setAttribute(b,c)):(a[b]=!1,a.removeAttribute(c));else return a[b]||(a.attributes.getNamedItem(b)||C).specified?c:void 0;else if(u(d))a.setAttribute(b,d);else if(a.getAttribute)return a=a.getAttribute(b,2),null===a?void 0:a},prop:function(a,b,d){if(u(d))a[b]=d;else return a[b]},text:function(){function a(a,d){if(z(d)){var c=a.nodeType;return 1===c||c===Ma?a.textContent:""}a.textContent=d}a.$dv="";return a}(),val:function(a,b){if(z(b)){if(a.multiple&&"select"===ua(a)){var d=[];q(a.options,function(a){a.selected&&d.push(a.value||a.text)});return 0===d.length?null:d}return a.value}a.value=b},html:function(a,b){if(z(b))return a.innerHTML;zb(a,!0);a.innerHTML=b},empty:$c},function(a,b){T.prototype[b]=function(b,c){var e,f,g=this.length;if(a!==$c&&z(2===a.length&&a!==Cb&&a!==Zc?b:c)){if(I(b)){for(e=0;e<g;e++)if(a===ac)a(this[e],b);else for(f in b)a(this[e],f,b[f]);return this}e=a.$dv;g=z(e)?Math.min(g,1):g;for(f=0;f<g;f++){var h=a(this[f],b,c);e=e?e+h:h}return e}for(e=0;e<g;e++)a(this[e],b,c);return this}});q({removeData:gb,on:function(a,b,d,c){if(u(c))throw Zb("onargs");if(Uc(a)){c=Ab(a,!0);var e=c.events,f=c.handle;f||(f=c.handle=fg(a,e));c=0<=b.indexOf(" ")?b.split(" "):[b];for(var g=c.length,h=function(b,c,g){var h=e[b];h||(h=e[b]=[],h.specialHandlerWrapper=c,"$destroy"===b||g||a.addEventListener(b,f,!1));h.push(d)};g--;)b=c[g],Bb[b]?(h(Bb[b],hg),h(b,void 0,!0)):h(b)}},off:Yc,one:function(a,b,d){a=E(a);a.on(b,function e(){a.off(b,d);a.off(b,e)});a.on(b,d)},replaceWith:function(a,b){var d,c=a.parentNode;zb(a);q(new T(b),function(b){d?c.insertBefore(b,d.nextSibling):c.replaceChild(b,a);d=b})},children:function(a){var b=[];q(a.childNodes,function(a){1===a.nodeType&&b.push(a)});return b},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,b){var d=a.nodeType;if(1===d||11===d){b=new T(b);for(var d=0,c=b.length;d<c;d++)a.appendChild(b[d])}},prepend:function(a,b){if(1===a.nodeType){var d=a.firstChild;q(new T(b),function(b){a.insertBefore(b,d)})}},wrap:function(a,b){Wc(a,E(b).eq(0).clone()[0])},remove:Gb,detach:function(a){Gb(a,!0)},after:function(a,b){var d=a,c=a.parentNode;b=new T(b);for(var e=0,f=b.length;e<f;e++){var g=b[e];c.insertBefore(g,d.nextSibling);d=g}},addClass:Eb,removeClass:Db,toggleClass:function(a,b,d){b&&q(b.split(" "),function(b){var e=d;z(e)&&(e=!Cb(a,b));(e?Eb:Db)(a,b)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){return a.nextElementSibling},find:function(a,b){return a.getElementsByTagName?a.getElementsByTagName(b):[]},clone:$b,triggerHandler:function(a,b,d){var c,e,f=b.type||b,g=Ab(a);if(g=(g=g&&g.events)&&g[f])c={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:C,type:f,target:a},b.type&&(c=R(c,b)),b=ia(g),e=d?[c].concat(d):[c],q(b,function(b){c.isImmediatePropagationStopped()||b.apply(a,e)})}},function(a,b){T.prototype[b]=function(b,c,e){for(var f,g=0,h=this.length;g<h;g++)z(f)?(f=a(this[g],b,c,e),u(f)&&(f=E(f))):Xc(f,a(this[g],b,c,e));return u(f)?f:this};T.prototype.bind=T.prototype.on;T.prototype.unbind=T.prototype.off});Ra.prototype={put:function(a,b){this[za(a,this.nextUid)]=b},get:function(a){return this[za(a,this.nextUid)]},remove:function(a){var b=this[a=za(a,this.nextUid)];delete this[a];return b}};var Xf=[function(){this.$get=[function(){return Ra}]}],kg=/^([^\(]+?)=>/,lg=/^[^\(]*\(\s*([^\)]*)\)/m,Yg=/,/,Zg=/^\s*(_?)(\S+?)\1\s*$/,jg=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,Da=N("$injector");eb.$$annotate=function(a,b,d){var c;if("function"===typeof a){if(!(c=a.$inject)){c=[];if(a.length){if(b)throw H(d)&&d||(d=a.name||mg(a)),Da("strictdi",d);b=cd(a);q(b[1].split(Yg),function(a){a.replace(Zg,function(a,b,d){c.push(d)})})}a.$inject=c}}else K(a)?(b=a.length-1,Pa(a[b],"fn"),c=a.slice(0,b)):Pa(a,"fn",!0);return c};var fe=N("$animate"),pf=function(){this.$get=C},qf=function(){var a=new Ra,b=[];this.$get=["$$AnimateRunner","$rootScope",function(d,c){function e(a,b,c){var d=!1;b&&(b=H(b)?b.split(" "):K(b)?b:[],q(b,function(b){b&&(d=!0,a[b]=c)}));return d}function f(){q(b,function(b){var c=a.get(b);if(c){var d=ng(b.attr("class")),e="",f="";q(c,function(a,b){a!==!!d[b]&&(a?e+=(e.length?" ":"")+b:f+=(f.length?" ":"")+b)});q(b,function(a){e&&Eb(a,e);f&&Db(a,f)});a.remove(b)}});b.length=0}return{enabled:C,on:C,off:C,pin:C,push:function(g,h,k,l){l&&l();k=k||{};k.from&&g.css(k.from);k.to&&g.css(k.to);if(k.addClass||k.removeClass)if(h=k.addClass,l=k.removeClass,k=a.get(g)||{},h=e(k,h,!0),l=e(k,l,!1),h||l)a.put(g,k),b.push(g),1===b.length&&c.$$postDigest(f);g=new d;g.complete();return g}}}]},nf=["$provide",function(a){var b=this;this.$$registeredAnimations=Object.create(null);this.register=function(d,c){if(d&&"."!==d.charAt(0))throw fe("notcsel",d);var e=d+"-animation";b.$$registeredAnimations[d.substr(1)]=e;a.factory(e,c)};this.classNameFilter=function(a){if(1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null)&&/(\s+|\/)ng-animate(\s+|\/)/.test(this.$$classNameFilter.toString()))throw fe("nongcls","ng-animate");return this.$$classNameFilter};this.$get=["$$animateQueue",function(a){function b(a,c,d){if(d){var h;a:{for(h=0;h<d.length;h++){var k=d[h];if(1===k.nodeType){h=k;break a}}h=void 0}!h||h.parentNode||h.previousElementSibling||(d=null)}d?d.after(a):c.prepend(a)}return{on:a.on,off:a.off,pin:a.pin,enabled:a.enabled,cancel:function(a){a.end&&a.end()},enter:function(e,f,g,h){f=f&&E(f);g=g&&E(g);f=f||g.parent();b(e,f,g);return a.push(e,"enter",Ea(h))},move:function(e,f,g,h){f=f&&E(f);g=g&&E(g);f=f||g.parent();b(e,f,g);return a.push(e,"move",Ea(h))},leave:function(b,c){return a.push(b,"leave",Ea(c),function(){b.remove()})},addClass:function(b,c,g){g=Ea(g);g.addClass=jb(g.addclass,c);return a.push(b,"addClass",g)},removeClass:function(b,c,g){g=Ea(g);g.removeClass=jb(g.removeClass,c);return a.push(b,"removeClass",g)},setClass:function(b,c,g,h){h=Ea(h);h.addClass=jb(h.addClass,c);h.removeClass=jb(h.removeClass,g);return a.push(b,"setClass",h)},animate:function(b,c,g,h,k){k=Ea(k);k.from=k.from?R(k.from,c):c;k.to=k.to?R(k.to,g):g;k.tempClasses=jb(k.tempClasses,h||"ng-inline-animate");return a.push(b,"animate",k)}}}]}],sf=function(){this.$get=["$$rAF",function(a){function b(b){d.push(b);1<d.length||a(function(){for(var a=0;a<d.length;a++)d[a]();d=[]})}var d=[];return function(){var a=!1;b(function(){a=!0});return function(d){a?d():b(d)}}}]},rf=function(){this.$get=["$q","$sniffer","$$animateAsyncRun","$document","$timeout",function(a,b,d,c,e){function f(a){this.setHost(a);var b=d();this._doneCallbacks=[];this._tick=function(a){var d=c[0];d&&d.hidden?e(a,0,!1):b(a)};this._state=0}f.chain=function(a,b){function c(){if(d===a.length)b(!0);else a[d](function(a){!1===a?b(!1):(d++,c())})}var d=0;c()};f.all=function(a,b){function c(f){e=e&&f;++d===a.length&&b(e)}var d=0,e=!0;q(a,function(a){a.done(c)})};f.prototype={setHost:function(a){this.host=a||{}},done:function(a){2===this._state?a():this._doneCallbacks.push(a)},progress:C,getPromise:function(){if(!this.promise){var b=this;this.promise=a(function(a,c){b.done(function(b){!1===b?c():a()})})}return this.promise},then:function(a,b){return this.getPromise().then(a,b)},"catch":function(a){return this.getPromise()["catch"](a)},"finally":function(a){return this.getPromise()["finally"](a)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end();this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel();this._resolve(!1)},complete:function(a){var b=this;0===b._state&&(b._state=1,b._tick(function(){b._resolve(a)}))},_resolve:function(a){2!==this._state&&(q(this._doneCallbacks,function(b){b(a)}),this._doneCallbacks.length=0,this._state=2)}};return f}]},of=function(){this.$get=["$$rAF","$q","$$AnimateRunner",function(a,b,d){return function(b,e){function f(){a(function(){g.addClass&&(b.addClass(g.addClass),g.addClass=null);g.removeClass&&(b.removeClass(g.removeClass),g.removeClass=null);g.to&&(b.css(g.to),g.to=null);h||k.complete();h=!0});return k}var g=e||{};g.$$prepared||(g=pa(g));g.cleanupStyles&&(g.from=g.to=null);g.from&&(b.css(g.from),g.from=null);var h,k=new d;return{start:f,end:f}}}]},da=N("$compile"),gc=new function(){};Mc.$inject=["$provide","$$sanitizeUriProvider"];Ib.prototype.isFirstChange=function(){return this.previousValue===gc};var ed=/^((?:x|data)[:\-_])/i,qg=N("$controller"),kd=/^(\S+)(\s+as\s+([\w$]+))?$/,yf=function(){this.$get=["$document",function(a){return function(b){b?!b.nodeType&&b instanceof E&&(b=b[0]):b=a[0].body;return b.offsetWidth+1}}]},ld="application/json",jc={"Content-Type":ld+";charset=utf-8"},sg=/^\[|^\{(?!\{)/,tg={"[":/]$/,"{":/}$/},rg=/^\)\]\}',?\n/,$g=N("$http"),pd=function(a){return function(){throw $g("legacy",a)}},Ka=ga.$interpolateMinErr=N("$interpolate");Ka.throwNoconcat=function(a){throw Ka("noconcat",a)};Ka.interr=function(a,b){return Ka("interr",a,b.toString())};var Gf=function(){this.$get=["$window",function(a){function b(a){var b=function(a){b.data=a;b.called=!0};b.id=a;return b}var d=a.angular.callbacks,c={};return{createCallback:function(a){a="_"+(d.$$counter++).toString(36);var f="angular.callbacks."+a,g=b(a);c[f]=d[a]=g;return f},wasCalled:function(a){return c[a].called},getResponse:function(a){return c[a].data},removeCallback:function(a){delete d[c[a].id];delete c[a]}}}]},ah=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,vg={http:80,https:443,ftp:21},lb=N("$location"),wg=/^\s*[\\/]{2,}/,bh={$$absUrl:"",$$html5:!1,$$replace:!1,absUrl:Jb("$$absUrl"),url:function(a){if(z(a))return this.$$url;var b=ah.exec(a);(b[1]||""===a)&&this.path(decodeURIComponent(b[1]));(b[2]||b[1]||""===a)&&this.search(b[3]||"");this.hash(b[5]||"");return this},protocol:Jb("$$protocol"),host:Jb("$$host"),port:Jb("$$port"),path:ud("$$path",function(a){a=null!==a?a.toString():"";return"/"===a.charAt(0)?a:"/"+a}),search:function(a,b){switch(arguments.length){case 0:return this.$$search;case 1:if(H(a)||Z(a))a=a.toString(),this.$$search=Hc(a);else if(I(a))a=pa(a,{}),q(a,function(b,c){null==b&&delete a[c]}),this.$$search=a;else throw lb("isrcharg");break;default:z(b)||null===b?delete this.$$search[a]:this.$$search[a]=b}this.$$compose();return this},hash:ud("$$hash",function(a){return null!==a?a.toString():""}),replace:function(){this.$$replace=!0;return this}};q([td,mc,lc],function(a){a.prototype=Object.create(bh);a.prototype.state=function(b){if(!arguments.length)return this.$$state;if(a!==lc||!this.$$html5)throw lb("nostate");this.$$state=z(b)?null:b;return this}});var ea=N("$parse"),wd=[].constructor,xd=(!1).constructor,yd=Function.constructor,zd=(0).constructor,Ad={}.constructor,Bd="".constructor,Bg=wd.prototype,Cg=xd.prototype,Lb=yd.prototype,Dg=zd.prototype,Cd=Ad.prototype,Eg=Bd.prototype,yg=Lb.call,zg=Lb.apply,Ag=Lb.bind,Gg=Cd.valueOf,Rb=S();q("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(a){Rb[a]=!0});var ch={n:"\n",f:"\f",r:"\r",t:"\t",v:"\x0B","'":"'",'"':'"'},oc=function(a){this.options=a};oc.prototype={constructor:oc,lex:function(a){this.text=a;this.index=0;for(this.tokens=[];this.index<this.text.length;)if(a=this.text.charAt(this.index),'"'===a||"'"===a)this.readString(a);else if(this.isNumber(a)||"."===a&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(a,"(){}[].,;:?"))this.tokens.push({index:this.index,text:a}),this.index++;else if(this.isWhitespace(a))this.index++;else{var b=a+this.peek(),d=b+this.peek(2),c=Rb[b],e=Rb[d];Rb[a]||c||e?(a=e?d:c?b:a,this.tokens.push({index:this.index,text:a,operator:!0}),this.index+=a.length):this.throwError("Unexpected next character ",this.index,this.index+1)}return this.tokens},is:function(a,b){return-1!==b.indexOf(a)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=a&&"9">=a&&"string"===typeof a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\x0B"===a||" "===a},isIdentifierStart:function(a){return this.options.isIdentifierStart?this.options.isIdentifierStart(a,this.codePointAt(a)):this.isValidIdentifierStart(a)},isValidIdentifierStart:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isIdentifierContinue:function(a){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(a,this.codePointAt(a)):this.isValidIdentifierContinue(a)},isValidIdentifierContinue:function(a,b){return this.isValidIdentifierStart(a,b)||this.isNumber(a)},codePointAt:function(a){return 1===a.length?a.charCodeAt(0):(a.charCodeAt(0)<<10)+a.charCodeAt(1)-56613888},peekMultichar:function(){var a=this.text.charAt(this.index),b=this.peek();if(!b)return a;var d=a.charCodeAt(0),c=b.charCodeAt(0);return 55296<=d&&56319>=d&&56320<=c&&57343>=c?a+b:a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,b,d){d=d||this.index;b=u(b)?"s "+b+"-"+this.index+" ["+this.text.substring(b,d)+"]":" "+d;throw ea("lexerr",a,b,this.text)},readNumber:function(){for(var a="",b=this.index;this.index<this.text.length;){var d=P(this.text.charAt(this.index));if("."===d||this.isNumber(d))a+=d;else{var c=this.peek();if("e"===d&&this.isExpOperator(c))a+=d;else if(this.isExpOperator(d)&&c&&this.isNumber(c)&&"e"===a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||c&&this.isNumber(c)||"e"!==a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}this.tokens.push({index:b,text:a,constant:!0,value:Number(a)})},readIdent:function(){var a=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var b=this.peekMultichar();if(!this.isIdentifierContinue(b))break;this.index+=b.length}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})},readString:function(a){var b=this.index;this.index++;for(var d="",c=a,e=!1;this.index<this.text.length;){var f=this.text.charAt(this.index),c=c+f;if(e)"u"===f?(e=this.text.substring(this.index+1,this.index+5),e.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+e+"]"),this.index+=4,d+=String.fromCharCode(parseInt(e,16))):d+=ch[f]||f,e=!1;else if("\\"===f)e=!0;else{if(f===a){this.index++;this.tokens.push({index:b,text:c,constant:!0,value:d});return}d+=f}this.index++}this.throwError("Unterminated quote",b)}};var r=function(a,b){this.lexer=a;this.options=b};r.Program="Program";r.ExpressionStatement="ExpressionStatement";r.AssignmentExpression="AssignmentExpression";r.ConditionalExpression="ConditionalExpression";r.LogicalExpression="LogicalExpression";r.BinaryExpression="BinaryExpression";r.UnaryExpression="UnaryExpression";r.CallExpression="CallExpression";r.MemberExpression="MemberExpression";r.Identifier="Identifier";r.Literal="Literal";r.ArrayExpression="ArrayExpression";r.Property="Property";r.ObjectExpression="ObjectExpression";r.ThisExpression="ThisExpression";r.LocalsExpression="LocalsExpression";r.NGValueParameter="NGValueParameter";r.prototype={ast:function(a){this.text=a;this.tokens=this.lexer.lex(a);a=this.program();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);return a},program:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.expressionStatement()),!this.expect(";"))return{type:r.Program,body:a}},expressionStatement:function(){return{type:r.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var a=this.expression();this.expect("|");)a=this.filter(a);return a},expression:function(){return this.assignment()},assignment:function(){var a=this.ternary();this.expect("=")&&(a={type:r.AssignmentExpression,left:a,right:this.assignment(),operator:"="});return a},ternary:function(){var a=this.logicalOR(),b,d;return this.expect("?")&&(b=this.expression(),this.consume(":"))?(d=this.expression(),{type:r.ConditionalExpression,test:a,alternate:b,consequent:d}):a},logicalOR:function(){for(var a=this.logicalAND();this.expect("||");)a={type:r.LogicalExpression,operator:"||",left:a,right:this.logicalAND()};return a},logicalAND:function(){for(var a=this.equality();this.expect("&&");)a={type:r.LogicalExpression,operator:"&&",left:a,right:this.equality()};return a},equality:function(){for(var a=this.relational(),b;b=this.expect("==","!=","===","!==");)a={type:r.BinaryExpression,operator:b.text,left:a,right:this.relational()};return a},relational:function(){for(var a=this.additive(),b;b=this.expect("<",">","<=",">=");)a={type:r.BinaryExpression,operator:b.text,left:a,right:this.additive()};return a},additive:function(){for(var a=this.multiplicative(),b;b=this.expect("+","-");)a={type:r.BinaryExpression,operator:b.text,left:a,right:this.multiplicative()};return a},multiplicative:function(){for(var a=this.unary(),b;b=this.expect("*","/","%");)a={type:r.BinaryExpression,operator:b.text,left:a,right:this.unary()};return a},unary:function(){var a;return(a=this.expect("+","-","!"))?{type:r.UnaryExpression,operator:a.text,prefix:!0,argument:this.unary()}:this.primary()},primary:function(){var a;this.expect("(")?(a=this.filterChain(),this.consume(")")):this.expect("[")?a=this.arrayDeclaration():this.expect("{")?a=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?a=pa(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?a={type:r.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?a=this.identifier():this.peek().constant?a=this.constant():this.throwError("not a primary expression",this.peek());for(var b;b=this.expect("(","[",".");)"("===b.text?(a={type:r.CallExpression,callee:a,arguments:this.parseArguments()},this.consume(")")):"["===b.text?(a={type:r.MemberExpression,object:a,property:this.expression(),computed:!0},this.consume("]")):"."===b.text?a={type:r.MemberExpression,object:a,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return a},filter:function(a){a=[a];for(var b={type:r.CallExpression,callee:this.identifier(),arguments:a,filter:!0};this.expect(":");)a.push(this.expression());return b},parseArguments:function(){var a=[];if(")"!==this.peekToken().text){do a.push(this.filterChain());while(this.expect(","))}return a},identifier:function(){var a=this.consume();a.identifier||this.throwError("is not a valid identifier",a);return{type:r.Identifier,name:a.text}},constant:function(){return{type:r.Literal,value:this.consume().value}},arrayDeclaration:function(){var a=[];if("]"!==this.peekToken().text){do{if(this.peek("]"))break;a.push(this.expression())}while(this.expect(","))}this.consume("]");return{type:r.ArrayExpression,elements:a}},object:function(){var a=[],b;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;b={type:r.Property,kind:"init"};this.peek().constant?(b.key=this.constant(),b.computed=!1,this.consume(":"),b.value=this.expression()):this.peek().identifier?(b.key=this.identifier(),b.computed=!1,this.peek(":")?(this.consume(":"),b.value=this.expression()):b.value=b.key):this.peek("[")?(this.consume("["),b.key=this.expression(),this.consume("]"),b.computed=!0,this.consume(":"),b.value=this.expression()):this.throwError("invalid key",this.peek());a.push(b)}while(this.expect(","))}this.consume("}");return{type:r.ObjectExpression,properties:a}},throwError:function(a,b){throw ea("syntax",b.text,a,b.index+1,this.text,this.text.substring(b.index))},consume:function(a){if(0===this.tokens.length)throw ea("ueoe",this.text);var b=this.expect(a);b||this.throwError("is unexpected, expecting ["+a+"]",this.peek());return b},peekToken:function(){if(0===this.tokens.length)throw ea("ueoe",this.text);return this.tokens[0]},peek:function(a,b,d,c){return this.peekAhead(0,a,b,d,c)},peekAhead:function(a,b,d,c,e){if(this.tokens.length>a){a=this.tokens[a];var f=a.text;if(f===b||f===d||f===c||f===e||!(b||d||c||e))return a}return!1},expect:function(a,b,d,c){return(a=this.peek(a,b,d,c))?(this.tokens.shift(),a):!1},selfReferential:{"this":{type:r.ThisExpression},$locals:{type:r.LocalsExpression}}};Id.prototype={compile:function(a,b){var d=this,c=this.astBuilder.ast(a);this.state={nextId:0,filters:{},expensiveChecks:b,fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]};W(c,d.$filter);var e="",f;this.stage="assign";if(f=Gd(c))this.state.computing="assign",e=this.nextId(),this.recurse(f,e),this.return_(e),e="fn.assign="+this.generateFunction("assign","s,v,l");f=Ed(c.body);d.stage="inputs";q(f,function(a,b){var c="fn"+b;d.state[c]={vars:[],body:[],own:{}};d.state.computing=c;var e=d.nextId();d.recurse(a,e);d.return_(e);d.state.inputs.push(c);a.watchId=b});this.state.computing="fn";this.stage="main";this.recurse(c);e='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+e+this.watchFns()+"return fn;";e=new Function("$filter","ensureSafeMemberName","ensureSafeObject","ensureSafeFunction","getStringValue","ensureSafeAssignContext","ifDefined","plus","text",e)(this.$filter,Ta,qa,vd,xg,Kb,Fg,Dd,a);this.state=this.stage=void 0;e.literal=Hd(c);e.constant=c.constant;return e},USE:"use",STRICT:"strict",watchFns:function(){var a=[],b=this.state.inputs,d=this;q(b,function(b){a.push("var "+b+"="+d.generateFunction(b,"s"))});b.length&&a.push("fn.inputs=["+b.join(",")+"];");return a.join("")},generateFunction:function(a,b){return"function("+b+"){"+this.varsPrefix(a)+this.body(a)+"};"},filterPrefix:function(){var a=[],b=this;q(this.state.filters,function(d,c){a.push(d+"=$filter("+b.escape(c)+")")});return a.length?"var "+a.join(",")+";":""},varsPrefix:function(a){return this.state[a].vars.length?"var "+this.state[a].vars.join(",")+";":""},body:function(a){return this.state[a].body.join("")},recurse:function(a,b,d,c,e,f){var g,h,k=this,l,m,n;c=c||C;if(!f&&u(a.watchId))b=b||this.nextId(),this.if_("i",this.lazyAssign(b,this.computedMember("i",a.watchId)),this.lazyRecurse(a,b,d,c,e,!0));else switch(a.type){case r.Program:q(a.body,function(b,c){k.recurse(b.expression,void 0,void 0,function(a){h=a});c!==a.body.length-1?k.current().body.push(h,";"):k.return_(h)});break;case r.Literal:m=this.escape(a.value);this.assign(b,m);c(m);break;case r.UnaryExpression:this.recurse(a.argument,void 0,void 0,function(a){h=a});m=a.operator+"("+this.ifDefined(h,0)+")";this.assign(b,m);c(m);break;case r.BinaryExpression:this.recurse(a.left,void 0,void 0,function(a){g=a});this.recurse(a.right,void 0,void 0,function(a){h=a});m="+"===a.operator?this.plus(g,h):"-"===a.operator?this.ifDefined(g,0)+a.operator+this.ifDefined(h,0):"("+g+")"+a.operator+"("+h+")";this.assign(b,m);c(m);break;case r.LogicalExpression:b=b||this.nextId();k.recurse(a.left,b);k.if_("&&"===a.operator?b:k.not(b),k.lazyRecurse(a.right,b));c(b);break;case r.ConditionalExpression:b=b||this.nextId();k.recurse(a.test,b);k.if_(b,k.lazyRecurse(a.alternate,b),k.lazyRecurse(a.consequent,b));c(b);break;case r.Identifier:b=b||this.nextId();d&&(d.context="inputs"===k.stage?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",a.name)+"?l:s"),d.computed=!1,d.name=a.name);Ta(a.name);k.if_("inputs"===k.stage||k.not(k.getHasOwnProperty("l",a.name)),function(){k.if_("inputs"===k.stage||"s",function(){e&&1!==e&&k.if_(k.not(k.nonComputedMember("s",a.name)),k.lazyAssign(k.nonComputedMember("s",a.name),"{}"));k.assign(b,k.nonComputedMember("s",a.name))})},b&&k.lazyAssign(b,k.nonComputedMember("l",a.name)));(k.state.expensiveChecks||Mb(a.name))&&k.addEnsureSafeObject(b);c(b);break;case r.MemberExpression:g=d&&(d.context=this.nextId())||this.nextId();b=b||this.nextId();k.recurse(a.object,g,void 0,function(){k.if_(k.notNull(g),function(){e&&1!==e&&k.addEnsureSafeAssignContext(g);if(a.computed)h=k.nextId(),k.recurse(a.property,h),k.getStringValue(h),k.addEnsureSafeMemberName(h),e&&1!==e&&k.if_(k.not(k.computedMember(g,h)),k.lazyAssign(k.computedMember(g,h),"{}")),m=k.ensureSafeObject(k.computedMember(g,h)),k.assign(b,m),d&&(d.computed=!0,d.name=h);else{Ta(a.property.name);e&&1!==e&&k.if_(k.not(k.nonComputedMember(g,a.property.name)),k.lazyAssign(k.nonComputedMember(g,a.property.name),"{}"));m=k.nonComputedMember(g,a.property.name);if(k.state.expensiveChecks||Mb(a.property.name))m=k.ensureSafeObject(m);k.assign(b,m);d&&(d.computed=!1,d.name=a.property.name)}},function(){k.assign(b,"undefined")});c(b)},!!e);break;case r.CallExpression:b=b||this.nextId();a.filter?(h=k.filter(a.callee.name),l=[],q(a.arguments,function(a){var b=k.nextId();k.recurse(a,b);l.push(b)}),m=h+"("+l.join(",")+")",k.assign(b,m),c(b)):(h=k.nextId(),g={},l=[],k.recurse(a.callee,h,g,function(){k.if_(k.notNull(h),function(){k.addEnsureSafeFunction(h);q(a.arguments,function(a){k.recurse(a,k.nextId(),void 0,function(a){l.push(k.ensureSafeObject(a))})});g.name?(k.state.expensiveChecks||k.addEnsureSafeObject(g.context),m=k.member(g.context,g.name,g.computed)+"("+l.join(",")+")"):m=h+"("+l.join(",")+")";m=k.ensureSafeObject(m);k.assign(b,m)},function(){k.assign(b,"undefined")});c(b)}));break;case r.AssignmentExpression:h=this.nextId();g={};if(!Fd(a.left))throw ea("lval");this.recurse(a.left,void 0,g,function(){k.if_(k.notNull(g.context),function(){k.recurse(a.right,h);k.addEnsureSafeObject(k.member(g.context,g.name,g.computed));k.addEnsureSafeAssignContext(g.context);m=k.member(g.context,g.name,g.computed)+a.operator+h;k.assign(b,m);c(b||m)})},1);break;case r.ArrayExpression:l=[];q(a.elements,function(a){k.recurse(a,k.nextId(),void 0,function(a){l.push(a)})});m="["+l.join(",")+"]";this.assign(b,m);c(m);break;case r.ObjectExpression:l=[];n=!1;q(a.properties,function(a){a.computed&&(n=!0)});n?(b=b||this.nextId(),this.assign(b,"{}"),q(a.properties,function(a){a.computed?(g=k.nextId(),k.recurse(a.key,g)):g=a.key.type===r.Identifier?a.key.name:""+a.key.value;h=k.nextId();k.recurse(a.value,h);k.assign(k.member(b,g,a.computed),h)})):(q(a.properties,function(b){k.recurse(b.value,a.constant?void 0:k.nextId(),void 0,function(a){l.push(k.escape(b.key.type===r.Identifier?b.key.name:""+b.key.value)+":"+a)})}),m="{"+l.join(",")+"}",this.assign(b,m));c(b||m);break;case r.ThisExpression:this.assign(b,"s");c("s");break;case r.LocalsExpression:this.assign(b,"l");c("l");break;case r.NGValueParameter:this.assign(b,"v"),c("v")}},getHasOwnProperty:function(a,b){var d=a+"."+b,c=this.current().own;c.hasOwnProperty(d)||(c[d]=this.nextId(!1,a+"&&("+this.escape(b)+" in "+a+")"));return c[d]},assign:function(a,b){if(a)return this.current().body.push(a,"=",b,";"),a},filter:function(a){this.state.filters.hasOwnProperty(a)||(this.state.filters[a]=this.nextId(!0));return this.state.filters[a]},ifDefined:function(a,b){return"ifDefined("+a+","+this.escape(b)+")"},plus:function(a,b){return"plus("+a+","+b+")"},return_:function(a){this.current().body.push("return ",a,";")},if_:function(a,b,d){if(!0===a)b();else{var c=this.current().body;c.push("if(",a,"){");b();c.push("}");d&&(c.push("else{"),d(),c.push("}"))}},not:function(a){return"!("+a+")"},notNull:function(a){return a+"!=null"},nonComputedMember:function(a,b){var d=/[^$_a-zA-Z0-9]/g;return/^[$_a-zA-Z][$_a-zA-Z0-9]*$/.test(b)?a+"."+b:a+'["'+b.replace(d,this.stringEscapeFn)+'"]'},computedMember:function(a,b){return a+"["+b+"]"},member:function(a,b,d){return d?this.computedMember(a,b):this.nonComputedMember(a,b)},addEnsureSafeObject:function(a){this.current().body.push(this.ensureSafeObject(a),";")},addEnsureSafeMemberName:function(a){this.current().body.push(this.ensureSafeMemberName(a),";")},addEnsureSafeFunction:function(a){this.current().body.push(this.ensureSafeFunction(a),";")},addEnsureSafeAssignContext:function(a){this.current().body.push(this.ensureSafeAssignContext(a),";")},ensureSafeObject:function(a){return"ensureSafeObject("+a+",text)"},ensureSafeMemberName:function(a){return"ensureSafeMemberName("+a+",text)"},ensureSafeFunction:function(a){return"ensureSafeFunction("+a+",text)"},getStringValue:function(a){this.assign(a,"getStringValue("+a+")")},ensureSafeAssignContext:function(a){return"ensureSafeAssignContext("+a+",text)"},lazyRecurse:function(a,b,d,c,e,f){var g=this;return function(){g.recurse(a,b,d,c,e,f)}},lazyAssign:function(a,b){var d=this;return function(){d.assign(a,b)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)},escape:function(a){if(H(a))return"'"+a.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(Z(a))return a.toString();if(!0===a)return"true";if(!1===a)return"false";if(null===a)return"null";if("undefined"===typeof a)return"undefined";throw ea("esc")},nextId:function(a,b){var d="v"+this.state.nextId++;a||this.current().vars.push(d+(b?"="+b:""));return d},current:function(){return this.state[this.state.computing]}};Jd.prototype={compile:function(a,b){var d=this,c=this.astBuilder.ast(a);this.expression=a;this.expensiveChecks=b;W(c,d.$filter);var e,f;if(e=Gd(c))f=this.recurse(e);e=Ed(c.body);var g;e&&(g=[],q(e,function(a,b){var c=d.recurse(a);a.input=c;g.push(c);a.watchId=b}));var h=[];q(c.body,function(a){h.push(d.recurse(a.expression))});e=0===c.body.length?C:1===c.body.length?h[0]:function(a,b){var c;q(h,function(d){c=d(a,b)});return c};f&&(e.assign=function(a,b,c){return f(a,c,b)});g&&(e.inputs=g);e.literal=Hd(c);e.constant=c.constant;return e},recurse:function(a,b,d){var c,e,f=this,g;if(a.input)return this.inputs(a.input,a.watchId);switch(a.type){case r.Literal:return this.value(a.value,b);case r.UnaryExpression:return e=this.recurse(a.argument),this["unary"+a.operator](e,b);case r.BinaryExpression:return c=this.recurse(a.left),e=this.recurse(a.right),this["binary"+a.operator](c,e,b);case r.LogicalExpression:return c=this.recurse(a.left),e=this.recurse(a.right),this["binary"+a.operator](c,e,b);case r.ConditionalExpression:return this["ternary?:"](this.recurse(a.test),this.recurse(a.alternate),this.recurse(a.consequent),b);case r.Identifier:return Ta(a.name,f.expression),f.identifier(a.name,f.expensiveChecks||Mb(a.name),b,d,f.expression);case r.MemberExpression:return c=this.recurse(a.object,!1,!!d),a.computed||(Ta(a.property.name,f.expression),e=a.property.name),a.computed&&(e=this.recurse(a.property)),a.computed?this.computedMember(c,e,b,d,f.expression):this.nonComputedMember(c,e,f.expensiveChecks,b,d,f.expression);case r.CallExpression:return g=[],q(a.arguments,function(a){g.push(f.recurse(a))}),a.filter&&(e=this.$filter(a.callee.name)),a.filter||(e=this.recurse(a.callee,!0)),a.filter?function(a,c,d,f){for(var n=[],p=0;p<g.length;++p)n.push(g[p](a,c,d,f));a=e.apply(void 0,n,f);return b?{context:void 0,name:void 0,value:a}:a}:function(a,c,d,m){var n=e(a,c,d,m),p;if(null!=n.value){qa(n.context,f.expression);vd(n.value,f.expression);p=[];for(var q=0;q<g.length;++q)p.push(qa(g[q](a,c,d,m),f.expression));p=qa(n.value.apply(n.context,p),f.expression)}return b?{value:p}:p};case r.AssignmentExpression:return c=this.recurse(a.left,!0,1),e=this.recurse(a.right),function(a,d,g,m){var n=c(a,d,g,m);a=e(a,d,g,m);qa(n.value,f.expression);Kb(n.context);n.context[n.name]=a;return b?{value:a}:a};case r.ArrayExpression:return g=[],q(a.elements,function(a){g.push(f.recurse(a))}),function(a,c,d,e){for(var f=[],p=0;p<g.length;++p)f.push(g[p](a,c,d,e));return b?{value:f}:f};case r.ObjectExpression:return g=[],q(a.properties,function(a){a.computed?g.push({key:f.recurse(a.key),computed:!0,value:f.recurse(a.value)}):g.push({key:a.key.type===r.Identifier?a.key.name:""+a.key.value,computed:!1,value:f.recurse(a.value)
})}),function(a,c,d,e){for(var f={},p=0;p<g.length;++p)g[p].computed?f[g[p].key(a,c,d,e)]=g[p].value(a,c,d,e):f[g[p].key]=g[p].value(a,c,d,e);return b?{value:f}:f};case r.ThisExpression:return function(a){return b?{value:a}:a};case r.LocalsExpression:return function(a,c){return b?{value:c}:c};case r.NGValueParameter:return function(a,c,d){return b?{value:d}:d}}},"unary+":function(a,b){return function(d,c,e,f){d=a(d,c,e,f);d=u(d)?+d:0;return b?{value:d}:d}},"unary-":function(a,b){return function(d,c,e,f){d=a(d,c,e,f);d=u(d)?-d:0;return b?{value:d}:d}},"unary!":function(a,b){return function(d,c,e,f){d=!a(d,c,e,f);return b?{value:d}:d}},"binary+":function(a,b,d){return function(c,e,f,g){var h=a(c,e,f,g);c=b(c,e,f,g);h=Dd(h,c);return d?{value:h}:h}},"binary-":function(a,b,d){return function(c,e,f,g){var h=a(c,e,f,g);c=b(c,e,f,g);h=(u(h)?h:0)-(u(c)?c:0);return d?{value:h}:h}},"binary*":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)*b(c,e,f,g);return d?{value:c}:c}},"binary/":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)/b(c,e,f,g);return d?{value:c}:c}},"binary%":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)%b(c,e,f,g);return d?{value:c}:c}},"binary===":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)===b(c,e,f,g);return d?{value:c}:c}},"binary!==":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)!==b(c,e,f,g);return d?{value:c}:c}},"binary==":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)==b(c,e,f,g);return d?{value:c}:c}},"binary!=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)!=b(c,e,f,g);return d?{value:c}:c}},"binary<":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)<b(c,e,f,g);return d?{value:c}:c}},"binary>":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)>b(c,e,f,g);return d?{value:c}:c}},"binary<=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)<=b(c,e,f,g);return d?{value:c}:c}},"binary>=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)>=b(c,e,f,g);return d?{value:c}:c}},"binary&&":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)&&b(c,e,f,g);return d?{value:c}:c}},"binary||":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)||b(c,e,f,g);return d?{value:c}:c}},"ternary?:":function(a,b,d,c){return function(e,f,g,h){e=a(e,f,g,h)?b(e,f,g,h):d(e,f,g,h);return c?{value:e}:e}},value:function(a,b){return function(){return b?{context:void 0,name:void 0,value:a}:a}},identifier:function(a,b,d,c,e){return function(f,g,h,k){f=g&&a in g?g:f;c&&1!==c&&f&&!f[a]&&(f[a]={});g=f?f[a]:void 0;b&&qa(g,e);return d?{context:f,name:a,value:g}:g}},computedMember:function(a,b,d,c,e){return function(f,g,h,k){var l=a(f,g,h,k),m,n;null!=l&&(m=b(f,g,h,k),m+="",Ta(m,e),c&&1!==c&&(Kb(l),l&&!l[m]&&(l[m]={})),n=l[m],qa(n,e));return d?{context:l,name:m,value:n}:n}},nonComputedMember:function(a,b,d,c,e,f){return function(g,h,k,l){g=a(g,h,k,l);e&&1!==e&&(Kb(g),g&&!g[b]&&(g[b]={}));h=null!=g?g[b]:void 0;(d||Mb(b))&&qa(h,f);return c?{context:g,name:b,value:h}:h}},inputs:function(a,b){return function(d,c,e,f){return f?f[b]:a(d,c,e)}}};var pc=function(a,b,d){this.lexer=a;this.$filter=b;this.options=d;this.ast=new r(a,d);this.astCompiler=d.csp?new Jd(this.ast,b):new Id(this.ast,b)};pc.prototype={constructor:pc,parse:function(a){return this.astCompiler.compile(a,this.options.expensiveChecks)}};var fa=N("$sce"),la={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Ig=N("$compile"),V=B.document.createElement("a"),Nd=Ca(B.location.href);Od.$inject=["$document"];Tc.$inject=["$provide"];var Vd=22,Ud=".",rc="0";Pd.$inject=["$locale"];Rd.$inject=["$locale"];var Tg={yyyy:Y("FullYear",4,0,!1,!0),yy:Y("FullYear",2,0,!0,!0),y:Y("FullYear",1,0,!1,!0),MMMM:nb("Month"),MMM:nb("Month",!0),MM:Y("Month",2,1),M:Y("Month",1,1),LLLL:nb("Month",!1,!0),dd:Y("Date",2),d:Y("Date",1),HH:Y("Hours",2),H:Y("Hours",1),hh:Y("Hours",2,-12),h:Y("Hours",1,-12),mm:Y("Minutes",2),m:Y("Minutes",1),ss:Y("Seconds",2),s:Y("Seconds",1),sss:Y("Milliseconds",3),EEEE:nb("Day"),EEE:nb("Day",!0),a:function(a,b){return 12>a.getHours()?b.AMPMS[0]:b.AMPMS[1]},Z:function(a,b,d){a=-1*d;return a=(0<=a?"+":"")+(Nb(Math[0<a?"floor":"ceil"](a/60),2)+Nb(Math.abs(a%60),2))},ww:Xd(2),w:Xd(1),G:sc,GG:sc,GGG:sc,GGGG:function(a,b){return 0>=a.getFullYear()?b.ERANAMES[0]:b.ERANAMES[1]}},Sg=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,Rg=/^\-?\d+$/;Qd.$inject=["$locale"];var Mg=ma(P),Ng=ma(xb);Sd.$inject=["$parse"];var Ee=ma({restrict:"E",compile:function(a,b){if(!b.href&&!b.xlinkHref)return function(a,b){if("a"===b[0].nodeName.toLowerCase()){var e="[object SVGAnimatedString]"===na.call(b.prop("href"))?"xlink:href":"href";b.on("click",function(a){b.attr(e)||a.preventDefault()})}}}}),yb={};q(Hb,function(a,b){function d(a,d,e){a.$watch(e[c],function(a){e.$set(b,!!a)})}if("multiple"!==a){var c=Ba("ng-"+b),e=d;"checked"===a&&(e=function(a,b,e){e.ngModel!==e[c]&&d(a,b,e)});yb[c]=function(){return{restrict:"A",priority:100,link:e}}}});q(jd,function(a,b){yb[b]=function(){return{priority:100,link:function(a,c,e){if("ngPattern"===b&&"/"===e.ngPattern.charAt(0)&&(c=e.ngPattern.match(Wg))){e.$set("ngPattern",new RegExp(c[1],c[2]));return}a.$watch(e[b],function(a){e.$set(b,a)})}}}});q(["src","srcset","href"],function(a){var b=Ba("ng-"+a);yb[b]=function(){return{priority:99,link:function(d,c,e){var f=a,g=a;"href"===a&&"[object SVGAnimatedString]"===na.call(c.prop("href"))&&(g="xlinkHref",e.$attr[g]="xlink:href",f=null);e.$observe(b,function(b){b?(e.$set(g,b),Fa&&f&&c.prop(f,e[g])):"href"===a&&e.$set(g,null)})}}}});var Ob={$addControl:C,$$renameControl:function(a,b){a.$name=b},$removeControl:C,$setValidity:C,$setDirty:C,$setPristine:C,$setSubmitted:C};Yd.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var ge=function(a){return["$timeout","$parse",function(b,d){function c(a){return""===a?d('this[""]').assign:d(a).assign||C}return{name:"form",restrict:a?"EAC":"E",require:["form","^^?form"],controller:Yd,compile:function(d,f){d.addClass(Va).addClass(rb);var g=f.name?"name":a&&f.ngForm?"ngForm":!1;return{pre:function(a,d,e,f){var n=f[0];if(!("action"in e)){var p=function(b){a.$apply(function(){n.$commitViewValue();n.$setSubmitted()});b.preventDefault()};d[0].addEventListener("submit",p,!1);d.on("$destroy",function(){b(function(){d[0].removeEventListener("submit",p,!1)},0,!1)})}(f[1]||n.$$parentForm).$addControl(n);var q=g?c(n.$name):C;g&&(q(a,n),e.$observe(g,function(b){n.$name!==b&&(q(a,void 0),n.$$parentForm.$$renameControl(n,b),q=c(n.$name),q(a,n))}));d.on("$destroy",function(){n.$$parentForm.$removeControl(n);q(a,void 0);R(n,Ob)})}}}}}]},Fe=ge(),Re=ge(!0),Ug=/^\d{4,}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)$/,dh=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:\/?#]+|\[[a-f\d:]+\])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i,eh=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/,Vg=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,he=/^(\d{4,})-(\d{2})-(\d{2})$/,ie=/^(\d{4,})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,yc=/^(\d{4,})-W(\d\d)$/,je=/^(\d{4,})-(\d\d)$/,ke=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,$d=S();q(["date","datetime-local","month","time","week"],function(a){$d[a]=!0});var le={text:function(a,b,d,c,e,f){Wa(a,b,d,c,e,f);uc(c)},date:ob("date",he,Qb(he,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":ob("datetimelocal",ie,Qb(ie,"yyyy MM dd HH mm ss sss".split(" ")),"yyyy-MM-ddTHH:mm:ss.sss"),time:ob("time",ke,Qb(ke,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:ob("week",yc,function(a,b){if(ba(a))return a;if(H(a)){yc.lastIndex=0;var d=yc.exec(a);if(d){var c=+d[1],e=+d[2],f=d=0,g=0,h=0,k=Wd(c),e=7*(e-1);b&&(d=b.getHours(),f=b.getMinutes(),g=b.getSeconds(),h=b.getMilliseconds());return new Date(c,0,k.getDate()+e,d,f,g,h)}}return NaN},"yyyy-Www"),month:ob("month",je,Qb(je,["yyyy","MM"]),"yyyy-MM"),number:function(a,b,d,c,e,f){vc(a,b,d,c);Wa(a,b,d,c,e,f);ae(c);var g,h;if(u(d.min)||d.ngMin)c.$validators.min=function(a){return c.$isEmpty(a)||z(g)||a>=g},d.$observe("min",function(a){g=qb(a);c.$validate()});if(u(d.max)||d.ngMax)c.$validators.max=function(a){return c.$isEmpty(a)||z(h)||a<=h},d.$observe("max",function(a){h=qb(a);c.$validate()})},url:function(a,b,d,c,e,f){Wa(a,b,d,c,e,f);uc(c);c.$$parserName="url";c.$validators.url=function(a,b){var d=a||b;return c.$isEmpty(d)||dh.test(d)}},email:function(a,b,d,c,e,f){Wa(a,b,d,c,e,f);uc(c);c.$$parserName="email";c.$validators.email=function(a,b){var d=a||b;return c.$isEmpty(d)||eh.test(d)}},radio:function(a,b,d,c){z(d.name)&&b.attr("name",++sb);b.on("click",function(a){b[0].checked&&c.$setViewValue(d.value,a&&a.type)});c.$render=function(){b[0].checked=d.value===c.$viewValue};d.$observe("value",c.$render)},range:function(a,b,d,c,e,f){function g(a,c){b.attr(a,d[a]);d.$observe(a,c)}function h(a){n=qb(a);X(c.$modelValue)||(m?(a=b.val(),n>a&&(a=n,b.val(a)),c.$setViewValue(a)):c.$validate())}function k(a){p=qb(a);X(c.$modelValue)||(m?(a=b.val(),p<a&&(b.val(p),a=p<n?n:p),c.$setViewValue(a)):c.$validate())}function l(a){q=qb(a);X(c.$modelValue)||(m&&c.$viewValue!==b.val()?c.$setViewValue(b.val()):c.$validate())}vc(a,b,d,c);ae(c);Wa(a,b,d,c,e,f);var m=c.$$hasNativeValidators&&"range"===b[0].type,n=m?0:void 0,p=m?100:void 0,q=m?1:void 0,r=b[0].validity;a=u(d.min);e=u(d.max);f=u(d.step);var t=c.$render;c.$render=m&&u(r.rangeUnderflow)&&u(r.rangeOverflow)?function(){t();c.$setViewValue(b.val())}:t;a&&(c.$validators.min=m?function(){return!0}:function(a,b){return c.$isEmpty(b)||z(n)||b>=n},g("min",h));e&&(c.$validators.max=m?function(){return!0}:function(a,b){return c.$isEmpty(b)||z(p)||b<=p},g("max",k));f&&(c.$validators.step=m?function(){return!r.stepMismatch}:function(a,b){var d;if(!(d=c.$isEmpty(b)||z(q))){d=n||0;var e=q,f=Number(b);if((f|0)!==f||(d|0)!==d||(e|0)!==e){var g=Math.max(wc(f),wc(d),wc(e)),g=Math.pow(10,g),f=f*g;d*=g;e*=g}d=0===(f-d)%e}return d},g("step",l))},checkbox:function(a,b,d,c,e,f,g,h){var k=be(h,a,"ngTrueValue",d.ngTrueValue,!0),l=be(h,a,"ngFalseValue",d.ngFalseValue,!1);b.on("click",function(a){c.$setViewValue(b[0].checked,a&&a.type)});c.$render=function(){b[0].checked=c.$viewValue};c.$isEmpty=function(a){return!1===a};c.$formatters.push(function(a){return oa(a,k)});c.$parsers.push(function(a){return a?k:l})},hidden:C,button:C,submit:C,reset:C,file:C},Nc=["$browser","$sniffer","$filter","$parse",function(a,b,d,c){return{restrict:"E",require:["?ngModel"],link:{pre:function(e,f,g,h){if(h[0]){var k=P(g.type);"range"!==k||g.hasOwnProperty("ngInputRange")||(k="text");(le[k]||le.text)(e,f,g,h[0],b,a,d,c)}}}}}],fh=/^(true|false|\d+)$/,jf=function(){return{restrict:"A",priority:100,compile:function(a,b){return fh.test(b.ngValue)?function(a,b,e){e.$set("value",a.$eval(e.ngValue))}:function(a,b,e){a.$watch(e.ngValue,function(a){e.$set("value",a)})}}}},Je=["$compile",function(a){return{restrict:"AC",compile:function(b){a.$$addBindingClass(b);return function(b,c,e){a.$$addBindingInfo(c,e.ngBind);c=c[0];b.$watch(e.ngBind,function(a){c.textContent=z(a)?"":a})}}}}],Le=["$interpolate","$compile",function(a,b){return{compile:function(d){b.$$addBindingClass(d);return function(c,d,f){c=a(d.attr(f.$attr.ngBindTemplate));b.$$addBindingInfo(d,c.expressions);d=d[0];f.$observe("ngBindTemplate",function(a){d.textContent=z(a)?"":a})}}}}],Ke=["$sce","$parse","$compile",function(a,b,d){return{restrict:"A",compile:function(c,e){var f=b(e.ngBindHtml),g=b(e.ngBindHtml,function(b){return a.valueOf(b)});d.$$addBindingClass(c);return function(b,c,e){d.$$addBindingInfo(c,e.ngBindHtml);b.$watch(g,function(){var d=f(b);c.html(a.getTrustedHtml(d)||"")})}}}}],hf=ma({restrict:"A",require:"ngModel",link:function(a,b,d,c){c.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),Me=xc("",!0),Oe=xc("Odd",0),Ne=xc("Even",1),Pe=Ua({compile:function(a,b){b.$set("ngCloak",void 0);a.removeClass("ng-cloak")}}),Qe=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],Sc={},gh={blur:!0,focus:!0};q("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var b=Ba("ng-"+a);Sc[b]=["$parse","$rootScope",function(d,c){return{restrict:"A",compile:function(e,f){var g=d(f[b],null,!0);return function(b,d){d.on(a,function(d){var e=function(){g(b,{$event:d})};gh[a]&&c.$$phase?b.$evalAsync(e):b.$apply(e)})}}}}]});var Te=["$animate","$compile",function(a,b){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(d,c,e,f,g){var h,k,l;d.$watch(e.ngIf,function(d){d?k||g(function(d,f){k=f;d[d.length++]=b.$$createComment("end ngIf",e.ngIf);h={clone:d};a.enter(d,c.parent(),c)}):(l&&(l.remove(),l=null),k&&(k.$destroy(),k=null),h&&(l=wb(h.clone),a.leave(l).then(function(){l=null}),h=null))})}}}],Ue=["$templateRequest","$anchorScroll","$animate",function(a,b,d){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:ga.noop,compile:function(c,e){var f=e.ngInclude||e.src,g=e.onload||"",h=e.autoscroll;return function(c,e,m,n,p){var q=0,r,t,s,D=function(){t&&(t.remove(),t=null);r&&(r.$destroy(),r=null);s&&(d.leave(s).then(function(){t=null}),t=s,s=null)};c.$watch(f,function(f){var m=function(){!u(h)||h&&!c.$eval(h)||b()},w=++q;f?(a(f,!0).then(function(a){if(!c.$$destroyed&&w===q){var b=c.$new();n.template=a;a=p(b,function(a){D();d.enter(a,null,e).then(m)});r=b;s=a;r.$emit("$includeContentLoaded",f);c.$eval(g)}},function(){c.$$destroyed||w!==q||(D(),c.$emit("$includeContentError",f))}),c.$emit("$includeContentRequested",f)):(D(),n.template=null)})}}}}],lf=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(b,d,c,e){na.call(d[0]).match(/SVG/)?(d.empty(),a(Vc(e.template,B.document).childNodes)(b,function(a){d.append(a)},{futureParentElement:d})):(d.html(e.template),a(d.contents())(b))}}}],Ve=Ua({priority:450,compile:function(){return{pre:function(a,b,d){a.$eval(d.ngInit)}}}}),gf=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(a,b,d,c){var e=b.attr(d.$attr.ngList)||", ",f="false"!==d.ngTrim,g=f?U(e):e;c.$parsers.push(function(a){if(!z(a)){var b=[];a&&q(a.split(g),function(a){a&&b.push(f?U(a):a)});return b}});c.$formatters.push(function(a){if(K(a))return a.join(e)});c.$isEmpty=function(a){return!a||!a.length}}}},rb="ng-valid",ce="ng-invalid",Va="ng-pristine",Pb="ng-dirty",ee="ng-pending",pb=N("ngModel"),hh=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,b,d,c,e,f,g,h,k,l){this.$modelValue=this.$viewValue=Number.NaN;this.$$rawModelValue=void 0;this.$validators={};this.$asyncValidators={};this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$untouched=!0;this.$touched=!1;this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$error={};this.$$success={};this.$pending=void 0;this.$name=l(d.name||"",!1)(a);this.$$parentForm=Ob;var m=e(d.ngModel),n=m.assign,p=m,r=n,J=null,t,s=this;this.$$setOptions=function(a){if((s.$options=a)&&a.getterSetter){var b=e(d.ngModel+"()"),f=e(d.ngModel+"($$$p)");p=function(a){var c=m(a);F(c)&&(c=b(a));return c};r=function(a,b){F(m(a))?f(a,{$$$p:b}):n(a,b)}}else if(!m.assign)throw pb("nonassign",d.ngModel,wa(c))};this.$render=C;this.$isEmpty=function(a){return z(a)||""===a||null===a||a!==a};this.$$updateEmptyClasses=function(a){s.$isEmpty(a)?(f.removeClass(c,"ng-not-empty"),f.addClass(c,"ng-empty")):(f.removeClass(c,"ng-empty"),f.addClass(c,"ng-not-empty"))};var D=0;Zd({ctrl:this,$element:c,set:function(a,b){a[b]=!0},unset:function(a,b){delete a[b]},$animate:f});this.$setPristine=function(){s.$dirty=!1;s.$pristine=!0;f.removeClass(c,Pb);f.addClass(c,Va)};this.$setDirty=function(){s.$dirty=!0;s.$pristine=!1;f.removeClass(c,Va);f.addClass(c,Pb);s.$$parentForm.$setDirty()};this.$setUntouched=function(){s.$touched=!1;s.$untouched=!0;f.setClass(c,"ng-untouched","ng-touched")};this.$setTouched=function(){s.$touched=!0;s.$untouched=!1;f.setClass(c,"ng-touched","ng-untouched")};this.$rollbackViewValue=function(){g.cancel(J);s.$viewValue=s.$$lastCommittedViewValue;s.$render()};this.$validate=function(){if(!X(s.$modelValue)){var a=s.$$rawModelValue,b=s.$valid,c=s.$modelValue,d=s.$options&&s.$options.allowInvalid;s.$$runValidators(a,s.$$lastCommittedViewValue,function(e){d||b===e||(s.$modelValue=e?a:void 0,s.$modelValue!==c&&s.$$writeModelToScope())})}};this.$$runValidators=function(a,b,c){function d(){var c=!0;q(s.$validators,function(d,e){var g=d(a,b);c=c&&g;f(e,g)});return c?!0:(q(s.$asyncValidators,function(a,b){f(b,null)}),!1)}function e(){var c=[],d=!0;q(s.$asyncValidators,function(e,g){var h=e(a,b);if(!h||!F(h.then))throw pb("nopromise",h);f(g,void 0);c.push(h.then(function(){f(g,!0)},function(){d=!1;f(g,!1)}))});c.length?k.all(c).then(function(){g(d)},C):g(!0)}function f(a,b){h===D&&s.$setValidity(a,b)}function g(a){h===D&&c(a)}D++;var h=D;(function(){var a=s.$$parserName||"parse";if(z(t))f(a,null);else return t||(q(s.$validators,function(a,b){f(b,null)}),q(s.$asyncValidators,function(a,b){f(b,null)})),f(a,t),t;return!0})()?d()?e():g(!1):g(!1)};this.$commitViewValue=function(){var a=s.$viewValue;g.cancel(J);if(s.$$lastCommittedViewValue!==a||""===a&&s.$$hasNativeValidators)s.$$updateEmptyClasses(a),s.$$lastCommittedViewValue=a,s.$pristine&&this.$setDirty(),this.$$parseAndValidate()};this.$$parseAndValidate=function(){var b=s.$$lastCommittedViewValue;if(t=z(b)?void 0:!0)for(var c=0;c<s.$parsers.length;c++)if(b=s.$parsers[c](b),z(b)){t=!1;break}X(s.$modelValue)&&(s.$modelValue=p(a));var d=s.$modelValue,e=s.$options&&s.$options.allowInvalid;s.$$rawModelValue=b;e&&(s.$modelValue=b,s.$modelValue!==d&&s.$$writeModelToScope());s.$$runValidators(b,s.$$lastCommittedViewValue,function(a){e||(s.$modelValue=a?b:void 0,s.$modelValue!==d&&s.$$writeModelToScope())})};this.$$writeModelToScope=function(){r(a,s.$modelValue);q(s.$viewChangeListeners,function(a){try{a()}catch(c){b(c)}})};this.$setViewValue=function(a,b){s.$viewValue=a;s.$options&&!s.$options.updateOnDefault||s.$$debounceViewValueCommit(b)};this.$$debounceViewValueCommit=function(b){var c=0,d=s.$options;d&&u(d.debounce)&&(d=d.debounce,Z(d)?c=d:Z(d[b])?c=d[b]:Z(d["default"])&&(c=d["default"]));g.cancel(J);c?J=g(function(){s.$commitViewValue()},c):h.$$phase?s.$commitViewValue():a.$apply(function(){s.$commitViewValue()})};a.$watch(function(){var b=p(a);if(b!==s.$modelValue&&(s.$modelValue===s.$modelValue||b===b)){s.$modelValue=s.$$rawModelValue=b;t=void 0;for(var c=s.$formatters,d=c.length,e=b;d--;)e=c[d](e);s.$viewValue!==e&&(s.$$updateEmptyClasses(e),s.$viewValue=s.$$lastCommittedViewValue=e,s.$render(),s.$$runValidators(s.$modelValue,s.$viewValue,C))}return b})}],ff=["$rootScope",function(a){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:hh,priority:1,compile:function(b){b.addClass(Va).addClass("ng-untouched").addClass(rb);return{pre:function(a,b,e,f){var g=f[0];b=f[1]||g.$$parentForm;g.$$setOptions(f[2]&&f[2].$options);b.$addControl(g);e.$observe("name",function(a){g.$name!==a&&g.$$parentForm.$$renameControl(g,a)});a.$on("$destroy",function(){g.$$parentForm.$removeControl(g)})},post:function(b,c,e,f){var g=f[0];if(g.$options&&g.$options.updateOn)c.on(g.$options.updateOn,function(a){g.$$debounceViewValueCommit(a&&a.type)});c.on("blur",function(){g.$touched||(a.$$phase?b.$evalAsync(g.$setTouched):b.$apply(g.$setTouched))})}}}}}],ih=/(\s+|^)default(\s+|$)/,kf=function(){return{restrict:"A",controller:["$scope","$attrs",function(a,b){var d=this;this.$options=pa(a.$eval(b.ngModelOptions));u(this.$options.updateOn)?(this.$options.updateOnDefault=!1,this.$options.updateOn=U(this.$options.updateOn.replace(ih,function(){d.$options.updateOnDefault=!0;return" "}))):this.$options.updateOnDefault=!0}]}},We=Ua({terminal:!0,priority:1e3}),jh=N("ngOptions"),kh=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,df=["$compile","$document","$parse",function(a,b,d){function c(a,b,c){function e(a,b,c,d,f){this.selectValue=a;this.viewValue=b;this.label=c;this.group=d;this.disabled=f}function f(a){var b;if(!q&&ra(a))b=a;else{b=[];for(var c in a)a.hasOwnProperty(c)&&"$"!==c.charAt(0)&&b.push(c)}return b}var n=a.match(kh);if(!n)throw jh("iexp",a,wa(b));var p=n[5]||n[7],q=n[6];a=/ as /.test(n[0])&&n[1];var r=n[9];b=d(n[2]?n[1]:p);var t=a&&d(a)||b,s=r&&d(r),u=r?function(a,b){return s(c,b)}:function(a){return za(a)},y=function(a,b){return u(a,A(a,b))},z=d(n[2]||n[1]),w=d(n[3]||""),C=d(n[4]||""),F=d(n[8]),B={},A=q?function(a,b){B[q]=b;B[p]=a;return B}:function(a){B[p]=a;return B};return{trackBy:r,getTrackByValue:y,getWatchables:d(F,function(a){var b=[];a=a||[];for(var d=f(a),e=d.length,g=0;g<e;g++){var h=a===d?g:d[g],l=a[h],h=A(l,h),l=u(l,h);b.push(l);if(n[2]||n[1])l=z(c,h),b.push(l);n[4]&&(h=C(c,h),b.push(h))}return b}),getOptions:function(){for(var a=[],b={},d=F(c)||[],g=f(d),h=g.length,n=0;n<h;n++){var p=d===g?n:g[n],q=A(d[p],p),s=t(c,q),p=u(s,q),x=z(c,q),B=w(c,q),q=C(c,q),s=new e(p,s,x,B,q);a.push(s);b[p]=s}return{items:a,selectValueMap:b,getOptionFromViewValue:function(a){return b[y(a)]},getViewValueFromOption:function(a){return r?ga.copy(a.viewValue):a.viewValue}}}}}var e=B.document.createElement("option"),f=B.document.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","ngModel"],link:{pre:function(a,b,c,d){d[0].registerOption=C},post:function(d,h,k,l){function m(a,b){a.element=b;b.disabled=a.disabled;a.label!==b.label&&(b.label=a.label,b.textContent=a.label);a.value!==b.value&&(b.value=a.selectValue)}function n(){var a=w&&p.readValue();if(w)for(var b=w.items.length-1;0<=b;b--){var c=w.items[b];u(c.group)?Gb(c.element.parentNode):Gb(c.element)}w=B.getOptions();var d={};y&&h.prepend(t);w.items.forEach(function(a){var b;if(u(a.group)){b=d[a.group];b||(b=f.cloneNode(!1),F.appendChild(b),b.label=null===a.group?"null":a.group,d[a.group]=b);var c=e.cloneNode(!1)}else b=F,c=e.cloneNode(!1);b.appendChild(c);m(a,c)});h[0].appendChild(F);r.$render();r.$isEmpty(a)||(b=p.readValue(),(B.trackBy||z?oa(a,b):a===b)||(r.$setViewValue(b),r.$render()))}var p=l[0],r=l[1],z=k.multiple,t;l=0;for(var s=h.children(),D=s.length;l<D;l++)if(""===s[l].value){t=s.eq(l);break}var y=!!t,C=E(e.cloneNode(!1));C.val("?");var w,B=c(k.ngOptions,h,d),F=b[0].createDocumentFragment(),H=function(){y?t.removeAttr("selected"):t.remove()};z?(r.$isEmpty=function(a){return!a||0===a.length},p.writeValue=function(a){w.items.forEach(function(a){a.element.selected=!1});a&&a.forEach(function(a){if(a=w.getOptionFromViewValue(a))a.element.selected=!0})},p.readValue=function(){var a=h.val()||[],b=[];q(a,function(a){(a=w.selectValueMap[a])&&!a.disabled&&b.push(w.getViewValueFromOption(a))});return b},B.trackBy&&d.$watchCollection(function(){if(K(r.$viewValue))return r.$viewValue.map(function(a){return B.getTrackByValue(a)})},function(){r.$render()})):(p.writeValue=function(a){var b=w.selectValueMap[h.val()],c=w.getOptionFromViewValue(a);b&&b.element.removeAttribute("selected");c?(h[0].value!==c.selectValue&&(C.remove(),H(),h[0].value=c.selectValue,c.element.selected=!0),c.element.setAttribute("selected","selected")):null===a||y?(C.remove(),y||h.prepend(t),h.val(""),t.prop("selected",!0),t.attr("selected",!0)):(H(),h.prepend(C),h.val("?"),C.prop("selected",!0),C.attr("selected",!0))},p.readValue=function(){var a=w.selectValueMap[h.val()];return a&&!a.disabled?(H(),C.remove(),w.getViewValueFromOption(a)):null},B.trackBy&&d.$watch(function(){return B.getTrackByValue(r.$viewValue)},function(){r.$render()}));y?(t.remove(),a(t)(d),t.removeClass("ng-scope")):t=E(e.cloneNode(!1));h.empty();n();d.$watchCollection(B.getWatchables,n)}}}}],Xe=["$locale","$interpolate","$log",function(a,b,d){var c=/{}/g,e=/^when(Minus)?(.+)$/;return{link:function(f,g,h){function k(a){g.text(a||"")}var l=h.count,m=h.$attr.when&&g.attr(h.$attr.when),n=h.offset||0,p=f.$eval(m)||{},r={},u=b.startSymbol(),t=b.endSymbol(),s=u+l+"-"+n+t,D=ga.noop,y;q(h,function(a,b){var c=e.exec(b);c&&(c=(c[1]?"-":"")+P(c[2]),p[c]=g.attr(h.$attr[b]))});q(p,function(a,d){r[d]=b(a.replace(c,s))});f.$watch(l,function(b){var c=parseFloat(b),e=X(c);e||c in p||(c=a.pluralCat(c-n));c===y||e&&X(y)||(D(),e=r[c],z(e)?(null!=b&&d.debug("ngPluralize: no rule defined for '"+c+"' in "+m),D=C,k()):D=f.$watch(e,k),y=c)})}}}],Ye=["$parse","$animate","$compile",function(a,b,d){var c=N("ngRepeat"),e=function(a,b,c,d,e,m,n){a[c]=d;e&&(a[e]=m);a.$index=b;a.$first=0===b;a.$last=b===n-1;a.$middle=!(a.$first||a.$last);a.$odd=!(a.$even=0===(b&1))};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function(f,g){var h=g.ngRepeat,k=d.$$createComment("end ngRepeat",h),l=h.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!l)throw c("iexp",h);var m=l[1],n=l[2],p=l[3],r=l[4],l=m.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/);if(!l)throw c("iidexp",m);var u=l[3]||l[1],t=l[2];if(p&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(p)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(p)))throw c("badident",p);var s,z,y,C,w={$id:za};r?s=a(r):(y=function(a,b){return za(b)},C=function(a){return a});return function(a,d,f,g,l){s&&(z=function(b,c,d){t&&(w[t]=b);w[u]=c;w.$index=d;return s(a,w)});var m=S();a.$watchCollection(n,function(f){var g,n,s=d[0],r,x=S(),w,B,F,A,H,E,I;p&&(a[p]=f);if(ra(f))H=f,n=z||y;else for(I in n=z||C,H=[],f)sa.call(f,I)&&"$"!==I.charAt(0)&&H.push(I);w=H.length;I=Array(w);for(g=0;g<w;g++)if(B=f===H?g:H[g],F=f[B],A=n(B,F,g),m[A])E=m[A],delete m[A],x[A]=E,I[g]=E;else{if(x[A])throw q(I,function(a){a&&a.scope&&(m[a.id]=a)}),c("dupes",h,A,F);I[g]={id:A,scope:void 0,clone:void 0};x[A]=!0}for(r in m){E=m[r];A=wb(E.clone);b.leave(A);if(A[0].parentNode)for(g=0,n=A.length;g<n;g++)A[g].$$NG_REMOVED=!0;E.scope.$destroy()}for(g=0;g<w;g++)if(B=f===H?g:H[g],F=f[B],E=I[g],E.scope){r=s;do r=r.nextSibling;while(r&&r.$$NG_REMOVED);E.clone[0]!==r&&b.move(wb(E.clone),null,s);s=E.clone[E.clone.length-1];e(E.scope,g,u,F,t,B,w)}else l(function(a,c){E.scope=c;var d=k.cloneNode(!1);a[a.length++]=d;b.enter(a,null,s);s=d;E.clone=a;x[E.id]=E;e(E.scope,g,u,F,t,B,w)});m=x})}}}}],Ze=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,d,c){b.$watch(c.ngShow,function(b){a[b?"removeClass":"addClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Se=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,d,c){b.$watch(c.ngHide,function(b){a[b?"addClass":"removeClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],$e=Ua(function(a,b,d){a.$watch(d.ngStyle,function(a,d){d&&a!==d&&q(d,function(a,c){b.css(c,"")});a&&b.css(a)},!0)}),af=["$animate","$compile",function(a,b){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(d,c,e,f){var g=[],h=[],k=[],l=[],m=function(a,b){return function(){a.splice(b,1)}};d.$watch(e.ngSwitch||e.on,function(c){var d,e;d=0;for(e=k.length;d<e;++d)a.cancel(k[d]);d=k.length=0;for(e=l.length;d<e;++d){var r=wb(h[d].clone);l[d].$destroy();(k[d]=a.leave(r)).then(m(k,d))}h.length=0;l.length=0;(g=f.cases["!"+c]||f.cases["?"])&&q(g,function(c){c.transclude(function(d,e){l.push(e);var f=c.element;d[d.length++]=b.$$createComment("end ngSwitchWhen");h.push({clone:d});a.enter(d,f.parent(),f)})})})}}}],bf=Ua({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,d,c,e){c.cases["!"+d.ngSwitchWhen]=c.cases["!"+d.ngSwitchWhen]||[];c.cases["!"+d.ngSwitchWhen].push({transclude:e,element:b})}}),cf=Ua({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,d,c,e){c.cases["?"]=c.cases["?"]||[];c.cases["?"].push({transclude:e,element:b})}}),lh=N("ngTransclude"),ef=["$compile",function(a){return{restrict:"EAC",terminal:!0,compile:function(b){var d=a(b.contents());b.empty();return function(a,b,f,g,h){function k(){d(a,function(a){b.append(a)})}if(!h)throw lh("orphan",wa(b));f.ngTransclude===f.$attr.ngTransclude&&(f.ngTransclude="");f=f.ngTransclude||f.ngTranscludeSlot;h(function(a,c){a.length?b.append(a):(k(),c.$destroy())},null,f);f&&!h.isSlotFilled(f)&&k()}}}}],Ge=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(b,d){"text/ng-template"===d.type&&a.put(d.id,b[0].text)}}}],mh={$setViewValue:C,$render:C},nh=["$element","$scope",function(a,b){var d=this,c=new Ra;d.ngModelCtrl=mh;d.unknownOption=E(B.document.createElement("option"));d.renderUnknownOption=function(b){b="? "+za(b)+" ?";d.unknownOption.val(b);a.prepend(d.unknownOption);a.val(b)};b.$on("$destroy",function(){d.renderUnknownOption=C});d.removeUnknownOption=function(){d.unknownOption.parent()&&d.unknownOption.remove()};d.readValue=function(){d.removeUnknownOption();return a.val()};d.writeValue=function(b){d.hasOption(b)?(d.removeUnknownOption(),a.val(b),""===b&&d.emptyOption.prop("selected",!0)):null==b&&d.emptyOption?(d.removeUnknownOption(),a.val("")):d.renderUnknownOption(b)};d.addOption=function(a,b){if(8!==b[0].nodeType){Qa(a,'"option value"');""===a&&(d.emptyOption=b);var g=c.get(a)||0;c.put(a,g+1);d.ngModelCtrl.$render();b[0].hasAttribute("selected")&&(b[0].selected=!0)}};d.removeOption=function(a){var b=c.get(a);b&&(1===b?(c.remove(a),""===a&&(d.emptyOption=void 0)):c.put(a,b-1))};d.hasOption=function(a){return!!c.get(a)};d.registerOption=function(a,b,c,h,k){if(h){var l;c.$observe("value",function(a){u(l)&&d.removeOption(l);l=a;d.addOption(a,b)})}else k?a.$watch(k,function(a,e){c.$set("value",a);e!==a&&d.removeOption(e);d.addOption(a,b)}):d.addOption(c.value,b);b.on("$destroy",function(){d.removeOption(c.value);d.ngModelCtrl.$render()})}}],He=function(){return{restrict:"E",require:["select","?ngModel"],controller:nh,priority:1,link:{pre:function(a,b,d,c){var e=c[1];if(e){var f=c[0];f.ngModelCtrl=e;b.on("change",function(){a.$apply(function(){e.$setViewValue(f.readValue())})});if(d.multiple){f.readValue=function(){var a=[];q(b.find("option"),function(b){b.selected&&a.push(b.value)});return a};f.writeValue=function(a){var c=new Ra(a);q(b.find("option"),function(a){a.selected=u(c.get(a.value))})};var g,h=NaN;a.$watch(function(){h!==e.$viewValue||oa(g,e.$viewValue)||(g=ia(e.$viewValue),e.$render());h=e.$viewValue});e.$isEmpty=function(a){return!a||0===a.length}}}},post:function(a,b,d,c){var e=c[1];if(e){var f=c[0];e.$render=function(){f.writeValue(e.$viewValue)}}}}}},Ie=["$interpolate",function(a){return{restrict:"E",priority:100,compile:function(b,d){if(u(d.value))var c=a(d.value,!0);else{var e=a(b.text(),!0);e||d.$set("value",b.text())}return function(a,b,d){var k=b.parent();(k=k.data("$selectController")||k.parent().data("$selectController"))&&k.registerOption(a,b,d,c,e)}}}}],Pc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){c&&(d.required=!0,c.$validators.required=function(a,b){return!d.required||!c.$isEmpty(b)},d.$observe("required",function(){c.$validate()}))}}},Oc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){if(c){var e,f=d.ngPattern||d.pattern;d.$observe("pattern",function(a){H(a)&&0<a.length&&(a=new RegExp("^"+a+"$"));if(a&&!a.test)throw N("ngPattern")("noregexp",f,a,wa(b));e=a||void 0;c.$validate()});c.$validators.pattern=function(a,b){return c.$isEmpty(b)||z(e)||e.test(b)}}}}},Rc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){if(c){var e=-1;d.$observe("maxlength",function(a){a=aa(a);e=X(a)?-1:a;c.$validate()});c.$validators.maxlength=function(a,b){return 0>e||c.$isEmpty(b)||b.length<=e}}}}},Qc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){if(c){var e=0;d.$observe("minlength",function(a){
e=aa(a)||0;c.$validate()});c.$validators.minlength=function(a,b){return c.$isEmpty(b)||b.length>=e}}}}};B.angular.bootstrap?B.console&&console.log("WARNING: Tried to load angular more than once."):(ze(),Be(ga),ga.module("ngLocale",[],["$provide",function(a){function b(a){a+="";var b=a.indexOf(".");return-1==b?0:a.length-b-1}a.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:"January February March April May June July August September October November December".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),STANDALONEMONTH:"January February March April May June July August September October November December".split(" "),WEEKENDRANGE:[5,6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a","short":"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"en-us",localeID:"en_US",pluralCat:function(a,c){var e=a|0,f=c;void 0===f&&(f=Math.min(b(a),3));Math.pow(10,f);return 1==e&&0==f?"one":"other"}})}]),E(B.document).ready(function(){ue(B.document,Ic)}))})(window);!window.angular.$$csp().noInlineStyle&&window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>');function controllerProviderDecorator(t,e){var r=t.register;t.register=function(t,n){return e.register(t,n),r.apply(this,arguments)}}function $controllerIntrospectorProvider(){var t=[],e=null;return{register:function(r,n){angular.isArray(n)&&(n=n[n.length-1]),n.$routeConfig&&(e?e(r,n.$routeConfig):t.push({name:r,config:n.$routeConfig}))},$get:["$componentLoader",function(r){return function(n){for(e=function(t,e){return t=r.component(t),n(t,e)};t.length>0;){var o=t.pop();e(o.name,o.config)}}}]}}function routerFactory(t,e,r,n,o){o(function(t,e){n.config(t,e)}),e.$watch(function(){return r.path()},function(e){t.navigate(e)});var i=t.navigate;return t.navigate=function(t){return i.call(this,t).then(function(t){t&&r.path(t)})},t}function ngViewportDirective(t,e,r,n){function o(t,r,n){return e.invoke(t,r,n.locals)}function i(e,n,i,u,s){function p(){g&&(t.cancel(g),g=null),l&&(l.$destroy(),l=null),v&&(g=t.leave(v),g.then(function(){g=null}),v=null)}var l,f,h,v,g,d,m=i.ngViewport||"default",y=u[0],w=u[1],$=y&&y.$$router||c;$.registerViewport({canDeactivate:function(t){return h&&h.canDeactivate?o(h.canDeactivate,h,t):!0},activate:function(i){var c=a(i);if(c!==d){i.locals.$scope=f=e.$new(),w.$$router=i.router,w.$$template=i.template;var u=i.component,g=s(f,function(e){t.enter(e,null,v||n),p()}),m=i.controller;f[u]=m;var y;if(h&&h.deactivate&&(y=r.when(o(h.deactivate,h,i))),h=m,v=g,l=f,d=c,m.activate){var $=r.when(o(m.activate,m,i));return y?y.then($):$}return y}}},m)}function a(t){return JSON.stringify({path:t.path,component:t.component,params:Object.keys(t.params).reduce(function(e,r){return"childRoute"!==r&&(e[r]=t.params[r]),e},{})})}var c=n;return{restrict:"AE",transclude:"element",terminal:!0,priority:400,require:["?^^ngViewport","ngViewport"],link:i,controller:function(){},controllerAs:"$$ngViewport"}}function ngViewportFillContentDirective(t){return{restrict:"EA",priority:-400,require:"ngViewport",link:function(e,r,n,o){var i=o.$$template;r.html(i);var a=t(r.contents());a(e)}}}function makeComponentString(t){return['<router-component component-name="',t,'">',"</router-component>"].join("")}function ngLinkDirective(t,e,r){function n(t,e,n,i){var a=i&&i.$$router||o;if(a){var c,u=n.ngLink||"",s=u.match(LINK_MICROSYNTAX_RE),p=s[1],l=s[2];if(l){var f=r(l);if(f.constant){var h=f();c="."+a.generate(p,h),e.attr("href",c)}else t.$watch(function(){return f(t)},function(t){c="."+a.generate(p,t),e.attr("href",c)},!0)}else c="."+a.generate(p),e.attr("href",c)}}var o=t;return{require:"?^^ngViewport",restrict:"A",link:n}}function anchorLinkDirective(t){return{restrict:"E",link:function(e,r){if("a"===r[0].nodeName.toLowerCase()){var n="[object SVGAnimatedString]"===Object.prototype.toString.call(r.prop("href"))?"xlink:href":"href";r.on("click",function(e){var o=r.attr(n);o||e.preventDefault(),t.recognize(o)&&(t.navigate(o),e.preventDefault())})}}}}function setupRoutersStepFactory(){return function(t){return t.router.makeDescendantRouters(t)}}function initLocalsStepFactory(){return function(t){return t.router.traverseInstruction(t,function(t){return t.locals={$router:t.router,$routeParams:t.params||{}}})}}function initControllersStepFactory(t,e){return function(r){return r.router.traverseInstruction(r,function(r){var n,o=e.controllerName(r.component),i=r.locals;try{n=t(o,i)}catch(a){console.warn&&console.warn("Could not instantiate controller",o),n=t(angular.noop,i)}return r.controller=n})}}function runCanDeactivateHookStepFactory(){return function(t){return t.router.canDeactivatePorts(t)}}function runCanActivateHookStepFactory(t){function e(e,r,n){return t.invoke(e,r,{$routeParams:n.params})}return function(t){return t.router.traverseInstruction(t,function(t){var r=t.controller;return!r.canActivate||e(r.canActivate,r,t)})}}function loadTemplatesStepFactory(t,e){return function(r){return r.router.traverseInstruction(r,function(r){var n=t.template(r.component);return e(n).then(function(t){return r.template=t})})}}function activateStepValue(t){return t.router.activatePorts(t)}function pipelineProvider(){var t,e=["$setupRoutersStep","$initLocalsStep","$initControllersStep","$runCanDeactivateHookStep","$runCanActivateHookStep","$loadTemplatesStep","$activateStep"];return{steps:e.slice(0),config:function(t){e=t},$get:["$injector","$q",function(r,n){return t=e.map(function(t){return r.get(t)}),{process:function(e){function r(t){if(0===o.length)return t;var i=o.shift();return n.when(i(e)).then(r)}var o=t.slice(0);return r()}}}]}}function $componentLoaderProvider(){var t="Controller",e=function(e){return e[0].toUpperCase()+e.substr(1)+t},r=function(t){var e=dashCase(t);return"./components/"+e+"/"+e+".html"},n=function(e){return e[0].toLowerCase()+e.substr(1,e.length-t.length-1)};return{$get:function(){return{controllerName:e,template:r,component:n}},setCtrlNameMapping:function(t){return e=t,this},setComponentFromCtrlMapping:function(t){return n=t,this},setTemplateMapping:function(t){return r=t,this}}}function privatePipelineFactory(t){return t}function dashCase(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}angular.module("ngNewRouter",[]).factory("$router",routerFactory).value("$routeParams",{}).provider("$componentLoader",$componentLoaderProvider).provider("$pipeline",pipelineProvider).factory("$$pipeline",privatePipelineFactory).factory("$setupRoutersStep",setupRoutersStepFactory).factory("$initLocalsStep",initLocalsStepFactory).factory("$initControllersStep",initControllersStepFactory).factory("$runCanDeactivateHookStep",runCanDeactivateHookStepFactory).factory("$runCanActivateHookStep",runCanActivateHookStepFactory).factory("$loadTemplatesStep",loadTemplatesStepFactory).value("$activateStep",activateStepValue).directive("ngViewport",ngViewportDirective).directive("ngViewport",ngViewportFillContentDirective).directive("ngLink",ngLinkDirective).directive("a",anchorLinkDirective),angular.module("ng").provider("$controllerIntrospector",$controllerIntrospectorProvider).config(controllerProviderDecorator),controllerProviderDecorator.$inject=["$controllerProvider","$controllerIntrospectorProvider"],routerFactory.$inject=["$$rootRouter","$rootScope","$location","$$grammar","$controllerIntrospector"],ngViewportDirective.$inject=["$animate","$injector","$q","$router"],ngViewportFillContentDirective.$inject=["$compile"];var LINK_MICROSYNTAX_RE=/^(.+?)(?:\((.*)\))?$/;ngLinkDirective.$inject=["$router","$location","$parse"],anchorLinkDirective.$inject=["$router"],initControllersStepFactory.$inject=["$controller","$componentLoader"],runCanActivateHookStepFactory.$inject=["$injector"],loadTemplatesStepFactory.$inject=["$componentLoader","$templateRequest"],privatePipelineFactory.$inject=["$pipeline"],angular.module("ngNewRouter").factory("$$rootRouter",["$q","$$grammar","$$pipeline",function(t,e,r){function n(t,e,r,n){return h(e,"constructor",{value:t,configurable:!0,enumerable:!1,writable:!0}),arguments.length>3?("function"==typeof n&&(t.__proto__=n),t.prototype=g(o(n),i(e))):t.prototype=e,h(t,"prototype",{configurable:!1,writable:!1}),v(t,i(r))}function o(t){if("function"==typeof t){var e=t.prototype;if(Object(e)===e||null===e)return t.prototype;throw new TypeError("super prototype must be an Object or null")}if(null===t)return null;throw new TypeError("Super expression must either be null or a function, not "+typeof t+".")}function i(t){for(var e={},r=m(t),n=0;n<r.length;n++){var o=r[n];e[o]=d(t,o)}return e}function a(t,e){var r=y(t);do{var n=d(r,e);if(n)return n;r=y(r)}while(r);return void 0}function c(t,e,r,n){return u(t,e,r).apply(t,n)}function u(t,e,r){var n=a(e,r);return n?n.get?n.get.call(t):n.value:void 0}function s(t,e){Object.keys(t).forEach(function(r){return e(t[r],r)})}function p(e,r){return t.all(l(e,r))}function l(t,e){var r=[];return Object.keys(t).forEach(function(n){return r.push(e(t[n],n))}),r}function f(e){return e?t.when(e):t.reject()}var h=Object.defineProperty,v=Object.defineProperties,g=Object.create,d=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,y=Object.getPrototypeOf,w=function(t,e,r,n){this.name=n,this.parent=r||null,this.navigating=!1,this.ports={},this.children={},this.registry=t,this.pipeline=e};n(w,{childRouter:function(){var t=void 0!==arguments[0]?arguments[0]:"default";return this.children[t]||(this.children[t]=new C(this,t)),this.children[t]},registerViewport:function(t){var e=void 0!==arguments[1]?arguments[1]:"default";return this.ports[e]=t,this.renavigate()},config:function(t){return this.registry.config(this.name,t),this.renavigate()},navigate:function(e){var r=this;if(this.navigating)return t.when();this.lastNavigationAttempt=e;var n=this.recognize(e);return n?(this._startNavigating(),n.router=this,this.pipeline.process(n).then(function(){return r._finishNavigating()},function(){return r._finishNavigating()}).then(function(){return n.canonicalUrl})):t.reject()},_startNavigating:function(){this.navigating=!0},_finishNavigating:function(){this.navigating=!1},makeDescendantRouters:function(t){this.traverseInstructionSync(t,function(t,e){e.router=t.router.childRouter(e.component)})},traverseInstructionSync:function(t,e){var r=this;s(t.viewports,function(r){return e(t,r)}),s(t.viewports,function(t){return r.traverseInstructionSync(t,e)})},traverseInstruction:function(e,r){return e?p(e.viewports,function(t,e){return f(r(t,e))}).then(function(){return p(e.viewports,function(t){return t.router.traverseInstruction(t,r)})}):t.when()},activatePorts:function(t){return this.queryViewports(function(e,r){return e.activate(t.viewports[r])}).then(function(){return p(t.viewports,function(t){return t.router.activatePorts(t)})})},canDeactivatePorts:function(t){return this.traversePorts(function(e,r){return f(e.canDeactivate(t.viewports[r]))})},traversePorts:function(t){var e=this;return this.queryViewports(t).then(function(){return p(e.children,function(e){return e.traversePorts(t)})})},queryViewports:function(t){return p(this.ports,t)},recognize:function(t){return this.registry.recognize(t)},renavigate:function(){var e=this.previousUrl||this.lastNavigationAttempt;return!this.navigating&&e?this.navigate(e):t.when()},generate:function(t,e){return this.registry.generate(t,e)}},{}),Object.defineProperty(w,"parameters",{get:function(){return[[Grammar],[Pipeline],[],[]]}}),Object.defineProperty(w.prototype.generate,"parameters",{get:function(){return[[$traceurRuntime.type.string],[]]}});var $=function(t,e){c(this,S.prototype,"constructor",[t,e,null,"/"])},S=$;n($,{},{},w),Object.defineProperty($,"parameters",{get:function(){return[[Grammar],[Pipeline]]}});var C=function(t,e){c(this,b.prototype,"constructor",[t.registry,t.pipeline,t,e]),this.parent=t},b=C;return n(C,{},{},w),new $(e,r)}]),angular.module("ngNewRouter").factory("$$grammar",["$q",function(){function t(t,n,o,i){return a(n,"constructor",{value:t,configurable:!0,enumerable:!1,writable:!0}),arguments.length>3?("function"==typeof i&&(t.__proto__=i),t.prototype=u(e(i),r(n))):t.prototype=n,a(t,"prototype",{configurable:!1,writable:!1}),c(t,r(o))}function e(t){if("function"==typeof t){var e=t.prototype;if(Object(e)===e||null===e)return t.prototype;throw new TypeError("super prototype must be an Object or null")}if(null===t)return null;throw new TypeError("Super expression must either be null or a function, not "+typeof t+".")}function r(t){for(var e={},r=p(t),n=0;n<r.length;n++){var o=r[n];e[o]=s(t,o)}return e}function n(t){return JSON.parse(JSON.stringify(t))}function o(t,e){Object.keys(t).forEach(function(r){return e(t[r],r)})}function i(t,e){var r=[];return Object.keys(t).forEach(function(n){return r.push(e(t[n],n))}),r}var a=Object.defineProperty,c=Object.defineProperties,u=Object.create,s=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,l=(Object.getPrototypeOf,function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t){this.string=t}function r(t){this.name=t}function n(t){this.name=t}function o(){}function i(t,i,a){"/"===t.charAt(0)&&(t=t.substr(1));for(var c=t.split("/"),u=[],s=0,p=c.length;p>s;s++){var l,f=c[s];(l=f.match(/^:([^\/]+)$/))?(u.push(new r(l[1])),i.push(l[1]),a.dynamics++):(l=f.match(/^\*([^\/]+)$/))?(u.push(new n(l[1])),i.push(l[1]),a.stars++):""===f?u.push(new o):(u.push(new e(f)),a.statics++)}return u}function a(t){this.charSpec=t,this.nextStates=[]}function c(t){return t.sort(function(t,e){if(t.types.stars!==e.types.stars)return t.types.stars-e.types.stars;if(t.types.stars){if(t.types.statics!==e.types.statics)return e.types.statics-t.types.statics;if(t.types.dynamics!==e.types.dynamics)return e.types.dynamics-t.types.dynamics}return t.types.dynamics!==e.types.dynamics?t.types.dynamics-e.types.dynamics:t.types.statics!==e.types.statics?e.types.statics-t.types.statics:0})}function u(t,e){for(var r=[],n=0,o=t.length;o>n;n++){var i=t[n];r=r.concat(i.match(e))}return r}function s(t){this.queryParams=t||{}}function p(t,e,r){for(var n=t.handlers,o=t.regex,i=e.match(o),a=1,c=new s(r),u=0,p=n.length;p>u;u++){for(var l=n[u],f=l.names,h={},v=0,g=f.length;g>v;v++)h[f[v]]=i[a++];c.push({handler:l.handler,params:h,isDynamic:!!f.length})}return c}function l(t,e){return e.eachChar(function(e){t=t.put(e)}),t}var f=function(){function t(t,e,r){this.path=t,this.matcher=e,this.delegate=r}function e(t){this.routes={},this.children={},this.target=t}function r(e,n,o){return function(i,a){var c=e+i;return a?void a(r(c,n,o)):new t(e+i,n,o)}}function n(t,e,r){for(var n=0,o=0,i=t.length;i>o;o++)n+=t[o].path.length;e=e.substr(n);var a={path:e,handler:r};t.push(a)}function o(t,e,r,i){var a=e.routes;for(var c in a)if(a.hasOwnProperty(c)){var u=t.slice();n(u,c,a[c]),e.children[c]?o(u,e.children[c],r,i):r.call(i,u)}}return t.prototype={to:function(t,e){var r=this.delegate;if(r&&r.willAddRoute&&(t=r.willAddRoute(this.matcher.target,t)),this.matcher.add(this.path,t),e){if(0===e.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,t,e,this.delegate)}return this}},e.prototype={add:function(t,e){this.routes[t]=e},addChild:function(t,n,o,i){var a=new e(n);this.children[t]=a;var c=r(t,a,i);i&&i.contextEntered&&i.contextEntered(n,c),o(c)}},function(t,n){var i=new e;t(r("",i,this.delegate)),o([],i,function(t){n?n(this,t):this.add(t)},this)}}(),h=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],v=new RegExp("(\\"+h.join("|\\")+")","g");e.prototype={eachChar:function(t){for(var e,r=this.string,n=0,o=r.length;o>n;n++)e=r.charAt(n),t({validChars:e})},regex:function(){return this.string.replace(v,"\\$1")},generate:function(){return this.string}},r.prototype={eachChar:function(t){t({invalidChars:"/",repeat:!0})},regex:function(){return"([^/]+)"},generate:function(t){return t[this.name]}},n.prototype={eachChar:function(t){t({invalidChars:"",repeat:!0})},regex:function(){return"(.+)"},generate:function(t){return t[this.name]}},o.prototype={eachChar:function(){},regex:function(){return""},generate:function(){return""}},a.prototype={get:function(t){for(var e=this.nextStates,r=0,n=e.length;n>r;r++){var o=e[r],i=o.charSpec.validChars===t.validChars;if(i=i&&o.charSpec.invalidChars===t.invalidChars)return o}},put:function(t){var e;return(e=this.get(t))?e:(e=new a(t),this.nextStates.push(e),t.repeat&&e.nextStates.push(e),e)},match:function(t){for(var e,r,n,o=this.nextStates,i=[],a=0,c=o.length;c>a;a++)e=o[a],r=e.charSpec,"undefined"!=typeof(n=r.validChars)?-1!==n.indexOf(t)&&i.push(e):"undefined"!=typeof(n=r.invalidChars)&&-1===n.indexOf(t)&&i.push(e);return i}};var g=Object.create||function(t){function e(){}return e.prototype=t,new e};s.prototype=g({splice:Array.prototype.splice,slice:Array.prototype.slice,push:Array.prototype.push,length:0,queryParams:null});var d=function(){this.rootState=new a,this.names={}};return d.prototype={add:function(t,e){for(var r,n=this.rootState,a="^",c={statics:0,dynamics:0,stars:0},u=[],s=[],p=!0,f=0,h=t.length;h>f;f++){var v=t[f],g=[],d=i(v.path,g,c);s=s.concat(d);for(var m=0,y=d.length;y>m;m++){var w=d[m];w instanceof o||(p=!1,n=n.put({validChars:"/"}),a+="/",n=l(n,w),a+=w.regex())}var $={handler:v.handler,names:g};u.push($)}p&&(n=n.put({validChars:"/"}),a+="/"),n.handlers=u,n.regex=new RegExp(a+"$"),n.types=c,(r=e&&e.as)&&(this.names[r]={segments:s,handlers:u})},handlersFor:function(t){var e=this.names[t],r=[];if(!e)throw new Error("There is no route named "+t);for(var n=0,o=e.handlers.length;o>n;n++)r.push(e.handlers[n]);return r},hasRoute:function(t){return!!this.names[t]},generate:function(t,e){var r=this.names[t],n="";if(!r)throw new Error("There is no route named "+t);for(var i=r.segments,a=0,c=i.length;c>a;a++){var u=i[a];u instanceof o||(n+="/",n+=u.generate(e))}return"/"!==n.charAt(0)&&(n="/"+n),e&&e.queryParams&&(n+=this.generateQueryString(e.queryParams,r.handlers)),n},generateQueryString:function(e){var r=[],n=[];for(var o in e)e.hasOwnProperty(o)&&n.push(o);n.sort();for(var i=0,a=n.length;a>i;i++){o=n[i];var c=e[o];if(null!=c){var u=encodeURIComponent(o);if(t(c))for(var s=0,p=c.length;p>s;s++){var l=o+"[]="+encodeURIComponent(c[s]);r.push(l)}else u+="="+encodeURIComponent(c),r.push(u)}}return 0===r.length?"":"?"+r.join("&")},parseQueryString:function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o,i=e[n].split("="),a=decodeURIComponent(i[0]),c=a.length,u=!1;1===i.length?o="true":(c>2&&"[]"===a.slice(c-2)&&(u=!0,a=a.slice(0,c-2),r[a]||(r[a]=[])),o=i[1]?decodeURIComponent(i[1]):""),u?r[a].push(o):r[a]=o}return r},recognize:function(t){var e,r,n,o,i=[this.rootState],a={},s=!1;if(o=t.indexOf("?"),-1!==o){var l=t.substr(o+1,t.length);t=t.substr(0,o),a=this.parseQueryString(l)}for(t=decodeURI(t),"/"!==t.charAt(0)&&(t="/"+t),e=t.length,e>1&&"/"===t.charAt(e-1)&&(t=t.substr(0,e-1),s=!0),r=0,n=t.length;n>r&&(i=u(i,t.charAt(r)),i.length);r++);var f=[];for(r=0,n=i.length;n>r;r++)i[r].handlers&&f.push(i[r]);i=c(f);var h=f[0];return h&&h.handlers?(s&&"(.+)$"===h.regex.source.slice(-5)&&(t+="/"),p(h,t,a)):void 0}},d.prototype.map=f,d.VERSION="VERSION_STRING_PLACEHOLDER",d}()),f="/*childRoute",h=function(){this.rules={}};t(h,{config:function(t,e){"app"===t&&(t="/"),this.rules[t]||(this.rules[t]=new v(t)),this.rules[t].config(e)},recognize:function(t){var e=void 0!==arguments[1]?arguments[1]:"/",r=this;if("undefined"!=typeof t){var n=this.rules[e];if(n){var i=n.recognize(t);if(i){var a=i[i.length-1],c=a.handler,u=a.params,s={viewports:{},params:u};if(u&&u.childRoute){var p="/"+u.childRoute;s.canonicalUrl=c.rewroteUrl.substr(0,c.rewroteUrl.length-(u.childRoute.length+1)),o(c.components,function(t,e){s.viewports[e]=r.recognize(p,t)}),s.canonicalUrl+=s.viewports[Object.keys(s.viewports)[0]].canonicalUrl}else s.canonicalUrl=c.rewroteUrl,o(c.components,function(t,e){s.viewports[e]={viewports:{}}});return o(s.viewports,function(t,e){t.component=c.components[e],t.params=u}),s}}}},generate:function(t,e){var r,n="";do{if(r=null,o(this.rules,function(o){o.hasRoute(t)&&(n=o.generate(t,e)+n,r=o)}),!r)return"";t=r.name}while("/"!==r.name);return n}},{}),Object.defineProperty(h.prototype.recognize,"parameters",{get:function(){return[[$traceurRuntime.type.string],[]]}});var v=function(t){this.name=t,this.rewrites={},this.recognizer=new l};return t(v,{config:function(t){var e=this;t instanceof Array?t.forEach(function(t){return e.configOne(t)}):this.configOne(t)},getCanonicalUrl:function(t){return"."===t[0]&&(t=t.substr(1)),(""===t||"/"!==t[0])&&(t="/"+t),o(this.rewrites,function(e,r){"/"===r?"/"===t&&(t=e):0===t.indexOf(r)&&(t=t.replace(r,e))}),t},configOne:function(t){var e=this;if(t.redirectTo){if(this.rewrites[t.path])throw new Error('"'+t.path+'" already maps to "'+this.rewrites[t.path]+'"');return void(this.rewrites[t.path]=t.redirectTo)}if(t.component){if(t.components)throw new Error('A route config should have either a "component" or "components" property, but not both.');t.components=t.component,delete t.component}"string"==typeof t.components&&(t.components={"default":t.components});var r;t.as?r=[t.as]:(r=i(t.components,function(t,e){return e+":"+t}),t.components["default"]&&r.push(t.components["default"])),r.forEach(function(r){return e.recognizer.add([{path:t.path,handler:t}],{as:r})});var o=n(t);o.path+=f,this.recognizer.add([{path:o.path,handler:o}])},recognize:function(t){var e=this.getCanonicalUrl(t),r=this.recognizer.recognize(e);return r&&(r[0].handler.rewroteUrl=e),r},generate:function(t,e){return this.recognizer.generate(t,e)},hasRoute:function(t){return this.recognizer.hasRoute(t)}},{}),new h}]);(function(H,u,Sa){"use strict";function wa(a,b,c){if(!a)throw ngMinErr("areq",b||"?",c||"required");return a}function xa(a,b){if(!a&&!b)return"";if(!a)return b;if(!b)return a;X(a)&&(a=a.join(" "));X(b)&&(b=b.join(" "));return a+" "+b}function Ia(a){var b={};a&&(a.to||a.from)&&(b.to=a.to,b.from=a.from);return b}function T(a,b,c){var d="";a=X(a)?a:a&&I(a)&&a.length?a.split(/\s+/):[];q(a,function(a,s){a&&0<a.length&&(d+=0<s?" ":"",d+=c?b+a:a+b)});return d}function Ja(a){if(a instanceof L)switch(a.length){case 0:return[];case 1:if(1===a[0].nodeType)return a;break;default:return L(ma(a))}if(1===a.nodeType)return L(a)}function ma(a){if(!a[0])return a;for(var b=0;b<a.length;b++){var c=a[b];if(1==c.nodeType)return c}}function Ka(a,b,c){q(b,function(b){a.addClass(b,c)})}function La(a,b,c){q(b,function(b){a.removeClass(b,c)})}function N(a){return function(b,c){c.addClass&&(Ka(a,b,c.addClass),c.addClass=null);c.removeClass&&(La(a,b,c.removeClass),c.removeClass=null)}}function ia(a){a=a||{};if(!a.$$prepared){var b=a.domOperation||M;a.domOperation=function(){a.$$domOperationFired=!0;b();b=M};a.$$prepared=!0}return a}function da(a,b){ya(a,b);za(a,b)}function ya(a,b){b.from&&(a.css(b.from),b.from=null)}function za(a,b){b.to&&(a.css(b.to),b.to=null)}function Q(a,b,c){var d=(b.addClass||"")+" "+(c.addClass||""),e=(b.removeClass||"")+" "+(c.removeClass||"");a=Ma(a.attr("class"),d,e);c.preparationClasses&&(b.preparationClasses=Y(c.preparationClasses,b.preparationClasses),delete c.preparationClasses);d=b.domOperation!==M?b.domOperation:null;Aa(b,c);d&&(b.domOperation=d);b.addClass=a.addClass?a.addClass:null;b.removeClass=a.removeClass?a.removeClass:null;return b}function Ma(a,b,c){function d(a){I(a)&&(a=a.split(" "));var b={};q(a,function(a){a.length&&(b[a]=!0)});return b}var e={};a=d(a);b=d(b);q(b,function(a,b){e[b]=1});c=d(c);q(c,function(a,b){e[b]=1===e[b]?null:-1});var s={addClass:"",removeClass:""};q(e,function(b,c){var e,d;1===b?(e="addClass",d=!a[c]):-1===b&&(e="removeClass",d=a[c]);d&&(s[e].length&&(s[e]+=" "),s[e]+=c)});return s}function B(a){return a instanceof u.element?a[0]:a}function Na(a,b,c){var d="";b&&(d=T(b,"ng-",!0));c.addClass&&(d=Y(d,T(c.addClass,"-add")));c.removeClass&&(d=Y(d,T(c.removeClass,"-remove")));d.length&&(c.preparationClasses=d,a.addClass(d))}function ja(a,b){var c=b?"-"+b+"s":"";ea(a,[fa,c]);return[fa,c]}function na(a,b){var c=b?"paused":"",d=U+"PlayState";ea(a,[d,c]);return[d,c]}function ea(a,b){a.style[b[0]]=b[1]}function Y(a,b){return a?b?a+" "+b:a:b}function Ba(a,b,c){var d=Object.create(null),e=a.getComputedStyle(b)||{};q(c,function(a,b){var c=e[a];if(c){var v=c.charAt(0);if("-"===v||"+"===v||0<=v)c=Oa(c);0===c&&(c=null);d[b]=c}});return d}function Oa(a){var b=0;a=a.split(/\s*,\s*/);q(a,function(a){"s"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));a=parseFloat(a)||0;b=b?Math.max(a,b):a});return b}function oa(a){return 0===a||null!=a}function Ca(a,b){var c=O,d=a+"s";b?c+="Duration":d+=" linear all";return[c,d]}function Da(){var a=Object.create(null);return{flush:function(){a=Object.create(null)},count:function(b){return(b=a[b])?b.total:0},get:function(b){return(b=a[b])&&b.value},put:function(b,c){a[b]?a[b].total++:a[b]={total:1,value:c}}}}function Ea(a,b,c){q(c,function(c){a[c]=V(a[c])?a[c]:b.style.getPropertyValue(c)})}var M=u.noop,Aa=u.extend,L=u.element,q=u.forEach,X=u.isArray,I=u.isString,pa=u.isObject,qa=u.isUndefined,V=u.isDefined,Fa=u.isFunction,ra=u.isElement,O,sa,U,ta;qa(H.ontransitionend)&&V(H.onwebkittransitionend)?(O="WebkitTransition",sa="webkitTransitionEnd transitionend"):(O="transition",sa="transitionend");qa(H.onanimationend)&&V(H.onwebkitanimationend)?(U="WebkitAnimation",ta="webkitAnimationEnd animationend"):(U="animation",ta="animationend");var ka=U+"Delay",ua=U+"Duration",fa=O+"Delay";H=O+"Duration";var Pa={transitionDuration:H,transitionDelay:fa,transitionProperty:O+"Property",animationDuration:ua,animationDelay:ka,animationIterationCount:U+"IterationCount"},Qa={transitionDuration:H,transitionDelay:fa,animationDuration:ua,animationDelay:ka};u.module("ngAnimate",[]).directive("ngAnimateChildren",[function(){return function(a,b,c){a=c.ngAnimateChildren;u.isString(a)&&0===a.length?b.data("$$ngAnimateChildren",!0):c.$observe("ngAnimateChildren",function(a){b.data("$$ngAnimateChildren","on"===a||"true"===a)})}}]).factory("$$rAFScheduler",["$$rAF",function(a){function b(a){d=d.concat(a);c()}function c(){if(d.length){for(var b=d.shift(),h=0;h<b.length;h++)b[h]();e||a(function(){e||c()})}}var d,e;d=b.queue=[];b.waitUntilQuiet=function(b){e&&e();e=a(function(){e=null;b();c()})};return b}]).factory("$$AnimateRunner",["$q","$sniffer","$$animateAsyncRun",function(a,b,c){function d(a){this.setHost(a);this._doneCallbacks=[];this._runInAnimationFrame=c();this._state=0}d.chain=function(a,b){function c(){if(d===a.length)b(!0);else a[d](function(a){!1===a?b(!1):(d++,c())})}var d=0;c()};d.all=function(a,b){function c(h){v=v&&h;++d===a.length&&b(v)}var d=0,v=!0;q(a,function(a){a.done(c)})};d.prototype={setHost:function(a){this.host=a||{}},done:function(a){2===this._state?a():this._doneCallbacks.push(a)},progress:M,getPromise:function(){if(!this.promise){var b=this;this.promise=a(function(a,c){b.done(function(b){!1===b?c():a()})})}return this.promise},then:function(a,b){return this.getPromise().then(a,b)},"catch":function(a){return this.getPromise()["catch"](a)},"finally":function(a){return this.getPromise()["finally"](a)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end();this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel();this._resolve(!1)},complete:function(a){var b=this;0===b._state&&(b._state=1,b._runInAnimationFrame(function(){b._resolve(a)}))},_resolve:function(a){2!==this._state&&(q(this._doneCallbacks,function(b){b(a)}),this._doneCallbacks.length=0,this._state=2)}};return d}]).factory("$$animateAsyncRun",["$$rAF",function(a){function b(b){c.push(b);1<c.length||a(function(){for(var a=0;a<c.length;a++)c[a]();c=[]})}var c=[];return function(){var a=!1;b(function(){a=!0});return function(c){a?c():b(c)}}}]).provider("$$animateQueue",["$animateProvider",function(a){function b(a,b,c,q){return d[a].some(function(a){return a(b,c,q)})}function c(a,b){a=a||{};var c=0<(a.addClass||"").length,d=0<(a.removeClass||"").length;return b?c&&d:c||d}var d=this.rules={skip:[],cancel:[],join:[]};d.join.push(function(a,b,d){return!b.structural&&c(b.options)});d.skip.push(function(a,b,d){return!b.structural&&!c(b.options)});d.skip.push(function(a,b,c){return"leave"==c.event&&b.structural});d.skip.push(function(a,b,c){return c.structural&&2===c.state&&!b.structural});d.cancel.push(function(a,b,c){return c.structural&&b.structural});d.cancel.push(function(a,b,c){return 2===c.state&&b.structural});d.cancel.push(function(a,b,c){a=b.options;c=c.options;return a.addClass&&a.addClass===c.removeClass||a.removeClass&&a.removeClass===c.addClass});this.$get=["$$rAF","$rootScope","$rootElement","$document","$$HashMap","$$animation","$$AnimateRunner","$templateRequest","$$jqLite","$$forceReflow",function(d,s,h,g,v,r,$,u,R,C){function D(){var a=!1;return function(b){a?b():s.$$postDigest(function(){a=!0;b()})}}function K(a,b,c){var f=B(b),d=B(a),n=[];(a=t[c])&&q(a,function(a){a.node.contains(f)?n.push(a.callback):"leave"===c&&a.node.contains(d)&&n.push(a.callback)});return n}function l(a,f,k){function n(b,c,f,t){R(function(){var b=K(v,a,c);b.length&&d(function(){q(b,function(b){b(a,f,t)})})});b.progress(c,f,t)}function t(b){var c=a,f=k;f.preparationClasses&&(c.removeClass(f.preparationClasses),f.preparationClasses=null);f.activeClasses&&(c.removeClass(f.activeClasses),f.activeClasses=null);Ha(a,k);da(a,k);k.domOperation();h.complete(!b)}var A,v;if(a=Ja(a))A=B(a),v=a.parent();k=ia(k);var h=new $,R=D();X(k.addClass)&&(k.addClass=k.addClass.join(" "));k.addClass&&!I(k.addClass)&&(k.addClass=null);X(k.removeClass)&&(k.removeClass=k.removeClass.join(" "));k.removeClass&&!I(k.removeClass)&&(k.removeClass=null);k.from&&!pa(k.from)&&(k.from=null);k.to&&!pa(k.to)&&(k.to=null);if(!A)return t(),h;var z=[A.className,k.addClass,k.removeClass].join(" ");if(!Ra(z))return t(),h;var l=0<=["enter","move","leave"].indexOf(f),g=!G||F.get(A),z=!g&&m.get(A)||{},C=!!z.state;g||C&&1==z.state||(g=!la(a,v,f));if(g)return t(),h;l&&y(a);g={structural:l,element:a,event:f,close:t,options:k,runner:h};if(C){if(b("skip",a,g,z)){if(2===z.state)return t(),h;Q(a,z.options,k);return z.runner}if(b("cancel",a,g,z))if(2===z.state)z.runner.end();else if(z.structural)z.close();else return Q(a,z.options,g.options),z.runner;else if(b("join",a,g,z))if(2===z.state)Q(a,k,{});else return Na(a,l?f:null,k),f=g.event=z.event,k=Q(a,z.options,g.options),z.runner}else Q(a,k,{});(C=g.structural)||(C="animate"===g.event&&0<Object.keys(g.options.to||{}).length||c(g.options));if(!C)return t(),w(a),h;var u=(z.counter||0)+1;g.counter=u;x(a,1,g);s.$$postDigest(function(){var b=m.get(A),d=!b,b=b||{},K=0<(a.parent()||[]).length&&("animate"===b.event||b.structural||c(b.options));if(d||b.counter!==u||!K){d&&(Ha(a,k),da(a,k));if(d||l&&b.event!==f)k.domOperation(),h.end();K||w(a)}else f=!b.structural&&c(b.options,!0)?"setClass":b.event,x(a,2),b=r(a,f,b.options),b.done(function(b){t(!b);(b=m.get(A))&&b.counter===u&&w(B(a));n(h,f,"close",{})}),h.setHost(b),n(h,f,"start",{})});return h}function y(a){a=B(a).querySelectorAll("[data-ng-animate]");q(a,function(a){var b=parseInt(a.getAttribute("data-ng-animate")),c=m.get(a);switch(b){case 2:c.runner.end();case 1:c&&m.remove(a);
}})}function w(a){a=B(a);a.removeAttribute("data-ng-animate");m.remove(a)}function f(a,b){return B(a)===B(b)}function la(a,b,c){c=L(g[0].body);var d=f(a,c)||"HTML"===a[0].nodeName,t=f(a,h),n=!1,w;for((a=a.data("$ngAnimatePin"))&&(b=a);b&&b.length;){t||(t=f(b,h));a=b[0];if(1!==a.nodeType)break;var x=m.get(a)||{};n||(n=x.structural||F.get(a));if(qa(w)||!0===w)a=b.data("$$ngAnimateChildren"),V(a)&&(w=a);if(n&&!1===w)break;t||(t=f(b,h),t||(a=b.data("$ngAnimatePin"))&&(b=a));d||(d=f(b,c));b=b.parent()}return(!n||w)&&t&&d}function x(a,b,c){c=c||{};c.state=b;a=B(a);a.setAttribute("data-ng-animate",b);c=(b=m.get(a))?Aa(b,c):c;m.put(a,c)}var m=new v,F=new v,G=null,A=s.$watch(function(){return 0===u.totalPendingRequests},function(a){a&&(A(),s.$$postDigest(function(){s.$$postDigest(function(){null===G&&(G=!0)})}))}),t={},n=a.classNameFilter(),Ra=n?function(a){return n.test(a)}:function(){return!0},Ha=N(R);return{on:function(a,b,c){b=ma(b);t[a]=t[a]||[];t[a].push({node:b,callback:c})},off:function(a,b,c){function f(a,b,c){var d=ma(b);return a.filter(function(a){return!(a.node===d&&(!c||a.callback===c))})}var d=t[a];d&&(t[a]=1===arguments.length?null:f(d,b,c))},pin:function(a,b){wa(ra(a),"element","not an element");wa(ra(b),"parentElement","not an element");a.data("$ngAnimatePin",b)},push:function(a,b,c,f){c=c||{};c.domOperation=f;return l(a,b,c)},enabled:function(a,b){var c=arguments.length;if(0===c)b=!!G;else if(ra(a)){var f=B(a),d=F.get(f);1===c?b=!d:(b=!!b)?d&&F.remove(f):F.put(f,!0)}else b=G=!!a;return b}}}]}]).provider("$$animation",["$animateProvider",function(a){function b(a){return a.data("$$animationRunner")}var c=this.drivers=[];this.$get=["$$jqLite","$rootScope","$injector","$$AnimateRunner","$$HashMap","$$rAFScheduler",function(a,e,s,h,g,v){function r(a){function b(a){if(a.processed)return a;a.processed=!0;var f=a.domNode,d=f.parentNode;e.put(f,a);for(var x;d;){if(x=e.get(d)){x.processed||(x=b(x));break}d=d.parentNode}(x||c).children.push(a);return a}var c={children:[]},d,e=new g;for(d=0;d<a.length;d++){var h=a[d];e.put(h.domNode,a[d]={domNode:h.domNode,fn:h.fn,children:[]})}for(d=0;d<a.length;d++)b(a[d]);return function(a){var b=[],c=[],d;for(d=0;d<a.children.length;d++)c.push(a.children[d]);a=c.length;var m=0,e=[];for(d=0;d<c.length;d++){var h=c[d];0>=a&&(a=m,m=0,b.push(e),e=[]);e.push(h.fn);h.children.forEach(function(a){m++;c.push(a)});a--}e.length&&b.push(e);return b}(c)}var $=[],u=N(a);return function(g,C,D){function K(a){a=a.hasAttribute("ng-animate-ref")?[a]:a.querySelectorAll("[ng-animate-ref]");var b=[];q(a,function(a){var c=a.getAttribute("ng-animate-ref");c&&c.length&&b.push(a)});return b}function l(a){var b=[],c={};q(a,function(a,f){var d=B(a.element),t=0<=["enter","move"].indexOf(a.event),d=a.structural?K(d):[];if(d.length){var m=t?"to":"from";q(d,function(a){var b=a.getAttribute("ng-animate-ref");c[b]=c[b]||{};c[b][m]={animationID:f,element:L(a)}})}else b.push(a)});var f={},d={};q(c,function(c,m){var w=c.from,e=c.to;if(w&&e){var h=a[w.animationID],g=a[e.animationID],x=w.animationID.toString();if(!d[x]){var A=d[x]={structural:!0,beforeStart:function(){h.beforeStart();g.beforeStart()},close:function(){h.close();g.close()},classes:y(h.classes,g.classes),from:h,to:g,anchors:[]};A.classes.length?b.push(A):(b.push(h),b.push(g))}d[x].anchors.push({out:w.element,"in":e.element})}else w=w?w.animationID:e.animationID,e=w.toString(),f[e]||(f[e]=!0,b.push(a[w]))});return b}function y(a,b){a=a.split(" ");b=b.split(" ");for(var c=[],f=0;f<a.length;f++){var d=a[f];if("ng-"!==d.substring(0,3))for(var m=0;m<b.length;m++)if(d===b[m]){c.push(d);break}}return c.join(" ")}function w(a){for(var b=c.length-1;0<=b;b--){var f=c[b];if(s.has(f)&&(f=s.get(f)(a)))return f}}function f(a,c){a.from&&a.to?(b(a.from.element).setHost(c),b(a.to.element).setHost(c)):b(a.element).setHost(c)}function la(){var a=b(g);!a||"leave"===C&&D.$$domOperationFired||a.end()}function x(b){g.off("$destroy",la);g.removeData("$$animationRunner");u(g,D);da(g,D);D.domOperation();A&&a.removeClass(g,A);g.removeClass("ng-animate");F.complete(!b)}D=ia(D);var m=0<=["enter","move","leave"].indexOf(C),F=new h({end:function(){x()},cancel:function(){x(!0)}});if(!c.length)return x(),F;g.data("$$animationRunner",F);var G=xa(g.attr("class"),xa(D.addClass,D.removeClass)),A=D.tempClasses;A&&(G+=" "+A,D.tempClasses=null);$.push({element:g,classes:G,event:C,structural:m,options:D,beforeStart:function(){g.addClass("ng-animate");A&&a.addClass(g,A)},close:x});g.on("$destroy",la);if(1<$.length)return F;e.$$postDigest(function(){var a=[];q($,function(c){b(c.element)?a.push(c):c.close()});$.length=0;var c=l(a),d=[];q(c,function(a){d.push({domNode:B(a.from?a.from.element:a.element),fn:function(){a.beforeStart();var c,d=a.close;if(b(a.anchors?a.from.element||a.to.element:a.element)){var m=w(a);m&&(c=m.start)}c?(c=c(),c.done(function(a){d(!a)}),f(a,c)):d()}})});v(r(d))});return F}}]}]).provider("$animateCss",["$animateProvider",function(a){var b=Da(),c=Da();this.$get=["$window","$$jqLite","$$AnimateRunner","$timeout","$$forceReflow","$sniffer","$$rAFScheduler","$animate",function(a,e,s,h,g,v,r,u){function Ga(a,b){var c=a.parentNode;return(c.$$ngAnimateParentKey||(c.$$ngAnimateParentKey=++l))+"-"+a.getAttribute("class")+"-"+b}function R(w,f,h,g){var m;0<b.count(h)&&(m=c.get(h),m||(f=T(f,"-stagger"),e.addClass(w,f),m=Ba(a,w,g),m.animationDuration=Math.max(m.animationDuration,0),m.transitionDuration=Math.max(m.transitionDuration,0),e.removeClass(w,f),c.put(h,m)));return m||{}}function C(a){y.push(a);r.waitUntilQuiet(function(){b.flush();c.flush();for(var a=g(),d=0;d<y.length;d++)y[d](a);y.length=0})}function D(c,f,e){f=b.get(e);f||(f=Ba(a,c,Pa),"infinite"===f.animationIterationCount&&(f.animationIterationCount=1));b.put(e,f);c=f;e=c.animationDelay;f=c.transitionDelay;c.maxDelay=e&&f?Math.max(e,f):e||f;c.maxDuration=Math.max(c.animationDuration*c.animationIterationCount,c.transitionDuration);return c}var K=N(e),l=0,y=[];return function(a,c){function d(){m()}function g(){m(!0)}function m(b){if(!(ga||va&&k)){ga=!0;k=!1;c.$$skipPreparationClasses||e.removeClass(a,Z);e.removeClass(a,Y);na(n,!1);ja(n,!1);q(y,function(a){n.style[a[0]]=""});K(a,c);da(a,c);Object.keys(t).length&&q(t,function(a,b){a?n.style.setProperty(b,a):n.style.removeProperty(b)});if(c.onDone)c.onDone();H&&H.complete(!b)}}function F(a){p.blockTransition&&ja(n,a);p.blockKeyframeAnimation&&na(n,!!a)}function G(){H=new s({end:d,cancel:g});C(M);m();return{$$willAnimate:!1,start:function(){return H},end:d}}function A(){function b(){if(!ga){F(!1);q(y,function(a){n.style[a[0]]=a[1]});K(a,c);e.addClass(a,Y);if(p.recalculateTimingStyles){ha=n.className+" "+Z;aa=Ga(n,ha);E=D(n,ha,aa);W=E.maxDelay;I=Math.max(W,0);J=E.maxDuration;if(0===J){m();return}p.hasTransitions=0<E.transitionDuration;p.hasAnimations=0<E.animationDuration}p.applyAnimationDelay&&(W="boolean"!==typeof c.delay&&oa(c.delay)?parseFloat(c.delay):W,I=Math.max(W,0),E.animationDelay=W,ca=[ka,W+"s"],y.push(ca),n.style[ca[0]]=ca[1]);N=1e3*I;z=1e3*J;if(c.easing){var k,l=c.easing;p.hasTransitions&&(k=O+"TimingFunction",y.push([k,l]),n.style[k]=l);p.hasAnimations&&(k=U+"TimingFunction",y.push([k,l]),n.style[k]=l)}E.transitionDuration&&x.push(sa);E.animationDuration&&x.push(ta);A=Date.now();var v=N+1.5*z;k=A+v;var l=a.data("$$animateCss")||[],r=!0;if(l.length){var G=l[0];(r=k>G.expectedEndTime)?h.cancel(G.timer):l.push(m)}r&&(v=h(d,v,!1),l[0]={timer:v,expectedEndTime:k},l.push(m),a.data("$$animateCss",l));a.on(x.join(" "),g);c.to&&(c.cleanupStyles&&Ea(t,n,Object.keys(c.to)),za(a,c))}}function d(){var b=a.data("$$animateCss");if(b){for(var c=1;c<b.length;c++)b[c]();a.removeData("$$animateCss")}}function g(a){a.stopPropagation();var b=a.originalEvent||a;a=b.$manualTimeStamp||b.timeStamp||Date.now();b=parseFloat(b.elapsedTime.toFixed(3));Math.max(a-A,0)>=N&&b>=J&&(va=!0,m())}if(!ga)if(n.parentNode){var A,x=[],l=function(a){if(va)k&&a&&(k=!1,m());else if(k=!a,E.animationDuration)if(a=na(n,k),k)y.push(a);else{var b=y,c=b.indexOf(a);0<=a&&b.splice(c,1)}},v=0<V&&(E.transitionDuration&&0===S.transitionDuration||E.animationDuration&&0===S.animationDuration)&&Math.max(S.animationDelay,S.transitionDelay);v?h(b,Math.floor(v*V*1e3),!1):b();L.resume=function(){l(!0)};L.pause=function(){l(!1)}}else m()}var t={},n=B(a);if(!n||!n.parentNode||!u.enabled())return G();c=ia(c);var y=[],r=a.attr("class"),l=Ia(c),ga,k,va,H,L,I,N,J,z;if(0===c.duration||!v.animations&&!v.transitions)return G();var ba=c.event&&X(c.event)?c.event.join(" "):c.event,Q="",P="";ba&&c.structural?Q=T(ba,"ng-",!0):ba&&(Q=ba);c.addClass&&(P+=T(c.addClass,"-add"));c.removeClass&&(P.length&&(P+=" "),P+=T(c.removeClass,"-remove"));c.applyClassesEarly&&P.length&&K(a,c);var Z=[Q,P].join(" ").trim(),ha=r+" "+Z,Y=T(Z,"-active"),r=l.to&&0<Object.keys(l.to).length;if(!(0<(c.keyframeStyle||"").length||r||Z))return G();var aa,S;0<c.stagger?(l=parseFloat(c.stagger),S={transitionDelay:l,animationDelay:l,transitionDuration:0,animationDuration:0}):(aa=Ga(n,ha),S=R(n,Z,aa,Qa));c.$$skipPreparationClasses||e.addClass(a,Z);c.transitionStyle&&(l=[O,c.transitionStyle],ea(n,l),y.push(l));0<=c.duration&&(l=0<n.style[O].length,l=Ca(c.duration,l),ea(n,l),y.push(l));c.keyframeStyle&&(l=[U,c.keyframeStyle],ea(n,l),y.push(l));var V=S?0<=c.staggerIndex?c.staggerIndex:b.count(aa):0;(ba=0===V)&&!c.skipBlocking&&ja(n,9999);var E=D(n,ha,aa),W=E.maxDelay;I=Math.max(W,0);J=E.maxDuration;var p={};p.hasTransitions=0<E.transitionDuration;p.hasAnimations=0<E.animationDuration;p.hasTransitionAll=p.hasTransitions&&"all"==E.transitionProperty;p.applyTransitionDuration=r&&(p.hasTransitions&&!p.hasTransitionAll||p.hasAnimations&&!p.hasTransitions);p.applyAnimationDuration=c.duration&&p.hasAnimations;p.applyTransitionDelay=oa(c.delay)&&(p.applyTransitionDuration||p.hasTransitions);p.applyAnimationDelay=oa(c.delay)&&p.hasAnimations;p.recalculateTimingStyles=0<P.length;if(p.applyTransitionDuration||p.applyAnimationDuration)J=c.duration?parseFloat(c.duration):J,p.applyTransitionDuration&&(p.hasTransitions=!0,E.transitionDuration=J,l=0<n.style[O+"Property"].length,y.push(Ca(J,l))),p.applyAnimationDuration&&(p.hasAnimations=!0,E.animationDuration=J,y.push([ua,J+"s"]));if(0===J&&!p.recalculateTimingStyles)return G();if(null!=c.delay){var ca=parseFloat(c.delay);p.applyTransitionDelay&&y.push([fa,ca+"s"]);p.applyAnimationDelay&&y.push([ka,ca+"s"])}null==c.duration&&0<E.transitionDuration&&(p.recalculateTimingStyles=p.recalculateTimingStyles||ba);N=1e3*I;z=1e3*J;c.skipBlocking||(p.blockTransition=0<E.transitionDuration,p.blockKeyframeAnimation=0<E.animationDuration&&0<S.animationDelay&&0===S.animationDuration);c.from&&(c.cleanupStyles&&Ea(t,n,Object.keys(c.from)),ya(a,c));p.blockTransition||p.blockKeyframeAnimation?F(J):c.skipBlocking||ja(n,!1);return{$$willAnimate:!0,end:d,start:function(){if(!ga)return L={end:d,cancel:g,resume:null,pause:null},H=new s(L),C(A),H}}}}]}]).provider("$$animateCssDriver",["$$animationProvider",function(a){a.drivers.push("$$animateCssDriver");this.$get=["$animateCss","$rootScope","$$AnimateRunner","$rootElement","$sniffer","$$jqLite","$document",function(a,c,d,e,s,h,g){function v(a){return a.replace(/\bng-\S+\b/g,"")}function r(a,b){I(a)&&(a=a.split(" "));I(b)&&(b=b.split(" "));return a.filter(function(a){return-1===b.indexOf(a)}).join(" ")}function u(c,e,g){function h(a){var b={},c=B(a).getBoundingClientRect();q(["width","height","top","left"],function(a){var d=c[a];switch(a){case"top":d+=C.scrollTop;break;case"left":d+=C.scrollLeft}b[a]=Math.floor(d)+"px"});return b}function f(){var c=v(g.attr("class")||""),d=r(c,m),c=r(m,c),d=a(x,{to:h(g),addClass:"ng-anchor-in "+d,removeClass:"ng-anchor-out "+c,delay:!0});return d.$$willAnimate?d:null}function s(){x.remove();e.removeClass("ng-animate-shim");g.removeClass("ng-animate-shim")}var x=L(B(e).cloneNode(!0)),m=v(x.attr("class")||"");e.addClass("ng-animate-shim");g.addClass("ng-animate-shim");x.addClass("ng-anchor");D.append(x);var F;c=function(){var c=a(x,{addClass:"ng-anchor-out",delay:!0,from:h(e)});return c.$$willAnimate?c:null}();if(!c&&(F=f(),!F))return s();var G=c||F;return{start:function(){function a(){c&&c.end()}var b,c=G.start();c.done(function(){c=null;if(!F&&(F=f()))return c=F.start(),c.done(function(){c=null;s();b.complete()}),c;s();b.complete()});return b=new d({end:a,cancel:a})}}}function H(a,b,c,e){var f=R(a,M),g=R(b,M),h=[];q(e,function(a){(a=u(c,a.out,a["in"]))&&h.push(a)});if(f||g||0!==h.length)return{start:function(){function a(){q(b,function(a){a.end()})}var b=[];f&&b.push(f.start());g&&b.push(g.start());q(h,function(a){b.push(a.start())});var c=new d({end:a,cancel:a});d.all(b,function(a){c.complete(a)});return c}}}function R(c){var d=c.element,e=c.options||{};c.structural&&(e.event=c.event,e.structural=!0,e.applyClassesEarly=!0,"leave"===c.event&&(e.onDone=e.domOperation));e.preparationClasses&&(e.event=Y(e.event,e.preparationClasses));c=a(d,e);return c.$$willAnimate?c:null}if(!s.animations&&!s.transitions)return M;var C=g[0].body;c=B(e);var D=L(c.parentNode&&11===c.parentNode.nodeType||C.contains(c)?c:C);N(h);return function(a){return a.from&&a.to?H(a.from,a.to,a.classes,a.anchors):R(a)}}]}]).provider("$$animateJs",["$animateProvider",function(a){this.$get=["$injector","$$AnimateRunner","$$jqLite",function(b,c,d){function e(c){c=X(c)?c:c.split(" ");for(var d=[],e={},r=0;r<c.length;r++){var q=c[r],s=a.$$registeredAnimations[q];s&&!e[q]&&(d.push(b.get(s)),e[q]=!0)}return d}var s=N(d);return function(a,b,d,r){function u(){r.domOperation();s(a,r)}function H(a,b,d,e,f){switch(d){case"animate":b=[b,e.from,e.to,f];break;case"setClass":b=[b,D,K,f];break;case"addClass":b=[b,D,f];break;case"removeClass":b=[b,K,f];break;default:b=[b,f]}b.push(e);if(a=a.apply(a,b))if(Fa(a.start)&&(a=a.start()),a instanceof c)a.done(f);else if(Fa(a))return a;return M}function B(a,b,d,e,f){var g=[];q(e,function(e){var h=e[f];h&&g.push(function(){var e,f,g=!1,k=function(a){g||(g=!0,(f||M)(a),e.complete(!a))};e=new c({end:function(){k()},cancel:function(){k(!0)}});f=H(h,a,b,d,function(a){k(!1===a)});return e})});return g}function C(a,b,d,e,f){var g=B(a,b,d,e,f);if(0===g.length){var h,l;"beforeSetClass"===f?(h=B(a,"removeClass",d,e,"beforeRemoveClass"),l=B(a,"addClass",d,e,"beforeAddClass")):"setClass"===f&&(h=B(a,"removeClass",d,e,"removeClass"),l=B(a,"addClass",d,e,"addClass"));h&&(g=g.concat(h));l&&(g=g.concat(l))}if(0!==g.length)return function(a){var b=[];g.length&&q(g,function(a){b.push(a())});b.length?c.all(b,a):a();return function(a){q(b,function(b){a?b.cancel():b.end()})}}}3===arguments.length&&pa(d)&&(r=d,d=null);r=ia(r);d||(d=a.attr("class")||"",r.addClass&&(d+=" "+r.addClass),r.removeClass&&(d+=" "+r.removeClass));var D=r.addClass,K=r.removeClass,l=e(d),y,w;if(l.length){var f,I;"leave"==b?(I="leave",f="afterLeave"):(I="before"+b.charAt(0).toUpperCase()+b.substr(1),f=b);"enter"!==b&&"move"!==b&&(y=C(a,b,r,l,I));w=C(a,b,r,l,f)}if(y||w)return{start:function(){function b(c){f=!0;u();da(a,r);g.complete(c)}var d,e=[];y&&e.push(function(a){d=y(a)});e.length?e.push(function(a){u();a(!0)}):u();w&&e.push(function(a){d=w(a)});var f=!1,g=new c({end:function(){f||((d||M)(void 0),b(void 0))},cancel:function(){f||((d||M)(!0),b(!0))}});c.chain(e,b);return g}}}}]}]).provider("$$animateJsDriver",["$$animationProvider",function(a){a.drivers.push("$$animateJsDriver");this.$get=["$$animateJs","$$AnimateRunner",function(a,c){function d(c){return a(c.element,c.event,c.classes,c.options)}return function(a){if(a.from&&a.to){var b=d(a.from),h=d(a.to);if(b||h)return{start:function(){function a(){return function(){q(d,function(a){a.end()})}}var d=[];b&&d.push(b.start());h&&d.push(h.start());c.all(d,function(a){e.complete(a)});var e=new c({end:a(),cancel:a()});return e}}}else return d(a)}}]}])})(window,window.angular);(function(n,h,p){"use strict";function E(a){var f=[];r(f,h.noop).chars(a);return f.join("")}function g(a,f){var d={},c=a.split(","),b;for(b=0;b<c.length;b++)d[f?h.lowercase(c[b]):c[b]]=!0;return d}function F(a,f){function d(a,b,d,l){b=h.lowercase(b);if(s[b])for(;e.last()&&t[e.last()];)c("",e.last());u[b]&&e.last()==b&&c("",b);(l=v[b]||!!l)||e.push(b);var m={};d.replace(G,function(b,a,f,c,d){m[a]=q(f||c||d||"")});f.start&&f.start(b,m,l)}function c(b,a){var c=0,d;if(a=h.lowercase(a))for(c=e.length-1;0<=c&&e[c]!=a;c--);if(0<=c){for(d=e.length-1;d>=c;d--)f.end&&f.end(e[d]);e.length=c}}"string"!==typeof a&&(a=null===a||"undefined"===typeof a?"":""+a);var b,k,e=[],m=a,l;for(e.last=function(){return e[e.length-1]};a;){l="";k=!0;if(e.last()&&w[e.last()])a=a.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+e.last()+"[^>]*>","i"),function(a,b){b=b.replace(H,"$1").replace(I,"$1");f.chars&&f.chars(q(b));return""}),c("",e.last());else{if(0===a.indexOf("<!--"))b=a.indexOf("--",4),0<=b&&a.lastIndexOf("-->",b)===b&&(f.comment&&f.comment(a.substring(4,b)),a=a.substring(b+3),k=!1);else if(x.test(a)){if(b=a.match(x))a=a.replace(b[0],""),k=!1}else if(J.test(a)){if(b=a.match(y))a=a.substring(b[0].length),b[0].replace(y,c),k=!1}else K.test(a)&&((b=a.match(z))?(b[4]&&(a=a.substring(b[0].length),b[0].replace(z,d)),k=!1):(l+="<",a=a.substring(1)));k&&(b=a.indexOf("<"),l+=0>b?a:a.substring(0,b),a=0>b?"":a.substring(b),f.chars&&f.chars(q(l)))}if(a==m)throw L("badparse",a);m=a}c()}function q(a){if(!a)return"";A.innerHTML=a.replace(/</g,"&lt;");return A.textContent}function B(a){return a.replace(/&/g,"&amp;").replace(M,function(a){var d=a.charCodeAt(0);a=a.charCodeAt(1);return"&#"+(1024*(d-55296)+(a-56320)+65536)+";"}).replace(N,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(a,f){var d=!1,c=h.bind(a,a.push);return{start:function(a,k,e){a=h.lowercase(a);!d&&w[a]&&(d=a);d||!0!==C[a]||(c("<"),c(a),h.forEach(k,function(d,e){var k=h.lowercase(e),g="img"===a&&"src"===k||"background"===k;!0!==O[k]||!0===D[k]&&!f(d,g)||(c(" "),c(e),c('="'),c(B(d)),c('"'))}),c(e?"/>":">"))},end:function(a){a=h.lowercase(a);d||!0!==C[a]||(c("</"),c(a),c(">"));a==d&&(d=!1)},chars:function(a){d||c(B(a))}}}var L=h.$$minErr("$sanitize"),z=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,y=/^<\/\s*([\w:-]+)[^>]*>/,G=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,K=/^</,J=/^<\//,H=/\x3c!--(.*?)--\x3e/g,x=/<!DOCTYPE([^>]*?)>/i,I=/<!\[CDATA\[(.*?)]]\x3e/g,M=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,N=/([^\#-~| |!])/g,v=g("area,br,col,hr,img,wbr");n=g("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr");p=g("rp,rt");var u=h.extend({},p,n),s=h.extend({},n,g("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),t=h.extend({},p,g("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var"));n=g("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan,use");var w=g("script,style"),C=h.extend({},v,s,t,u,n),D=g("background,cite,href,longdesc,src,usemap,xlink:href");n=g("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width");p=g("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0);var O=h.extend({},D,p,n),A=document.createElement("pre");h.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(a){return function(f){var d=[];F(f,r(d,function(c,b){return!/^unsafe/.test(a(c,b))}));return d.join("")}}]});h.module("ngSanitize").filter("linky",["$sanitize",function(a){var f=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,d=/^mailto:/i;return function(c,b){function k(a){a&&g.push(E(a))}function e(a,c){g.push("<a ");h.isDefined(b)&&g.push('target="',b,'" ');g.push('href="',a.replace(/"/g,"&quot;"),'">');k(c);g.push("</a>")}if(!c)return c;for(var m,l=c,g=[],n,p;m=l.match(f);)n=m[0],m[2]||m[4]||(n=(m[3]?"http://":"mailto:")+n),p=m.index,k(l.substr(0,p)),e(n,m[0].replace(d,"")),l=l.substring(p+m[0].length);k(l);return a(g.join(""))}}])})(window,window.angular);(function(x,n){"use strict";function s(f,k){var e=!1,a=!1;this.ngClickOverrideEnabled=function(b){return n.isDefined(b)?(b&&!a&&(a=!0,t.$$moduleName="ngTouch",k.directive("ngClick",t),f.decorator("ngClickDirective",["$delegate",function(a){if(e)a.shift();else for(var b=a.length-1;0<=b;){if("ngTouch"===a[b].$$moduleName){a.splice(b,1);break}b--}return a}])),e=b,this):e};this.$get=function(){return{ngClickOverrideEnabled:function(){return e}}}}function v(f,k,e){p.directive(f,["$parse","$swipe",function(a,b){return function(l,u,g){function h(c){if(!d)return!1;var a=Math.abs(c.y-d.y);c=(c.x-d.x)*k;return r&&75>a&&0<c&&30<c&&.3>a/c}var m=a(g[f]),d,r,c=["touch"];n.isDefined(g.ngSwipeDisableMouse)||c.push("mouse");b.bind(u,{start:function(c,a){d=c;r=!0},cancel:function(c){r=!1},end:function(c,d){h(c)&&l.$apply(function(){u.triggerHandler(e);m(l,{$event:d})})}},c)}}])}var p=n.module("ngTouch",[]);p.provider("$touch",s);s.$inject=["$provide","$compileProvider"];p.factory("$swipe",[function(){function f(a){a=a.originalEvent||a;var b=a.touches&&a.touches.length?a.touches:[a];a=a.changedTouches&&a.changedTouches[0]||b[0];return{x:a.clientX,y:a.clientY}}function k(a,b){var l=[];n.forEach(a,function(a){(a=e[a][b])&&l.push(a)});return l.join(" ")}var e={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}};return{bind:function(a,b,l){var e,g,h,m,d=!1;l=l||["mouse","touch","pointer"];a.on(k(l,"start"),function(c){h=f(c);d=!0;g=e=0;m=h;b.start&&b.start(h,c)});var r=k(l,"cancel");if(r)a.on(r,function(c){d=!1;b.cancel&&b.cancel(c)});a.on(k(l,"move"),function(c){if(d&&h){var a=f(c);e+=Math.abs(a.x-m.x);g+=Math.abs(a.y-m.y);m=a;10>e&&10>g||(g>e?(d=!1,b.cancel&&b.cancel(c)):(c.preventDefault(),b.move&&b.move(a,c)))}});a.on(k(l,"end"),function(c){d&&(d=!1,b.end&&b.end(f(c),c))})}}}]);var t=["$parse","$timeout","$rootElement",function(f,k,e){function a(a,d,b){for(var c=0;c<a.length;c+=2){var g=a[c+1],e=b;if(25>Math.abs(a[c]-d)&&25>Math.abs(g-e))return a.splice(c,c+2),!0}return!1}function b(b){if(!(2500<Date.now()-u)){var d=b.touches&&b.touches.length?b.touches:[b],e=d[0].clientX,d=d[0].clientY;if(!(1>e&&1>d||h&&h[0]===e&&h[1]===d)){h&&(h=null);var c=b.target;"label"===n.lowercase(c.nodeName||c[0]&&c[0].nodeName)&&(h=[e,d]);a(g,e,d)||(b.stopPropagation(),b.preventDefault(),b.target&&b.target.blur&&b.target.blur())}}}function l(a){a=a.touches&&a.touches.length?a.touches:[a];var b=a[0].clientX,e=a[0].clientY;g.push(b,e);k(function(){for(var a=0;a<g.length;a+=2)if(g[a]===b&&g[a+1]===e){g.splice(a,a+2);break}},2500,!1)}var u,g,h;return function(h,d,k){var c=f(k.ngClick),w=!1,q,p,s,t;d.on("touchstart",function(a){w=!0;q=a.target?a.target:a.srcElement;3===q.nodeType&&(q=q.parentNode);d.addClass("ng-click-active");p=Date.now();a=a.originalEvent||a;a=(a.touches&&a.touches.length?a.touches:[a])[0];s=a.clientX;t=a.clientY});d.on("touchcancel",function(a){w=!1;d.removeClass("ng-click-active")});d.on("touchend",function(c){var h=Date.now()-p,f=c.originalEvent||c,m=(f.changedTouches&&f.changedTouches.length?f.changedTouches:f.touches&&f.touches.length?f.touches:[f])[0],f=m.clientX,m=m.clientY,v=Math.sqrt(Math.pow(f-s,2)+Math.pow(m-t,2));w&&750>h&&12>v&&(g||(e[0].addEventListener("click",b,!0),e[0].addEventListener("touchstart",l,!0),g=[]),u=Date.now(),a(g,f,m),q&&q.blur(),n.isDefined(k.disabled)&&!1!==k.disabled||d.triggerHandler("click",[c]));w=!1;d.removeClass("ng-click-active")});d.onclick=function(a){};d.on("click",function(a,b){h.$apply(function(){c(h,{$event:b||a})})});d.on("mousedown",function(a){d.addClass("ng-click-active")});d.on("mousemove mouseup",function(a){d.removeClass("ng-click-active")})}}];v("ngSwipeLeft",-1,"swipeleft");v("ngSwipeRight",1,"swiperight")})(window,window.angular);(function(I,f,C){"use strict";function D(t,e){e=e||{};f.forEach(e,function(f,k){delete e[k]});for(var k in t)!t.hasOwnProperty(k)||"$"===k.charAt(0)&&"$"===k.charAt(1)||(e[k]=t[k]);return e}var y=f.$$minErr("$resource"),B=/^(\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/;f.module("ngResource",["ng"]).provider("$resource",function(){var t=/^https?:\/\/[^\/]*/,e=this;this.defaults={stripTrailingSlashes:!0,actions:{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}}};this.$get=["$http","$q",function(k,F){function w(f,g){this.template=f;this.defaults=r({},e.defaults,g);this.urlParams={}}function z(l,g,s,h){function c(a,q){var c={};q=r({},g,q);u(q,function(b,q){x(b)&&(b=b());var m;if(b&&b.charAt&&"@"==b.charAt(0)){m=a;var d=b.substr(1);if(null==d||""===d||"hasOwnProperty"===d||!B.test("."+d))throw y("badmember",d);for(var d=d.split("."),n=0,g=d.length;n<g&&f.isDefined(m);n++){var e=d[n];m=null!==m?m[e]:C}}else m=b;c[q]=m});return c}function G(a){return a.resource}function d(a){D(a||{},this)}var t=new w(l,h);s=r({},e.defaults.actions,s);d.prototype.toJSON=function(){var a=r({},this);delete a.$promise;delete a.$resolved;return a};u(s,function(a,q){var g=/^(POST|PUT|PATCH)$/i.test(a.method);d[q]=function(b,A,m,e){var n={},h,l,s;switch(arguments.length){case 4:s=e,l=m;case 3:case 2:if(x(A)){if(x(b)){l=b;s=A;break}l=A;s=m}else{n=b;h=A;l=m;break}case 1:x(b)?l=b:g?h=b:n=b;break;case 0:break;default:throw y("badargs",arguments.length)}var w=this instanceof d,p=w?h:a.isArray?[]:new d(h),v={},z=a.interceptor&&a.interceptor.response||G,B=a.interceptor&&a.interceptor.responseError||C;u(a,function(a,b){switch(b){default:v[b]=H(a);break;case"params":case"isArray":case"interceptor":break;case"timeout":v[b]=a}});g&&(v.data=h);t.setUrlParams(v,r({},c(h,a.params||{}),n),a.url);n=k(v).then(function(b){var c=b.data,m=p.$promise;if(c){if(f.isArray(c)!==!!a.isArray)throw y("badcfg",q,a.isArray?"array":"object",f.isArray(c)?"array":"object",v.method,v.url);a.isArray?(p.length=0,u(c,function(b){"object"===typeof b?p.push(new d(b)):p.push(b)})):(D(c,p),p.$promise=m)}p.$resolved=!0;b.resource=p;return b},function(b){p.$resolved=!0;(s||E)(b);return F.reject(b)});n=n.then(function(b){var a=z(b);(l||E)(a,b.headers);return a},B);return w?n:(p.$promise=n,p.$resolved=!1,p)};d.prototype["$"+q]=function(b,a,c){x(b)&&(c=a,a=b,b={});b=d[q].call(this,b,this,a,c);return b.$promise||b}});d.bind=function(a){return z(l,r({},g,a),s)};return d}var E=f.noop,u=f.forEach,r=f.extend,H=f.copy,x=f.isFunction;w.prototype={setUrlParams:function(l,g,e){var h=this,c=e||h.template,k,d,r="",a=h.urlParams={};u(c.split(/\W/),function(d){if("hasOwnProperty"===d)throw y("badname");!/^\d+$/.test(d)&&d&&new RegExp("(^|[^\\\\]):"+d+"(\\W|$)").test(c)&&(a[d]=!0)});c=c.replace(/\\:/g,":");c=c.replace(t,function(a){r=a;return""});g=g||{};u(h.urlParams,function(a,e){k=g.hasOwnProperty(e)?g[e]:h.defaults[e];f.isDefined(k)&&null!==k?(d=encodeURIComponent(k).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"%20").replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+"),c=c.replace(new RegExp(":"+e+"(\\W|$)","g"),function(b,a){return d+a})):c=c.replace(new RegExp("(/?):"+e+"(\\W|$)","g"),function(b,a,c){return"/"==c.charAt(0)?c:a+c})});h.defaults.stripTrailingSlashes&&(c=c.replace(/\/+$/,"")||"/");c=c.replace(/\/\.(?=\w+($|\?))/,".");l.url=r+c.replace(/\/\\\./,"/.");u(g,function(a,c){h.urlParams[c]||(l.params=l.params||{},l.params[c]=a)})}};return z}]})})(window,window.angular);!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.io=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){var url=_dereq_("./url");var parser=_dereq_("socket.io-parser");var Manager=_dereq_("./manager");var debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri=="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var io;if(opts.forceNew||opts["force new connection"]||false===opts.multiplex){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_("./manager");exports.Socket=_dereq_("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":44}],3:[function(_dereq_,module,exports){var url=_dereq_("./url");var eio=_dereq_("engine.io-client");var Socket=_dereq_("./socket");var Emitter=_dereq_("component-emitter");var parser=_dereq_("socket.io-parser");var on=_dereq_("./on");var bind=_dereq_("component-bind");var object=_dereq_("object-component");var debug=_dereq_("debug")("socket.io-client:manager");var indexOf=_dereq_("indexof");var Backoff=_dereq_("backo2");module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connected=[];
this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){this.nsps[nsp].id=this.engine.id}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")))};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){socket.id=self.engine.id;if(!~indexOf(self.connected,socket)){self.connected.push(socket)}})}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connected,socket);if(~index)this.connected.splice(index,1);if(this.connected.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i])}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};Manager.prototype.onclose=function(reason){debug("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:40,"object-component":41,"socket.io-parser":44}],4:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],5:[function(_dereq_,module,exports){var parser=_dereq_("socket.io-parser");var Emitter=_dereq_("component-emitter");var toArray=_dereq_("to-array");var on=_dereq_("./on");var bind=_dereq_("component-bind");var debug=_dereq_("debug")("socket.io-client:socket");var hasBin=_dereq_("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};if("function"==typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data);delete this.acks[packet.id]};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":36,"socket.io-parser":44,"to-array":48}],6:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_("parseuri");var debug=_dereq_("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"==typeof uri){if("/"==uri.charAt(0)){if("/"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.hostname+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!=typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";obj.id=obj.protocol+"://"+obj.host+":"+obj.port;obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port);return obj}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:10,parseuri:42}],7:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],8:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],9:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],10:[function(_dereq_,module,exports){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}},{}],11:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":12}],12:[function(_dereq_,module,exports){module.exports=_dereq_("./socket");module.exports.parser=_dereq_("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(_dereq_,module,exports){(function(global){var transports=_dereq_("./transports");var Emitter=_dereq_("component-emitter");var debug=_dereq_("debug")("engine.io-client:socket");var index=_dereq_("indexof");var parser=_dereq_("engine.io-parser");var parseuri=_dereq_("parseuri");var parsejson=_dereq_("parsejson");var parseqs=_dereq_("parseqs");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.host=uri.host;opts.secure=uri.protocol=="https"||uri.protocol=="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol;if(opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift();if(pieces.length){opts.port=pieces.pop()}else if(!opts.port){opts.port=this.secure?"443":"80"}}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized||null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_("./transport");Socket.transports=_dereq_("./transports");Socket.parser=_dereq_("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){transport="websocket"}else if(0==this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"==msg.type&&"probe"==msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"==self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data;this.emit("error",err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"==self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){this.sendPacket("ping")};Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++){if(this.callbackBuffer[i]){this.callbackBuffer[i]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,fn){this.sendPacket("message",msg,fn);return this};Socket.prototype.sendPacket=function(type,data,fn){if("closing"==this.readyState||"closed"==this.readyState){return}var packet={type:type,data:data};this.emit("packetCreate",packet);this.writeBuffer.push(packet);this.callbackBuffer.push(fn);this.flush()};Socket.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){self.writeBuffer=[];self.callbackBuffer=[];self.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc)}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:40,parsejson:32,parseqs:33,parseuri:34}],14:[function(_dereq_,module,exports){var parser=_dereq_("engine.io-parser");var Emitter=_dereq_("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized}Emitter(Transport.prototype);Transport.timestamps=0;Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"==this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var XHR=_dereq_("./polling-xhr");var JSONP=_dereq_("./polling-jsonp");var websocket=_dereq_("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_("./polling");var inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var Polling=_dereq_("./polling");
var Emitter=_dereq_("component-emitter");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);if(this.supportsBinary){xhr.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{data="ok"}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parseqs=_dereq_("parseqs");var parser=_dereq_("engine.io-parser");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"==self.readyState){self.onOpen()}if("close"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"==this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=+new Date+"-"+Transport.timestamps++}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"==schema&&this.port!=443||"http"==schema&&this.port!=80)){port=":"+this.port}if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:33,xmlhttprequest:20}],19:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parser=_dereq_("engine.io-parser");var parseqs=_dereq_("parseqs");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:websocket");var WebSocket=_dereq_("ws");module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;this.ws=new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;for(var i=0,l=packets.length;i<l;i++){parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}})}function ondrain(){self.writable=true;self.emit("drain")}setTimeout(ondrain,0)};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"==schema&&this.port!=443||"ws"==schema&&this.port!=80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=+new Date}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:33,ws:35}],20:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}},{"has-cors":38}],21:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],22:[function(_dereq_,module,exports){exports=module.exports=_dereq_("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){localStorage.removeItem("debug")}else{localStorage.debug=namespaces}}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports.enable(load())},{"./debug":23}],23:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:24}],24:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],25:[function(_dereq_,module,exports){(function(global){var keys=_dereq_("./keys");var hasBinary=_dereq_("has-binary");var sliceBuffer=_dereq_("arraybuffer.slice");var base64encoder=_dereq_("base64-arraybuffer");var after=_dereq_("after");var utf8=_dereq_("utf8");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if("function"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if("function"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data=="string"||data===undefined){if(data.charAt(0)=="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary=="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data==""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr){length+=chr}else{if(""==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}}if(length!=""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":36,utf8:31}],26:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],27:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error("after called too many times")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],28:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],29:[function(_dereq_,module,exports){(function(chars){exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob(["hi"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid UTF-8 detected")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],32:[function(_dereq_,module,exports){
(function(global){var rvalidchars=/^[\],:{}\s]*$/;var rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;var rtrimLeft=/^\s+/;var rtrimRight=/\s+$/;module.exports=function parsejson(data){if("string"!=typeof data||!data){return null}data=data.replace(rtrimLeft,"").replace(rtrimRight,"");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],33:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],34:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],35:[function(_dereq_,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],36:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:37}],37:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],38:[function(_dereq_,module,exports){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=false}},{global:39}],39:[function(_dereq_,module,exports){module.exports=function(){return this}()},{}],40:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],41:[function(_dereq_,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.values=function(obj){var vals=[];for(var key in obj){if(has.call(obj,key)){vals.push(obj[key])}}return vals};exports.merge=function(a,b){for(var key in b){if(has.call(b,key)){a[key]=b[key]}}return a};exports.length=function(obj){return exports.keys(obj).length};exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],42:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri}},{}],43:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");var isBuf=_dereq_("./is-buffer");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&"object"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&"object"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":45,isarray:46}],44:[function(_dereq_,module,exports){var debug=_dereq_("debug")("socket.io-parser");var json=_dereq_("json3");var isArray=_dereq_("isarray");var Emitter=_dereq_("component-emitter");var binary=_dereq_("./binary");var isBuf=_dereq_("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug("encoding packet %j",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str="";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+="-"}if(obj.nsp&&"/"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=",";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=",";str+=json.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf="";while(str.charAt(++i)!="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"==str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug("decoded %s as %j",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:"parser error"}}},{"./binary":43,"./is-buffer":45,"component-emitter":9,debug:10,isarray:46,json3:47}],45:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],46:[function(_dereq_,module,exports){module.exports=_dereq_(37)},{}],47:[function(_dereq_,module,exports){(function(window){var getClass={}.toString,isProperty,forEach,undef;var isLoader=typeof define==="function"&&define.amd;var nativeJSON=typeof JSON=="object"&&JSON;var JSON3=typeof exports=="object"&&exports&&!exports.nodeType&&exports;if(JSON3&&nativeJSON){JSON3.stringify=nativeJSON.stringify;JSON3.parse=nativeJSON.parse}else{JSON3=window.JSON=nativeJSON||{}}var isExtended=new Date((-0xc782b5b800cec));try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=JSON3.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number)==="0"&&stringify(new String)=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\0\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date((-864e13)))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date((-621987552e5)))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date((-1)))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=JSON3.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value["a"].length==5&&value["a"][0]===1;if(parseSupported){try{parseSupported=!parse('"\t"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]";var dateClass="[object Date]";var numberClass="[object Number]";var stringClass="[object String]";var arrayClass="[object Array]";var booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty={}.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}var PrimitiveTypes={"boolean":1,number:1,string:1,undefined:1};var isHostType=function(object,property){var type=typeof object[property];return type=="object"?!!object[property]:!PrimitiveTypes[type]};forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,property="constructor")){callback(property)}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy,symbols;if(isLarge){symbols=value.split("")}for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else if(typeof value.toJSON=="function"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else if(className==stringClass){return quote(""+value)}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}"}stack.pop();return result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(typeof filter=="function"||typeof filter=="object"&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}if(isLoader){define(function(){return JSON3})}})(this)},{}],48:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[1])(1)});(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function utils_hooks__hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function create_utc__createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}function valid__isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);m._isValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated;if(m._strict){m._isValid=m._isValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}}return m._isValid}function valid__createInvalid(flags){var m=create_utc__createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=utils_hooks__hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(typeof from._isAMomentObject!=="undefined"){to._isAMomentObject=from._isAMomentObject}if(typeof from._i!=="undefined"){to._i=from._i}if(typeof from._f!=="undefined"){to._f=from._f}if(typeof from._l!=="undefined"){to._l=from._l}if(typeof from._strict!=="undefined"){to._strict=from._strict}if(typeof from._tzm!=="undefined"){to._tzm=from._tzm}if(typeof from._isUTC!=="undefined"){to._isUTC=from._isUTC}if(typeof from._offset!=="undefined"){to._offset=from._offset}if(typeof from._pf!=="undefined"){to._pf=getParsingFlags(from)}if(typeof from._locale!=="undefined"){to._locale=from._locale}if(momentProperties.length>0){for(i in momentProperties){prop=momentProperties[i];val=from[prop];if(typeof val!=="undefined"){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(updateInProgress===false){updateInProgress=true;utils_hooks__hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function Locale(){}var locales={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;require("./locale/"+name);locale_locales__getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function locale_locales__getSetGlobalLocale(key,values){var data;if(key){if(typeof values==="undefined"){data=locale_locales__getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}}return globalLocale._abbr}function defineLocale(name,values){if(values!==null){values.abbr=name;locales[name]=locales[name]||new Locale;locales[name].set(values);locale_locales__getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function locale_locales__getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}function makeGetSet(unit,keepTime){return function(value){if(value!=null){get_set__set(this,unit,value);utils_hooks__hooks.updateOffset(this,keepTime);return this}else{return get_set__get(this,unit)}}}function get_set__get(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]()}function get_set__set(mom,unit,value){return mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function getSet(units,value){var unit;if(typeof units==="object"){for(unit in units){this.set(unit,units[unit])}}else{units=normalizeUnits(units);if(typeof this[units]==="function"){return this[units](value)}}return this}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"");
}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="";for(i=0;i<length;i++){output+=array[i]instanceof Function?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;var regexes={};function isFunction(sth){return typeof sth==="function"&&Object.prototype.toString.call(sth)==="[object Function]"}function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(typeof callback==="number"){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",matchWord);addRegexToken("MMMM",matchWord);addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m){return this._months[m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m){return this._monthsShort[m.month()]}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=create_utc__createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(typeof value==="string"){value=mom.localeData().monthsParse(value);if(typeof value!=="number"){return mom}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);utils_hooks__hooks.updateOffset(this,true);return this}else{return get_set__get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}getParsingFlags(m).overflow=overflow}return m}function warn(msg){if(utils_hooks__hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(firstTime){warn(msg+"\n"+(new Error).stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(!deprecations[name]){warn(msg);deprecations[name]=true}}utils_hooks__hooks.suppressDeprecationWarnings=false;var from_string__isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]];var isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=from_string__isoRegex.exec(string);if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(string)){config._f=isoDates[i][0];break}}for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(string)){config._f+=(match[6]||" ")+isoTimes[i][0];break}}if(string.match(matchOffset)){config._f+="Z"}configFromStringAndFormat(config)}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date((+matched[1]));return}configFromISO(config);if(config._isValid===false){delete config._isValid;utils_hooks__hooks.createFromInputFallback(config)}}utils_hooks__hooks.createFromInputFallback=deprecate("moment construction falls back to js Date. This is "+"discouraged and will be removed in upcoming major "+"release. Please refer to "+"https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<1970){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<1970){date.setUTCFullYear(y)}return date}addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(input,array){array[YEAR]=input.length===2?utils_hooks__hooks.parseTwoDigitYear(input):toInt(input)});addParseToken("YY",function(input,array){array[YEAR]=utils_hooks__hooks.parseTwoDigitYear(input)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}utils_hooks__hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",false);function getIsLeapYear(){return isLeapYear(this.year())}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day(),adjustedMoment;if(daysToDayOfWeek>end){daysToDayOfWeek-=7}if(daysToDayOfWeek<end-7){daysToDayOfWeek+=7}adjustedMoment=local__createLocal(mom).add(daysToDayOfWeek,"d");return{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var week1Jan=6+firstDayOfWeek-firstDayOfWeekOfYear,janX=createUTCDate(year,0,1+week1Jan),d=janX.getUTCDay(),dayOfYear;if(d<firstDayOfWeek){d+=7}weekday=weekday!=null?1*weekday:firstDayOfWeek;dayOfYear=1+week1Jan+7*(week-1)-d+weekday;return{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var now=new Date;if(config._useUTC){return[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]}return[now.getFullYear(),now.getMonth(),now.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(local__createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1)}else{dow=config._locale._week.dow;doy=config._locale._week.doy;weekYear=defaults(w.gg,config._a[YEAR],weekOfYear(local__createLocal(),dow,doy).year);week=defaults(w.w,1);if(w.d!=null){weekday=w.d;if(weekday<dow){++week}}else if(w.e!=null){weekday=w.e+dow}else{weekday=dow}}temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}utils_hooks__hooks.ISO_8601=function(){};function configFromStringAndFormat(config){if(config._f===utils_hooks__hooks.ISO_8601){configFromISO(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(getParsingFlags(config).bigHour===true&&config._a[HOUR]<=12&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!valid__isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=[i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond];configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||locale_locales__getLocale(config._l);if(input===null||format===undefined&&input===""){return valid__createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else if(isDate(input)){config._d=input}else{configFromInput(config)}return config}function configFromInput(config){var input=config._i;if(input===undefined){config._d=new Date}else if(isDate(input)){config._d=new Date((+input))}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(typeof input==="object"){configFromObject(config)}else if(typeof input==="number"){config._d=new Date(input)}else{utils_hooks__hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(typeof locale==="boolean"){strict=locale;locale=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function local__createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other<this?this:other});var prototypeMax=deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other>this?this:other});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return local__createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*36e5;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=locale_locales__getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchOffset);addRegexToken("ZZ",matchOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(string){var matches=(string||"").match(matchOffset)||[];var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?+input:+local__createLocal(input))-+res;res._d.setTime(+res._d+diff);utils_hooks__hooks.updateOffset(res,false);return res}else{return local__createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}utils_hooks__hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime){var offset=this._offset||0,localAdjust;if(input!=null){if(typeof input==="string"){input=offsetFromString(input)}if(Math.abs(input)<16){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){add_subtract__addSubtract(this,create__createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;utils_hooks__hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm){this.utcOffset(this._tzm)}else if(typeof this._i==="string"){this.utcOffset(offsetFromString(this._i))}return this}function hasAlignedHourOffset(input){input=input?local__createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(typeof this._isDSTShifted!=="undefined"){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?create_utc__createUTC(c._a):local__createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return!this._isUTC}function isUtcOffset(){return this._isUTC}function isUtc(){return this._isUTC&&this._offset===0}var aspNetRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/;var create__isoRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;function create__createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(typeof input==="number"){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}}else if(!!(match=create__isoRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),d:parseIso(match[4],sign),h:parseIso(match[5],sign),m:parseIso(match[6],sign),s:parseIso(match[7],sign),w:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(local__createLocal(duration.from),local__createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}create__createDuration.fn=Duration.prototype;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period).");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=create__createDuration(val,period);add_subtract__addSubtract(this,dur,direction);return this}}function add_subtract__addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=updateOffset==null?true:updateOffset;if(milliseconds){mom._d.setTime(+mom._d+milliseconds*isAdding)}if(days){get_set__set(mom,"Date",get_set__get(mom,"Date")+days*isAdding)}if(months){setMonth(mom,get_set__get(mom,"Month")+months*isAdding)}if(updateOffset){utils_hooks__hooks.updateOffset(mom,days||months)}}var add_subtract__add=createAdder(1,"add");var add_subtract__subtract=createAdder(-1,"subtract");function moment_calendar__calendar(time,formats){var now=time||local__createLocal(),sod=cloneWithOffset(now,this).startOf("day"),diff=this.diff(sod,"days",true),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse";return this.format(formats&&formats[format]||this.localeData().calendar(format,this,local__createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var inputMs;units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this>+input}else{inputMs=isMoment(input)?+input:+local__createLocal(input);return inputMs<+this.clone().startOf(units)}}function isBefore(input,units){var inputMs;units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this<+input}else{inputMs=isMoment(input)?+input:+local__createLocal(input);return+this.clone().endOf(units)<inputMs}}function isBetween(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)}function isSame(input,units){var inputMs;units=normalizeUnits(units||"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this===+input}else{inputMs=+local__createLocal(input);return+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units)}}function diff(input,units,asFloat){var that=cloneWithOffset(input,this),zoneDelta=(that.utcOffset()-this.utcOffset())*6e4,delta,output;units=normalizeUnits(units);if(units==="year"||units==="month"||units==="quarter"){output=monthDiff(this,that);if(units==="quarter"){output=output/3}else if(units==="year"){output=output/12}}else{delta=this-that;output=units==="second"?delta/1e3:units==="minute"?delta/6e4:units==="hour"?delta/36e5:units==="day"?(delta-zoneDelta)/864e5:units==="week"?(delta-zoneDelta)/6048e5:delta}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)}utils_hooks__hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function moment_format__toISOString(){var m=this.clone().utc();if(0<m.year()&&m.year()<=9999){if("function"===typeof Date.prototype.toISOString){return this.toDate().toISOString()}else{return formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}else{return formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}function format(inputString){var output=formatMoment(this,inputString||utils_hooks__hooks.defaultFormat);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(!this.isValid()){return this.localeData().invalidDate()}return create__createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}function fromNow(withoutSuffix){return this.from(local__createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(!this.isValid()){return this.localeData().invalidDate()}return create__createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}function toNow(withoutSuffix){return this.to(local__createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=locale_locales__getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function to_type__valueOf(){return+this._d-(this._offset||0)*6e4}function unix(){return Math.floor(+this/1e3)}function toDate(){return this._offset?new Date((+this)):this._d}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function moment_valid__isValid(){return valid__isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=utils_hooks__hooks.parseTwoDigitYear(input)});function weeksInYear(year,dow,doy){return weekOfYear(local__createLocal([year,11,31+dow-doy]),dow,doy).week}function getSetWeekYear(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return input==null?year:this.add(input-year,"y")}function getSetISOWeekYear(input){var year=weekOfYear(this,1,4).year;return input==null?year:this.add(input-year,"y")}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}addFormatToken("Q",0,0,"quarter");addUnitAlias("quarter","Q");addRegexToken("Q",match1);addParseToken("Q",function(input,array){
array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",matchWord);addRegexToken("ddd",matchWord);addRegexToken("dddd",matchWord);addWeekParseToken(["dd","ddd","dddd"],function(input,week,config){var weekday=config._locale.weekdaysParse(input);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=="string"){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==="number"){return input}return null}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m){return this._weekdays[m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return this._weekdaysShort[m.day()]}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return this._weekdaysMin[m.day()]}function localeWeekdaysParse(weekdayName){var i,mom,regex;this._weekdaysParse=this._weekdaysParse||[];for(i=0;i<7;i++){if(!this._weekdaysParse[i]){mom=local__createLocal([2e3,1]).day(i);regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){return input==null?this.day()||7:this.day(this.day()%7?input:input-7)}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,function(){return this.hours()%12||12});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addParseToken(["H","HH"],HOUR);addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S"){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)}for(token="S";token.length<=9;token+="S"){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var momentPrototype__proto=Moment.prototype;momentPrototype__proto.add=add_subtract__add;momentPrototype__proto.calendar=moment_calendar__calendar;momentPrototype__proto.clone=clone;momentPrototype__proto.diff=diff;momentPrototype__proto.endOf=endOf;momentPrototype__proto.format=format;momentPrototype__proto.from=from;momentPrototype__proto.fromNow=fromNow;momentPrototype__proto.to=to;momentPrototype__proto.toNow=toNow;momentPrototype__proto.get=getSet;momentPrototype__proto.invalidAt=invalidAt;momentPrototype__proto.isAfter=isAfter;momentPrototype__proto.isBefore=isBefore;momentPrototype__proto.isBetween=isBetween;momentPrototype__proto.isSame=isSame;momentPrototype__proto.isValid=moment_valid__isValid;momentPrototype__proto.lang=lang;momentPrototype__proto.locale=locale;momentPrototype__proto.localeData=localeData;momentPrototype__proto.max=prototypeMax;momentPrototype__proto.min=prototypeMin;momentPrototype__proto.parsingFlags=parsingFlags;momentPrototype__proto.set=getSet;momentPrototype__proto.startOf=startOf;momentPrototype__proto.subtract=add_subtract__subtract;momentPrototype__proto.toArray=toArray;momentPrototype__proto.toObject=toObject;momentPrototype__proto.toDate=toDate;momentPrototype__proto.toISOString=moment_format__toISOString;momentPrototype__proto.toJSON=moment_format__toISOString;momentPrototype__proto.toString=toString;momentPrototype__proto.unix=unix;momentPrototype__proto.valueOf=to_type__valueOf;momentPrototype__proto.year=getSetYear;momentPrototype__proto.isLeapYear=getIsLeapYear;momentPrototype__proto.weekYear=getSetWeekYear;momentPrototype__proto.isoWeekYear=getSetISOWeekYear;momentPrototype__proto.quarter=momentPrototype__proto.quarters=getSetQuarter;momentPrototype__proto.month=getSetMonth;momentPrototype__proto.daysInMonth=getDaysInMonth;momentPrototype__proto.week=momentPrototype__proto.weeks=getSetWeek;momentPrototype__proto.isoWeek=momentPrototype__proto.isoWeeks=getSetISOWeek;momentPrototype__proto.weeksInYear=getWeeksInYear;momentPrototype__proto.isoWeeksInYear=getISOWeeksInYear;momentPrototype__proto.date=getSetDayOfMonth;momentPrototype__proto.day=momentPrototype__proto.days=getSetDayOfWeek;momentPrototype__proto.weekday=getSetLocaleDayOfWeek;momentPrototype__proto.isoWeekday=getSetISODayOfWeek;momentPrototype__proto.dayOfYear=getSetDayOfYear;momentPrototype__proto.hour=momentPrototype__proto.hours=getSetHour;momentPrototype__proto.minute=momentPrototype__proto.minutes=getSetMinute;momentPrototype__proto.second=momentPrototype__proto.seconds=getSetSecond;momentPrototype__proto.millisecond=momentPrototype__proto.milliseconds=getSetMillisecond;momentPrototype__proto.utcOffset=getSetOffset;momentPrototype__proto.utc=setOffsetToUTC;momentPrototype__proto.local=setOffsetToLocal;momentPrototype__proto.parseZone=setOffsetToParsedOffset;momentPrototype__proto.hasAlignedHourOffset=hasAlignedHourOffset;momentPrototype__proto.isDST=isDaylightSavingTime;momentPrototype__proto.isDSTShifted=isDaylightSavingTimeShifted;momentPrototype__proto.isLocal=isLocal;momentPrototype__proto.isUtcOffset=isUtcOffset;momentPrototype__proto.isUtc=isUtc;momentPrototype__proto.isUTC=isUtc;momentPrototype__proto.zoneAbbr=getZoneAbbr;momentPrototype__proto.zoneName=getZoneName;momentPrototype__proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);momentPrototype__proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);momentPrototype__proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);momentPrototype__proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",getSetZone);var momentPrototype=momentPrototype__proto;function moment__createUnix(input){return local__createLocal(input*1e3)}function moment__createInZone(){return local__createLocal.apply(null,arguments).parseZone()}var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function locale_calendar__calendar(key,mom,now){var output=this._calendar[key];return typeof output==="function"?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}function preParsePostFormat(string){return string}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relative__relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return typeof output==="function"?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return typeof format==="function"?format(output):format.replace(/%s/i,output)}function locale_set__set(config){var prop,i;for(i in config){prop=config[i];if(typeof prop==="function"){this[i]=prop}else{this["_"+i]=prop}}this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}var prototype__proto=Locale.prototype;prototype__proto._calendar=defaultCalendar;prototype__proto.calendar=locale_calendar__calendar;prototype__proto._longDateFormat=defaultLongDateFormat;prototype__proto.longDateFormat=longDateFormat;prototype__proto._invalidDate=defaultInvalidDate;prototype__proto.invalidDate=invalidDate;prototype__proto._ordinal=defaultOrdinal;prototype__proto.ordinal=ordinal;prototype__proto._ordinalParse=defaultOrdinalParse;prototype__proto.preparse=preParsePostFormat;prototype__proto.postformat=preParsePostFormat;prototype__proto._relativeTime=defaultRelativeTime;prototype__proto.relativeTime=relative__relativeTime;prototype__proto.pastFuture=pastFuture;prototype__proto.set=locale_set__set;prototype__proto.months=localeMonths;prototype__proto._months=defaultLocaleMonths;prototype__proto.monthsShort=localeMonthsShort;prototype__proto._monthsShort=defaultLocaleMonthsShort;prototype__proto.monthsParse=localeMonthsParse;prototype__proto.week=localeWeek;prototype__proto._week=defaultLocaleWeek;prototype__proto.firstDayOfYear=localeFirstDayOfYear;prototype__proto.firstDayOfWeek=localeFirstDayOfWeek;prototype__proto.weekdays=localeWeekdays;prototype__proto._weekdays=defaultLocaleWeekdays;prototype__proto.weekdaysMin=localeWeekdaysMin;prototype__proto._weekdaysMin=defaultLocaleWeekdaysMin;prototype__proto.weekdaysShort=localeWeekdaysShort;prototype__proto._weekdaysShort=defaultLocaleWeekdaysShort;prototype__proto.weekdaysParse=localeWeekdaysParse;prototype__proto.isPM=localeIsPM;prototype__proto._meridiemParse=defaultLocaleMeridiemParse;prototype__proto.meridiem=localeMeridiem;function lists__get(format,index,field,setter){var locale=locale_locales__getLocale();var utc=create_utc__createUTC().set(setter,index);return locale[field](utc,format)}function list(format,index,field,count,setter){if(typeof format==="number"){index=format;format=undefined}format=format||"";if(index!=null){return lists__get(format,index,field,setter)}var i;var out=[];for(i=0;i<count;i++){out[i]=lists__get(format,i,field,setter)}return out}function lists__listMonths(format,index){return list(format,index,"months",12,"month")}function lists__listMonthsShort(format,index){return list(format,index,"monthsShort",12,"month")}function lists__listWeekdays(format,index){return list(format,index,"weekdays",7,"day")}function lists__listWeekdaysShort(format,index){return list(format,index,"weekdaysShort",7,"day")}function lists__listWeekdaysMin(format,index){return list(format,index,"weekdaysMin",7,"day")}locale_locales__getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});utils_hooks__hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",locale_locales__getSetGlobalLocale);utils_hooks__hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",locale_locales__getLocale);var mathAbs=Math.abs;function duration_abs__abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function duration_add_subtract__addSubtract(duration,input,value,direction){var other=create__createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function duration_add_subtract__add(input,value){return duration_add_subtract__addSubtract(this,input,value,1)}function duration_add_subtract__subtract(input,value){return duration_add_subtract__addSubtract(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0}data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);return units==="month"?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function duration_as__valueOf(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function duration_get__get(units){units=normalizeUnits(units);return this[units+"s"]()}function makeGetter(name){return function(){return this._data[name]}}var milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function duration_humanize__relativeTime(posNegDuration,withoutSuffix,locale){var duration=create__createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<thresholds.s&&["s",seconds]||minutes===1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours===1&&["h"]||hours<thresholds.h&&["hh",hours]||days===1&&["d"]||days<thresholds.d&&["dd",days]||months===1&&["M"]||months<thresholds.M&&["MM",months]||years===1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function duration_humanize__getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;return true}function humanize(withSuffix){var locale=this.localeData();var output=duration_humanize__relativeTime(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var iso_string__abs=Math.abs;function iso_string__toISOString(){var seconds=iso_string__abs(this._milliseconds)/1e3;var days=iso_string__abs(this._days);var months=iso_string__abs(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds;var total=this.asSeconds();if(!total){return"P0D"}return(total<0?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":"")}var duration_prototype__proto=Duration.prototype;duration_prototype__proto.abs=duration_abs__abs;duration_prototype__proto.add=duration_add_subtract__add;duration_prototype__proto.subtract=duration_add_subtract__subtract;duration_prototype__proto.as=as;duration_prototype__proto.asMilliseconds=asMilliseconds;duration_prototype__proto.asSeconds=asSeconds;duration_prototype__proto.asMinutes=asMinutes;duration_prototype__proto.asHours=asHours;duration_prototype__proto.asDays=asDays;duration_prototype__proto.asWeeks=asWeeks;duration_prototype__proto.asMonths=asMonths;duration_prototype__proto.asYears=asYears;duration_prototype__proto.valueOf=duration_as__valueOf;duration_prototype__proto._bubble=bubble;duration_prototype__proto.get=duration_get__get;duration_prototype__proto.milliseconds=milliseconds;duration_prototype__proto.seconds=seconds;duration_prototype__proto.minutes=minutes;duration_prototype__proto.hours=hours;duration_prototype__proto.days=days;duration_prototype__proto.weeks=weeks;duration_prototype__proto.months=months;duration_prototype__proto.years=years;duration_prototype__proto.humanize=humanize;duration_prototype__proto.toISOString=iso_string__toISOString;duration_prototype__proto.toString=iso_string__toISOString;duration_prototype__proto.toJSON=iso_string__toISOString;duration_prototype__proto.locale=locale;duration_prototype__proto.localeData=localeData;duration_prototype__proto.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",iso_string__toISOString);duration_prototype__proto.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});utils_hooks__hooks.version="2.10.6";setHookCallback(local__createLocal);utils_hooks__hooks.fn=momentPrototype;utils_hooks__hooks.min=min;utils_hooks__hooks.max=max;utils_hooks__hooks.utc=create_utc__createUTC;utils_hooks__hooks.unix=moment__createUnix;utils_hooks__hooks.months=lists__listMonths;utils_hooks__hooks.isDate=isDate;utils_hooks__hooks.locale=locale_locales__getSetGlobalLocale;utils_hooks__hooks.invalid=valid__createInvalid;utils_hooks__hooks.duration=create__createDuration;utils_hooks__hooks.isMoment=isMoment;utils_hooks__hooks.weekdays=lists__listWeekdays;utils_hooks__hooks.parseZone=moment__createInZone;utils_hooks__hooks.localeData=locale_locales__getLocale;utils_hooks__hooks.isDuration=isDuration;utils_hooks__hooks.monthsShort=lists__listMonthsShort;utils_hooks__hooks.weekdaysMin=lists__listWeekdaysMin;utils_hooks__hooks.defineLocale=defineLocale;utils_hooks__hooks.weekdaysShort=lists__listWeekdaysShort;utils_hooks__hooks.normalizeUnits=normalizeUnits;utils_hooks__hooks.relativeTimeThreshold=duration_humanize__getSetRelativeTimeThreshold;var _moment=utils_hooks__hooks;return _moment});(function(root,undefined){function repeatZero(qty){var result="";qty=parseInt(qty,10);if(!qty||qty<1){return result}while(qty){result+="0";qty-=1}return result}function padZero(str,len,isRight){if(str==null){str=""}str=""+str;return(isRight?str:"")+repeatZero(len-str.length)+(isRight?"":str)}function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}function isObject(obj){return Object.prototype.toString.call(obj)==="[object Object]"}function findLast(array,callback){var index=array.length;while(index-=1){if(callback(array[index])){return array[index]}}}function find(array,callback){var index=0,max=array.length,match;if(typeof callback!=="function"){match=callback;callback=function(item){return item===match}}while(index<max){if(callback(array[index])){return array[index]}index+=1}}function each(array,callback){var index=0,max=array.length;if(!array||!max){return}while(index<max){if(callback(array[index],index)===false){return}index+=1}}function map(array,callback){var index=0,max=array.length,ret=[];if(!array||!max){return ret}while(index<max){ret[index]=callback(array[index],index);index+=1}return ret}function pluck(array,prop){return map(array,function(item){return item[prop]})}function compact(array){var ret=[];each(array,function(item){if(item){ret.push(item)}});return ret}function unique(array){var ret=[];each(array,function(_a){if(!find(ret,_a)){ret.push(_a)}});return ret}function intersection(a,b){var ret=[];each(a,function(_a){each(b,function(_b){if(_a===_b){ret.push(_a)}})});return unique(ret)}function rest(array,callback){var ret=[];each(array,function(item,index){if(!callback(item)){ret=array.slice(index);return false}});return ret}function initial(array,callback){var reversed=array.slice().reverse();return rest(reversed,callback).reverse()}function extend(a,b){for(var key in b){if(b.hasOwnProperty(key)){a[key]=b[key]}}return a}var moment;if(typeof require==="function"){try{moment=require("moment")}catch(e){}}if(!moment&&root.moment){moment=root.moment}if(!moment){throw"Moment Duration Format cannot find Moment.js"}moment.duration.fn.format=function(){var tokenizer,tokens,types,typeMap,momentTypes,foundFirst,trimIndex,args=[].slice.call(arguments),settings=extend({},this.format.defaults),remainder=moment.duration(this);settings.duration=this;each(args,function(arg){if(typeof arg==="string"||typeof arg==="function"){settings.template=arg;return}if(typeof arg==="number"){settings.precision=arg;return}if(isObject(arg)){extend(settings,arg)}});types=settings.types=isArray(settings.types)?settings.types:settings.types.split(" ");if(typeof settings.template==="function"){settings.template=settings.template.apply(settings)}tokenizer=new RegExp(map(types,function(type){return settings[type].source}).join("|"),"g");typeMap=function(token){return find(types,function(type){return settings[type].test(token)})};tokens=map(settings.template.match(tokenizer),function(token,index){var type=typeMap(token),length=token.length;return{index:index,length:length,token:type==="escape"?token.replace(settings.escape,"$1"):token,type:type==="escape"||type==="general"?null:type}},this);momentTypes=intersection(types,unique(compact(pluck(tokens,"type"))));if(!momentTypes.length){return pluck(tokens,"token").join("")}each(momentTypes,function(momentType,index){var value,wholeValue,decimalValue,isLeast,isMost;value=remainder.as(momentType);wholeValue=value>0?Math.floor(value):Math.ceil(value);decimalValue=value-wholeValue;isLeast=index+1===momentTypes.length;isMost=!index;each(tokens,function(token){if(token.type===momentType){extend(token,{value:value,wholeValue:wholeValue,decimalValue:decimalValue,isLeast:isLeast,isMost:isMost});if(isMost){if(settings.forceLength==null&&token.length>1){settings.forceLength=true}}}});remainder.subtract(wholeValue,momentType)});if(settings.trim){tokens=(settings.trim==="left"?rest:initial)(tokens,function(token){return!(token.isLeast||token.type!=null&&token.wholeValue)})}foundFirst=false;if(settings.trim==="right"){tokens.reverse()}tokens=map(tokens,function(token){var val,decVal;if(!token.type){return token.token}if(token.isLeast&&settings.precision<0){val=(Math.floor(token.wholeValue*Math.pow(10,settings.precision))*Math.pow(10,-settings.precision)).toString()}else{val=token.wholeValue.toString()}val=val.replace(/^\-/,"");if(token.length>1&&(foundFirst||token.isMost||settings.forceLength)){val=padZero(val,token.length)}if(token.isLeast&&settings.precision>0){decVal=token.decimalValue.toString().replace(/^\-/,"").split(/\.|e\-/);switch(decVal.length){case 1:val+="."+padZero(decVal[0],settings.precision,true).slice(0,settings.precision);break;case 2:val+="."+padZero(decVal[1],settings.precision,true).slice(0,settings.precision);break;case 3:val+="."+padZero(repeatZero(+decVal[2]-1)+(decVal[0]||"0")+decVal[1],settings.precision,true).slice(0,settings.precision);break;default:throw"Moment Duration Format: unable to parse token decimal value."}}if(token.isMost&&token.value<0){val="-"+val}foundFirst=true;return val});if(settings.trim==="right"){tokens.reverse()}return tokens.join("")};moment.duration.fn.format.defaults={escape:/\[(.+?)\]/,years:/[Yy]+/,months:/M+/,weeks:/[Ww]+/,days:/[Dd]+/,hours:/[Hh]+/,minutes:/m+/,seconds:/s+/,milliseconds:/S+/,general:/.+?/,types:"escape years months weeks days hours minutes seconds milliseconds general",trim:"left",precision:0,forceLength:null,template:function(){var types=this.types,dur=this.duration,lastType=findLast(types,function(type){return dur._data[type]});switch(lastType){case"seconds":return"h:mm:ss";case"minutes":return"d[d] h:mm";case"hours":return"d[d] h[h]";case"days":return"M[m] d[d]";case"weeks":return"y[y] w[w]";case"months":return"y[y] M[m]";case"years":return"y[y]";default:return"y[y] M[m] d[d] h:mm:ss"}}}})(this);(function(){function n(n,t){if(n!==t){var r=null===n,e=n===w,u=n===n,o=null===t,i=t===w,f=t===t;if(n>t&&!o||!u||r&&!i&&f||e&&f)return 1;if(n<t&&!r||!f||o&&!e&&u||i&&u)return-1}return 0}function t(n,t,r){for(var e=n.length,u=r?e:-1;r?u--:++u<e;)if(t(n[u],u,n))return u;return-1}function r(n,t,r){if(t!==t)return p(n,r);r-=1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function e(n){return typeof n=="function"||false}function u(n){return null==n?"":n+""}function o(n,t){for(var r=-1,e=n.length;++r<e&&-1<t.indexOf(n.charAt(r)););return r}function i(n,t){for(var r=n.length;r--&&-1<t.indexOf(n.charAt(r)););return r}function f(t,r){return n(t.a,r.a)||t.b-r.b}function a(n){return Nn[n]}function c(n){return Tn[n]}function l(n,t,r){return t?n=Bn[n]:r&&(n=Dn[n]),"\\"+n}function s(n){return"\\"+Dn[n]}function p(n,t,r){var e=n.length;for(t+=r?0:-1;r?t--:++t<e;){var u=n[t];if(u!==u)return t}return-1}function h(n){return!!n&&typeof n=="object"}function _(n){return 160>=n&&9<=n&&13>=n||32==n||160==n||5760==n||6158==n||8192<=n&&(8202>=n||8232==n||8233==n||8239==n||8287==n||12288==n||65279==n)}function v(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;)n[r]===t&&(n[r]=z,o[++u]=r);return o}function g(n){for(var t=-1,r=n.length;++t<r&&_(n.charCodeAt(t)););return t}function y(n){for(var t=n.length;t--&&_(n.charCodeAt(t)););return t}function d(n){return Ln[n]}function m(_){function Nn(n){if(h(n)&&!(Oo(n)||n instanceof zn)){if(n instanceof Ln)return n;if(nu.call(n,"__chain__")&&nu.call(n,"__wrapped__"))return Mr(n)}return new Ln(n)}function Tn(){}function Ln(n,t,r){this.__wrapped__=n,this.__actions__=r||[],this.__chain__=!!t}function zn(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=false,this.__iteratees__=[],this.__takeCount__=Ru,this.__views__=[]}function Bn(){this.__data__={}}function Dn(n){var t=n?n.length:0;for(this.data={hash:gu(null),set:new lu};t--;)this.push(n[t])}function Mn(n,t){var r=n.data;return(typeof t=="string"||ge(t)?r.set.has(t):r.hash[t])?0:-1}function qn(n,t){var r=-1,e=n.length;for(t||(t=Be(e));++r<e;)t[r]=n[r];return t}function Pn(n,t){for(var r=-1,e=n.length;++r<e&&false!==t(n[r],r,n););return n}function Kn(n,t){for(var r=-1,e=n.length;++r<e;)if(!t(n[r],r,n))return false;return true}function Vn(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;){var i=n[r];t(i,r,n)&&(o[++u]=i)}return o}function Gn(n,t){for(var r=-1,e=n.length,u=Be(e);++r<e;)u[r]=t(n[r],r,n);return u}function Jn(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function Xn(n,t,r,e){var u=-1,o=n.length;for(e&&o&&(r=n[++u]);++u<o;)r=t(r,n[u],u,n);return r}function Hn(n,t){for(var r=-1,e=n.length;++r<e;)if(t(n[r],r,n))return true;return false}function Qn(n,t,r,e){return n!==w&&nu.call(e,r)?n:t}function nt(n,t,r){for(var e=-1,u=zo(t),o=u.length;++e<o;){var i=u[e],f=n[i],a=r(f,t[i],i,n,t);(a===a?a===f:f!==f)&&(f!==w||i in n)||(n[i]=a)}return n}function tt(n,t){return null==t?n:et(t,zo(t),n)}function rt(n,t){for(var r=-1,e=null==n,u=!e&&Er(n),o=u?n.length:0,i=t.length,f=Be(i);++r<i;){var a=t[r];f[r]=u?Cr(a,o)?n[a]:w:e?w:n[a]}return f}function et(n,t,r){r||(r={});for(var e=-1,u=t.length;++e<u;){var o=t[e];r[o]=n[o]}return r}function ut(n,t,r){var e=typeof n;return"function"==e?t===w?n:Bt(n,t,r):null==n?Fe:"object"==e?bt(n):t===w?ze(n):xt(n,t)}function ot(n,t,r,e,u,o,i){
var f;if(r&&(f=u?r(n,e,u):r(n)),f!==w)return f;if(!ge(n))return n;if(e=Oo(n)){if(f=kr(n),!t)return qn(n,f)}else{var a=ru.call(n),c=a==K;if(a!=Z&&a!=B&&(!c||u))return Fn[a]?Rr(n,a,t):u?n:{};if(f=Ir(c?{}:n),!t)return tt(f,n)}for(o||(o=[]),i||(i=[]),u=o.length;u--;)if(o[u]==n)return i[u];return o.push(n),i.push(f),(e?Pn:_t)(n,function(e,u){f[u]=ot(e,t,r,u,n,o,i)}),f}function it(n,t,r){if(typeof n!="function")throw new Ge(L);return su(function(){n.apply(w,r)},t)}function ft(n,t){var e=n?n.length:0,u=[];if(!e)return u;var o=-1,i=xr(),f=i===r,a=f&&t.length>=F&&gu&&lu?new Dn(t):null,c=t.length;a&&(i=Mn,f=false,t=a);n:for(;++o<e;)if(a=n[o],f&&a===a){for(var l=c;l--;)if(t[l]===a)continue n;u.push(a)}else 0>i(t,a,0)&&u.push(a);return u}function at(n,t){var r=true;return Su(n,function(n,e,u){return r=!!t(n,e,u)}),r}function ct(n,t,r,e){var u=e,o=u;return Su(n,function(n,i,f){i=+t(n,i,f),(r(i,u)||i===e&&i===o)&&(u=i,o=n)}),o}function lt(n,t){var r=[];return Su(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function st(n,t,r,e){var u;return r(n,function(n,r,o){return t(n,r,o)?(u=e?r:n,false):void 0}),u}function pt(n,t,r,e){e||(e=[]);for(var u=-1,o=n.length;++u<o;){var i=n[u];h(i)&&Er(i)&&(r||Oo(i)||pe(i))?t?pt(i,t,r,e):Jn(e,i):r||(e[e.length]=i)}return e}function ht(n,t){Nu(n,t,Re)}function _t(n,t){return Nu(n,t,zo)}function vt(n,t){return Tu(n,t,zo)}function gt(n,t){for(var r=-1,e=t.length,u=-1,o=[];++r<e;){var i=t[r];ve(n[i])&&(o[++u]=i)}return o}function yt(n,t,r){if(null!=n){r!==w&&r in Br(n)&&(t=[r]),r=0;for(var e=t.length;null!=n&&r<e;)n=n[t[r++]];return r&&r==e?n:w}}function dt(n,t,r,e,u,o){if(n===t)n=true;else if(null==n||null==t||!ge(n)&&!h(t))n=n!==n&&t!==t;else n:{var i=dt,f=Oo(n),a=Oo(t),c=D,l=D;f||(c=ru.call(n),c==B?c=Z:c!=Z&&(f=xe(n))),a||(l=ru.call(t),l==B?l=Z:l!=Z&&xe(t));var s=c==Z,a=l==Z,l=c==l;if(!l||f||s){if(!e&&(c=s&&nu.call(n,"__wrapped__"),a=a&&nu.call(t,"__wrapped__"),c||a)){n=i(c?n.value():n,a?t.value():t,r,e,u,o);break n}if(l){for(u||(u=[]),o||(o=[]),c=u.length;c--;)if(u[c]==n){n=o[c]==t;break n}u.push(n),o.push(t),n=(f?yr:mr)(n,t,i,r,e,u,o),u.pop(),o.pop()}else n=false}else n=dr(n,t,c)}return n}function mt(n,t,r){var e=t.length,u=e,o=!r;if(null==n)return!u;for(n=Br(n);e--;){var i=t[e];if(o&&i[2]?i[1]!==n[i[0]]:!(i[0]in n))return false}for(;++e<u;){var i=t[e],f=i[0],a=n[f],c=i[1];if(o&&i[2]){if(a===w&&!(f in n))return false}else if(i=r?r(a,c,f):w,i===w?!dt(c,a,r,true):!i)return false}return true}function wt(n,t){var r=-1,e=Er(n)?Be(n.length):[];return Su(n,function(n,u,o){e[++r]=t(n,u,o)}),e}function bt(n){var t=Ar(n);if(1==t.length&&t[0][2]){var r=t[0][0],e=t[0][1];return function(n){return null==n?false:n[r]===e&&(e!==w||r in Br(n))}}return function(n){return mt(n,t)}}function xt(n,t){var r=Oo(n),e=Wr(n)&&t===t&&!ge(t),u=n+"";return n=Dr(n),function(o){if(null==o)return false;var i=u;if(o=Br(o),!(!r&&e||i in o)){if(o=1==n.length?o:yt(o,Et(n,0,-1)),null==o)return false;i=Zr(n),o=Br(o)}return o[i]===t?t!==w||i in o:dt(t,o[i],w,true)}}function At(n,t,r,e,u){if(!ge(n))return n;var o=Er(t)&&(Oo(t)||xe(t)),i=o?w:zo(t);return Pn(i||t,function(f,a){if(i&&(a=f,f=t[a]),h(f)){e||(e=[]),u||(u=[]);n:{for(var c=a,l=e,s=u,p=l.length,_=t[c];p--;)if(l[p]==_){n[c]=s[p];break n}var p=n[c],v=r?r(p,_,c,n,t):w,g=v===w;g&&(v=_,Er(_)&&(Oo(_)||xe(_))?v=Oo(p)?p:Er(p)?qn(p):[]:me(_)||pe(_)?v=pe(p)?ke(p):me(p)?p:{}:g=false),l.push(_),s.push(v),g?n[c]=At(v,_,r,l,s):(v===v?v!==p:p===p)&&(n[c]=v)}}else c=n[a],l=r?r(c,f,a,n,t):w,(s=l===w)&&(l=f),l===w&&(!o||a in n)||!s&&(l===l?l===c:c!==c)||(n[a]=l)}),n}function jt(n){return function(t){return null==t?w:t[n]}}function kt(n){var t=n+"";return n=Dr(n),function(r){return yt(r,n,t)}}function It(n,t){for(var r=n?t.length:0;r--;){var e=t[r];if(e!=u&&Cr(e)){var u=e;pu.call(n,e,1)}}}function Rt(n,t){return n+yu(ku()*(t-n+1))}function Ot(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=false,n):t(r,n,u,o)}),r}function Et(n,t,r){var e=-1,u=n.length;for(t=null==t?0:+t||0,0>t&&(t=-t>u?0:u+t),r=r===w||r>u?u:+r||0,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Be(u);++e<u;)r[e]=n[e+t];return r}function Ct(n,t){var r;return Su(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}function Ut(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function Wt(t,r,e){var u=wr(),o=-1;return r=Gn(r,function(n){return u(n)}),t=wt(t,function(n){return{a:Gn(r,function(t){return t(n)}),b:++o,c:n}}),Ut(t,function(t,r){var u;n:{for(var o=-1,i=t.a,f=r.a,a=i.length,c=e.length;++o<a;)if(u=n(i[o],f[o])){if(o>=c)break n;o=e[o],u*="asc"===o||true===o?1:-1;break n}u=t.b-r.b}return u})}function $t(n,t){var r=0;return Su(n,function(n,e,u){r+=+t(n,e,u)||0}),r}function St(n,t){var e=-1,u=xr(),o=n.length,i=u===r,f=i&&o>=F,a=f&&gu&&lu?new Dn((void 0)):null,c=[];a?(u=Mn,i=false):(f=false,a=t?[]:c);n:for(;++e<o;){var l=n[e],s=t?t(l,e,n):l;if(i&&l===l){for(var p=a.length;p--;)if(a[p]===s)continue n;t&&a.push(s),c.push(l)}else 0>u(a,s,0)&&((t||f)&&a.push(s),c.push(l))}return c}function Ft(n,t){for(var r=-1,e=t.length,u=Be(e);++r<e;)u[r]=n[t[r]];return u}function Nt(n,t,r,e){for(var u=n.length,o=e?u:-1;(e?o--:++o<u)&&t(n[o],o,n););return r?Et(n,e?0:o,e?o+1:u):Et(n,e?o+1:0,e?u:o)}function Tt(n,t){var r=n;r instanceof zn&&(r=r.value());for(var e=-1,u=t.length;++e<u;)var o=t[e],r=o.func.apply(o.thisArg,Jn([r],o.args));return r}function Lt(n,t,r){var e=0,u=n?n.length:e;if(typeof t=="number"&&t===t&&u<=Eu){for(;e<u;){var o=e+u>>>1,i=n[o];(r?i<=t:i<t)&&null!==i?e=o+1:u=o}return u}return zt(n,t,Fe,r)}function zt(n,t,r,e){t=r(t);for(var u=0,o=n?n.length:0,i=t!==t,f=null===t,a=t===w;u<o;){var c=yu((u+o)/2),l=r(n[c]),s=l!==w,p=l===l;(i?p||e:f?p&&s&&(e||null!=l):a?p&&(e||s):null==l?0:e?l<=t:l<t)?u=c+1:o=c}return xu(o,Ou)}function Bt(n,t,r){if(typeof n!="function")return Fe;if(t===w)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,o){return n.call(t,r,e,u,o)};case 5:return function(r,e,u,o,i){return n.call(t,r,e,u,o,i)}}return function(){return n.apply(t,arguments)}}function Dt(n){var t=new ou(n.byteLength);return new hu(t).set(new hu(n)),t}function Mt(n,t,r){for(var e=r.length,u=-1,o=bu(n.length-e,0),i=-1,f=t.length,a=Be(f+o);++i<f;)a[i]=t[i];for(;++u<e;)a[r[u]]=n[u];for(;o--;)a[i++]=n[u++];return a}function qt(n,t,r){for(var e=-1,u=r.length,o=-1,i=bu(n.length-u,0),f=-1,a=t.length,c=Be(i+a);++o<i;)c[o]=n[o];for(i=o;++f<a;)c[i+f]=t[f];for(;++e<u;)c[i+r[e]]=n[o++];return c}function Pt(n,t){return function(r,e,u){var o=t?t():{};if(e=wr(e,u,3),Oo(r)){u=-1;for(var i=r.length;++u<i;){var f=r[u];n(o,f,e(f,u,r),r)}}else Su(r,function(t,r,u){n(o,t,e(t,r,u),u)});return o}}function Kt(n){return le(function(t,r){var e=-1,u=null==t?0:r.length,o=2<u?r[u-2]:w,i=2<u?r[2]:w,f=1<u?r[u-1]:w;for(typeof o=="function"?(o=Bt(o,f,5),u-=2):(o=typeof f=="function"?f:w,u-=o?1:0),i&&Ur(r[0],r[1],i)&&(o=3>u?w:o,u=1);++e<u;)(i=r[e])&&n(t,i,o);return t})}function Vt(n,t){return function(r,e){var u=r?Bu(r):0;if(!Sr(u))return n(r,e);for(var o=t?u:-1,i=Br(r);(t?o--:++o<u)&&false!==e(i[o],o,i););return r}}function Zt(n){return function(t,r,e){var u=Br(t);e=e(t);for(var o=e.length,i=n?o:-1;n?i--:++i<o;){var f=e[i];if(false===r(u[f],f,u))break}return t}}function Yt(n,t){function r(){return(this&&this!==Zn&&this instanceof r?e:n).apply(t,arguments)}var e=Jt(n);return r}function Gt(n){return function(t){var r=-1;t=$e(Ce(t));for(var e=t.length,u="";++r<e;)u=n(u,t[r],r);return u}}function Jt(n){return function(){var t=arguments;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=$u(n.prototype),t=n.apply(r,t);return ge(t)?t:r}}function Xt(n){function t(r,e,u){return u&&Ur(r,e,u)&&(e=w),r=gr(r,n,w,w,w,w,w,e),r.placeholder=t.placeholder,r}return t}function Ht(n,t){return le(function(r){var e=r[0];return null==e?e:(r.push(t),n.apply(w,r))})}function Qt(n,t){return function(r,e,u){if(u&&Ur(r,e,u)&&(e=w),e=wr(e,u,3),1==e.length){u=r=Oo(r)?r:zr(r);for(var o=e,i=-1,f=u.length,a=t,c=a;++i<f;){var l=u[i],s=+o(l);n(s,a)&&(a=s,c=l)}if(u=c,!r.length||u!==t)return u}return ct(r,e,n,t)}}function nr(n,r){return function(e,u,o){return u=wr(u,o,3),Oo(e)?(u=t(e,u,r),-1<u?e[u]:w):st(e,u,n)}}function tr(n){return function(r,e,u){return r&&r.length?(e=wr(e,u,3),t(r,e,n)):-1}}function rr(n){return function(t,r,e){return r=wr(r,e,3),st(t,r,n,true)}}function er(n){return function(){for(var t,r=arguments.length,e=n?r:-1,u=0,o=Be(r);n?e--:++e<r;){var i=o[u++]=arguments[e];if(typeof i!="function")throw new Ge(L);!t&&Ln.prototype.thru&&"wrapper"==br(i)&&(t=new Ln([],true))}for(e=t?-1:r;++e<r;){var i=o[e],u=br(i),f="wrapper"==u?zu(i):w;t=f&&$r(f[0])&&f[1]==(E|k|R|C)&&!f[4].length&&1==f[9]?t[br(f[0])].apply(t,f[3]):1==i.length&&$r(i)?t[u]():t.thru(i)}return function(){var n=arguments,e=n[0];if(t&&1==n.length&&Oo(e)&&e.length>=F)return t.plant(e).value();for(var u=0,n=r?o[u].apply(this,n):e;++u<r;)n=o[u].call(this,n);return n}}}function ur(n,t){return function(r,e,u){return typeof e=="function"&&u===w&&Oo(r)?n(r,e):t(r,Bt(e,u,3))}}function or(n){return function(t,r,e){return(typeof r!="function"||e!==w)&&(r=Bt(r,e,3)),n(t,r,Re)}}function ir(n){return function(t,r,e){return(typeof r!="function"||e!==w)&&(r=Bt(r,e,3)),n(t,r)}}function fr(n){return function(t,r,e){var u={};return r=wr(r,e,3),_t(t,function(t,e,o){o=r(t,e,o),e=n?o:e,t=n?t:o,u[e]=t}),u}}function ar(n){return function(t,r,e){return t=u(t),(n?t:"")+pr(t,r,e)+(n?"":t)}}function cr(n){var t=le(function(r,e){var u=v(e,t.placeholder);return gr(r,n,w,e,u)});return t}function lr(n,t){return function(r,e,u,o){var i=3>arguments.length;return typeof e=="function"&&o===w&&Oo(r)?n(r,e,u,i):Ot(r,wr(e,o,4),u,i,t)}}function sr(n,t,r,e,u,o,i,f,a,c){function l(){for(var m=arguments.length,b=m,j=Be(m);b--;)j[b]=arguments[b];if(e&&(j=Mt(j,e,u)),o&&(j=qt(j,o,i)),_||y){var b=l.placeholder,k=v(j,b),m=m-k.length;if(m<c){var I=f?qn(f):w,m=bu(c-m,0),E=_?k:w,k=_?w:k,C=_?j:w,j=_?w:j;return t|=_?R:O,t&=~(_?O:R),g||(t&=~(x|A)),j=[n,t,r,C,E,j,k,I,a,m],I=sr.apply(w,j),$r(n)&&Du(I,j),I.placeholder=b,I}}if(b=p?r:this,I=h?b[n]:n,f)for(m=j.length,E=xu(f.length,m),k=qn(j);E--;)C=f[E],j[E]=Cr(C,m)?k[C]:w;return s&&a<j.length&&(j.length=a),this&&this!==Zn&&this instanceof l&&(I=d||Jt(n)),I.apply(b,j)}var s=t&E,p=t&x,h=t&A,_=t&k,g=t&j,y=t&I,d=h?w:Jt(n);return l}function pr(n,t,r){return n=n.length,t=+t,n<t&&mu(t)?(t-=n,r=null==r?" ":r+"",Ue(r,vu(t/r.length)).slice(0,t)):""}function hr(n,t,r,e){function u(){for(var t=-1,f=arguments.length,a=-1,c=e.length,l=Be(c+f);++a<c;)l[a]=e[a];for(;f--;)l[a++]=arguments[++t];return(this&&this!==Zn&&this instanceof u?i:n).apply(o?r:this,l)}var o=t&x,i=Jt(n);return u}function _r(n){var t=Pe[n];return function(n,r){return(r=r===w?0:+r||0)?(r=au(10,r),t(n*r)/r):t(n)}}function vr(n){return function(t,r,e,u){var o=wr(e);return null==e&&o===ut?Lt(t,r,n):zt(t,r,o(e,u,1),n)}}function gr(n,t,r,e,u,o,i,f){var a=t&A;if(!a&&typeof n!="function")throw new Ge(L);var c=e?e.length:0;if(c||(t&=~(R|O),e=u=w),c-=u?u.length:0,t&O){var l=e,s=u;e=u=w}var p=a?w:zu(n);return r=[n,t,r,e,u,l,s,o,i,f],p&&(e=r[1],t=p[1],f=e|t,u=t==E&&e==k||t==E&&e==C&&r[7].length<=p[8]||t==(E|C)&&e==k,(f<E||u)&&(t&x&&(r[2]=p[2],f|=e&x?0:j),(e=p[3])&&(u=r[3],r[3]=u?Mt(u,e,p[4]):qn(e),r[4]=u?v(r[3],z):qn(p[4])),(e=p[5])&&(u=r[5],r[5]=u?qt(u,e,p[6]):qn(e),r[6]=u?v(r[5],z):qn(p[6])),(e=p[7])&&(r[7]=qn(e)),t&E&&(r[8]=null==r[8]?p[8]:xu(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=f),t=r[1],f=r[9]),r[9]=null==f?a?0:n.length:bu(f-c,0)||0,(p?Lu:Du)(t==x?Yt(r[0],r[2]):t!=R&&t!=(x|R)||r[4].length?sr.apply(w,r):hr.apply(w,r),r)}function yr(n,t,r,e,u,o,i){var f=-1,a=n.length,c=t.length;if(a!=c&&(!u||c<=a))return false;for(;++f<a;){var l=n[f],c=t[f],s=e?e(u?c:l,u?l:c,f):w;if(s!==w){if(s)continue;return false}if(u){if(!Hn(t,function(n){return l===n||r(l,n,e,u,o,i)}))return false}else if(l!==c&&!r(l,c,e,u,o,i))return false}return true}function dr(n,t,r){switch(r){case M:case q:return+n==+t;case P:return n.name==t.name&&n.message==t.message;case V:return n!=+n?t!=+t:n==+t;case Y:case G:return n==t+""}return false}function mr(n,t,r,e,u,o,i){var f=zo(n),a=f.length,c=zo(t).length;if(a!=c&&!u)return false;for(c=a;c--;){var l=f[c];if(!(u?l in t:nu.call(t,l)))return false}for(var s=u;++c<a;){var l=f[c],p=n[l],h=t[l],_=e?e(u?h:p,u?p:h,l):w;if(_===w?!r(p,h,e,u,o,i):!_)return false;s||(s="constructor"==l)}return s||(r=n.constructor,e=t.constructor,!(r!=e&&"constructor"in n&&"constructor"in t)||typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)?true:false}function wr(n,t,r){var e=Nn.callback||Se,e=e===Se?ut:e;return r?e(n,t,r):e}function br(n){for(var t=n.name+"",r=Wu[t],e=r?r.length:0;e--;){var u=r[e],o=u.func;if(null==o||o==n)return u.name}return t}function xr(n,t,e){var u=Nn.indexOf||Vr,u=u===Vr?r:u;return n?u(n,t,e):u}function Ar(n){n=Oe(n);for(var t=n.length;t--;){var r=n[t][1];n[t][2]=r===r&&!ge(r)}return n}function jr(n,t){var r=null==n?w:n[t];return ye(r)?r:w}function kr(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&nu.call(n,"index")&&(r.index=n.index,r.input=n.input),r}function Ir(n){return n=n.constructor,typeof n=="function"&&n instanceof n||(n=Ve),new n}function Rr(n,t,r){var e=n.constructor;switch(t){case J:return Dt(n);case M:case q:return new e((+n));case X:case H:case Q:case nn:case tn:case rn:case en:case un:case on:return t=n.buffer,new e(r?Dt(t):t,n.byteOffset,n.length);case V:case G:return new e(n);case Y:var u=new e(n.source,kn.exec(n));u.lastIndex=n.lastIndex}return u}function Or(n,t,r){return null==n||Wr(t,n)||(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),t=Zr(t)),t=null==n?n:n[t],null==t?w:t.apply(n,r)}function Er(n){return null!=n&&Sr(Bu(n))}function Cr(n,t){return n=typeof n=="number"||On.test(n)?+n:-1,t=null==t?Cu:t,-1<n&&0==n%1&&n<t}function Ur(n,t,r){if(!ge(r))return false;var e=typeof t;return("number"==e?Er(r)&&Cr(t,r.length):"string"==e&&t in r)?(t=r[t],n===n?n===t:t!==t):false}function Wr(n,t){var r=typeof n;return"string"==r&&dn.test(n)||"number"==r?true:Oo(n)?false:!yn.test(n)||null!=t&&n in Br(t)}function $r(n){var t=br(n),r=Nn[t];return typeof r=="function"&&t in zn.prototype?n===r?true:(t=zu(r),!!t&&n===t[0]):false}function Sr(n){return typeof n=="number"&&-1<n&&0==n%1&&n<=Cu}function Fr(n,t){return n===w?t:Eo(n,t,Fr)}function Nr(n,t){n=Br(n);for(var r=-1,e=t.length,u={};++r<e;){var o=t[r];o in n&&(u[o]=n[o])}return u}function Tr(n,t){var r={};return ht(n,function(n,e,u){t(n,e,u)&&(r[e]=n)}),r}function Lr(n){for(var t=Re(n),r=t.length,e=r&&n.length,u=!!e&&Sr(e)&&(Oo(n)||pe(n)),o=-1,i=[];++o<r;){var f=t[o];(u&&Cr(f,e)||nu.call(n,f))&&i.push(f)}return i}function zr(n){return null==n?[]:Er(n)?ge(n)?n:Ve(n):Ee(n)}function Br(n){return ge(n)?n:Ve(n)}function Dr(n){if(Oo(n))return n;var t=[];return u(n).replace(mn,function(n,r,e,u){t.push(e?u.replace(An,"$1"):r||n)}),t}function Mr(n){return n instanceof zn?n.clone():new Ln(n.__wrapped__,n.__chain__,qn(n.__actions__))}function qr(n,t,r){return n&&n.length?((r?Ur(n,t,r):null==t)&&(t=1),Et(n,0>t?0:t)):[]}function Pr(n,t,r){var e=n?n.length:0;return e?((r?Ur(n,t,r):null==t)&&(t=1),t=e-(+t||0),Et(n,0,0>t?0:t)):[]}function Kr(n){return n?n[0]:w}function Vr(n,t,e){var u=n?n.length:0;if(!u)return-1;if(typeof e=="number")e=0>e?bu(u+e,0):e;else if(e)return e=Lt(n,t),e<u&&(t===t?t===n[e]:n[e]!==n[e])?e:-1;return r(n,t,e||0)}function Zr(n){var t=n?n.length:0;return t?n[t-1]:w}function Yr(n){return qr(n,1)}function Gr(n,t,e,u){if(!n||!n.length)return[];null!=t&&typeof t!="boolean"&&(u=e,e=Ur(n,t,u)?w:t,t=false);var o=wr();if((null!=e||o!==ut)&&(e=o(e,u,3)),t&&xr()===r){t=e;var i;e=-1,u=n.length;for(var o=-1,f=[];++e<u;){var a=n[e],c=t?t(a,e,n):a;e&&i===c||(i=c,f[++o]=a)}n=f}else n=St(n,e);return n}function Jr(n){if(!n||!n.length)return[];var t=-1,r=0;n=Vn(n,function(n){return Er(n)?(r=bu(n.length,r),true):void 0});for(var e=Be(r);++t<r;)e[t]=Gn(n,jt(t));return e}function Xr(n,t,r){return n&&n.length?(n=Jr(n),null==t?n:(t=Bt(t,r,4),Gn(n,function(n){return Xn(n,t,w,true)}))):[]}function Hr(n,t){var r=-1,e=n?n.length:0,u={};for(!e||t||Oo(n[0])||(t=[]);++r<e;){var o=n[r];t?u[o]=t[r]:o&&(u[o[0]]=o[1])}return u}function Qr(n){return n=Nn(n),n.__chain__=true,n}function ne(n,t,r){return t.call(r,n)}function te(n,t,r){var e=Oo(n)?Kn:at;return r&&Ur(n,t,r)&&(t=w),(typeof t!="function"||r!==w)&&(t=wr(t,r,3)),e(n,t)}function re(n,t,r){var e=Oo(n)?Vn:lt;return t=wr(t,r,3),e(n,t)}function ee(n,t,r,e){var u=n?Bu(n):0;return Sr(u)||(n=Ee(n),u=n.length),r=typeof r!="number"||e&&Ur(t,r,e)?0:0>r?bu(u+r,0):r||0,typeof n=="string"||!Oo(n)&&be(n)?r<=u&&-1<n.indexOf(t,r):!!u&&-1<xr(n,t,r)}function ue(n,t,r){var e=Oo(n)?Gn:wt;return t=wr(t,r,3),e(n,t)}function oe(n,t,r){if(r?Ur(n,t,r):null==t){n=zr(n);var e=n.length;return 0<e?n[Rt(0,e-1)]:w}r=-1,n=je(n);var e=n.length,u=e-1;for(t=xu(0>t?0:+t||0,e);++r<t;){var e=Rt(r,u),o=n[e];n[e]=n[r],n[r]=o}return n.length=t,n}function ie(n,t,r){var e=Oo(n)?Hn:Ct;return r&&Ur(n,t,r)&&(t=w),(typeof t!="function"||r!==w)&&(t=wr(t,r,3)),e(n,t)}function fe(n,t){var r;if(typeof t!="function"){if(typeof n!="function")throw new Ge(L);var e=n;n=t,t=e}return function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=w),r}}function ae(n,t,r){function e(t,r){r&&iu(r),a=p=h=w,t&&(_=ho(),c=n.apply(s,f),p||a||(f=s=w))}function u(){var n=t-(ho()-l);0>=n||n>t?e(h,a):p=su(u,n)}function o(){e(g,p)}function i(){if(f=arguments,l=ho(),s=this,h=g&&(p||!y),false===v)var r=y&&!p;else{a||y||(_=l);var e=v-(l-_),i=0>=e||e>v;i?(a&&(a=iu(a)),_=l,c=n.apply(s,f)):a||(a=su(o,e))}return i&&p?p=iu(p):p||t===v||(p=su(u,t)),r&&(i=true,c=n.apply(s,f)),!i||p||a||(f=s=w),c}var f,a,c,l,s,p,h,_=0,v=false,g=true;if(typeof n!="function")throw new Ge(L);if(t=0>t?0:+t||0,true===r)var y=true,g=false;else ge(r)&&(y=!!r.leading,v="maxWait"in r&&bu(+r.maxWait||0,t),g="trailing"in r?!!r.trailing:g);return i.cancel=function(){p&&iu(p),a&&iu(a),_=0,a=p=h=w},i}function ce(n,t){function r(){var e=arguments,u=t?t.apply(this,e):e[0],o=r.cache;return o.has(u)?o.get(u):(e=n.apply(this,e),r.cache=o.set(u,e),e)}if(typeof n!="function"||t&&typeof t!="function")throw new Ge(L);return r.cache=new ce.Cache,r}function le(n,t){if(typeof n!="function")throw new Ge(L);return t=bu(t===w?n.length-1:+t||0,0),function(){for(var r=arguments,e=-1,u=bu(r.length-t,0),o=Be(u);++e<u;)o[e]=r[t+e];switch(t){case 0:return n.call(this,o);case 1:return n.call(this,r[0],o);case 2:return n.call(this,r[0],r[1],o)}for(u=Be(t+1),e=-1;++e<t;)u[e]=r[e];return u[t]=o,n.apply(this,u)}}function se(n,t){return n>t}function pe(n){return h(n)&&Er(n)&&nu.call(n,"callee")&&!cu.call(n,"callee")}function he(n,t,r,e){return e=(r=typeof r=="function"?Bt(r,e,3):w)?r(n,t):w,e===w?dt(n,t,r):!!e}function _e(n){return h(n)&&typeof n.message=="string"&&ru.call(n)==P}function ve(n){return ge(n)&&ru.call(n)==K}function ge(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function ye(n){return null==n?false:ve(n)?uu.test(Qe.call(n)):h(n)&&Rn.test(n)}function de(n){return typeof n=="number"||h(n)&&ru.call(n)==V}function me(n){var t;if(!h(n)||ru.call(n)!=Z||pe(n)||!(nu.call(n,"constructor")||(t=n.constructor,typeof t!="function"||t instanceof t)))return false;var r;return ht(n,function(n,t){r=t}),r===w||nu.call(n,r)}function we(n){return ge(n)&&ru.call(n)==Y}function be(n){return typeof n=="string"||h(n)&&ru.call(n)==G}function xe(n){return h(n)&&Sr(n.length)&&!!Sn[ru.call(n)]}function Ae(n,t){return n<t}function je(n){var t=n?Bu(n):0;return Sr(t)?t?qn(n):[]:Ee(n)}function ke(n){return et(n,Re(n))}function Ie(n){return gt(n,Re(n))}function Re(n){if(null==n)return[];ge(n)||(n=Ve(n));for(var t=n.length,t=t&&Sr(t)&&(Oo(n)||pe(n))&&t||0,r=n.constructor,e=-1,r=typeof r=="function"&&r.prototype===n,u=Be(t),o=0<t;++e<t;)u[e]=e+"";for(var i in n)o&&Cr(i,t)||"constructor"==i&&(r||!nu.call(n,i))||u.push(i);return u}function Oe(n){n=Br(n);for(var t=-1,r=zo(n),e=r.length,u=Be(e);++t<e;){var o=r[t];u[t]=[o,n[o]]}return u}function Ee(n){return Ft(n,zo(n))}function Ce(n){return(n=u(n))&&n.replace(En,a).replace(xn,"")}function Ue(n,t){var r="";if(n=u(n),t=+t,1>t||!n||!mu(t))return r;do t%2&&(r+=n),t=yu(t/2),n+=n;while(t);return r}function We(n,t,r){var e=n;return(n=u(n))?(r?Ur(e,t,r):null==t)?n.slice(g(n),y(n)+1):(t+="",n.slice(o(n,t),i(n,t)+1)):n}function $e(n,t,r){return r&&Ur(n,t,r)&&(t=w),n=u(n),n.match(t||Wn)||[]}function Se(n,t,r){return r&&Ur(n,t,r)&&(t=w),h(n)?Ne(n):ut(n,t)}function Fe(n){return n}function Ne(n){return bt(ot(n,true))}function Te(n,t,r){if(null==r){var e=ge(t),u=e?zo(t):w;((u=u&&u.length?gt(t,u):w)?u.length:e)||(u=false,r=t,t=n,n=this)}u||(u=gt(t,zo(t)));var o=true,e=-1,i=ve(n),f=u.length;false===r?o=false:ge(r)&&"chain"in r&&(o=r.chain);for(;++e<f;){r=u[e];var a=t[r];n[r]=a,i&&(n.prototype[r]=function(t){return function(){var r=this.__chain__;if(o||r){var e=n(this.__wrapped__);return(e.__actions__=qn(this.__actions__)).push({func:t,args:arguments,thisArg:n}),e.__chain__=r,e}return t.apply(n,Jn([this.value()],arguments))}}(a))}return n}function Le(){}function ze(n){return Wr(n)?jt(n):kt(n)}_=_?Yn.defaults(Zn.Object(),_,Yn.pick(Zn,$n)):Zn;var Be=_.Array,De=_.Date,Me=_.Error,qe=_.Function,Pe=_.Math,Ke=_.Number,Ve=_.Object,Ze=_.RegExp,Ye=_.String,Ge=_.TypeError,Je=Be.prototype,Xe=Ve.prototype,He=Ye.prototype,Qe=qe.prototype.toString,nu=Xe.hasOwnProperty,tu=0,ru=Xe.toString,eu=Zn._,uu=Ze("^"+Qe.call(nu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ou=_.ArrayBuffer,iu=_.clearTimeout,fu=_.parseFloat,au=Pe.pow,cu=Xe.propertyIsEnumerable,lu=jr(_,"Set"),su=_.setTimeout,pu=Je.splice,hu=_.Uint8Array,_u=jr(_,"WeakMap"),vu=Pe.ceil,gu=jr(Ve,"create"),yu=Pe.floor,du=jr(Be,"isArray"),mu=_.isFinite,wu=jr(Ve,"keys"),bu=Pe.max,xu=Pe.min,Au=jr(De,"now"),ju=_.parseInt,ku=Pe.random,Iu=Ke.NEGATIVE_INFINITY,Ru=Ke.POSITIVE_INFINITY,Ou=4294967294,Eu=2147483647,Cu=9007199254740991,Uu=_u&&new _u,Wu={};Nn.support={},Nn.templateSettings={escape:_n,evaluate:vn,interpolate:gn,variable:"",imports:{_:Nn}};var $u=function(){function n(){}return function(t){if(ge(t)){n.prototype=t;var r=new n;n.prototype=w}return r||{}}}(),Su=Vt(_t),Fu=Vt(vt,true),Nu=Zt(),Tu=Zt(true),Lu=Uu?function(n,t){return Uu.set(n,t),n}:Fe,zu=Uu?function(n){return Uu.get(n)}:Le,Bu=jt("length"),Du=function(){var n=0,t=0;return function(r,e){var u=ho(),o=S-(u-t);if(t=u,0<o){if(++n>=$)return r}else n=0;return Lu(r,e)}}(),Mu=le(function(n,t){return h(n)&&Er(n)?ft(n,pt(t,false,true)):[]}),qu=tr(),Pu=tr(true),Ku=le(function(n){for(var t=n.length,e=t,u=Be(l),o=xr(),i=o===r,f=[];e--;){var a=n[e]=Er(a=n[e])?a:[];u[e]=i&&120<=a.length&&gu&&lu?new Dn(e&&a):null}var i=n[0],c=-1,l=i?i.length:0,s=u[0];n:for(;++c<l;)if(a=i[c],0>(s?Mn(s,a):o(f,a,0))){for(e=t;--e;){var p=u[e];if(0>(p?Mn(p,a):o(n[e],a,0)))continue n}s&&s.push(a),f.push(a)}return f}),Vu=le(function(t,r){r=pt(r);var e=rt(t,r);return It(t,r.sort(n)),e}),Zu=vr(),Yu=vr(true),Gu=le(function(n){return St(pt(n,false,true))}),Ju=le(function(n,t){return Er(n)?ft(n,t):[]}),Xu=le(Jr),Hu=le(function(n){var t=n.length,r=2<t?n[t-2]:w,e=1<t?n[t-1]:w;return 2<t&&typeof r=="function"?t-=2:(r=1<t&&typeof e=="function"?(--t,e):w,e=w),n.length=t,Xr(n,r,e)}),Qu=le(function(n){return n=pt(n),this.thru(function(t){t=Oo(t)?t:[Br(t)];for(var r=n,e=-1,u=t.length,o=-1,i=r.length,f=Be(u+i);++e<u;)f[e]=t[e];for(;++o<i;)f[e++]=r[o];return f})}),no=le(function(n,t){return rt(n,pt(t))}),to=Pt(function(n,t,r){nu.call(n,r)?++n[r]:n[r]=1}),ro=nr(Su),eo=nr(Fu,true),uo=ur(Pn,Su),oo=ur(function(n,t){for(var r=n.length;r--&&false!==t(n[r],r,n););return n},Fu),io=Pt(function(n,t,r){nu.call(n,r)?n[r].push(t):n[r]=[t]}),fo=Pt(function(n,t,r){n[r]=t}),ao=le(function(n,t,r){var e=-1,u=typeof t=="function",o=Wr(t),i=Er(n)?Be(n.length):[];return Su(n,function(n){var f=u?t:o&&null!=n?n[t]:w;i[++e]=f?f.apply(n,r):Or(n,t,r)}),i}),co=Pt(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),lo=lr(Xn,Su),so=lr(function(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r},Fu),po=le(function(n,t){if(null==n)return[];var r=t[2];return r&&Ur(t[0],t[1],r)&&(t.length=1),Wt(n,pt(t),[])}),ho=Au||function(){return(new De).getTime()},_o=le(function(n,t,r){var e=x;if(r.length)var u=v(r,_o.placeholder),e=e|R;return gr(n,e,t,r,u)}),vo=le(function(n,t){t=t.length?pt(t):Ie(n);for(var r=-1,e=t.length;++r<e;){var u=t[r];n[u]=gr(n[u],x,n)}return n}),go=le(function(n,t,r){var e=x|A;if(r.length)var u=v(r,go.placeholder),e=e|R;return gr(t,e,n,r,u)}),yo=Xt(k),mo=Xt(I),wo=le(function(n,t){return it(n,1,t)}),bo=le(function(n,t,r){return it(n,t,r)}),xo=er(),Ao=er(true),jo=le(function(n,t){if(t=pt(t),typeof n!="function"||!Kn(t,e))throw new Ge(L);var r=t.length;return le(function(e){for(var u=xu(e.length,r);u--;)e[u]=t[u](e[u]);return n.apply(this,e)})}),ko=cr(R),Io=cr(O),Ro=le(function(n,t){return gr(n,C,w,w,w,pt(t))}),Oo=du||function(n){return h(n)&&Sr(n.length)&&ru.call(n)==D},Eo=Kt(At),Co=Kt(function(n,t,r){return r?nt(n,t,r):tt(n,t)}),Uo=Ht(Co,function(n,t){return n===w?t:n}),Wo=Ht(Eo,Fr),$o=rr(_t),So=rr(vt),Fo=or(Nu),No=or(Tu),To=ir(_t),Lo=ir(vt),zo=wu?function(n){var t=null==n?w:n.constructor;return typeof t=="function"&&t.prototype===n||typeof n!="function"&&Er(n)?Lr(n):ge(n)?wu(n):[]}:Lr,Bo=fr(true),Do=fr(),Mo=le(function(n,t){if(null==n)return{};if("function"!=typeof t[0])return t=Gn(pt(t),Ye),Nr(n,ft(Re(n),t));var r=Bt(t[0],t[1],3);return Tr(n,function(n,t,e){return!r(n,t,e)})}),qo=le(function(n,t){return null==n?{}:"function"==typeof t[0]?Tr(n,Bt(t[0],t[1],3)):Nr(n,pt(t))}),Po=Gt(function(n,t,r){return t=t.toLowerCase(),n+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),Ko=Gt(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),Vo=ar(),Zo=ar(true),Yo=Gt(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),Go=Gt(function(n,t,r){return n+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Jo=le(function(n,t){try{return n.apply(w,t)}catch(r){return _e(r)?r:new Me(r)}}),Xo=le(function(n,t){return function(r){return Or(r,n,t)}}),Ho=le(function(n,t){return function(r){return Or(n,r,t)}}),Qo=_r("ceil"),ni=_r("floor"),ti=Qt(se,Iu),ri=Qt(Ae,Ru),ei=_r("round");return Nn.prototype=Tn.prototype,Ln.prototype=$u(Tn.prototype),Ln.prototype.constructor=Ln,zn.prototype=$u(Tn.prototype),zn.prototype.constructor=zn,Bn.prototype["delete"]=function(n){return this.has(n)&&delete this.__data__[n]},Bn.prototype.get=function(n){return"__proto__"==n?w:this.__data__[n]},Bn.prototype.has=function(n){return"__proto__"!=n&&nu.call(this.__data__,n)},Bn.prototype.set=function(n,t){return"__proto__"!=n&&(this.__data__[n]=t),this},Dn.prototype.push=function(n){var t=this.data;typeof n=="string"||ge(n)?t.set.add(n):t.hash[n]=true},ce.Cache=Bn,Nn.after=function(n,t){if(typeof t!="function"){if(typeof n!="function")throw new Ge(L);var r=n;n=t,t=r}return n=mu(n=+n)?n:0,function(){return 1>--n?t.apply(this,arguments):void 0}},Nn.ary=function(n,t,r){return r&&Ur(n,t,r)&&(t=w),t=n&&null==t?n.length:bu(+t||0,0),gr(n,E,w,w,w,w,t)},Nn.assign=Co,Nn.at=no,Nn.before=fe,Nn.bind=_o,Nn.bindAll=vo,Nn.bindKey=go,Nn.callback=Se,Nn.chain=Qr,Nn.chunk=function(n,t,r){t=(r?Ur(n,t,r):null==t)?1:bu(yu(t)||1,1),r=0;for(var e=n?n.length:0,u=-1,o=Be(vu(e/t));r<e;)o[++u]=Et(n,r,r+=t);return o},Nn.compact=function(n){for(var t=-1,r=n?n.length:0,e=-1,u=[];++t<r;){var o=n[t];o&&(u[++e]=o)}return u},Nn.constant=function(n){return function(){return n}},Nn.countBy=to,Nn.create=function(n,t,r){var e=$u(n);return r&&Ur(n,t,r)&&(t=w),t?tt(e,t):e},Nn.curry=yo,Nn.curryRight=mo,Nn.debounce=ae,Nn.defaults=Uo,Nn.defaultsDeep=Wo,Nn.defer=wo,Nn.delay=bo,Nn.difference=Mu,Nn.drop=qr,Nn.dropRight=Pr,Nn.dropRightWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3),true,true):[]},Nn.dropWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3),true):[]},Nn.fill=function(n,t,r,e){var u=n?n.length:0;if(!u)return[];for(r&&typeof r!="number"&&Ur(n,t,r)&&(r=0,e=u),u=n.length,r=null==r?0:+r||0,0>r&&(r=-r>u?0:u+r),e=e===w||e>u?u:+e||0,0>e&&(e+=u),u=r>e?0:e>>>0,r>>>=0;r<u;)n[r++]=t;return n},Nn.filter=re,Nn.flatten=function(n,t,r){var e=n?n.length:0;return r&&Ur(n,t,r)&&(t=false),e?pt(n,t):[]},Nn.flattenDeep=function(n){return n&&n.length?pt(n,true):[]},Nn.flow=xo,Nn.flowRight=Ao,Nn.forEach=uo,Nn.forEachRight=oo,Nn.forIn=Fo,Nn.forInRight=No,Nn.forOwn=To,Nn.forOwnRight=Lo,Nn.functions=Ie,Nn.groupBy=io,Nn.indexBy=fo,Nn.initial=function(n){return Pr(n,1)},Nn.intersection=Ku,Nn.invert=function(n,t,r){r&&Ur(n,t,r)&&(t=w),r=-1;for(var e=zo(n),u=e.length,o={};++r<u;){var i=e[r],f=n[i];t?nu.call(o,f)?o[f].push(i):o[f]=[i]:o[f]=i}return o},Nn.invoke=ao,Nn.keys=zo,Nn.keysIn=Re,Nn.map=ue,Nn.mapKeys=Bo,Nn.mapValues=Do,Nn.matches=Ne,Nn.matchesProperty=function(n,t){return xt(n,ot(t,true))},Nn.memoize=ce,Nn.merge=Eo,Nn.method=Xo,Nn.methodOf=Ho,Nn.mixin=Te,Nn.modArgs=jo,Nn.negate=function(n){if(typeof n!="function")throw new Ge(L);return function(){return!n.apply(this,arguments)}},Nn.omit=Mo,Nn.once=function(n){return fe(2,n)},Nn.pairs=Oe,Nn.partial=ko,Nn.partialRight=Io,Nn.partition=co,Nn.pick=qo,Nn.pluck=function(n,t){return ue(n,ze(t))},Nn.property=ze,Nn.propertyOf=function(n){return function(t){return yt(n,Dr(t),t+"")}},Nn.pull=function(){var n=arguments,t=n[0];if(!t||!t.length)return t;for(var r=0,e=xr(),u=n.length;++r<u;)for(var o=0,i=n[r];-1<(o=e(t,i,o));)pu.call(t,o,1);return t},Nn.pullAt=Vu,Nn.range=function(n,t,r){r&&Ur(n,t,r)&&(t=r=w),n=+n||0,r=null==r?1:+r||0,null==t?(t=n,n=0):t=+t||0;var e=-1;t=bu(vu((t-n)/(r||1)),0);for(var u=Be(t);++e<t;)u[e]=n,n+=r;return u},Nn.rearg=Ro,Nn.reject=function(n,t,r){var e=Oo(n)?Vn:lt;return t=wr(t,r,3),e(n,function(n,r,e){return!t(n,r,e)})},Nn.remove=function(n,t,r){var e=[];if(!n||!n.length)return e;var u=-1,o=[],i=n.length;for(t=wr(t,r,3);++u<i;)r=n[u],t(r,u,n)&&(e.push(r),o.push(u));return It(n,o),e},Nn.rest=Yr,Nn.restParam=le,Nn.set=function(n,t,r){if(null==n)return n;var e=t+"";t=null!=n[e]||Wr(t,n)?[e]:Dr(t);for(var e=-1,u=t.length,o=u-1,i=n;null!=i&&++e<u;){var f=t[e];ge(i)&&(e==o?i[f]=r:null==i[f]&&(i[f]=Cr(t[e+1])?[]:{})),i=i[f]}return n},Nn.shuffle=function(n){return oe(n,Ru)},Nn.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&typeof r!="number"&&Ur(n,t,r)&&(t=0,r=e),Et(n,t,r)):[]},Nn.sortBy=function(n,t,r){if(null==n)return[];r&&Ur(n,t,r)&&(t=w);var e=-1;return t=wr(t,r,3),n=wt(n,function(n,r,u){return{a:t(n,r,u),b:++e,c:n}}),Ut(n,f)},Nn.sortByAll=po,Nn.sortByOrder=function(n,t,r,e){return null==n?[]:(e&&Ur(t,r,e)&&(r=w),Oo(t)||(t=null==t?[]:[t]),Oo(r)||(r=null==r?[]:[r]),Wt(n,t,r))},Nn.spread=function(n){if(typeof n!="function")throw new Ge(L);return function(t){return n.apply(this,t)}},Nn.take=function(n,t,r){return n&&n.length?((r?Ur(n,t,r):null==t)&&(t=1),Et(n,0,0>t?0:t)):[]},Nn.takeRight=function(n,t,r){var e=n?n.length:0;return e?((r?Ur(n,t,r):null==t)&&(t=1),t=e-(+t||0),Et(n,0>t?0:t)):[]},Nn.takeRightWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3),false,true):[]},Nn.takeWhile=function(n,t,r){return n&&n.length?Nt(n,wr(t,r,3)):[]},Nn.tap=function(n,t,r){return t.call(r,n),n},Nn.throttle=function(n,t,r){var e=true,u=true;if(typeof n!="function")throw new Ge(L);return false===r?e=false:ge(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),ae(n,t,{leading:e,maxWait:+t,trailing:u})},Nn.thru=ne,Nn.times=function(n,t,r){if(n=yu(n),1>n||!mu(n))return[];var e=-1,u=Be(xu(n,4294967295));for(t=Bt(t,r,1);++e<n;)4294967295>e?u[e]=t(e):t(e);return u},Nn.toArray=je,Nn.toPlainObject=ke,Nn.transform=function(n,t,r,e){var u=Oo(n)||xe(n);return t=wr(t,e,4),null==r&&(u||ge(n)?(e=n.constructor,r=u?Oo(n)?new e:[]:$u(ve(e)?e.prototype:w)):r={}),(u?Pn:_t)(n,function(n,e,u){return t(r,n,e,u)}),r},Nn.union=Gu,Nn.uniq=Gr,Nn.unzip=Jr,Nn.unzipWith=Xr,Nn.values=Ee,Nn.valuesIn=function(n){return Ft(n,Re(n))},Nn.where=function(n,t){
return re(n,bt(t))},Nn.without=Ju,Nn.wrap=function(n,t){return t=null==t?Fe:t,gr(t,R,w,[n],[])},Nn.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var r=arguments[n];if(Er(r))var e=e?Jn(ft(e,r),ft(r,e)):r}return e?St(e):[]},Nn.zip=Xu,Nn.zipObject=Hr,Nn.zipWith=Hu,Nn.backflow=Ao,Nn.collect=ue,Nn.compose=Ao,Nn.each=uo,Nn.eachRight=oo,Nn.extend=Co,Nn.iteratee=Se,Nn.methods=Ie,Nn.object=Hr,Nn.select=re,Nn.tail=Yr,Nn.unique=Gr,Te(Nn,Nn),Nn.add=function(n,t){return(+n||0)+(+t||0)},Nn.attempt=Jo,Nn.camelCase=Po,Nn.capitalize=function(n){return(n=u(n))&&n.charAt(0).toUpperCase()+n.slice(1)},Nn.ceil=Qo,Nn.clone=function(n,t,r,e){return t&&typeof t!="boolean"&&Ur(n,t,r)?t=false:typeof t=="function"&&(e=r,r=t,t=false),typeof r=="function"?ot(n,t,Bt(r,e,3)):ot(n,t)},Nn.cloneDeep=function(n,t,r){return typeof t=="function"?ot(n,true,Bt(t,r,3)):ot(n,true)},Nn.deburr=Ce,Nn.endsWith=function(n,t,r){n=u(n),t+="";var e=n.length;return r=r===w?e:xu(0>r?0:+r||0,e),r-=t.length,0<=r&&n.indexOf(t,r)==r},Nn.escape=function(n){return(n=u(n))&&hn.test(n)?n.replace(sn,c):n},Nn.escapeRegExp=function(n){return(n=u(n))&&bn.test(n)?n.replace(wn,l):n||"(?:)"},Nn.every=te,Nn.find=ro,Nn.findIndex=qu,Nn.findKey=$o,Nn.findLast=eo,Nn.findLastIndex=Pu,Nn.findLastKey=So,Nn.findWhere=function(n,t){return ro(n,bt(t))},Nn.first=Kr,Nn.floor=ni,Nn.get=function(n,t,r){return n=null==n?w:yt(n,Dr(t),t+""),n===w?r:n},Nn.gt=se,Nn.gte=function(n,t){return n>=t},Nn.has=function(n,t){if(null==n)return false;var r=nu.call(n,t);if(!r&&!Wr(t)){if(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),null==n)return false;t=Zr(t),r=nu.call(n,t)}return r||Sr(n.length)&&Cr(t,n.length)&&(Oo(n)||pe(n))},Nn.identity=Fe,Nn.includes=ee,Nn.indexOf=Vr,Nn.inRange=function(n,t,r){return t=+t||0,r===w?(r=t,t=0):r=+r||0,n>=xu(t,r)&&n<bu(t,r)},Nn.isArguments=pe,Nn.isArray=Oo,Nn.isBoolean=function(n){return true===n||false===n||h(n)&&ru.call(n)==M},Nn.isDate=function(n){return h(n)&&ru.call(n)==q},Nn.isElement=function(n){return!!n&&1===n.nodeType&&h(n)&&!me(n)},Nn.isEmpty=function(n){return null==n?true:Er(n)&&(Oo(n)||be(n)||pe(n)||h(n)&&ve(n.splice))?!n.length:!zo(n).length},Nn.isEqual=he,Nn.isError=_e,Nn.isFinite=function(n){return typeof n=="number"&&mu(n)},Nn.isFunction=ve,Nn.isMatch=function(n,t,r,e){return r=typeof r=="function"?Bt(r,e,3):w,mt(n,Ar(t),r)},Nn.isNaN=function(n){return de(n)&&n!=+n},Nn.isNative=ye,Nn.isNull=function(n){return null===n},Nn.isNumber=de,Nn.isObject=ge,Nn.isPlainObject=me,Nn.isRegExp=we,Nn.isString=be,Nn.isTypedArray=xe,Nn.isUndefined=function(n){return n===w},Nn.kebabCase=Ko,Nn.last=Zr,Nn.lastIndexOf=function(n,t,r){var e=n?n.length:0;if(!e)return-1;var u=e;if(typeof r=="number")u=(0>r?bu(e+r,0):xu(r||0,e-1))+1;else if(r)return u=Lt(n,t,true)-1,n=n[u],(t===t?t===n:n!==n)?u:-1;if(t!==t)return p(n,u,true);for(;u--;)if(n[u]===t)return u;return-1},Nn.lt=Ae,Nn.lte=function(n,t){return n<=t},Nn.max=ti,Nn.min=ri,Nn.noConflict=function(){return Zn._=eu,this},Nn.noop=Le,Nn.now=ho,Nn.pad=function(n,t,r){n=u(n),t=+t;var e=n.length;return e<t&&mu(t)?(e=(t-e)/2,t=yu(e),e=vu(e),r=pr("",e,r),r.slice(0,t)+n+r):n},Nn.padLeft=Vo,Nn.padRight=Zo,Nn.parseInt=function(n,t,r){return(r?Ur(n,t,r):null==t)?t=0:t&&(t=+t),n=We(n),ju(n,t||(In.test(n)?16:10))},Nn.random=function(n,t,r){r&&Ur(n,t,r)&&(t=r=w);var e=null==n,u=null==t;return null==r&&(u&&typeof n=="boolean"?(r=n,n=1):typeof t=="boolean"&&(r=t,u=true)),e&&u&&(t=1,u=false),n=+n||0,u?(t=n,n=0):t=+t||0,r||n%1||t%1?(r=ku(),xu(n+r*(t-n+fu("1e-"+((r+"").length-1))),t)):Rt(n,t)},Nn.reduce=lo,Nn.reduceRight=so,Nn.repeat=Ue,Nn.result=function(n,t,r){var e=null==n?w:n[t];return e===w&&(null==n||Wr(t,n)||(t=Dr(t),n=1==t.length?n:yt(n,Et(t,0,-1)),e=null==n?w:n[Zr(t)]),e=e===w?r:e),ve(e)?e.call(n):e},Nn.round=ei,Nn.runInContext=m,Nn.size=function(n){var t=n?Bu(n):0;return Sr(t)?t:zo(n).length},Nn.snakeCase=Yo,Nn.some=ie,Nn.sortedIndex=Zu,Nn.sortedLastIndex=Yu,Nn.startCase=Go,Nn.startsWith=function(n,t,r){return n=u(n),r=null==r?0:xu(0>r?0:+r||0,n.length),n.lastIndexOf(t,r)==r},Nn.sum=function(n,t,r){if(r&&Ur(n,t,r)&&(t=w),t=wr(t,r,3),1==t.length){n=Oo(n)?n:zr(n),r=n.length;for(var e=0;r--;)e+=+t(n[r])||0;n=e}else n=$t(n,t);return n},Nn.template=function(n,t,r){var e=Nn.templateSettings;r&&Ur(n,t,r)&&(t=r=w),n=u(n),t=nt(tt({},r||t),e,Qn),r=nt(tt({},t.imports),e.imports,Qn);var o,i,f=zo(r),a=Ft(r,f),c=0;r=t.interpolate||Cn;var l="__p+='";r=Ze((t.escape||Cn).source+"|"+r.source+"|"+(r===gn?jn:Cn).source+"|"+(t.evaluate||Cn).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(n.replace(r,function(t,r,e,u,f,a){return e||(e=u),l+=n.slice(c,a).replace(Un,s),r&&(o=true,l+="'+__e("+r+")+'"),f&&(i=true,l+="';"+f+";\n__p+='"),e&&(l+="'+((__t=("+e+"))==null?'':__t)+'"),c=a+t.length,t}),l+="';",(t=t.variable)||(l="with(obj){"+l+"}"),l=(i?l.replace(fn,""):l).replace(an,"$1").replace(cn,"$1;"),l="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(o?",__e=_.escape":"")+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",t=Jo(function(){return qe(f,p+"return "+l).apply(w,a)}),t.source=l,_e(t))throw t;return t},Nn.trim=We,Nn.trimLeft=function(n,t,r){var e=n;return(n=u(n))?n.slice((r?Ur(e,t,r):null==t)?g(n):o(n,t+"")):n},Nn.trimRight=function(n,t,r){var e=n;return(n=u(n))?(r?Ur(e,t,r):null==t)?n.slice(0,y(n)+1):n.slice(0,i(n,t+"")+1):n},Nn.trunc=function(n,t,r){r&&Ur(n,t,r)&&(t=w);var e=U;if(r=W,null!=t)if(ge(t)){var o="separator"in t?t.separator:o,e="length"in t?+t.length||0:e;r="omission"in t?u(t.omission):r}else e=+t||0;if(n=u(n),e>=n.length)return n;if(e-=r.length,1>e)return r;if(t=n.slice(0,e),null==o)return t+r;if(we(o)){if(n.slice(e).search(o)){var i,f=n.slice(0,e);for(o.global||(o=Ze(o.source,(kn.exec(o)||"")+"g")),o.lastIndex=0;n=o.exec(f);)i=n.index;t=t.slice(0,null==i?e:i)}}else n.indexOf(o,e)!=e&&(o=t.lastIndexOf(o),-1<o&&(t=t.slice(0,o)));return t+r},Nn.unescape=function(n){return(n=u(n))&&pn.test(n)?n.replace(ln,d):n},Nn.uniqueId=function(n){var t=++tu;return u(n)+t},Nn.words=$e,Nn.all=te,Nn.any=ie,Nn.contains=ee,Nn.eq=he,Nn.detect=ro,Nn.foldl=lo,Nn.foldr=so,Nn.head=Kr,Nn.include=ee,Nn.inject=lo,Te(Nn,function(){var n={};return _t(Nn,function(t,r){Nn.prototype[r]||(n[r]=t)}),n}(),false),Nn.sample=oe,Nn.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(t){return oe(t,n)}):oe(this.value())},Nn.VERSION=b,Pn("bind bindKey curry curryRight partial partialRight".split(" "),function(n){Nn[n].placeholder=Nn}),Pn(["drop","take"],function(n,t){zn.prototype[n]=function(r){var e=this.__filtered__;if(e&&!t)return new zn(this);r=null==r?1:bu(yu(r)||0,0);var u=this.clone();return e?u.__takeCount__=xu(u.__takeCount__,r):u.__views__.push({size:r,type:n+(0>u.__dir__?"Right":"")}),u},zn.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),Pn(["filter","map","takeWhile"],function(n,t){var r=t+1,e=r!=T;zn.prototype[n]=function(n,t){var u=this.clone();return u.__iteratees__.push({iteratee:wr(n,t,1),type:r}),u.__filtered__=u.__filtered__||e,u}}),Pn(["first","last"],function(n,t){var r="take"+(t?"Right":"");zn.prototype[n]=function(){return this[r](1).value()[0]}}),Pn(["initial","rest"],function(n,t){var r="drop"+(t?"":"Right");zn.prototype[n]=function(){return this.__filtered__?new zn(this):this[r](1)}}),Pn(["pluck","where"],function(n,t){var r=t?"filter":"map",e=t?bt:ze;zn.prototype[n]=function(n){return this[r](e(n))}}),zn.prototype.compact=function(){return this.filter(Fe)},zn.prototype.reject=function(n,t){return n=wr(n,t,1),this.filter(function(t){return!n(t)})},zn.prototype.slice=function(n,t){n=null==n?0:+n||0;var r=this;return r.__filtered__&&(0<n||0>t)?new zn(r):(0>n?r=r.takeRight(-n):n&&(r=r.drop(n)),t!==w&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-n)),r)},zn.prototype.takeRightWhile=function(n,t){return this.reverse().takeWhile(n,t).reverse()},zn.prototype.toArray=function(){return this.take(Ru)},_t(zn.prototype,function(n,t){var r=/^(?:filter|map|reject)|While$/.test(t),e=/^(?:first|last)$/.test(t),u=Nn[e?"take"+("last"==t?"Right":""):t];u&&(Nn.prototype[t]=function(){function t(n){return e&&i?u(n,1)[0]:u.apply(w,Jn([n],o))}var o=e?[1]:arguments,i=this.__chain__,f=this.__wrapped__,a=!!this.__actions__.length,c=f instanceof zn,l=o[0],s=c||Oo(f);return s&&r&&typeof l=="function"&&1!=l.length&&(c=s=false),l={func:ne,args:[t],thisArg:w},a=c&&!a,e&&!i?a?(f=f.clone(),f.__actions__.push(l),n.call(f)):u.call(w,this.value())[0]:!e&&s?(f=a?f:new zn(this),f=n.apply(f,o),f.__actions__.push(l),new Ln(f,i)):this.thru(t)})}),Pn("join pop push replace shift sort splice split unshift".split(" "),function(n){var t=(/^(?:replace|split)$/.test(n)?He:Je)[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:join|pop|replace|shift)$/.test(n);Nn.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}}),_t(zn.prototype,function(n,t){var r=Nn[t];if(r){var e=r.name+"";(Wu[e]||(Wu[e]=[])).push({name:t,func:r})}}),Wu[sr(w,A).name]=[{name:"wrapper",func:w}],zn.prototype.clone=function(){var n=new zn(this.__wrapped__);return n.__actions__=qn(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=qn(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=qn(this.__views__),n},zn.prototype.reverse=function(){if(this.__filtered__){var n=new zn(this);n.__dir__=-1,n.__filtered__=true}else n=this.clone(),n.__dir__*=-1;return n},zn.prototype.value=function(){var n,t=this.__wrapped__.value(),r=this.__dir__,e=Oo(t),u=0>r,o=e?t.length:0;n=o;for(var i=this.__views__,f=0,a=-1,c=i.length;++a<c;){var l=i[a],s=l.size;switch(l.type){case"drop":f+=s;break;case"dropRight":n-=s;break;case"take":n=xu(n,f+s);break;case"takeRight":f=bu(f,n-s)}}if(n={start:f,end:n},i=n.start,f=n.end,n=f-i,u=u?f:i-1,i=this.__iteratees__,f=i.length,a=0,c=xu(n,this.__takeCount__),!e||o<F||o==n&&c==n)return Tt(t,this.__actions__);e=[];n:for(;n--&&a<c;){for(u+=r,o=-1,l=t[u];++o<f;){var p=i[o],s=p.type,p=p.iteratee(l);if(s==T)l=p;else if(!p){if(s==N)continue n;break n}}e[a++]=l}return e},Nn.prototype.chain=function(){return Qr(this)},Nn.prototype.commit=function(){return new Ln(this.value(),this.__chain__)},Nn.prototype.concat=Qu,Nn.prototype.plant=function(n){for(var t,r=this;r instanceof Tn;){var e=Mr(r);t?u.__wrapped__=e:t=e;var u=e,r=r.__wrapped__}return u.__wrapped__=n,t},Nn.prototype.reverse=function(){function n(n){return n.reverse()}var t=this.__wrapped__;return t instanceof zn?(this.__actions__.length&&(t=new zn(this)),t=t.reverse(),t.__actions__.push({func:ne,args:[n],thisArg:w}),new Ln(t,this.__chain__)):this.thru(n)},Nn.prototype.toString=function(){return this.value()+""},Nn.prototype.run=Nn.prototype.toJSON=Nn.prototype.valueOf=Nn.prototype.value=function(){return Tt(this.__wrapped__,this.__actions__)},Nn.prototype.collect=Nn.prototype.map,Nn.prototype.head=Nn.prototype.first,Nn.prototype.select=Nn.prototype.filter,Nn.prototype.tail=Nn.prototype.rest,Nn}var w,b="3.10.1",x=1,A=2,j=4,k=8,I=16,R=32,O=64,E=128,C=256,U=30,W="...",$=150,S=16,F=200,N=1,T=2,L="Expected a function",z="__lodash_placeholder__",B="[object Arguments]",D="[object Array]",M="[object Boolean]",q="[object Date]",P="[object Error]",K="[object Function]",V="[object Number]",Z="[object Object]",Y="[object RegExp]",G="[object String]",J="[object ArrayBuffer]",X="[object Float32Array]",H="[object Float64Array]",Q="[object Int8Array]",nn="[object Int16Array]",tn="[object Int32Array]",rn="[object Uint8Array]",en="[object Uint8ClampedArray]",un="[object Uint16Array]",on="[object Uint32Array]",fn=/\b__p\+='';/g,an=/\b(__p\+=)''\+/g,cn=/(__e\(.*?\)|\b__t\))\+'';/g,ln=/&(?:amp|lt|gt|quot|#39|#96);/g,sn=/[&<>"'`]/g,pn=RegExp(ln.source),hn=RegExp(sn.source),_n=/<%-([\s\S]+?)%>/g,vn=/<%([\s\S]+?)%>/g,gn=/<%=([\s\S]+?)%>/g,yn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,dn=/^\w*$/,mn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,wn=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,bn=RegExp(wn.source),xn=/[\u0300-\u036f\ufe20-\ufe23]/g,An=/\\(\\)?/g,jn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,kn=/\w*$/,In=/^0[xX]/,Rn=/^\[object .+?Constructor\]$/,On=/^\d+$/,En=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Cn=/($^)/,Un=/['\n\r\u2028\u2029\\]/g,Wn=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),$n="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout isFinite parseFloat parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap".split(" "),Sn={};Sn[X]=Sn[H]=Sn[Q]=Sn[nn]=Sn[tn]=Sn[rn]=Sn[en]=Sn[un]=Sn[on]=true,Sn[B]=Sn[D]=Sn[J]=Sn[M]=Sn[q]=Sn[P]=Sn[K]=Sn["[object Map]"]=Sn[V]=Sn[Z]=Sn[Y]=Sn["[object Set]"]=Sn[G]=Sn["[object WeakMap]"]=false;var Fn={};Fn[B]=Fn[D]=Fn[J]=Fn[M]=Fn[q]=Fn[X]=Fn[H]=Fn[Q]=Fn[nn]=Fn[tn]=Fn[V]=Fn[Z]=Fn[Y]=Fn[G]=Fn[rn]=Fn[en]=Fn[un]=Fn[on]=true,Fn[P]=Fn[K]=Fn["[object Map]"]=Fn["[object Set]"]=Fn["[object WeakMap]"]=false;var Nn={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Tn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ln={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},zn={"function":true,object:true},Bn={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Dn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mn=zn[typeof exports]&&exports&&!exports.nodeType&&exports,qn=zn[typeof module]&&module&&!module.nodeType&&module,Pn=zn[typeof self]&&self&&self.Object&&self,Kn=zn[typeof window]&&window&&window.Object&&window,Vn=qn&&qn.exports===Mn&&Mn,Zn=Mn&&qn&&typeof global=="object"&&global&&global.Object&&global||Kn!==(this&&this.window)&&Kn||Pn||this,Yn=m();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Zn._=Yn,define(function(){return Yn})):Mn&&qn?Vn?(qn.exports=Yn)._=Yn:Mn._=Yn:Zn._=Yn}).call(this);!function(a,b,c){"use strict";function d(a){return D(a)?a:Object.keys(a).map(function(b){return a[b]})}function e(a){return null===a}function f(a,b){var d=Object.keys(a);return d.map(function(d){return b[d]!==c&&b[d]==a[d]}).indexOf(!1)==-1}function g(a,b){function c(a,b,c){for(var d=0;b+d<=a.length;){if(a.charAt(b+d)==c)return d;d++}return-1}for(var d=0,e=0;e<=b.length;e++){var f=c(a,d,b.charAt(e));if(f==-1)return!1;d+=f+1}return!0}function h(a,b,c){var d=0;return a.filter(function(a){var e=x(c)?d<b&&c(a):d<b;return d=e?d+1:d,e})}function i(a,b,c){return c.round(a*c.pow(10,b))/c.pow(10,b)}function j(a,b,c){b=b||[];var d=Object.keys(a);return d.forEach(function(d){if(C(a[d])&&!D(a[d])){var e=c?c+"."+d:c;j(a[d],b,e||d)}else{var f=c?c+"."+d:d;b.push(f)}}),b}function k(a){return a&&a.$evalAsync&&a.$watch}function l(){return function(a,b){return a>b}}function m(){return function(a,b){return a>=b}}function n(){return function(a,b){return a<b}}function o(){return function(a,b){return a<=b}}function p(){return function(a,b){return a==b}}function q(){return function(a,b){return a!=b}}function r(){return function(a,b){return a===b}}function s(){return function(a,b){return a!==b}}function t(a){return function(b,c){return b=C(b)?d(b):b,!(!D(b)||y(c))&&b.some(function(b){return A(c)&&C(b)||z(c)?a(c)(b):b===c})}}function u(a,b){return b=b||0,b>=a.length?a:D(a[b])?u(a.slice(0,b).concat(a[b],a.slice(b+1)),b):u(a,b+1)}function v(a){return function(b,c){function e(a,b){return!y(b)&&a.some(function(a){return H(a,b)})}if(b=C(b)?d(b):b,!D(b))return b;var f=[],g=a(c);return y(c)?b.filter(function(a,b,c){return c.indexOf(a)===b}):b.filter(function(a){var b=g(a);return!e(f,b)&&(f.push(b),!0)})}}function w(a,b,c){return b?a+c+w(a,--b,c):a}var x=b.isDefined,y=b.isUndefined,z=b.isFunction,A=b.isString,B=b.isNumber,C=b.isObject,D=b.isArray,E=b.forEach,F=b.extend,G=b.copy,H=b.equals;String.prototype.contains||(String.prototype.contains=function(){return String.prototype.indexOf.apply(this,arguments)!==-1}),b.module("a8m.angular",[]).filter("isUndefined",function(){return function(a){return b.isUndefined(a)}}).filter("isDefined",function(){return function(a){return b.isDefined(a)}}).filter("isFunction",function(){return function(a){return b.isFunction(a)}}).filter("isString",function(){return function(a){return b.isString(a)}}).filter("isNumber",function(){return function(a){return b.isNumber(a)}}).filter("isArray",function(){return function(a){return b.isArray(a)}}).filter("isObject",function(){return function(a){return b.isObject(a)}}).filter("isEqual",function(){return function(a,c){return b.equals(a,c)}}),b.module("a8m.conditions",[]).filter({isGreaterThan:l,">":l,isGreaterThanOrEqualTo:m,">=":m,isLessThan:n,"<":n,isLessThanOrEqualTo:o,"<=":o,isEqualTo:p,"==":p,isNotEqualTo:q,"!=":q,isIdenticalTo:r,"===":r,isNotIdenticalTo:s,"!==":s}),b.module("a8m.is-null",[]).filter("isNull",function(){return function(a){return e(a)}}),b.module("a8m.after-where",[]).filter("afterWhere",function(){return function(a,b){if(a=C(a)?d(a):a,!D(a)||y(b))return a;var c=a.map(function(a){return f(b,a)}).indexOf(!0);return a.slice(c===-1?0:c)}}),b.module("a8m.after",[]).filter("after",function(){return function(a,b){return a=C(a)?d(a):a,D(a)?a.slice(b):a}}),b.module("a8m.before-where",[]).filter("beforeWhere",function(){return function(a,b){if(a=C(a)?d(a):a,!D(a)||y(b))return a;var c=a.map(function(a){return f(b,a)}).indexOf(!0);return a.slice(0,c===-1?a.length:++c)}}),b.module("a8m.before",[]).filter("before",function(){return function(a,b){return a=C(a)?d(a):a,D(a)?a.slice(0,b?--b:b):a}}),b.module("a8m.chunk-by",["a8m.filter-watcher"]).filter("chunkBy",["filterWatcher",function(a){return function(b,c,d){function e(a,b){for(var c=[];a--;)c[a]=b;return c}function f(a,b,c){return D(a)?a.map(function(a,d,f){return d*=b,a=f.slice(d,d+b),!y(c)&&a.length<b?a.concat(e(b-a.length,c)):a}).slice(0,Math.ceil(a.length/b)):a}return a.isMemoized("chunkBy",arguments)||a.memoize("chunkBy",arguments,this,f(b,c,d))}}]),b.module("a8m.concat",[]).filter("concat",[function(){return function(a,b){if(y(b))return a;if(D(a))return C(b)?a.concat(d(b)):a.concat(b);if(C(a)){var c=d(a);return C(b)?c.concat(d(b)):c.concat(b)}return a}}]),b.module("a8m.contains",[]).filter({contains:["$parse",t],some:["$parse",t]}),b.module("a8m.count-by",[]).filter("countBy",["$parse",function(a){return function(b,c){var e,f={},g=a(c);return b=C(b)?d(b):b,!D(b)||y(c)?b:(b.forEach(function(a){e=g(a),f[e]||(f[e]=0),f[e]++}),f)}}]),b.module("a8m.defaults",[]).filter("defaults",["$parse",function(a){return function(b,c){if(b=C(b)?d(b):b,!D(b)||!C(c))return b;var e=j(c);return b.forEach(function(b){e.forEach(function(d){var e=a(d),f=e.assign;y(e(b))&&f(b,e(c))})}),b}}]),b.module("a8m.every",[]).filter("every",["$parse",function(a){return function(b,c){return b=C(b)?d(b):b,!(D(b)&&!y(c))||b.every(function(b){return C(b)||z(c)?a(c)(b):b===c})}}]),b.module("a8m.filter-by",[]).filter("filterBy",["$parse",function(a){return function(b,e,f,g){var h;return f=A(f)||B(f)?String(f).toLowerCase():c,b=C(b)?d(b):b,!D(b)||y(f)?b:b.filter(function(b){return e.some(function(c){if(~c.indexOf("+")){var d=c.replace(/\s+/g,"").split("+");h=d.map(function(c){return a(c)(b)}).join(" ")}else h=a(c)(b);return!(!A(h)&&!B(h))&&(h=String(h).toLowerCase(),g?h===f:h.contains(f))})})}}]),b.module("a8m.first",[]).filter("first",["$parse",function(a){return function(b){var e,f,g;return b=C(b)?d(b):b,D(b)?(g=Array.prototype.slice.call(arguments,1),e=B(g[0])?g[0]:1,f=B(g[0])?B(g[1])?c:g[1]:g[0],g.length?h(b,e,f?a(f):f):b[0]):b}}]),b.module("a8m.flatten",[]).filter("flatten",function(){return function(a,b){return b=b||!1,a=C(a)?d(a):a,D(a)?b?[].concat.apply([],a):u(a,0):a}}),b.module("a8m.fuzzy-by",[]).filter("fuzzyBy",["$parse",function(a){return function(b,c,e,f){var h,i,j=f||!1;return b=C(b)?d(b):b,!D(b)||y(c)||y(e)?b:(i=a(c),b.filter(function(a){return h=i(a),!!A(h)&&(h=j?h:h.toLowerCase(),e=j?e:e.toLowerCase(),g(h,e)!==!1)}))}}]),b.module("a8m.fuzzy",[]).filter("fuzzy",function(){return function(a,b,c){function e(a,b){var c,d,e=Object.keys(a);return 0<e.filter(function(e){return c=a[e],!!d||!!A(c)&&(c=f?c:c.toLowerCase(),d=g(c,b)!==!1)}).length}var f=c||!1;return a=C(a)?d(a):a,!D(a)||y(b)?a:(b=f?b:b.toLowerCase(),a.filter(function(a){return A(a)?(a=f?a:a.toLowerCase(),g(a,b)!==!1):!!C(a)&&e(a,b)}))}}),b.module("a8m.group-by",["a8m.filter-watcher"]).filter("groupBy",["$parse","filterWatcher",function(a,b){return function(c,d){function e(a,b){var c,d={};return E(a,function(a){c=b(a),d[c]||(d[c]=[]),d[c].push(a)}),d}return!C(c)||y(d)?c:b.isMemoized("groupBy",arguments)||b.memoize("groupBy",arguments,this,e(c,a(d)))}}]),b.module("a8m.is-empty",[]).filter("isEmpty",function(){return function(a){return C(a)?!d(a).length:!a.length}}),b.module("a8m.join",[]).filter("join",function(){return function(a,b){return y(a)||!D(a)?a:(y(b)&&(b=" "),a.join(b))}}),b.module("a8m.last",[]).filter("last",["$parse",function(a){return function(b){var e,f,g,i=G(b);return i=C(i)?d(i):i,D(i)?(g=Array.prototype.slice.call(arguments,1),e=B(g[0])?g[0]:1,f=B(g[0])?B(g[1])?c:g[1]:g[0],g.length?h(i.reverse(),e,f?a(f):f).reverse():i[i.length-1]):i}}]),b.module("a8m.map",[]).filter("map",["$parse",function(a){return function(b,c){return b=C(b)?d(b):b,!D(b)||y(c)?b:b.map(function(b){return a(c)(b)})}}]),b.module("a8m.omit",[]).filter("omit",["$parse",function(a){return function(b,c){return b=C(b)?d(b):b,!D(b)||y(c)?b:b.filter(function(b){return!a(c)(b)})}}]),b.module("a8m.pick",[]).filter("pick",["$parse",function(a){return function(b,c){return b=C(b)?d(b):b,!D(b)||y(c)?b:b.filter(function(b){return a(c)(b)})}}]),b.module("a8m.range",[]).filter("range",function(){return function(a,b,c,d,e){c=c||0,d=d||1;for(var f=0;f<parseInt(b);f++){var g=c+f*d;a.push(z(e)?e(g):g)}return a}}),b.module("a8m.remove-with",[]).filter("removeWith",function(){return function(a,b){return y(b)?a:(a=C(a)?d(a):a,a.filter(function(a){return!f(b,a)}))}}),b.module("a8m.remove",[]).filter("remove",function(){return function(a){a=C(a)?d(a):a;var b=Array.prototype.slice.call(arguments,1);return D(a)?a.filter(function(a){return!b.some(function(b){return H(b,a)})}):a}}),b.module("a8m.reverse",[]).filter("reverse",[function(){return function(a){return a=C(a)?d(a):a,A(a)?a.split("").reverse().join(""):D(a)?a.slice().reverse():a}}]),b.module("a8m.search-field",[]).filter("searchField",["$parse",function(a){return function(b){var c,e;b=C(b)?d(b):b;var f=Array.prototype.slice.call(arguments,1);return D(b)&&f.length?b.map(function(b){return e=f.map(function(d){return(c=a(d))(b)}).join(" "),F(b,{searchField:e})}):b}}]),b.module("a8m.to-array",[]).filter("toArray",function(){return function(a,b){return C(a)?b?Object.keys(a).map(function(b){return F(a[b],{$key:b})}):d(a):a}}),b.module("a8m.unique",[]).filter({unique:["$parse",v],uniq:["$parse",v]}),b.module("a8m.where",[]).filter("where",function(){return function(a,b){return y(b)?a:(a=C(a)?d(a):a,a.filter(function(a){return f(b,a)}))}}),b.module("a8m.xor",[]).filter("xor",["$parse",function(a){return function(b,c,e){function f(b,c){var d=a(e);return c.some(function(a){return e?H(d(a),d(b)):H(a,b)})}return e=e||!1,b=C(b)?d(b):b,c=C(c)?d(c):c,D(b)&&D(c)?b.concat(c).filter(function(a){return!(f(a,b)&&f(a,c))}):b}}]),b.module("a8m.math.byteFmt",["a8m.math"]).filter("byteFmt",["$math",function(a){return function(b,c){return B(c)&&isFinite(c)&&c%1===0&&c>=0&&B(b)&&isFinite(b)?b<1024?i(b,c,a)+" B":b<1048576?i(b/1024,c,a)+" KB":b<1073741824?i(b/1048576,c,a)+" MB":i(b/1073741824,c,a)+" GB":"NaN"}}]),b.module("a8m.math.degrees",["a8m.math"]).filter("degrees",["$math",function(a){return function(b,c){if(B(c)&&isFinite(c)&&c%1===0&&c>=0&&B(b)&&isFinite(b)){var d=180*b/a.PI;return a.round(d*a.pow(10,c))/a.pow(10,c)}return"NaN"}}]),b.module("a8m.math.kbFmt",["a8m.math"]).filter("kbFmt",["$math",function(a){return function(b,c){return B(c)&&isFinite(c)&&c%1===0&&c>=0&&B(b)&&isFinite(b)?b<1024?i(b,c,a)+" KB":b<1048576?i(b/1024,c,a)+" MB":i(b/1048576,c,a)+" GB":"NaN"}}]),b.module("a8m.math",[]).factory("$math",["$window",function(a){return a.Math}]),b.module("a8m.math.max",["a8m.math"]).filter("max",["$math","$parse",function(a,b){function c(c,d){var e=c.map(function(a){return b(d)(a)});return e.indexOf(a.max.apply(a,e))}return function(b,d){return D(b)?y(d)?a.max.apply(a,b):b[c(b,d)]:b}}]),b.module("a8m.math.min",["a8m.math"]).filter("min",["$math","$parse",function(a,b){function c(c,d){var e=c.map(function(a){return b(d)(a)});return e.indexOf(a.min.apply(a,e))}return function(b,d){return D(b)?y(d)?a.min.apply(a,b):b[c(b,d)]:b}}]),b.module("a8m.math.percent",["a8m.math"]).filter("percent",["$math","$window",function(a,b){return function(c,d,e){var f=A(c)?b.Number(c):c;return d=d||100,e=e||!1,!B(f)||b.isNaN(f)?c:e?a.round(f/d*100):f/d*100}}]),b.module("a8m.math.radians",["a8m.math"]).filter("radians",["$math",function(a){return function(b,c){if(B(c)&&isFinite(c)&&c%1===0&&c>=0&&B(b)&&isFinite(b)){var d=3.14159265359*b/180;return a.round(d*a.pow(10,c))/a.pow(10,c)}return"NaN"}}]),b.module("a8m.math.radix",[]).filter("radix",function(){return function(a,b){var c=/^[2-9]$|^[1-2]\d$|^3[0-6]$/;return B(a)&&c.test(b)?a.toString(b).toUpperCase():a}}),b.module("a8m.math.shortFmt",["a8m.math"]).filter("shortFmt",["$math",function(a){return function(b,c){return B(c)&&isFinite(c)&&c%1===0&&c>=0&&B(b)&&isFinite(b)?b<1e3?b:b<1e6?i(b/1e3,c,a)+" K":b<1e9?i(b/1e6,c,a)+" M":i(b/1e9,c,a)+" B":"NaN"}}]),b.module("a8m.math.sum",[]).filter("sum",function(){return function(a,b){return D(a)?a.reduce(function(a,b){return a+b},b||0):a}}),b.module("a8m.ends-with",[]).filter("endsWith",function(){return function(a,b,c){var d,e=c||!1;return!A(a)||y(b)?a:(a=e?a:a.toLowerCase(),d=a.length-b.length,a.indexOf(e?b:b.toLowerCase(),d)!==-1)}}),b.module("a8m.latinize",[]).filter("latinize",[function(){function a(a){return a.replace(/[^\u0000-\u007E]/g,function(a){return c[a]||a})}for(var b=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],c={},d=0;d<b.length;d++)for(var e=b[d].letters.split(""),f=0;f<e.length;f++)c[e[f]]=b[d].base;return function(b){return A(b)?a(b):b}}]),b.module("a8m.ltrim",[]).filter("ltrim",function(){return function(a,b){var c=b||"\\s";return A(a)?a.replace(new RegExp("^"+c+"+"),""):a}}),b.module("a8m.match",[]).filter("match",function(){return function(a,b,c){var d=new RegExp(b,c);return A(a)?a.match(d):null}}),b.module("a8m.repeat",[]).filter("repeat",[function(){return function(a,b,c){var d=~~b;return A(a)&&d?w(a,--b,c||""):a}}]),b.module("a8m.rtrim",[]).filter("rtrim",function(){return function(a,b){var c=b||"\\s";return A(a)?a.replace(new RegExp(c+"+$"),""):a}}),b.module("a8m.slugify",[]).filter("slugify",[function(){return function(a,b){var c=y(b)?"-":b;return A(a)?a.toLowerCase().replace(/\s+/g,c):a}}]),b.module("a8m.starts-with",[]).filter("startsWith",function(){return function(a,b,c){var d=c||!1;return!A(a)||y(b)?a:(a=d?a:a.toLowerCase(),!a.indexOf(d?b:b.toLowerCase()))}}),b.module("a8m.stringular",[]).filter("stringular",function(){return function(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return y(b[c])?a:b[c]})}}),b.module("a8m.strip-tags",[]).filter("stripTags",function(){return function(a){return A(a)?a.replace(/<\S[^><]*>/g,""):a}}),b.module("a8m.test",[]).filter("test",function(){return function(a,b,c){var d=new RegExp(b,c);return A(a)?d.test(a):a}}),b.module("a8m.trim",[]).filter("trim",function(){return function(a,b){var c=b||"\\s";return A(a)?a.replace(new RegExp("^"+c+"+|"+c+"+$","g"),""):a}}),b.module("a8m.truncate",[]).filter("truncate",function(){return function(a,b,c,d){return b=y(b)?a.length:b,d=d||!1,c=c||"",!A(a)||a.length<=b?a:a.substring(0,d?a.indexOf(" ",b)===-1?a.length:a.indexOf(" ",b):b)+c}}),b.module("a8m.ucfirst",[]).filter("ucfirst",[function(){return function(a){return A(a)?a.split(" ").map(function(a){return a.charAt(0).toUpperCase()+a.substring(1)}).join(" "):a}}]),b.module("a8m.uri-component-encode",[]).filter("uriComponentEncode",["$window",function(a){return function(b){return A(b)?a.encodeURIComponent(b):b}}]),b.module("a8m.uri-encode",[]).filter("uriEncode",["$window",function(a){return function(b){return A(b)?a.encodeURI(b):b}}]),b.module("a8m.wrap",[]).filter("wrap",function(){return function(a,b,c){return A(a)&&x(b)?[b,a,c||b].join(""):a}}),b.module("a8m.filter-watcher",[]).provider("filterWatcher",function(){this.$get=["$window","$rootScope",function(a,b){
function c(b,c){function d(){var b=[];return function(c,d){if(C(d)&&!e(d)){if(~b.indexOf(d))return"[Circular]";b.push(d)}return a==d?"$WINDOW":a.document==d?"$DOCUMENT":k(d)?"$SCOPE":d}}return[b,JSON.stringify(c,d())].join("#").replace(/"/g,"")}function d(a){var b=a.targetScope.$id;E(l[b],function(a){delete j[a]}),delete l[b]}function f(){m(function(){b.$$phase||(j={})},2e3)}function g(a,b){var c=a.$id;return y(l[c])&&(a.$on("$destroy",d),l[c]=[]),l[c].push(b)}function h(a,b){var d=c(a,b);return j[d]}function i(a,b,d,e){var h=c(a,b);return j[h]=e,k(d)?g(d,h):f(),e}var j={},l={},m=a.setTimeout;return{isMemoized:h,memoize:i}}]}),b.module("angular.filter",["a8m.ucfirst","a8m.uri-encode","a8m.uri-component-encode","a8m.slugify","a8m.latinize","a8m.strip-tags","a8m.stringular","a8m.truncate","a8m.starts-with","a8m.ends-with","a8m.wrap","a8m.trim","a8m.ltrim","a8m.rtrim","a8m.repeat","a8m.test","a8m.match","a8m.to-array","a8m.concat","a8m.contains","a8m.unique","a8m.is-empty","a8m.after","a8m.after-where","a8m.before","a8m.before-where","a8m.defaults","a8m.where","a8m.reverse","a8m.remove","a8m.remove-with","a8m.group-by","a8m.count-by","a8m.chunk-by","a8m.search-field","a8m.fuzzy-by","a8m.fuzzy","a8m.omit","a8m.pick","a8m.every","a8m.filter-by","a8m.xor","a8m.map","a8m.first","a8m.last","a8m.flatten","a8m.join","a8m.range","a8m.math","a8m.math.max","a8m.math.min","a8m.math.percent","a8m.math.radix","a8m.math.sum","a8m.math.degrees","a8m.math.radians","a8m.math.byteFmt","a8m.math.kbFmt","a8m.math.shortFmt","a8m.angular","a8m.conditions","a8m.is-null","a8m.filter-watcher"])}(window,window.angular);!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(a){return function(b,c){if("__setXHR_"===b){var d=c(this);d instanceof Function&&d(this)}else a.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader));var ngFileUpload=angular.module("ngFileUpload",[]);ngFileUpload.version="5.0.9",ngFileUpload.service("Upload",["$http","$q","$timeout",function(a,b,c){function d(d){d.method=d.method||"POST",d.headers=d.headers||{};var e=b.defer(),f=e.promise;return d.headers.__setXHR_=function(){return function(a){a&&(d.__XHR=a,d.xhrFn&&d.xhrFn(a),a.upload.addEventListener("progress",function(a){a.config=d,e.notify?e.notify(a):f.progressFunc&&c(function(){f.progressFunc(a)})},!1),a.upload.addEventListener("load",function(a){a.lengthComputable&&(a.config=d,e.notify?e.notify(a):f.progressFunc&&c(function(){f.progressFunc(a)}))},!1))}},a(d).then(function(a){e.resolve(a)},function(a){e.reject(a)},function(a){e.notify(a)}),f.success=function(a){return f.then(function(b){a(b.data,b.status,b.headers,d)}),f},f.error=function(a){return f.then(null,function(b){a(b.data,b.status,b.headers,d)}),f},f.progress=function(a){return f.progressFunc=a,f.then(null,null,function(b){a(b)}),f},f.abort=function(){return d.__XHR&&c(function(){d.__XHR.abort()}),f},f.xhr=function(a){return d.xhrFn=function(b){return function(){b&&b.apply(f,arguments),a.apply(f,arguments)}}(d.xhrFn),f},f}this.upload=function(a){function b(c,d,e){if(void 0!==d)if(angular.isDate(d)&&(d=d.toISOString()),angular.isString(d))c.append(e,d);else if("form"===a.sendFieldsAs)if(angular.isObject(d))for(var f in d)d.hasOwnProperty(f)&&b(c,d[f],e+"["+f+"]");else c.append(e,d);else d=angular.isString(d)?d:JSON.stringify(d),"json-blob"===a.sendFieldsAs?c.append(e,new Blob([d],{type:"application/json"})):c.append(e,d)}return a.headers=a.headers||{},a.headers["Content-Type"]=void 0,a.transformRequest=a.transformRequest?angular.isArray(a.transformRequest)?a.transformRequest:[a.transformRequest]:[],a.transformRequest.push(function(c){var d,e=new FormData,f={};for(d in a.fields)a.fields.hasOwnProperty(d)&&(f[d]=a.fields[d]);c&&(f.data=c);for(d in f)if(f.hasOwnProperty(d)){var g=f[d];a.formDataAppender?a.formDataAppender(e,d,g):b(e,g,d)}if(null!=a.file){var h=a.fileFormDataName||"file";if(angular.isArray(a.file))for(var i=angular.isString(h),j=0;j<a.file.length;j++)e.append(i?h:h[j],a.file[j],a.fileName&&a.fileName[j]||a.file[j].name);else e.append(h,a.file,a.fileName||a.file.name)}return e}),d(a)},this.http=function(b){return b.transformRequest=b.transformRequest||function(b){return window.ArrayBuffer&&b instanceof window.ArrayBuffer||b instanceof Blob?b:a.defaults.transformRequest[0](arguments)},d(b)}}]),function(){function a(a,e,f,g,h,i,j){function k(){return"input"===e[0].tagName.toLowerCase()&&f.type&&"file"===f.type.toLowerCase()}function l(b){if(!r){r=!0;try{for(var e=b.__files_||b.target&&b.target.files,j=[],k=[],l=0;l<e.length;l++){var m=e.item(l);c(a,h,f,m,b)?j.push(m):k.push(m)}d(h,i,a,g,f,f.ngfChange||f.ngfSelect,j,k,b),0===j.length&&(b.target.value=j)}finally{r=!1}}}function m(b){f.ngfMultiple&&b.attr("multiple",h(f.ngfMultiple)(a)),f.ngfCapture&&b.attr("capture",h(f.ngfCapture)(a)),f.accept&&b.attr("accept",f.accept);for(var c=0;c<e[0].attributes.length;c++){var d=e[0].attributes[c];(k()&&"type"!==d.name||"type"!==d.name&&"class"!==d.name&&"id"!==d.name&&"style"!==d.name)&&b.attr(d.name,d.value)}}function n(b,c){if(!c&&(b||k()))return e.$$ngfRefElem||e;var d=angular.element('<input type="file">');return m(d),k()?(e.replaceWith(d),e=d,d.attr("__ngf_gen__",!0),j(e)(a)):(d.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("z-index","-100000").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),e.$$ngfRefElem&&e.$$ngfRefElem.remove(),e.$$ngfRefElem=d,document.body.appendChild(d[0])),d}function o(b){d(h,i,a,g,f,f.ngfChange||f.ngfSelect,[],[],b,!0)}function p(c){function d(a){a&&i[0].click(),(k()||!a)&&e.bind("click touchend",p)}if(e.attr("disabled")||q)return!1;null!=c&&(c.preventDefault(),c.stopPropagation());var g=h(f.ngfResetOnClick)(a)!==!1,i=n(c,g);return i&&((!c||g)&&i.bind("change",l),c&&g&&h(f.ngfResetModelOnClick)(a)!==!1&&o(c),b(navigator.userAgent)?setTimeout(function(){d(c)},0):d(c)),!1}if(!e.attr("__ngf_gen__")){a.$on("$destroy",function(){e.$$ngfRefElem&&e.$$ngfRefElem.remove()});var q=!1;-1===f.ngfSelect.search(/\W+$files\W+/)&&a.$watch(f.ngfSelect,function(a){q=a===!1});var r=!1;window.FileAPI&&window.FileAPI.ngfFixIE?window.FileAPI.ngfFixIE(e,n,m,l):p()}}function b(a){var b=a.match(/Android[^\d]*(\d+)\.(\d+)/);return b&&b.length>2?parseInt(b[1])<4||4===parseInt(b[1])&&parseInt(b[2])<4:/.*Windows.*Safari.*/.test(a)}ngFileUpload.directive("ngfSelect",["$parse","$timeout","$compile",function(b,c,d){return{restrict:"AEC",require:"?ngModel",link:function(e,f,g,h){a(e,f,g,h,b,c,d)}}}]),ngFileUpload.validate=function(a,b,c,d,e){function f(a){if(a.length>2&&"/"===a[0]&&"/"===a[a.length-1])return a.substring(1,a.length-1);var b=a.split(","),c="";if(b.length>1)for(var d=0;d<b.length;d++)c+="("+f(b[d])+")",d<b.length-1&&(c+="|");else 0===a.indexOf(".")&&(a="*"+a),c="^"+a.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$",c=c.replace(/\\\*/g,".*").replace(/\\\?/g,".");return c}var g=b(c.ngfAccept)(a,{$file:d,$event:e}),h=b(c.ngfMaxSize)(a,{$file:d,$event:e})||9007199254740991,i=b(c.ngfMinSize)(a,{$file:d,$event:e})||-1;if(null!=g&&angular.isString(g)){var j=new RegExp(f(g),"gi");g=null!=d.type&&j.test(d.type.toLowerCase())||null!=d.name&&j.test(d.name.toLowerCase())}return(null==g||g)&&(null==d.size||d.size<h&&d.size>i)},ngFileUpload.updateModel=function(a,b,c,d,e,f,g,h,i,j){function k(){if(a(e.ngfKeep)(c)===!0){var j=(d.$modelValue||[]).slice(0);if(g&&g.length)if(a(e.ngfKeepDistinct)(c)===!0){for(var k=j.length,l=0;l<g.length;l++){for(var m=0;k>m&&g[l].name!==j[m].name;m++);m===k&&j.push(g[l])}g=j}else g=j.concat(g);else g=j}d&&(a(e.ngModel).assign(c,g),b(function(){d&&d.$setViewValue(null!=g&&0===g.length?null:g)})),e.ngModelRejected&&a(e.ngModelRejected).assign(c,h),f&&a(f)(c,{$files:g,$rejectedFiles:h,$event:i})}j?k():b(function(){k()})};var c=ngFileUpload.validate,d=ngFileUpload.updateModel}(),function(){function a(a,e,f,g,h,i,j){function k(a,b,d){var e=!0,f=d.dataTransfer.items;if(null!=f)for(var g=0;g<f.length&&e;g++)e=e&&("file"===f[g].kind||""===f[g].kind)&&c(a,h,b,f[g],d);var i=h(b.ngfDragOverClass)(a,{$event:d});return i&&(i.delay&&(r=i.delay),i.accept&&(i=e?i.accept:i.reject)),i||b.ngfDragOverClass||"dragover"}function l(b,d,e,g){function k(d){c(a,h,f,d,b)?m.push(d):n.push(d)}function l(a,b,c){if(null!=b)if(b.isDirectory){var d=(c||"")+b.name;k({name:b.name,type:"directory",path:d});var e=b.createReader(),f=[];p++;var g=function(){e.readEntries(function(d){try{if(d.length)f=f.concat(Array.prototype.slice.call(d||[],0)),g();else{for(var e=0;e<f.length;e++)l(a,f[e],(c?c:"")+b.name+"/");p--}}catch(h){p--,console.error(h)}},function(){p--})};g()}else p++,b.file(function(a){try{p--,a.path=(c?c:"")+a.name,k(a)}catch(b){p--,console.error(b)}},function(){p--})}var m=[],n=[],o=b.dataTransfer.items,p=0;if(o&&o.length>0&&"file"!==j.protocol())for(var q=0;q<o.length;q++){if(o[q].webkitGetAsEntry&&o[q].webkitGetAsEntry()&&o[q].webkitGetAsEntry().isDirectory){var r=o[q].webkitGetAsEntry();if(r.isDirectory&&!e)continue;null!=r&&l(m,r)}else{var s=o[q].getAsFile();null!=s&&k(s)}if(!g&&m.length>0)break}else{var t=b.dataTransfer.files;if(null!=t)for(var u=0;u<t.length&&(k(t.item(u)),g||!(m.length>0));u++);}var v=0;!function w(a){i(function(){if(p)10*v++<2e4&&w(10);else{if(!g&&m.length>1){for(q=0;"directory"===m[q].type;)q++;m=[m[q]]}d(m,n)}},a||0)}()}var m=b();if(f.dropAvailable&&i(function(){a[f.dropAvailable]?a[f.dropAvailable].value=m:a[f.dropAvailable]=m}),!m)return void(h(f.ngfHideOnDropNotAvailable)(a)===!0&&e.css("display","none"));var n=!1;-1===f.ngfDrop.search(/\W+$files\W+/)&&a.$watch(f.ngfDrop,function(a){n=a===!1});var o,p=null,q=h(f.ngfStopPropagation),r=1;e[0].addEventListener("dragover",function(b){if(!e.attr("disabled")&&!n){if(b.preventDefault(),q(a)&&b.stopPropagation(),navigator.userAgent.indexOf("Chrome")>-1){var c=b.dataTransfer.effectAllowed;b.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy"}i.cancel(p),a.actualDragOverClass||(o=k(a,f,b)),e.addClass(o)}},!1),e[0].addEventListener("dragenter",function(b){e.attr("disabled")||n||(b.preventDefault(),q(a)&&b.stopPropagation())},!1),e[0].addEventListener("dragleave",function(){e.attr("disabled")||n||(p=i(function(){e.removeClass(o),o=null},r||1))},!1),e[0].addEventListener("drop",function(b){e.attr("disabled")||n||(b.preventDefault(),q(a)&&b.stopPropagation(),e.removeClass(o),o=null,l(b,function(c,e){d(h,i,a,g,f,f.ngfChange||f.ngfDrop,c,e,b)},h(f.ngfAllowDir)(a)!==!1,f.multiple||h(f.ngfMultiple)(a)))},!1)}function b(){var a=document.createElement("div");return"draggable"in a&&"ondrop"in a}var c=ngFileUpload.validate,d=ngFileUpload.updateModel;ngFileUpload.directive("ngfDrop",["$parse","$timeout","$location",function(b,c,d){return{restrict:"AEC",require:"?ngModel",link:function(e,f,g,h){a(e,f,g,h,b,c,d)}}}]),ngFileUpload.directive("ngfNoFileDrop",function(){return function(a,c){b()&&c.css("display","none")}}),ngFileUpload.directive("ngfDropAvailable",["$parse","$timeout",function(a,c){return function(d,e,f){if(b()){var g=a(f.ngfDropAvailable);c(function(){g(d),g.assign&&g.assign(d,!0)})}}}]),ngFileUpload.directive("ngfSrc",["$parse","$timeout",function(a,b){return{restrict:"AE",link:function(d,e,f){window.FileReader&&d.$watch(f.ngfSrc,function(g){g&&c(d,a,f,g,null)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 8")||g.size<2e4)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 9")||g.size<4e6)?b(function(){var a=window.URL||window.webkitURL;if(a&&a.createObjectURL)e.attr("src",a.createObjectURL(g));else{var c=new FileReader;c.readAsDataURL(g),c.onload=function(a){b(function(){e.attr("src",a.target.result)})}}}):e.attr("src",f.ngfDefaultSrc||"")})}}}])}();angular.module("btford.socket-io",[]).provider("socketFactory",function(){"use strict";var n="socket:";this.$get=["$rootScope","$timeout",function(t,e){var r=function(n,t){return t?function(){var r=arguments;e(function(){t.apply(n,r)},0)}:angular.noop};return function(e){e=e||{};var o=e.ioSocket||io.connect(),c=void 0===e.prefix?n:e.prefix,u=e.scope||t,i=function(n,t){o.on(n,t.__ng=r(o,t))},a=function(n,t){o.once(n,t.__ng=r(o,t))},s={on:i,addListener:i,once:a,emit:function(n,t,e){var c=arguments.length-1,e=arguments[c];return"function"==typeof e&&(e=r(o,e),arguments[c]=e),o.emit.apply(o,arguments)},removeListener:function(n,t){return t&&t.__ng&&(arguments[1]=t.__ng),o.removeListener.apply(o,arguments)},removeAllListeners:function(){return o.removeAllListeners.apply(o,arguments)},disconnect:function(n){return o.disconnect(n)},connect:function(){return o.connect()},forward:function(n,t){n instanceof Array==!1&&(n=[n]),t||(t=u),n.forEach(function(n){var e=c+n,u=r(o,function(){Array.prototype.unshift.call(arguments,e),t.$broadcast.apply(t,arguments)});t.$on("$destroy",function(){o.removeListener(n,u)}),o.on(n,u)})}};return s}}]});!function(a,b){"undefined"!=typeof module&&module.exports?(b("undefined"==typeof angular?require("angular"):angular),module.exports="ngDialog"):"function"==typeof define&&define.amd?define(["angular"],b):b(a.angular)}(this,function(a){"use strict";var b=a.module("ngDialog",[]),c=a.element,d=a.isDefined,e=(document.body||document.documentElement).style,f=d(e.animation)||d(e.WebkitAnimation)||d(e.MozAnimation)||d(e.MsAnimation)||d(e.OAnimation),g="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",h="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",i="ngdialog-disabled-animation",j={html:!1,body:!1},k={},l=[],m=!1,n=!1;return b.provider("ngDialog",function(){var b=this.defaults={className:"ngdialog-theme-default",appendClassName:"",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null,bodyClassName:"ngdialog-open",width:null,height:null};this.setForceHtmlReload=function(a){j.html=a||!1},this.setForceBodyReload=function(a){j.body=a||!1},this.setDefaults=function(c){a.extend(b,c)},this.setOpenOnePerName=function(a){n=a||!1};var d,e=0,o=0,p={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(q,r,s,t,u,v,w,x,y,z){var A=[],B={onDocumentKeydown:function(a){27===a.keyCode&&C.close("$escape")},activate:function(a){var b=a.data("$ngDialogOptions");b.trapFocus&&(a.on("keydown",B.onTrapFocusKeydown),A.body.on("keydown",B.onTrapFocusKeydown))},deactivate:function(a){a.off("keydown",B.onTrapFocusKeydown),A.body.off("keydown",B.onTrapFocusKeydown)},deactivateAll:function(b){a.forEach(b,function(b){var c=a.element(b);B.deactivate(c)})},setBodyPadding:function(a){var b=parseInt(A.body.css("padding-right")||0,10);A.body.css("padding-right",b+a+"px"),A.body.data("ng-dialog-original-padding",b),v.$broadcast("ngDialog.setPadding",a)},resetBodyPadding:function(){var a=A.body.data("ng-dialog-original-padding");a?A.body.css("padding-right",a+"px"):A.body.css("padding-right",""),v.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(a,b){var c=a.data("$ngDialogOptions"),e=a.attr("id"),h=k[e];if(h){if("undefined"!=typeof x.Hammer){var i=h.hammerTime;i.off("tap",d),i.destroy&&i.destroy(),delete h.hammerTime}else a.unbind("click");1===o&&A.body.unbind("keydown",B.onDocumentKeydown),a.hasClass("ngdialog-closing")||(o-=1);var j=a.data("$ngDialogPreviousFocus");j&&j.focus&&j.focus(),v.$broadcast("ngDialog.closing",a,b),o=o<0?0:o,f&&!c.disableAnimation?(h.$destroy(),a.unbind(g).bind(g,function(){B.closeDialogElement(a,b)}).addClass("ngdialog-closing")):(h.$destroy(),B.closeDialogElement(a,b)),p[e]&&(p[e].resolve({id:e,value:b,$dialog:a,remainingDialogs:o}),delete p[e]),k[e]&&delete k[e],l.splice(l.indexOf(e),1),l.length||(A.body.unbind("keydown",B.onDocumentKeydown),m=!1)}},closeDialogElement:function(a,b){var c=a.data("$ngDialogOptions");a.remove(),0===o&&(A.html.removeClass(c.bodyClassName),A.body.removeClass(c.bodyClassName),B.resetBodyPadding()),v.$broadcast("ngDialog.closed",a,b)},closeDialog:function(b,c){var d=b.data("$ngDialogPreCloseCallback");if(d&&a.isFunction(d)){var e=d.call(b,c);if(a.isObject(e))e.closePromise?e.closePromise.then(function(){B.performCloseDialog(b,c)},function(){return!1}):e.then(function(){B.performCloseDialog(b,c)},function(){return!1});else{if(e===!1)return!1;B.performCloseDialog(b,c)}}else B.performCloseDialog(b,c)},onTrapFocusKeydown:function(b){var c,d=a.element(b.currentTarget);if(d.hasClass("ngdialog"))c=d;else if(c=B.getActiveDialog(),null===c)return;var e=9===b.keyCode,f=b.shiftKey===!0;e&&B.handleTab(c,b,f)},handleTab:function(a,b,c){var d=B.getFocusableElements(a);if(0===d.length)return void(document.activeElement&&document.activeElement.blur&&document.activeElement.blur());var e=document.activeElement,f=Array.prototype.indexOf.call(d,e),g=f===-1,h=0===f,i=f===d.length-1,j=!1;c?(g||h)&&(d[d.length-1].focus(),j=!0):(g||i)&&(d[0].focus(),j=!0),j&&(b.preventDefault(),b.stopPropagation())},autoFocus:function(a){var b=a[0],d=b.querySelector("*[autofocus]");if(null===d||(d.focus(),document.activeElement!==d)){var e=B.getFocusableElements(a);if(e.length>0)return void e[0].focus();var f=B.filterVisibleElements(b.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(f.length>0){var g=f[0];c(g).attr("tabindex","-1").css("outline","0"),g.focus()}}},getFocusableElements:function(a){var b=a[0],c=b.querySelectorAll(h),d=B.filterTabbableElements(c);return B.filterVisibleElements(d)},filterTabbableElements:function(a){for(var b=[],d=0;d<a.length;d++){var e=a[d];"-1"!==c(e).attr("tabindex")&&b.push(e)}return b},filterVisibleElements:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];(d.offsetWidth>0||d.offsetHeight>0)&&b.push(d)}return b},getActiveDialog:function(){var a=document.querySelectorAll(".ngdialog");return 0===a.length?null:c(a[a.length-1])},applyAriaAttributes:function(a,b){if(b.ariaAuto){if(!b.ariaRole){var c=B.getFocusableElements(a).length>0?"dialog":"alertdialog";b.ariaRole=c}b.ariaLabelledBySelector||(b.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),b.ariaDescribedBySelector||(b.ariaDescribedBySelector="article,section,p")}b.ariaRole&&a.attr("role",b.ariaRole),B.applyAriaAttribute(a,"aria-labelledby",b.ariaLabelledById,b.ariaLabelledBySelector),B.applyAriaAttribute(a,"aria-describedby",b.ariaDescribedById,b.ariaDescribedBySelector)},applyAriaAttribute:function(a,b,d,e){if(d&&a.attr(b,d),e){var f=a.attr("id"),g=a[0].querySelector(e);if(!g)return;var h=f+"-"+b;return c(g).attr("id",h),a.attr(b,h),h}},detectUIRouter:function(){try{return a.module("ui.router"),!0}catch(b){return!1}},getRouterLocationEventName:function(){return B.detectUIRouter()?"$stateChangeStart":"$locationChangeStart"}},C={__PRIVATE__:B,open:function(f){function g(a,b){return v.$broadcast("ngDialog.templateLoading",a),u.get(a,b||{}).then(function(b){return v.$broadcast("ngDialog.templateLoaded",a),b.data||""})}function h(b){return b?a.isString(b)&&q.plain?b:"boolean"!=typeof q.cache||q.cache?g(b,{cache:r}):g(b,{cache:!1}):"Empty template"}var j=null;if(f=f||{},!(n&&f.name&&(j=f.name.toLowerCase().replace(/\s/g,"-")+"-dialog",this.isOpen(j)))){var q=a.copy(b),D=++e;j=j||"ngdialog"+D,l.push(j),"undefined"!=typeof q.data&&("undefined"==typeof f.data&&(f.data={}),f.data=a.merge(a.copy(q.data),f.data)),a.extend(q,f);var E;p[j]=E=t.defer();var F;k[j]=F=a.isObject(q.scope)?q.scope.$new():v.$new();var G,H,I,J=a.extend({},q.resolve);return a.forEach(J,function(b,c){J[c]=a.isString(b)?z.get(b):z.invoke(b,null,null,c)}),t.all({template:h(q.template||q.templateUrl),locals:t.all(J)}).then(function(b){var e=b.template,f=b.locals;q.showClose&&(e+='<div class="ngdialog-close"></div>');var g=q.overlay?"":" ngdialog-no-overlay";if(G=c('<div id="'+j+'" class="ngdialog'+g+'"></div>'),G.html(q.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+e+"</div>":'<div class="ngdialog-content" role="document">'+e+"</div>"),G.data("$ngDialogOptions",q),F.ngDialogId=j,q.data&&a.isString(q.data)){var h=q.data.replace(/^\s*/,"")[0];F.ngDialogData="{"===h||"["===h?a.fromJson(q.data):new String(q.data),F.ngDialogData.ngDialogId=j}else q.data&&a.isObject(q.data)&&(F.ngDialogData=q.data,F.ngDialogData.ngDialogId=j);if(q.className&&G.addClass(q.className),q.appendClassName&&G.addClass(q.appendClassName),q.width&&(I=G[0].querySelector(".ngdialog-content"),a.isString(q.width)?I.style.width=q.width:I.style.width=q.width+"px"),q.height&&(I=G[0].querySelector(".ngdialog-content"),a.isString(q.height)?I.style.height=q.height:I.style.height=q.height+"px"),q.disableAnimation&&G.addClass(i),H=q.appendTo&&a.isString(q.appendTo)?a.element(document.querySelector(q.appendTo)):A.body,B.applyAriaAttributes(G,q),q.preCloseCallback){var k;a.isFunction(q.preCloseCallback)?k=q.preCloseCallback:a.isString(q.preCloseCallback)&&F&&(a.isFunction(F[q.preCloseCallback])?k=F[q.preCloseCallback]:F.$parent&&a.isFunction(F.$parent[q.preCloseCallback])?k=F.$parent[q.preCloseCallback]:v&&a.isFunction(v[q.preCloseCallback])&&(k=v[q.preCloseCallback])),k&&G.data("$ngDialogPreCloseCallback",k)}if(F.closeThisDialog=function(a){B.closeDialog(G,a)},q.controller&&(a.isString(q.controller)||a.isArray(q.controller)||a.isFunction(q.controller))){var l;q.controllerAs&&a.isString(q.controllerAs)&&(l=q.controllerAs);var n=y(q.controller,a.extend(f,{$scope:F,$element:G}),!0,l);q.bindToController&&a.extend(n.instance,{ngDialogId:F.ngDialogId,ngDialogData:F.ngDialogData,closeThisDialog:F.closeThisDialog,confirm:F.confirm}),"function"==typeof n?G.data("$ngDialogControllerController",n()):G.data("$ngDialogControllerController",n)}if(w(function(){var a=document.querySelectorAll(".ngdialog");B.deactivateAll(a),s(G)(F);var b=x.innerWidth-A.body.prop("clientWidth");A.html.addClass(q.bodyClassName),A.body.addClass(q.bodyClassName);var c=b-(x.innerWidth-A.body.prop("clientWidth"));c>0&&B.setBodyPadding(c),H.append(G),B.activate(G),q.trapFocus&&B.autoFocus(G),q.name?v.$broadcast("ngDialog.opened",{dialog:G,name:q.name}):v.$broadcast("ngDialog.opened",G)}),m||(A.body.bind("keydown",B.onDocumentKeydown),m=!0),q.closeByNavigation){var p=B.getRouterLocationEventName();v.$on(p,function(a){B.closeDialog(G)===!1&&a.preventDefault()})}if(q.preserveFocus&&G.data("$ngDialogPreviousFocus",document.activeElement),d=function(a){var b=!!q.closeByDocument&&c(a.target).hasClass("ngdialog-overlay"),d=c(a.target).hasClass("ngdialog-close");(b||d)&&C.close(G.attr("id"),d?"$closeButton":"$document")},"undefined"!=typeof x.Hammer){var r=F.hammerTime=x.Hammer(G[0]);r.on("tap",d)}else G.bind("click",d);return o+=1,C}),{id:j,closePromise:E.promise,close:function(a){B.closeDialog(G,a)}}}},openConfirm:function(d){var e=t.defer(),f=a.copy(b);d=d||{},"undefined"!=typeof f.data&&("undefined"==typeof d.data&&(d.data={}),d.data=a.merge(a.copy(f.data),d.data)),a.extend(f,d),f.scope=a.isObject(f.scope)?f.scope.$new():v.$new(),f.scope.confirm=function(a){e.resolve(a);var b=c(document.getElementById(g.id));B.performCloseDialog(b,a)};var g=C.open(f);if(g)return g.closePromise.then(function(a){return a?e.reject(a.value):e.reject()}),e.promise},isOpen:function(a){var b=c(document.getElementById(a));return b.length>0},close:function(a,b){var d=c(document.getElementById(a));if(d.length)B.closeDialog(d,b);else if("$escape"===a){var e=l[l.length-1];d=c(document.getElementById(e)),d.data("$ngDialogOptions").closeByEscape&&B.closeDialog(d,"$escape")}else C.closeAll(b);return C},closeAll:function(a){for(var b=document.querySelectorAll(".ngdialog"),d=b.length-1;d>=0;d--){var e=b[d];B.closeDialog(c(e),a)}},getOpenDialogs:function(){return l},getDefaults:function(){return b}};return a.forEach(["html","body"],function(a){if(A[a]=q.find(a),j[a]){var b=B.getRouterLocationEventName();v.$on(b,function(){A[a]=q.find(a)})}}),C}]}),b.directive("ngDialog",["ngDialog",function(b){return{restrict:"A",scope:{ngDialogScope:"="},link:function(c,d,e){d.on("click",function(d){d.preventDefault();var f=a.isDefined(c.ngDialogScope)?c.ngDialogScope:"noScope";a.isDefined(e.ngDialogClosePrevious)&&b.close(e.ngDialogClosePrevious);var g=b.getDefaults();b.open({template:e.ngDialog,className:e.ngDialogClass||g.className,appendClassName:e.ngDialogAppendClass,controller:e.ngDialogController,controllerAs:e.ngDialogControllerAs,bindToController:e.ngDialogBindToController,scope:f,data:e.ngDialogData,showClose:"false"!==e.ngDialogShowClose&&("true"===e.ngDialogShowClose||g.showClose),closeByDocument:"false"!==e.ngDialogCloseByDocument&&("true"===e.ngDialogCloseByDocument||g.closeByDocument),closeByEscape:"false"!==e.ngDialogCloseByEscape&&("true"===e.ngDialogCloseByEscape||g.closeByEscape),overlay:"false"!==e.ngDialogOverlay&&("true"===e.ngDialogOverlay||g.overlay),preCloseCallback:e.ngDialogPreCloseCallback||g.preCloseCallback,bodyClassName:e.ngDialogBodyClass||g.bodyClassName})})}}}]),b});angular.module("angular-multi-check",[]).directive("multiCheckGroup",function(){return{scope:{},controller:["$scope",function($scope){this.getElements=function(){var dataMultiCheck=Array.prototype.slice.call($scope.element[0].querySelectorAll("[data-multi-check]"),0);var multiCheck=Array.prototype.slice.call($scope.element[0].querySelectorAll("[multi-check]"),0);return multiCheck.concat(dataMultiCheck)};this.lastChecked=null}],link:function(scope,element){scope.element=element}}}).directive("multiCheck",function(){return{require:["^ngModel","^multiCheckGroup"],restrict:"A",link:function(scope,el,attrs,controllers){var groupCtrl=controllers[1];el.bind("click",function(event){var last=groupCtrl.lastChecked;if(last&&event.shiftKey){var chkboxes=groupCtrl.getElements(),start=chkboxes.indexOf(event.target),end=chkboxes.indexOf(last),checked=last.checked;angular.forEach(chkboxes.slice(Math.min(start,end),Math.max(start,end)+1),function(box){var model=angular.element(box).data("$ngModelController");model.$setViewValue(checked);model.$render()})}groupCtrl.lastChecked=event.target})}}});angular.module("angular-carousel",["ngTouch","angular-carousel.shifty"]),angular.module("angular-carousel").directive("rnCarouselAutoSlide",["$interval",function(a){return{restrict:"A",link:function(b,c,d){var e=function(){b.autoSlider&&(a.cancel(b.autoSlider),b.autoSlider=null)},f=function(){b.autoSlide()};b.$watch("carouselIndex",f),d.hasOwnProperty("rnCarouselPauseOnHover")&&"false"!==d.rnCarouselPauseOnHover&&(c.on("mouseenter",e),c.on("mouseleave",f)),b.$on("$destroy",function(){e(),c.off("mouseenter",e),c.off("mouseleave",f)})}}}]),angular.module("angular-carousel").directive("rnCarouselIndicators",["$parse",function(a){return{restrict:"A",scope:{slides:"=",index:"=rnCarouselIndex"},templateUrl:"carousel-indicators.html",link:function(b,c,d){var e=a(d.rnCarouselIndex);b.goToSlide=function(a){e.assign(b.$parent.$parent,a)}}}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div class="rn-carousel-indicator">\n<span ng-repeat="slide in slides" ng-class="{active: $index==index}" ng-click="goToSlide($index)">●</span></div>')}]),function(){"use strict";angular.module("angular-carousel").service("DeviceCapabilities",function(){function a(){var a="transform",b="webkitTransform";return"undefined"!=typeof document.body.style[a]?["webkit","moz","o","ms"].every(function(b){var c="-"+b+"-transform";return"undefined"!=typeof document.body.style[c]?(a=c,!1):!0}):a="undefined"!=typeof document.body.style[b]?"-webkit-transform":void 0,a}function b(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}return{has3d:b(),transformProperty:a()}}).service("computeCarouselSlideStyle",["DeviceCapabilities",function(a){return function(b,c,d){var e,f={display:"inline-block"},g=100*b+c,h=a.has3d?"translate3d("+g+"%, 0, 0)":"translate3d("+g+"%, 0)",i=(100-Math.abs(g))/100;if(a.transformProperty)if("fadeAndSlide"==d)f[a.transformProperty]=h,e=0,Math.abs(g)<100&&(e=.3+.7*i),f.opacity=e;else if("hexagon"==d){var j=100,k=0,l=60*(i-1);j=-100*b>c?100:0,k=-100*b>c?l:-l,f[a.transformProperty]=h+" rotateY("+k+"deg)",f[a.transformProperty+"-origin"]=j+"% 50%"}else if("zoom"==d){f[a.transformProperty]=h;var m=1;Math.abs(g)<100&&(m=1+2*(1-i)),f[a.transformProperty]+=" scale("+m+")",f[a.transformProperty+"-origin"]="50% 50%",e=0,Math.abs(g)<100&&(e=.3+.7*i),f.opacity=e}else f[a.transformProperty]=h;else f["margin-left"]=g+"%";return f}}]).service("createStyleString",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){b.push(c+":"+a)}),b.join(";")}}).directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$timeout","$interval","computeCarouselSlideStyle","createStyleString","Tweenable",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){var d=c;return a.every(function(a,c){return angular.equals(a,b)?(d=c,!1):!0}),d}{var l=0;b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame}return{restrict:"A",scope:!0,compile:function(m,n){var o,p,q=m[0].querySelector("li"),r=q?q.attributes:[],s=!1,t=!1;return["ng-repeat","data-ng-repeat","ng:repeat","x-ng-repeat"].every(function(a){var b=r[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(o=c[1],p=c[2],o)return angular.isDefined(n.rnCarouselBuffered)&&(t=!0,b.value=o+" in "+p+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),s=!0,!1}return!0}),function(m,o,q){function r(){return o[0].querySelectorAll("ul[rn-carousel] > li")}function u(a){N=!0,D({x:a.clientX,y:a.clientY},a)}function v(a){var b=100*m.carouselBufferIndex+a;angular.forEach(r(),function(a,c){a.style.cssText=i(h(c,b,K.transitionType))})}function w(a,b){if(void 0===a&&(a=m.carouselIndex),b=b||{},b.animate===!1||"none"===K.transitionType)return S=!1,M=-100*a,m.carouselIndex=a,E(),void 0;S=!0;var c=new j;c.tween({from:{x:M},to:{x:-100*a},duration:K.transitionDuration,easing:K.transitionEasing,step:function(a){v(a.x)},finish:function(){m.$apply(function(){m.carouselIndex=a,M=-100*a,E(),f(function(){S=!1},0,!1)})}})}function x(){var a=o[0].getBoundingClientRect();return a.width?a.width:a.right-a.left}function y(){P=x()}function z(){R||(R=!0,c.bind("mouseup",u))}function A(){R&&(R=!1,c.unbind("mouseup",u))}function B(a){return S||O.length<=1?void 0:(y(),Q=o[0].querySelector("li").getBoundingClientRect().left,G=!0,H=a.x,!1)}function C(a){var b,c;if(z(),G&&(b=a.x,c=H-b,c>2||-2>c)){N=!0;var d=M+100*-c/P;v(d)}return!1}function D(a,b){if((!b||N)&&(A(),G=!1,N=!1,I=H-a.x,0!==I&&!S))if(M+=100*-I/P,K.isSequential){var c=K.moveTreshold*P,e=-I,f=-Math[e>=0?"ceil":"floor"](e/P),g=Math.abs(e)>c;O&&f+m.carouselIndex>=O.length&&(f=O.length-1-m.carouselIndex),f+m.carouselIndex<0&&(f=-m.carouselIndex);var h=g?f:0;I=m.carouselIndex+h,w(I),void 0!==q.rnCarouselOnInfiniteScrollRight&&0===f&&0!==m.carouselIndex&&(d(q.rnCarouselOnInfiniteScrollRight)(m),w(0)),void 0!==q.rnCarouselOnInfiniteScrollLeft&&0===f&&0===m.carouselIndex&&0===h&&(d(q.rnCarouselOnInfiniteScrollLeft)(m),w(O.length))}else m.$apply(function(){m.carouselIndex=parseInt(-M/100,10),E()})}function E(){var a=0,b=(m.carouselBufferSize-1)/2;t?(a=m.carouselIndex<=b?0:O&&O.length<m.carouselBufferSize?0:O&&m.carouselIndex>O.length-m.carouselBufferSize?O.length-m.carouselBufferSize:m.carouselIndex-b,m.carouselBufferIndex=a,f(function(){v(M)},0,!1)):f(function(){
v(M)},0,!1)}function F(){y(),w()}l++;var G,H,I,J={transitionType:q.rnCarouselTransition||"slide",transitionEasing:q.rnCarouselEasing||"easeTo",transitionDuration:parseInt(q.rnCarouselDuration,10)||300,isSequential:!0,autoSlideDuration:3,bufferSize:5,moveTreshold:.1,defaultIndex:0},K=angular.extend({},J),L=!1,M=0,N=!1,O=[],P=null,Q=null,R=!1,S=!1;"true"!==q.rnSwipeDisabled&&a.bind(o,{start:B,move:C,end:D,cancel:function(a){D({},a)}}),m.nextSlide=function(a){var b=m.carouselIndex+1;b>O.length-1&&(b=0),S||w(b,a)},m.prevSlide=function(a){var b=m.carouselIndex-1;0>b&&(b=O.length-1),w(b,a)};var T=!0;if(m.carouselIndex=0,s||(O=[],angular.forEach(r(),function(a,b){O.push({id:b})})),void 0!==q.rnCarouselControls){var U=(s?m.$eval(p.replace("::","")).length:O.length)>1?angular.isDefined(n.rnCarouselControlsAllowLoop):!1,V=s?"("+p.replace("::","")+").length - 1":O.length-1,W='<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prevSlide()" ng-if="carouselIndex > 0 || '+U+'"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="nextSlide()" ng-if="carouselIndex < '+V+" || "+U+'"></span>\n</div>';o.parent().append(e(angular.element(W))(m))}if(void 0!==q.rnCarouselAutoSlide){var X=parseInt(q.rnCarouselAutoSlide,10)||K.autoSlideDuration;m.autoSlide=function(){m.autoSlider&&(g.cancel(m.autoSlider),m.autoSlider=null),m.autoSlider=g(function(){S||G||m.nextSlide()},1e3*X)}}if(q.rnCarouselDefaultIndex){var Y=d(q.rnCarouselDefaultIndex);K.defaultIndex=Y(m.$parent)||0}if(q.rnCarouselIndex){var Z=function(a){$.assign(m.$parent,a)},$=d(q.rnCarouselIndex);angular.isFunction($.assign)?(m.$watch("carouselIndex",function(a){Z(a)}),m.$parent.$watch($,function(a){void 0!==a&&null!==a&&(O&&O.length>0&&a>=O.length?(a=O.length-1,Z(a)):O&&0>a&&(a=0,Z(a)),S||w(a,{animate:!T}),T=!1)}),L=!0,K.defaultIndex&&w(K.defaultIndex,{animate:!T})):isNaN(q.rnCarouselIndex)||w(parseInt(q.rnCarouselIndex,10),{animate:!1})}else w(K.defaultIndex,{animate:!T}),T=!1;if(q.rnCarouselLocked&&m.$watch(q.rnCarouselLocked,function(a){S=a===!0?!0:!1}),s){var _=void 0!==q.rnCarouselDeepWatch;m[_?"$watch":"$watchCollection"](p,function(a,b){if(O=a,_&&angular.isArray(a)){var c=b[m.carouselIndex],d=k(a,c,m.carouselIndex);w(d,{animate:!1})}else w(m.carouselIndex,{animate:!1})},!0)}m.$on("$destroy",function(){A()}),m.carouselBufferIndex=0,m.carouselBufferSize=K.bufferSize;var ab=angular.element(b);ab.bind("orientationchange",F),ab.bind("resize",F),m.$on("$destroy",function(){A(),ab.unbind("orientationchange",F),ab.unbind("resize",F)})}}}}])}(),angular.module("angular-carousel.shifty",[]).factory("Tweenable",function(){return function(a){var b=function(){"use strict";function b(){}function c(a,b){var c;for(c in a)Object.hasOwnProperty.call(a,c)&&b(c)}function d(a,b){return c(b,function(c){a[c]=b[c]}),a}function e(a,b){c(b,function(c){"undefined"==typeof a[c]&&(a[c]=b[c])})}function f(a,b,c,d,e,f,h){var i,j=(a-f)/e;for(i in b)b.hasOwnProperty(i)&&(b[i]=g(c[i],d[i],l[h[i]],j));return b}function g(a,b,c,d){return a+(b-a)*c(d)}function h(a,b){var d=k.prototype.filter,e=a._filterArgs;c(d,function(c){"undefined"!=typeof d[c][b]&&d[c][b].apply(a,e)})}function i(a,b,c,d,e,g,i,j,k){s=b+c,t=Math.min(r(),s),u=t>=s,v=c-(s-t),a.isPlaying()&&!u?(a._scheduleId=k(a._timeoutHandler,p),h(a,"beforeTween"),f(t,d,e,g,c,b,i),h(a,"afterTween"),j(d,a._attachment,v)):u&&(j(g,a._attachment,v),a.stop(!0))}function j(a,b){var d={};return"string"==typeof b?c(a,function(a){d[a]=b}):c(a,function(a){d[a]||(d[a]=b[a]||n)}),d}function k(a,b){this._currentState=a||{},this._configured=!1,this._scheduleFunction=m,"undefined"!=typeof b&&this.setConfig(b)}var l,m,n="linear",o=500,p=1e3/60,q=Date.now?Date.now:function(){return+new Date},r="undefined"!=typeof SHIFTY_DEBUG_NOW?SHIFTY_DEBUG_NOW:q;m="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozCancelRequestAnimationFrame&&window.mozRequestAnimationFrame||setTimeout:setTimeout;var s,t,u,v;return k.prototype.tween=function(a){return this._isTweening?this:(void 0===a&&this._configured||this.setConfig(a),this._timestamp=r(),this._start(this.get(),this._attachment),this.resume())},k.prototype.setConfig=function(a){a=a||{},this._configured=!0,this._attachment=a.attachment,this._pausedAtTime=null,this._scheduleId=null,this._start=a.start||b,this._step=a.step||b,this._finish=a.finish||b,this._duration=a.duration||o,this._currentState=a.from||this.get(),this._originalState=this.get(),this._targetState=a.to||this.get();var c=this._currentState,d=this._targetState;return e(d,c),this._easing=j(c,a.easing||n),this._filterArgs=[c,this._originalState,d,this._easing],h(this,"tweenCreated"),this},k.prototype.get=function(){return d({},this._currentState)},k.prototype.set=function(a){this._currentState=a},k.prototype.pause=function(){return this._pausedAtTime=r(),this._isPaused=!0,this},k.prototype.resume=function(){this._isPaused&&(this._timestamp+=r()-this._pausedAtTime),this._isPaused=!1,this._isTweening=!0;var a=this;return this._timeoutHandler=function(){i(a,a._timestamp,a._duration,a._currentState,a._originalState,a._targetState,a._easing,a._step,a._scheduleFunction)},this._timeoutHandler(),this},k.prototype.seek=function(a){return this._timestamp=r()-a,this.isPlaying()||(this._isTweening=!0,this._isPaused=!1,i(this,this._timestamp,this._duration,this._currentState,this._originalState,this._targetState,this._easing,this._step,this._scheduleFunction),this._timeoutHandler(),this.pause()),this},k.prototype.stop=function(c){return this._isTweening=!1,this._isPaused=!1,this._timeoutHandler=b,(a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.oCancelAnimationFrame||a.msCancelAnimationFrame||a.mozCancelRequestAnimationFrame||a.clearTimeout)(this._scheduleId),c&&(d(this._currentState,this._targetState),h(this,"afterTweenEnd"),this._finish.call(this,this._currentState,this._attachment)),this},k.prototype.isPlaying=function(){return this._isTweening&&!this._isPaused},k.prototype.setScheduleFunction=function(a){this._scheduleFunction=a},k.prototype.dispose=function(){var a;for(a in this)this.hasOwnProperty(a)&&delete this[a]},k.prototype.filter={},k.prototype.formula={linear:function(a){return a}},l=k.prototype.formula,d(k,{now:r,each:c,tweenProps:f,tweenProp:g,applyFilter:h,shallowCopy:d,defaults:e,composeEasingObject:j}),a.Tweenable=k,k}();!function(){b.shallowCopy(b.prototype.formula,{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){return(a/=.5)<1?.5*Math.pow(a,5):.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin(2*(6*a-1)*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?2-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},easeFromTo:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,.25)}})}(),function(){function a(a,b,c,d,e,f){function g(a){return((n*a+o)*a+p)*a}function h(a){return((q*a+r)*a+s)*a}function i(a){return(3*n*a+2*o)*a+p}function j(a){return 1/(200*a)}function k(a,b){return h(m(a,b))}function l(a){return a>=0?a:0-a}function m(a,b){var c,d,e,f,h,j;for(e=a,j=0;8>j;j++){if(f=g(e)-a,l(f)<b)return e;if(h=i(e),l(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),l(f-a)<b)return e;a>f?c=e:d=e,e=.5*(d-c)+c}return e}var n=0,o=0,p=0,q=0,r=0,s=0;return p=3*b,o=3*(d-b)-p,n=1-p-o,s=3*c,r=3*(e-c)-s,q=1-s-r,k(a,j(f))}function c(b,c,d,e){return function(f){return a(f,b,c,d,e,1)}}b.setBezierFunction=function(a,d,e,f,g){var h=c(d,e,f,g);return h.x1=d,h.y1=e,h.x2=f,h.y2=g,b.prototype.formula[a]=h},b.unsetBezierFunction=function(a){delete b.prototype.formula[a]}}(),function(){function a(a,c,d,e,f){return b.tweenProps(e,c,a,d,1,0,f)}var c=new b;c._filterArgs=[],b.interpolate=function(d,e,f,g){var h=b.shallowCopy({},d),i=b.composeEasingObject(d,g||"linear");c.set({});var j=c._filterArgs;j.length=0,j[0]=h,j[1]=d,j[2]=e,j[3]=i,b.applyFilter(c,"tweenCreated"),b.applyFilter(c,"beforeTween");var k=a(d,h,e,f,i);return b.applyFilter(c,"afterTween"),k}}(),function(a){function b(a,b){B.length=0;var c,d=a.length;for(c=0;d>c;c++)B.push("_"+b+"_"+c);return B}function c(a){var b=a.match(v);return b?(1===b.length||a[0].match(u))&&b.unshift(""):b=["",""],b.join(A)}function d(b){a.each(b,function(a){var c=b[a];"string"==typeof c&&c.match(z)&&(b[a]=e(c))})}function e(a){return i(z,a,f)}function f(a){var b=g(a);return"rgb("+b[0]+","+b[1]+","+b[2]+")"}function g(a){return a=a.replace(/#/,""),3===a.length&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),C[0]=h(a.substr(0,2)),C[1]=h(a.substr(2,2)),C[2]=h(a.substr(4,2)),C}function h(a){return parseInt(a,16)}function i(a,b,c){var d=b.match(a),e=b.replace(a,A);if(d)for(var f,g=d.length,h=0;g>h;h++)f=d.shift(),e=e.replace(A,c(f));return e}function j(a){return i(x,a,k)}function k(a){for(var b=a.match(w),c=b.length,d=a.match(y)[0],e=0;c>e;e++)d+=parseInt(b[e],10)+",";return d=d.slice(0,-1)+")"}function l(d){var e={};return a.each(d,function(a){var f=d[a];if("string"==typeof f){var g=r(f);e[a]={formatString:c(f),chunkNames:b(g,a)}}}),e}function m(b,c){a.each(c,function(a){for(var d=b[a],e=r(d),f=e.length,g=0;f>g;g++)b[c[a].chunkNames[g]]=+e[g];delete b[a]})}function n(b,c){a.each(c,function(a){var d=b[a],e=o(b,c[a].chunkNames),f=p(e,c[a].chunkNames);d=q(c[a].formatString,f),b[a]=j(d)})}function o(a,b){for(var c,d={},e=b.length,f=0;e>f;f++)c=b[f],d[c]=a[c],delete a[c];return d}function p(a,b){D.length=0;for(var c=b.length,d=0;c>d;d++)D.push(a[b[d]]);return D}function q(a,b){for(var c=a,d=b.length,e=0;d>e;e++)c=c.replace(A,+b[e].toFixed(4));return c}function r(a){return a.match(w)}function s(b,c){a.each(c,function(a){for(var d=c[a],e=d.chunkNames,f=e.length,g=b[a].split(" "),h=g[g.length-1],i=0;f>i;i++)b[e[i]]=g[i]||h;delete b[a]})}function t(b,c){a.each(c,function(a){for(var d=c[a],e=d.chunkNames,f=e.length,g="",h=0;f>h;h++)g+=" "+b[e[h]],delete b[e[h]];b[a]=g.substr(1)})}var u=/(\d|\-|\.)/,v=/([^\-0-9\.]+)/g,w=/[0-9.\-]+/g,x=new RegExp("rgb\\("+w.source+/,\s*/.source+w.source+/,\s*/.source+w.source+"\\)","g"),y=/^.*\(/,z=/#([0-9]|[a-f]){3,6}/gi,A="VAL",B=[],C=[],D=[];a.prototype.filter.token={tweenCreated:function(a,b,c){d(a),d(b),d(c),this._tokenData=l(a)},beforeTween:function(a,b,c,d){s(d,this._tokenData),m(a,this._tokenData),m(b,this._tokenData),m(c,this._tokenData)},afterTween:function(a,b,c,d){n(a,this._tokenData),n(b,this._tokenData),n(c,this._tokenData),t(d,this._tokenData)}}}(b)}(window),window.Tweenable}),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,a,l){return function(c){function u(e,t){return g&&e&&p(e),s.then(function(n){return $||i(n,e),t&&$.css(t),$})}function i(e,t){if(h=angular.element(c.container||document.body),$=angular.element(e),0===$.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter($,h),g=a.$new(),t&&p(t);var o=l(d,{$scope:g});v&&(g[v]=o),n($)(g)}function p(e){for(var t in e)g[t]=e[t]}function f(){var t=e.defer();return $?r.leave($,function(){g.$destroy(),$=null,t.resolve()}):t.resolve(),t.promise}function m(){return!!$}if(!(!c.template^!c.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var s,g,d=(c.template,c.controller||angular.noop),v=c.controllerAs,$=null,h=null;if(c.template){var x=e.defer();x.resolve(c.template),s=x.promise}else s=t.get(c.templateUrl,{cache:o}).then(function(e){return e.data});return{open:u,close:f,active:m}}}]).directive("hasContextMenu",["$injector","$window","$parse",function(e,t){return{restrict:"A",link:function(n,o,r){function a(e){p.open(f,c(e))}function l(){p.close()}function c(e){return{top:Math.max(e.pageY,0)+"px",left:Math.max(e.pageX,0)+"px"}}function u(e){p.active()&&i&&2!==e.button&&n.$apply(function(){l()})}var i,p=e.get(r.target),f={},m=angular.element(t),s=r.triggerOnEvent||"contextmenu",g=r.locals.split(",").map(function(e){return e.trim()});angular.forEach(g,function(e){f[e]=n[e]}),o.bind(s,function(e){i=e.target,e.preventDefault(),e.stopPropagation(),n.$apply(function(){a(e)})}),m.bind("keyup",function(e){p.active()&&27===e.keyCode&&n.$apply(function(){l()})}),m.bind("click",u),m.bind(s,u)}}}]);!function(){function e(e){function r(r){var n={};if(e.debug("Link header: ",r),"string"!=typeof r)return new Error("Expected a string as parameter type but received: '"+typeof r+"'!");if(0==r.length)return new Error("Empty string provided!");var a=r.split(",");return e.debug("Links: ",a),_.forEach(a,function(e){t(e,n)}),e.debug("Object returned: ",n),n}function t(r,t){e.debug("Element to parse: ",r);var i=r.split(";");i[0]=i[0].trim(),i[1]=i[1].trim(),e.debug("Element splitted and trimmed: ",i),t[n(i[1])]=a(i[0])}function n(r){e.debug("REL element to parse: ",r);var t=r.split("=");return t[1]=t[1].trim().toLowerCase(),t[1]=t[1].replace(/"/g,""),e.debug("Parsed REL element: ",t[1]),t[1]}function a(r){e.debug("URL element to parse: ",r),r=r.replace(/^</,"").replace(/>$/,"");var t=URIUtil.parse(r);return t.url=r,e.debug("Extracted data: ",t),t}var i={parse:r};return i}angular.module("ig.linkHeaderParser",[]).factory("linkHeaderParser",e),e.$inject=["$log"]}();(function(){function quantizedNumber(i){var adjust=[1,2.5,5];return Math.floor(Math.pow(10,Math.floor(i/3))*adjust[i%3])}function quantizedIndex(i){if(i<1){return 0}var group=Math.floor(Math.log(i)/Math.LN10),offset=i/(2.5*Math.pow(10,group));if(offset>=3){group++;offset=0}return 3*group+Math.round(Math.min(2,offset))}function quantize(i){if(i===Infinity){return Infinity}return quantizedNumber(quantizedIndex(i))}function appendTransform(defaults,transform){defaults=angular.isArray(defaults)?defaults:[defaults];return transform?defaults.concat(transform):defaults}angular.module("bgf.paginateAnything",[]).directive("bgfPagination",function(){var defaultLinkGroupSize=3,defaultClientLimit=250,defaultPerPage=50;return{restrict:"AE",scope:{url:"=",collection:"=",urlParams:"=?",headers:"=?",page:"=?",perPage:"=?",perPagePresets:"=?",autoPresets:"=?",clientLimit:"=?",linkGroupSize:"=?",reloadPage:"=?",size:"=?",passive:"@",transformResponse:"=?",numPages:"=?",numItems:"=?",serverLimit:"=?",rangeFrom:"=?",rangeTo:"=?"},templateUrl:function(element,attr){return attr.templateUrl||"src/paginate-anything.html"},replace:true,controller:["$scope","$http",function($scope,$http){$scope.reloadPage=false;$scope.serverLimit=Infinity;$scope.Math=window.Math;if(typeof $scope.autoPresets!=="boolean"){$scope.autoPresets=true}var lgs=$scope.linkGroupSize,cl=$scope.clientLimit;$scope.linkGroupSize=typeof lgs==="number"?lgs:defaultLinkGroupSize;$scope.clientLimit=typeof cl==="number"?cl:defaultClientLimit;$scope.updatePresets=function(){if($scope.autoPresets){var presets=[],i;for(i=Math.min(3,quantizedIndex($scope.perPage||defaultPerPage));i<=quantizedIndex(Math.min($scope.clientLimit,$scope.serverLimit));i++){presets.push(quantizedNumber(i))}$scope.perPagePresets=presets}else{$scope.perPagePresets=$scope.perPagePresets.filter(function(preset){return preset<=$scope.serverLimit}).concat([$scope.serverLimit])}};$scope.gotoPage=function(i){if(i<0||i*$scope.perPage>=$scope.numItems){return}$scope.page=i};$scope.linkGroupFirst=function(){var rightDebt=Math.max(0,$scope.linkGroupSize-($scope.numPages-1-($scope.page+2)));return Math.max(0,$scope.page-($scope.linkGroupSize+rightDebt))};$scope.linkGroupLast=function(){var leftDebt=Math.max(0,$scope.linkGroupSize-($scope.page-2));return Math.min($scope.numPages-1,$scope.page+($scope.linkGroupSize+leftDebt))};$scope.isFinite=function(){return $scope.numPages<Infinity};function requestRange(request){$scope.$emit("pagination:loadStart",request);$http({method:"GET",url:$scope.url,params:$scope.urlParams,headers:angular.extend({},$scope.headers,{"Range-Unit":"items",Range:[request.from,request.to].join("-")}),transformResponse:appendTransform($http.defaults.transformResponse,$scope.transformResponse)}).success(function(data,status,headers,config){var response=parseRange(headers("Content-Range"));if(status===204||response&&response.total===0){$scope.numItems=0;$scope.collection=[]}else{$scope.numItems=response?response.total:data.length;$scope.collection=data||[]}if(response){$scope.rangeFrom=response.from;$scope.rangeTo=response.to;if(length(response)<response.total){if(request.to<response.total-1||response.to<response.total-1&&response.total<request.to){if(!$scope.perPage||length(response)<$scope.perPage){if($scope.autoPresets){var idx=quantizedIndex(length(response));if(quantizedNumber(idx)>length(response)){idx--}$scope.serverLimit=quantizedNumber(idx)}else{$scope.serverLimit=length(response)}$scope.perPage=$scope.Math.min($scope.serverLimit,$scope.clientLimit)}}}}$scope.numPages=Math.ceil($scope.numItems/($scope.perPage||defaultPerPage));$scope.$emit("pagination:loadPage",status,config)}).error(function(data,status,headers,config){$scope.$emit("pagination:error",status,config)})}$scope.page=$scope.page||0;$scope.size=$scope.size||"md";if($scope.autoPresets){$scope.updatePresets()}$scope.$watch("page",function(newPage,oldPage){if($scope.passive==="true"){return}if(newPage!==oldPage){if(newPage<0||newPage*$scope.perPage>=$scope.numItems){return}var pp=$scope.perPage||defaultPerPage;if($scope.autoPresets){pp=quantize(pp)}requestRange({from:newPage*pp,to:(newPage+1)*pp-1})}});$scope.$watch("perPage",function(newPp,oldPp){if($scope.passive==="true"){return}if(typeof oldPp==="number"&&newPp!==oldPp){var first=$scope.page*oldPp;var newPage=Math.floor(first/newPp);if($scope.page!==newPage){$scope.page=newPage}else{requestRange({from:$scope.page*newPp,to:($scope.page+1)*newPp-1})}}});$scope.$watch("serverLimit",function(newLimit,oldLimit){if($scope.passive==="true"){return}if(newLimit!==oldLimit){$scope.updatePresets()}});$scope.$watch("url",function(newUrl,oldUrl){if($scope.passive==="true"){return}if(newUrl!==oldUrl){if($scope.page===0){$scope.reloadPage=true}else{$scope.page=0}}});$scope.$watch("urlParams",function(newParams,oldParams){if($scope.passive==="true"){return}if(!angular.equals(newParams,oldParams)){if($scope.page===0){$scope.reloadPage=true}else{$scope.page=0}}},true);$scope.$watch("headers",function(newHeaders,oldHeaders){if($scope.passive==="true"){return}if(!angular.equals(newHeaders,oldHeaders)){if($scope.page===0){$scope.reloadPage=true}else{$scope.page=0}}},true);$scope.$watch("reloadPage",function(newVal,oldVal){if($scope.passive==="true"){return}if(newVal===true&&oldVal===false){$scope.reloadPage=false;requestRange({from:$scope.page*$scope.perPage,to:($scope.page+1)*$scope.perPage-1})}});$scope.$watch("transformResponse",function(newTransform,oldTransform){if($scope.passive==="true"){return}if(!newTransform||!oldTransform){return}if(!angular.equals(newTransform.toString(),oldTransform.toString())){if($scope.page===0){$scope.reloadPage=true}else{$scope.page=0}}},true);var pp=$scope.perPage||defaultPerPage;if($scope.autoPresets){pp=quantize(pp)}requestRange({from:$scope.page*pp,to:($scope.page+1)*pp-1})}]}}).filter("makeRange",function(){return function(input){var lowBound,highBound;switch(input.length){case 1:lowBound=0;highBound=parseInt(input[0],10)-1;break;case 2:lowBound=parseInt(input[0],10);highBound=parseInt(input[1],10);break;default:return input}var result=[];for(var i=lowBound;i<=highBound;i++){result.push(i)}return result}});function parseRange(hdr){var m=hdr&&hdr.match(/^(?:items )?(\d+)-(\d+)\/(\d+|\*)$/);if(m){return{from:+m[1],to:+m[2],total:m[3]==="*"?Infinity:+m[3]}}else if(hdr==="*/0"){return{total:0}}return null}function length(range){return range.to-range.from+1}})();angular.module("bgf.paginateAnything").run(["$templateCache",function($templateCache){$templateCache.put("src/paginate-anything.html",'<div class=paginate-anything><ul class="pagination pagination-{{size}} links" ng-if="numPages > 1"><li ng-class="{disabled: page <= 0}"><a href ng-click=gotoPage(page-1)>&laquo;</a></li><li ng-if="linkGroupFirst() > 0"><a href ng-click=gotoPage(0)>1</a></li><li ng-if="linkGroupFirst() > 1" class=disabled><a href>&hellip;</a></li><li ng-repeat="p in [linkGroupFirst(), linkGroupLast()] | makeRange" ng-class="{active: p === page}"><a href ng-click=gotoPage(p)>{{p+1}}</a></li><li ng-if="linkGroupLast() < numPages - 2" class=disabled><a href>&hellip;</a></li><li ng-if="isFinite() && linkGroupLast() < numPages - 1"><a href ng-click=gotoPage(numPages-1)>{{numPages}}</a></li><li ng-class="{disabled: page >= numPages - 1}"><a href ng-click=gotoPage(page+1)>&raquo;</a></li></ul><div class=per-page ng-if="perPagePresets.length > 0 && numPages > 1"><select ng-model=$parent.perPage ng-options="p for p in perPagePresets"></select>per page</div></div>')}]);var THREE={REVISION:"71"};if(typeof module==="object"){module.exports=THREE}if(Math.sign===undefined){Math.sign=function(x){return x<0?-1:x>0?1:+x}}THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Projector=function(){THREE.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(vector,camera){THREE.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){THREE.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(vector,camera){THREE.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){THREE.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(color){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(color)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(value){if(value instanceof THREE.Color){this.copy(value)}else if(typeof value==="number"){this.setHex(value)}else if(typeof value==="string"){this.setStyle(value)}return this},setHex:function(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this},setRGB:function(r,g,b){this.r=r;this.g=g;this.b=b;return this},setHSL:function(h,s,l){if(s===0){this.r=this.g=this.b=l}else{var hue2rgb=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p};var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this},setStyle:function(style){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(style)){var color=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(style);this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(style)){var color=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(style);this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(style)){var color=/^\#([0-9a-f]{6})$/i.exec(style);this.setHex(parseInt(color[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)){var color=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);this.setHex(parseInt(color[1]+color[1]+color[2]+color[2]+color[3]+color[3],16));return this}if(/^(\w+)$/i.test(style)){this.setHex(THREE.ColorKeywords[style]);return this}},copy:function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this},copyGammaToLinear:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;this.r=Math.pow(color.r,gammaFactor);this.g=Math.pow(color.g,gammaFactor);this.b=Math.pow(color.b,gammaFactor);return this},copyLinearToGamma:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;var safeInverse=gammaFactor>0?1/gammaFactor:1;this.r=Math.pow(color.r,safeInverse);this.g=Math.pow(color.g,safeInverse);this.b=Math.pow(color.b,safeInverse);return this},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(optionalTarget){var hsl=optionalTarget||{h:0,s:0,l:0};var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this},add:function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this},addColors:function(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this},addScalar:function(s){this.r+=s;this.g+=s;this.b+=s;return this},multiply:function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this},multiplyScalar:function(s){this.r*=s;this.g*=s;this.b*=s;return this},lerp:function(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array){this.r=array[0];this.g=array[1];this.b=array[2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.r;array[offset+1]=this.g;array[offset+2]=this.b;return array},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,
fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==undefined?w:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get w(){return this._w},set w(value){this._w=value;this.onChangeCallback()},set:function(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this},copy:function(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this},setFromEuler:function(euler,update){if(euler instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var c1=Math.cos(euler._x/2);var c2=Math.cos(euler._y/2);var c3=Math.cos(euler._z/2);var s1=Math.sin(euler._x/2);var s2=Math.sin(euler._y/2);var s3=Math.sin(euler._z/2);if(euler.order==="XYZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="YXZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="ZXY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="ZYX"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="YZX"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="XZY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}if(update!==false)this.onChangeCallback();return this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=Math.cos(halfAngle);this.onChangeCallback();return this},setFromRotationMatrix:function(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=.5/Math.sqrt(trace+1);this._w=.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);this._w=(m32-m23)/s;this._x=.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=.25*s;this._z=(m23+m32)/s}else{s=2*Math.sqrt(1+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=.25*s}this.onChangeCallback();return this},setFromUnitVectors:function(){var v1,r;var EPS=1e-6;return function(vFrom,vTo){if(v1===undefined)v1=new THREE.Vector3;r=vFrom.dot(vTo)+1;if(r<EPS){r=0;if(Math.abs(vFrom.x)>Math.abs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();if(l===0){this._x=0;this._y=0;this._z=0;this._w=1}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l}this.onChangeCallback();return this},multiply:function(q,p){if(p!==undefined){THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(q,p)}return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;var qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this},multiplyVector3:function(vector){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return vector.applyQuaternion(this)},slerp:function(qb,t){if(t===0)return this;if(t===1)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w;var cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(cosHalfTheta>=1){this._w=w;this._x=x;this._y=y;this._z=z;return this}var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001){this._w=.5*(w+this._w);this._x=.5*(x+this._x);this._y=.5*(y+this._y);this._z=.5*(z+this._z);return this}var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){if(offset===undefined)offset=0;this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)};THREE.Vector2=function(x,y){this.x=x||0;this.y=y||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(x,y){this.x=x;this.y=y;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;return this},addScalar:function(s){this.x+=s;this.y+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;return this},subScalar:function(s){this.x-=s;this.y-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(v){this.x*=v.x;this.y*=v.y;return this},multiplyScalar:function(s){this.x*=s;this.y*=s;return this},divide:function(v){this.x/=v.x;this.y/=v.y;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar}else{this.x=0;this.y=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector2;max=new THREE.Vector2}min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(v,w)}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var quaternion;return function(euler){if(euler instanceof THREE.Euler===false){THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromEuler(euler));return this}}(),applyAxisAngle:function(){var quaternion;return function(axis,angle){if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle));return this}}(),applyMatrix3:function(m){var x=this.x;var y=this.y;var z=this.z;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12];this.y=e[1]*x+e[5]*y+e[9]*z+e[13];this.z=e[2]*x+e[6]*y+e[10]*z+e[14];return this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;var d=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*d;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*d;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*d;return this},applyQuaternion:function(q){var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},project:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyProjection(matrix)}}(),unproject:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyProjection(matrix)}}(),transformDirection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;this.normalize();return this},divide:function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar}else{this.x=0;this.y=0;this.z=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector3;max=new THREE.Vector3}min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},cross:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(v,w)}var x=this.x,y=this.y,z=this.z;this.x=y*v.z-z*v.y;this.y=z*v.x-x*v.z;this.z=x*v.y-y*v.x;return this},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this},projectOnVector:function(){var v1,dot;return function(vector){if(v1===undefined)v1=new THREE.Vector3;v1.copy(vector).normalize();dot=this.dot(v1);return this.copy(v1).multiplyScalar(dot)}}(),projectOnPlane:function(){var v1;return function(planeNormal){if(v1===undefined)v1=new THREE.Vector3;v1.copy(this).projectOnVector(planeNormal);return this.sub(v1)}}(),reflect:function(){var v1;return function(normal){if(v1===undefined)v1=new THREE.Vector3;return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/(this.length()*v.length());return Math.acos(THREE.Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},setEulerFromRotationMatrix:function(m,order){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(q,order){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(index,matrix)},setFromMatrixPosition:function(m){this.x=m.elements[12];this.y=m.elements[13];this.z=m.elements[14];return this},setFromMatrixScale:function(m){var sx=this.set(m.elements[0],m.elements[1],m.elements[2]).length();var sy=this.set(m.elements[4],m.elements[5],m.elements[6]).length();var sz=this.set(m.elements[8],m.elements[9],m.elements[10]).length();this.x=sx;this.y=sy;this.z=sz;return this},setFromMatrixColumn:function(index,matrix){var offset=index*4;var me=matrix.elements;this.x=me[offset];this.y=me[offset+1];this.z=me[offset+2];return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==undefined?w:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setW:function(w){this.w=w;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==undefined?v.w:1;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;this.w-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this},applyMatrix4:function(m){var x=this.x;var y=this.y;var z=this.z;var w=this.w;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar;this.w*=invScalar}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s}return this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,epsilon=.01,epsilon2=.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<epsilon&&Math.abs(m13-m31)<epsilon&&Math.abs(m23-m32)<epsilon){if(Math.abs(m12+m21)<epsilon2&&Math.abs(m13+m31)<epsilon2&&Math.abs(m23+m32)<epsilon2&&Math.abs(m11+m22+m33-3)<epsilon2){this.set(1,0,0,0);return this}angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if(xx>yy&&xx>zz){if(xx<epsilon){x=0;y=.707106781;z=.707106781}else{x=Math.sqrt(xx);y=xy/x;z=xz/x}}else if(yy>zz){if(yy<epsilon){x=.707106781;y=0;z=.707106781}else{y=Math.sqrt(yy);x=xy/y;z=yz/y}}else{if(zz<epsilon){x=.707106781;y=.707106781;z=0}else{z=Math.sqrt(zz);x=xz/z;y=yz/z}}this.set(x,y,z,angle);return this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));if(Math.abs(s)<.001)s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}if(this.w>v.w){this.w=v.w}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}if(this.w<v.w){this.w=v.w}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}if(this.w<min.w){this.w=min.w}else if(this.w>max.w){this.w=max.w}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector4;max=new THREE.Vector4}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];this.w=attribute.array[index+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get order(){return this._order},set order(value){this._order=value;this.onChangeCallback()},set:function(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this},copy:function(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this},setFromRotationMatrix:function(m,order,update){var clamp=THREE.Math.clamp;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if(order==="XYZ"){this._y=Math.asin(clamp(m13,-1,1));if(Math.abs(m13)<.99999){this._x=Math.atan2(-m23,m33);this._z=Math.atan2(-m12,m11)}else{this._x=Math.atan2(m32,m22);this._z=0}}else if(order==="YXZ"){this._x=Math.asin(-clamp(m23,-1,1));if(Math.abs(m23)<.99999){this._y=Math.atan2(m13,m33);this._z=Math.atan2(m21,m22)}else{this._y=Math.atan2(-m31,m11);this._z=0}}else if(order==="ZXY"){this._x=Math.asin(clamp(m32,-1,1));if(Math.abs(m32)<.99999){this._y=Math.atan2(-m31,m33);this._z=Math.atan2(-m12,m22)}else{this._y=0;this._z=Math.atan2(m21,m11)}}else if(order==="ZYX"){this._y=Math.asin(-clamp(m31,-1,1));if(Math.abs(m31)<.99999){this._x=Math.atan2(m32,m33);this._z=Math.atan2(m21,m11)}else{this._x=0;this._z=Math.atan2(-m12,m22)}}else if(order==="YZX"){this._z=Math.asin(clamp(m21,-1,1));if(Math.abs(m21)<.99999){this._x=Math.atan2(-m23,m22);this._y=Math.atan2(-m31,m11)}else{this._x=0;this._y=Math.atan2(m13,m33)}}else if(order==="XZY"){this._z=Math.asin(-clamp(m12,-1,1));if(Math.abs(m12)<.99999){this._x=Math.atan2(m32,m22);this._y=Math.atan2(m13,m11)}else{this._x=Math.atan2(-m23,m33);this._y=0}}else{THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order)}this._order=order;if(update!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var matrix;return function(q,order,update){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.makeRotationFromQuaternion(q);this.setFromRotationMatrix(matrix,order,update);return this}}(),setFromVector3:function(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:function(){var q=new THREE.Quaternion;return function(newOrder){q.setFromEuler(this);this.setFromQuaternion(q,newOrder)}}(),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==undefined)this._order=array[3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._order;return array},toVector3:function(optionalResult){if(optionalResult){return optionalResult.set(this._x,this._y,this._z)}else{return new THREE.Vector3(this._x,this._y,this._z)}},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(start,end){this.start=start!==undefined?start:new THREE.Vector3;this.end=end!==undefined?end:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(start,end){this.start.copy(start);this.end.copy(end);return this},copy:function(line){this.start.copy(line.start);this.end.copy(line.end);return this},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.end,this.start);
},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var startP=new THREE.Vector3;var startEnd=new THREE.Vector3;return function(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd);var startEnd_startP=startEnd.dot(startP);var t=startEnd_startP/startEnd2;if(clampToLine){t=THREE.Math.clamp(t,0,1)}return t}}(),closestPointToPoint:function(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine);var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(min,max){this.min=min!==undefined?min:new THREE.Vector2(Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector2((-Infinity),(-Infinity))};THREE.Box2.prototype={constructor:THREE.Box2,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector2;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(min,max){this.min=min!==undefined?min:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector3((-Infinity),(-Infinity),(-Infinity))};THREE.Box3.prototype={constructor:THREE.Box3,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),setFromObject:function(){var v1=new THREE.Vector3;return function(object){var scope=this;object.updateMatrixWorld(true);this.makeEmpty();object.traverse(function(node){var geometry=node.geometry;if(geometry!==undefined){if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;for(var i=0,il=vertices.length;i<il;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}else if(geometry instanceof THREE.BufferGeometry&&geometry.attributes["position"]!==undefined){var positions=geometry.attributes["position"].array;for(var i=0,il=positions.length;i<il;i+=3){v1.set(positions[i],positions[i+1],positions[i+2]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}}});return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),getBoundingSphere:function(){var v1=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Sphere;result.center=this.center();result.radius=this.size(v1).length()*.5;return result}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},applyMatrix4:function(){var points=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(matrix){points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);this.makeEmpty();this.setFromPoints(points);return this}}(),translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[3]=n12;te[6]=n13;te[1]=n21;te[4]=n22;te[7]=n23;te[2]=n31;te[5]=n32;te[8]=n33;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8]);return this},multiplyVector3:function(vector){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return vector.applyMatrix3(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix3(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this},determinant:function(){var te=this.elements;var a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements;var te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9];te[1]=-me[10]*me[1]+me[2]*me[9];te[2]=me[6]*me[1]-me[2]*me[5];te[3]=-me[10]*me[4]+me[6]*me[8];te[4]=me[10]*me[0]-me[2]*me[8];te[5]=-me[6]*me[0]+me[2]*me[4];te[6]=me[9]*me[4]-me[5]*me[8];te[7]=-me[9]*me[0]+me[1]*me[8];te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(det===0){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{THREE.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},transpose:function(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array},getNormalMatrix:function(m){this.getInverse(m).transpose();return this},transposeIntoArray:function(r){var m=this.elements;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(m){this.elements.set(m.elements);return this},extractPosition:function(m){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(m)},copyPosition:function(m){var te=this.elements;var me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this},extractBasis:function(xAxis,yAxis,zAxis){var te=this.elements;xAxis.set(te[0],te[1],te[2]);yAxis.set(te[4],te[5],te[6]);zAxis.set(te[8],te[9],te[10]);return this},makeBasis:function(xAxis,yAxis,zAxis){this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1);return this},extractRotation:function(){var v1=new THREE.Vector3;return function(m){var te=this.elements;var me=m.elements;var scaleX=1/v1.set(me[0],me[1],me[2]).length();var scaleY=1/v1.set(me[4],me[5],me[6]).length();var scaleZ=1/v1.set(me[8],me[9],me[10]).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this}}(),makeRotationFromEuler:function(euler){if(euler instanceof THREE.Euler===false){THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var te=this.elements;var x=euler.x,y=euler.y,z=euler.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(euler.order==="XYZ"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c}else if(euler.order==="YXZ"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c}else if(euler.order==="ZXY"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c}else if(euler.order==="ZYX"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c}else if(euler.order==="YZX"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f}else if(euler.order==="XZY"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},setRotationFromQuaternion:function(q){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(q)},makeRotationFromQuaternion:function(q){var te=this.elements;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},lookAt:function(){var x=new THREE.Vector3;var y=new THREE.Vector3;var z=new THREE.Vector3;return function(eye,target,up){var te=this.elements;z.subVectors(eye,target).normalize();if(z.length()===0){z.z=1}x.crossVectors(up,z).normalize();if(x.length()===0){z.x+=1e-4;x.crossVectors(up,z).normalize()}y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this}}(),multiply:function(m,n){if(n!==undefined){THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(m,n)}return this.multiplyMatrices(this,m)},multiplyMatrices:function(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this},multiplyToArray:function(a,b,r){var te=this.elements;this.multiplyMatrices(a,b);r[0]=te[0];r[1]=te[1];r[2]=te[2];r[3]=te[3];r[4]=te[4];r[5]=te[5];r[6]=te[6];r[7]=te[7];r[8]=te[8];r[9]=te[9];r[10]=te[10];r[11]=te[11];r[12]=te[12];r[13]=te[13];r[14]=te[14];r[15]=te[15];return this},multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this},multiplyVector3:function(vector){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return vector.applyProjection(this)},multiplyVector4:function(vector){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix4(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),rotateAxis:function(v){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");v.transformDirection(this)},crossVector:function(vector){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},determinant:function(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array},getPosition:function(){var v1=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this},getInverse:function(m,throwOnInvertible){var te=this.elements;var me=m.elements;var n11=me[0],n12=me[4],n13=me[8],n14=me[12];var n21=me[1],n22=me[5],n23=me[9],n24=me[13];var n31=me[2],n32=me[6],n33=me[10],n34=me[14];var n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44;te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44;te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44;te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44;te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44;te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44;te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34;te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44;te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44;te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44;te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34;te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43;te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43;te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43;te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=n11*te[0]+n21*te[4]+n31*te[8]+n41*te[12];if(det==0){var msg="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{THREE.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},translate:function(v){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(angle){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(angle){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(angle){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(axis,angle){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this},getMaxScaleOnAxis:function(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeTranslation:function(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this},makeScale:function(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this},compose:function(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this},decompose:function(){var vector=new THREE.Vector3;var matrix=new THREE.Matrix4;return function(position,quaternion,scale){var te=this.elements;var sx=vector.set(te[0],te[1],te[2]).length();var sy=vector.set(te[4],te[5],te[6]).length();var sz=vector.set(te[8],te[9],te[10]).length();var det=this.determinant();if(det<0){sx=-sx}position.x=te[12];position.y=te[13];position.z=te[14];matrix.elements.set(this.elements);var invSX=1/sx;var invSY=1/sy;var invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this}}(),makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(THREE.Math.degToRad(fov*.5));var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements;var w=right-left;var h=top-bottom;var p=far-near;var x=(right+left)/w;var y=(top+bottom)/h;var z=(far+near)/p;te[0]=2/w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2/h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2/p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8],te[9],te[10],te[11],te[12],te[13],te[14],te[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(origin,direction){this.origin=origin!==undefined?origin:new THREE.Vector3;this.direction=direction!==undefined?direction:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this},copy:function(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,v1));return this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(directionDistance<0){return result.copy(this.origin)}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);if(directionDistance<0){return this.origin.distanceTo(point)}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceTo(point)}}(),distanceSqToSegment:function(){var segCenter=new THREE.Vector3;var segDir=new THREE.Vector3;var diff=new THREE.Vector3;return function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5);segDir.copy(v1).sub(v0).normalize();diff.copy(this.origin).sub(segCenter);var segExtent=v0.distanceTo(v1)*.5;var a01=-this.direction.dot(segDir);var b0=diff.dot(this.direction);var b1=-diff.dot(segDir);var c=diff.lengthSq();var det=Math.abs(1-a01*a01);var s0,s1,sqrDist,extDet;if(det>0){s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(s0>=0){if(s1>=-extDet){if(s1<=extDet){var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else{s1=segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{s1=-segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{if(s1<=-extDet){s0=Math.max(0,-(-a01*segExtent+b0));s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}else if(s1<=extDet){s0=0;s1=Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c}else{s0=Math.max(0,-(a01*segExtent+b0));s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}}}else{s1=a01>0?-segExtent:segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin)}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter)}return sqrDist}}(),isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},intersectSphere:function(){var v1=new THREE.Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction);var d2=v1.dot(v1)-tca*tca;var radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;var thc=Math.sqrt(radius2-d2);var t0=tca-thc;var t1=tca+thc;if(t0<0&&t1<0)return null;if(t0<0)return this.at(t1,optionalTarget);return this.at(t0,optionalTarget)}}(),isIntersectionPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);if(distToPoint===0){return true}var denominator=plane.normal.dot(this.direction);if(denominator*distToPoint<0){return true}return false},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(denominator==0){if(plane.distanceToPoint(this.origin)==0){return 0}return null}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(t===null){return null}return this.at(t,optionalTarget)},isIntersectionBox:function(){var v=new THREE.Vector3;return function(box){return this.intersectBox(box,v)!==null}}(),intersectBox:function(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax;var invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z;var origin=this.origin;if(invdirx>=0){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx}if(invdiry>=0){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry}if(tmin>tymax||tymin>tmax)return null;if(tymin>tmin||tmin!==tmin)tmin=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(invdirz>=0){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz}if(tmin>tzmax||tzmin>tmax)return null;if(tzmin>tmin||tmin!==tmin)tmin=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(tmax<0)return null;return this.at(tmin>=0?tmin:tmax,optionalTarget)},intersectTriangle:function(){var diff=new THREE.Vector3;var edge1=new THREE.Vector3;var edge2=new THREE.Vector3;var normal=new THREE.Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);var DdN=this.direction.dot(normal);var sign;if(DdN>0){if(backfaceCulling)return null;sign=1}else if(DdN<0){sign=-1;DdN=-DdN}else{return null}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0){return null}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0){return null}if(DdQxE2+DdE1xQ>DdN){return null}var QdN=-sign*diff.dot(normal);if(QdN<0){return null}return this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function(matrix4){this.direction.add(this.origin).applyMatrix4(matrix4);this.origin.applyMatrix4(matrix4);
this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(center,radius){this.center=center!==undefined?center:new THREE.Vector3;this.radius=radius!==undefined?radius:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(center,radius){this.center.copy(center);this.radius=radius;return this},setFromPoints:function(){var box=new THREE.Box3;return function(points,optionalCenter){var center=this.center;if(optionalCenter!==undefined){center.copy(optionalCenter)}else{box.setFromPoints(points).center(center)}var maxRadiusSq=0;for(var i=0,il=points.length;i<il;i++){maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]))}this.radius=Math.sqrt(maxRadiusSq);return this}}(),copy:function(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},clampPoint:function(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point);var result=optionalTarget||new THREE.Vector3;result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center)}return result},getBoundingBox:function(optionalTarget){var box=optionalTarget||new THREE.Box3;box.set(this.center,this.center);box.expandByScalar(this.radius);return box},applyMatrix4:function(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this},translate:function(offset){this.center.add(offset);return this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(p0,p1,p2,p3,p4,p5){this.planes=[p0!==undefined?p0:new THREE.Plane,p1!==undefined?p1:new THREE.Plane,p2!==undefined?p2:new THREE.Plane,p3!==undefined?p3:new THREE.Plane,p4!==undefined?p4:new THREE.Plane,p5!==undefined?p5:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this},copy:function(frustum){var planes=this.planes;for(var i=0;i<6;i++){planes[i].copy(frustum.planes[i])}return this},setFromMatrix:function(m){var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this},intersectsObject:function(){var sphere=new THREE.Sphere;return function(object){var geometry=object.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){var planes=this.planes;var center=sphere.center;var negRadius=-sphere.radius;for(var i=0;i<6;i++){var distance=planes[i].distanceToPoint(center);if(distance<negRadius){return false}}return true},intersectsBox:function(){var p1=new THREE.Vector3,p2=new THREE.Vector3;return function(box){var planes=this.planes;for(var i=0;i<6;i++){var plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x;p2.x=plane.normal.x>0?box.max.x:box.min.x;p1.y=plane.normal.y>0?box.min.y:box.max.y;p2.y=plane.normal.y>0?box.max.y:box.min.y;p1.z=plane.normal.z>0?box.min.z:box.max.z;p2.z=plane.normal.z>0?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1);var d2=plane.distanceToPoint(p2);if(d1<0&&d2<0){return false}}return true}}(),containsPoint:function(point){var planes=this.planes;for(var i=0;i<6;i++){if(planes[i].distanceToPoint(point)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(normal,constant){this.normal=normal!==undefined?normal:new THREE.Vector3(1,0,0);this.constant=constant!==undefined?constant:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(normal,constant){this.normal.copy(normal);this.constant=constant;return this},setComponents:function(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this},setFromNormalAndCoplanarPoint:function(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this},setFromCoplanarPoints:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(normal,a);return this}}(),copy:function(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this},normalize:function(){var inverseNormalLength=1/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,optionalTarget){return this.orthoPoint(point,optionalTarget).sub(point).negate()},orthoPoint:function(point,optionalTarget){var perpendicularMagnitude=this.distanceToPoint(point);var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(perpendicularMagnitude)},isIntersectionLine:function(line){var startSign=this.distanceToPoint(line.start);var endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0},intersectLine:function(){var v1=new THREE.Vector3;return function(line,optionalTarget){var result=optionalTarget||new THREE.Vector3;var direction=line.delta(v1);var denominator=this.normal.dot(direction);if(denominator==0){if(this.distanceToPoint(line.start)==0){return result.copy(line.start)}return undefined}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(t<0||t>1){return undefined}return result.copy(direction).multiplyScalar(t).add(line.start)}}(),coplanarPoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var m1=new THREE.Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix);var newNormal=v1.copy(this.normal).applyMatrix3(normalMatrix);var newCoplanarPoint=this.coplanarPoint(v2);newCoplanarPoint.applyMatrix4(matrix);this.setFromNormalAndCoplanarPoint(newNormal,newCoplanarPoint);return this}}(),translate:function(offset){this.constant=this.constant-offset.dot(this.normal);return this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var uuid=new Array(36);var rnd=0,r;return function(){for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){uuid[i]="-"}else if(i==14){uuid[i]="4"}else{if(rnd<=2)rnd=33554432+Math.random()*16777216|0;r=rnd&15;rnd=rnd>>4;uuid[i]=chars[i==19?r&3|8:r]}}return uuid.join("")}}(),clamp:function(x,a,b){return x<a?a:x>b?b:x},clampBottom:function(x,a){return x<a?a:x},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},smoothstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(low,high){return Math.floor(this.randFloat(low,high))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(degrees){return degrees*degreeToRadiansFactor}}(),radToDeg:function(){var radianToDegreesFactor=180/Math.PI;return function(radians){return radians*radianToDegreesFactor}}(),isPowerOfTwo:function(value){return(value&value-1)===0&&value!==0},nextPowerOfTwo:function(value){value--;value|=value>>1;value|=value>>2;value|=value>>4;value|=value>>8;value|=value>>16;value++;return value}};THREE.Spline=function(points){this.points=points;var c=[],v3={x:0,y:0,z:0},point,intPoint,weight,w2,w3,pa,pb,pc,pd;this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++){this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}}};this.getPoint=function(k){point=(this.points.length-1)*k;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1;c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2;pa=this.points[c[0]];pb=this.points[c[1]];pc=this.points[c[2]];pd=this.points[c[3]];w2=weight*weight;w3=weight*w2;v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3);v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3);v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3);return v3};this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++){p=this.points[i];coords[i]=[p.x,p.y,p.z]}return coords};this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new THREE.Vector3,tmpVec=new THREE.Vector3,chunkLengths=[],totalLength=0;chunkLengths[0]=0;if(!nSubDivisions)nSubDivisions=100;nSamples=this.points.length*nSubDivisions;oldPosition.copy(this.points[0]);for(i=1;i<nSamples;i++){index=i/nSamples;position=this.getPoint(index);tmpVec.copy(position);totalLength+=tmpVec.distanceTo(oldPosition);oldPosition.copy(position);point=(this.points.length-1)*index;intPoint=Math.floor(point);if(intPoint!=oldIntPoint){chunkLengths[intPoint]=totalLength;oldIntPoint=intPoint}}chunkLengths[chunkLengths.length]=totalLength;return{chunks:chunkLengths,total:totalLength}};this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,realDistance,sampling,position,newpoints=[],tmpVec=new THREE.Vector3,sl=this.getLength();newpoints.push(tmpVec.copy(this.points[0]).clone());for(i=1;i<this.points.length;i++){realDistance=sl.chunks[i]-sl.chunks[i-1];sampling=Math.ceil(samplingCoef*realDistance/sl.total);indexCurrent=(i-1)/(this.points.length-1);indexNext=i/(this.points.length-1);for(j=1;j<sampling-1;j++){index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent);position=this.getPoint(index);newpoints.push(tmpVec.copy(position).clone())}newpoints.push(tmpVec.copy(this.points[i]).clone())}this.points=newpoints};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}};THREE.Triangle=function(a,b,c){this.a=a!==undefined?a:new THREE.Vector3;this.b=b!==undefined?b:new THREE.Vector3;this.c=c!==undefined?c:new THREE.Vector3};THREE.Triangle.normal=function(){var v0=new THREE.Vector3;return function(a,b,c,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(resultLengthSq>0){return result.multiplyScalar(1/Math.sqrt(resultLengthSq))}return result.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var denom=dot00*dot11-dot01*dot01;var result=optionalTarget||new THREE.Vector3;if(denom==0){return result.set(-2,-1,-1)}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}();THREE.Triangle.containsPoint=function(){var v1=new THREE.Vector3;return function(point,a,b,c){var result=THREE.Triangle.barycoordFromPoint(point,a,b,c,v1);return result.x>=0&&result.y>=0&&result.x+result.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this},copy:function(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this},area:function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;return function(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return v0.cross(v1).length()*.5}}(),midpoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(optionalTarget){return THREE.Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function(optionalTarget){var result=optionalTarget||new THREE.Plane;return result.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(point,optionalTarget){return THREE.Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function(point){return THREE.Triangle.containsPoint(point,this.a,this.b,this.c)},equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(autoStart){this.autoStart=autoStart!==undefined?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var newTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();diff=.001*(newTime-this.oldTime);this.oldTime=newTime;this.elapsedTime+=diff}return diff}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(object){object.addEventListener=THREE.EventDispatcher.prototype.addEventListener;object.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;object.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;object.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){if(this._listeners===undefined)this._listeners={};var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}},hasEventListener:function(type,listener){if(this._listeners===undefined)return false;var listeners=this._listeners;if(listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1){return true}return false},removeEventListener:function(type,listener){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[type];if(listenerArray!==undefined){var index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;var array=[];var length=listenerArray.length;for(var i=0;i<length;i++){array[i]=listenerArray[i]}for(var i=0;i<length;i++){array[i].call(this,event)}}}};(function(THREE){THREE.Raycaster=function(origin,direction,near,far){this.ray=new THREE.Ray(origin,direction);this.near=near||0;this.far=far||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var descSort=function(a,b){return a.distance-b.distance};var intersectObject=function(object,raycaster,intersects,recursive){object.raycast(raycaster,intersects);if(recursive===true){var children=object.children;for(var i=0,l=children.length;i<l;i++){intersectObject(children[i],raycaster,intersects,true)}}};THREE.Raycaster.prototype={constructor:THREE.Raycaster,precision:1e-4,linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},setFromCamera:function(coords,camera){if(camera instanceof THREE.PerspectiveCamera){this.ray.origin.copy(camera.position);this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(camera.position).normalize()}else if(camera instanceof THREE.OrthographicCamera){this.ray.origin.set(coords.x,coords.y,-1).unproject(camera);this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)}else{THREE.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(object,recursive){var intersects=[];intersectObject(object,this,intersects,recursive);intersects.sort(descSort);return intersects},intersectObjects:function(objects,recursive){var intersects=[];if(objects instanceof Array===false){THREE.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return intersects}for(var i=0,l=objects.length;i<l;i++){intersectObject(objects[i],this,intersects,recursive)}intersects.sort(descSort);return intersects}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var position=new THREE.Vector3;var rotation=new THREE.Euler;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3(1,1,1);var onRotationChange=function(){quaternion.setFromEuler(rotation,false)};var onQuaternionChange=function(){rotation.setFromQuaternion(quaternion,undefined,false)};rotation.onChange(onRotationChange);quaternion.onChange(onQuaternionChange);Object.defineProperties(this,{position:{enumerable:true,value:position},rotation:{enumerable:true,value:rotation},quaternion:{enumerable:true,value:quaternion},scale:{enumerable:true,value:scale}});this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(value){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=value},get useQuaternion(){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(value){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,true)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(){var q1=new THREE.Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this}}(),rotateX:function(){var v1=new THREE.Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new THREE.Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new THREE.Vector3;return function(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this}}(),translate:function(distance,axis){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(axis,distance)},translateX:function(){var v1=new THREE.Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new THREE.Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var m1=new THREE.Matrix4;return function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}}(),lookAt:function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(vector,this.position,this.up);this.quaternion.setFromRotationMatrix(m1)}}(),add:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(object===this){THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",object);return this}if(object instanceof THREE.Object3D){if(object.parent!==undefined){object.parent.remove(object)}object.parent=this;object.dispatchEvent({type:"added"});this.children.push(object)}else{THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object)}return this},remove:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}}var index=this.children.indexOf(object);if(index!==-1){object.parent=undefined;object.dispatchEvent({type:"removed"});this.children.splice(index,1)}},getChildByName:function(name){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(name)},getObjectById:function(id){return this.getObjectByProperty("id",id)},getObjectByName:function(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];var object=child.getObjectByProperty(name,value);if(object!==undefined){return object}}return undefined},getWorldPosition:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);return result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var position=new THREE.Vector3;var scale=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,result,scale);return result}}(),getWorldRotation:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Euler;this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,false)}}(),getWorldScale:function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,quaternion,result);return result}}(),getWorldDirection:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function(){},traverse:function(callback){callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverse(callback)}},traverseVisible:function(callback){if(this.visible===false)return;callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverseVisible(callback)}},traverseAncestors:function(callback){if(this.parent){callback(this.parent);this.parent.traverseAncestors(callback)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(force){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||force===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}},toJSON:function(){var output={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var geometries={};var parseGeometry=function(geometry){if(output.geometries===undefined){output.geometries=[]}if(geometries[geometry.uuid]===undefined){var json=geometry.toJSON();delete json.metadata;geometries[geometry.uuid]=json;output.geometries.push(json)}return geometry.uuid};var materials={};var parseMaterial=function(material){if(output.materials===undefined){output.materials=[]}if(materials[material.uuid]===undefined){var json=material.toJSON();delete json.metadata;materials[material.uuid]=json;output.materials.push(json)}return material.uuid};var parseObject=function(object){var data={};data.uuid=object.uuid;data.type=object.type;if(object.name!=="")data.name=object.name;if(JSON.stringify(object.userData)!=="{}")data.userData=object.userData;if(object.visible!==true)data.visible=object.visible;if(object instanceof THREE.PerspectiveCamera){data.fov=object.fov;data.aspect=object.aspect;data.near=object.near;data.far=object.far}else if(object instanceof THREE.OrthographicCamera){data.left=object.left;data.right=object.right;data.top=object.top;data.bottom=object.bottom;data.near=object.near;data.far=object.far}else if(object instanceof THREE.AmbientLight){data.color=object.color.getHex()}else if(object instanceof THREE.DirectionalLight){data.color=object.color.getHex();data.intensity=object.intensity}else if(object instanceof THREE.PointLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance;data.decay=object.decay}else if(object instanceof THREE.SpotLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance;data.angle=object.angle;data.exponent=object.exponent;data.decay=object.decay}else if(object instanceof THREE.HemisphereLight){data.color=object.color.getHex();data.groundColor=object.groundColor.getHex()}else if(object instanceof THREE.Mesh||object instanceof THREE.Line||object instanceof THREE.PointCloud){data.geometry=parseGeometry(object.geometry);data.material=parseMaterial(object.material);if(object instanceof THREE.Line)data.mode=object.mode}else if(object instanceof THREE.Sprite){data.material=parseMaterial(object.material)}data.matrix=object.matrix.toArray();if(object.children.length>0){data.children=[];for(var i=0;i<object.children.length;i++){data.children.push(parseObject(object.children[i]))}}return data};output.object=parseObject(this);return output},clone:function(object,recursive){if(object===undefined)object=new THREE.Object3D;if(recursive===undefined)recursive=true;object.name=this.name;object.up.copy(this.up);object.position.copy(this.position);object.quaternion.copy(this.quaternion);object.scale.copy(this.scale);object.rotationAutoUpdate=this.rotationAutoUpdate;object.matrix.copy(this.matrix);object.matrixWorld.copy(this.matrixWorld);object.matrixAutoUpdate=this.matrixAutoUpdate;object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;object.visible=this.visible;object.castShadow=this.castShadow;object.receiveShadow=this.receiveShadow;object.frustumCulled=this.frustumCulled;object.userData=JSON.parse(JSON.stringify(this.userData));if(recursive===true){for(var i=0;i<this.children.length;i++){var child=this.children[i];object.add(child.clone())}}return object}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3;this.vertexNormals=normal instanceof Array?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color;this.vertexColors=color instanceof Array?color:[];this.vertexTangents=[];this.materialIndex=materialIndex!==undefined?materialIndex:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var face=new THREE.Face3(this.a,this.b,this.c);face.normal.copy(this.normal);face.color.copy(this.color);face.materialIndex=this.materialIndex;for(var i=0,il=this.vertexNormals.length;i<il;i++){face.vertexNormals[i]=this.vertexNormals[i].clone()}for(var i=0,il=this.vertexColors.length;i<il;i++){face.vertexColors[i]=this.vertexColors[i].clone()}for(var i=0,il=this.vertexTangents.length;i<il;i++){face.vertexTangents[i]=this.vertexTangents[i].clone()}return face}};THREE.Face4=function(a,b,c,d,normal,color,materialIndex){THREE.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,normal,color,materialIndex)};THREE.BufferAttribute=function(array,itemSize){this.array=array;this.itemSize=itemSize;this.needsUpdate=false};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(index1,attribute,index2){index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},set:function(value,offset){if(offset===undefined)offset=0;this.array.set(value,offset);return this},setX:function(index,x){this.array[index*this.itemSize]=x;return this},setY:function(index,y){this.array[index*this.itemSize+1]=y;return this},setZ:function(index,z){this.array[index*this.itemSize+2]=z;return this},setXY:function(index,x,y){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;return this},setXYZ:function(index,x,y,z){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;return this},setXYZW:function(index,x,y,z,w){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(data,itemSize){THREE.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8Attribute=function(data,itemSize){THREE.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8ClampedAttribute=function(data,itemSize){THREE.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int16Attribute=function(data,itemSize){THREE.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");
return new THREE.BufferAttribute(data,itemSize)};THREE.Uint16Attribute=function(data,itemSize){THREE.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int32Attribute=function(data,itemSize){THREE.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint32Attribute=function(data,itemSize){THREE.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float32Attribute=function(data,itemSize){THREE.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float64Attribute=function(data,itemSize){THREE.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.DynamicBufferAttribute=function(array,itemSize){THREE.BufferAttribute.call(this,array,itemSize);this.updateRange={offset:0,count:-1}};THREE.DynamicBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.DynamicBufferAttribute.prototype.constructor=THREE.DynamicBufferAttribute;THREE.DynamicBufferAttribute.prototype.clone=function(){return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(name,attribute){if(attribute instanceof THREE.BufferAttribute===false){THREE.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[name]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[name]=attribute;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(name){return this.attributes[name]},addDrawCall:function(start,count,indexOffset){this.drawcalls.push({start:start,count:count,index:indexOffset!==undefined?indexOffset:0})},applyMatrix:function(matrix){var position=this.attributes.position;if(position!==undefined){matrix.applyToVector3Array(position.array);position.needsUpdate=true}var normal=this.attributes.normal;if(normal!==undefined){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);normalMatrix.applyToVector3Array(normal.array);normal.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(offset));return offset},fromGeometry:function(geometry,settings){settings=settings||{vertexColors:THREE.NoColors};var vertices=geometry.vertices;var faces=geometry.faces;var faceVertexUvs=geometry.faceVertexUvs;var vertexColors=settings.vertexColors;var hasFaceVertexUv=faceVertexUvs[0].length>0;var hasFaceVertexNormals=faces[0].vertexNormals.length==3;var positions=new Float32Array(faces.length*3*3);this.addAttribute("position",new THREE.BufferAttribute(positions,3));var normals=new Float32Array(faces.length*3*3);this.addAttribute("normal",new THREE.BufferAttribute(normals,3));if(vertexColors!==THREE.NoColors){var colors=new Float32Array(faces.length*3*3);this.addAttribute("color",new THREE.BufferAttribute(colors,3))}if(hasFaceVertexUv===true){var uvs=new Float32Array(faces.length*3*2);this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))}for(var i=0,i2=0,i3=0;i<faces.length;i++,i2+=6,i3+=9){var face=faces[i];var a=vertices[face.a];var b=vertices[face.b];var c=vertices[face.c];positions[i3]=a.x;positions[i3+1]=a.y;positions[i3+2]=a.z;positions[i3+3]=b.x;positions[i3+4]=b.y;positions[i3+5]=b.z;positions[i3+6]=c.x;positions[i3+7]=c.y;positions[i3+8]=c.z;if(hasFaceVertexNormals===true){var na=face.vertexNormals[0];var nb=face.vertexNormals[1];var nc=face.vertexNormals[2];normals[i3]=na.x;normals[i3+1]=na.y;normals[i3+2]=na.z;normals[i3+3]=nb.x;normals[i3+4]=nb.y;normals[i3+5]=nb.z;normals[i3+6]=nc.x;normals[i3+7]=nc.y;normals[i3+8]=nc.z}else{var n=face.normal;normals[i3]=n.x;normals[i3+1]=n.y;normals[i3+2]=n.z;normals[i3+3]=n.x;normals[i3+4]=n.y;normals[i3+5]=n.z;normals[i3+6]=n.x;normals[i3+7]=n.y;normals[i3+8]=n.z}if(vertexColors===THREE.FaceColors){var fc=face.color;colors[i3]=fc.r;colors[i3+1]=fc.g;colors[i3+2]=fc.b;colors[i3+3]=fc.r;colors[i3+4]=fc.g;colors[i3+5]=fc.b;colors[i3+6]=fc.r;colors[i3+7]=fc.g;colors[i3+8]=fc.b}else if(vertexColors===THREE.VertexColors){var vca=face.vertexColors[0];var vcb=face.vertexColors[1];var vcc=face.vertexColors[2];colors[i3]=vca.r;colors[i3+1]=vca.g;colors[i3+2]=vca.b;colors[i3+3]=vcb.r;colors[i3+4]=vcb.g;colors[i3+5]=vcb.b;colors[i3+6]=vcc.r;colors[i3+7]=vcc.g;colors[i3+8]=vcc.b}if(hasFaceVertexUv===true){var uva=faceVertexUvs[0][i][0];var uvb=faceVertexUvs[0][i][1];var uvc=faceVertexUvs[0][i][2];uvs[i2]=uva.x;uvs[i2+1]=uva.y;uvs[i2+2]=uvb.x;uvs[i2+3]=uvb.y;uvs[i2+4]=uvc.x;uvs[i2+5]=uvc.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var vector=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var positions=this.attributes.position.array;if(positions){var bb=this.boundingBox;bb.makeEmpty();for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);bb.expandByPoint(vector)}}if(positions===undefined||positions.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var box=new THREE.Box3;var vector=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var positions=this.attributes.position.array;if(positions){box.makeEmpty();var center=this.boundingSphere.center;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);box.expandByPoint(vector)}box.center(center);var maxRadiusSq=0;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector))}this.boundingSphere.radius=Math.sqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var attributes=this.attributes;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(positions.length),3))}else{var normals=attributes.normal.array;for(var i=0,il=normals.length;i<il;i++){normals[i]=0}}var normals=attributes.normal.array;var vA,vB,vC,pA=new THREE.Vector3,pB=new THREE.Vector3,pC=new THREE.Vector3,cb=new THREE.Vector3,ab=new THREE.Vector3;if(attributes.index){var indices=attributes.index.array;var offsets=this.offsets.length>0?this.offsets:[{start:0,count:indices.length,index:0}];for(var j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(var i=start,il=start+count;i<il;i+=3){vA=(index+indices[i])*3;vB=(index+indices[i+1])*3;vC=(index+indices[i+2])*3;pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z}}}else{for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z}}this.normalizeNormals();attributes.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var indices=this.attributes.index.array;var positions=this.attributes.position.array;var normals=this.attributes.normal.array;var uvs=this.attributes.uv.array;var nVertices=positions.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*nVertices),4))}var tangents=this.attributes.tangent.array;var tan1=[],tan2=[];for(var k=0;k<nVertices;k++){tan1[k]=new THREE.Vector3;tan2[k]=new THREE.Vector3}var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r;var sdir=new THREE.Vector3,tdir=new THREE.Vector3;function handleTriangle(a,b,c){vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);uvA.fromArray(uvs,a*2);uvB.fromArray(uvs,b*2);uvC.fromArray(uvs,c*2);x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}var i,il;var j,jl;var iA,iB,iC;if(this.drawcalls.length===0){this.addDrawCall(0,indices.length,0)}var drawcalls=this.drawcalls;for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleTriangle(iA,iB,iC)}}var tmp=new THREE.Vector3,tmp2=new THREE.Vector3;var n=new THREE.Vector3,n2=new THREE.Vector3;var w,t,test;function handleVertex(v){n.fromArray(normals,v*3);n2.copy(n);t=tan1[v];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(n2,t);test=tmp2.dot(tan2[v]);w=test<0?-1:1;tangents[v*4]=tmp.x;tangents[v*4+1]=tmp.y;tangents[v*4+2]=tmp.z;tangents[v*4+3]=w}for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleVertex(iA);handleVertex(iB);handleVertex(iC)}}},computeOffsets:function(size){if(size===undefined)size=65535;var indices=this.attributes.index.array;var vertices=this.attributes.position.array;var facesCount=indices.length/3;var sortedIndices=new Uint16Array(indices.length);var indexPtr=0;var vertexPtr=0;var offsets=[{start:0,count:0,index:0}];var offset=offsets[0];var duplicatedVertices=0;var newVerticeMaps=0;var faceVertices=new Int32Array(6);var vertexMap=new Int32Array(vertices.length);var revVertexMap=new Int32Array(vertices.length);for(var j=0;j<vertices.length;j++){vertexMap[j]=-1;revVertexMap[j]=-1}for(var findex=0;findex<facesCount;findex++){newVerticeMaps=0;for(var vo=0;vo<3;vo++){var vid=indices[findex*3+vo];if(vertexMap[vid]==-1){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;newVerticeMaps++}else if(vertexMap[vid]<offset.index){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;duplicatedVertices++}else{faceVertices[vo*2]=vid;faceVertices[vo*2+1]=vertexMap[vid]}}var faceMax=vertexPtr+newVerticeMaps;if(faceMax>offset.index+size){var new_offset={start:indexPtr,count:0,index:vertexPtr};offsets.push(new_offset);offset=new_offset;for(var v=0;v<6;v+=2){var new_vid=faceVertices[v+1];if(new_vid>-1&&new_vid<offset.index)faceVertices[v+1]=-1}}for(var v=0;v<6;v+=2){var vid=faceVertices[v];var new_vid=faceVertices[v+1];if(new_vid===-1)new_vid=vertexPtr++;vertexMap[vid]=new_vid;revVertexMap[new_vid]=vid;sortedIndices[indexPtr++]=new_vid-offset.index;offset.count++}}this.reorderBuffers(sortedIndices,revVertexMap,vertexPtr);this.offsets=offsets;this.drawcalls=offsets;return offsets},merge:function(geometry,offset){if(geometry instanceof THREE.BufferGeometry===false){THREE.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry);return}if(offset===undefined)offset=0;var attributes=this.attributes;for(var key in attributes){if(geometry.attributes[key]===undefined)continue;var attribute1=attributes[key];var attributeArray1=attribute1.array;var attribute2=geometry.attributes[key];var attributeArray2=attribute2.array;var attributeSize=attribute2.itemSize;for(var i=0,j=attributeSize*offset;i<attributeArray2.length;i++,j++){attributeArray1[j]=attributeArray2[i]}}return this},normalizeNormals:function(){var normals=this.attributes.normal.array;var x,y,z,n;for(var i=0,il=normals.length;i<il;i+=3){x=normals[i];y=normals[i+1];z=normals[i+2];n=1/Math.sqrt(x*x+y*y+z*z);normals[i]*=n;normals[i+1]*=n;normals[i+2]*=n}},reorderBuffers:function(indexBuffer,indexMap,vertexCount){var sortedAttributes={};for(var attr in this.attributes){if(attr=="index")continue;var sourceArray=this.attributes[attr].array;sortedAttributes[attr]=new sourceArray.constructor(this.attributes[attr].itemSize*vertexCount)}for(var new_vid=0;new_vid<vertexCount;new_vid++){var vid=indexMap[new_vid];for(var attr in this.attributes){if(attr=="index")continue;var attrArray=this.attributes[attr].array;var attrSize=this.attributes[attr].itemSize;var sortedAttr=sortedAttributes[attr];for(var k=0;k<attrSize;k++)sortedAttr[new_vid*attrSize+k]=attrArray[vid*attrSize+k]}}this.attributes["index"].array=indexBuffer;for(var attr in this.attributes){if(attr=="index")continue;this.attributes[attr].array=sortedAttributes[attr];this.attributes[attr].numItems=this.attributes[attr].itemSize*vertexCount}},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var attributes=this.attributes;var offsets=this.offsets;var boundingSphere=this.boundingSphere;for(var key in attributes){var attribute=attributes[key];var array=Array.prototype.slice.call(attribute.array);output.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array}}if(offsets.length>0){output.data.offsets=JSON.parse(JSON.stringify(offsets))}if(boundingSphere!==null){output.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}}return output},clone:function(){var geometry=new THREE.BufferGeometry;for(var attr in this.attributes){var sourceAttr=this.attributes[attr];geometry.addAttribute(attr,sourceAttr.clone())}for(var i=0,il=this.offsets.length;i<il;i++){var offset=this.offsets[i];geometry.offsets.push({start:offset.start,index:offset.index,count:offset.count})}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(matrix){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this.vertices[i];vertex.applyMatrix4(matrix)}for(var i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},fromBufferGeometry:function(geometry){var scope=this;var attributes=geometry.attributes;var vertices=attributes.position.array;var indices=attributes.index!==undefined?attributes.index.array:undefined;var normals=attributes.normal!==undefined?attributes.normal.array:undefined;var colors=attributes.color!==undefined?attributes.color.array:undefined;var uvs=attributes.uv!==undefined?attributes.uv.array:undefined;var tempNormals=[];var tempUVs=[];for(var i=0,j=0;i<vertices.length;i+=3,j+=2){scope.vertices.push(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]));if(normals!==undefined){tempNormals.push(new THREE.Vector3(normals[i],normals[i+1],normals[i+2]))}if(colors!==undefined){scope.colors.push(new THREE.Color(colors[i],colors[i+1],colors[i+2]))}if(uvs!==undefined){tempUVs.push(new THREE.Vector2(uvs[j],uvs[j+1]))}}var addFace=function(a,b,c){var vertexNormals=normals!==undefined?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[];var vertexColors=colors!==undefined?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[];scope.faces.push(new THREE.Face3(a,b,c,vertexNormals,vertexColors));if(uvs!==undefined){scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()])}};if(indices!==undefined){var drawcalls=geometry.drawcalls;if(drawcalls.length>0){for(var i=0;i<drawcalls.length;i++){var drawcall=drawcalls[i];var start=drawcall.start;var count=drawcall.count;var index=drawcall.index;for(var j=start,jl=start+count;j<jl;j+=3){addFace(index+indices[j],index+indices[j+1],index+indices[j+2])}}}else{for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2])}}}else{for(var i=0;i<vertices.length/3;i+=3){addFace(i,i+1,i+2)}}this.computeFaceNormals();if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(offset));return offset},computeFaceNormals:function(){var cb=new THREE.Vector3,ab=new THREE.Vector3;for(var f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f];var vA=this.vertices[face.a];var vB=this.vertices[face.b];var vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;vertices=new Array(this.vertices.length);for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new THREE.Vector3}if(areaWeighted){var vA,vB,vC;var cb=new THREE.Vector3,ab=new THREE.Vector3;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb)}}else{for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal)}}for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize()}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.vertexNormals[0]=vertices[face.a].clone();face.vertexNormals[1]=vertices[face.b].clone();face.vertexNormals[2]=vertices[face.c].clone()}},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone()}else{face.__originalFaceNormal.copy(face.normal)}if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone()}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i])}}}var tmpGeo=new THREE.Geometry;tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals;var dstNormalsVertex=this.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){faceNormal=new THREE.Vector3;vertexNormals={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals)}}var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2])}}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals}},computeTangents:function(){var f,fl,v,vl,i,vertexIndex,face,uv,vA,vB,vC,uvA,uvB,uvC,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r,t,test,tan1=[],tan2=[],sdir=new THREE.Vector3,tdir=new THREE.Vector3,tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,w;for(v=0,vl=this.vertices.length;v<vl;v++){tan1[v]=new THREE.Vector3;tan2[v]=new THREE.Vector3}function handleTriangle(context,a,b,c,ua,ub,uc){vA=context.vertices[a];vB=context.vertices[b];vC=context.vertices[c];uvA=uv[ua];uvB=uv[ub];uvC=uv[uc];x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];uv=this.faceVertexUvs[0][f];handleTriangle(this,face.a,face.b,face.c,0,1,2)}var faceIndex=["a","b","c","d"];for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];for(i=0;i<Math.min(face.vertexNormals.length,3);i++){n.copy(face.vertexNormals[i]);vertexIndex=face[faceIndex[i]];t=tan1[vertexIndex];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(face.vertexNormals[i],t);test=tmp2.dot(tan2[vertexIndex]);w=test<0?-1:1;face.vertexTangents[i]=new THREE.Vector4(tmp.x,tmp.y,tmp.z,w)}}this.hasTangents=true},computeLineDistances:function(){var d=0;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){if(i>0){d+=vertices[i].distanceTo(vertices[i-1])}this.lineDistances[i]=d}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(geometry instanceof THREE.Geometry===false){THREE.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry);return}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0];if(materialIndexOffset===undefined)materialIndexOffset=0;if(matrix!==undefined){normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix)}for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix!==undefined)vertexCopy.applyMatrix4(matrix);vertices1.push(vertexCopy)}for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new THREE.Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==undefined){faceCopy.normal.applyMatrix3(normalMatrix).normalize()}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==undefined){normal.applyMatrix3(normalMatrix).normalize()}faceCopy.vertexNormals.push(normal)}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone())}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===undefined){continue}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(uv[j].clone())}uvs1.push(uvCopy)}},mergeMesh:function(mesh){if(mesh instanceof THREE.Mesh===false){THREE.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh);return}mesh.matrixAutoUpdate&&mesh.updateMatrix();this.merge(mesh.geometry,mesh.matrix)},mergeVertices:function(){var verticesMap={};var unique=[],changes=[];var v,key;var precisionPoints=4;var precision=Math.pow(10,precisionPoints);var i,il,face;var indices,j,jl;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision);if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1}else{changes[i]=changes[verticesMap[key]]}}var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];var dupIndex=-1;for(var n=0;n<3;n++){if(indices[n]==indices[(n+1)%3]){dupIndex=n;faceIndicesToRemove.push(i);break}}}for(i=faceIndicesToRemove.length-1;i>=0;i--){var idx=faceIndicesToRemove[i];this.faces.splice(idx,1);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){this.faceVertexUvs[j].splice(idx,1)}}var diff=this.vertices.length-unique.length;this.vertices=unique;return diff},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined)output[key]=parameters[key]}return output}var vertices=[];for(var i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[];var normals=[];var normalsHash={};var colors=[];var colorsHash={};var uvs=[];var uvsHash={};for(var i=0;i<this.faces.length;i++){var face=this.faces[i];var hasMaterial=false;var hasFaceUv=false;var hasFaceVertexUv=this.faceVertexUvs[0][i]!==undefined;var hasFaceNormal=face.normal.length()>0;var hasFaceVertexNormal=face.vertexNormals.length>0;var hasFaceColor=face.color.r!==1||face.color.g!==1||face.color.b!==1;var hasFaceVertexColor=face.vertexColors.length>0;var faceType=0;faceType=setBit(faceType,0,0);faceType=setBit(faceType,1,hasMaterial);faceType=setBit(faceType,2,hasFaceUv);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);if(hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal){faces.push(getNormalIndex(face.normal))}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor){faces.push(getColorIndex(face.color))}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==undefined){return normalsHash[hash]}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==undefined){return colorsHash[hash]}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==undefined){return uvsHash[hash]}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash]}output.data={};output.data.vertices=vertices;output.data.normals=normals;if(colors.length>0)output.data.colors=colors;if(uvs.length>0)output.data.uvs=[uvs];output.data.faces=faces;return output},clone:function(){var geometry=new THREE.Geometry;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){geometry.vertices.push(vertices[i].clone())}var faces=this.faces;for(var i=0,il=faces.length;i<il;i++){geometry.faces.push(faces[i].clone())}for(var i=0,il=this.faceVertexUvs.length;i<il;i++){var faceVertexUvs=this.faceVertexUvs[i];if(geometry.faceVertexUvs[i]===undefined){geometry.faceVertexUvs[i]=[]}for(var j=0,jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(var k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}geometry.faceVertexUvs[i].push(uvsCopy)}}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion)}}();THREE.Camera.prototype.lookAt=function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(this.position,vector,this.up);this.quaternion.setFromRotationMatrix(m1)}}();THREE.Camera.prototype.clone=function(camera){if(camera===undefined)camera=new THREE.Camera;THREE.Object3D.prototype.clone.call(this,camera);camera.matrixWorldInverse.copy(this.matrixWorldInverse);camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.CubeCamera=function(near,far,cubeResolution){THREE.Object3D.call(this);this.type="CubeCamera";var fov=90,aspect=1;var cameraPX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new THREE.Vector3(1,0,0));this.add(cameraPX);var cameraNX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);
cameraNX.lookAt(new THREE.Vector3((-1),0,0));this.add(cameraNX);var cameraPY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new THREE.Vector3(0,1,0));this.add(cameraPY);var cameraNY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new THREE.Vector3(0,(-1),0));this.add(cameraNY);var cameraPZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new THREE.Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new THREE.Vector3(0,0,(-1)));this.add(cameraNZ);this.renderTarget=new THREE.WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(renderer,scene){var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.generateMipmaps;renderTarget.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(left,right,top,bottom,near,far){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var dx=(this.right-this.left)/(2*this.zoom);var dy=(this.top-this.bottom)/(2*this.zoom);var cx=(this.right+this.left)/2;var cy=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(cx-dx,cx+dx,cy+dy,cy-dy,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var camera=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.left=this.left;camera.right=this.right;camera.top=this.top;camera.bottom=this.bottom;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.PerspectiveCamera=function(fov,aspect,near,far){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=fov!==undefined?fov:50;this.aspect=aspect!==undefined?aspect:1;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;this.fov=2*THREE.Math.radToDeg(Math.atan(frameHeight/(focalLength*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){this.fullWidth=fullWidth;this.fullHeight=fullHeight;this.x=x;this.y=y;this.width=width;this.height=height;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var fov=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var aspect=this.fullWidth/this.fullHeight;var top=Math.tan(THREE.Math.degToRad(fov*.5))*this.near;var bottom=-top;var left=aspect*bottom;var right=aspect*top;var width=Math.abs(right-left);var height=Math.abs(top-bottom);this.projectionMatrix.makeFrustum(left+this.x*width/this.fullWidth,left+(this.x+this.width)*width/this.fullWidth,top-(this.y+this.height)*height/this.fullHeight,top-this.y*height/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(fov,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var camera=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.fov=this.fov;camera.aspect=this.aspect;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.Light=function(color){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(color)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.clone=function(light){if(light===undefined)light=new THREE.Light;THREE.Object3D.prototype.clone.call(this,light);light.color.copy(this.color);return light};THREE.AmbientLight=function(color){THREE.Light.call(this,color);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.clone=function(){var light=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,light);return light};THREE.AreaLight=function(color,intensity){THREE.Light.call(this,color);this.type="AreaLight";this.normal=new THREE.Vector3(0,(-1),0);this.right=new THREE.Vector3(1,0,0);this.intensity=intensity!==undefined?intensity:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.AreaLight.prototype.constructor=THREE.AreaLight;THREE.DirectionalLight=function(color,intensity){THREE.Light.call(this,color);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,(-1e3));this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.DirectionalLight.prototype.clone=function(){var light=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraLeft=this.shadowCameraLeft;light.shadowCameraRight=this.shadowCameraRight;light.shadowCameraTop=this.shadowCameraTop;light.shadowCameraBottom=this.shadowCameraBottom;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;light.shadowCascade=this.shadowCascade;light.shadowCascadeOffset.copy(this.shadowCascadeOffset);light.shadowCascadeCount=this.shadowCascadeCount;light.shadowCascadeBias=this.shadowCascadeBias.slice(0);light.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);light.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);light.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);light.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return light};THREE.HemisphereLight=function(skyColor,groundColor,intensity){THREE.Light.call(this,skyColor);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(groundColor);this.intensity=intensity!==undefined?intensity:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;THREE.HemisphereLight.prototype.clone=function(){var light=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,light);light.groundColor.copy(this.groundColor);light.intensity=this.intensity;return light};THREE.PointLight=function(color,intensity,distance,decay){THREE.Light.call(this,color);this.type="PointLight";this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.decay=decay!==undefined?decay:1};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.PointLight.prototype.clone=function(){var light=new THREE.PointLight;THREE.Light.prototype.clone.call(this,light);light.intensity=this.intensity;light.distance=this.distance;light.decay=this.decay;return light};THREE.SpotLight=function(color,intensity,distance,angle,exponent,decay){THREE.Light.call(this,color);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.angle=angle!==undefined?angle:Math.PI/3;this.exponent=exponent!==undefined?exponent:10;this.decay=decay!==undefined?decay:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.SpotLight.prototype.clone=function(){var light=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.distance=this.distance;light.angle=this.angle;light.exponent=this.exponent;light.decay=this.decay;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraFov=this.shadowCameraFov;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;return light};THREE.Cache={files:{},add:function(key,file){this.files[key]=file},get:function(key){return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};THREE.Loader=function(showStatus){this.showStatus=showStatus;this.statusDomElement=showStatus?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(progress){var message="Loaded ";if(progress.total){message+=(100*progress.loaded/progress.total).toFixed(0)+"%"}else{message+=(progress.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=message},extractUrlBase:function(url){var parts=url.split("/");if(parts.length===1)return"./";parts.pop();return parts.join("/")+"/"},initMaterials:function(materials,texturePath){var array=[];for(var i=0;i<materials.length;++i){array[i]=this.createMaterial(materials[i],texturePath)}return array},needsTangents:function(materials){for(var i=0,il=materials.length;i<il;i++){var m=materials[i];if(m instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(m,texturePath){var scope=this;function nearest_pow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l))}function create_texture(where,name,sourceFile,repeat,offset,wrap,anisotropy){var fullPath=texturePath+sourceFile;var texture;var loader=THREE.Loader.Handlers.get(fullPath);if(loader!==null){texture=loader.load(fullPath)}else{texture=new THREE.Texture;loader=scope.imageLoader;loader.crossOrigin=scope.crossOrigin;loader.load(fullPath,function(image){if(THREE.Math.isPowerOfTwo(image.width)===false||THREE.Math.isPowerOfTwo(image.height)===false){var width=nearest_pow2(image.width);var height=nearest_pow2(image.height);var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0,width,height);texture.image=canvas}else{texture.image=image}texture.needsUpdate=true})}texture.sourceFile=sourceFile;if(repeat){texture.repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)texture.wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)texture.wrapT=THREE.RepeatWrapping}if(offset){texture.offset.set(offset[0],offset[1])}if(wrap){var wrapMap={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(wrapMap[wrap[0]]!==undefined)texture.wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)texture.wrapT=wrapMap[wrap[1]]}if(anisotropy){texture.anisotropy=anisotropy}where[name]=texture}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255}var mtype="MeshLambertMaterial";var mpars={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial"}if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending]}if(m.transparent!==undefined){mpars.transparent=m.transparent}if(m.opacity!==undefined&&m.opacity<1){mpars.transparent=true}if(m.depthTest!==undefined){mpars.depthTest=m.depthTest}if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite}if(m.visible!==undefined){mpars.visible=m.visible}if(m.flipSided!==undefined){mpars.side=THREE.BackSide}if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide}if(m.wireframe!==undefined){mpars.wireframe=m.wireframe}if(m.vertexColors!==undefined){if(m.vertexColors==="face"){mpars.vertexColors=THREE.FaceColors}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors}}if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse)}else if(m.DbgColor){mpars.color=m.DbgColor}if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular)}if(m.colorEmissive){mpars.emissive=rgb2hex(m.colorEmissive)}if(m.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");m.opacity=m.transparency}if(m.opacity!==undefined){mpars.opacity=m.opacity}if(m.specularCoef){mpars.shininess=m.specularCoef}if(m.mapDiffuse&&texturePath){create_texture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy)}if(m.mapLight&&texturePath){create_texture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy)}if(m.mapBump&&texturePath){create_texture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy)}if(m.mapNormal&&texturePath){create_texture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy)}if(m.mapSpecular&&texturePath){create_texture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy)}if(m.mapAlpha&&texturePath){create_texture(mpars,"alphaMap",m.mapAlpha,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy)}if(m.mapBumpScale){mpars.bumpScale=m.mapBumpScale}if(m.mapNormalFactor){mpars.normalScale=new THREE.Vector2(m.mapNormalFactor,m.mapNormalFactor)}var material=new THREE[mtype](mpars);if(m.DbgName!==undefined)material.name=m.DbgName;return material}};THREE.Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var i=0,l=this.handlers.length;i<l;i+=2){var regex=this.handlers[i];var loader=this.handlers[i+1];if(regex.test(file)){return loader}}return null}};THREE.XHRLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){if(onLoad)onLoad(cached);return}var request=new XMLHttpRequest;request.open("GET",url,true);request.addEventListener("load",function(event){THREE.Cache.add(url,this.response);if(onLoad)onLoad(this.response);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){request.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){request.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)request.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)request.responseType=this.responseType;request.send(null);scope.manager.itemStart(url)},setResponseType:function(value){this.responseType=value},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.ImageLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){onLoad(cached);return}var image=document.createElement("img");image.addEventListener("load",function(event){THREE.Cache.add(url,this);if(onLoad)onLoad(this);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){image.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){image.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)image.crossOrigin=this.crossOrigin;image.src=url;scope.manager.itemStart(url);return image},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.JSONLoader=function(showStatus){THREE.Loader.call(this,showStatus);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(url,callback,texturePath){texturePath=texturePath&&typeof texturePath==="string"?texturePath:this.extractUrlBase(url);this.onLoadStart();this.loadAjaxJSON(this,url,callback,texturePath)};THREE.JSONLoader.prototype.loadAjaxJSON=function(context,url,callback,texturePath,callbackProgress){var xhr=new XMLHttpRequest;var length=0;xhr.onreadystatechange=function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200||xhr.status===0){if(xhr.responseText){var json=JSON.parse(xhr.responseText);var metadata=json.metadata;if(metadata!==undefined){if(metadata.type==="object"){THREE.error("THREE.JSONLoader: "+url+" should be loaded with THREE.ObjectLoader instead.");return}if(metadata.type==="scene"){THREE.error("THREE.JSONLoader: "+url+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}var result=context.parse(json,texturePath);callback(result.geometry,result.materials)}else{THREE.error("THREE.JSONLoader: "+url+" seems to be unreachable or the file is empty.")}context.onLoadComplete()}else{THREE.error("THREE.JSONLoader: Couldn't load "+url+" ("+xhr.status+")")}}else if(xhr.readyState===xhr.LOADING){if(callbackProgress){if(length===0){length=xhr.getResponseHeader("Content-Length")}callbackProgress({total:length,loaded:xhr.responseText.length})}}else if(xhr.readyState===xhr.HEADERS_RECEIVED){if(callbackProgress!==undefined){length=xhr.getResponseHeader("Content-Length")}}};xhr.open("GET",url,true);xhr.withCredentials=this.withCredentials;xhr.send(null)};THREE.JSONLoader.prototype.parse=function(json,texturePath){var geometry=new THREE.Geometry,scale=json.scale!==undefined?1/json.scale:1;parseModel(scale);parseSkin();parseMorphing(scale);geometry.computeFaceNormals();geometry.computeBoundingSphere();function parseModel(scale){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;if(json.uvs!==undefined){for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[]}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new THREE.Vector3;vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex)}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){faceA=new THREE.Face3;faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new THREE.Face3;faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;j<4;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);if(j!==2)geometry.faceVertexUvs[i][fi].push(uv);if(j!==0)geometry.faceVertexUvs[i][fi+1].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal)}if(hasFaceVertexNormal){for(i=0;i<4;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(i!==2)faceA.vertexNormals.push(normal);if(i!==0)faceB.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex)}if(hasFaceVertexColor){for(i=0;i<4;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(i!==2)faceA.vertexColors.push(new THREE.Color(hex));if(i!==0)faceB.vertexColors.push(new THREE.Color(hex))}}geometry.faces.push(faceA);geometry.faces.push(faceB)}else{face=new THREE.Face3;face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;j<3;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);geometry.faceVertexUvs[i][fi].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])}if(hasFaceVertexNormal){for(i=0;i<3;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex])}if(hasFaceVertexColor){for(i=0;i<3;i++){colorIndex=faces[offset++];face.vertexColors.push(new THREE.Color(colors[colorIndex]))}}geometry.faces.push(face)}}}function parseSkin(){var influencesPerVertex=json.influencesPerVertex!==undefined?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i];var y=influencesPerVertex>1?json.skinWeights[i+1]:0;var z=influencesPerVertex>2?json.skinWeights[i+2]:0;var w=influencesPerVertex>3?json.skinWeights[i+3]:0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w))}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i];var b=influencesPerVertex>1?json.skinIndices[i+1]:0;var c=influencesPerVertex>2?json.skinIndices[i+2]:0;var d=influencesPerVertex>3?json.skinIndices[i+3]:0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d))}}geometry.bones=json.bones;if(geometry.bones&&geometry.bones.length>0&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){THREE.warn("THREE.JSONLoader: When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}geometry.animation=json.animation;geometry.animations=json.animations}function parseMorphing(scale){if(json.morphTargets!==undefined){var i,l,v,vl,dstVertices,srcVertices;for(i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];dstVertices=geometry.morphTargets[i].vertices;srcVertices=json.morphTargets[i].vertices;for(v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3;vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex)}}}if(json.morphColors!==undefined){var i,l,c,cl,dstColors,srcColors,color;for(i=0,l=json.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=json.morphColors[i].name;geometry.morphColors[i].colors=[];dstColors=geometry.morphColors[i].colors;srcColors=json.morphColors[i].colors;for(c=0,cl=srcColors.length;c<cl;c+=3){color=new THREE.Color(16755200);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color)}}}}if(json.materials===undefined||json.materials.length===0){return{geometry:geometry}}else{var materials=this.initMaterials(json.materials,texturePath);if(this.needsTangents(materials)){geometry.computeTangents()}return{geometry:geometry,materials:materials}}};THREE.LoadingManager=function(onLoad,onProgress,onError){var scope=this;var loaded=0,total=0;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){total++};this.itemEnd=function(url){loaded++;if(scope.onProgress!==undefined){scope.onProgress(url,loaded,total)}if(loaded===total&&scope.onLoad!==undefined){scope.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var geometry=new THREE.BufferGeometry;var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key];var typedArray=new self[attribute.type](attribute.array);geometry.addAttribute(key,new THREE.BufferAttribute(typedArray,attribute.itemSize))}var offsets=json.data.offsets;if(offsets!==undefined){geometry.offsets=JSON.parse(JSON.stringify(offsets))}var boundingSphere=json.data.boundingSphere;if(boundingSphere!==undefined){var center=new THREE.Vector3;if(boundingSphere.center!==undefined){center.fromArray(boundingSphere.center)}geometry.boundingSphere=new THREE.Sphere(center,boundingSphere.radius)}return geometry}};THREE.MaterialLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var material=new THREE[json.type];if(json.color!==undefined)material.color.setHex(json.color);if(json.emissive!==undefined)material.emissive.setHex(json.emissive);if(json.specular!==undefined)material.specular.setHex(json.specular);if(json.shininess!==undefined)material.shininess=json.shininess;if(json.uniforms!==undefined)material.uniforms=json.uniforms;if(json.vertexShader!==undefined)material.vertexShader=json.vertexShader;if(json.fragmentShader!==undefined)material.fragmentShader=json.fragmentShader;if(json.vertexColors!==undefined)material.vertexColors=json.vertexColors;if(json.shading!==undefined)material.shading=json.shading;if(json.blending!==undefined)material.blending=json.blending;if(json.side!==undefined)material.side=json.side;if(json.opacity!==undefined)material.opacity=json.opacity;if(json.transparent!==undefined)material.transparent=json.transparent;if(json.wireframe!==undefined)material.wireframe=json.wireframe;if(json.size!==undefined)material.size=json.size;if(json.sizeAttenuation!==undefined)material.sizeAttenuation=json.sizeAttenuation;if(json.materials!==undefined){for(var i=0,l=json.materials.length;i<l;i++){material.materials.push(this.parse(json.materials[i]))}}return material}};THREE.ObjectLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this.texturePath=""};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(url,onLoad,onProgress,onError){if(this.texturePath===""){this.texturePath=url.substring(0,url.lastIndexOf("/")+1)}var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){scope.parse(JSON.parse(text),onLoad)},onProgress,onError)},setTexturePath:function(value){this.texturePath=value},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json,onLoad){var geometries=this.parseGeometries(json.geometries);var images=this.parseImages(json.images,function(){if(onLoad!==undefined)onLoad(object)});var textures=this.parseTextures(json.textures,images);var materials=this.parseMaterials(json.materials,textures);var object=this.parseObject(json.object,geometries,materials);if(json.images===undefined||json.images.length===0){if(onLoad!==undefined)onLoad(object)}return object},parseGeometries:function(json){var geometries={};if(json!==undefined){var geometryLoader=new THREE.JSONLoader;var bufferGeometryLoader=new THREE.BufferGeometryLoader;for(var i=0,l=json.length;i<l;i++){var geometry;var data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new THREE[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"CubeGeometry":geometry=new THREE.BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":geometry=new THREE.CircleGeometry(data.radius,data.segments);break;case"CylinderGeometry":geometry=new THREE.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded);break;case"SphereGeometry":geometry=new THREE.SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"IcosahedronGeometry":geometry=new THREE.IcosahedronGeometry(data.radius,data.detail);
break;case"TorusGeometry":geometry=new THREE.TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":geometry=new THREE.TorusKnotGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.p,data.q,data.heightScale);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":geometry=geometryLoader.parse(data.data).geometry;break}geometry.uuid=data.uuid;if(data.name!==undefined)geometry.name=data.name;geometries[data.uuid]=geometry}}return geometries},parseMaterials:function(json,textures){var materials={};if(json!==undefined){var getTexture=function(name){if(textures[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined texture",name)}return textures[name]};var loader=new THREE.MaterialLoader;for(var i=0,l=json.length;i<l;i++){var data=json[i];var material=loader.parse(data);material.uuid=data.uuid;if(data.name!==undefined)material.name=data.name;if(data.map!==undefined){material.map=getTexture(data.map)}if(data.bumpMap!==undefined){material.bumpMap=getTexture(data.bumpMap);if(data.bumpScale){material.bumpScale=new THREE.Vector2(data.bumpScale,data.bumpScale)}}if(data.alphaMap!==undefined){material.alphaMap=getTexture(data.alphaMap)}if(data.envMap!==undefined){material.envMap=getTexture(data.envMap)}if(data.normalMap!==undefined){material.normalMap=getTexture(data.normalMap);if(data.normalScale){material.normalScale=new THREE.Vector2(data.normalScale,data.normalScale)}}if(data.lightMap!==undefined){material.lightMap=getTexture(data.lightMap)}if(data.specularMap!==undefined){material.specularMap=getTexture(data.specularMap)}materials[data.uuid]=material}}return materials},parseImages:function(json,onLoad){var scope=this;var images={};if(json!==undefined&&json.length>0){var manager=new THREE.LoadingManager(onLoad);var loader=new THREE.ImageLoader(manager);loader.setCrossOrigin(this.crossOrigin);var loadImage=function(url){scope.manager.itemStart(url);return loader.load(url,function(){scope.manager.itemEnd(url)})};for(var i=0,l=json.length;i<l;i++){var image=json[i];var path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path)}}return images},parseTextures:function(json,images){var textures={};if(json!==undefined){for(var i=0,l=json.length;i<l;i++){var data=json[i];if(data.image===undefined){THREE.warn('THREE.ObjectLoader: No "image" speficied for',data.uuid)}if(images[data.image]===undefined){THREE.warn("THREE.ObjectLoader: Undefined image",data.image)}var texture=new THREE.Texture(images[data.image]);texture.needsUpdate=true;texture.uuid=data.uuid;if(data.name!==undefined)texture.name=data.name;if(data.repeat!==undefined)texture.repeat=new THREE.Vector2(data.repeat[0],data.repeat[1]);if(data.minFilter!==undefined)texture.minFilter=THREE[data.minFilter];if(data.magFilter!==undefined)texture.magFilter=THREE[data.magFilter];if(data.anisotropy!==undefined)texture.anisotropy=data.anisotropy;if(data.wrap instanceof Array){texture.wrapS=THREE[data.wrap[0]];texture.wrapT=THREE[data.wrap[1]]}textures[data.uuid]=texture}}return textures},parseObject:function(){var matrix=new THREE.Matrix4;return function(data,geometries,materials){var object;var getGeometry=function(name){if(geometries[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined geometry",name)}return geometries[name]};var getMaterial=function(name){if(materials[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined material",name)}return materials[name]};switch(data.type){case"Scene":object=new THREE.Scene;break;case"PerspectiveCamera":object=new THREE.PerspectiveCamera(data.fov,data.aspect,data.near,data.far);break;case"OrthographicCamera":object=new THREE.OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new THREE.AmbientLight(data.color);break;case"DirectionalLight":object=new THREE.DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new THREE.PointLight(data.color,data.intensity,data.distance,data.decay);break;case"SpotLight":object=new THREE.SpotLight(data.color,data.intensity,data.distance,data.angle,data.exponent,data.decay);break;case"HemisphereLight":object=new THREE.HemisphereLight(data.color,data.groundColor,data.intensity);break;case"Mesh":object=new THREE.Mesh(getGeometry(data.geometry),getMaterial(data.material));break;case"Line":object=new THREE.Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"PointCloud":object=new THREE.PointCloud(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new THREE.Sprite(getMaterial(data.material));break;case"Group":object=new THREE.Group;break;default:object=new THREE.Object3D}object.uuid=data.uuid;if(data.name!==undefined)object.name=data.name;if(data.matrix!==undefined){matrix.fromArray(data.matrix);matrix.decompose(object.position,object.quaternion,object.scale)}else{if(data.position!==undefined)object.position.fromArray(data.position);if(data.rotation!==undefined)object.rotation.fromArray(data.rotation);if(data.scale!==undefined)object.scale.fromArray(data.scale)}if(data.visible!==undefined)object.visible=data.visible;if(data.userData!==undefined)object.userData=data.userData;if(data.children!==undefined){for(var child in data.children){object.add(this.parseObject(data.children[child],geometries,materials))}}return object}}()};THREE.TextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.ImageLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(image){var texture=new THREE.Texture(image);texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture)}},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null};THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var texture=new THREE.DataTexture;var loader=new THREE.XHRLoader;loader.setResponseType("arraybuffer");loader.load(url,function(buffer){var texData=scope._parser(buffer);if(!texData)return;if(undefined!==texData.image){texture.image=texData.image}else if(undefined!==texData.data){texture.image.width=texData.width;texture.image.height=texData.height;texture.image.data=texData.data}texture.wrapS=undefined!==texData.wrapS?texData.wrapS:THREE.ClampToEdgeWrapping;texture.wrapT=undefined!==texData.wrapT?texData.wrapT:THREE.ClampToEdgeWrapping;texture.magFilter=undefined!==texData.magFilter?texData.magFilter:THREE.LinearFilter;texture.minFilter=undefined!==texData.minFilter?texData.minFilter:THREE.LinearMipMapLinearFilter;texture.anisotropy=undefined!==texData.anisotropy?texData.anisotropy:1;if(undefined!==texData.format){texture.format=texData.format}if(undefined!==texData.type){texture.type=texData.type}if(undefined!==texData.mipmaps){texture.mipmaps=texData.mipmaps}if(1===texData.mipmapCount){texture.minFilter=THREE.LinearFilter}texture.needsUpdate=true;if(onLoad)onLoad(texture,texData)},onProgress,onError);return texture}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(url,onLoad,onError){var scope=this;var images=[];var texture=new THREE.CompressedTexture;texture.image=images;var loader=new THREE.XHRLoader;loader.setResponseType("arraybuffer");if(url instanceof Array){var loaded=0;var loadTexture=function(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,true);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(loaded===6){if(texDatas.mipmapCount==1)texture.minFilter=THREE.LinearFilter;texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)}})};for(var i=0,il=url.length;i<il;++i){loadTexture(i)}}else{loader.load(url,function(buffer){var texDatas=scope._parser(buffer,true);if(texDatas.isCubemap){var faces=texDatas.mipmaps.length/texDatas.mipmapCount;for(var f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps}if(texDatas.mipmapCount===1){texture.minFilter=THREE.LinearFilter}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)})}return texture}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},setValues:function(values){if(values===undefined)return;for(var key in values){var newValue=values[key];if(newValue===undefined){THREE.warn("THREE.Material: '"+key+"' parameter is undefined.");continue}if(key in this){var currentValue=this[key];if(currentValue instanceof THREE.Color){currentValue.set(newValue)}else if(currentValue instanceof THREE.Vector3&&newValue instanceof THREE.Vector3){currentValue.copy(newValue)}else if(key=="overdraw"){this[key]=Number(newValue)}else{this[key]=newValue}}}},toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this instanceof THREE.MeshBasicMaterial){output.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshLambertMaterial){output.color=this.color.getHex();output.emissive=this.emissive.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)output.shading=this.shading;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshPhongMaterial){output.color=this.color.getHex();output.emissive=this.emissive.getHex();output.specular=this.specular.getHex();output.shininess=this.shininess;if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)output.shading=this.shading;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshNormalMaterial){if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshDepthMaterial){if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.PointCloudMaterial){output.size=this.size;output.sizeAttenuation=this.sizeAttenuation;output.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending}else if(this instanceof THREE.ShaderMaterial){output.uniforms=this.uniforms;output.vertexShader=this.vertexShader;output.fragmentShader=this.fragmentShader}else if(this instanceof THREE.SpriteMaterial){output.color=this.color.getHex()}if(this.opacity<1)output.opacity=this.opacity;if(this.transparent!==false)output.transparent=this.transparent;if(this.wireframe!==false)output.wireframe=this.wireframe;return output},clone:function(material){if(material===undefined)material=new THREE.Material;material.name=this.name;material.side=this.side;material.opacity=this.opacity;material.transparent=this.transparent;material.blending=this.blending;material.blendSrc=this.blendSrc;material.blendDst=this.blendDst;material.blendEquation=this.blendEquation;material.blendSrcAlpha=this.blendSrcAlpha;material.blendDstAlpha=this.blendDstAlpha;material.blendEquationAlpha=this.blendEquationAlpha;material.depthTest=this.depthTest;material.depthWrite=this.depthWrite;material.polygonOffset=this.polygonOffset;material.polygonOffsetFactor=this.polygonOffsetFactor;material.polygonOffsetUnits=this.polygonOffsetUnits;material.alphaTest=this.alphaTest;material.overdraw=this.overdraw;material.visible=this.visible;return material},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(parameters){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.clone=function(){var material=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.linecap=this.linecap;material.linejoin=this.linejoin;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.LineDashedMaterial=function(parameters){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(parameters)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.clone=function(){var material=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.scale=this.scale;material.dashSize=this.dashSize;material.gapSize=this.gapSize;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.MeshBasicMaterial=function(parameters){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(parameters)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.clone=function(){var material=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;return material};THREE.MeshLambertMaterial=function(parameters){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.clone=function(){var material=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.emissive.copy(this.emissive);material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshPhongMaterial=function(parameters){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.clone=function(){var material=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.emissive.copy(this.emissive);material.specular.copy(this.specular);material.shininess=this.shininess;material.metal=this.metal;material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.bumpMap=this.bumpMap;material.bumpScale=this.bumpScale;material.normalMap=this.normalMap;material.normalScale.copy(this.normalScale);material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshDepthMaterial=function(parameters){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.clone=function(){var material=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshNormalMaterial=function(parameters){THREE.Material.call(this,parameters);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(parameters)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.clone=function(){var material=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshFaceMaterial=function(materials){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=materials instanceof Array?materials:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var i=0,l=this.materials.length;i<l;i++){output.materials.push(this.materials[i].toJSON())}return output},clone:function(){var material=new THREE.MeshFaceMaterial;for(var i=0;i<this.materials.length;i++){material.materials.push(this.materials[i].clone())}return material}};THREE.PointCloudMaterial=function(parameters){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial;THREE.PointCloudMaterial.prototype.clone=function(){var material=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.size=this.size;material.sizeAttenuation=this.sizeAttenuation;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.ParticleBasicMaterial=function(parameters){THREE.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ParticleSystemMaterial=function(parameters){THREE.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ShaderMaterial=function(parameters){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(parameters)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.clone=function(){var material=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,material);material.fragmentShader=this.fragmentShader;material.vertexShader=this.vertexShader;material.uniforms=THREE.UniformsUtils.clone(this.uniforms);material.attributes=this.attributes;material.defines=this.defines;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.fog=this.fog;material.lights=this.lights;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.RawShaderMaterial=function(parameters){THREE.ShaderMaterial.call(this,parameters);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.RawShaderMaterial.prototype.clone=function(){var material=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,material);return material};THREE.SpriteMaterial=function(parameters){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(parameters)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.clone=function(){var material=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.rotation=this.rotation;material.fog=this.fog;return material};THREE.Texture=function(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.sourceFile="";this.image=image!==undefined?image:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==undefined?mapping:THREE.Texture.DEFAULT_MAPPING;this.wrapS=wrapS!==undefined?wrapS:THREE.ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:THREE.ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:THREE.LinearFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:THREE.RGBAFormat;this.type=type!==undefined?type:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},clone:function(texture){if(texture===undefined)texture=new THREE.Texture;texture.image=this.image;texture.mipmaps=this.mipmaps.slice(0);texture.mapping=this.mapping;texture.wrapS=this.wrapS;texture.wrapT=this.wrapT;texture.magFilter=this.magFilter;texture.minFilter=this.minFilter;texture.anisotropy=this.anisotropy;texture.format=this.format;texture.type=this.type;texture.offset.copy(this.offset);texture.repeat.copy(this.repeat);texture.generateMipmaps=this.generateMipmaps;texture.premultiplyAlpha=this.premultiplyAlpha;texture.flipY=this.flipY;texture.unpackAlignment=this.unpackAlignment;return texture},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){mapping=mapping!==undefined?mapping:THREE.CubeReflectionMapping;THREE.Texture.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.images=images};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.clone=function(texture){if(texture===undefined)texture=new THREE.CubeTexture;THREE.Texture.prototype.clone.call(this,texture);texture.images=this.images;return texture};THREE.CompressedTexture=function(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.mipmaps=mipmaps;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.CompressedTexture.prototype.clone=function(){var texture=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.DataTexture=function(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={data:data,width:width,height:height}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var texture=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.VideoTexture=function(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=false;var scope=this;var update=function(){requestAnimationFrame(update);if(video.readyState===video.HAVE_ENOUGH_DATA){scope.needsUpdate=true}};update()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.PointCloud=function(geometry,material){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.PointCloudMaterial({color:Math.random()*16777215})};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.constructor=THREE.PointCloud;THREE.PointCloud.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;return function(raycaster,intersects){var object=this;var geometry=object.geometry;var threshold=raycaster.params.PointCloud.threshold;inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);var position=new THREE.Vector3;var testPoint=function(point,index){var rayPointDistance=ray.distanceToPoint(point);if(rayPointDistance<localThreshold){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);intersects.push({distance:distance,distanceToRay:rayPointDistance,point:intersectPoint.clone(),index:index,face:null,object:object})}};if(geometry instanceof THREE.BufferGeometry){
var attributes=geometry.attributes;var positions=attributes.position.array;if(attributes.index!==undefined){var indices=attributes.index.array;var offsets=geometry.offsets;if(offsets.length===0){var offset={start:0,count:indices.length,index:0};offsets=[offset]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i++){var a=index+indices[i];position.fromArray(positions,a*3);testPoint(position,a)}}}else{var pointCount=positions.length/3;for(var i=0;i<pointCount;i++){position.set(positions[3*i],positions[3*i+1],positions[3*i+2]);testPoint(position,i)}}}else{var vertices=this.geometry.vertices;for(var i=0;i<vertices.length;i++){testPoint(vertices[i],i)}}}}();THREE.PointCloud.prototype.clone=function(object){if(object===undefined)object=new THREE.PointCloud(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.ParticleSystem=function(geometry,material){THREE.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(geometry,material)};THREE.Line=function(geometry,material,mode){THREE.Object3D.call(this);this.type="Line";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.mode=mode!==undefined?mode:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;THREE.Line.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision;var precisionSq=precision*precision;var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new THREE.Vector3;var vEnd=new THREE.Vector3;var interSegment=new THREE.Vector3;var interRay=new THREE.Vector3;var step=this.mode===THREE.LineStrip?1:2;if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;if(attributes.index!==undefined){var indices=attributes.index.array;var positions=attributes.position.array;var offsets=geometry.offsets;if(offsets.length===0){offsets=[{start:0,count:indices.length,index:0}]}for(var oi=0;oi<offsets.length;oi++){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start;i<start+count-1;i+=step){var a=index+indices[i];var b=index+indices[i+1];vStart.fromArray(positions,a*3);vEnd.fromArray(positions,b*3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,offsetIndex:oi,face:null,faceIndex:null,object:this})}}}else{var positions=attributes.position.array;for(var i=0;i<positions.length/3-1;i+=step){vStart.fromArray(positions,3*i);vEnd.fromArray(positions,3*i+3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var nbVertices=vertices.length;for(var i=0;i<nbVertices-1;i+=step){var distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(object){if(object===undefined)object=new THREE.Line(this.geometry,this.material,this.mode);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Mesh=function(geometry,material){THREE.Object3D.call(this);this.type="Mesh";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var m=0,ml=this.geometry.morphTargets.length;m<ml;m++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[m].name]=m}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(name){if(this.morphTargetDictionary[name]!==undefined){return this.morphTargetDictionary[name]}THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+name+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;var vA=new THREE.Vector3;var vB=new THREE.Vector3;var vC=new THREE.Vector3;return function(raycaster,intersects){var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}if(geometry instanceof THREE.BufferGeometry){var material=this.material;if(material===undefined)return;var attributes=geometry.attributes;var a,b,c;var precision=raycaster.precision;if(attributes.index!==undefined){var indices=attributes.index.array;var positions=attributes.position.array;var offsets=geometry.offsets;if(offsets.length===0){offsets=[{start:0,count:indices.length,index:0}]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i+=3){a=index+indices[i];b=index+indices[i+1];c=index+indices[i+2];vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else{var positions=attributes.position.array;for(var i=0,j=0,il=positions.length;i<il;i+=3,j+=9){a=i;b=i+1;c=i+2;vA.fromArray(positions,j);vB.fromArray(positions,j+3);vC.fromArray(positions,j+6);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var isFaceMaterial=this.material instanceof THREE.MeshFaceMaterial;var objectMaterials=isFaceMaterial===true?this.material.materials:null;var a,b,c;var precision=raycaster.precision;var vertices=geometry.vertices;for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var material=isFaceMaterial===true?objectMaterials[face.materialIndex]:this.material;if(material===undefined)continue;a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];if(material.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0)continue;var targets=morphTargets[t].vertices;vA.x+=(targets[face.a].x-a.x)*influence;vA.y+=(targets[face.a].y-a.y)*influence;vA.z+=(targets[face.a].z-a.z)*influence;vB.x+=(targets[face.b].x-b.x)*influence;vB.y+=(targets[face.b].y-b.y)*influence;vB.z+=(targets[face.b].z-b.z)*influence;vC.x+=(targets[face.c].x-c.x)*influence;vC.y+=(targets[face.c].y-c.y)*influence;vC.z+=(targets[face.c].z-c.z)*influence}vA.add(a);vB.add(b);vC.add(c);a=vA;b=vB;c=vC}if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(c,b,a,true)}else{var intersectionPoint=ray.intersectTriangle(a,b,c,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:face,faceIndex:f,object:this})}}}}();THREE.Mesh.prototype.clone=function(object,recursive){if(object===undefined)object=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object,recursive);return object};THREE.Bone=function(skin){THREE.Object3D.call(this);this.type="Bone";this.skin=skin};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Skeleton=function(bones,boneInverses,useVertexTexture){this.useVertexTexture=useVertexTexture!==undefined?useVertexTexture:true;this.identityMatrix=new THREE.Matrix4;bones=bones||[];this.bones=bones.slice(0);if(this.useVertexTexture){var size;if(this.bones.length>256)size=64;else if(this.bones.length>64)size=32;else if(this.bones.length>16)size=16;else size=8;this.boneTextureWidth=size;this.boneTextureHeight=size;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(boneInverses===undefined){this.calculateInverses()}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0)}else{THREE.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new THREE.Matrix4;if(this.bones[b]){inverse.getInverse(this.bones[b].matrixWorld)}this.boneInverses.push(inverse)}};THREE.Skeleton.prototype.pose=function(){var bone;for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){bone.matrixWorld.getInverse(this.boneInverses[b])}}for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){if(bone.parent){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld)}else{bone.matrix.copy(bone.matrixWorld)}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale)}}};THREE.Skeleton.prototype.update=function(){var offsetMatrix=new THREE.Matrix4;return function(){for(var b=0,bl=this.bones.length;b<bl;b++){var matrix=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;offsetMatrix.multiplyMatrices(matrix,this.boneInverses[b]);offsetMatrix.flattenToArrayOffset(this.boneMatrices,b*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh=function(geometry,material,useVertexTexture){THREE.Mesh.call(this,geometry,material);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var bones=[];if(this.geometry&&this.geometry.bones!==undefined){var bone,gbone,p,q,s;for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];p=gbone.pos;q=gbone.rotq;s=gbone.scl;bone=new THREE.Bone(this);bones.push(bone);bone.name=gbone.name;bone.position.set(p[0],p[1],p[2]);bone.quaternion.set(q[0],q[1],q[2],q[3]);if(s!==undefined){bone.scale.set(s[0],s[1],s[2])}else{bone.scale.set(1,1,1)}}for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];if(gbone.parent!==-1){bones[gbone.parent].add(bones[b])}else{this.add(bones[b])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(bones,undefined,useVertexTexture))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===undefined){this.updateMatrixWorld(true);bindMatrix=this.matrixWorld}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var i=0;i<this.geometry.skinIndices.length;i++){var sw=this.geometry.skinWeights[i];var scale=1/sw.lengthManhattan();if(scale!==Infinity){sw.multiplyScalar(scale)}else{sw.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(force){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{THREE.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(object){if(object===undefined){object=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,object);return object};THREE.MorphAnimMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(start,end){this.startKeyframe=start;this.endKeyframe=end;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var geometry=this.geometry;if(!geometry.animations)geometry.animations={};var firstAnimation,animations=geometry.animations;var pattern=/([a-z]+)_?(\d+)/;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var parts=morph.name.match(pattern);if(parts&&parts.length>1){var label=parts[1];if(!animations[label])animations[label]={start:Infinity,end:-Infinity};var animation=animations[label];if(i<animation.start)animation.start=i;if(i>animation.end)animation.end=i;if(!firstAnimation)firstAnimation=label}}geometry.firstAnimation=firstAnimation};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(label,start,end){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[label]={start:start,end:end}};THREE.MorphAnimMesh.prototype.playAnimation=function(label,fps){var animation=this.geometry.animations[label];if(animation){this.setFrameRange(animation.start,animation.end);this.duration=1e3*((animation.end-animation.start)/fps);this.time=0}else{THREE.warn("THREE.MorphAnimMesh: animation["+label+"] undefined in .playAnimation()")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(delta){var frameTime=this.duration/this.length;this.time+=this.direction*delta;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var keyframe=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/frameTime),0,this.length-1);if(keyframe!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[keyframe]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=keyframe}var mix=this.time%frameTime/frameTime;if(this.directionBackwards){mix=1-mix}this.morphTargetInfluences[this.currentKeyframe]=mix;this.morphTargetInfluences[this.lastKeyframe]=1-mix};THREE.MorphAnimMesh.prototype.interpolateTargets=function(a,b,t){var influences=this.morphTargetInfluences;for(var i=0,l=influences.length;i<l;i++){influences[i]=0}if(a>-1)influences[a]=1-t;if(b>-1)influences[b]=t};THREE.MorphAnimMesh.prototype.clone=function(object){if(object===undefined)object=new THREE.MorphAnimMesh(this.geometry,this.material);object.duration=this.duration;object.mirroredLoop=this.mirroredLoop;object.time=this.time;object.lastKeyframe=this.lastKeyframe;object.currentKeyframe=this.currentKeyframe;object.direction=this.direction;object.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,object);return object};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(object,distance){if(distance===undefined)distance=0;distance=Math.abs(distance);for(var l=0;l<this.objects.length;l++){if(distance<this.objects[l].distance){break}}this.objects.splice(l,0,{distance:distance,object:object});this.add(object)};THREE.LOD.prototype.getObjectForDistance=function(distance){for(var i=1,l=this.objects.length;i<l;i++){if(distance<this.objects[i].distance){break}}return this.objects[i-1].object};THREE.LOD.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}();THREE.LOD.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(camera){if(this.objects.length>1){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);this.objects[0].object.visible=true;for(var i=1,l=this.objects.length;i<l;i++){if(distance>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<l;i++){this.objects[i].object.visible=false}}}}();THREE.LOD.prototype.clone=function(object){if(object===undefined)object=new THREE.LOD;THREE.Object3D.prototype.clone.call(this,object);for(var i=0,l=this.objects.length;i<l;i++){var x=this.objects[i].object.clone();x.visible=i===0;object.addLevel(x,this.objects[i].distance)}return object};THREE.Sprite=function(){var indices=new Uint16Array([0,1,2,0,2,3]);var vertices=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var uvs=new Float32Array([0,0,1,0,1,1,0,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("index",new THREE.BufferAttribute(indices,1));geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("uv",new THREE.BufferAttribute(uvs,2));return function(material){THREE.Object3D.call(this);this.type="Sprite";this.geometry=geometry;this.material=material!==undefined?material:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.distanceToPoint(matrixPosition);if(distance>this.scale.x){return}intersects.push({distance:distance,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(object){if(object===undefined)object=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(texture,size,distance,blending,color){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.add=function(texture,size,distance,blending,color,opacity){if(size===undefined)size=-1;if(distance===undefined)distance=0;if(opacity===undefined)opacity=1;if(color===undefined)color=new THREE.Color(16777215);if(blending===undefined)blending=THREE.NormalBlending;distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:1,opacity:opacity,color:color,blending:blending})};THREE.LensFlare.prototype.updateLensFlares=function(){var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this.lensFlares[f];flare.x=this.positionScreen.x+vecX*flare.distance;flare.y=this.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*.25}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(object){if(object===undefined)object=new THREE.Scene;THREE.Object3D.prototype.clone.call(this,object);if(this.fog!==null)object.fog=this.fog.clone();if(this.overrideMaterial!==null)object.overrideMaterial=this.overrideMaterial.clone();object.autoUpdate=this.autoUpdate;object.matrixAutoUpdate=this.matrixAutoUpdate;return object};THREE.Fog=function(color,near,far){this.name="";this.color=new THREE.Color(color);this.near=near!==undefined?near:1;this.far=far!==undefined?far:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(color,density){this.name="";this.color=new THREE.Color(color);this.density=density!==undefined?density:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n";THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";THREE.ShaderChunk["default_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";
THREE.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif";THREE.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="\n\toutgoingLight = linearToOutput( outgoingLight );\n";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["defaultnormal_vertex"]="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";
THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(uniforms){var merged={};for(var u=0;u<uniforms.length;u++){var tmp=this.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p]}}return merged},clone:function(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src instanceof THREE.Color||parameter_src instanceof THREE.Vector2||parameter_src instanceof THREE.Vector3||parameter_src instanceof THREE.Vector4||parameter_src instanceof THREE.Matrix4||parameter_src instanceof THREE.Texture){uniforms_dst[u][p]=parameter_src.clone()}else if(parameter_src instanceof Array){uniforms_dst[u][p]=parameter_src.slice()}else{uniforms_dst[u][p]=parameter_src}}}return uniforms_dst}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"\t#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"\t#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphatest_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}};THREE.WebGLRenderer=function(parameters){console.log("THREE.WebGLRenderer",THREE.REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement("canvas"),_context=parameters.context!==undefined?parameters.context:null,pixelRatio=1,_precision=parameters.precision!==undefined?parameters.precision:"highp",_alpha=parameters.alpha!==undefined?parameters.alpha:false,_depth=parameters.depth!==undefined?parameters.depth:true,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_logarithmicDepthBuffer=parameters.logarithmicDepthBuffer!==undefined?parameters.logarithmicDepthBuffer:false,_clearColor=new THREE.Color(0),_clearAlpha=0;var lights=[];var _webglObjects={};var _webglObjectsImmediate=[];var opaqueObjects=[];var transparentObjects=[];var sprites=[];var lensFlares=[];this.domElement=_canvas;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _this=this,_programs=[],_currentProgram=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram="",_currentCamera=null,_usedTextureUnits=0,_viewportX=0,_viewportY=0,_viewportWidth=_canvas.width,_viewportHeight=_canvas.height,_currentWidth=0,_currentHeight=0,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_vector3=new THREE.Vector3,_direction=new THREE.Vector3,_lightsNeedUpdate=true,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var _gl;try{var attributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer};_gl=_context||_canvas.getContext("webgl",attributes)||_canvas.getContext("experimental-webgl",attributes);if(_gl===null){if(_canvas.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}_canvas.addEventListener("webglcontextlost",function(event){event.preventDefault();resetGLState();setDefaultGLState();_webglObjects={}},false)}catch(error){THREE.error("THREE.WebGLRenderer: "+error)}var state=new THREE.WebGLState(_gl,paramThreeToGL);if(_gl.getShaderPrecisionFormat===undefined){_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var extensions=new THREE.WebGLExtensions(_gl);extensions.get("OES_texture_float");extensions.get("OES_texture_float_linear");extensions.get("OES_texture_half_float");extensions.get("OES_texture_half_float_linear");extensions.get("OES_standard_derivatives");if(_logarithmicDepthBuffer){extensions.get("EXT_frag_depth")}var glClearColor=function(r,g,b,a){if(_premultipliedAlpha===true){r*=a;g*=a;b*=a}_gl.clearColor(r,g,b,a)};var setDefaultGLState=function(){_gl.clearColor(0,0,0,1);_gl.clearDepth(1);_gl.clearStencil(0);_gl.enable(_gl.DEPTH_TEST);_gl.depthFunc(_gl.LEQUAL);_gl.frontFace(_gl.CCW);_gl.cullFace(_gl.BACK);_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA);_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight);glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};var resetGLState=function(){_currentProgram=null;_currentCamera=null;_currentGeometryProgram="";_currentMaterialId=-1;_lightsNeedUpdate=true;state.reset()};setDefaultGLState();this.context=_gl;this.state=state;var _maxTextures=_gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);var _maxVertexTextures=_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var _maxTextureSize=_gl.getParameter(_gl.MAX_TEXTURE_SIZE);var _maxCubemapSize=_gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);var _supportsVertexTextures=_maxVertexTextures>0;var _supportsBoneTextures=_supportsVertexTextures&&extensions.get("OES_texture_float");var _vertexShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.HIGH_FLOAT);var _vertexShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.MEDIUM_FLOAT);var _fragmentShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.HIGH_FLOAT);var _fragmentShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.MEDIUM_FLOAT);var getCompressedTextureFormats=function(){var array;return function(){if(array!==undefined){return array}array=[];if(extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")){var formats=_gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<formats.length;i++){array.push(formats[i])}}return array}}();var highpAvailable=_vertexShaderPrecisionHighpFloat.precision>0&&_fragmentShaderPrecisionHighpFloat.precision>0;var mediumpAvailable=_vertexShaderPrecisionMediumpFloat.precision>0&&_fragmentShaderPrecisionMediumpFloat.precision>0;if(_precision==="highp"&&!highpAvailable){if(mediumpAvailable){_precision="mediump";THREE.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{_precision="lowp";THREE.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(_precision==="mediump"&&!mediumpAvailable){_precision="lowp";THREE.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var shadowMapPlugin=new THREE.ShadowMapPlugin(this,lights,_webglObjects,_webglObjectsImmediate);var spritePlugin=new THREE.SpritePlugin(this,sprites);var lensFlarePlugin=new THREE.LensFlarePlugin(this,lensFlares);this.getContext=function(){return _gl};this.forceContextLoss=function(){extensions.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return _supportsVertexTextures};this.supportsFloatTextures=function(){return extensions.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return extensions.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return extensions.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return extensions.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return extensions.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return extensions.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var value;return function(){if(value!==undefined){return value}var extension=extensions.get("EXT_texture_filter_anisotropic");value=extension!==null?_gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return value}}();this.getPrecision=function(){return _precision};this.getPixelRatio=function(){return pixelRatio};this.setPixelRatio=function(value){pixelRatio=value};this.setSize=function(width,height,updateStyle){_canvas.width=width*pixelRatio;_canvas.height=height*pixelRatio;if(updateStyle!==false){_canvas.style.width=width+"px";_canvas.style.height=height+"px"}this.setViewport(0,0,width,height)};this.setViewport=function(x,y,width,height){_viewportX=x*pixelRatio;_viewportY=y*pixelRatio;_viewportWidth=width*pixelRatio;_viewportHeight=height*pixelRatio;_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)};this.setScissor=function(x,y,width,height){_gl.scissor(x*pixelRatio,y*pixelRatio,width*pixelRatio,height*pixelRatio)};this.enableScissorTest=function(enable){enable?_gl.enable(_gl.SCISSOR_TEST):_gl.disable(_gl.SCISSOR_TEST)};this.getClearColor=function(){return _clearColor};this.setClearColor=function(color,alpha){_clearColor.set(color);_clearAlpha=alpha!==undefined?alpha:1;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.getClearAlpha=function(){return _clearAlpha};this.setClearAlpha=function(alpha){_clearAlpha=alpha;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===undefined||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===undefined||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits)};this.clearColor=function(){_gl.clear(_gl.COLOR_BUFFER_BIT)};this.clearDepth=function(){_gl.clear(_gl.DEPTH_BUFFER_BIT)};this.clearStencil=function(){_gl.clear(_gl.STENCIL_BUFFER_BIT)};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil)};this.resetGLState=resetGLState;function createParticleBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();geometry.__webglLineDistanceBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createMeshBuffers(geometryGroup){geometryGroup.__webglVertexBuffer=_gl.createBuffer();geometryGroup.__webglNormalBuffer=_gl.createBuffer();geometryGroup.__webglTangentBuffer=_gl.createBuffer();geometryGroup.__webglColorBuffer=_gl.createBuffer();geometryGroup.__webglUVBuffer=_gl.createBuffer();geometryGroup.__webglUV2Buffer=_gl.createBuffer();geometryGroup.__webglSkinIndicesBuffer=_gl.createBuffer();geometryGroup.__webglSkinWeightsBuffer=_gl.createBuffer();geometryGroup.__webglFaceBuffer=_gl.createBuffer();geometryGroup.__webglLineBuffer=_gl.createBuffer();var numMorphTargets=geometryGroup.numMorphTargets;if(numMorphTargets){geometryGroup.__webglMorphTargetsBuffers=[];for(var m=0,ml=numMorphTargets;m<ml;m++){geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer())}}var numMorphNormals=geometryGroup.numMorphNormals;if(numMorphNormals){geometryGroup.__webglMorphNormalsBuffers=[];for(var m=0,ml=numMorphNormals;m<ml;m++){geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer())}}_this.info.memory.geometries++}var onObjectRemoved=function(event){var object=event.target;object.traverse(function(child){child.removeEventListener("remove",onObjectRemoved);removeObject(child)})};var onGeometryDispose=function(event){var geometry=event.target;geometry.removeEventListener("dispose",onGeometryDispose);deallocateGeometry(geometry)};var onTextureDispose=function(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose);deallocateTexture(texture);_this.info.memory.textures--};var onRenderTargetDispose=function(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose);deallocateRenderTarget(renderTarget);_this.info.memory.textures--};var onMaterialDispose=function(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose);deallocateMaterial(material)};var deleteBuffers=function(geometry){var buffers=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var i=0,l=buffers.length;i<l;i++){var name=buffers[i];if(geometry[name]!==undefined){_gl.deleteBuffer(geometry[name]);delete geometry[name]}}if(geometry.__webglCustomAttributesList!==undefined){for(var name in geometry.__webglCustomAttributesList){_gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer)}delete geometry.__webglCustomAttributesList}_this.info.memory.geometries--};var deallocateGeometry=function(geometry){delete geometry.__webglInit;if(geometry instanceof THREE.BufferGeometry){for(var name in geometry.attributes){
var attribute=geometry.attributes[name];if(attribute.buffer!==undefined){_gl.deleteBuffer(attribute.buffer);delete attribute.buffer}}_this.info.memory.geometries--}else{var geometryGroupsList=geometryGroups[geometry.id];if(geometryGroupsList!==undefined){for(var i=0,l=geometryGroupsList.length;i<l;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.numMorphTargets!==undefined){for(var m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m])}delete geometryGroup.__webglMorphTargetsBuffers}if(geometryGroup.numMorphNormals!==undefined){for(var m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m])}delete geometryGroup.__webglMorphNormalsBuffers}deleteBuffers(geometryGroup)}delete geometryGroups[geometry.id]}else{deleteBuffers(geometry)}}_currentGeometryProgram=""};var deallocateTexture=function(texture){if(texture.image&&texture.image.__webglTextureCube){_gl.deleteTexture(texture.image.__webglTextureCube);delete texture.image.__webglTextureCube}else{if(texture.__webglInit===undefined)return;_gl.deleteTexture(texture.__webglTexture);delete texture.__webglTexture;delete texture.__webglInit}};var deallocateRenderTarget=function(renderTarget){if(!renderTarget||renderTarget.__webglTexture===undefined)return;_gl.deleteTexture(renderTarget.__webglTexture);delete renderTarget.__webglTexture;if(renderTarget instanceof THREE.WebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i])}}else{_gl.deleteFramebuffer(renderTarget.__webglFramebuffer);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer)}delete renderTarget.__webglFramebuffer;delete renderTarget.__webglRenderbuffer};var deallocateMaterial=function(material){var program=material.program.program;if(program===undefined)return;material.program=undefined;var i,il,programInfo;var deleteProgram=false;for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program===program){programInfo.usedTimes--;if(programInfo.usedTimes===0){deleteProgram=true}break}}if(deleteProgram===true){var newPrograms=[];for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program!==program){newPrograms.push(programInfo)}}_programs=newPrograms;_gl.deleteProgram(program);_this.info.memory.programs--}};function initCustomAttributes(object){var geometry=object.geometry;var material=object.material;var nvertices=geometry.vertices.length;if(material.attributes){if(geometry.__webglCustomAttributesList===undefined){geometry.__webglCustomAttributesList=[]}for(var name in material.attributes){var attribute=material.attributes[name];if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;attribute.needsUpdate=true}geometry.__webglCustomAttributesList.push(attribute)}}}function initParticleBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__webglParticleCount=nvertices;initCustomAttributes(object)}function initLineBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__lineDistanceArray=new Float32Array(nvertices*1);geometry.__webglLineCount=nvertices;initCustomAttributes(object)}function initMeshBuffers(geometryGroup,object){var geometry=object.geometry,faces3=geometryGroup.faces3,nvertices=faces3.length*3,ntris=faces3.length*1,nlines=faces3.length*3,material=getBufferMaterial(object,geometryGroup);geometryGroup.__vertexArray=new Float32Array(nvertices*3);geometryGroup.__normalArray=new Float32Array(nvertices*3);geometryGroup.__colorArray=new Float32Array(nvertices*3);geometryGroup.__uvArray=new Float32Array(nvertices*2);if(geometry.faceVertexUvs.length>1){geometryGroup.__uv2Array=new Float32Array(nvertices*2)}if(geometry.hasTangents){geometryGroup.__tangentArray=new Float32Array(nvertices*4)}if(object.geometry.skinWeights.length&&object.geometry.skinIndices.length){geometryGroup.__skinIndexArray=new Float32Array(nvertices*4);geometryGroup.__skinWeightArray=new Float32Array(nvertices*4)}var UintArray=extensions.get("OES_element_index_uint")!==null&&ntris>21845?Uint32Array:Uint16Array;geometryGroup.__typeArray=UintArray;geometryGroup.__faceArray=new UintArray(ntris*3);geometryGroup.__lineArray=new UintArray(nlines*2);var numMorphTargets=geometryGroup.numMorphTargets;if(numMorphTargets){geometryGroup.__morphTargetsArrays=[];for(var m=0,ml=numMorphTargets;m<ml;m++){geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices*3))}}var numMorphNormals=geometryGroup.numMorphNormals;if(numMorphNormals){geometryGroup.__morphNormalsArrays=[];for(var m=0,ml=numMorphNormals;m<ml;m++){geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices*3))}}geometryGroup.__webglFaceCount=ntris*3;geometryGroup.__webglLineCount=nlines*2;if(material.attributes){if(geometryGroup.__webglCustomAttributesList===undefined){geometryGroup.__webglCustomAttributesList=[]}for(var name in material.attributes){var originalAttribute=material.attributes[name];var attribute={};for(var property in originalAttribute){attribute[property]=originalAttribute[property]}if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;originalAttribute.needsUpdate=true;attribute.__original=originalAttribute}geometryGroup.__webglCustomAttributesList.push(attribute)}}geometryGroup.__inittedArrays=true}function getBufferMaterial(object,geometryGroup){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[geometryGroup.materialIndex]:object.material}function materialNeedsFaceNormals(material){return material instanceof THREE.MeshPhongMaterial===false&&material.shading===THREE.FlatShading}function setParticleBuffers(geometry,hint,object){var v,c,vertex,offset,color,vertices=geometry.vertices,vl=vertices.length,colors=geometry.colors,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){cal=customAttribute.value.length;offset=0;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);customAttribute.needsUpdate=false}}}function setLineBuffers(geometry,hint){var v,c,d,vertex,offset,color,vertices=geometry.vertices,colors=geometry.colors,lineDistances=geometry.lineDistances,vl=vertices.length,cl=colors.length,dl=lineDistances.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,lineDistanceArray=geometry.__lineDistanceArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyLineDistances=geometry.lineDistancesNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(dirtyLineDistances){for(d=0;d<dl;d++){lineDistanceArray[d]=lineDistances[d]}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglLineDistanceBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,lineDistanceArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);customAttribute.needsUpdate=false}}}}function setMeshBuffers(geometryGroup,object,hint,dispose,material){if(!geometryGroup.__inittedArrays){return}var needsFaceNormals=materialNeedsFaceNormals(material);var f,fl,fi,face,vertexNormals,faceNormal,vertexColors,faceColor,vertexTangents,uv,uv2,v1,v2,v3,t1,t2,t3,n1,n2,n3,c1,c2,c3,sw1,sw2,sw3,si1,si2,si3,i,il,vn,uvi,uv2i,vk,vkl,vka,nka,chf,faceVertexNormals,vertexIndex=0,offset=0,offset_uv=0,offset_uv2=0,offset_face=0,offset_normal=0,offset_tangent=0,offset_line=0,offset_color=0,offset_skin=0,offset_morphTarget=0,offset_custom=0,value,vertexArray=geometryGroup.__vertexArray,uvArray=geometryGroup.__uvArray,uv2Array=geometryGroup.__uv2Array,normalArray=geometryGroup.__normalArray,tangentArray=geometryGroup.__tangentArray,colorArray=geometryGroup.__colorArray,skinIndexArray=geometryGroup.__skinIndexArray,skinWeightArray=geometryGroup.__skinWeightArray,morphTargetsArrays=geometryGroup.__morphTargetsArrays,morphNormalsArrays=geometryGroup.__morphNormalsArrays,customAttributes=geometryGroup.__webglCustomAttributesList,customAttribute,faceArray=geometryGroup.__faceArray,lineArray=geometryGroup.__lineArray,geometry=object.geometry,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyUvs=geometry.uvsNeedUpdate,dirtyNormals=geometry.normalsNeedUpdate,dirtyTangents=geometry.tangentsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyMorphTargets=geometry.morphTargetsNeedUpdate,vertices=geometry.vertices,chunk_faces3=geometryGroup.faces3,obj_faces=geometry.faces,obj_uvs=geometry.faceVertexUvs[0],obj_uvs2=geometry.faceVertexUvs[1],obj_skinIndices=geometry.skinIndices,obj_skinWeights=geometry.skinWeights,morphTargets=geometry.morphTargets,morphNormals=geometry.morphNormals;if(dirtyVertices){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=vertices[face.a];v2=vertices[face.b];v3=vertices[face.c];vertexArray[offset]=v1.x;vertexArray[offset+1]=v1.y;vertexArray[offset+2]=v1.z;vertexArray[offset+3]=v2.x;vertexArray[offset+4]=v2.y;vertexArray[offset+5]=v2.z;vertexArray[offset+6]=v3.x;vertexArray[offset+7]=v3.y;vertexArray[offset+8]=v3.z;offset+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyMorphTargets){for(vk=0,vkl=morphTargets.length;vk<vkl;vk++){offset_morphTarget=0;for(f=0,fl=chunk_faces3.length;f<fl;f++){chf=chunk_faces3[f];face=obj_faces[chf];v1=morphTargets[vk].vertices[face.a];v2=morphTargets[vk].vertices[face.b];v3=morphTargets[vk].vertices[face.c];vka=morphTargetsArrays[vk];vka[offset_morphTarget]=v1.x;vka[offset_morphTarget+1]=v1.y;vka[offset_morphTarget+2]=v1.z;vka[offset_morphTarget+3]=v2.x;vka[offset_morphTarget+4]=v2.y;vka[offset_morphTarget+5]=v2.z;vka[offset_morphTarget+6]=v3.x;vka[offset_morphTarget+7]=v3.y;vka[offset_morphTarget+8]=v3.z;if(material.morphNormals){if(needsFaceNormals){n1=morphNormals[vk].faceNormals[chf];n2=n1;n3=n1}else{faceVertexNormals=morphNormals[vk].vertexNormals[chf];n1=faceVertexNormals.a;n2=faceVertexNormals.b;n3=faceVertexNormals.c}nka=morphNormalsArrays[vk];nka[offset_morphTarget]=n1.x;nka[offset_morphTarget+1]=n1.y;nka[offset_morphTarget+2]=n1.z;nka[offset_morphTarget+3]=n2.x;nka[offset_morphTarget+4]=n2.y;nka[offset_morphTarget+5]=n2.z;nka[offset_morphTarget+6]=n3.x;nka[offset_morphTarget+7]=n3.y;nka[offset_morphTarget+8]=n3.z}offset_morphTarget+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphTargetsArrays[vk],hint);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphNormalsArrays[vk],hint)}}}if(obj_skinWeights.length){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];sw1=obj_skinWeights[face.a];sw2=obj_skinWeights[face.b];sw3=obj_skinWeights[face.c];skinWeightArray[offset_skin]=sw1.x;skinWeightArray[offset_skin+1]=sw1.y;skinWeightArray[offset_skin+2]=sw1.z;skinWeightArray[offset_skin+3]=sw1.w;skinWeightArray[offset_skin+4]=sw2.x;skinWeightArray[offset_skin+5]=sw2.y;skinWeightArray[offset_skin+6]=sw2.z;skinWeightArray[offset_skin+7]=sw2.w;skinWeightArray[offset_skin+8]=sw3.x;skinWeightArray[offset_skin+9]=sw3.y;skinWeightArray[offset_skin+10]=sw3.z;skinWeightArray[offset_skin+11]=sw3.w;si1=obj_skinIndices[face.a];si2=obj_skinIndices[face.b];si3=obj_skinIndices[face.c];skinIndexArray[offset_skin]=si1.x;skinIndexArray[offset_skin+1]=si1.y;skinIndexArray[offset_skin+2]=si1.z;skinIndexArray[offset_skin+3]=si1.w;skinIndexArray[offset_skin+4]=si2.x;skinIndexArray[offset_skin+5]=si2.y;skinIndexArray[offset_skin+6]=si2.z;skinIndexArray[offset_skin+7]=si2.w;skinIndexArray[offset_skin+8]=si3.x;skinIndexArray[offset_skin+9]=si3.y;skinIndexArray[offset_skin+10]=si3.z;skinIndexArray[offset_skin+11]=si3.w;offset_skin+=12}if(offset_skin>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinIndexArray,hint);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinWeightArray,hint)}}if(dirtyColors){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexColors=face.vertexColors;faceColor=face.color;if(vertexColors.length===3&&material.vertexColors===THREE.VertexColors){c1=vertexColors[0];c2=vertexColors[1];c3=vertexColors[2]}else{c1=faceColor;c2=faceColor;c3=faceColor}colorArray[offset_color]=c1.r;colorArray[offset_color+1]=c1.g;colorArray[offset_color+2]=c1.b;colorArray[offset_color+3]=c2.r;colorArray[offset_color+4]=c2.g;colorArray[offset_color+5]=c2.b;colorArray[offset_color+6]=c3.r;colorArray[offset_color+7]=c3.g;colorArray[offset_color+8]=c3.b;offset_color+=9}if(offset_color>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}}if(dirtyTangents&&geometry.hasTangents){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexTangents=face.vertexTangents;t1=vertexTangents[0];t2=vertexTangents[1];t3=vertexTangents[2];tangentArray[offset_tangent]=t1.x;tangentArray[offset_tangent+1]=t1.y;tangentArray[offset_tangent+2]=t1.z;tangentArray[offset_tangent+3]=t1.w;tangentArray[offset_tangent+4]=t2.x;tangentArray[offset_tangent+5]=t2.y;tangentArray[offset_tangent+6]=t2.z;tangentArray[offset_tangent+7]=t2.w;tangentArray[offset_tangent+8]=t3.x;tangentArray[offset_tangent+9]=t3.y;tangentArray[offset_tangent+10]=t3.z;tangentArray[offset_tangent+11]=t3.w;offset_tangent+=12}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,tangentArray,hint)}if(dirtyNormals){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexNormals=face.vertexNormals;faceNormal=face.normal;if(vertexNormals.length===3&&needsFaceNormals===false){for(i=0;i<3;i++){vn=vertexNormals[i];normalArray[offset_normal]=vn.x;normalArray[offset_normal+1]=vn.y;normalArray[offset_normal+2]=vn.z;offset_normal+=3}}else{for(i=0;i<3;i++){normalArray[offset_normal]=faceNormal.x;normalArray[offset_normal+1]=faceNormal.y;normalArray[offset_normal+2]=faceNormal.z;offset_normal+=3}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint)}if(dirtyUvs&&obj_uvs){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv=obj_uvs[fi];if(uv===undefined)continue;for(i=0;i<3;i++){uvi=uv[i];uvArray[offset_uv]=uvi.x;uvArray[offset_uv+1]=uvi.y;offset_uv+=2}}if(offset_uv>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,uvArray,hint)}}if(dirtyUvs&&obj_uvs2){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv2=obj_uvs2[fi];if(uv2===undefined)continue;for(i=0;i<3;i++){uv2i=uv2[i];uv2Array[offset_uv2]=uv2i.x;uv2Array[offset_uv2+1]=uv2i.y;offset_uv2+=2}}if(offset_uv2>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);_gl.bufferData(_gl.ARRAY_BUFFER,uv2Array,hint)}}if(dirtyElements){for(f=0,fl=chunk_faces3.length;f<fl;f++){faceArray[offset_face]=vertexIndex;faceArray[offset_face+1]=vertexIndex+1;faceArray[offset_face+2]=vertexIndex+2;offset_face+=3;lineArray[offset_line]=vertexIndex;lineArray[offset_line+1]=vertexIndex+1;lineArray[offset_line+2]=vertexIndex;lineArray[offset_line+3]=vertexIndex+2;lineArray[offset_line+4]=vertexIndex+1;lineArray[offset_line+5]=vertexIndex+2;offset_line+=6;vertexIndex+=3}_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!customAttribute.__original.needsUpdate)continue;offset_custom=0;if(customAttribute.size===1){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];customAttribute.array[offset_custom]=customAttribute.value[face.a];customAttribute.array[offset_custom+1]=customAttribute.value[face.b];customAttribute.array[offset_custom+2]=customAttribute.value[face.c];offset_custom+=3}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];customAttribute.array[offset_custom]=value;customAttribute.array[offset_custom+1]=value;customAttribute.array[offset_custom+2]=value;offset_custom+=3}}}else if(customAttribute.size===2){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}}else if(customAttribute.size===3){var pp;if(customAttribute.type==="c"){pp=["r","g","b"]}else{pp=["x","y","z"]}if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}}else if(customAttribute.size===4){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint)}}if(dispose){delete geometryGroup.__inittedArrays;delete geometryGroup.__colorArray;delete geometryGroup.__normalArray;delete geometryGroup.__tangentArray;delete geometryGroup.__uvArray;delete geometryGroup.__uv2Array;delete geometryGroup.__faceArray;delete geometryGroup.__vertexArray;delete geometryGroup.__lineArray;delete geometryGroup.__skinIndexArray;delete geometryGroup.__skinWeightArray}}this.renderBufferImmediate=function(object,program,material){state.initAttributes();if(object.hasPositions&&!object.__webglVertexBuffer)object.__webglVertexBuffer=_gl.createBuffer();if(object.hasNormals&&!object.__webglNormalBuffer)object.__webglNormalBuffer=_gl.createBuffer();if(object.hasUvs&&!object.__webglUvBuffer)object.__webglUvBuffer=_gl.createBuffer();if(object.hasColors&&!object.__webglColorBuffer)object.__webglColorBuffer=_gl.createBuffer();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.position);_gl.vertexAttribPointer(program.attributes.position,3,_gl.FLOAT,false,0,0)}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglNormalBuffer);if(material instanceof THREE.MeshPhongMaterial===false&&material.shading===THREE.FlatShading){var nx,ny,nz,nax,nbx,ncx,nay,nby,ncy,naz,nbz,ncz,normalArray,i,il=object.count*3;for(i=0;i<il;i+=9){normalArray=object.normalArray;nax=normalArray[i];nay=normalArray[i+1];naz=normalArray[i+2];nbx=normalArray[i+3];nby=normalArray[i+4];nbz=normalArray[i+5];ncx=normalArray[i+6];ncy=normalArray[i+7];ncz=normalArray[i+8];nx=(nax+nbx+ncx)/3;ny=(nay+nby+ncy)/3;nz=(naz+nbz+ncz)/3;normalArray[i]=nx;normalArray[i+1]=ny;normalArray[i+2]=nz;normalArray[i+3]=nx;normalArray[i+4]=ny;normalArray[i+5]=nz;normalArray[i+6]=nx;normalArray[i+7]=ny;normalArray[i+8]=nz}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.normal);_gl.vertexAttribPointer(program.attributes.normal,3,_gl.FLOAT,false,0,0)}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglUvBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.uv);_gl.vertexAttribPointer(program.attributes.uv,2,_gl.FLOAT,false,0,0)}if(object.hasColors&&material.vertexColors!==THREE.NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.color);_gl.vertexAttribPointer(program.attributes.color,3,_gl.FLOAT,false,0,0)}state.disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0};function setupVertexAttributes(material,program,geometry,startIndex){var geometryAttributes=geometry.attributes;var programAttributes=program.attributes;var programAttributesKeys=program.attributesKeys;for(var i=0,l=programAttributesKeys.length;i<l;i++){var key=programAttributesKeys[i];var programAttribute=programAttributes[key];if(programAttribute>=0){var geometryAttribute=geometryAttributes[key];if(geometryAttribute!==undefined){var size=geometryAttribute.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryAttribute.buffer);state.enableAttribute(programAttribute);_gl.vertexAttribPointer(programAttribute,size,_gl.FLOAT,false,0,startIndex*size*4)}else if(material.defaultAttributeValues!==undefined){if(material.defaultAttributeValues[key].length===2){_gl.vertexAttrib2fv(programAttribute,material.defaultAttributeValues[key])}else if(material.defaultAttributeValues[key].length===3){_gl.vertexAttrib3fv(programAttribute,material.defaultAttributeValues[key])}}}}state.disableUnusedAttributes()}this.renderBufferDirect=function(camera,lights,fog,material,geometry,object){if(material.visible===false)return;updateObject(object);var program=setProgram(camera,lights,fog,material,object);var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryProgram="direct_"+geometry.id+"_"+program.id+"_"+wireframeBit;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true}if(updateBuffers){state.initAttributes()}if(object instanceof THREE.Mesh){var mode=material.wireframe===true?_gl.LINES:_gl.TRIANGLES;var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length;_this.info.render.faces+=index.array.length/3}else{updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count;_this.info.render.faces+=offsets[i].count/3}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes["position"];_gl.drawArrays(mode,0,position.array.length/position.itemSize);_this.info.render.calls++;_this.info.render.vertices+=position.array.length/position.itemSize;
_this.info.render.faces+=position.array.length/(3*position.itemSize)}}else if(object instanceof THREE.PointCloud){var mode=_gl.POINTS;var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.points+=index.array.length}else{if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.points+=offsets[i].count}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;var offsets=geometry.offsets;if(offsets.length===0){_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.points+=position.array.length/3}else{for(var i=0,il=offsets.length;i<il;i++){_gl.drawArrays(mode,offsets[i].index,offsets[i].count);_this.info.render.calls++;_this.info.render.points+=offsets[i].count}}}}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;state.setLineWidth(material.linewidth*pixelRatio);var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length}else{if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;var offsets=geometry.offsets;if(offsets.length===0){_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.vertices+=position.array.length/3}else{for(var i=0,il=offsets.length;i<il;i++){_gl.drawArrays(mode,offsets[i].index,offsets[i].count);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count}}}}};this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible===false)return;updateObject(object);var program=setProgram(camera,lights,fog,material,object);var attributes=program.attributes;var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryProgram=geometryGroup.id+"_"+program.id+"_"+wireframeBit;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true}if(updateBuffers){state.initAttributes()}if(!material.morphTargets&&attributes.position>=0){if(updateBuffers){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}}else{if(object.morphTargetBase){setupMorphTargets(material,geometryGroup,object)}}if(updateBuffers){if(geometryGroup.__webglCustomAttributesList){for(var i=0,il=geometryGroup.__webglCustomAttributesList.length;i<il;i++){var attribute=geometryGroup.__webglCustomAttributesList[i];if(attributes[attribute.buffer.belongsToAttribute]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,attribute.buffer);state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);_gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute],attribute.size,_gl.FLOAT,false,0,0)}}}if(attributes.color>=0){if(object.geometry.colors.length>0||object.geometry.faces.length>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);state.enableAttribute(attributes.color);_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib3fv(attributes.color,material.defaultAttributeValues.color)}}if(attributes.normal>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);state.enableAttribute(attributes.normal);_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,false,0,0)}if(attributes.tangent>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);state.enableAttribute(attributes.tangent);_gl.vertexAttribPointer(attributes.tangent,4,_gl.FLOAT,false,0,0)}if(attributes.uv>=0){if(object.geometry.faceVertexUvs[0]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);state.enableAttribute(attributes.uv);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv,material.defaultAttributeValues.uv)}}if(attributes.uv2>=0){if(object.geometry.faceVertexUvs[1]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);state.enableAttribute(attributes.uv2);_gl.vertexAttribPointer(attributes.uv2,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv2,material.defaultAttributeValues.uv2)}}if(material.skinning&&attributes.skinIndex>=0&&attributes.skinWeight>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);state.enableAttribute(attributes.skinIndex);_gl.vertexAttribPointer(attributes.skinIndex,4,_gl.FLOAT,false,0,0);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);state.enableAttribute(attributes.skinWeight);_gl.vertexAttribPointer(attributes.skinWeight,4,_gl.FLOAT,false,0,0)}if(attributes.lineDistance>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglLineDistanceBuffer);state.enableAttribute(attributes.lineDistance);_gl.vertexAttribPointer(attributes.lineDistance,1,_gl.FLOAT,false,0,0)}}state.disableUnusedAttributes();if(object instanceof THREE.Mesh){var type=geometryGroup.__typeArray===Uint32Array?_gl.UNSIGNED_INT:_gl.UNSIGNED_SHORT;if(material.wireframe){state.setLineWidth(material.wireframeLinewidth*pixelRatio);if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.drawElements(_gl.LINES,geometryGroup.__webglLineCount,type,0)}else{if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.drawElements(_gl.TRIANGLES,geometryGroup.__webglFaceCount,type,0)}_this.info.render.calls++;_this.info.render.vertices+=geometryGroup.__webglFaceCount;_this.info.render.faces+=geometryGroup.__webglFaceCount/3}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;state.setLineWidth(material.linewidth*pixelRatio);_gl.drawArrays(mode,0,geometryGroup.__webglLineCount);_this.info.render.calls++}else if(object instanceof THREE.PointCloud){_gl.drawArrays(_gl.POINTS,0,geometryGroup.__webglParticleCount);_this.info.render.calls++;_this.info.render.points+=geometryGroup.__webglParticleCount}};function setupMorphTargets(material,geometryGroup,object){var attributes=material.program.attributes;if(object.morphTargetBase!==-1&&attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}else if(attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}if(object.morphTargetForcedOrder.length){var m=0;var order=object.morphTargetForcedOrder;var influences=object.morphTargetInfluences;var attribute;while(m<material.numSupportedMorphTargets&&m<order.length){attribute=attributes["morphTarget"+m];if(attribute>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[order[m]]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}attribute=attributes["morphNormal"+m];if(attribute>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[order[m]]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[order[m]];m++}}else{var activeInfluenceIndices=[];var influences=object.morphTargetInfluences;var morphTargets=object.geometry.morphTargets;if(influences.length>morphTargets.length){console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array.");influences.length=morphTargets.length}for(var i=0,il=influences.length;i<il;i++){var influence=influences[i];activeInfluenceIndices.push([influence,i])}if(activeInfluenceIndices.length>material.numSupportedMorphTargets){activeInfluenceIndices.sort(numericalSort);activeInfluenceIndices.length=material.numSupportedMorphTargets}else if(activeInfluenceIndices.length>material.numSupportedMorphNormals){activeInfluenceIndices.sort(numericalSort)}else if(activeInfluenceIndices.length===0){activeInfluenceIndices.push([0,0])}var attribute;for(var m=0,ml=material.numSupportedMorphTargets;m<ml;m++){if(activeInfluenceIndices[m]){var influenceIndex=activeInfluenceIndices[m][1];attribute=attributes["morphTarget"+m];if(attribute>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}attribute=attributes["morphNormal"+m];if(attribute>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[influenceIndex]}else{object.__webglMorphTargetInfluences[m]=0}}}if(material.program.uniforms.morphTargetInfluences!==null){_gl.uniform1fv(material.program.uniforms.morphTargetInfluences,object.__webglMorphTargetInfluences)}}function painterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}else if(a.material.id!==b.material.id){return a.material.id-b.material.id}else if(a.z!==b.z){return a.z-b.z}else{return a.id-b.id}}function reversePainterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}function numericalSort(a,b){return b[0]-a[0]}this.render=function(scene,camera,renderTarget,forceClear){if(camera instanceof THREE.Camera===false){THREE.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var fog=scene.fog;_currentGeometryProgram="";_currentMaterialId=-1;_currentCamera=null;_lightsNeedUpdate=true;if(scene.autoUpdate===true)scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();scene.traverse(function(object){if(object instanceof THREE.SkinnedMesh){object.skeleton.update()}});camera.matrixWorldInverse.getInverse(camera.matrixWorld);_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);lights.length=0;opaqueObjects.length=0;transparentObjects.length=0;sprites.length=0;lensFlares.length=0;projectObject(scene);if(_this.sortObjects===true){opaqueObjects.sort(painterSortStable);transparentObjects.sort(reversePainterSortStable)}shadowMapPlugin.render(scene,camera);_this.info.render.calls=0;_this.info.render.vertices=0;_this.info.render.faces=0;_this.info.render.points=0;this.setRenderTarget(renderTarget);if(this.autoClear||forceClear){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var i=0,il=_webglObjectsImmediate.length;i<il;i++){var webglObject=_webglObjectsImmediate[i];var object=webglObject.object;if(object.visible){setupMatrices(object,camera);unrollImmediateBufferMaterial(webglObject)}}if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;setMaterial(overrideMaterial);renderObjects(opaqueObjects,camera,lights,fog,overrideMaterial);renderObjects(transparentObjects,camera,lights,fog,overrideMaterial);renderObjectsImmediate(_webglObjectsImmediate,"",camera,lights,fog,overrideMaterial)}else{state.setBlending(THREE.NoBlending);renderObjects(opaqueObjects,camera,lights,fog,null);renderObjectsImmediate(_webglObjectsImmediate,"opaque",camera,lights,fog,null);renderObjects(transparentObjects,camera,lights,fog,null);renderObjectsImmediate(_webglObjectsImmediate,"transparent",camera,lights,fog,null)}spritePlugin.render(scene,camera);lensFlarePlugin.render(scene,camera,_currentWidth,_currentHeight);if(renderTarget&&renderTarget.generateMipmaps&&renderTarget.minFilter!==THREE.NearestFilter&&renderTarget.minFilter!==THREE.LinearFilter){updateRenderTargetMipmap(renderTarget)}state.setDepthTest(true);state.setDepthWrite(true);state.setColorWrite(true)};function projectObject(object){if(object.visible===false)return;if(object instanceof THREE.Scene||object instanceof THREE.Group){}else{initObject(object);if(object instanceof THREE.Light){lights.push(object)}else if(object instanceof THREE.Sprite){sprites.push(object)}else if(object instanceof THREE.LensFlare){lensFlares.push(object)}else{var webglObjects=_webglObjects[object.id];if(webglObjects&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];unrollBufferMaterial(webglObject);webglObject.render=true;if(_this.sortObjects===true){_vector3.setFromMatrixPosition(object.matrixWorld);_vector3.applyProjection(_projScreenMatrix);webglObject.z=_vector3.z}}}}}for(var i=0,l=object.children.length;i<l;i++){projectObject(object.children[i])}}function renderObjects(renderList,camera,lights,fog,overrideMaterial){var material;for(var i=0,l=renderList.length;i<l;i++){var webglObject=renderList[i];var object=webglObject.object;var buffer=webglObject.buffer;setupMatrices(object,camera);if(overrideMaterial){material=overrideMaterial}else{material=webglObject.material;if(!material)continue;setMaterial(material)}_this.setMaterialFaces(material);if(buffer instanceof THREE.BufferGeometry){_this.renderBufferDirect(camera,lights,fog,material,buffer,object)}else{_this.renderBuffer(camera,lights,fog,material,buffer,object)}}}function renderObjectsImmediate(renderList,materialType,camera,lights,fog,overrideMaterial){var material;for(var i=0,l=renderList.length;i<l;i++){var webglObject=renderList[i];var object=webglObject.object;if(object.visible){if(overrideMaterial){material=overrideMaterial}else{material=webglObject[materialType];if(!material)continue;setMaterial(material)}_this.renderImmediateObject(camera,lights,fog,material,object)}}}this.renderImmediateObject=function(camera,lights,fog,material,object){var program=setProgram(camera,lights,fog,material,object);_currentGeometryProgram="";_this.setMaterialFaces(material);if(object.immediateRenderCallback){object.immediateRenderCallback(program,_gl,_frustum)}else{object.render(function(object){_this.renderBufferImmediate(object,program,material)})}};function unrollImmediateBufferMaterial(globject){var object=globject.object,material=object.material;if(material.transparent){globject.transparent=material;globject.opaque=null}else{globject.opaque=material;globject.transparent=null}}function unrollBufferMaterial(globject){var object=globject.object;var buffer=globject.buffer;var geometry=object.geometry;var material=object.material;if(material instanceof THREE.MeshFaceMaterial){var materialIndex=geometry instanceof THREE.BufferGeometry?0:buffer.materialIndex;material=material.materials[materialIndex];globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}else if(material){globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}}function initObject(object){if(object.__webglInit===undefined){object.__webglInit=true;object._modelViewMatrix=new THREE.Matrix4;object._normalMatrix=new THREE.Matrix3;object.addEventListener("removed",onObjectRemoved)}var geometry=object.geometry;if(geometry===undefined){}else if(geometry.__webglInit===undefined){geometry.__webglInit=true;geometry.addEventListener("dispose",onGeometryDispose);if(geometry instanceof THREE.BufferGeometry){_this.info.memory.geometries++}else if(object instanceof THREE.Mesh){initGeometryGroups(object,geometry)}else if(object instanceof THREE.Line){if(geometry.__webglVertexBuffer===undefined){createLineBuffers(geometry);initLineBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;geometry.lineDistancesNeedUpdate=true}}else if(object instanceof THREE.PointCloud){if(geometry.__webglVertexBuffer===undefined){createParticleBuffers(geometry);initParticleBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true}}}if(object.__webglActive===undefined){object.__webglActive=true;if(object instanceof THREE.Mesh){if(geometry instanceof THREE.BufferGeometry){addBuffer(_webglObjects,geometry,object)}else if(geometry instanceof THREE.Geometry){var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,l=geometryGroupsList.length;i<l;i++){addBuffer(_webglObjects,geometryGroupsList[i],object)}}}else if(object instanceof THREE.Line||object instanceof THREE.PointCloud){addBuffer(_webglObjects,geometry,object)}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){addBufferImmediate(_webglObjectsImmediate,object)}}}var geometryGroups={};var geometryGroupCounter=0;function makeGroups(geometry,usesFaceMaterial){var maxVerticesInGroup=extensions.get("OES_element_index_uint")?4294967296:65535;var groupHash,hash_map={};var numMorphTargets=geometry.morphTargets.length;var numMorphNormals=geometry.morphNormals.length;var group;var groups={};var groupsList=[];for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var materialIndex=usesFaceMaterial?face.materialIndex:0;if(!(materialIndex in hash_map)){hash_map[materialIndex]={hash:materialIndex,counter:0}}groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}if(groups[groupHash].vertices+3>maxVerticesInGroup){hash_map[materialIndex].counter+=1;groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}}groups[groupHash].faces3.push(f);groups[groupHash].vertices+=3}return groupsList}function initGeometryGroups(object,geometry){var material=object.material,addBuffers=false;if(geometryGroups[geometry.id]===undefined||geometry.groupsNeedUpdate===true){delete _webglObjects[object.id];geometryGroups[geometry.id]=makeGroups(geometry,material instanceof THREE.MeshFaceMaterial);geometry.groupsNeedUpdate=false}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.__webglVertexBuffer===undefined){createMeshBuffers(geometryGroup);initMeshBuffers(geometryGroup,object);geometry.verticesNeedUpdate=true;geometry.morphTargetsNeedUpdate=true;geometry.elementsNeedUpdate=true;geometry.uvsNeedUpdate=true;geometry.normalsNeedUpdate=true;geometry.tangentsNeedUpdate=true;geometry.colorsNeedUpdate=true;addBuffers=true}else{addBuffers=false}if(addBuffers||object.__webglActive===undefined){addBuffer(_webglObjects,geometryGroup,object)}}object.__webglActive=true}function addBuffer(objlist,buffer,object){var id=object.id;objlist[id]=objlist[id]||[];objlist[id].push({id:id,buffer:buffer,object:object,material:null,z:0})}function addBufferImmediate(objlist,object){objlist.push({id:null,object:object,opaque:null,transparent:null,z:0})}function updateObject(object){var geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;var attributesKeys=geometry.attributesKeys;for(var i=0,l=attributesKeys.length;i<l;i++){var key=attributesKeys[i];var attribute=attributes[key];var bufferType=key==="index"?_gl.ELEMENT_ARRAY_BUFFER:_gl.ARRAY_BUFFER;if(attribute.buffer===undefined){attribute.buffer=_gl.createBuffer();_gl.bindBuffer(bufferType,attribute.buffer);_gl.bufferData(bufferType,attribute.array,attribute instanceof THREE.DynamicBufferAttribute?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW);attribute.needsUpdate=false}else if(attribute.needsUpdate===true){_gl.bindBuffer(bufferType,attribute.buffer);if(attribute.updateRange===undefined||attribute.updateRange.count===-1){_gl.bufferSubData(bufferType,0,attribute.array)}else if(attribute.updateRange.count===0){console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.")}else{_gl.bufferSubData(bufferType,attribute.updateRange.offset*attribute.array.BYTES_PER_ELEMENT,attribute.array.subarray(attribute.updateRange.offset,attribute.updateRange.offset+attribute.updateRange.count));attribute.updateRange.count=0}attribute.needsUpdate=false}}}else if(object instanceof THREE.Mesh){if(geometry.groupsNeedUpdate===true){initGeometryGroups(object,geometry)}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];var material=getBufferMaterial(object,geometryGroup);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.morphTargetsNeedUpdate||geometry.elementsNeedUpdate||geometry.uvsNeedUpdate||geometry.normalsNeedUpdate||geometry.colorsNeedUpdate||geometry.tangentsNeedUpdate||customAttributesDirty){setMeshBuffers(geometryGroup,object,_gl.DYNAMIC_DRAW,!geometry.dynamic,material)}}geometry.verticesNeedUpdate=false;geometry.morphTargetsNeedUpdate=false;geometry.elementsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.tangentsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.Line){var material=getBufferMaterial(object,geometry);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||geometry.lineDistancesNeedUpdate||customAttributesDirty){setLineBuffers(geometry,_gl.DYNAMIC_DRAW)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.lineDistancesNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.PointCloud){var material=getBufferMaterial(object,geometry);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||customAttributesDirty){setParticleBuffers(geometry,_gl.DYNAMIC_DRAW,object)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}}function areCustomAttributesDirty(material){for(var name in material.attributes){if(material.attributes[name].needsUpdate)return true}return false}function clearCustomAttributes(material){for(var name in material.attributes){material.attributes[name].needsUpdate=false}}function removeObject(object){if(object instanceof THREE.Mesh||object instanceof THREE.PointCloud||object instanceof THREE.Line){delete _webglObjects[object.id]}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){removeInstances(_webglObjectsImmediate,object)}delete object.__webglInit;delete object._modelViewMatrix;delete object._normalMatrix;delete object.__webglActive}function removeInstances(objlist,object){for(var o=objlist.length-1;o>=0;o--){if(objlist[o].object===object){objlist.splice(o,1)}}}var shaderIDs={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function initMaterial(material,lights,fog,object){material.addEventListener("dispose",onMaterialDispose);var shaderID=shaderIDs[material.type];if(shaderID){var shader=THREE.ShaderLib[shaderID];material.__webglShader={uniforms:THREE.UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else{material.__webglShader={uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader}}var maxLightCount=allocateLights(lights);var maxShadows=allocateShadows(lights);var maxBones=allocateBones(object);var parameters={precision:_precision,supportsVertexTextures:_supportsVertexTextures,map:!!material.map,envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,lightMap:!!material.lightMap,bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,combine:material.combine,vertexColors:material.vertexColors,fog:fog,useFog:material.fog,fogExp:fog instanceof THREE.FogExp2,flatShading:material.shading===THREE.FlatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:_logarithmicDepthBuffer,skinning:material.skinning,maxBones:maxBones,useVertexTexture:_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:_this.maxMorphTargets,maxMorphNormals:_this.maxMorphNormals,maxDirLights:maxLightCount.directional,maxPointLights:maxLightCount.point,maxSpotLights:maxLightCount.spot,maxHemiLights:maxLightCount.hemi,maxShadows:maxShadows,shadowMapEnabled:_this.shadowMapEnabled&&object.receiveShadow&&maxShadows>0,shadowMapType:_this.shadowMapType,shadowMapDebug:_this.shadowMapDebug,shadowMapCascade:_this.shadowMapCascade,alphaTest:material.alphaTest,metal:material.metal,wrapAround:material.wrapAround,doubleSided:material.side===THREE.DoubleSide,flipSided:material.side===THREE.BackSide};var chunks=[];if(shaderID){chunks.push(shaderID)}else{chunks.push(material.fragmentShader);chunks.push(material.vertexShader)}if(material.defines!==undefined){for(var name in material.defines){chunks.push(name);chunks.push(material.defines[name])}}for(var name in parameters){chunks.push(name);chunks.push(parameters[name])}var code=chunks.join();var program;for(var p=0,pl=_programs.length;p<pl;p++){var programInfo=_programs[p];if(programInfo.code===code){program=programInfo;program.usedTimes++;break}}if(program===undefined){program=new THREE.WebGLProgram(_this,code,material,parameters);_programs.push(program);_this.info.memory.programs=_programs.length}material.program=program;var attributes=program.attributes;if(material.morphTargets){material.numSupportedMorphTargets=0;var id,base="morphTarget";for(var i=0;i<_this.maxMorphTargets;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphTargets++}}}if(material.morphNormals){material.numSupportedMorphNormals=0;var id,base="morphNormal";for(i=0;i<_this.maxMorphNormals;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphNormals++}}}material.uniformsList=[];for(var u in material.__webglShader.uniforms){var location=material.program.uniforms[u];if(location){material.uniformsList.push([material.__webglShader.uniforms[u],location])}}}function setMaterial(material){if(material.transparent===true){state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha)}else{state.setBlending(THREE.NoBlending)}state.setDepthTest(material.depthTest);state.setDepthWrite(material.depthWrite);state.setColorWrite(material.colorWrite);state.setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}function setProgram(camera,lights,fog,material,object){_usedTextureUnits=0;if(material.needsUpdate){if(material.program)deallocateMaterial(material);initMaterial(material,lights,fog,object);material.needsUpdate=false}if(material.morphTargets){if(!object.__webglMorphTargetInfluences){object.__webglMorphTargetInfluences=new Float32Array(_this.maxMorphTargets)}}var refreshProgram=false;var refreshMaterial=false;var refreshLights=false;var program=material.program,p_uniforms=program.uniforms,m_uniforms=material.__webglShader.uniforms;if(program.id!==_currentProgram){_gl.useProgram(program.program);_currentProgram=program.id;refreshProgram=true;refreshMaterial=true;refreshLights=true}if(material.id!==_currentMaterialId){if(_currentMaterialId===-1)refreshLights=true;_currentMaterialId=material.id;refreshMaterial=true}if(refreshProgram||camera!==_currentCamera){_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,false,camera.projectionMatrix.elements);if(_logarithmicDepthBuffer){_gl.uniform1f(p_uniforms.logDepthBufFC,2/(Math.log(camera.far+1)/Math.LN2))}if(camera!==_currentCamera)_currentCamera=camera;if(material instanceof THREE.ShaderMaterial||material instanceof THREE.MeshPhongMaterial||material.envMap){if(p_uniforms.cameraPosition!==null){_vector3.setFromMatrixPosition(camera.matrixWorld);_gl.uniform3f(p_uniforms.cameraPosition,_vector3.x,_vector3.y,_vector3.z)}}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshBasicMaterial||material instanceof THREE.ShaderMaterial||material.skinning){if(p_uniforms.viewMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.viewMatrix,false,camera.matrixWorldInverse.elements)}}}if(material.skinning){if(object.bindMatrix&&p_uniforms.bindMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrix,false,object.bindMatrix.elements)}if(object.bindMatrixInverse&&p_uniforms.bindMatrixInverse!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse,false,object.bindMatrixInverse.elements)}if(_supportsBoneTextures&&object.skeleton&&object.skeleton.useVertexTexture){if(p_uniforms.boneTexture!==null){var textureUnit=getTextureUnit();_gl.uniform1i(p_uniforms.boneTexture,textureUnit);_this.setTexture(object.skeleton.boneTexture,textureUnit)}if(p_uniforms.boneTextureWidth!==null){_gl.uniform1i(p_uniforms.boneTextureWidth,object.skeleton.boneTextureWidth)}if(p_uniforms.boneTextureHeight!==null){_gl.uniform1i(p_uniforms.boneTextureHeight,object.skeleton.boneTextureHeight)}}else if(object.skeleton&&object.skeleton.boneMatrices){if(p_uniforms.boneGlobalMatrices!==null){_gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices,false,object.skeleton.boneMatrices)}}}if(refreshMaterial){if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog)}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material.lights){if(_lightsNeedUpdate){refreshLights=true;setupLights(lights);_lightsNeedUpdate=false}if(refreshLights){refreshUniformsLights(m_uniforms,_lights);markUniformsLightsNeedsUpdate(m_uniforms,true)}else{markUniformsLightsNeedsUpdate(m_uniforms,false)}}if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){
refreshUniformsCommon(m_uniforms,material)}if(material instanceof THREE.LineBasicMaterial){refreshUniformsLine(m_uniforms,material)}else if(material instanceof THREE.LineDashedMaterial){refreshUniformsLine(m_uniforms,material);refreshUniformsDash(m_uniforms,material)}else if(material instanceof THREE.PointCloudMaterial){refreshUniformsParticle(m_uniforms,material)}else if(material instanceof THREE.MeshPhongMaterial){refreshUniformsPhong(m_uniforms,material)}else if(material instanceof THREE.MeshLambertMaterial){refreshUniformsLambert(m_uniforms,material)}else if(material instanceof THREE.MeshDepthMaterial){m_uniforms.mNear.value=camera.near;m_uniforms.mFar.value=camera.far;m_uniforms.opacity.value=material.opacity}else if(material instanceof THREE.MeshNormalMaterial){m_uniforms.opacity.value=material.opacity}if(object.receiveShadow&&!material._shadowPass){refreshUniformsShadow(m_uniforms,lights)}loadUniformsGeneric(material.uniformsList)}loadUniformsMatrices(p_uniforms,object);if(p_uniforms.modelMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.modelMatrix,false,object.matrixWorld.elements)}return program}function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;uniforms.diffuse.value=material.color;uniforms.map.value=material.map;uniforms.lightMap.value=material.lightMap;uniforms.specularMap.value=material.specularMap;uniforms.alphaMap.value=material.alphaMap;if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}if(uvScaleMap!==undefined){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=material.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;uniforms.reflectivity.value=material.reflectivity;uniforms.refractionRatio.value=material.refractionRatio}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale}function refreshUniformsParticle(uniforms,material){uniforms.psColor.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size;uniforms.scale.value=_canvas.height/2;uniforms.map.value=material.map;if(material.map!==null){var offset=material.map.offset;var repeat=material.map.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog instanceof THREE.Fog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far}else if(fog instanceof THREE.FogExp2){uniforms.fogDensity.value=fog.density}}function refreshUniformsPhong(uniforms,material){uniforms.shininess.value=material.shininess;uniforms.emissive.value=material.emissive;uniforms.specular.value=material.specular;if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLambert(uniforms,material){uniforms.emissive.value=material.emissive;if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLights(uniforms,lights){uniforms.ambientLightColor.value=lights.ambient;uniforms.directionalLightColor.value=lights.directional.colors;uniforms.directionalLightDirection.value=lights.directional.positions;uniforms.pointLightColor.value=lights.point.colors;uniforms.pointLightPosition.value=lights.point.positions;uniforms.pointLightDistance.value=lights.point.distances;uniforms.pointLightDecay.value=lights.point.decays;uniforms.spotLightColor.value=lights.spot.colors;uniforms.spotLightPosition.value=lights.spot.positions;uniforms.spotLightDistance.value=lights.spot.distances;uniforms.spotLightDirection.value=lights.spot.directions;uniforms.spotLightAngleCos.value=lights.spot.anglesCos;uniforms.spotLightExponent.value=lights.spot.exponents;uniforms.spotLightDecay.value=lights.spot.decays;uniforms.hemisphereLightSkyColor.value=lights.hemi.skyColors;uniforms.hemisphereLightGroundColor.value=lights.hemi.groundColors;uniforms.hemisphereLightDirection.value=lights.hemi.positions}function markUniformsLightsNeedsUpdate(uniforms,value){uniforms.ambientLightColor.needsUpdate=value;uniforms.directionalLightColor.needsUpdate=value;uniforms.directionalLightDirection.needsUpdate=value;uniforms.pointLightColor.needsUpdate=value;uniforms.pointLightPosition.needsUpdate=value;uniforms.pointLightDistance.needsUpdate=value;uniforms.pointLightDecay.needsUpdate=value;uniforms.spotLightColor.needsUpdate=value;uniforms.spotLightPosition.needsUpdate=value;uniforms.spotLightDistance.needsUpdate=value;uniforms.spotLightDirection.needsUpdate=value;uniforms.spotLightAngleCos.needsUpdate=value;uniforms.spotLightExponent.needsUpdate=value;uniforms.spotLightDecay.needsUpdate=value;uniforms.hemisphereLightSkyColor.needsUpdate=value;uniforms.hemisphereLightGroundColor.needsUpdate=value;uniforms.hemisphereLightDirection.needsUpdate=value}function refreshUniformsShadow(uniforms,lights){if(uniforms.shadowMatrix){var j=0;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight||light instanceof THREE.DirectionalLight&&!light.shadowCascade){uniforms.shadowMap.value[j]=light.shadowMap;uniforms.shadowMapSize.value[j]=light.shadowMapSize;uniforms.shadowMatrix.value[j]=light.shadowMatrix;uniforms.shadowDarkness.value[j]=light.shadowDarkness;uniforms.shadowBias.value[j]=light.shadowBias;j++}}}}function loadUniformsMatrices(uniforms,object){_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,object._modelViewMatrix.elements);if(uniforms.normalMatrix){_gl.uniformMatrix3fv(uniforms.normalMatrix,false,object._normalMatrix.elements)}}function getTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=_maxTextures){THREE.warn("WebGLRenderer: trying to use "+textureUnit+" texture units while this GPU supports only "+_maxTextures)}_usedTextureUnits+=1;return textureUnit}function loadUniformsGeneric(uniforms){var texture,textureUnit,offset;for(var j=0,jl=uniforms.length;j<jl;j++){var uniform=uniforms[j][0];if(uniform.needsUpdate===false)continue;var type=uniform.type;var value=uniform.value;var location=uniforms[j][1];switch(type){case"1i":_gl.uniform1i(location,value);break;case"1f":_gl.uniform1f(location,value);break;case"2f":_gl.uniform2f(location,value[0],value[1]);break;case"3f":_gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":_gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"1iv":_gl.uniform1iv(location,value);break;case"3iv":_gl.uniform3iv(location,value);break;case"1fv":_gl.uniform1fv(location,value);break;case"2fv":_gl.uniform2fv(location,value);break;case"3fv":_gl.uniform3fv(location,value);break;case"4fv":_gl.uniform4fv(location,value);break;case"Matrix3fv":_gl.uniformMatrix3fv(location,false,value);break;case"Matrix4fv":_gl.uniformMatrix4fv(location,false,value);break;case"i":_gl.uniform1i(location,value);break;case"f":_gl.uniform1f(location,value);break;case"v2":_gl.uniform2f(location,value.x,value.y);break;case"v3":_gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":_gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"c":_gl.uniform3f(location,value.r,value.g,value.b);break;case"iv1":_gl.uniform1iv(location,value);break;case"iv":_gl.uniform3iv(location,value);break;case"fv1":_gl.uniform1fv(location,value);break;case"fv":_gl.uniform3fv(location,value);break;case"v2v":if(uniform._array===undefined){uniform._array=new Float32Array(2*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*2;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y}_gl.uniform2fv(location,uniform._array);break;case"v3v":if(uniform._array===undefined){uniform._array=new Float32Array(3*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*3;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z}_gl.uniform3fv(location,uniform._array);break;case"v4v":if(uniform._array===undefined){uniform._array=new Float32Array(4*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*4;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z;uniform._array[offset+3]=value[i].w}_gl.uniform4fv(location,uniform._array);break;case"m3":_gl.uniformMatrix3fv(location,false,value.elements);break;case"m3v":if(uniform._array===undefined){uniform._array=new Float32Array(9*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*9)}_gl.uniformMatrix3fv(location,false,uniform._array);break;case"m4":_gl.uniformMatrix4fv(location,false,value.elements);break;case"m4v":if(uniform._array===undefined){uniform._array=new Float32Array(16*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*16)}_gl.uniformMatrix4fv(location,false,uniform._array);break;case"t":texture=value;textureUnit=getTextureUnit();_gl.uniform1i(location,textureUnit);if(!texture)continue;if(texture instanceof THREE.CubeTexture||texture.image instanceof Array&&texture.image.length===6){setCubeTexture(texture,textureUnit)}else if(texture instanceof THREE.WebGLRenderTargetCube){setCubeTextureDynamic(texture,textureUnit)}else{_this.setTexture(texture,textureUnit)}break;case"tv":if(uniform._array===undefined){uniform._array=[]}for(var i=0,il=uniform.value.length;i<il;i++){uniform._array[i]=getTextureUnit()}_gl.uniform1iv(location,uniform._array);for(var i=0,il=uniform.value.length;i<il;i++){texture=uniform.value[i];textureUnit=uniform._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit)}break;default:THREE.warn("THREE.WebGLRenderer: Unknown uniform type: "+type)}}}function setupMatrices(object,camera){object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object._normalMatrix.getNormalMatrix(object._modelViewMatrix)}function setColorLinear(array,offset,color,intensity){array[offset]=color.r*intensity;array[offset+1]=color.g*intensity;array[offset+2]=color.b*intensity}function setupLights(lights){var l,ll,light,r=0,g=0,b=0,color,skyColor,groundColor,intensity,distance,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,pointColors=zlights.point.colors,pointPositions=zlights.point.positions,pointDistances=zlights.point.distances,pointDecays=zlights.point.decays,spotColors=zlights.spot.colors,spotPositions=zlights.spot.positions,spotDistances=zlights.spot.distances,spotDirections=zlights.spot.directions,spotAnglesCos=zlights.spot.anglesCos,spotExponents=zlights.spot.exponents,spotDecays=zlights.spot.decays,hemiSkyColors=zlights.hemi.skyColors,hemiGroundColors=zlights.hemi.groundColors,hemiPositions=zlights.hemi.positions,dirLength=0,pointLength=0,spotLength=0,hemiLength=0,dirCount=0,pointCount=0,spotCount=0,hemiCount=0,dirOffset=0,pointOffset=0,spotOffset=0,hemiOffset=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow)continue;color=light.color;intensity=light.intensity;distance=light.distance;if(light instanceof THREE.AmbientLight){if(!light.visible)continue;r+=color.r;g+=color.g;b+=color.b}else if(light instanceof THREE.DirectionalLight){dirCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();dirOffset=dirLength*3;dirPositions[dirOffset]=_direction.x;dirPositions[dirOffset+1]=_direction.y;dirPositions[dirOffset+2]=_direction.z;setColorLinear(dirColors,dirOffset,color,intensity);dirLength+=1}else if(light instanceof THREE.PointLight){pointCount+=1;if(!light.visible)continue;pointOffset=pointLength*3;setColorLinear(pointColors,pointOffset,color,intensity);_vector3.setFromMatrixPosition(light.matrixWorld);pointPositions[pointOffset]=_vector3.x;pointPositions[pointOffset+1]=_vector3.y;pointPositions[pointOffset+2]=_vector3.z;pointDistances[pointLength]=distance;pointDecays[pointLength]=light.distance===0?0:light.decay;pointLength+=1}else if(light instanceof THREE.SpotLight){spotCount+=1;if(!light.visible)continue;spotOffset=spotLength*3;setColorLinear(spotColors,spotOffset,color,intensity);_direction.setFromMatrixPosition(light.matrixWorld);spotPositions[spotOffset]=_direction.x;spotPositions[spotOffset+1]=_direction.y;spotPositions[spotOffset+2]=_direction.z;spotDistances[spotLength]=distance;_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();spotDirections[spotOffset]=_direction.x;spotDirections[spotOffset+1]=_direction.y;spotDirections[spotOffset+2]=_direction.z;spotAnglesCos[spotLength]=Math.cos(light.angle);spotExponents[spotLength]=light.exponent;spotDecays[spotLength]=light.distance===0?0:light.decay;spotLength+=1}else if(light instanceof THREE.HemisphereLight){hemiCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_direction.normalize();hemiOffset=hemiLength*3;hemiPositions[hemiOffset]=_direction.x;hemiPositions[hemiOffset+1]=_direction.y;hemiPositions[hemiOffset+2]=_direction.z;skyColor=light.color;groundColor=light.groundColor;setColorLinear(hemiSkyColors,hemiOffset,skyColor,intensity);setColorLinear(hemiGroundColors,hemiOffset,groundColor,intensity);hemiLength+=1}}for(l=dirLength*3,ll=Math.max(dirColors.length,dirCount*3);l<ll;l++)dirColors[l]=0;for(l=pointLength*3,ll=Math.max(pointColors.length,pointCount*3);l<ll;l++)pointColors[l]=0;for(l=spotLength*3,ll=Math.max(spotColors.length,spotCount*3);l<ll;l++)spotColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiSkyColors.length,hemiCount*3);l<ll;l++)hemiSkyColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiGroundColors.length,hemiCount*3);l<ll;l++)hemiGroundColors[l]=0;zlights.directional.length=dirLength;zlights.point.length=pointLength;zlights.spot.length=spotLength;zlights.hemi.length=hemiLength;zlights.ambient[0]=r;zlights.ambient[1]=g;zlights.ambient[2]=b}this.setFaceCulling=function(cullFace,frontFaceDirection){if(cullFace===THREE.CullFaceNone){_gl.disable(_gl.CULL_FACE)}else{if(frontFaceDirection===THREE.FrontFaceDirectionCW){_gl.frontFace(_gl.CW)}else{_gl.frontFace(_gl.CCW)}if(cullFace===THREE.CullFaceBack){_gl.cullFace(_gl.BACK)}else if(cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.FRONT_AND_BACK)}_gl.enable(_gl.CULL_FACE)}};this.setMaterialFaces=function(material){state.setDoubleSided(material.side===THREE.DoubleSide);state.setFlipSided(material.side===THREE.BackSide)};function setTextureParameters(textureType,texture,isImagePowerOfTwo){var extension;if(isImagePowerOfTwo){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter))}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);if(texture.wrapS!==THREE.ClampToEdgeWrapping||texture.wrapT!==THREE.ClampToEdgeWrapping){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+texture.sourceFile+" )")}_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));if(texture.minFilter!==THREE.NearestFilter&&texture.minFilter!==THREE.LinearFilter){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+texture.sourceFile+" )")}}extension=extensions.get("EXT_texture_filter_anisotropic");if(extension&&texture.type!==THREE.FloatType&&texture.type!==THREE.HalfFloatType){if(texture.anisotropy>1||texture.__currentAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,_this.getMaxAnisotropy()));texture.__currentAnisotropy=texture.anisotropy}}}this.uploadTexture=function(texture){if(texture.__webglInit===undefined){texture.__webglInit=true;texture.addEventListener("dispose",onTextureDispose);texture.__webglTexture=_gl.createTexture();_this.info.memory.textures++}_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);texture.image=clampToMaxSize(texture.image,_maxTextureSize);var image=texture.image,isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);var mipmap,mipmaps=texture.mipmaps;if(texture instanceof THREE.DataTexture){if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data)}}else if(texture instanceof THREE.CompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}else{if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image)}}if(texture.generateMipmaps&&isImagePowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()};this.setTexture=function(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);if(texture.needsUpdate){_this.uploadTexture(texture)}else{_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture)}};function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/Math.max(image.width,image.height);var canvas=document.createElement("canvas");canvas.width=Math.floor(image.width*scale);canvas.height=Math.floor(image.height*scale);var context=canvas.getContext("2d");context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);THREE.warn("THREE.WebGLRenderer: image is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image);return canvas}return image}function setCubeTexture(texture,slot){if(texture.image.length===6){if(texture.needsUpdate){if(!texture.image.__webglTextureCube){texture.addEventListener("dispose",onTextureDispose);texture.image.__webglTextureCube=_gl.createTexture();_this.info.memory.textures++}_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture instanceof THREE.CompressedTexture;var isDataTexture=texture.image[0]instanceof THREE.DataTexture;var cubeImage=[];for(var i=0;i<6;i++){if(_this.autoScaleCubemaps&&!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],_maxCubemapSize)}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i]}}var image=cubeImage[0],isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isImagePowerOfTwo);for(var i=0;i<6;i++){if(!isCompressed){if(isDataTexture){_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data)}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i])}}else{var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}}if(texture.generateMipmaps&&isImagePowerOfTwo){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()}else{_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube)}}}function setCubeTextureDynamic(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.__webglTexture)}function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,renderTarget.__webglTexture,0)}function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}}this.setRenderTarget=function(renderTarget){var isCube=renderTarget instanceof THREE.WebGLRenderTargetCube;if(renderTarget&&renderTarget.__webglFramebuffer===undefined){if(renderTarget.depthBuffer===undefined)renderTarget.depthBuffer=true;if(renderTarget.stencilBuffer===undefined)renderTarget.stencilBuffer=true;renderTarget.addEventListener("dispose",onRenderTargetDispose);renderTarget.__webglTexture=_gl.createTexture();_this.info.memory.textures++;var isTargetPowerOfTwo=THREE.Math.isPowerOfTwo(renderTarget.width)&&THREE.Math.isPowerOfTwo(renderTarget.height),glFormat=paramThreeToGL(renderTarget.format),glType=paramThreeToGL(renderTarget.type);if(isCube){renderTarget.__webglFramebuffer=[];renderTarget.__webglRenderbuffer=[];_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget,isTargetPowerOfTwo);for(var i=0;i<6;i++){renderTarget.__webglFramebuffer[i]=_gl.createFramebuffer();renderTarget.__webglRenderbuffer[i]=_gl.createRenderbuffer();_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);setupRenderBuffer(renderTarget.__webglRenderbuffer[i],renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}else{renderTarget.__webglFramebuffer=_gl.createFramebuffer();if(renderTarget.shareDepthFrom){renderTarget.__webglRenderbuffer=renderTarget.shareDepthFrom.__webglRenderbuffer}else{renderTarget.__webglRenderbuffer=_gl.createRenderbuffer()}_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget,isTargetPowerOfTwo);_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer,renderTarget,_gl.TEXTURE_2D);if(renderTarget.shareDepthFrom){if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}}else{setupRenderBuffer(renderTarget.__webglRenderbuffer,renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D)}if(isCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,null)}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}var framebuffer,width,height,vx,vy;if(renderTarget){if(isCube){framebuffer=renderTarget.__webglFramebuffer[renderTarget.activeCubeFace]}else{framebuffer=renderTarget.__webglFramebuffer}width=renderTarget.width;height=renderTarget.height;vx=0;vy=0}else{framebuffer=null;width=_viewportWidth;height=_viewportHeight;vx=_viewportX;vy=_viewportY}if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.viewport(vx,vy,width,height);_currentFramebuffer=framebuffer}_currentWidth=width;_currentHeight=height};this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!(renderTarget instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(renderTarget.__webglFramebuffer){if(renderTarget.format!==THREE.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var restore=false;if(renderTarget.__webglFramebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTarget.__webglFramebuffer);restore=true}if(_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE){_gl.readPixels(x,y,width,height,_gl.RGBA,_gl.UNSIGNED_BYTE,buffer)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(restore){_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer)}}};function updateRenderTargetMipmap(renderTarget){if(renderTarget instanceof THREE.WebGLRenderTargetCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_2D);_gl.bindTexture(_gl.TEXTURE_2D,null)}}function filterFallback(f){if(f===THREE.NearestFilter||f===THREE.NearestMipMapNearestFilter||f===THREE.NearestMipMapLinearFilter){return _gl.NEAREST}return _gl.LINEAR}function paramThreeToGL(p){var extension;if(p===THREE.RepeatWrapping)return _gl.REPEAT;if(p===THREE.ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(p===THREE.MirroredRepeatWrapping)return _gl.MIRRORED_REPEAT;if(p===THREE.NearestFilter)return _gl.NEAREST;if(p===THREE.NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===THREE.NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===THREE.LinearFilter)return _gl.LINEAR;if(p===THREE.LinearMipMapNearestFilter)return _gl.LINEAR_MIPMAP_NEAREST;if(p===THREE.LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===THREE.UnsignedByteType)return _gl.UNSIGNED_BYTE;if(p===THREE.UnsignedShort4444Type)return _gl.UNSIGNED_SHORT_4_4_4_4;if(p===THREE.UnsignedShort5551Type)return _gl.UNSIGNED_SHORT_5_5_5_1;if(p===THREE.UnsignedShort565Type)return _gl.UNSIGNED_SHORT_5_6_5;if(p===THREE.ByteType)return _gl.BYTE;if(p===THREE.ShortType)return _gl.SHORT;if(p===THREE.UnsignedShortType)return _gl.UNSIGNED_SHORT;if(p===THREE.IntType)return _gl.INT;if(p===THREE.UnsignedIntType)return _gl.UNSIGNED_INT;if(p===THREE.FloatType)return _gl.FLOAT;extension=extensions.get("OES_texture_half_float");if(extension!==null){if(p===THREE.HalfFloatType)return extension.HALF_FLOAT_OES}if(p===THREE.AlphaFormat)return _gl.ALPHA;if(p===THREE.RGBFormat)return _gl.RGB;if(p===THREE.RGBAFormat)return _gl.RGBA;if(p===THREE.LuminanceFormat)return _gl.LUMINANCE;if(p===THREE.LuminanceAlphaFormat)return _gl.LUMINANCE_ALPHA;if(p===THREE.AddEquation)return _gl.FUNC_ADD;if(p===THREE.SubtractEquation)return _gl.FUNC_SUBTRACT;if(p===THREE.ReverseSubtractEquation)return _gl.FUNC_REVERSE_SUBTRACT;if(p===THREE.ZeroFactor)return _gl.ZERO;if(p===THREE.OneFactor)return _gl.ONE;if(p===THREE.SrcColorFactor)return _gl.SRC_COLOR;if(p===THREE.OneMinusSrcColorFactor)return _gl.ONE_MINUS_SRC_COLOR;if(p===THREE.SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===THREE.OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(p===THREE.DstAlphaFactor)return _gl.DST_ALPHA;if(p===THREE.OneMinusDstAlphaFactor)return _gl.ONE_MINUS_DST_ALPHA;if(p===THREE.DstColorFactor)return _gl.DST_COLOR;if(p===THREE.OneMinusDstColorFactor)return _gl.ONE_MINUS_DST_COLOR;if(p===THREE.SrcAlphaSaturateFactor)return _gl.SRC_ALPHA_SATURATE;extension=extensions.get("WEBGL_compressed_texture_s3tc");if(extension!==null){if(p===THREE.RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===THREE.RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}extension=extensions.get("WEBGL_compressed_texture_pvrtc");if(extension!==null){if(p===THREE.RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===THREE.RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===THREE.RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===THREE.RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}extension=extensions.get("EXT_blend_minmax");if(extension!==null){if(p===THREE.MinEquation)return extension.MIN_EXT;if(p===THREE.MaxEquation)return extension.MAX_EXT}return 0}function allocateBones(object){if(_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture){return 1024}else{var nVertexUniforms=_gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=nVertexMatrices;if(object!==undefined&&object instanceof THREE.SkinnedMesh){maxBones=Math.min(object.skeleton.bones.length,maxBones);if(maxBones<object.skeleton.bones.length){THREE.warn("WebGLRenderer: too many bones - "+object.skeleton.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)")}}return maxBones}}function allocateLights(lights){var dirLights=0;var pointLights=0;var spotLights=0;var hemiLights=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(light.onlyShadow||light.visible===false)continue;if(light instanceof THREE.DirectionalLight)dirLights++;if(light instanceof THREE.PointLight)pointLights++;if(light instanceof THREE.SpotLight)spotLights++;if(light instanceof THREE.HemisphereLight)hemiLights++}return{directional:dirLights,point:pointLights,spot:spotLights,hemi:hemiLights}}function allocateShadows(lights){
var maxShadows=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight)maxShadows++;if(light instanceof THREE.DirectionalLight&&!light.shadowCascade)maxShadows++}return maxShadows}this.initMaterial=function(){THREE.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){THREE.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(width,height,options){this.width=width;this.height=height;options=options||{};this.wrapS=options.wrapS!==undefined?options.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=options.wrapT!==undefined?options.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=options.magFilter!==undefined?options.magFilter:THREE.LinearFilter;this.minFilter=options.minFilter!==undefined?options.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=options.anisotropy!==undefined?options.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=options.format!==undefined?options.format:THREE.RGBAFormat;this.type=options.type!==undefined?options.type:THREE.UnsignedByteType;this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=options.shareDepthFrom!==undefined?options.shareDepthFrom:null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(width,height){this.width=width;this.height=height},clone:function(){var tmp=new THREE.WebGLRenderTarget(this.width,this.height);tmp.wrapS=this.wrapS;tmp.wrapT=this.wrapT;tmp.magFilter=this.magFilter;tmp.minFilter=this.minFilter;tmp.anisotropy=this.anisotropy;tmp.offset.copy(this.offset);tmp.repeat.copy(this.repeat);tmp.format=this.format;tmp.type=this.type;tmp.depthBuffer=this.depthBuffer;tmp.stencilBuffer=this.stencilBuffer;tmp.generateMipmaps=this.generateMipmaps;tmp.shareDepthFrom=this.shareDepthFrom;return tmp},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(width,height,options){THREE.WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLExtensions=function(gl){var extensions={};this.get=function(name){if(extensions[name]!==undefined){return extensions[name]}var extension;switch(name){case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:extension=gl.getExtension(name)}if(extension===null){THREE.warn("THREE.WebGLRenderer: "+name+" extension not supported.")}extensions[name]=extension;return extension}};THREE.WebGLProgram=function(){var programIdCount=0;var generateDefines=function(defines){var value,chunk,chunks=[];for(var d in defines){value=defines[d];if(value===false)continue;chunk="#define "+d+" "+value;chunks.push(chunk)}return chunks.join("\n")};var cacheUniformLocations=function(gl,program,identifiers){var uniforms={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];uniforms[id]=gl.getUniformLocation(program,id)}return uniforms};var cacheAttributeLocations=function(gl,program,identifiers){var attributes={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];attributes[id]=gl.getAttribLocation(program,id)}return attributes};return function(renderer,code,material,parameters){var _this=renderer;var _gl=_this.context;var defines=material.defines;var uniforms=material.__webglShader.uniforms;var attributes=material.attributes;var vertexShader=material.__webglShader.vertexShader;var fragmentShader=material.__webglShader.fragmentShader;var index0AttributeName=material.index0AttributeName;if(index0AttributeName===undefined&&parameters.morphTargets===true){index0AttributeName="position"}var shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";if(parameters.shadowMapType===THREE.PCFShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF"}else if(parameters.shadowMapType===THREE.PCFSoftShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"}var envMapTypeDefine="ENVMAP_TYPE_CUBE";var envMapModeDefine="ENVMAP_MODE_REFLECTION";var envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE";break}switch(material.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION";break}switch(material.combine){case THREE.MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD";break}}var gammaFactorDefine=renderer.gammaFactor>0?renderer.gammaFactor:1;var customDefines=generateDefines(defines);var program=_gl.createProgram();var prefix_vertex,prefix_fragment;if(material instanceof THREE.RawShaderMaterial){prefix_vertex="";prefix_fragment=""}else{prefix_vertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals?"#define USE_MORPHNORMALS":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n");prefix_fragment=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",parameters.bumpMap||parameters.normalMap||parameters.flatShading?"#extension GL_OES_standard_derivatives : enable":"",customDefines,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.metal?"#define METAL":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var glVertexShader=new THREE.WebGLShader(_gl,_gl.VERTEX_SHADER,prefix_vertex+vertexShader);var glFragmentShader=new THREE.WebGLShader(_gl,_gl.FRAGMENT_SHADER,prefix_fragment+fragmentShader);_gl.attachShader(program,glVertexShader);_gl.attachShader(program,glFragmentShader);if(index0AttributeName!==undefined){_gl.bindAttribLocation(program,0,index0AttributeName)}_gl.linkProgram(program);var programLogInfo=_gl.getProgramInfoLog(program);if(_gl.getProgramParameter(program,_gl.LINK_STATUS)===false){THREE.error("THREE.WebGLProgram: shader error: "+_gl.getError(),"gl.VALIDATE_STATUS",_gl.getProgramParameter(program,_gl.VALIDATE_STATUS),"gl.getPRogramInfoLog",programLogInfo)}if(programLogInfo!==""){THREE.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+programLogInfo)}_gl.deleteShader(glVertexShader);_gl.deleteShader(glFragmentShader);var identifiers=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(parameters.useVertexTexture){identifiers.push("boneTexture");identifiers.push("boneTextureWidth");identifiers.push("boneTextureHeight")}else{identifiers.push("boneGlobalMatrices")}if(parameters.logarithmicDepthBuffer){identifiers.push("logDepthBufFC")}for(var u in uniforms){identifiers.push(u)}this.uniforms=cacheUniformLocations(_gl,program,identifiers);identifiers=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var i=0;i<parameters.maxMorphTargets;i++){identifiers.push("morphTarget"+i)}for(var i=0;i<parameters.maxMorphNormals;i++){identifiers.push("morphNormal"+i)}for(var a in attributes){identifiers.push(a)}this.attributes=cacheAttributeLocations(_gl,program,identifiers);this.attributesKeys=Object.keys(this.attributes);this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this}}();THREE.WebGLShader=function(){var addLineNumbers=function(string){var lines=string.split("\n");for(var i=0;i<lines.length;i++){lines[i]=i+1+": "+lines[i]}return lines.join("\n")};return function(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS)===false){THREE.error("THREE.WebGLShader: Shader couldn't compile.")}if(gl.getShaderInfoLog(shader)!==""){THREE.warn("THREE.WebGLShader: gl.getShaderInfoLog()",gl.getShaderInfoLog(shader),addLineNumbers(string))}return shader}}();THREE.WebGLState=function(gl,paramThreeToGL){var newAttributes=new Uint8Array(16);var enabledAttributes=new Uint8Array(16);var currentBlending=null;var currentBlendEquation=null;var currentBlendSrc=null;var currentBlendDst=null;var currentBlendEquationAlpha=null;var currentBlendSrcAlpha=null;var currentBlendDstAlpha=null;var currentDepthTest=null;var currentDepthWrite=null;var currentColorWrite=null;var currentDoubleSided=null;var currentFlipSided=null;var currentLineWidth=null;var currentPolygonOffset=null;var currentPolygonOffsetFactor=null;var currentPolygonOffsetUnits=null;this.initAttributes=function(){for(var i=0,l=newAttributes.length;i<l;i++){newAttributes[i]=0}};this.enableAttribute=function(attribute){newAttributes[attribute]=1;if(enabledAttributes[attribute]===0){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1}};this.disableUnusedAttributes=function(){for(var i=0,l=enabledAttributes.length;i<l;i++){if(enabledAttributes[i]!==newAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}};this.setBlending=function(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha){if(blending!==currentBlending){if(blending===THREE.NoBlending){gl.disable(gl.BLEND)}else if(blending===THREE.AdditiveBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}else if(blending===THREE.SubtractiveBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR)}else if(blending===THREE.MultiplyBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.SRC_COLOR)}else if(blending===THREE.CustomBlending){gl.enable(gl.BLEND)}else{gl.enable(gl.BLEND);gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}currentBlending=blending}if(blending===THREE.CustomBlending){blendEquationAlpha=blendEquationAlpha||blendEquation;blendSrcAlpha=blendSrcAlpha||blendSrc;blendDstAlpha=blendDstAlpha||blendDst;if(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){gl.blendEquationSeparate(paramThreeToGL(blendEquation),paramThreeToGL(blendEquationAlpha));currentBlendEquation=blendEquation;currentBlendEquationAlpha=blendEquationAlpha}if(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){gl.blendFuncSeparate(paramThreeToGL(blendSrc),paramThreeToGL(blendDst),paramThreeToGL(blendSrcAlpha),paramThreeToGL(blendDstAlpha));currentBlendSrc=blendSrc;currentBlendDst=blendDst;currentBlendSrcAlpha=blendSrcAlpha;currentBlendDstAlpha=blendDstAlpha}}else{currentBlendEquation=null;currentBlendSrc=null;currentBlendDst=null;currentBlendEquationAlpha=null;currentBlendSrcAlpha=null;currentBlendDstAlpha=null}};this.setDepthTest=function(depthTest){if(currentDepthTest!==depthTest){if(depthTest){gl.enable(gl.DEPTH_TEST)}else{gl.disable(gl.DEPTH_TEST)}currentDepthTest=depthTest}};this.setDepthWrite=function(depthWrite){if(currentDepthWrite!==depthWrite){gl.depthMask(depthWrite);currentDepthWrite=depthWrite}};this.setColorWrite=function(colorWrite){if(currentColorWrite!==colorWrite){gl.colorMask(colorWrite,colorWrite,colorWrite,colorWrite);currentColorWrite=colorWrite}};this.setDoubleSided=function(doubleSided){if(currentDoubleSided!==doubleSided){if(doubleSided){gl.disable(gl.CULL_FACE)}else{gl.enable(gl.CULL_FACE)}currentDoubleSided=doubleSided}};this.setFlipSided=function(flipSided){if(currentFlipSided!==flipSided){if(flipSided){gl.frontFace(gl.CW)}else{gl.frontFace(gl.CCW)}currentFlipSided=flipSided}};this.setLineWidth=function(width){if(width!==currentLineWidth){gl.lineWidth(width);currentLineWidth=width}};this.setPolygonOffset=function(polygonoffset,factor,units){if(currentPolygonOffset!==polygonoffset){if(polygonoffset){gl.enable(gl.POLYGON_OFFSET_FILL)}else{gl.disable(gl.POLYGON_OFFSET_FILL)}currentPolygonOffset=polygonoffset}if(polygonoffset&&(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units)){gl.polygonOffset(factor,units);currentPolygonOffsetFactor=factor;currentPolygonOffsetUnits=units}};this.reset=function(){for(var i=0;i<enabledAttributes.length;i++){enabledAttributes[i]=0}currentBlending=null;currentDepthTest=null;currentDepthWrite=null;currentColorWrite=null;currentDoubleSided=null;currentFlipSided=null}};THREE.LensFlarePlugin=function(renderer,flares){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var hasVertexTexture;var tempTexture,occlusionTexture;var init=function(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);tempTexture=gl.createTexture();occlusionTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);hasVertexTexture=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var shader;if(hasVertexTexture){shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}program=createProgram(shader);attributes={vertex:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={renderType:gl.getUniformLocation(program,"renderType"),map:gl.getUniformLocation(program,"map"),occlusionMap:gl.getUniformLocation(program,"occlusionMap"),opacity:gl.getUniformLocation(program,"opacity"),color:gl.getUniformLocation(program,"color"),scale:gl.getUniformLocation(program,"scale"),rotation:gl.getUniformLocation(program,"rotation"),screenPosition:gl.getUniformLocation(program,"screenPosition")}};this.render=function(scene,camera,viewportWidth,viewportHeight){if(flares.length===0)return;var tempPosition=new THREE.Vector3;var invAspect=viewportHeight/viewportWidth,halfViewportWidth=viewportWidth*.5,halfViewportHeight=viewportHeight*.5;var size=16/viewportHeight,scale=new THREE.Vector2(size*invAspect,size);var screenPosition=new THREE.Vector3(1,1,0),screenPositionPixels=new THREE.Vector2(1,1);if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.vertex);gl.enableVertexAttribArray(attributes.uv);gl.uniform1i(uniforms.occlusionMap,0);gl.uniform1i(uniforms.map,1);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.disable(gl.CULL_FACE);gl.depthMask(false);for(var i=0,l=flares.length;i<l;i++){size=16/viewportHeight;scale.set(size*invAspect,size);var flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);tempPosition.applyMatrix4(camera.matrixWorldInverse);tempPosition.applyProjection(camera.projectionMatrix);screenPosition.copy(tempPosition);screenPositionPixels.x=screenPosition.x*halfViewportWidth+halfViewportWidth;screenPositionPixels.y=screenPosition.y*halfViewportHeight+halfViewportHeight;if(hasVertexTexture||screenPositionPixels.x>0&&screenPositionPixels.x<viewportWidth&&screenPositionPixels.y>0&&screenPositionPixels.y<viewportHeight){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,0);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.disable(gl.BLEND);gl.enable(gl.DEPTH_TEST);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,1);gl.disable(gl.DEPTH_TEST);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);flare.positionScreen.copy(screenPosition);if(flare.customUpdateCallback){flare.customUpdateCallback(flare)}else{flare.updateLensFlares()}gl.uniform1i(uniforms.renderType,2);gl.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];if(sprite.opacity>.001&&sprite.scale>.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewportHeight;scale.x=size*invAspect;scale.y=size;gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform1f(uniforms.rotation,sprite.rotation);gl.uniform1f(uniforms.opacity,sprite.opacity);gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);renderer.state.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);renderer.setTexture(sprite.texture,1);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}}}}gl.enable(gl.CULL_FACE);gl.enable(gl.DEPTH_TEST);gl.depthMask(true);renderer.resetGLState()};function createProgram(shader){var program=gl.createProgram();var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);var vertexShader=gl.createShader(gl.VERTEX_SHADER);var prefix="precision "+renderer.getPrecision()+" float;\n";gl.shaderSource(fragmentShader,prefix+shader.fragmentShader);gl.shaderSource(vertexShader,prefix+shader.vertexShader);gl.compileShader(fragmentShader);gl.compileShader(vertexShader);gl.attachShader(program,fragmentShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);return program}};THREE.ShadowMapPlugin=function(_renderer,_lights,_webglObjects,_webglObjectsImmediate){var _gl=_renderer.context;var _depthMaterial,_depthMaterialMorph,_depthMaterialSkin,_depthMaterialMorphSkin,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_min=new THREE.Vector3,_max=new THREE.Vector3,_matrixPosition=new THREE.Vector3,_renderList=[];var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);_depthMaterial=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader});_depthMaterialMorph=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true});_depthMaterialSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,skinning:true});_depthMaterialMorphSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true,skinning:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;_depthMaterialSkin._shadowPass=true;_depthMaterialMorphSkin._shadowPass=true;this.render=function(scene,camera){if(_renderer.shadowMapEnabled===false)return;var i,il,j,jl,n,shadowMap,shadowMatrix,shadowCamera,buffer,material,webglObject,object,light,lights=[],k=0,fog=null;_gl.clearColor(1,1,1,1);_gl.disable(_gl.BLEND);_gl.enable(_gl.CULL_FACE);_gl.frontFace(_gl.CCW);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.BACK)}_renderer.state.setDepthTest(true);for(i=0,il=_lights.length;i<il;i++){light=_lights[i];if(!light.castShadow)continue;if(light instanceof THREE.DirectionalLight&&light.shadowCascade){for(n=0;n<light.shadowCascadeCount;n++){var virtualLight;if(!light.shadowCascadeArray[n]){virtualLight=createVirtualLight(light,n);virtualLight.originalCamera=camera;var gyro=new THREE.Gyroscope;gyro.position.copy(light.shadowCascadeOffset);gyro.add(virtualLight);gyro.add(virtualLight.target);camera.add(gyro);light.shadowCascadeArray[n]=virtualLight}else{virtualLight=light.shadowCascadeArray[n]}updateVirtualLight(light,n);lights[k]=virtualLight;k++}}else{lights[k]=light;k++}}for(i=0,il=lights.length;i<il;i++){light=lights[i];if(!light.shadowMap){var shadowFilter=THREE.LinearFilter;if(_renderer.shadowMapType===THREE.PCFSoftShadowMap){shadowFilter=THREE.NearestFilter}var pars={minFilter:shadowFilter,magFilter:shadowFilter,format:THREE.RGBAFormat};light.shadowMap=new THREE.WebGLRenderTarget(light.shadowMapWidth,light.shadowMapHeight,pars);light.shadowMapSize=new THREE.Vector2(light.shadowMapWidth,light.shadowMapHeight);light.shadowMatrix=new THREE.Matrix4}if(!light.shadowCamera){if(light instanceof THREE.SpotLight){light.shadowCamera=new THREE.PerspectiveCamera(light.shadowCameraFov,light.shadowMapWidth/light.shadowMapHeight,light.shadowCameraNear,light.shadowCameraFar)}else if(light instanceof THREE.DirectionalLight){light.shadowCamera=new THREE.OrthographicCamera(light.shadowCameraLeft,light.shadowCameraRight,light.shadowCameraTop,light.shadowCameraBottom,light.shadowCameraNear,light.shadowCameraFar)}else{THREE.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",light);continue}scene.add(light.shadowCamera);if(scene.autoUpdate===true)scene.updateMatrixWorld()}if(light.shadowCameraVisible&&!light.cameraHelper){light.cameraHelper=new THREE.CameraHelper(light.shadowCamera);scene.add(light.cameraHelper)}if(light.isVirtual&&virtualLight.originalCamera==camera){updateShadowCamera(camera,light)}shadowMap=light.shadowMap;shadowMatrix=light.shadowMatrix;shadowCamera=light.shadowCamera;shadowCamera.position.setFromMatrixPosition(light.matrixWorld);_matrixPosition.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_matrixPosition);shadowCamera.updateMatrixWorld();shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);if(light.cameraHelper)light.cameraHelper.visible=light.shadowCameraVisible;if(light.shadowCameraVisible)light.cameraHelper.update();shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse);_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(shadowMap);_renderer.clear();_renderList.length=0;projectObject(scene,scene,shadowCamera);var objectMaterial,useMorphing,useSkinning;for(j=0,jl=_renderList.length;j<jl;j++){webglObject=_renderList[j];object=webglObject.object;buffer=webglObject.buffer;objectMaterial=getObjectMaterial(object);useMorphing=object.geometry.morphTargets!==undefined&&object.geometry.morphTargets.length>0&&objectMaterial.morphTargets;useSkinning=object instanceof THREE.SkinnedMesh&&objectMaterial.skinning;if(object.customDepthMaterial){material=object.customDepthMaterial}else if(useSkinning){material=useMorphing?_depthMaterialMorphSkin:_depthMaterialSkin;
}else if(useMorphing){material=_depthMaterialMorph}else{material=_depthMaterial}_renderer.setMaterialFaces(objectMaterial);if(buffer instanceof THREE.BufferGeometry){_renderer.renderBufferDirect(shadowCamera,_lights,fog,material,buffer,object)}else{_renderer.renderBuffer(shadowCamera,_lights,fog,material,buffer,object)}}for(j=0,jl=_webglObjectsImmediate.length;j<jl;j++){webglObject=_webglObjectsImmediate[j];object=webglObject.object;if(object.visible&&object.castShadow){object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderer.renderImmediateObject(shadowCamera,_lights,fog,_depthMaterial,object)}}}var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_gl.clearColor(clearColor.r,clearColor.g,clearColor.b,clearAlpha);_gl.enable(_gl.BLEND);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.BACK)}_renderer.resetGLState()};function projectObject(scene,object,shadowCamera){if(object.visible){var webglObjects=_webglObjects[object.id];if(webglObjects&&object.castShadow&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderList.push(webglObject)}}for(var i=0,l=object.children.length;i<l;i++){projectObject(scene,object.children[i],shadowCamera)}}}function createVirtualLight(light,cascade){var virtualLight=new THREE.DirectionalLight;virtualLight.isVirtual=true;virtualLight.onlyShadow=true;virtualLight.castShadow=true;virtualLight.shadowCameraNear=light.shadowCameraNear;virtualLight.shadowCameraFar=light.shadowCameraFar;virtualLight.shadowCameraLeft=light.shadowCameraLeft;virtualLight.shadowCameraRight=light.shadowCameraRight;virtualLight.shadowCameraBottom=light.shadowCameraBottom;virtualLight.shadowCameraTop=light.shadowCameraTop;virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];virtualLight.shadowMapWidth=light.shadowCascadeWidth[cascade];virtualLight.shadowMapHeight=light.shadowCascadeHeight[cascade];virtualLight.pointsWorld=[];virtualLight.pointsFrustum=[];var pointsWorld=virtualLight.pointsWorld,pointsFrustum=virtualLight.pointsFrustum;for(var i=0;i<8;i++){pointsWorld[i]=new THREE.Vector3;pointsFrustum[i]=new THREE.Vector3}var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];pointsFrustum[0].set(-1,-1,nearZ);pointsFrustum[1].set(1,-1,nearZ);pointsFrustum[2].set(-1,1,nearZ);pointsFrustum[3].set(1,1,nearZ);pointsFrustum[4].set(-1,-1,farZ);pointsFrustum[5].set(1,-1,farZ);pointsFrustum[6].set(-1,1,farZ);pointsFrustum[7].set(1,1,farZ);return virtualLight}function updateVirtualLight(light,cascade){var virtualLight=light.shadowCascadeArray[cascade];virtualLight.position.copy(light.position);virtualLight.target.position.copy(light.target.position);virtualLight.lookAt(virtualLight.target);virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];var pointsFrustum=virtualLight.pointsFrustum;pointsFrustum[0].z=nearZ;pointsFrustum[1].z=nearZ;pointsFrustum[2].z=nearZ;pointsFrustum[3].z=nearZ;pointsFrustum[4].z=farZ;pointsFrustum[5].z=farZ;pointsFrustum[6].z=farZ;pointsFrustum[7].z=farZ}function updateShadowCamera(camera,light){var shadowCamera=light.shadowCamera,pointsFrustum=light.pointsFrustum,pointsWorld=light.pointsWorld;_min.set(Infinity,Infinity,Infinity);_max.set(-Infinity,-Infinity,-Infinity);for(var i=0;i<8;i++){var p=pointsWorld[i];p.copy(pointsFrustum[i]);p.unproject(camera);p.applyMatrix4(shadowCamera.matrixWorldInverse);if(p.x<_min.x)_min.x=p.x;if(p.x>_max.x)_max.x=p.x;if(p.y<_min.y)_min.y=p.y;if(p.y>_max.y)_max.y=p.y;if(p.z<_min.z)_min.z=p.z;if(p.z>_max.z)_max.z=p.z}shadowCamera.left=_min.x;shadowCamera.right=_max.x;shadowCamera.top=_max.y;shadowCamera.bottom=_min.y;shadowCamera.updateProjectionMatrix()}function getObjectMaterial(object){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[0]:object.material}};THREE.SpritePlugin=function(renderer,sprites){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var texture;var spritePosition=new THREE.Vector3;var spriteRotation=new THREE.Quaternion;var spriteScale=new THREE.Vector3;var init=function(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElement("canvas");canvas.width=8;canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,8,8);texture=new THREE.Texture(canvas);texture.needsUpdate=true};this.render=function(scene,camera){if(sprites.length===0)return;if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.position);gl.enableVertexAttribArray(attributes.uv);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera.projectionMatrix.elements);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0;var sceneFogType=0;var fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog instanceof THREE.Fog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1}else if(fog instanceof THREE.FogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0}for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite._modelViewMatrix.elements[14]}sprites.sort(painterSortStable);var scale=[];for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];var material=sprite.material;gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite._modelViewMatrix.elements);sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale);scale[0]=spriteScale.x;scale[1]=spriteScale.y;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType}if(material.map!==null){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1)}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.scale,scale);renderer.state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);renderer.state.setDepthTest(material.depthTest);renderer.state.setDepthWrite(material.depthWrite);if(material.map&&material.map.image&&material.map.image.width){renderer.setTexture(material.map,0)}else{renderer.setTexture(texture,0)}gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}gl.enable(gl.CULL_FACE);renderer.resetGLState()};function createProgram(){var program=gl.createProgram();var vertexShader=gl.createShader(gl.VERTEX_SHADER);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,["precision "+renderer.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));gl.shaderSource(fragmentShader,["precision "+renderer.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program}function painterSortStable(a,b){if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}};THREE.GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){THREE.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2 instanceof THREE.Mesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){THREE.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(url,mapping,onLoad,onError){var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.Texture(undefined,mapping);loader.load(url,function(image){texture.image=image;texture.needsUpdate=true;if(onLoad)onLoad(texture)},undefined,function(event){if(onError)onError(event)});texture.sourceFile=url;return texture},loadTextureCube:function(array,mapping,onLoad,onError){var images=[];var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.CubeTexture(images,mapping);texture.flipY=false;var loaded=0;var loadTexture=function(i){loader.load(array[i],function(image){texture.images[i]=image;loaded+=1;if(loaded===6){texture.needsUpdate=true;if(onLoad)onLoad(texture)}},undefined,onError)};for(var i=0,il=array.length;i<il;++i){loadTexture(i)}return texture},loadCompressedTexture:function(){THREE.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){THREE.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(image,depth){var cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};var subtract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};var normalize=function(a){var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/l,a[1]/l,a[2]/l]};depth=depth|1;var width=image.width;var height=image.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0);var data=context.getImageData(0,0,width,height).data;var imageData=context.createImageData(width,height);var output=imageData.data;for(var x=0;x<width;x++){for(var y=0;y<height;y++){var ly=y-1<0?0:y-1;var uy=y+1>height-1?height-1:y+1;var lx=x-1<0?0:x-1;var ux=x+1>width-1?width-1:x+1;var points=[];var origin=[0,0,data[(y*width+x)*4]/255*depth];points.push([-1,0,data[(y*width+lx)*4]/255*depth]);points.push([-1,-1,data[(ly*width+lx)*4]/255*depth]);points.push([0,-1,data[(ly*width+x)*4]/255*depth]);points.push([1,-1,data[(ly*width+ux)*4]/255*depth]);points.push([1,0,data[(y*width+ux)*4]/255*depth]);points.push([1,1,data[(uy*width+ux)*4]/255*depth]);points.push([0,1,data[(uy*width+x)*4]/255*depth]);points.push([-1,1,data[(uy*width+lx)*4]/255*depth]);var normals=[];var num_points=points.length;for(var i=0;i<num_points;i++){var v1=points[i];var v2=points[(i+1)%num_points];v1=subtract(v1,origin);v2=subtract(v2,origin);normals.push(normalize(cross(v1,v2)))}var normal=[0,0,0];for(var i=0;i<normals.length;i++){normal[0]+=normals[i][0];normal[1]+=normals[i][1];normal[2]+=normals[i][2]}normal[0]/=normals.length;normal[1]/=normals.length;normal[2]/=normals.length;var idx=(y*width+x)*4;output[idx]=(normal[0]+1)/2*255|0;output[idx+1]=(normal[1]+1)/2*255|0;output[idx+2]=normal[2]*255|0;output[idx+3]=255}}context.putImageData(imageData,0,0);return canvas},generateDataTexture:function(width,height,color){var size=width*height;var data=new Uint8Array(3*size);var r=Math.floor(color.r*255);var g=Math.floor(color.g*255);var b=Math.floor(color.b*255);for(var i=0;i<size;i++){data[i*3]=r;data[i*3+1]=g;data[i*3+2]=b}var texture=new THREE.DataTexture(data,width,height,THREE.RGBFormat);texture.needsUpdate=true;return texture}};THREE.SceneUtils={createMultiMaterialObject:function(geometry,materials){var group=new THREE.Object3D;for(var i=0,l=materials.length;i<l;i++){group.add(new THREE.Mesh(geometry,materials[i]))}return group},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child)},attach:function(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(data){var family=data.familyName.toLowerCase();var ThreeFont=this;ThreeFont.faces[family]=ThreeFont.faces[family]||{};ThreeFont.faces[family][data.cssFontWeight]=ThreeFont.faces[family][data.cssFontWeight]||{};ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;return data},drawText:function(text){var i,face=this.getFace(),scale=this.size/face.resolution,offset=0,chars=String(text).split(""),length=chars.length;var fontPaths=[];for(i=0;i<length;i++){var path=new THREE.Path;var ret=this.extractGlyphPoints(chars[i],face,scale,offset,path);offset+=ret.offset;fontPaths.push(ret.path)}var width=offset/2;return{paths:fontPaths,offset:width}},extractGlyphPoints:function(c,face,scale,offset,path){var pts=[];var i,i2,divisions,outline,action,length,scaleX,scaleY,x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,glyph=face.glyphs[c]||face.glyphs["?"];if(!glyph)return;if(glyph.o){outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));length=outline.length;scaleX=scale;scaleY=scale;for(i=0;i<length;){action=outline[i++];switch(action){case"m":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.moveTo(x,y);break;case"l":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.lineTo(x,y);break;case"q":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy)}}break;case"b":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;cpx2=outline[i++]*scaleX+offset;cpy2=outline[i++]*scaleY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy)}}break}}}return{offset:glyph.ha*scale,path:path}}};THREE.FontUtils.generateShapes=function(text,parameters){parameters=parameters||{};var size=parameters.size!==undefined?parameters.size:100;var curveSegments=parameters.curveSegments!==undefined?parameters.curveSegments:4;var font=parameters.font!==undefined?parameters.font:"helvetiker";var weight=parameters.weight!==undefined?parameters.weight:"normal";var style=parameters.style!==undefined?parameters.style:"normal";THREE.FontUtils.size=size;THREE.FontUtils.divisions=curveSegments;THREE.FontUtils.face=font;THREE.FontUtils.weight=weight;THREE.FontUtils.style=style;var data=THREE.FontUtils.drawText(text);var paths=data.paths;var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes())}return shapes};(function(namespace){var EPSILON=1e-10;var process=function(contour,indices){var n=contour.length;if(n<3)return null;var result=[],verts=[],vertIndices=[];var u,v,w;if(area(contour)>0){for(v=0;v<n;v++)verts[v]=v}else{for(v=0;v<n;v++)verts[v]=n-1-v}var nv=n;var count=2*nv;for(v=nv-1;nv>2;){if(count--<=0){THREE.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(indices)return vertIndices;return result}u=v;if(nv<=u)u=0;v=u+1;if(nv<=v)v=0;w=v+1;if(nv<=w)w=0;if(snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;a=verts[u];b=verts[v];c=verts[w];result.push([contour[a],contour[b],contour[c]]);vertIndices.push([verts[u],verts[v],verts[w]]);for(s=v,t=v+1;t<nv;s++,t++){verts[s]=verts[t]}nv--;count=2*nv}}if(indices)return vertIndices;return result};var area=function(contour){var n=contour.length;var a=0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y}return a*.5};var snip=function(contour,u,v,w,n,verts){var p;var ax,ay,bx,by;var cx,cy,px,py;ax=contour[verts[u]].x;ay=contour[verts[u]].y;bx=contour[verts[v]].x;by=contour[verts[v]].y;cx=contour[verts[w]].x;cy=contour[verts[w]].y;if(EPSILON>(bx-ax)*(cy-ay)-(by-ay)*(cx-ax))return false;var aX,aY,bX,bY,cX,cY;var apx,apy,bpx,bpy,cpx,cpy;var cCROSSap,bCROSScp,aCROSSbp;aX=cx-bx;aY=cy-by;bX=ax-cx;bY=ay-cy;cX=bx-ax;cY=by-ay;for(p=0;p<n;p++){px=contour[verts[p]].x;py=contour[verts[p]].y;if(px===ax&&py===ay||px===bx&&py===by||px===cx&&py===cy)continue;apx=px-ax;apy=py-ay;bpx=px-bx;bpy=py-by;cpx=px-cx;cpy=py-cy;aCROSSbp=aX*bpy-aY*bpx;cCROSSap=cX*apy-cY*apx;bCROSScp=bX*cpy-bY*cpx;if(aCROSSbp>=-EPSILON&&bCROSScp>=-EPSILON&&cCROSSap>=-EPSILON)return false}return true};namespace.Triangulate=process;namespace.Triangulate.area=area;return namespace})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(listener){THREE.Object3D.call(this);this.type="Audio";this.context=listener.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.isPlaying=false};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(file){var scope=this;var request=new XMLHttpRequest;request.open("GET",file,true);request.responseType="arraybuffer";request.onload=function(e){scope.context.decodeAudioData(this.response,function(buffer){scope.source.buffer=buffer;if(scope.autoplay)scope.play()})};request.send();return this};THREE.Audio.prototype.play=function(){if(this.isPlaying===true){THREE.warn("THREE.Audio: Audio is already playing.");return}var source=this.context.createBufferSource();source.buffer=this.source.buffer;source.loop=this.source.loop;source.onended=this.source.onended;source.connect(this.panner);source.start(0,this.startTime);this.isPlaying=true;this.source=source};THREE.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};THREE.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};THREE.Audio.prototype.onEnded=function(){this.isPlaying=false};THREE.Audio.prototype.setLoop=function(value){this.source.loop=value};THREE.Audio.prototype.setRefDistance=function(value){this.panner.refDistance=value};THREE.Audio.prototype.setRolloffFactor=function(value){this.panner.rolloffFactor=value};THREE.Audio.prototype.setVolume=function(value){this.gain.gain.value=value};THREE.Audio.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3;var orientation=new THREE.Vector3;var velocity=new THREE.Vector3;var positionPrev=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener;var up=this.up;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);velocity.subVectors(position,positionPrev);listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z);listener.setVelocity(velocity.x,velocity.y,velocity.z);positionPrev.copy(position)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(t){THREE.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(u){var t=this.getUtoTmapping(u);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPoint(d/divisions))}return pts};THREE.Curve.prototype.getSpacedPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPointAt(d/divisions))}return pts};THREE.Curve.prototype.getLength=function(){var lengths=this.getLengths();return lengths[lengths.length-1]};THREE.Curve.prototype.getLengths=function(divisions){if(!divisions)divisions=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==divisions+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current}this.cacheArcLengths=cache;return cache};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;if(distance){targetArcLength=distance}else{targetArcLength=u*arcLengths[il-1]}var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1}else if(comparison>0){high=i-1}else{high=i;break}}i=high;if(arcLengths[i]==targetArcLength){var t=i/(il-1);return t}var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;var t=(i+segmentFraction)/(il-1);return t};THREE.Curve.prototype.getTangent=function(t){var delta=1e-4;var t1=t-delta;var t2=t+delta;if(t1<0)t1=0;if(t2>1)t2=1;var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().sub(pt1);return vec.normalize()};THREE.Curve.prototype.getTangentAt=function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1)},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+6*t*p2*(1-t)-3*t*t*p2+3*t*t*p3},tangentSpline:function(t,p0,p1,p2,p3){var h00=6*t*t-6*t;var h10=3*t*t-4*t+1;var h01=-6*t*t+6*t;var h11=3*t*t-2*t;return h00+h10+h01+h11},interpolate:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}};THREE.Curve.create=function(constructor,getPointFunc){constructor.prototype=Object.create(THREE.Curve.prototype);constructor.prototype.constructor=constructor;constructor.prototype.getPoint=getPointFunc;return constructor};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(curve){this.curves.push(curve)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new THREE.LineCurve(endPoint,startPoint))}};THREE.CurvePath.prototype.getPoint=function(t){var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0,diff,curve;while(i<curveLengths.length){if(curveLengths[i]>=d){diff=curveLengths[i]-d;curve=this.curves[i];var u=1-diff/curve.getLength();return curve.getPointAt(u)}i++}return null};THREE.CurvePath.prototype.getLength=function(){var lens=this.getCurveLengths();return lens[lens.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var lengths=[],sums=0;var i,il=this.curves.length;for(i=0;i<il;i++){sums+=this.curves[i].getLength();lengths.push(sums)}this.cacheLengths=lengths;return lengths};THREE.CurvePath.prototype.getBoundingBox=function(){var points=this.getPoints();var maxX,maxY,maxZ;var minX,minY,minZ;maxX=maxY=Number.NEGATIVE_INFINITY;minX=minY=Number.POSITIVE_INFINITY;var p,i,il,sum;var v3=points[0]instanceof THREE.Vector3;sum=v3?new THREE.Vector3:new THREE.Vector2;for(i=0,il=points.length;i<il;i++){p=points[i];if(p.x>maxX)maxX=p.x;else if(p.x<minX)minX=p.x;if(p.y>maxY)maxY=p.y;else if(p.y<minY)minY=p.y;if(v3){if(p.z>maxZ)maxZ=p.z;else if(p.z<minZ)minZ=p.z}sum.add(p)}var ret={minX:minX,minY:minY,maxX:maxX,maxY:maxY};if(v3){ret.maxZ=maxZ;ret.minZ=minZ}return ret};THREE.CurvePath.prototype.createPointsGeometry=function(divisions){var pts=this.getPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(divisions){var pts=this.getSpacedPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createGeometry=function(points){var geometry=new THREE.Geometry;for(var i=0;i<points.length;i++){geometry.vertices.push(new THREE.Vector3(points[i].x,points[i].y,points[i].z||0))}return geometry};THREE.CurvePath.prototype.addWrapPath=function(bendpath){this.bends.push(bendpath)};THREE.CurvePath.prototype.getTransformedPoints=function(segments,bends){var oldPts=this.getPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(segments,bends){var oldPts=this.getSpacedPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getWrapPoints=function(oldPts,path){var bounds=this.getBoundingBox();var i,il,p,oldX,oldY,xNorm;for(i=0,il=oldPts.length;i<il;i++){p=oldPts[i];oldX=p.x;oldY=p.y;xNorm=oldX/bounds.maxX;xNorm=path.getUtoTmapping(xNorm,oldX);var pathPt=path.getPoint(xNorm);var normal=path.getTangent(xNorm);normal.set(-normal.y,normal.x).multiplyScalar(oldY);p.x=pathPt.x+normal.x;p.y=pathPt.y+normal.y}return oldPts};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(){var translationObject=new THREE.Vector3;var quaternionObject=new THREE.Quaternion;var scaleObject=new THREE.Vector3;var translationWorld=new THREE.Vector3;var quaternionWorld=new THREE.Quaternion;var scaleWorld=new THREE.Vector3;return function(force){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld);this.matrix.decompose(translationObject,quaternionObject,scaleObject);this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}}}();THREE.Path=function(points){THREE.CurvePath.call(this);this.actions=[];if(points){this.fromPoints(points)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var v=1,vlen=vectors.length;v<vlen;v++){this.lineTo(vectors[v].x,vectors[v].y)}};THREE.Path.prototype.moveTo=function(x,y){var args=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:args})};THREE.Path.prototype.lineTo=function(x,y){
var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.LineCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(x,y));this.curves.push(curve);this.actions.push({action:THREE.PathActions.LINE_TO,args:args})};THREE.Path.prototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.QuadraticBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCPx,aCPy),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:args})};THREE.Path.prototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.CubicBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCP1x,aCP1y),new THREE.Vector2(aCP2x,aCP2y),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:args})};THREE.Path.prototype.splineThru=function(pts){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var npts=[new THREE.Vector2(x0,y0)];Array.prototype.push.apply(npts,pts);var curve=new THREE.SplineCurve(npts);this.curves.push(curve);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:args})};THREE.Path.prototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absarc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.ellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var args=Array.prototype.slice.call(arguments);var curve=new THREE.EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise);this.curves.push(curve);var lastPoint=curve.getPoint(1);args.push(lastPoint.x);args.push(lastPoint.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:args})};THREE.Path.prototype.getSpacedPoints=function(divisions,closedPath){if(!divisions)divisions=40;var points=[];for(var i=0;i<divisions;i++){points.push(this.getPoint(i/divisions))}return points};THREE.Path.prototype.getPoints=function(divisions,closedPath){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(divisions,closedPath)}divisions=divisions||12;var points=[];var i,il,item,action,args;var cpx,cpy,cpx2,cpy2,cpx1,cpy1,cpx0,cpy0,laste,j,t,tx,ty;for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];action=item.action;args=item.args;switch(action){case THREE.PathActions.MOVE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.LINE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:cpx=args[2];cpy=args[3];cpx1=args[0];cpy1=args[1];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.BEZIER_CURVE_TO:cpx=args[4];cpy=args[5];cpx1=args[0];cpy1=args[1];cpx2=args[2];cpy2=args[3];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.CSPLINE_THRU:laste=this.actions[i-1].args;var last=new THREE.Vector2(laste[laste.length-2],laste[laste.length-1]);var spts=[last];var n=divisions*args[0].length;spts=spts.concat(args[0]);var spline=new THREE.SplineCurve(spts);for(j=1;j<=n;j++){points.push(spline.getPointAt(j/n))}break;case THREE.PathActions.ARC:var aX=args[0],aY=args[1],aRadius=args[2],aStartAngle=args[3],aEndAngle=args[4],aClockwise=!!args[5];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+aRadius*Math.cos(angle);ty=aY+aRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.ELLIPSE:var aX=args[0],aY=args[1],xRadius=args[2],yRadius=args[3],aStartAngle=args[4],aEndAngle=args[5],aClockwise=!!args[6];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+xRadius*Math.cos(angle);ty=aY+yRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break}}var lastPoint=points[points.length-1];var EPSILON=1e-10;if(Math.abs(lastPoint.x-points[0].x)<EPSILON&&Math.abs(lastPoint.y-points[0].y)<EPSILON)points.splice(points.length-1,1);if(closedPath){points.push(points[0])}return points};THREE.Path.prototype.toShapes=function(isCCW,noHoles){function extractSubpaths(inActions){var i,il,item,action,args;var subPaths=[],lastPath=new THREE.Path;for(i=0,il=inActions.length;i<il;i++){item=inActions[i];args=item.args;action=item.action;if(action==THREE.PathActions.MOVE_TO){if(lastPath.actions.length!=0){subPaths.push(lastPath);lastPath=new THREE.Path}}lastPath[action].apply(lastPath,args)}if(lastPath.actions.length!=0){subPaths.push(lastPath)}return subPaths}function toShapesNoHoles(inSubpaths){var shapes=[];for(var i=0,il=inSubpaths.length;i<il;i++){var tmpPath=inSubpaths[i];var tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){var EPSILON=1e-10;var polyLen=inPolygon.length;var inside=false;for(var p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p];var edgeHighPt=inPolygon[q];var edgeDx=edgeHighPt.x-edgeLowPt.x;var edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>EPSILON){if(edgeDy<0){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y==edgeLowPt.y){if(inPt.x==edgeLowPt.x)return true}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(perpEdge==0)return true;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!=edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return true}}return inside}var subPaths=extractSubpaths(this.actions);if(subPaths.length==0)return[];if(noHoles===true)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(subPaths.length==1){tmpPath=subPaths[0];tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes}var holesFirst=!THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var betterShapeHoles=[];var newShapes=[];var newShapeHoles=[];var mainIdx=0;var tmpPoints;newShapes[mainIdx]=undefined;newShapeHoles[mainIdx]=[];var i,il;for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=THREE.Shape.Utils.isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx])mainIdx++;newShapes[mainIdx]={s:new THREE.Shape,p:tmpPoints};newShapes[mainIdx].s.actions=tmpPath.actions;newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst)mainIdx++;newShapeHoles[mainIdx]=[]}else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]})}}if(!newShapes[0])return toShapesNoHoles(subPaths);if(newShapes.length>1){var ambigious=false;var toChange=[];for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[]}for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){var sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){var ho=sho[hIdx];var hole_unassigned=true;for(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!=s2Idx)toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});if(hole_unassigned){hole_unassigned=false;betterShapeHoles[s2Idx].push(ho)}else{ambigious=true}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho)}}}if(toChange.length>0){if(!ambigious)newShapeHoles=betterShapeHoles}}var tmpHoles,j,jl;for(i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h)}}return shapes};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(options){var extruded=new THREE.ExtrudeGeometry(this,options);return extruded};THREE.Shape.prototype.makeGeometry=function(options){var geometry=new THREE.ShapeGeometry(this,options);return geometry};THREE.Shape.prototype.getPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.getSpacedPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedSpacedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.extractAllPoints=function(divisions){return{shape:this.getTransformedPoints(divisions),holes:this.getPointsHoles(divisions)}};THREE.Shape.prototype.extractPoints=function(divisions){if(this.useSpacedPoints){return this.extractAllSpacedPoints(divisions)}return this.extractAllPoints(divisions)};THREE.Shape.prototype.extractAllSpacedPoints=function(divisions){return{shape:this.getTransformedSpacedPoints(divisions),holes:this.getSpacedPointsHoles(divisions)}};THREE.Shape.Utils={triangulateShape:function(contour,holes){function point_in_segment_2D_colin(inSegPt1,inSegPt2,inOtherPt){if(inSegPt1.x!=inSegPt2.x){if(inSegPt1.x<inSegPt2.x){return inSegPt1.x<=inOtherPt.x&&inOtherPt.x<=inSegPt2.x}else{return inSegPt2.x<=inOtherPt.x&&inOtherPt.x<=inSegPt1.x}}else{if(inSegPt1.y<inSegPt2.y){return inSegPt1.y<=inOtherPt.y&&inOtherPt.y<=inSegPt2.y}else{return inSegPt2.y<=inOtherPt.y&&inOtherPt.y<=inSegPt1.y}}}function intersect_segments_2D(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1,inSeg2Pt2,inExcludeAdjacentSegs){var EPSILON=1e-10;var seg1dx=inSeg1Pt2.x-inSeg1Pt1.x,seg1dy=inSeg1Pt2.y-inSeg1Pt1.y;var seg2dx=inSeg2Pt2.x-inSeg2Pt1.x,seg2dy=inSeg2Pt2.y-inSeg2Pt1.y;var seg1seg2dx=inSeg1Pt1.x-inSeg2Pt1.x;var seg1seg2dy=inSeg1Pt1.y-inSeg2Pt1.y;var limit=seg1dy*seg2dx-seg1dx*seg2dy;var perpSeg1=seg1dy*seg1seg2dx-seg1dx*seg1seg2dy;if(Math.abs(limit)>EPSILON){var perpSeg2;if(limit>0){if(perpSeg1<0||perpSeg1>limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2<0||perpSeg2>limit)return[]}else{if(perpSeg1>0||perpSeg1<limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2>0||perpSeg2<limit)return[]}if(perpSeg2==0){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt1]}if(perpSeg2==limit){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt2]}if(perpSeg1==0)return[inSeg2Pt1];if(perpSeg1==limit)return[inSeg2Pt2];var factorSeg1=perpSeg2/limit;return[{x:inSeg1Pt1.x+factorSeg1*seg1dx,y:inSeg1Pt1.y+factorSeg1*seg1dy}]}else{if(perpSeg1!=0||seg2dy*seg1seg2dx!=seg2dx*seg1seg2dy)return[];var seg1Pt=seg1dx==0&&seg1dy==0;var seg2Pt=seg2dx==0&&seg2dy==0;if(seg1Pt&&seg2Pt){if(inSeg1Pt1.x!=inSeg2Pt1.x||inSeg1Pt1.y!=inSeg2Pt1.y)return[];return[inSeg1Pt1]}if(seg1Pt){if(!point_in_segment_2D_colin(inSeg2Pt1,inSeg2Pt2,inSeg1Pt1))return[];return[inSeg1Pt1]}if(seg2Pt){if(!point_in_segment_2D_colin(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1))return[];return[inSeg2Pt1]}var seg1min,seg1max,seg1minVal,seg1maxVal;var seg2min,seg2max,seg2minVal,seg2maxVal;if(seg1dx!=0){if(inSeg1Pt1.x<inSeg1Pt2.x){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.x;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.x}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.x;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.x}if(inSeg2Pt1.x<inSeg2Pt2.x){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.x;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.x}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.x;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.x}}else{if(inSeg1Pt1.y<inSeg1Pt2.y){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.y;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.y}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.y;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.y}if(inSeg2Pt1.y<inSeg2Pt2.y){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.y;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.y}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.y;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.y}}if(seg1minVal<=seg2minVal){if(seg1maxVal<seg2minVal)return[];if(seg1maxVal==seg2minVal){if(inExcludeAdjacentSegs)return[];return[seg2min]}if(seg1maxVal<=seg2maxVal)return[seg2min,seg1max];return[seg2min,seg2max]}else{if(seg1minVal>seg2maxVal)return[];if(seg1minVal==seg2maxVal){if(inExcludeAdjacentSegs)return[];return[seg1min]}if(seg1maxVal<=seg2maxVal)return[seg1min,seg1max];return[seg1min,seg2max]}}}function isPointInsideAngle(inVertex,inLegFromPt,inLegToPt,inOtherPt){var EPSILON=1e-10;var legFromPtX=inLegFromPt.x-inVertex.x,legFromPtY=inLegFromPt.y-inVertex.y;var legToPtX=inLegToPt.x-inVertex.x,legToPtY=inLegToPt.y-inVertex.y;var otherPtX=inOtherPt.x-inVertex.x,otherPtY=inOtherPt.y-inVertex.y;var from2toAngle=legFromPtX*legToPtY-legFromPtY*legToPtX;var from2otherAngle=legFromPtX*otherPtY-legFromPtY*otherPtX;if(Math.abs(from2toAngle)>EPSILON){var other2toAngle=otherPtX*legToPtY-otherPtY*legToPtX;if(from2toAngle>0){return from2otherAngle>=0&&other2toAngle>=0}else{return from2otherAngle>=0||other2toAngle>=0}}else{return from2otherAngle>0}}function removeHoles(contour,holes){var shape=contour.concat();var hole;function isCutLineInsideAngles(inShapeIdx,inHoleIdx){var lastShapeIdx=shape.length-1;var prevShapeIdx=inShapeIdx-1;if(prevShapeIdx<0)prevShapeIdx=lastShapeIdx;var nextShapeIdx=inShapeIdx+1;if(nextShapeIdx>lastShapeIdx)nextShapeIdx=0;var insideAngle=isPointInsideAngle(shape[inShapeIdx],shape[prevShapeIdx],shape[nextShapeIdx],hole[inHoleIdx]);if(!insideAngle){return false}var lastHoleIdx=hole.length-1;var prevHoleIdx=inHoleIdx-1;if(prevHoleIdx<0)prevHoleIdx=lastHoleIdx;var nextHoleIdx=inHoleIdx+1;if(nextHoleIdx>lastHoleIdx)nextHoleIdx=0;insideAngle=isPointInsideAngle(hole[inHoleIdx],hole[prevHoleIdx],hole[nextHoleIdx],shape[inShapeIdx]);if(!insideAngle){return false}return true}function intersectsShapeEdge(inShapePt,inHolePt){var sIdx,nextIdx,intersection;for(sIdx=0;sIdx<shape.length;sIdx++){nextIdx=sIdx+1;nextIdx%=shape.length;intersection=intersect_segments_2D(inShapePt,inHolePt,shape[sIdx],shape[nextIdx],true);if(intersection.length>0)return true}return false}var indepHoles=[];function intersectsHoleEdge(inShapePt,inHolePt){var ihIdx,chkHole,hIdx,nextIdx,intersection;for(ihIdx=0;ihIdx<indepHoles.length;ihIdx++){chkHole=holes[indepHoles[ihIdx]];for(hIdx=0;hIdx<chkHole.length;hIdx++){nextIdx=hIdx+1;nextIdx%=chkHole.length;intersection=intersect_segments_2D(inShapePt,inHolePt,chkHole[hIdx],chkHole[nextIdx],true);if(intersection.length>0)return true}}return false}var holeIndex,shapeIndex,shapePt,holePt,holeIdx,cutKey,failedCuts=[],tmpShape1,tmpShape2,tmpHole1,tmpHole2;for(var h=0,hl=holes.length;h<hl;h++){indepHoles.push(h)}var minShapeIndex=0;var counter=indepHoles.length*2;while(indepHoles.length>0){counter--;if(counter<0){console.log("Infinite Loop! Holes left:"+indepHoles.length+", Probably Hole outside Shape!");break}for(shapeIndex=minShapeIndex;shapeIndex<shape.length;shapeIndex++){shapePt=shape[shapeIndex];holeIndex=-1;for(var h=0;h<indepHoles.length;h++){holeIdx=indepHoles[h];cutKey=shapePt.x+":"+shapePt.y+":"+holeIdx;if(failedCuts[cutKey]!==undefined)continue;hole=holes[holeIdx];for(var h2=0;h2<hole.length;h2++){holePt=hole[h2];if(!isCutLineInsideAngles(shapeIndex,h2))continue;if(intersectsShapeEdge(shapePt,holePt))continue;if(intersectsHoleEdge(shapePt,holePt))continue;holeIndex=h2;indepHoles.splice(h,1);tmpShape1=shape.slice(0,shapeIndex+1);tmpShape2=shape.slice(shapeIndex);tmpHole1=hole.slice(holeIndex);tmpHole2=hole.slice(0,holeIndex+1);shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);minShapeIndex=shapeIndex;break}if(holeIndex>=0)break;failedCuts[cutKey]=true}if(holeIndex>=0)break}}return shape}var i,il,f,face,key,index,allPointsMap={};var allpoints=contour.concat();for(var h=0,hl=holes.length;h<hl;h++){Array.prototype.push.apply(allpoints,holes[h])}for(i=0,il=allpoints.length;i<il;i++){key=allpoints[i].x+":"+allpoints[i].y;if(allPointsMap[key]!==undefined){THREE.warn("THREE.Shape: Duplicate point",key)}allPointsMap[key]=i}var shapeWithoutHoles=removeHoles(contour,holes);var triangles=THREE.FontUtils.Triangulate(shapeWithoutHoles,false);for(i=0,il=triangles.length;i<il;i++){face=triangles[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index}}}return triangles.concat()},isClockWise:function(pts){return THREE.FontUtils.Triangulate.area(pts)<0},b2p0:function(t,p){var k=1-t;return k*k*p},b2p1:function(t,p){return 2*(1-t)*t*p},b2p2:function(t,p){return t*t*p},b2:function(t,p0,p1,p2){return this.b2p0(t,p0)+this.b2p1(t,p1)+this.b2p2(t,p2)},b3p0:function(t,p){var k=1-t;return k*k*k*p},b3p1:function(t,p){var k=1-t;return 3*k*k*t*p},b3p2:function(t,p){var k=1-t;return 3*k*t*t*p},b3p3:function(t,p){return t*t*t*p},b3:function(t,p0,p1,p2,p3){return this.b3p0(t,p0)+this.b3p1(t,p1)+this.b3p2(t,p2)+this.b3p3(t,p3)}};THREE.LineCurve=function(v1,v2){this.v1=v1;this.v2=v2};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(t){var point=this.v2.clone().sub(this.v1);point.multiplyScalar(t).add(this.v1);return point};THREE.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)};THREE.LineCurve.prototype.getTangent=function(t){var tangent=this.v2.clone().sub(this.v1);return tangent.normalize()};THREE.QuadraticBezierCurve=function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var vector=new THREE.Vector2;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return vector};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);return vector.normalize()};THREE.CubicBezierCurve=function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(tx,ty)};THREE.CubicBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent};THREE.SplineCurve=function(points){this.points=points==undefined?[]:points};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);return vector};THREE.EllipseCurve=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){this.aX=aX;this.aY=aY;this.xRadius=xRadius;this.yRadius=yRadius;this.aStartAngle=aStartAngle;this.aEndAngle=aEndAngle;this.aClockwise=aClockwise};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(t){var deltaAngle=this.aEndAngle-this.aStartAngle;if(deltaAngle<0)deltaAngle+=Math.PI*2;if(deltaAngle>Math.PI*2)deltaAngle-=Math.PI*2;var angle;if(this.aClockwise===true){angle=this.aEndAngle+(1-t)*(Math.PI*2-deltaAngle)}else{angle=this.aStartAngle+t*deltaAngle}var vector=new THREE.Vector2;vector.x=this.aX+this.xRadius*Math.cos(angle);vector.y=this.aY+this.yRadius*Math.sin(angle);return vector};THREE.ArcCurve=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){THREE.EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(v1,v2){this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.subVectors(this.v2,this.v1);vector.multiplyScalar(t);vector.add(this.v1);return vector});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);vector.z=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return vector});THREE.CubicBezierCurve3=THREE.Curve.create(function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);vector.y=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);vector.z=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return vector});THREE.SplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.ClosedSplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-0)*t;var intPoint=Math.floor(point);var weight=point-intPoint;intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;var point0=points[(intPoint-1)%points.length];var point1=points[intPoint%points.length];var point2=points[(intPoint+1)%points.length];var point3=points[(intPoint+2)%points.length];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){THREE.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){THREE.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){THREE.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(data){if(data.initialized===true)return data;for(var h=0;h<data.hierarchy.length;h++){for(var k=0;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time<0){data.hierarchy[h].keys[k].time=0}if(data.hierarchy[h].keys[k].rot!==undefined&&!(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var quat=data.hierarchy[h].keys[k].rot;data.hierarchy[h].keys[k].rot=(new THREE.Quaternion).fromArray(quat)}}if(data.hierarchy[h].keys.length&&data.hierarchy[h].keys[0].morphTargets!==undefined){var usedMorphTargets={};for(var k=0;k<data.hierarchy[h].keys.length;k++){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){var morphTargetName=data.hierarchy[h].keys[k].morphTargets[m];usedMorphTargets[morphTargetName]=-1}}data.hierarchy[h].usedMorphTargets=usedMorphTargets;for(var k=0;k<data.hierarchy[h].keys.length;k++){var influences={};for(var morphTargetName in usedMorphTargets){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){if(data.hierarchy[h].keys[k].morphTargets[m]===morphTargetName){influences[morphTargetName]=data.hierarchy[h].keys[k].morphTargetsInfluences[m];break}}if(m===data.hierarchy[h].keys[k].morphTargets.length){influences[morphTargetName]=0}}data.hierarchy[h].keys[k].morphTargetsInfluences=influences}}for(var k=1;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time===data.hierarchy[h].keys[k-1].time){data.hierarchy[h].keys.splice(k,1);k--}}for(var k=0;k<data.hierarchy[h].keys.length;k++){data.hierarchy[h].keys[k].index=k}}data.initialized=true;return data},parse:function(root){var parseRecurseHierarchy=function(root,hierarchy){hierarchy.push(root);for(var c=0;c<root.children.length;c++)parseRecurseHierarchy(root.children[c],hierarchy)};var hierarchy=[];if(root instanceof THREE.SkinnedMesh){for(var b=0;b<root.skeleton.bones.length;b++){hierarchy.push(root.skeleton.bones[b])}}else{parseRecurseHierarchy(root,hierarchy)}return hierarchy},play:function(animation){if(this.animations.indexOf(animation)===-1){this.animations.push(animation)}},stop:function(animation){var index=this.animations.indexOf(animation);if(index!==-1){this.animations.splice(index,1)}},update:function(deltaTimeMS){for(var i=0;i<this.animations.length;i++){this.animations[i].resetBlendWeights()}for(var i=0;i<this.animations.length;i++){this.animations[i].update(deltaTimeMS)}}};THREE.Animation=function(root,data){this.root=root;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(startTime,weight){this.currentTime=startTime!==undefined?startTime:0;this.weight=weight!==undefined?weight:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)},reset:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];if(object.animationCache===undefined){object.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var name=this.data.name;var animations=object.animationCache.animations;var animationCache=animations[name];if(animationCache===undefined){animationCache={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:object.matrix};animations[name]=animationCache}for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=this.data.hierarchy[h].keys[0];var nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}}},resetBlendWeights:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache;if(animationCache!==undefined){var blending=animationCache.blending;blending.positionWeight=0;blending.quaternionWeight=0;blending.scaleWeight=0}}},update:function(){var points=[];var target=new THREE.Vector3;var newVector=new THREE.Vector3;var newQuat=new THREE.Quaternion;var interpolateCatmullRom=function(points,scale){var c=[],v3=[],point,intPoint,weight,w2,w3,pa,pb,pc,pd;point=(points.length-1)*scale;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?intPoint:intPoint+1;c[3]=intPoint>points.length-3?intPoint:intPoint+2;pa=points[c[0]];pb=points[c[1]];pc=points[c[2]];pd=points[c[3]];w2=weight*weight;w3=weight*w2;v3[0]=interpolate(pa[0],pb[0],pc[0],pd[0],weight,w2,w3);v3[1]=interpolate(pa[1],pb[1],pc[1],pd[1],weight,w2,w3);v3[2]=interpolate(pa[2],pb[2],pc[2],pd[2],weight,w2,w3);return v3};var interpolate=function(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1};return function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;if(this.weight===0)return;var duration=this.data.length;if(this.currentTime>duration||this.currentTime<0){if(this.loop){this.currentTime%=duration;if(this.currentTime<0)this.currentTime+=duration;this.reset()}else{this.stop()}}for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache.animations[this.data.name];var blending=object.animationCache.blending;for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=animationCache.prevKey[type];var nextKey=animationCache.nextKey[type];if(this.timeScale>0&&nextKey.time<=this.currentTime||this.timeScale<0&&prevKey.time>=this.currentTime){prevKey=this.data.hierarchy[h].keys[0];nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}var scale=(this.currentTime-prevKey.time)/(nextKey.time-prevKey.time);var prevXYZ=prevKey[type];var nextXYZ=nextKey[type];if(scale<0)scale=0;if(scale>1)scale=1;if(type==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.positionWeight);object.position.lerp(newVector,proportionalWeight);blending.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){points[0]=this.getPrevKeyWith("pos",h,prevKey.index-1)["pos"];points[1]=prevXYZ;points[2]=nextXYZ;points[3]=this.getNextKeyWith("pos",h,nextKey.index+1)["pos"];scale=scale*.33+.33;var currentPoint=interpolateCatmullRom(points,scale);
var proportionalWeight=this.weight/(this.weight+blending.positionWeight);blending.positionWeight+=this.weight;var vector=object.position;vector.x=vector.x+(currentPoint[0]-vector.x)*proportionalWeight;vector.y=vector.y+(currentPoint[1]-vector.y)*proportionalWeight;vector.z=vector.z+(currentPoint[2]-vector.z)*proportionalWeight;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var forwardPoint=interpolateCatmullRom(points,scale*1.01);target.set(forwardPoint[0],forwardPoint[1],forwardPoint[2]);target.sub(vector);target.y=0;target.normalize();var angle=Math.atan2(target.x,target.z);object.rotation.set(0,angle,0)}}}else if(type==="rot"){THREE.Quaternion.slerp(prevXYZ,nextXYZ,newQuat,scale);if(blending.quaternionWeight===0){object.quaternion.copy(newQuat);blending.quaternionWeight=this.weight}else{var proportionalWeight=this.weight/(this.weight+blending.quaternionWeight);THREE.Quaternion.slerp(object.quaternion,newQuat,object.quaternion,proportionalWeight);blending.quaternionWeight+=this.weight}}else if(type==="scl"){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.scaleWeight);object.scale.lerp(newVector,proportionalWeight);blending.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key<keys.length-1?key:keys.length-1}else{key=key%keys.length}for(;key<keys.length;key++){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[0]},getPrevKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key>0?key:0}else{key=key>=0?key:key+keys.length}for(;key>=0;key--){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[keys.length-1]}};THREE.KeyFrameAnimation=function(data){this.root=data.node;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,obj=this.hierarchy[h];if(keys.length&&sids){for(var s=0;s<sids.length;s++){var sid=sids[s],next=this.getNextKeyWith(sid,h,0);if(next){next.apply(sid)}}obj.matrixAutoUpdate=false;this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(startTime){this.currentTime=startTime!==undefined?startTime:0;if(this.isPlaying===false){this.isPlaying=true;var h,hl=this.hierarchy.length,object,node;for(h=0;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];if(node.animationCache===undefined){node.animationCache={};node.animationCache.prevKey=null;node.animationCache.nextKey=null;node.animationCache.originalMatrix=object.matrix}var keys=this.data.hierarchy[h].keys;if(keys.length){node.animationCache.prevKey=keys[0];node.animationCache.nextKey=keys[1];this.startTime=Math.min(keys[0].time,this.startTime);this.endTime=Math.max(keys[keys.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var h=0;h<this.data.hierarchy.length;h++){var obj=this.hierarchy[h];var node=this.data.hierarchy[h];if(node.animationCache!==undefined){var original=node.animationCache.originalMatrix;original.copy(obj.matrix);obj.matrix=original;delete node.animationCache}}},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;var duration=this.data.length;if(this.loop===true&&this.currentTime>duration){this.currentTime%=duration}this.currentTime=Math.min(this.currentTime,duration);for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var node=this.data.hierarchy[h];var keys=node.keys,animationCache=node.animationCache;if(keys.length){var prevKey=animationCache.prevKey;var nextKey=animationCache.nextKey;if(nextKey.time<=this.currentTime){while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=keys[prevKey.index+1]}animationCache.prevKey=prevKey;animationCache.nextKey=nextKey}if(nextKey.time>=this.currentTime){prevKey.interpolate(nextKey,this.currentTime)}else{prevKey.interpolate(nextKey,nextKey.time)}this.data.hierarchy[h].node.updateMatrix();object.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key%keys.length;for(;key<keys.length;key++){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[0]},getPrevKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key>=0?key:key+keys.length;for(;key>=0;key--){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[keys.length-1]}};THREE.MorphAnimation=function(mesh){this.mesh=mesh;this.frames=mesh.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var interpolation=this.duration/this.frames;var frame=Math.floor(this.currentTime/interpolation);var influences=this.mesh.morphTargetInfluences;if(frame!=this.currentFrame){influences[this.lastFrame]=0;influences[this.currentFrame]=1;influences[frame]=0;this.lastFrame=this.currentFrame;this.currentFrame=frame}influences[frame]=this.currentTime%interpolation/interpolation;influences[this.lastFrame]=1-influences[frame]}};THREE.BoxGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.widthSegments=widthSegments||1;this.heightSegments=heightSegments||1;this.depthSegments=depthSegments||1;var scope=this;var width_half=width/2;var height_half=height/2;var depth_half=depth/2;buildPlane("z","y",-1,-1,depth,height,width_half,0);buildPlane("z","y",1,-1,depth,height,-width_half,1);buildPlane("x","z",1,1,width,depth,height_half,2);buildPlane("x","z",1,-1,width,depth,-height_half,3);buildPlane("x","y",1,-1,width,height,depth_half,4);buildPlane("x","y",-1,-1,width,height,-depth_half,5);function buildPlane(u,v,udir,vdir,width,height,depth,materialIndex){var w,ix,iy,gridX=scope.widthSegments,gridY=scope.heightSegments,width_half=width/2,height_half=height/2,offset=scope.vertices.length;if(u==="x"&&v==="y"||u==="y"&&v==="x"){w="z"}else if(u==="x"&&v==="z"||u==="z"&&v==="x"){w="y";gridY=scope.depthSegments}else if(u==="z"&&v==="y"||u==="y"&&v==="z"){w="x";gridX=scope.depthSegments}var gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new THREE.Vector3;normal[w]=depth>0?1:-1;for(iy=0;iy<gridY1;iy++){for(ix=0;ix<gridX1;ix++){var vector=new THREE.Vector3;vector[u]=(ix*segment_width-width_half)*udir;vector[v]=(iy*segment_height-height_half)*vdir;vector[w]=depth;scope.vertices.push(vector)}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;var uva=new THREE.Vector2(ix/gridX,1-iy/gridY);var uvb=new THREE.Vector2(ix/gridX,1-(iy+1)/gridY);var uvc=new THREE.Vector2((ix+1)/gridX,1-(iy+1)/gridY);var uvd=new THREE.Vector2((ix+1)/gridX,1-iy/gridY);var face=new THREE.Face3(a+offset,b+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uva,uvb,uvd]);face=new THREE.Face3(b+offset,c+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}}this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CircleGeometry=function(radius,segments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;var i,uvs=[],center=new THREE.Vector3,centerUV=new THREE.Vector2(.5,.5);this.vertices.push(center);uvs.push(centerUV);for(i=0;i<=segments;i++){var vertex=new THREE.Vector3;var segment=thetaStart+i/segments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/radius+1)/2,(vertex.y/radius+1)/2))}var n=new THREE.Vector3(0,0,1);for(i=1;i<=segments;i++){this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[i].clone(),uvs[i+1].clone(),centerUV.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CubeGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments)};THREE.CylinderGeometry=function(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};radiusTop=radiusTop!==undefined?radiusTop:20;radiusBottom=radiusBottom!==undefined?radiusBottom:20;height=height!==undefined?height:100;radialSegments=radialSegments||8;heightSegments=heightSegments||1;openEnded=openEnded!==undefined?openEnded:false;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:2*Math.PI;var heightHalf=height/2;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];var v=y/heightSegments;var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var vertex=new THREE.Vector3;vertex.x=radius*Math.sin(u*thetaLength+thetaStart);vertex.y=-v*height+heightHalf;vertex.z=radius*Math.cos(u*thetaLength+thetaStart);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}var tanTheta=(radiusBottom-radiusTop)/height;var na,nb;for(x=0;x<radialSegments;x++){if(radiusTop!==0){na=this.vertices[vertices[0][x]].clone();nb=this.vertices[vertices[0][x+1]].clone()}else{na=this.vertices[vertices[1][x]].clone();nb=this.vertices[vertices[1][x+1]].clone()}na.setY(Math.sqrt(na.x*na.x+na.z*na.z)*tanTheta).normalize();nb.setY(Math.sqrt(nb.x*nb.x+nb.z*nb.z)*tanTheta).normalize();for(y=0;y<heightSegments;y++){var v1=vertices[y][x];var v2=vertices[y+1][x];var v3=vertices[y+1][x+1];var v4=vertices[y][x+1];var n1=na.clone();var n2=na.clone();var n3=nb.clone();var n4=nb.clone();var uv1=uvs[y][x].clone();var uv2=uvs[y+1][x].clone();var uv3=uvs[y+1][x+1].clone();var uv4=uvs[y][x+1].clone();this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}if(openEnded===false&&radiusTop>0){this.vertices.push(new THREE.Vector3(0,heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[0][x];var v2=vertices[0][x+1];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,1,0);var n2=new THREE.Vector3(0,1,0);var n3=new THREE.Vector3(0,1,0);var uv1=uvs[0][x].clone();var uv2=uvs[0][x+1].clone();var uv3=new THREE.Vector2(uv2.x,0);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}if(openEnded===false&&radiusBottom>0){this.vertices.push(new THREE.Vector3(0,(-heightHalf),0));for(x=0;x<radialSegments;x++){var v1=vertices[heightSegments][x+1];var v2=vertices[heightSegments][x];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,(-1),0);var n2=new THREE.Vector3(0,(-1),0);var n3=new THREE.Vector3(0,(-1),0);var uv1=uvs[heightSegments][x+1].clone();var uv2=uvs[heightSegments][x].clone();var uv3=new THREE.Vector2(uv2.x,1);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(shapes,options){if(typeof shapes==="undefined"){shapes=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";shapes=shapes instanceof Array?shapes:[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;for(var s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options)}};THREE.ExtrudeGeometry.prototype.addShape=function(shape,options){var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;var material=options.material;var extrudeMaterial=options.extrudeMaterial;var uvgen=options.UVGenerator!==undefined?options.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;splineTube=options.frames!==undefined?options.frames:new THREE.TubeGeometry.FrenetFrames(extrudePath,steps,false);binormal=new THREE.Vector3;normal=new THREE.Vector3;position2=new THREE.Vector3}if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0}var ahole,h,hl;var scope=this;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(THREE.Shape.Utils.isClockWise(ahole)){holes[h]=ahole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole)}function scalePt2(pt,vec,size){if(!vec)THREE.error("THREE.ExtrudeGeometry: vec does not exist");return vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var EPSILON=1e-10;var v_trans_x,v_trans_y,shrink_by=1;var v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y;var v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y;var v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;var colinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(colinear0)>EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq);var v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);var ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;var ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;var ptNextShift_x=inNext.x-v_next_y/v_next_len;var ptNextShift_y=inNext.y+v_next_x/v_next_len;var sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(v_trans_lensq<=2){return new THREE.Vector2(v_trans_x,v_trans_y)}else{shrink_by=Math.sqrt(v_trans_lensq/2)}}else{var direction_eq=false;if(v_prev_x>EPSILON){if(v_next_x>EPSILON){direction_eq=true}}else{if(v_prev_x<-EPSILON){if(v_next_x<-EPSILON){direction_eq=true}}else{if(Math.sign(v_prev_y)==Math.sign(v_next_y)){direction_eq=true}}}if(direction_eq){v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=Math.sqrt(v_prev_lensq)}else{v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=Math.sqrt(v_prev_lensq/2)}}return new THREE.Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k])}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k])}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z)}}}bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0)}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s)}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}}for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z)}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z)}}}}buildLidFaces();buildSideFaces();function buildLidFaces(){if(bevelEnabled){var layer=0;var offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset)}layer=steps+bevelSegments*2;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset)}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0])}for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}}function buildSideFaces(){var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length}}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0)k=contour.length-1;var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d,contour,s,sl,j,k)}}}function v(x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z))}function f3(a,b,c){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,c,null,null,material));var uvs=uvgen.generateTopUV(scope,a,b,c);scope.faceVertexUvs[0].push(uvs)}function f4(a,b,c,d,wallContour,stepIndex,stepsLength,contourIndex1,contourIndex2){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;d+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,d,null,null,extrudeMaterial));scope.faces.push(new THREE.Face3(b,c,d,null,null,extrudeMaterial));var uvs=uvgen.generateSideWallUV(scope,a,b,c,d);scope.faceVertexUvs[0].push([uvs[0],uvs[1],uvs[3]]);scope.faceVertexUvs[0].push([uvs[1],uvs[2],uvs[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,indexA,indexB,indexC){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y)]},generateSideWallUV:function(geometry,indexA,indexB,indexC,indexD){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];var d=vertices[indexD];if(Math.abs(a.y-b.y)<.01){return[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z)]}else{return[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,1-d.z)]}}};THREE.ShapeGeometry=function(shapes,options){THREE.Geometry.call(this);this.type="ShapeGeometry";if(shapes instanceof Array===false)shapes=[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(shapes,options){for(var i=0,l=shapes.length;i<l;i++){this.addShape(shapes[i],options)}return this};THREE.ShapeGeometry.prototype.addShape=function(shape,options){if(options===undefined)options={};var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var material=options.material;var uvgen=options.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:options.UVGenerator;var i,l,hole;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(i=0,l=holes.length;i<l;i++){hole=holes[i];if(THREE.Shape.Utils.isClockWise(hole)){holes[i]=hole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(i=0,l=holes.length;i<l;i++){hole=holes[i];vertices=vertices.concat(hole)}var vert,vlen=vertices.length;var face,flen=faces.length;for(i=0;i<vlen;i++){vert=vertices[i];this.vertices.push(new THREE.Vector3(vert.x,vert.y,0))}for(i=0;i<flen;i++){face=faces[i];var a=face[0]+shapesOffset;var b=face[1]+shapesOffset;var c=face[2]+shapesOffset;this.faces.push(new THREE.Face3(a,b,c,null,null,material));this.faceVertexUvs[0].push(uvgen.generateTopUV(this,a,b,c))}};THREE.LatheGeometry=function(points,segments,phiStart,phiLength){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=segments||12;phiStart=phiStart||0;phiLength=phiLength||2*Math.PI;var inversePointLength=1/(points.length-1);var inverseSegments=1/segments;for(var i=0,il=segments;i<=il;i++){var phi=phiStart+i*inverseSegments*phiLength;var c=Math.cos(phi),s=Math.sin(phi);for(var j=0,jl=points.length;j<jl;j++){var pt=points[j];var vertex=new THREE.Vector3;vertex.x=c*pt.x-s*pt.y;vertex.y=s*pt.x+c*pt.y;vertex.z=pt.z;this.vertices.push(vertex)}}var np=points.length;for(var i=0,il=segments;i<il;i++){for(var j=0,jl=points.length-1;j<jl;j++){var base=j+np*i;var a=base;var b=base+np;var c=base+1+np;var d=base+1;var u0=i*inverseSegments;var v0=j*inversePointLength;var u1=u0+inverseSegments;var v1=v0+inversePointLength;this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v0),new THREE.Vector2(u0,v1)]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([new THREE.Vector2(u1,v0),new THREE.Vector2(u1,v1),new THREE.Vector2(u0,v1)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(width,height,widthSegments,heightSegments){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width,height,widthSegments,heightSegments))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneBufferGeometry=function(width,height,widthSegments,heightSegments){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};var width_half=width/2;var height_half=height/2;var gridX=widthSegments||1;var gridY=heightSegments||1;var gridX1=gridX+1;var gridY1=gridY+1;var segment_width=width/gridX;var segment_height=height/gridY;var vertices=new Float32Array(gridX1*gridY1*3);var normals=new Float32Array(gridX1*gridY1*3);var uvs=new Float32Array(gridX1*gridY1*2);var offset=0;var offset2=0;for(var iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(var ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices[offset]=x;vertices[offset+1]=-y;normals[offset+2]=1;uvs[offset2]=ix/gridX;uvs[offset2+1]=1-iy/gridY;offset+=3;offset2+=2}}offset=0;var indices=new(vertices.length/3>65535?Uint32Array:Uint16Array)(gridX*gridY*6);for(var iy=0;iy<gridY;iy++){for(var ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;indices[offset]=a;indices[offset+1]=b;indices[offset+2]=d;indices[offset+3]=b;indices[offset+4]=c;indices[offset+5]=d;offset+=6}}this.addAttribute("index",new THREE.BufferAttribute(indices,1));this.addAttribute("position",new THREE.BufferAttribute(vertices,3));this.addAttribute("normal",new THREE.BufferAttribute(normals,3));this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.RingGeometry=function(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||0;outerRadius=outerRadius||50;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;thetaSegments=thetaSegments!==undefined?Math.max(3,thetaSegments):8;phiSegments=phiSegments!==undefined?Math.max(1,phiSegments):8;var i,o,uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments;for(i=0;i<phiSegments+1;i++){for(o=0;o<thetaSegments+1;o++){var vertex=new THREE.Vector3;var segment=thetaStart+o/thetaSegments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/outerRadius+1)/2,(vertex.y/outerRadius+1)/2))}radius+=radiusStep}var n=new THREE.Vector3(0,0,1);for(i=0;i<phiSegments;i++){var thetaSegment=i*(thetaSegments+1);for(o=0;o<thetaSegments;o++){var segment=o+thetaSegment;var v1=segment;var v2=segment+thetaSegments+1;var v3=segment+thetaSegments+2;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()]);v1=segment;v2=segment+thetaSegments+2;v3=segment+1;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];for(x=0;x<=widthSegments;x++){var u=x/widthSegments;var v=y/heightSegments;var vertex=new THREE.Vector3;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertex.y=radius*Math.cos(thetaStart+v*thetaLength);vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}for(y=0;y<heightSegments;y++){for(x=0;x<widthSegments;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];var n1=this.vertices[v1].clone().normalize();var n2=this.vertices[v2].clone().normalize();var n3=this.vertices[v3].clone().normalize();var n4=this.vertices[v4].clone().normalize();var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=uvs[y+1][x].clone();var uv4=uvs[y+1][x+1].clone();if(Math.abs(this.vertices[v1].y)===radius){uv1.x=(uv1.x+uv2.x)/2;this.faces.push(new THREE.Face3(v1,v3,v4,[n1,n3,n4]));this.faceVertexUvs[0].push([uv1,uv3,uv4])}else if(Math.abs(this.vertices[v3].y)===radius){uv3.x=(uv3.x+uv4.x)/2;this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}else{this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(text,parameters){
parameters=parameters||{};var textShapes=THREE.FontUtils.generateShapes(text,parameters);parameters.amount=parameters.height!==undefined?parameters.height:50;if(parameters.bevelThickness===undefined)parameters.bevelThickness=10;if(parameters.bevelSize===undefined)parameters.bevelSize=8;if(parameters.bevelEnabled===undefined)parameters.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,textShapes,parameters);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusGeometry=function(radius,tube,radialSegments,tubularSegments,arc){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||100;tube=tube||40;radialSegments=radialSegments||8;tubularSegments=tubularSegments||6;arc=arc||Math.PI*2;var center=new THREE.Vector3,uvs=[],normals=[];for(var j=0;j<=radialSegments;j++){for(var i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc;var v=j/radialSegments*Math.PI*2;center.x=radius*Math.cos(u);center.y=radius*Math.sin(u);var vertex=new THREE.Vector3;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u);vertex.y=(radius+tube*Math.cos(v))*Math.sin(u);vertex.z=tube*Math.sin(v);this.vertices.push(vertex);uvs.push(new THREE.Vector2(i/tubularSegments,j/radialSegments));normals.push(vertex.clone().sub(center).normalize())}}for(var j=1;j<=radialSegments;j++){for(var i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1;var b=(tubularSegments+1)*(j-1)+i-1;var c=(tubularSegments+1)*(j-1)+i;var d=(tubularSegments+1)*j+i;var face=new THREE.Face3(a,b,d,[normals[a].clone(),normals[b].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[a].clone(),uvs[b].clone(),uvs[d].clone()]);face=new THREE.Face3(b,c,d,[normals[b].clone(),normals[c].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[b].clone(),uvs[c].clone(),uvs[d].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(radius,tube,radialSegments,tubularSegments,p,q,heightScale){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,p:p,q:q,heightScale:heightScale};radius=radius||100;tube=tube||40;radialSegments=radialSegments||64;tubularSegments=tubularSegments||8;p=p||2;q=q||3;heightScale=heightScale||1;var grid=new Array(radialSegments);var tang=new THREE.Vector3;var n=new THREE.Vector3;var bitan=new THREE.Vector3;for(var i=0;i<radialSegments;++i){grid[i]=new Array(tubularSegments);var u=i/radialSegments*2*p*Math.PI;var p1=getPos(u,q,p,radius,heightScale);var p2=getPos(u+.01,q,p,radius,heightScale);tang.subVectors(p2,p1);n.addVectors(p2,p1);bitan.crossVectors(tang,n);n.crossVectors(bitan,tang);bitan.normalize();n.normalize();for(var j=0;j<tubularSegments;++j){var v=j/tubularSegments*2*Math.PI;var cx=-tube*Math.cos(v);var cy=tube*Math.sin(v);var pos=new THREE.Vector3;pos.x=p1.x+cx*n.x+cy*bitan.x;pos.y=p1.y+cx*n.y+cy*bitan.y;pos.z=p1.z+cx*n.z+cy*bitan.z;grid[i][j]=this.vertices.push(pos)-1}}for(var i=0;i<radialSegments;++i){for(var j=0;j<tubularSegments;++j){var ip=(i+1)%radialSegments;var jp=(j+1)%tubularSegments;var a=grid[i][j];var b=grid[ip][j];var c=grid[ip][jp];var d=grid[i][jp];var uva=new THREE.Vector2(i/radialSegments,j/tubularSegments);var uvb=new THREE.Vector2((i+1)/radialSegments,j/tubularSegments);var uvc=new THREE.Vector2((i+1)/radialSegments,(j+1)/tubularSegments);var uvd=new THREE.Vector2(i/radialSegments,(j+1)/tubularSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function getPos(u,in_q,in_p,radius,heightScale){var cu=Math.cos(u);var su=Math.sin(u);var quOverP=in_q/in_p*u;var cs=Math.cos(quOverP);var tx=radius*(2+cs)*.5*cu;var ty=radius*(2+cs)*su*.5;var tz=heightScale*radius*Math.sin(quOverP)*.5;return new THREE.Vector3(tx,ty,tz)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(path,segments,radius,radialSegments,closed,taper){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:path,segments:segments,radius:radius,radialSegments:radialSegments,closed:closed};segments=segments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||false;taper=taper||THREE.TubeGeometry.NoTaper;var grid=[];var scope=this,tangent,normal,binormal,numpoints=segments+1,u,v,r,cx,cy,pos,pos2=new THREE.Vector3,i,j,ip,jp,a,b,c,d,uva,uvb,uvc,uvd;var frames=new THREE.TubeGeometry.FrenetFrames(path,segments,closed),tangents=frames.tangents,normals=frames.normals,binormals=frames.binormals;this.tangents=tangents;this.normals=normals;this.binormals=binormals;function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1}for(i=0;i<numpoints;i++){grid[i]=[];u=i/(numpoints-1);pos=path.getPointAt(u);tangent=tangents[i];normal=normals[i];binormal=binormals[i];r=radius*taper(u);for(j=0;j<radialSegments;j++){v=j/radialSegments*2*Math.PI;cx=-r*Math.cos(v);cy=r*Math.sin(v);pos2.copy(pos);pos2.x+=cx*normal.x+cy*binormal.x;pos2.y+=cx*normal.y+cy*binormal.y;pos2.z+=cx*normal.z+cy*binormal.z;grid[i][j]=vert(pos2.x,pos2.y,pos2.z)}}for(i=0;i<segments;i++){for(j=0;j<radialSegments;j++){ip=closed?(i+1)%segments:i+1;jp=(j+1)%radialSegments;a=grid[i][j];b=grid[ip][j];c=grid[ip][jp];d=grid[i][jp];uva=new THREE.Vector2(i/segments,j/radialSegments);uvb=new THREE.Vector2((i+1)/segments,j/radialSegments);uvc=new THREE.Vector2((i+1)/segments,(j+1)/radialSegments);uvd=new THREE.Vector2(i/segments,(j+1)/radialSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(u){return 1};THREE.TubeGeometry.SinusoidalTaper=function(u){return Math.sin(Math.PI*u)};THREE.TubeGeometry.FrenetFrames=function(path,segments,closed){var normal=new THREE.Vector3,tangents=[],normals=[],binormals=[],vec=new THREE.Vector3,mat=new THREE.Matrix4,numpoints=segments+1,theta,epsilon=1e-4,smallest,tx,ty,tz,i,u;this.tangents=tangents;this.normals=normals;this.binormals=binormals;for(i=0;i<numpoints;i++){u=i/(numpoints-1);tangents[i]=path.getTangentAt(u);tangents[i].normalize()}initialNormal3();function initialNormal3(){normals[0]=new THREE.Vector3;binormals[0]=new THREE.Vector3;smallest=Number.MAX_VALUE;tx=Math.abs(tangents[0].x);ty=Math.abs(tangents[0].y);tz=Math.abs(tangents[0].z);if(tx<=smallest){smallest=tx;normal.set(1,0,0)}if(ty<=smallest){smallest=ty;normal.set(0,1,0)}if(tz<=smallest){normal.set(0,0,1)}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0])}for(i=1;i<numpoints;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>epsilon){vec.normalize();theta=Math.acos(THREE.Math.clamp(tangents[i-1].dot(tangents[i]),-1,1));normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))}binormals[i].crossVectors(tangents[i],normals[i])}if(closed){theta=Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints-1]),-1,1));theta/=numpoints-1;if(tangents[0].dot(vec.crossVectors(normals[0],normals[numpoints-1]))>0){theta=-theta}for(i=1;i<numpoints;i++){normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i])}}};THREE.PolyhedronGeometry=function(vertices,indices,radius,detail){THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;var that=this;for(var i=0,l=vertices.length;i<l;i+=3){prepare(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]))}var p=this.vertices;var faces=[];for(var i=0,j=0,l=indices.length;i<l;i+=3,j++){var v1=p[indices[i]];var v2=p[indices[i+1]];var v3=p[indices[i+2]];faces[j]=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()])}var centroid=new THREE.Vector3;for(var i=0,l=faces.length;i<l;i++){subdivide(faces[i],detail)}for(var i=0,l=this.faceVertexUvs[0].length;i<l;i++){var uvs=this.faceVertexUvs[0][i];var x0=uvs[0].x;var x1=uvs[1].x;var x2=uvs[2].x;var max=Math.max(x0,Math.max(x1,x2));var min=Math.min(x0,Math.min(x1,x2));if(max>.9&&min<.1){if(x0<.2)uvs[0].x+=1;if(x1<.2)uvs[1].x+=1;if(x2<.2)uvs[2].x+=1}}for(var i=0,l=this.vertices.length;i<l;i++){this.vertices[i].multiplyScalar(radius)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius);function prepare(vector){var vertex=vector.normalize().clone();vertex.index=that.vertices.push(vertex)-1;var u=azimuth(vector)/2/Math.PI+.5;var v=inclination(vector)/Math.PI+.5;vertex.uv=new THREE.Vector2(u,1-v);return vertex}function make(v1,v2,v3){var face=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()]);that.faces.push(face);centroid.copy(v1).add(v2).add(v3).divideScalar(3);var azi=azimuth(centroid);that.faceVertexUvs[0].push([correctUV(v1.uv,v1,azi),correctUV(v2.uv,v2,azi),correctUV(v3.uv,v3,azi)])}function subdivide(face,detail){var cols=Math.pow(2,detail);var a=prepare(that.vertices[face.a]);var b=prepare(that.vertices[face.b]);var c=prepare(that.vertices[face.c]);var v=[];for(var i=0;i<=cols;i++){v[i]=[];var aj=prepare(a.clone().lerp(c,i/cols));var bj=prepare(b.clone().lerp(c,i/cols));var rows=cols-i;for(var j=0;j<=rows;j++){if(j==0&&i==cols){v[i][j]=aj}else{v[i][j]=prepare(aj.clone().lerp(bj,j/rows))}}}for(var i=0;i<cols;i++){for(var j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);if(j%2==0){make(v[i][k+1],v[i+1][k],v[i][k])}else{make(v[i][k+1],v[i+1][k+1],v[i+1][k])}}}}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))}function correctUV(uv,vector,azimuth){if(azimuth<0&&uv.x===1)uv=new THREE.Vector2(uv.x-1,uv.y);if(vector.x===0&&vector.z===0)uv=new THREE.Vector2(azimuth/2/Math.PI+.5,uv.y);return uv.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.DodecahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var t=(1+Math.sqrt(5))/2;var r=1/t;var vertices=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r];var indices=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.IcosahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1];var indices=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="IcosahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var vertices=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var indices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="OctahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(radius,detail){var vertices=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var indices=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="TetrahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(func,slices,stacks){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:func,slices:slices,stacks:stacks};var verts=this.vertices;var faces=this.faces;var uvs=this.faceVertexUvs[0];var i,j,p;var u,v;var sliceCount=slices+1;for(i=0;i<=stacks;i++){v=i/stacks;for(j=0;j<=slices;j++){u=j/slices;p=func(u,v);verts.push(p)}}var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<stacks;i++){for(j=0;j<slices;j++){a=i*sliceCount+j;b=i*sliceCount+j+1;c=(i+1)*sliceCount+j+1;d=(i+1)*sliceCount+j;uva=new THREE.Vector2(j/slices,i/stacks);uvb=new THREE.Vector2((j+1)/slices,i/stacks);uvc=new THREE.Vector2((j+1)/slices,(i+1)/stacks);uvd=new THREE.Vector2(j/slices,(i+1)/stacks);faces.push(new THREE.Face3(a,b,d));uvs.push([uva,uvb,uvd]);faces.push(new THREE.Face3(b,c,d));uvs.push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(size){size=size||1;var vertices=new Float32Array([0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size]);var colors=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("color",new THREE.BufferAttribute(colors,3));var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var lineGeometry=new THREE.Geometry;lineGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var coneGeometry=new THREE.CylinderGeometry(0,.5,1,5,1);coneGeometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(dir,origin,length,color,headLength,headWidth){THREE.Object3D.call(this);if(color===undefined)color=16776960;if(length===undefined)length=1;if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.position.copy(origin);this.line=new THREE.Line(lineGeometry,new THREE.LineBasicMaterial({color:color}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new THREE.Mesh(coneGeometry,new THREE.MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var axis=new THREE.Vector3;var radians;return function(dir){if(dir.y>.99999){this.quaternion.set(0,0,0,1)}else if(dir.y<-.99999){this.quaternion.set(1,0,0,0)}else{axis.set(dir.z,0,-dir.x).normalize();radians=Math.acos(dir.y);this.quaternion.setFromAxisAngle(axis,radians)}}}();THREE.ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.line.scale.set(1,length-headLength,1);this.line.updateMatrix();this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(color){this.line.material.color.set(color);this.cone.material.color.set(color)};THREE.BoxHelper=function(object){var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(object!==undefined){this.update(object)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(object){var geometry=object.geometry;if(geometry.boundingBox===null){geometry.computeBoundingBox()}var min=geometry.boundingBox.min;var max=geometry.boundingBox.max;var vertices=this.geometry.attributes.position.array;vertices[0]=max.x;vertices[1]=max.y;vertices[2]=max.z;vertices[3]=min.x;vertices[4]=max.y;vertices[5]=max.z;vertices[6]=min.x;vertices[7]=max.y;vertices[8]=max.z;vertices[9]=min.x;vertices[10]=min.y;vertices[11]=max.z;vertices[12]=min.x;vertices[13]=min.y;vertices[14]=max.z;vertices[15]=max.x;vertices[16]=min.y;vertices[17]=max.z;vertices[18]=max.x;vertices[19]=min.y;vertices[20]=max.z;vertices[21]=max.x;vertices[22]=max.y;vertices[23]=max.z;vertices[24]=max.x;vertices[25]=max.y;vertices[26]=min.z;vertices[27]=min.x;vertices[28]=max.y;vertices[29]=min.z;vertices[30]=min.x;vertices[31]=max.y;vertices[32]=min.z;vertices[33]=min.x;vertices[34]=min.y;vertices[35]=min.z;vertices[36]=min.x;vertices[37]=min.y;vertices[38]=min.z;vertices[39]=max.x;vertices[40]=min.y;vertices[41]=min.z;vertices[42]=max.x;vertices[43]=min.y;vertices[44]=min.z;vertices[45]=max.x;vertices[46]=max.y;vertices[47]=min.z;vertices[48]=max.x;vertices[49]=max.y;vertices[50]=max.z;vertices[51]=max.x;vertices[52]=max.y;vertices[53]=min.z;vertices[54]=min.x;vertices[55]=max.y;vertices[56]=max.z;vertices[57]=min.x;vertices[58]=max.y;vertices[59]=min.z;vertices[60]=min.x;vertices[61]=min.y;vertices[62]=max.z;vertices[63]=min.x;vertices[64]=min.y;vertices[65]=min.z;vertices[66]=max.x;vertices[67]=min.y;vertices[68]=max.z;vertices[69]=max.x;vertices[70]=min.y;vertices[71]=min.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.BoundingBoxHelper=function(object,hex){var color=hex!==undefined?hex:8947848;this.object=object;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:color,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(camera){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var pointMap={};var hexFrustum=16755200;var hexCone=16711680;var hexUp=43775;var hexTarget=16777215;var hexCross=3355443;addLine("n1","n2",hexFrustum);addLine("n2","n4",hexFrustum);addLine("n4","n3",hexFrustum);addLine("n3","n1",hexFrustum);addLine("f1","f2",hexFrustum);addLine("f2","f4",hexFrustum);addLine("f4","f3",hexFrustum);addLine("f3","f1",hexFrustum);addLine("n1","f1",hexFrustum);addLine("n2","f2",hexFrustum);addLine("n3","f3",hexFrustum);addLine("n4","f4",hexFrustum);addLine("p","n1",hexCone);addLine("p","n2",hexCone);addLine("p","n3",hexCone);addLine("p","n4",hexCone);addLine("u1","u2",hexUp);addLine("u2","u3",hexUp);addLine("u3","u1",hexUp);addLine("c","t",hexTarget);addLine("p","c",hexCross);addLine("cn1","cn2",hexCross);addLine("cn3","cn4",hexCross);addLine("cf1","cf2",hexCross);addLine("cf3","cf4",hexCross);function addLine(a,b,hex){addPoint(a,hex);addPoint(b,hex)}function addPoint(id,hex){geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(hex));if(pointMap[id]===undefined){pointMap[id]=[]}pointMap[id].push(geometry.vertices.length-1)}THREE.Line.call(this,geometry,material,THREE.LinePieces);this.camera=camera;this.matrix=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=pointMap;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){var geometry,pointMap;var vector=new THREE.Vector3;var camera=new THREE.Camera;var setPoint=function(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==undefined){for(var i=0,il=points.length;i<il;i++){geometry.vertices[points[i]].copy(vector)}}};return function(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;camera.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",w*.7,h*1.1,-1);setPoint("u2",-w*.7,h*1.1,-1);setPoint("u3",0,h*2,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(light,size){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;size=size||1;var geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3((-size),size,0),new THREE.Vector3(size,size,0),new THREE.Vector3(size,(-size),0),new THREE.Vector3((-size),(-size),0),new THREE.Vector3((-size),size,0));var material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(geometry,material);this.add(this.lightPlane);geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3,new THREE.Vector3);material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(geometry,material);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var v3=new THREE.Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(v3);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(object,hex,thresholdAngle){var color=hex!==undefined?hex:16777215;thresholdAngle=thresholdAngle!==undefined?thresholdAngle:1;var thresholdDot=Math.cos(THREE.Math.degToRad(thresholdAngle));var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;var geometry2;if(object.geometry instanceof THREE.BufferGeometry){geometry2=new THREE.Geometry;geometry2.fromBufferGeometry(object.geometry)}else{geometry2=object.geometry.clone()}geometry2.mergeVertices();geometry2.computeFaceNormals();var vertices=geometry2.vertices;var faces=geometry2.faces;var numEdges=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){hash[key]={vert1:edge[0],vert2:edge[1],face1:i,face2:undefined};numEdges++}else{hash[key].face2=i}}}var coords=new Float32Array(numEdges*2*3);var index=0;for(var key in hash){var h=hash[key];if(h.face2===undefined||faces[h.face1].normal.dot(faces[h.face2].normal)<=thresholdDot){var vertex=vertices[h.vert1];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z;vertex=vertices[h.vert2];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16776960;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=this.object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var vertices=this.geometry.vertices;var object=this.object;var objectVertices=object.geometry.vertices;var objectFaces=object.geometry.faces;var objectWorldMatrix=object.matrixWorld;object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(objectWorldMatrix);for(var i=0,i2=0,l=objectFaces.length;i<l;i++,i2+=2){var face=objectFaces[i];vertices[i2].copy(objectVertices[face.a]).add(objectVertices[face.b]).add(objectVertices[face.c]).divideScalar(3).applyMatrix4(objectWorldMatrix);vertices[i2+1].copy(face.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(vertices[i2])}this.geometry.verticesNeedUpdate=true;return this};THREE.GridHelper=function(size,step){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var i=-size;i<=size;i+=step){geometry.vertices.push(new THREE.Vector3((-size),0,i),new THREE.Vector3(size,0,i),new THREE.Vector3(i,0,(-size)),new THREE.Vector3(i,0,size));var color=i===0?this.color1:this.color2;geometry.colors.push(color,color,color,color)}THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(colorCenterLine,colorGrid){this.color1.set(colorCenterLine);this.color2.set(colorGrid);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(light,sphereSize){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var geometry=new THREE.SphereGeometry(sphereSize,4,2);geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var i=0,il=8;i<il;i++){geometry.faces[i].color=this.colors[i<4?0:1]}var material=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(geometry,material);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var vector=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(light,sphereSize){this.light=light;this.light.updateMatrixWorld();var geometry=new THREE.SphereGeometry(sphereSize,4,2);var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(object){this.bones=this.getBoneList(object);var geometry=new THREE.Geometry;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(0,0,1));geometry.colors.push(new THREE.Color(0,1,0))}}var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.Line.call(this,geometry,material,THREE.LinePieces);this.root=object;this.matrix=object.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(object){var boneList=[];if(object instanceof THREE.Bone){boneList.push(object)}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,this.getBoneList(object.children[i]))}return boneList};THREE.SkeletonHelper.prototype.update=function(){var geometry=this.geometry;var matrixWorldInv=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var boneMatrix=new THREE.Matrix4;var j=0;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);geometry.vertices[j].setFromMatrixPosition(boneMatrix);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);geometry.vertices[j+1].setFromMatrixPosition(boneMatrix);j+=2}}geometry.verticesNeedUpdate=true;geometry.computeBoundingSphere()};THREE.SpotLightHelper=function(light){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;var geometry=new THREE.CylinderGeometry(0,1,1,8,1,true);geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(geometry,material);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var vector=new THREE.Vector3;var vector2=new THREE.Vector3;return function(){var coneLength=this.light.distance?this.light.distance:1e4;var coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16711680;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var normal=face.vertexNormals[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.VertexTangentsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:255;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper;THREE.VertexTangentsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var tangent=face.vertexTangents[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.WireframeHelper=function(object,hex){var color=hex!==undefined?hex:16777215;var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;if(object.geometry instanceof THREE.Geometry){var vertices=object.geometry.vertices;var faces=object.geometry.faces;var numEdges=0;var edges=new Uint32Array(6*faces.length);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var vertex=vertices[edges[2*i+j]];var index=6*i+3*j;coords[index+0]=vertex.x;coords[index+1]=vertex.y;coords[index+2]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else if(object.geometry instanceof THREE.BufferGeometry){if(object.geometry.attributes.index!==undefined){var vertices=object.geometry.attributes.position.array;var indices=object.geometry.attributes.index.array;var drawcalls=object.geometry.drawcalls;var numEdges=0;if(drawcalls.length===0){drawcalls=[{count:indices.length,index:0,start:0}]}var edges=new Uint32Array(2*indices.length);for(var o=0,ol=drawcalls.length;o<ol;++o){var start=drawcalls[o].start;var count=drawcalls[o].count;var index=drawcalls[o].index;for(var i=start,il=start+count;i<il;i+=3){for(var j=0;j<3;j++){edge[0]=index+indices[i+j];edge[1]=index+indices[i+(j+1)%3];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var index=6*i+3*j;var index2=3*edges[2*i+j];coords[index+0]=vertices[index2];coords[index+1]=vertices[index2+1];coords[index+2]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else{var vertices=object.geometry.attributes.position.array;var numEdges=vertices.length/3;var numTris=numEdges/3;var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numTris;i<l;i++){for(var j=0;j<3;j++){var index=18*i+6*j;var index1=9*i+3*j;coords[index+0]=vertices[index1];coords[index+1]=vertices[index1+1];coords[index+2]=vertices[index1+2];var index2=9*i+3*((j+1)%3);coords[index+3]=vertices[index2];coords[index+4]=vertices[index2+1];coords[index+5]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(renderCallback){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(name,start,end,fps){var animation={startFrame:start,endFrame:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(fps){var pattern=/([a-z]+)_?(\d+)/;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];if(!frameRanges[name])frameRanges[name]={start:Infinity,end:-Infinity};var range=frameRanges[name];if(i<range.start)range.start=i;if(i>range.end)range.end=i;if(!firstAnimation)firstAnimation=name}}for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps)}this.firstAnimation=firstAnimation};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time}return time};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration}return duration};THREE.MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true}else{THREE.warn("THREE.MorphBlendMesh: animation["+name+"] undefined in .playAnimation()")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.active=false}};THREE.MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(!animation.active)continue;var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true}if(animation.time<0){animation.time=0;animation.directionBackwards=false}}}else{animation.time=animation.time%animation.duration;if(animation.time<0)animation.time+=animation.duration}var keyframe=animation.startFrame+THREE.Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this.morphTargetInfluences[animation.lastFrame]=0;this.morphTargetInfluences[animation.currentFrame]=1*weight;this.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe}var mix=animation.time%frameTime/frameTime;if(animation.directionBackwards)mix=1-mix;this.morphTargetInfluences[animation.currentFrame]=mix*weight;this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight}};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var canvas=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl")))}catch(e){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var element=document.createElement("div");element.id="webgl-error-message";element.style.fontFamily="monospace";element.style.fontSize="13px";element.style.fontWeight="normal";element.style.textAlign="center";element.style.background="#fff";element.style.color="#000";element.style.padding="1.5em";element.style.width="400px";element.style.margin="5em auto 0";if(!this.webgl){element.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return element},addGetWebGLMessage:function(parameters){var parent,id,element;parameters=parameters||{};parent=parameters.parent!==undefined?parameters.parent:document.body;id=parameters.id!==undefined?parameters.id:"oldie";element=Detector.getWebGLErrorMessage();element.id=id;parent.appendChild(element)}};if(typeof module==="object"){module.exports=Detector}var System={browser:function(){var a=navigator.userAgent;return/Arora/i.test(a)?"Arora":/Chrome/i.test(a)?"Chrome":/Epiphany/i.test(a)?"Epiphany":/Firefox/i.test(a)?"Firefox":/Mobile(\/.*)? Safari/i.test(a)?"Mobile Safari":/MSIE/i.test(a)?"Internet Explorer":/Midori/i.test(a)?"Midori":/Opera/.test(a)?"Opera":/Safari/i.test(a)?"Safari":!1}(),os:function(){var a=navigator.userAgent;return/Android/i.test(a)?"Android":/CrOS/i.test(a)?"Chrome OS":/iP[ao]d|iPhone/i.test(a)?"iOS":/Linux/i.test(a)?"Linux":/Mac OS/i.test(a)?"Mac OS":/windows/i.test(a)?"Windows":!1}(),support:{canvas:!!window.CanvasRenderingContext2D,localStorage:function(){try{return!!window.localStorage.getItem}catch(a){return!1}}(),file:!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,fileSystem:!!window.requestFileSystem||!!window.webkitRequestFileSystem,getUserMedia:!!window.navigator.getUserMedia||!!window.navigator.webkitGetUserMedia||!!window.navigator.mozGetUserMedia||!!window.navigator.msGetUserMedia,requestAnimationFrame:!!window.mozRequestAnimationFrame||!!window.webkitRequestAnimationFrame||!!window.oRequestAnimationFrame||!!window.msRequestAnimationFrame,sessionStorage:function(){try{return!!window.sessionStorage.getItem}catch(a){return!1}}(),webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),worker:!!window.Worker}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(vertex){this.positionWorld.copy(vertex.positionWorld);this.positionScreen.copy(vertex.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2;this.material=null};THREE.Projector=function(){var _object,_objectCount,_objectPool=[],_objectPoolLength=0,_vertex,_vertexCount,_vertexPool=[],_vertexPoolLength=0,_face,_faceCount,_facePool=[],_facePoolLength=0,_line,_lineCount,_linePool=[],_linePoolLength=0,_sprite,_spriteCount,_spritePool=[],_spritePoolLength=0,_renderData={objects:[],lights:[],elements:[]},_vector3=new THREE.Vector3,_vector4=new THREE.Vector4,_clipBox=new THREE.Box3(new THREE.Vector3((-1),(-1),(-1)),new THREE.Vector3(1,1,1)),_boundingBox=new THREE.Box3,_points3=new Array(3),_points4=new Array(4),_viewMatrix=new THREE.Matrix4,_viewProjectionMatrix=new THREE.Matrix4,_modelMatrix,_modelViewProjectionMatrix=new THREE.Matrix4,_normalMatrix=new THREE.Matrix3,_frustum=new THREE.Frustum,_clippedVertex1PositionScreen=new THREE.Vector4,_clippedVertex2PositionScreen=new THREE.Vector4;this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(vector,camera){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var RenderList=function(){var normals=[];var uvs=[];var object=null;var material=null;var normalMatrix=new THREE.Matrix3;var setObject=function(value){object=value;material=object.material;normalMatrix.getNormalMatrix(object.matrixWorld);normals.length=0;uvs.length=0};var projectVertex=function(vertex){var position=vertex.position;var positionWorld=vertex.positionWorld;var positionScreen=vertex.positionScreen;positionWorld.copy(position).applyMatrix4(_modelMatrix);positionScreen.copy(positionWorld).applyMatrix4(_viewProjectionMatrix);var invW=1/positionScreen.w;positionScreen.x*=invW;positionScreen.y*=invW;positionScreen.z*=invW;vertex.visible=positionScreen.x>=-1&&positionScreen.x<=1&&positionScreen.y>=-1&&positionScreen.y<=1&&positionScreen.z>=-1&&positionScreen.z<=1};var pushVertex=function(x,y,z){_vertex=getNextVertexInPool();_vertex.position.set(x,y,z);projectVertex(_vertex)};var pushNormal=function(x,y,z){normals.push(x,y,z)};var pushUv=function(x,y){uvs.push(x,y)};var checkTriangleVisibility=function(v1,v2,v3){if(v1.visible===true||v2.visible===true||v3.visible===true)return true;_points3[0]=v1.positionScreen;_points3[1]=v2.positionScreen;_points3[2]=v3.positionScreen;return _clipBox.isIntersectionBox(_boundingBox.setFromPoints(_points3))};var checkBackfaceCulling=function(v1,v2,v3){return(v3.positionScreen.x-v1.positionScreen.x)*(v2.positionScreen.y-v1.positionScreen.y)-(v3.positionScreen.y-v1.positionScreen.y)*(v2.positionScreen.x-v1.positionScreen.x)<0};var pushLine=function(a,b){var v1=_vertexPool[a];var v2=_vertexPool[b];_line=getNextLineInPool();_line.id=object.id;_line.v1.copy(v1);_line.v2.copy(v2);_line.z=(v1.positionScreen.z+v2.positionScreen.z)/2;_line.material=object.material;_renderData.elements.push(_line)};var pushTriangle=function(a,b,c){var v1=_vertexPool[a];var v2=_vertexPool[b];var v3=_vertexPool[c];if(checkTriangleVisibility(v1,v2,v3)===false)return;if(material.side===THREE.DoubleSide||checkBackfaceCulling(v1,v2,v3)===true){_face=getNextFaceInPool();_face.id=object.id;_face.v1.copy(v1);_face.v2.copy(v2);_face.v3.copy(v3);_face.z=(v1.positionScreen.z+v2.positionScreen.z+v3.positionScreen.z)/3;for(var i=0;i<3;i++){var offset=arguments[i]*3;var normal=_face.vertexNormalsModel[i];normal.set(normals[offset],normals[offset+1],normals[offset+2]);normal.applyMatrix3(normalMatrix).normalize();var offset2=arguments[i]*2;var uv=_face.uvs[i];uv.set(uvs[offset2],uvs[offset2+1])}_face.vertexNormalsLength=3;_face.material=object.material;_renderData.elements.push(_face)}};return{setObject:setObject,projectVertex:projectVertex,checkTriangleVisibility:checkTriangleVisibility,checkBackfaceCulling:checkBackfaceCulling,pushVertex:pushVertex,pushNormal:pushNormal,pushUv:pushUv,pushLine:pushLine,pushTriangle:pushTriangle}};var renderList=new RenderList;this.projectScene=function(scene,camera,sortObjects,sortElements){_faceCount=0;_lineCount=0;_spriteCount=0;_renderData.elements.length=0;if(scene.autoUpdate===true)scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();_viewMatrix.copy(camera.matrixWorldInverse.getInverse(camera.matrixWorld));_viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,_viewMatrix);_frustum.setFromMatrix(_viewProjectionMatrix);_objectCount=0;_renderData.objects.length=0;_renderData.lights.length=0;scene.traverseVisible(function(object){if(object instanceof THREE.Light){_renderData.lights.push(object)}else if(object instanceof THREE.Mesh||object instanceof THREE.Line||object instanceof THREE.Sprite){if(object.material.visible===false)return;if(object.frustumCulled===false||_frustum.intersectsObject(object)===true){_object=getNextObjectInPool();_object.id=object.id;_object.object=object;_vector3.setFromMatrixPosition(object.matrixWorld);_vector3.applyProjection(_viewProjectionMatrix);_object.z=_vector3.z;_renderData.objects.push(_object)}}});if(sortObjects===true){_renderData.objects.sort(painterSort)}for(var o=0,ol=_renderData.objects.length;o<ol;o++){var object=_renderData.objects[o].object;var geometry=object.geometry;renderList.setObject(object);_modelMatrix=object.matrixWorld;_vertexCount=0;if(object instanceof THREE.Mesh){if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;var offsets=geometry.offsets;if(attributes.position===undefined)continue;var positions=attributes.position.array;for(var i=0,l=positions.length;i<l;i+=3){renderList.pushVertex(positions[i],positions[i+1],positions[i+2])}if(attributes.normal!==undefined){var normals=attributes.normal.array;for(var i=0,l=normals.length;i<l;i+=3){renderList.pushNormal(normals[i],normals[i+1],normals[i+2])}}if(attributes.uv!==undefined){var uvs=attributes.uv.array;for(var i=0,l=uvs.length;i<l;i+=2){renderList.pushUv(uvs[i],uvs[i+1])}}if(attributes.index!==undefined){var indices=attributes.index.array;if(offsets.length>0){for(var o=0;o<offsets.length;o++){var offset=offsets[o];var index=offset.index;for(var i=offset.start,l=offset.start+offset.count;i<l;i+=3){renderList.pushTriangle(indices[i]+index,indices[i+1]+index,indices[i+2]+index)}}}else{for(var i=0,l=indices.length;i<l;i+=3){renderList.pushTriangle(indices[i],indices[i+1],indices[i+2])}}}else{for(var i=0,l=positions.length/3;i<l;i+=3){renderList.pushTriangle(i,i+1,i+2)}}}else if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var faces=geometry.faces;var faceVertexUvs=geometry.faceVertexUvs[0];_normalMatrix.getNormalMatrix(_modelMatrix);var material=object.material;var isFaceMaterial=material instanceof THREE.MeshFaceMaterial;var objectMaterials=isFaceMaterial===true?object.material:null;for(var v=0,vl=vertices.length;v<vl;v++){var vertex=vertices[v];_vector3.copy(vertex);if(material.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=object.morphTargetInfluences;for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0)continue;var target=morphTargets[t];var targetVertex=target.vertices[v];_vector3.x+=(targetVertex.x-vertex.x)*influence;_vector3.y+=(targetVertex.y-vertex.y)*influence;_vector3.z+=(targetVertex.z-vertex.z)*influence}}renderList.pushVertex(_vector3.x,_vector3.y,_vector3.z)}for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f];var material=isFaceMaterial===true?objectMaterials.materials[face.materialIndex]:object.material;if(material===undefined)continue;var side=material.side;var v1=_vertexPool[face.a];var v2=_vertexPool[face.b];var v3=_vertexPool[face.c];if(renderList.checkTriangleVisibility(v1,v2,v3)===false)continue;var visible=renderList.checkBackfaceCulling(v1,v2,v3);if(side!==THREE.DoubleSide){if(side===THREE.FrontSide&&visible===false)continue;if(side===THREE.BackSide&&visible===true)continue}_face=getNextFaceInPool();_face.id=object.id;_face.v1.copy(v1);_face.v2.copy(v2);_face.v3.copy(v3);_face.normalModel.copy(face.normal);if(visible===false&&(side===THREE.BackSide||side===THREE.DoubleSide)){_face.normalModel.negate()}_face.normalModel.applyMatrix3(_normalMatrix).normalize();var faceVertexNormals=face.vertexNormals;for(var n=0,nl=Math.min(faceVertexNormals.length,3);n<nl;n++){var normalModel=_face.vertexNormalsModel[n];normalModel.copy(faceVertexNormals[n]);if(visible===false&&(side===THREE.BackSide||side===THREE.DoubleSide)){normalModel.negate()}normalModel.applyMatrix3(_normalMatrix).normalize()}_face.vertexNormalsLength=faceVertexNormals.length;var vertexUvs=faceVertexUvs[f];if(vertexUvs!==undefined){for(var u=0;u<3;u++){_face.uvs[u].copy(vertexUvs[u])}}_face.color=face.color;_face.material=material;_face.z=(v1.positionScreen.z+v2.positionScreen.z+v3.positionScreen.z)/3;_renderData.elements.push(_face)}}}else if(object instanceof THREE.Line){if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;if(attributes.position!==undefined){var positions=attributes.position.array;for(var i=0,l=positions.length;i<l;i+=3){renderList.pushVertex(positions[i],positions[i+1],positions[i+2])}if(attributes.index!==undefined){var indices=attributes.index.array;for(var i=0,l=indices.length;i<l;i+=2){renderList.pushLine(indices[i],indices[i+1])}}else{var step=object.mode===THREE.LinePieces?2:1;for(var i=0,l=positions.length/3-1;i<l;i+=step){renderList.pushLine(i,i+1)}}}}else if(geometry instanceof THREE.Geometry){_modelViewProjectionMatrix.multiplyMatrices(_viewProjectionMatrix,_modelMatrix);var vertices=object.geometry.vertices;if(vertices.length===0)continue;v1=getNextVertexInPool();v1.positionScreen.copy(vertices[0]).applyMatrix4(_modelViewProjectionMatrix);var step=object.mode===THREE.LinePieces?2:1;for(var v=1,vl=vertices.length;v<vl;v++){v1=getNextVertexInPool();v1.positionScreen.copy(vertices[v]).applyMatrix4(_modelViewProjectionMatrix);if((v+1)%step>0)continue;v2=_vertexPool[_vertexCount-2];_clippedVertex1PositionScreen.copy(v1.positionScreen);_clippedVertex2PositionScreen.copy(v2.positionScreen);if(clipLine(_clippedVertex1PositionScreen,_clippedVertex2PositionScreen)===true){_clippedVertex1PositionScreen.multiplyScalar(1/_clippedVertex1PositionScreen.w);_clippedVertex2PositionScreen.multiplyScalar(1/_clippedVertex2PositionScreen.w);_line=getNextLineInPool();_line.id=object.id;_line.v1.positionScreen.copy(_clippedVertex1PositionScreen);_line.v2.positionScreen.copy(_clippedVertex2PositionScreen);_line.z=Math.max(_clippedVertex1PositionScreen.z,_clippedVertex2PositionScreen.z);_line.material=object.material;if(object.material.vertexColors===THREE.VertexColors){_line.vertexColors[0].copy(object.geometry.colors[v]);_line.vertexColors[1].copy(object.geometry.colors[v-1])}_renderData.elements.push(_line)}}}}else if(object instanceof THREE.Sprite){_vector4.set(_modelMatrix.elements[12],_modelMatrix.elements[13],_modelMatrix.elements[14],1);_vector4.applyMatrix4(_viewProjectionMatrix);var invW=1/_vector4.w;_vector4.z*=invW;if(_vector4.z>=-1&&_vector4.z<=1){_sprite=getNextSpriteInPool();_sprite.id=object.id;_sprite.x=_vector4.x*invW;_sprite.y=_vector4.y*invW;_sprite.z=_vector4.z;_sprite.object=object;_sprite.rotation=object.rotation;_sprite.scale.x=object.scale.x*Math.abs(_sprite.x-(_vector4.x+camera.projectionMatrix.elements[0])/(_vector4.w+camera.projectionMatrix.elements[12]));_sprite.scale.y=object.scale.y*Math.abs(_sprite.y-(_vector4.y+camera.projectionMatrix.elements[5])/(_vector4.w+camera.projectionMatrix.elements[13]));_sprite.material=object.material;_renderData.elements.push(_sprite)}}}if(sortElements===true){_renderData.elements.sort(painterSort)}return _renderData};function getNextObjectInPool(){if(_objectCount===_objectPoolLength){var object=new THREE.RenderableObject;_objectPool.push(object);_objectPoolLength++;_objectCount++;return object}return _objectPool[_objectCount++]}function getNextVertexInPool(){if(_vertexCount===_vertexPoolLength){var vertex=new THREE.RenderableVertex;_vertexPool.push(vertex);_vertexPoolLength++;_vertexCount++;return vertex}return _vertexPool[_vertexCount++]}function getNextFaceInPool(){if(_faceCount===_facePoolLength){var face=new THREE.RenderableFace;_facePool.push(face);_facePoolLength++;_faceCount++;return face}return _facePool[_faceCount++]}function getNextLineInPool(){if(_lineCount===_linePoolLength){var line=new THREE.RenderableLine;_linePool.push(line);_linePoolLength++;_lineCount++;return line}return _linePool[_lineCount++]}function getNextSpriteInPool(){if(_spriteCount===_spritePoolLength){var sprite=new THREE.RenderableSprite;_spritePool.push(sprite);_spritePoolLength++;_spriteCount++;return sprite}return _spritePool[_spriteCount++]}function painterSort(a,b){if(a.z!==b.z){return b.z-a.z}else if(a.id!==b.id){return a.id-b.id}else{return 0}}function clipLine(s1,s2){var alpha1=0,alpha2=1,bc1near=s1.z+s1.w,bc2near=s2.z+s2.w,bc1far=-s1.z+s1.w,bc2far=-s2.z+s2.w;if(bc1near>=0&&bc2near>=0&&bc1far>=0&&bc2far>=0){return true}else if(bc1near<0&&bc2near<0||bc1far<0&&bc2far<0){return false}else{if(bc1near<0){alpha1=Math.max(alpha1,bc1near/(bc1near-bc2near))}else if(bc2near<0){alpha2=Math.min(alpha2,bc1near/(bc1near-bc2near))}if(bc1far<0){alpha1=Math.max(alpha1,bc1far/(bc1far-bc2far))}else if(bc2far<0){alpha2=Math.min(alpha2,bc1far/(bc1far-bc2far))}if(alpha2<alpha1){return false}else{s1.lerp(s2,alpha1);s2.lerp(s1,1-alpha2);return true}}}};THREE.CombinedCamera=function(width,height,fov,near,far,orthoNear,orthoFar){THREE.Camera.call(this);this.fov=fov;this.left=-width/2;this.right=width/2;this.top=height/2;this.bottom=-height/2;this.cameraO=new THREE.OrthographicCamera(width/-2,width/2,height/2,height/-2,orthoNear,orthoFar);this.cameraP=new THREE.PerspectiveCamera(fov,width/height,near,far);this.zoom=1;this.toPerspective();var aspect=width/height};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera;THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var fov=this.fov;var aspect=this.cameraP.aspect;var near=this.cameraP.near;var far=this.cameraP.far;var hyperfocus=(near+far)/2;var halfHeight=Math.tan(fov*Math.PI/180/2)*hyperfocus;var planeHeight=2*halfHeight;var planeWidth=planeHeight*aspect;var halfWidth=planeWidth/2;halfHeight/=this.zoom;halfWidth/=this.zoom;this.cameraO.left=-halfWidth;this.cameraO.right=halfWidth;this.cameraO.top=halfHeight;this.cameraO.bottom=-halfHeight;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(width,height){this.cameraP.aspect=width/height;this.left=-width/2;this.right=width/2;this.top=height/2;this.bottom=-height/2};THREE.CombinedCamera.prototype.setFov=function(fov){this.fov=fov;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;var fov=2*THREE.Math.radToDeg(Math.atan(frameHeight/(focalLength*2)));this.setFov(fov);return fov};THREE.CombinedCamera.prototype.setZoom=function(zoom){this.zoom=zoom;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){
this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.OrbitControls=function(object,domElement){this.object=object;this.domElement=domElement!==undefined?domElement:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var scope=this;var EPS=1e-6;var rotateStart=new THREE.Vector2;var rotateEnd=new THREE.Vector2;var rotateDelta=new THREE.Vector2;var panStart=new THREE.Vector2;var panEnd=new THREE.Vector2;var panDelta=new THREE.Vector2;var panOffset=new THREE.Vector3;var offset=new THREE.Vector3;var dollyStart=new THREE.Vector2;var dollyEnd=new THREE.Vector2;var dollyDelta=new THREE.Vector2;var theta;var phi;var phiDelta=0;var thetaDelta=0;var scale=1;var pan=new THREE.Vector3;var lastPosition=new THREE.Vector3;var lastQuaternion=new THREE.Quaternion;var STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var state=STATE.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;var quat=(new THREE.Quaternion).setFromUnitVectors(object.up,new THREE.Vector3(0,1,0));var quatInverse=quat.clone().inverse();var changeEvent={type:"change"};var startEvent={type:"start"};var endEvent={type:"end"};this.rotateLeft=function(angle){if(angle===undefined){angle=getAutoRotationAngle()}thetaDelta-=angle};this.rotateUp=function(angle){if(angle===undefined){angle=getAutoRotationAngle()}phiDelta-=angle};this.panLeft=function(distance){var te=this.object.matrix.elements;panOffset.set(te[0],te[1],te[2]);panOffset.multiplyScalar(-distance);pan.add(panOffset)};this.panUp=function(distance){var te=this.object.matrix.elements;panOffset.set(te[4],te[5],te[6]);panOffset.multiplyScalar(distance);pan.add(panOffset)};this.pan=function(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object instanceof THREE.PerspectiveCamera){var position=scope.object.position;var offset=position.clone().sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180);scope.panLeft(2*deltaX*targetDistance/element.clientHeight);scope.panUp(2*deltaY*targetDistance/element.clientHeight)}else if(scope.object instanceof THREE.OrthographicCamera){scope.panLeft(deltaX*(scope.object.right-scope.object.left)/element.clientWidth);scope.panUp(deltaY*(scope.object.top-scope.object.bottom)/element.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(dollyScale){if(dollyScale===undefined){dollyScale=getZoomScale()}if(scope.object instanceof THREE.PerspectiveCamera||scope.object instanceof THREE.CombinedCamera){scale/=dollyScale}else if(scope.object instanceof THREE.OrthographicCamera){scope.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*dollyScale));scope.object.updateProjectionMatrix();scope.dispatchEvent(changeEvent)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")}};this.dollyOut=function(dollyScale){if(dollyScale===undefined){dollyScale=getZoomScale()}if(scope.object instanceof THREE.PerspectiveCamera||scope.object instanceof THREE.CombinedCamera){scale*=dollyScale}else if(scope.object instanceof THREE.OrthographicCamera){scope.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/dollyScale));scope.object.updateProjectionMatrix();scope.dispatchEvent(changeEvent)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")}};this.update=function(){var position=this.object.position;offset.copy(position).sub(this.target);offset.applyQuaternion(quat);theta=Math.atan2(offset.x,offset.z);phi=Math.atan2(Math.sqrt(offset.x*offset.x+offset.z*offset.z),offset.y);if(this.autoRotate&&state===STATE.NONE){this.rotateLeft(getAutoRotationAngle())}theta+=thetaDelta;phi+=phiDelta;theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,theta));phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,phi));phi=Math.max(EPS,Math.min(Math.PI-EPS,phi));var radius=offset.length()*scale;radius=Math.max(this.minDistance,Math.min(this.maxDistance,radius));this.target.add(pan);offset.x=radius*Math.sin(phi)*Math.sin(theta);offset.y=radius*Math.cos(phi);offset.z=radius*Math.sin(phi)*Math.cos(theta);offset.applyQuaternion(quatInverse);position.copy(this.target).add(offset);this.object.lookAt(this.target);thetaDelta=0;phiDelta=0;scale=1;pan.set(0,0,0);if(lastPosition.distanceToSquared(this.object.position)>EPS||8*(1-lastQuaternion.dot(this.object.quaternion))>EPS){this.dispatchEvent(changeEvent);lastPosition.copy(this.object.position);lastQuaternion.copy(this.object.quaternion)}};this.reset=function(){state=STATE.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(changeEvent);this.update()};this.getPolarAngle=function(){return phi};this.getAzimuthalAngle=function(){return theta};function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed}function getZoomScale(){return Math.pow(.95,scope.zoomSpeed)}function onMouseDown(event){if(scope.enabled===false)return;event.preventDefault();if(event.button===scope.mouseButtons.ORBIT){if(scope.noRotate===true)return;state=STATE.ROTATE;rotateStart.set(event.clientX,event.clientY)}else if(event.button===scope.mouseButtons.ZOOM){if(scope.noZoom===true)return;state=STATE.DOLLY;dollyStart.set(event.clientX,event.clientY)}else if(event.button===scope.mouseButtons.PAN){if(scope.noPan===true)return;state=STATE.PAN;panStart.set(event.clientX,event.clientY)}if(state!==STATE.NONE){document.addEventListener("mousemove",onMouseMove,false);document.addEventListener("mouseup",onMouseUp,false);scope.dispatchEvent(startEvent)}}function onMouseMove(event){if(scope.enabled===false)return;event.preventDefault();var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(state===STATE.ROTATE){if(scope.noRotate===true)return;rotateEnd.set(event.clientX,event.clientY);rotateDelta.subVectors(rotateEnd,rotateStart);scope.rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);scope.rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd)}else if(state===STATE.DOLLY){if(scope.noZoom===true)return;dollyEnd.set(event.clientX,event.clientY);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){scope.dollyIn()}else if(dollyDelta.y<0){scope.dollyOut()}dollyStart.copy(dollyEnd)}else if(state===STATE.PAN){if(scope.noPan===true)return;panEnd.set(event.clientX,event.clientY);panDelta.subVectors(panEnd,panStart);scope.pan(panDelta.x,panDelta.y);panStart.copy(panEnd)}if(state!==STATE.NONE)scope.update()}function onMouseUp(){if(scope.enabled===false)return;document.removeEventListener("mousemove",onMouseMove,false);document.removeEventListener("mouseup",onMouseUp,false);scope.dispatchEvent(endEvent);state=STATE.NONE}function onMouseWheel(event){if(scope.enabled===false||scope.noZoom===true||state!==STATE.NONE)return;event.preventDefault();event.stopPropagation();var delta=0;if(event.wheelDelta!==undefined){delta=event.wheelDelta}else if(event.detail!==undefined){delta=-event.detail}if(delta>0){scope.dollyOut()}else if(delta<0){scope.dollyIn()}scope.update();scope.dispatchEvent(startEvent);scope.dispatchEvent(endEvent)}function onKeyDown(event){if(scope.enabled===false||scope.noKeys===true||scope.noPan===true)return;switch(event.keyCode){case scope.keys.UP:scope.pan(0,scope.keyPanSpeed);scope.update();break;case scope.keys.BOTTOM:scope.pan(0,-scope.keyPanSpeed);scope.update();break;case scope.keys.LEFT:scope.pan(scope.keyPanSpeed,0);scope.update();break;case scope.keys.RIGHT:scope.pan(-scope.keyPanSpeed,0);scope.update();break}}function touchstart(event){if(scope.enabled===false)return;switch(event.touches.length){case 1:if(scope.noRotate===true)return;state=STATE.TOUCH_ROTATE;rotateStart.set(event.touches[0].pageX,event.touches[0].pageY);break;case 2:if(scope.noZoom===true)return;state=STATE.TOUCH_DOLLY;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance);break;case 3:if(scope.noPan===true)return;state=STATE.TOUCH_PAN;panStart.set(event.touches[0].pageX,event.touches[0].pageY);break;default:state=STATE.NONE}if(state!==STATE.NONE)scope.dispatchEvent(startEvent)}function touchmove(event){if(scope.enabled===false)return;event.preventDefault();event.stopPropagation();var element=scope.domElement===document?scope.domElement.body:scope.domElement;switch(event.touches.length){case 1:if(scope.noRotate===true)return;if(state!==STATE.TOUCH_ROTATE)return;rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY);rotateDelta.subVectors(rotateEnd,rotateStart);scope.rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);scope.rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd);scope.update();break;case 2:if(scope.noZoom===true)return;if(state!==STATE.TOUCH_DOLLY)return;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){scope.dollyOut()}else if(dollyDelta.y<0){scope.dollyIn()}dollyStart.copy(dollyEnd);scope.update();break;case 3:if(scope.noPan===true)return;if(state!==STATE.TOUCH_PAN)return;panEnd.set(event.touches[0].pageX,event.touches[0].pageY);panDelta.subVectors(panEnd,panStart);scope.pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();break;default:state=STATE.NONE}}function touchend(){if(scope.enabled===false)return;scope.dispatchEvent(endEvent);state=STATE.NONE}this.domElement.addEventListener("contextmenu",function(event){event.preventDefault()},false);this.domElement.addEventListener("mousedown",onMouseDown,false);this.domElement.addEventListener("mousewheel",onMouseWheel,false);this.domElement.addEventListener("DOMMouseScroll",onMouseWheel,false);this.domElement.addEventListener("touchstart",touchstart,false);this.domElement.addEventListener("touchend",touchend,false);this.domElement.addEventListener("touchmove",touchmove,false);window.addEventListener("keydown",onKeyDown,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;(function(){var GizmoMaterial=function(parameters){THREE.MeshBasicMaterial.call(this);this.depthTest=false;this.depthWrite=false;this.side=THREE.FrontSide;this.transparent=true;this.setValues(parameters);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(highlighted){if(highlighted){this.color.setRGB(1,1,0);this.opacity=1}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity}}};GizmoMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);GizmoMaterial.prototype.constructor=GizmoMaterial;var GizmoLineMaterial=function(parameters){THREE.LineBasicMaterial.call(this);this.depthTest=false;this.depthWrite=false;this.transparent=true;this.linewidth=1;this.setValues(parameters);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(highlighted){if(highlighted){this.color.setRGB(1,1,0);this.opacity=1}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity}}};GizmoLineMaterial.prototype=Object.create(THREE.LineBasicMaterial.prototype);GizmoLineMaterial.prototype.constructor=GizmoLineMaterial;THREE.TransformGizmo=function(){var scope=this;var showPickers=false;var showActivePlane=false;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var planeGeometry=new THREE.PlaneBufferGeometry(50,50,2,2);var planeMaterial=new THREE.MeshBasicMaterial({wireframe:true});planeMaterial.side=THREE.DoubleSide;var planes={XY:new THREE.Mesh(planeGeometry,planeMaterial),YZ:new THREE.Mesh(planeGeometry,planeMaterial),XZ:new THREE.Mesh(planeGeometry,planeMaterial),XYZE:new THREE.Mesh(planeGeometry,planeMaterial)};this.activePlane=planes["XYZE"];planes["YZ"].rotation.set(0,Math.PI/2,0);planes["XZ"].rotation.set(-Math.PI/2,0,0);for(var i in planes){planes[i].name=i;this.planes.add(planes[i]);this.planes[i]=planes[i];planes[i].visible=false}var setupGizmos=function(gizmoMap,parent){for(var name in gizmoMap){for(i=gizmoMap[name].length;i--;){var object=gizmoMap[name][i][0];var position=gizmoMap[name][i][1];var rotation=gizmoMap[name][i][2];object.name=name;if(position)object.position.set(position[0],position[1],position[2]);if(rotation)object.rotation.set(rotation[0],rotation[1],rotation[2]);parent.add(object)}}};setupGizmos(this.handleGizmos,this.handles);setupGizmos(this.pickerGizmos,this.pickers);this.traverse(function(child){if(child instanceof THREE.Mesh){child.updateMatrix();var tempGeometry=child.geometry.clone();tempGeometry.applyMatrix(child.matrix);child.geometry=tempGeometry;child.position.set(0,0,0);child.rotation.set(0,0,0);child.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(child){child.visible=false})};this.show=function(){this.traverse(function(child){child.visible=true;if(child.parent==scope.pickers)child.visible=showPickers;if(child.parent==scope.planes)child.visible=false});this.activePlane.visible=showActivePlane};this.highlight=function(axis){this.traverse(function(child){if(child.material&&child.material.highlight){if(child.name==axis){child.material.highlight(true)}else{child.material.highlight(false)}}})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(rotation,eye){var vec1=new THREE.Vector3(0,0,0);var vec2=new THREE.Vector3(0,1,0);var lookAtMatrix=new THREE.Matrix4;this.traverse(function(child){if(child.name.search("E")!=-1){child.quaternion.setFromRotationMatrix(lookAtMatrix.lookAt(eye,vec1,vec2))}else if(child.name.search("X")!=-1||child.name.search("Y")!=-1||child.name.search("Z")!=-1){child.quaternion.setFromEuler(rotation)}})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var arrowGeometry=new THREE.Geometry;var mesh=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,false));mesh.position.y=.5;mesh.updateMatrix();arrowGeometry.merge(mesh.geometry,mesh.matrix);var lineXGeometry=new THREE.Geometry;lineXGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var lineYGeometry=new THREE.Geometry;lineYGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var lineZGeometry=new THREE.Geometry;lineZGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(lineXGeometry,new GizmoLineMaterial({color:16711680}))]],Y:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:65280})),[0,.5,0]],[new THREE.Line(lineYGeometry,new GizmoLineMaterial({color:65280}))]],Z:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(lineZGeometry,new GizmoLineMaterial({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new GizmoMaterial({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new GizmoMaterial({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new GizmoMaterial({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new GizmoMaterial({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new GizmoMaterial({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new GizmoMaterial({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new GizmoMaterial({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new GizmoMaterial({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(axis,eye){var tempMatrix=new THREE.Matrix4;eye.applyMatrix4(tempMatrix.getInverse(tempMatrix.extractRotation(this.planes["XY"].matrixWorld)));if(axis=="X"){this.activePlane=this.planes["XY"];if(Math.abs(eye.y)>Math.abs(eye.z))this.activePlane=this.planes["XZ"]}if(axis=="Y"){this.activePlane=this.planes["XY"];if(Math.abs(eye.x)>Math.abs(eye.z))this.activePlane=this.planes["YZ"]}if(axis=="Z"){this.activePlane=this.planes["XZ"];if(Math.abs(eye.x)>Math.abs(eye.y))this.activePlane=this.planes["YZ"]}if(axis=="XYZ")this.activePlane=this.planes["XYZE"];if(axis=="XY")this.activePlane=this.planes["XY"];if(axis=="YZ")this.activePlane=this.planes["YZ"];if(axis=="XZ")this.activePlane=this.planes["XZ"];this.hide();this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var CircleGeometry=function(radius,facing,arc){var geometry=new THREE.Geometry;arc=arc?arc:1;for(var i=0;i<=64*arc;++i){if(facing=="x")geometry.vertices.push(new THREE.Vector3(0,Math.cos(i/32*Math.PI),Math.sin(i/32*Math.PI)).multiplyScalar(radius));if(facing=="y")geometry.vertices.push(new THREE.Vector3(Math.cos(i/32*Math.PI),0,Math.sin(i/32*Math.PI)).multiplyScalar(radius));if(facing=="z")geometry.vertices.push(new THREE.Vector3(Math.sin(i/32*Math.PI),Math.cos(i/32*Math.PI),0).multiplyScalar(radius))}return geometry};this.handleGizmos={X:[[new THREE.Line(new CircleGeometry(1,"x",.5),new GizmoLineMaterial({color:16711680}))]],Y:[[new THREE.Line(new CircleGeometry(1,"y",.5),new GizmoLineMaterial({color:65280}))]],Z:[[new THREE.Line(new CircleGeometry(1,"z",.5),new GizmoLineMaterial({color:255}))]],E:[[new THREE.Line(new CircleGeometry(1.25,"z",1),new GizmoLineMaterial({color:13421568}))]],XYZE:[[new THREE.Line(new CircleGeometry(1,"z",1),new GizmoLineMaterial({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new GizmoMaterial({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new GizmoMaterial({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new GizmoMaterial({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new GizmoMaterial({color:16776960,opacity:.25}))]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(axis){if(axis=="E")this.activePlane=this.planes["XYZE"];if(axis=="X")this.activePlane=this.planes["YZ"];if(axis=="Y")this.activePlane=this.planes["XZ"];if(axis=="Z")this.activePlane=this.planes["XY"];this.hide();this.show()};this.update=function(rotation,eye2){THREE.TransformGizmo.prototype.update.apply(this,arguments);var group={handles:this["handles"],pickers:this["pickers"]};var tempMatrix=new THREE.Matrix4;var worldRotation=new THREE.Euler(0,0,1);var tempQuaternion=new THREE.Quaternion;var unitX=new THREE.Vector3(1,0,0);var unitY=new THREE.Vector3(0,1,0);var unitZ=new THREE.Vector3(0,0,1);var quaternionX=new THREE.Quaternion;var quaternionY=new THREE.Quaternion;var quaternionZ=new THREE.Quaternion;var eye=eye2.clone();worldRotation.copy(this.planes["XY"].rotation);tempQuaternion.setFromEuler(worldRotation);tempMatrix.makeRotationFromQuaternion(tempQuaternion).getInverse(tempMatrix);eye.applyMatrix4(tempMatrix);this.traverse(function(child){tempQuaternion.setFromEuler(worldRotation);if(child.name=="X"){quaternionX.setFromAxisAngle(unitX,Math.atan2(-eye.y,eye.z));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);child.quaternion.copy(tempQuaternion)}if(child.name=="Y"){quaternionY.setFromAxisAngle(unitY,Math.atan2(eye.x,eye.z));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionY);child.quaternion.copy(tempQuaternion)}if(child.name=="Z"){quaternionZ.setFromAxisAngle(unitZ,Math.atan2(eye.y,eye.x));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionZ);child.quaternion.copy(tempQuaternion)}})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var arrowGeometry=new THREE.Geometry;var mesh=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));mesh.position.y=.5;mesh.updateMatrix();arrowGeometry.merge(mesh.geometry,mesh.matrix);var lineXGeometry=new THREE.Geometry;lineXGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var lineYGeometry=new THREE.Geometry;lineYGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var lineZGeometry=new THREE.Geometry;lineZGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(lineXGeometry,new GizmoLineMaterial({color:16711680}))]],Y:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:65280})),[0,.5,0]],[new THREE.Line(lineYGeometry,new GizmoLineMaterial({color:65280}))]],Z:[[new THREE.Mesh(arrowGeometry,new GizmoMaterial({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(lineZGeometry,new GizmoLineMaterial({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new GizmoMaterial({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,false),new GizmoMaterial({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new GizmoMaterial({color:16777215,opacity:.25}))]]};this.setActivePlane=function(axis,eye){var tempMatrix=new THREE.Matrix4;eye.applyMatrix4(tempMatrix.getInverse(tempMatrix.extractRotation(this.planes["XY"].matrixWorld)));if(axis=="X"){this.activePlane=this.planes["XY"];if(Math.abs(eye.y)>Math.abs(eye.z))this.activePlane=this.planes["XZ"]}if(axis=="Y"){this.activePlane=this.planes["XY"];if(Math.abs(eye.x)>Math.abs(eye.z))this.activePlane=this.planes["YZ"]}if(axis=="Z"){this.activePlane=this.planes["XZ"];if(Math.abs(eye.x)>Math.abs(eye.y))this.activePlane=this.planes["YZ"]}if(axis=="XYZ")this.activePlane=this.planes["XYZE"];this.hide();this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(camera,domElement){THREE.Object3D.call(this);domElement=domElement!==undefined?domElement:document;this.gizmo={};this.gizmo["translate"]=new THREE.TransformGizmoTranslate;this.gizmo["rotate"]=new THREE.TransformGizmoRotate;this.gizmo["scale"]=new THREE.TransformGizmoScale;this.add(this.gizmo["translate"]);this.add(this.gizmo["rotate"]);this.add(this.gizmo["scale"]);this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.object=undefined;this.snap=null;this.space="world";this.size=1;this.axis=null;var scope=this;var _dragging=false;var _mode="translate";var _plane="XY";var changeEvent={type:"change"};var mouseDownEvent={type:"mouseDown"};var mouseUpEvent={type:"mouseUp",mode:_mode};var objectChangeEvent={type:"objectChange"};var ray=new THREE.Raycaster;var pointerVector=new THREE.Vector3;var point=new THREE.Vector3;var offset=new THREE.Vector3;var rotation=new THREE.Vector3;var offsetRotation=new THREE.Vector3;var scale=1;var lookAtMatrix=new THREE.Matrix4;var eye=new THREE.Vector3;var tempMatrix=new THREE.Matrix4;var tempVector=new THREE.Vector3;var tempQuaternion=new THREE.Quaternion;var unitX=new THREE.Vector3(1,0,0);var unitY=new THREE.Vector3(0,1,0);var unitZ=new THREE.Vector3(0,0,1);var quaternionXYZ=new THREE.Quaternion;var quaternionX=new THREE.Quaternion;var quaternionY=new THREE.Quaternion;var quaternionZ=new THREE.Quaternion;var quaternionE=new THREE.Quaternion;var oldPosition=new THREE.Vector3;var oldScale=new THREE.Vector3;var oldRotationMatrix=new THREE.Matrix4;var parentRotationMatrix=new THREE.Matrix4;var parentScale=new THREE.Vector3;var worldPosition=new THREE.Vector3;var worldRotation=new THREE.Euler;var worldRotationMatrix=new THREE.Matrix4;var camPosition=new THREE.Vector3;var camRotation=new THREE.Euler;domElement.addEventListener("mousedown",onPointerDown,false);domElement.addEventListener("touchstart",onPointerDown,false);domElement.addEventListener("mousemove",onPointerHover,false);domElement.addEventListener("touchmove",onPointerHover,false);domElement.addEventListener("mousemove",onPointerMove,false);domElement.addEventListener("touchmove",onPointerMove,false);domElement.addEventListener("mouseup",onPointerUp,false);domElement.addEventListener("mouseout",onPointerUp,false);domElement.addEventListener("touchend",onPointerUp,false);domElement.addEventListener("touchcancel",onPointerUp,false);domElement.addEventListener("touchleave",onPointerUp,false);this.attach=function(object){scope.object=object;this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.gizmo[_mode].show();scope.update()};this.detach=function(object){scope.object=undefined;this.axis=null;this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide()};this.setMode=function(mode){_mode=mode?mode:_mode;if(_mode=="scale")scope.space="local";this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.gizmo[_mode].show();this.update();scope.dispatchEvent(changeEvent)};this.setSnap=function(snap){scope.snap=snap};this.setSize=function(size){scope.size=size;this.update();scope.dispatchEvent(changeEvent)};this.setSpace=function(space){scope.space=space;this.update();scope.dispatchEvent(changeEvent)};this.update=function(){if(scope.object===undefined)return;scope.object.updateMatrixWorld();worldPosition.setFromMatrixPosition(scope.object.matrixWorld);worldRotation.setFromRotationMatrix(tempMatrix.extractRotation(scope.object.matrixWorld));camera.updateMatrixWorld();camPosition.setFromMatrixPosition(camera.matrixWorld);camRotation.setFromRotationMatrix(tempMatrix.extractRotation(camera.matrixWorld));scale=worldPosition.distanceTo(camPosition)/6*scope.size;this.position.copy(worldPosition);this.scale.set(scale,scale,scale);eye.copy(camPosition).sub(worldPosition).normalize();if(scope.space=="local")this.gizmo[_mode].update(worldRotation,eye);else if(scope.space=="world")this.gizmo[_mode].update(new THREE.Euler,eye);this.gizmo[_mode].highlight(scope.axis)};function onPointerHover(event){if(scope.object===undefined||_dragging===true)return;event.preventDefault();var pointer=event.changedTouches?event.changedTouches[0]:event;var intersect=intersectObjects(pointer,scope.gizmo[_mode].pickers.children);var axis=null;if(intersect){axis=intersect.object.name}if(scope.axis!==axis){scope.axis=axis;scope.update();scope.dispatchEvent(changeEvent)}}function onPointerDown(event){if(scope.object===undefined||_dragging===true)return;event.preventDefault();event.stopPropagation();var pointer=event.changedTouches?event.changedTouches[0]:event;if(pointer.button===0||pointer.button===undefined){var intersect=intersectObjects(pointer,scope.gizmo[_mode].pickers.children);if(intersect){scope.dispatchEvent(mouseDownEvent);scope.axis=intersect.object.name;scope.update();eye.copy(camPosition).sub(worldPosition).normalize();scope.gizmo[_mode].setActivePlane(scope.axis,eye);var planeIntersect=intersectObjects(pointer,[scope.gizmo[_mode].activePlane]);oldPosition.copy(scope.object.position);oldScale.copy(scope.object.scale);oldRotationMatrix.extractRotation(scope.object.matrix);worldRotationMatrix.extractRotation(scope.object.matrixWorld);parentRotationMatrix.extractRotation(scope.object.parent.matrixWorld);parentScale.setFromMatrixScale(tempMatrix.getInverse(scope.object.parent.matrixWorld));offset.copy(planeIntersect.point)}}_dragging=true}function onPointerMove(event){if(scope.object===undefined||scope.axis===null||_dragging===false)return;event.preventDefault();event.stopPropagation();var pointer=event.changedTouches?event.changedTouches[0]:event;var planeIntersect=intersectObjects(pointer,[scope.gizmo[_mode].activePlane]);point.copy(planeIntersect.point);if(_mode=="translate"){point.sub(offset);point.multiply(parentScale);if(scope.space=="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis.search("X")==-1)point.x=0;if(scope.axis.search("Y")==-1)point.y=0;if(scope.axis.search("Z")==-1)point.z=0;point.applyMatrix4(oldRotationMatrix);scope.object.position.copy(oldPosition);scope.object.position.add(point)}if(scope.space=="world"||scope.axis.search("XYZ")!=-1){if(scope.axis.search("X")==-1)point.x=0;if(scope.axis.search("Y")==-1)point.y=0;if(scope.axis.search("Z")==-1)point.z=0;point.applyMatrix4(tempMatrix.getInverse(parentRotationMatrix));scope.object.position.copy(oldPosition);scope.object.position.add(point)}if(scope.snap!==null){if(scope.axis.search("X")!=-1)scope.object.position.x=Math.round(scope.object.position.x/scope.snap)*scope.snap;if(scope.axis.search("Y")!=-1)scope.object.position.y=Math.round(scope.object.position.y/scope.snap)*scope.snap;if(scope.axis.search("Z")!=-1)scope.object.position.z=Math.round(scope.object.position.z/scope.snap)*scope.snap}}else if(_mode=="scale"){point.sub(offset);point.multiply(parentScale);if(scope.space=="local"){if(scope.axis=="XYZ"){scale=1+point.y/50;scope.object.scale.x=oldScale.x*scale;scope.object.scale.y=oldScale.y*scale;scope.object.scale.z=oldScale.z*scale}else{point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis=="X")scope.object.scale.x=oldScale.x*(1+point.x/50);if(scope.axis=="Y")scope.object.scale.y=oldScale.y*(1+point.y/50);if(scope.axis=="Z")scope.object.scale.z=oldScale.z*(1+point.z/50);
}}}else if(_mode=="rotate"){point.sub(worldPosition);point.multiply(parentScale);tempVector.copy(offset).sub(worldPosition);tempVector.multiply(parentScale);if(scope.axis=="E"){point.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionE.setFromAxisAngle(eye,rotation.z-offsetRotation.z);quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionE);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}else if(scope.axis=="XYZE"){quaternionE.setFromEuler(point.clone().cross(tempVector).normalize());tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionX.setFromAxisAngle(quaternionE,-point.clone().angleTo(tempVector));quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}else if(scope.space=="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));quaternionXYZ.setFromRotationMatrix(oldRotationMatrix);quaternionX.setFromAxisAngle(unitX,rotation.x-offsetRotation.x);quaternionY.setFromAxisAngle(unitY,rotation.y-offsetRotation.y);quaternionZ.setFromAxisAngle(unitZ,rotation.z-offsetRotation.z);if(scope.axis=="X")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionX);if(scope.axis=="Y")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionY);if(scope.axis=="Z")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionZ);scope.object.quaternion.copy(quaternionXYZ)}else if(scope.space=="world"){rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionX.setFromAxisAngle(unitX,rotation.x-offsetRotation.x);quaternionY.setFromAxisAngle(unitY,rotation.y-offsetRotation.y);quaternionZ.setFromAxisAngle(unitZ,rotation.z-offsetRotation.z);quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);if(scope.axis=="X")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);if(scope.axis=="Y")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionY);if(scope.axis=="Z")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionZ);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}}scope.update();scope.dispatchEvent(changeEvent);scope.dispatchEvent(objectChangeEvent)}function onPointerUp(event){if(_dragging&&scope.axis!==null){mouseUpEvent.mode=_mode;scope.dispatchEvent(mouseUpEvent)}_dragging=false;onPointerHover(event)}function intersectObjects(pointer,objects){var rect=domElement.getBoundingClientRect();var x=(pointer.clientX-rect.left)/rect.width;var y=(pointer.clientY-rect.top)/rect.height;pointerVector.set(x*2-1,-(y*2)+1,.5);pointerVector.unproject(camera);ray.set(camPosition,pointerVector.sub(camPosition).normalize());var intersections=ray.intersectObjects(objects,true);return intersections[0]?intersections[0]:false}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();THREE.STLLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.setResponseType("arraybuffer");loader.load(url,function(text){onLoad(scope.parse(text))},onProgress,onError)},parse:function(data){var isBinary=function(){var expect,face_size,n_faces,reader;reader=new DataView(binData);face_size=32/8*3+32/8*3*3+16/8;n_faces=reader.getUint32(80,true);expect=80+32/8+n_faces*face_size;if(expect===reader.byteLength){return true}var fileLength=reader.byteLength;for(var index=0;index<fileLength;index++){if(reader.getUint8(index,false)>127){return true}}return false};var binData=this.ensureBinary(data);return isBinary()?this.parseBinary(binData):this.parseASCII(this.ensureString(data))},parseBinary:function(data){var reader=new DataView(data);var faces=reader.getUint32(80,true);var r,g,b,hasColors=false,colors;var defaultR,defaultG,defaultB,alpha;for(var index=0;index<80-10;index++){if(reader.getUint32(index,false)==1129270351&&reader.getUint8(index+4)==82&&reader.getUint8(index+5)==61){hasColors=true;colors=new Float32Array(faces*3*3);defaultR=reader.getUint8(index+6)/255;defaultG=reader.getUint8(index+7)/255;defaultB=reader.getUint8(index+8)/255;alpha=reader.getUint8(index+9)/255}}var dataOffset=84;var faceLength=12*4+2;var offset=0;var geometry=new THREE.BufferGeometry;var vertices=new Float32Array(faces*3*3);var normals=new Float32Array(faces*3*3);for(var face=0;face<faces;face++){var start=dataOffset+face*faceLength;var normalX=reader.getFloat32(start,true);var normalY=reader.getFloat32(start+4,true);var normalZ=reader.getFloat32(start+8,true);if(hasColors){var packedColor=reader.getUint16(start+48,true);if((packedColor&32768)===0){r=(packedColor&31)/31;g=(packedColor>>5&31)/31;b=(packedColor>>10&31)/31}else{r=defaultR;g=defaultG;b=defaultB}}for(var i=1;i<=3;i++){var vertexstart=start+i*12;vertices[offset]=reader.getFloat32(vertexstart,true);vertices[offset+1]=reader.getFloat32(vertexstart+4,true);vertices[offset+2]=reader.getFloat32(vertexstart+8,true);normals[offset]=normalX;normals[offset+1]=normalY;normals[offset+2]=normalZ;if(hasColors){colors[offset]=r;colors[offset+1]=g;colors[offset+2]=b}offset+=3}}geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("normal",new THREE.BufferAttribute(normals,3));if(hasColors){geometry.addAttribute("color",new THREE.BufferAttribute(colors,3));geometry.hasColors=true;geometry.alpha=alpha}return geometry},parseASCII:function(data){var geometry,length,normal,patternFace,patternNormal,patternVertex,result,text;geometry=new THREE.Geometry;patternFace=/facet([\s\S]*?)endfacet/g;while((result=patternFace.exec(data))!==null){text=result[0];patternNormal=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((result=patternNormal.exec(text))!==null){normal=new THREE.Vector3(parseFloat(result[1]),parseFloat(result[3]),parseFloat(result[5]))}patternVertex=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((result=patternVertex.exec(text))!==null){geometry.vertices.push(new THREE.Vector3(parseFloat(result[1]),parseFloat(result[3]),parseFloat(result[5])))}length=geometry.vertices.length;geometry.faces.push(new THREE.Face3(length-3,length-2,length-1,normal))}geometry.computeBoundingBox();geometry.computeBoundingSphere();return geometry},ensureString:function(buf){if(typeof buf!=="string"){var array_buffer=new Uint8Array(buf);var str="";for(var i=0;i<buf.byteLength;i++){str+=String.fromCharCode(array_buffer[i])}return str}else{return buf}},ensureBinary:function(buf){if(typeof buf==="string"){var array_buffer=new Uint8Array(buf.length);for(var i=0;i<buf.length;i++){array_buffer[i]=buf.charCodeAt(i)&255}return array_buffer.buffer||array_buffer}else{return buf}}};if(typeof DataView==="undefined"){DataView=function(buffer,byteOffset,byteLength){this.buffer=buffer;this.byteOffset=byteOffset||0;this.byteLength=byteLength||buffer.byteLength||buffer.length;this._isString=typeof buffer==="string"};DataView.prototype={_getCharCodes:function(buffer,start,length){start=start||0;length=length||buffer.length;var end=start+length;var codes=[];for(var i=start;i<end;i++){codes.push(buffer.charCodeAt(i)&255)}return codes},_getBytes:function(length,byteOffset,littleEndian){var result;if(littleEndian===undefined){littleEndian=this._littleEndian}if(byteOffset===undefined){byteOffset=this.byteOffset}else{byteOffset=this.byteOffset+byteOffset}if(length===undefined){length=this.byteLength-byteOffset}if(typeof byteOffset!=="number"){throw new TypeError("DataView byteOffset is not a number")}if(length<0||byteOffset+length>this.byteLength){throw new Error("DataView length or (byteOffset+length) value is out of bounds")}if(this.isString){result=this._getCharCodes(this.buffer,byteOffset,byteOffset+length)}else{result=this.buffer.slice(byteOffset,byteOffset+length)}if(!littleEndian&&length>1){if(!(result instanceof Array)){result=Array.prototype.slice.call(result)}result.reverse()}return result},getFloat64:function(byteOffset,littleEndian){var b=this._getBytes(8,byteOffset,littleEndian),sign=1-2*(b[7]>>7),exponent=((b[7]<<1&255)<<3|b[6]>>4)-((1<<10)-1),mantissa=(b[6]&15)*Math.pow(2,48)+b[5]*Math.pow(2,40)+b[4]*Math.pow(2,32)+b[3]*Math.pow(2,24)+b[2]*Math.pow(2,16)+b[1]*Math.pow(2,8)+b[0];if(exponent===1024){if(mantissa!==0){return NaN}else{return sign*Infinity}}if(exponent===-1023){return sign*mantissa*Math.pow(2,-1022-52)}return sign*(1+mantissa*Math.pow(2,-52))*Math.pow(2,exponent)},getFloat32:function(byteOffset,littleEndian){var b=this._getBytes(4,byteOffset,littleEndian),sign=1-2*(b[3]>>7),exponent=(b[3]<<1&255|b[2]>>7)-127,mantissa=(b[2]&127)<<16|b[1]<<8|b[0];if(exponent===128){if(mantissa!==0){return NaN}else{return sign*Infinity}}if(exponent===-127){return sign*mantissa*Math.pow(2,-126-23)}return sign*(1+mantissa*Math.pow(2,-23))*Math.pow(2,exponent)},getInt32:function(byteOffset,littleEndian){var b=this._getBytes(4,byteOffset,littleEndian);return b[3]<<24|b[2]<<16|b[1]<<8|b[0]},getUint32:function(byteOffset,littleEndian){return this.getInt32(byteOffset,littleEndian)>>>0},getInt16:function(byteOffset,littleEndian){return this.getUint16(byteOffset,littleEndian)<<16>>16},getUint16:function(byteOffset,littleEndian){var b=this._getBytes(2,byteOffset,littleEndian);return b[1]<<8|b[0]},getInt8:function(byteOffset){return this.getUint8(byteOffset)<<24>>24},getUint8:function(byteOffset){return this._getBytes(1,byteOffset)[0]}}}THREE.STLBinaryExporter=function(){};THREE.STLBinaryExporter.prototype={constructor:THREE.STLBinaryExporter,parse:function(){var vector=new THREE.Vector3;var normalMatrixWorld=new THREE.Matrix3;return function(scene){var triangles=0;scene.traverse(function(object){if(!(object instanceof THREE.Mesh))return;triangles+=object.geometry.faces.length});var offset=80;var bufferLength=triangles*2+triangles*3*4*4+80+4;var arrayBuffer=new ArrayBuffer(bufferLength);var output=new DataView(arrayBuffer);output.setUint32(offset,triangles,true);offset+=4;scene.traverse(function(object){if(!(object instanceof THREE.Mesh))return;if(!(object.geometry instanceof THREE.Geometry))return;var geometry=object.geometry;var matrixWorld=object.matrixWorld;var vertices=geometry.vertices;var faces=geometry.faces;normalMatrixWorld.getNormalMatrix(matrixWorld);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];vector.copy(face.normal).applyMatrix3(normalMatrixWorld).normalize();output.setFloat32(offset,vector.x,true);offset+=4;output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4;var indices=[face.a,face.b,face.c];for(var j=0;j<3;j++){vector.copy(vertices[indices[j]]).applyMatrix4(matrixWorld);output.setFloat32(offset,vector.x,true);offset+=4;output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4}output.setUint16(offset,0,true);offset+=2}});return output}}()};THREE.STLExporter=function(){};THREE.STLExporter.prototype={constructor:THREE.STLExporter,parse:function(){var vector=new THREE.Vector3;var normalMatrixWorld=new THREE.Matrix3;return function(scene){var output="";output+="solid exported\n";scene.traverse(function(object){if(object instanceof THREE.Mesh){var geometry=object.geometry;var matrixWorld=object.matrixWorld;if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var faces=geometry.faces;normalMatrixWorld.getNormalMatrix(matrixWorld);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];vector.copy(face.normal).applyMatrix3(normalMatrixWorld).normalize();output+="\tfacet normal "+vector.x+" "+vector.y+" "+vector.z+"\n";output+="\t\touter loop\n";var indices=[face.a,face.b,face.c];for(var j=0;j<3;j++){vector.copy(vertices[indices[j]]).applyMatrix4(matrixWorld);output+="\t\t\tvertex "+vector.x+" "+vector.y+" "+vector.z+"\n"}output+="\t\tendloop\n";output+="\tendfacet\n"}}}});output+="endsolid exported\n";return output}}()};THREE.ColladaLoader=function(){var COLLADA=null;var scene=null;var visualScene;var kinematicsModel;var readyCallbackFunc=null;var sources={};var images={};var animations={};var controllers={};var geometries={};var materials={};var effects={};var cameras={};var lights={};var animData;var kinematics;var visualScenes;var kinematicsModels;var baseUrl;var morphs;var skins;var flip_uv=true;var preferredShading=THREE.SmoothShading;var options={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:"Y",defaultEnvMap:null};var colladaUnit=1;var colladaUp="Y";var upConversion=null;function load(url,readyCallback,progressCallback,failCallback){var length=0;if(document.implementation&&document.implementation.createDocument){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===4){if(request.status===0||request.status===200){if(request.responseXML){readyCallbackFunc=readyCallback;parse(request.responseXML,undefined,url)}else if(request.responseText){readyCallbackFunc=readyCallback;var xmlParser=new DOMParser;var responseXML=xmlParser.parseFromString(request.responseText,"application/xml");parse(responseXML,undefined,url)}else{if(faillCallback){failCallback()}else{console.error("ColladaLoader: Empty or non-existing file ("+url+")")}}}}else if(request.readyState===3){if(progressCallback){if(length===0){length=request.getResponseHeader("Content-Length")}progressCallback({total:length,loaded:request.responseText.length})}}};request.open("GET",url,true);request.send(null)}else{alert("Don't know how to parse XML!")}}function parse(doc,callBack,url){COLLADA=doc;callBack=callBack||readyCallbackFunc;if(url!==undefined){var parts=url.split("/");parts.pop();baseUrl=(parts.length<1?".":parts.join("/"))+"/"}parseAsset();setUpConversion();images=parseLib("library_images image",_Image,"image");materials=parseLib("library_materials material",Material,"material");effects=parseLib("library_effects effect",Effect,"effect");geometries=parseLib("library_geometries geometry",Geometry,"geometry");cameras=parseLib("library_cameras camera",Camera,"camera");lights=parseLib("library_lights light",Light,"light");controllers=parseLib("library_controllers controller",Controller,"controller");animations=parseLib("library_animations animation",Animation,"animation");visualScenes=parseLib("library_visual_scenes visual_scene",VisualScene,"visual_scene");kinematicsModels=parseLib("library_kinematics_models kinematics_model",KinematicsModel,"kinematics_model");morphs=[];skins=[];visualScene=parseScene();scene=new THREE.Group;for(var i=0;i<visualScene.nodes.length;i++){scene.add(createSceneGraph(visualScene.nodes[i]))}scene.scale.multiplyScalar(colladaUnit);createAnimations();kinematicsModel=parseKinematicsModel();createKinematics();var result={scene:scene,morphs:morphs,skins:skins,animations:animData,kinematics:kinematics,dae:{images:images,materials:materials,cameras:cameras,lights:lights,effects:effects,geometries:geometries,controllers:controllers,animations:animations,visualScenes:visualScenes,visualScene:visualScene,scene:visualScene,kinematicsModels:kinematicsModels,kinematicsModel:kinematicsModel}};if(callBack){callBack(result)}return result}function setPreferredShading(shading){preferredShading=shading}function parseAsset(){var elements=COLLADA.querySelectorAll("asset");var element=elements[0];if(element&&element.childNodes){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"unit":var meter=child.getAttribute("meter");if(meter){colladaUnit=parseFloat(meter)}break;case"up_axis":colladaUp=child.textContent.charAt(0);break}}}}function parseLib(q,classSpec,prefix){var elements=COLLADA.querySelectorAll(q);var lib={};var i=0;var elementsLength=elements.length;for(var j=0;j<elementsLength;j++){var element=elements[j];var daeElement=(new classSpec).parse(element);if(!daeElement.id||daeElement.id.length===0)daeElement.id=prefix+i++;lib[daeElement.id]=daeElement}return lib}function parseScene(){var sceneElement=COLLADA.querySelectorAll("scene instance_visual_scene")[0];if(sceneElement){var url=sceneElement.getAttribute("url").replace(/^#/,"");return visualScenes[url.length>0?url:"visual_scene0"]}else{return null}}function parseKinematicsModel(){var kinematicsModelElement=COLLADA.querySelectorAll("instance_kinematics_model")[0];if(kinematicsModelElement){var url=kinematicsModelElement.getAttribute("url").replace(/^#/,"");return kinematicsModels[url.length>0?url:"kinematics_model0"]}else{return null}}function createAnimations(){animData=[];recurseHierarchy(scene)}function recurseHierarchy(node){var n=visualScene.getChildById(node.colladaId,true),newData=null;if(n&&n.keys){newData={fps:60,hierarchy:[{node:n,keys:n.keys,sids:n.sids}],node:node,name:"animation_"+node.name,length:0};animData.push(newData);for(var i=0,il=n.keys.length;i<il;i++){newData.length=Math.max(newData.length,n.keys[i].time)}}else{newData={hierarchy:[{keys:[],sids:[]}]}}for(var i=0,il=node.children.length;i<il;i++){var d=recurseHierarchy(node.children[i]);for(var j=0,jl=d.hierarchy.length;j<jl;j++){newData.hierarchy.push({keys:[],sids:[]})}}return newData}function calcAnimationBounds(){var start=1e6;var end=-start;var frames=0;var ID;for(var id in animations){var animation=animations[id];ID=ID||animation.id;for(var i=0;i<animation.sampler.length;i++){var sampler=animation.sampler[i];sampler.create();start=Math.min(start,sampler.startTime);end=Math.max(end,sampler.endTime);frames=Math.max(frames,sampler.input.length)}}return{start:start,end:end,frames:frames,ID:ID}}function createMorph(geometry,ctrl){var morphCtrl=ctrl instanceof InstanceController?controllers[ctrl.url]:ctrl;if(!morphCtrl||!morphCtrl.morph){console.log("could not find morph controller!");return}var morph=morphCtrl.morph;for(var i=0;i<morph.targets.length;i++){var target_id=morph.targets[i];var daeGeometry=geometries[target_id];if(!daeGeometry.mesh||!daeGeometry.mesh.primitives||!daeGeometry.mesh.primitives.length){continue}var target=daeGeometry.mesh.primitives[0].geometry;if(target.vertices.length===geometry.vertices.length){geometry.morphTargets.push({name:"target_1",vertices:target.vertices})}}geometry.morphTargets.push({name:"target_Z",vertices:geometry.vertices})}function createSkin(geometry,ctrl,applyBindShape){var skinCtrl=controllers[ctrl.url];if(!skinCtrl||!skinCtrl.skin){console.log("could not find skin controller!");return}if(!ctrl.skeleton||!ctrl.skeleton.length){console.log("could not find the skeleton for the skin!");return}var skin=skinCtrl.skin;var skeleton=visualScene.getChildById(ctrl.skeleton[0]);var hierarchy=[];applyBindShape=applyBindShape!==undefined?applyBindShape:true;var bones=[];geometry.skinWeights=[];geometry.skinIndices=[];if(applyBindShape){for(var i=0;i<geometry.vertices.length;i++){geometry.vertices[i].applyMatrix4(skin.bindShapeMatrix)}}}function setupSkeleton(node,bones,frame,parent){node.world=node.world||new THREE.Matrix4;node.localworld=node.localworld||new THREE.Matrix4;node.world.copy(node.matrix);node.localworld.copy(node.matrix);if(node.channels&&node.channels.length){var channel=node.channels[0];var m=channel.sampler.output[frame];if(m instanceof THREE.Matrix4){node.world.copy(m);node.localworld.copy(m);if(frame===0)node.matrix.copy(m)}}if(parent){node.world.multiplyMatrices(parent,node.world)}bones.push(node);for(var i=0;i<node.nodes.length;i++){setupSkeleton(node.nodes[i],bones,frame,node.world)}}function setupSkinningMatrices(bones,skin){for(var i=0;i<bones.length;i++){var bone=bones[i];var found=-1;if(bone.type!="JOINT")continue;for(var j=0;j<skin.joints.length;j++){if(bone.sid===skin.joints[j]){found=j;break}}if(found>=0){var inv=skin.invBindMatrices[found];bone.invBindMatrix=inv;bone.skinningMatrix=new THREE.Matrix4;bone.skinningMatrix.multiplyMatrices(bone.world,inv);bone.animatrix=new THREE.Matrix4;bone.animatrix.copy(bone.localworld);bone.weights=[];for(var j=0;j<skin.weights.length;j++){for(var k=0;k<skin.weights[j].length;k++){var w=skin.weights[j][k];if(w.joint===found){bone.weights.push(w)}}}}else{console.warn("ColladaLoader: Could not find joint '"+bone.sid+"'.");bone.skinningMatrix=new THREE.Matrix4;bone.weights=[]}}}function flattenSkeleton(skeleton){var list=[];var walk=function(parentid,node,list){var bone={};bone.name=node.sid;bone.parent=parentid;bone.matrix=node.matrix;var data=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];bone.matrix.decompose(data[0],data[1],data[2]);bone.pos=[data[0].x,data[0].y,data[0].z];bone.scl=[data[2].x,data[2].y,data[2].z];bone.rotq=[data[1].x,data[1].y,data[1].z,data[1].w];list.push(bone);for(var i in node.nodes){walk(node.sid,node.nodes[i],list)}};walk(-1,skeleton,list);return list}function skinToBindPose(geometry,skeleton,skinController){var bones=[];setupSkeleton(skeleton,bones,-1);setupSkinningMatrices(bones,skinController.skin);v=new THREE.Vector3;var skinned=[];for(var i=0;i<geometry.vertices.length;i++){skinned.push(new THREE.Vector3)}for(i=0;i<bones.length;i++){if(bones[i].type!="JOINT")continue;for(j=0;j<bones[i].weights.length;j++){w=bones[i].weights[j];vidx=w.index;weight=w.weight;o=geometry.vertices[vidx];s=skinned[vidx];v.x=o.x;v.y=o.y;v.z=o.z;v.applyMatrix4(bones[i].skinningMatrix);s.x+=v.x*weight;s.y+=v.y*weight;s.z+=v.z*weight}}for(var i=0;i<geometry.vertices.length;i++){geometry.vertices[i]=skinned[i]}}function applySkin(geometry,instanceCtrl,frame){var skinController=controllers[instanceCtrl.url];frame=frame!==undefined?frame:40;if(!skinController||!skinController.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!instanceCtrl.skeleton||!instanceCtrl.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var animationBounds=calcAnimationBounds();var skeleton=visualScene.getChildById(instanceCtrl.skeleton[0],true)||visualScene.getChildBySid(instanceCtrl.skeleton[0],true);var bonelist=flattenSkeleton(skeleton);var joints=skinController.skin.joints;var sortedbones=[];for(var i=0;i<joints.length;i++){for(var j=0;j<bonelist.length;j++){if(bonelist[j].name===joints[i]){sortedbones[i]=bonelist[j]}}}for(var i=0;i<sortedbones.length;i++){for(var j=0;j<sortedbones.length;j++){if(sortedbones[i].parent===sortedbones[j].name){sortedbones[i].parent=j}}}var i,j,w,vidx,weight;var v=new THREE.Vector3,o,s;for(i=0;i<geometry.vertices.length;i++){geometry.vertices[i].applyMatrix4(skinController.skin.bindShapeMatrix)}var skinIndices=[];var skinWeights=[];var weights=skinController.skin.weights;for(var i=0;i<weights.length;i++){var indicies=new THREE.Vector4(weights[i][0]?weights[i][0].joint:0,weights[i][1]?weights[i][1].joint:0,weights[i][2]?weights[i][2].joint:0,weights[i][3]?weights[i][3].joint:0);var weight=new THREE.Vector4(weights[i][0]?weights[i][0].weight:0,weights[i][1]?weights[i][1].weight:0,weights[i][2]?weights[i][2].weight:0,weights[i][3]?weights[i][3].weight:0);skinIndices.push(indicies);skinWeights.push(weight)}geometry.skinIndices=skinIndices;geometry.skinWeights=skinWeights;geometry.bones=sortedbones;var animationdata={name:animationBounds.ID,fps:30,length:animationBounds.frames/30,hierarchy:[]};for(var j=0;j<sortedbones.length;j++){animationdata.hierarchy.push({parent:sortedbones[j].parent,name:sortedbones[j].name,keys:[]})}console.log("ColladaLoader:",animationBounds.ID+" has "+sortedbones.length+" bones.");skinToBindPose(geometry,skeleton,skinController);for(frame=0;frame<animationBounds.frames;frame++){var bones=[];var skinned=[];setupSkeleton(skeleton,bones,frame);setupSkinningMatrices(bones,skinController.skin);for(var i=0;i<bones.length;i++){for(var j=0;j<animationdata.hierarchy.length;j++){if(animationdata.hierarchy[j].name===bones[i].sid){var key={};key.time=frame/30;key.matrix=bones[i].animatrix;if(frame===0)bones[i].matrix=key.matrix;var data=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];key.matrix.decompose(data[0],data[1],data[2]);key.pos=[data[0].x,data[0].y,data[0].z];key.scl=[data[2].x,data[2].y,data[2].z];key.rot=data[1];animationdata.hierarchy[j].keys.push(key)}}}geometry.animation=animationdata}}function createKinematics(){if(kinematicsModel&&kinematicsModel.joints.length===0){kinematics=undefined;return}var jointMap={};var _addToMap=function(jointIndex,parentVisualElement){var parentVisualElementId=parentVisualElement.getAttribute("id");var colladaNode=visualScene.getChildById(parentVisualElementId,true);var joint=kinematicsModel.joints[jointIndex];scene.traverse(function(node){if(node.colladaId==parentVisualElementId){jointMap[jointIndex]={node:node,transforms:colladaNode.transforms,joint:joint,position:joint.zeroPosition}}})};kinematics={joints:kinematicsModel&&kinematicsModel.joints,getJointValue:function(jointIndex){var jointData=jointMap[jointIndex];if(jointData){return jointData.position}else{console.log("getJointValue: joint "+jointIndex+" doesn't exist")}},setJointValue:function(jointIndex,value){var jointData=jointMap[jointIndex];if(jointData){var joint=jointData.joint;if(value>joint.limits.max||value<joint.limits.min){console.log("setJointValue: joint "+jointIndex+" value "+value+" outside of limits (min: "+joint.limits.min+", max: "+joint.limits.max+")")}else if(joint.static){console.log("setJointValue: joint "+jointIndex+" is static")}else{var threejsNode=jointData.node;var axis=joint.axis;var transforms=jointData.transforms;var matrix=new THREE.Matrix4;for(i=0;i<transforms.length;i++){var transform=transforms[i];if(transform.sid&&transform.sid.indexOf("joint"+jointIndex)!==-1){switch(joint.type){case"revolute":matrix.multiply(m1.makeRotationAxis(axis,THREE.Math.degToRad(value)));break;case"prismatic":matrix.multiply(m1.makeTranslation(axis.x*value,axis.y*value,axis.z*value));break;default:console.warn("setJointValue: unknown joint type: "+joint.type);break}}else{var m1=new THREE.Matrix4;switch(transform.type){case"matrix":matrix.multiply(transform.obj);break;case"translate":matrix.multiply(m1.makeTranslation(transform.obj.x,transform.obj.y,transform.obj.z));break;case"rotate":matrix.multiply(m1.makeRotationAxis(transform.obj,transform.angle));break}}}var elementsFloat32Arr=matrix.elements;var elements=Array.prototype.slice.call(elementsFloat32Arr);var elementsRowMajor=[elements[0],elements[4],elements[8],elements[12],elements[1],elements[5],elements[9],elements[13],elements[2],elements[6],elements[10],elements[14],elements[3],elements[7],elements[11],elements[15]];threejsNode.matrix.set.apply(threejsNode.matrix,elementsRowMajor);threejsNode.matrix.decompose(threejsNode.position,threejsNode.quaternion,threejsNode.scale)}}else{console.log("setJointValue: joint "+jointIndex+" doesn't exist")}}};var element=COLLADA.querySelector("scene instance_kinematics_scene");if(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"bind_joint_axis":var visualTarget=child.getAttribute("target").split("/").pop();var axis=child.querySelector("axis param").textContent;var jointIndex=parseInt(axis.split("joint").pop().split(".")[0]);var visualTargetElement=COLLADA.querySelector('[sid="'+visualTarget+'"]');if(visualTargetElement){var parentVisualElement=visualTargetElement.parentElement;_addToMap(jointIndex,parentVisualElement)}break;default:break}}}}function createSceneGraph(node,parent){var obj=new THREE.Object3D;var skinned=false;var skinController;var morphController;var i,j;for(i=0;i<node.controllers.length;i++){var controller=controllers[node.controllers[i].url];switch(controller.type){case"skin":if(geometries[controller.skin.source]){var inst_geom=new InstanceGeometry;inst_geom.url=controller.skin.source;inst_geom.instance_material=node.controllers[i].instance_material;node.geometries.push(inst_geom);skinned=true;skinController=node.controllers[i]}else if(controllers[controller.skin.source]){var second=controllers[controller.skin.source];morphController=second;if(second.morph&&geometries[second.morph.source]){var inst_geom=new InstanceGeometry;inst_geom.url=second.morph.source;inst_geom.instance_material=node.controllers[i].instance_material;node.geometries.push(inst_geom)}}break;case"morph":if(geometries[controller.morph.source]){var inst_geom=new InstanceGeometry;inst_geom.url=controller.morph.source;inst_geom.instance_material=node.controllers[i].instance_material;node.geometries.push(inst_geom);morphController=node.controllers[i]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var double_sided_materials={};for(i=0;i<node.geometries.length;i++){var instance_geometry=node.geometries[i];var instance_materials=instance_geometry.instance_material;var geometry=geometries[instance_geometry.url];var used_materials={};var used_materials_array=[];var num_materials=0;var first_material;if(geometry){if(!geometry.mesh||!geometry.mesh.primitives)continue;if(obj.name.length===0){obj.name=geometry.id}if(instance_materials){for(j=0;j<instance_materials.length;j++){var instance_material=instance_materials[j];var mat=materials[instance_material.target];var effect_id=mat.instance_effect.url;var shader=effects[effect_id].shader;var material3js=shader.material;if(geometry.doubleSided){if(!(instance_material.symbol in double_sided_materials)){var _copied_material=material3js.clone();_copied_material.side=THREE.DoubleSide;double_sided_materials[instance_material.symbol]=_copied_material}material3js=double_sided_materials[instance_material.symbol]}material3js.opacity=!material3js.opacity?1:material3js.opacity;used_materials[instance_material.symbol]=num_materials;used_materials_array.push(material3js);first_material=material3js;first_material.name=mat.name===null||mat.name===""?mat.id:mat.name;num_materials++}}var mesh;var material=first_material||new THREE.MeshLambertMaterial({color:14540253,side:geometry.doubleSided?THREE.DoubleSide:THREE.FrontSide});var geom=geometry.mesh.geometry3js;if(num_materials>1){material=new THREE.MeshFaceMaterial(used_materials_array);for(j=0;j<geom.faces.length;j++){var face=geom.faces[j];face.materialIndex=used_materials[face.daeMaterial]}}if(skinController!==undefined){applySkin(geom,skinController);if(geom.morphTargets.length>0){material.morphTargets=true;material.skinning=false}else{material.morphTargets=false;material.skinning=true}mesh=new THREE.SkinnedMesh(geom,material,false);mesh.name="skin_"+skins.length;skins.push(mesh)}else if(morphController!==undefined){createMorph(geom,morphController);material.morphTargets=true;mesh=new THREE.Mesh(geom,material);mesh.name="morph_"+morphs.length;morphs.push(mesh)}else{if(geom.isLineStrip===true){mesh=new THREE.Line(geom);
}else{mesh=new THREE.Mesh(geom,material)}}obj.add(mesh)}}for(i=0;i<node.cameras.length;i++){var instance_camera=node.cameras[i];var cparams=cameras[instance_camera.url];var cam=new THREE.PerspectiveCamera(cparams.yfov,parseFloat(cparams.aspect_ratio),parseFloat(cparams.znear),parseFloat(cparams.zfar));obj.add(cam)}for(i=0;i<node.lights.length;i++){var light=null;var instance_light=node.lights[i];var lparams=lights[instance_light.url];if(lparams&&lparams.technique){var color=lparams.color.getHex();var intensity=lparams.intensity;var distance=lparams.distance;var angle=lparams.falloff_angle;var exponent;switch(lparams.technique){case"directional":light=new THREE.DirectionalLight(color,intensity,distance);light.position.set(0,0,1);break;case"point":light=new THREE.PointLight(color,intensity,distance);break;case"spot":light=new THREE.SpotLight(color,intensity,distance,angle,exponent);light.position.set(0,0,1);break;case"ambient":light=new THREE.AmbientLight(color);break}}if(light){obj.add(light)}}obj.name=node.name||node.id||"";obj.colladaId=node.id||"";obj.layer=node.layer||"";obj.matrix=node.matrix;obj.matrix.decompose(obj.position,obj.quaternion,obj.scale);if(options.centerGeometry&&obj.geometry){var delta=obj.geometry.center();delta.multiply(obj.scale);delta.applyQuaternion(obj.quaternion);obj.position.sub(delta)}for(i=0;i<node.nodes.length;i++){obj.add(createSceneGraph(node.nodes[i],node))}return obj}function getJointId(skin,id){for(var i=0;i<skin.joints.length;i++){if(skin.joints[i]===id){return i}}}function getLibraryNode(id){var nodes=COLLADA.querySelectorAll("library_nodes node");for(var i=0;i<nodes.length;i++){var attObj=nodes[i].attributes.getNamedItem("id");if(attObj&&attObj.value===id){return nodes[i]}}return undefined}function getChannelsForNode(node){var channels=[];var startTime=1e6;var endTime=-1e6;for(var id in animations){var animation=animations[id];for(var i=0;i<animation.channel.length;i++){var channel=animation.channel[i];var sampler=animation.sampler[i];var id=channel.target.split("/")[0];if(id==node.id){sampler.create();channel.sampler=sampler;startTime=Math.min(startTime,sampler.startTime);endTime=Math.max(endTime,sampler.endTime);channels.push(channel)}}}if(channels.length){node.startTime=startTime;node.endTime=endTime}return channels}function calcFrameDuration(node){var minT=1e7;for(var i=0;i<node.channels.length;i++){var sampler=node.channels[i].sampler;for(var j=0;j<sampler.input.length-1;j++){var t0=sampler.input[j];var t1=sampler.input[j+1];minT=Math.min(minT,t1-t0)}}return minT}function calcMatrixAt(node,t){var animated={};var i,j;for(i=0;i<node.channels.length;i++){var channel=node.channels[i];animated[channel.sid]=channel}var matrix=new THREE.Matrix4;for(i=0;i<node.transforms.length;i++){var transform=node.transforms[i];var channel=animated[transform.sid];if(channel!==undefined){var sampler=channel.sampler;var value;for(j=0;j<sampler.input.length-1;j++){if(sampler.input[j+1]>t){value=sampler.output[j];break}}if(value!==undefined){if(value instanceof THREE.Matrix4){matrix.multiplyMatrices(matrix,value)}else{matrix.multiplyMatrices(matrix,transform.matrix)}}else{matrix.multiplyMatrices(matrix,transform.matrix)}}else{matrix.multiplyMatrices(matrix,transform.matrix)}}return matrix}function bakeAnimations(node){if(node.channels&&node.channels.length){var keys=[],sids=[];for(var i=0,il=node.channels.length;i<il;i++){var channel=node.channels[i],fullSid=channel.fullSid,sampler=channel.sampler,input=sampler.input,transform=node.getTransformBySid(channel.sid),member;if(channel.arrIndices){member=[];for(var j=0,jl=channel.arrIndices.length;j<jl;j++){member[j]=getConvertedIndex(channel.arrIndices[j])}}else{member=getConvertedMember(channel.member)}if(transform){if(sids.indexOf(fullSid)===-1){sids.push(fullSid)}for(var j=0,jl=input.length;j<jl;j++){var time=input[j],data=sampler.getData(transform.type,j,member),key=findKey(keys,time);if(!key){key=new Key(time);var timeNdx=findTimeNdx(keys,time);keys.splice(timeNdx===-1?keys.length:timeNdx,0,key)}key.addTarget(fullSid,transform,member,data)}}else{console.log('Could not find transform "'+channel.sid+'" in node '+node.id)}}for(var i=0;i<sids.length;i++){var sid=sids[i];for(var j=0;j<keys.length;j++){var key=keys[j];if(!key.hasTarget(sid)){interpolateKeys(keys,key,j,sid)}}}node.keys=keys;node.sids=sids}}function findKey(keys,time){var retVal=null;for(var i=0,il=keys.length;i<il&&retVal===null;i++){var key=keys[i];if(key.time===time){retVal=key}else if(key.time>time){break}}return retVal}function findTimeNdx(keys,time){var ndx=-1;for(var i=0,il=keys.length;i<il&&ndx===-1;i++){var key=keys[i];if(key.time>=time){ndx=i}}return ndx}function interpolateKeys(keys,key,ndx,fullSid){var prevKey=getPrevKeyWith(keys,fullSid,ndx?ndx-1:0),nextKey=getNextKeyWith(keys,fullSid,ndx+1);if(prevKey&&nextKey){var scale=(key.time-prevKey.time)/(nextKey.time-prevKey.time),prevTarget=prevKey.getTarget(fullSid),nextData=nextKey.getTarget(fullSid).data,prevData=prevTarget.data,data;if(prevTarget.type==="matrix"){data=prevData}else if(prevData.length){data=[];for(var i=0;i<prevData.length;++i){data[i]=prevData[i]+(nextData[i]-prevData[i])*scale}}else{data=prevData+(nextData-prevData)*scale}key.addTarget(fullSid,prevTarget.transform,prevTarget.member,data)}}function getNextKeyWith(keys,fullSid,ndx){for(;ndx<keys.length;ndx++){var key=keys[ndx];if(key.hasTarget(fullSid)){return key}}return null}function getPrevKeyWith(keys,fullSid,ndx){ndx=ndx>=0?ndx:ndx+keys.length;for(;ndx>=0;ndx--){var key=keys[ndx];if(key.hasTarget(fullSid)){return key}}return null}function _Image(){this.id="";this.init_from=""}_Image.prototype.parse=function(element){this.id=element.getAttribute("id");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeName==="init_from"){this.init_from=child.textContent}}return this};function Controller(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null}Controller.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");this.type="none";for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"skin":this.skin=(new Skin).parse(child);this.type=child.nodeName;break;case"morph":this.morph=(new Morph).parse(child);this.type=child.nodeName;break;default:break}}return this};function Morph(){this.method=null;this.source=null;this.targets=null;this.weights=null}Morph.prototype.parse=function(element){var sources={};var inputs=[];var i;this.method=element.getAttribute("method");this.source=element.getAttribute("source").replace(/^#/,"");for(i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"source":var source=(new Source).parse(child);sources[source.id]=source;break;case"targets":inputs=this.parseInputs(child);break;default:console.log(child.nodeName);break}}for(i=0;i<inputs.length;i++){var input=inputs[i];var source=sources[input.source];switch(input.semantic){case"MORPH_TARGET":this.targets=source.read();break;case"MORPH_WEIGHT":this.weights=source.read();break;default:break}}return this};Morph.prototype.parseInputs=function(element){var inputs=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"input":inputs.push((new Input).parse(child));break;default:break}}return inputs};function Skin(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}Skin.prototype.parse=function(element){var sources={};var joints,weights;this.source=element.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"bind_shape_matrix":var f=_floats(child.textContent);this.bindShapeMatrix=getConvertedMat4(f);break;case"source":var src=(new Source).parse(child);sources[src.id]=src;break;case"joints":joints=child;break;case"vertex_weights":weights=child;break;default:console.log(child.nodeName);break}}this.parseJoints(joints,sources);this.parseWeights(weights,sources);return this};Skin.prototype.parseJoints=function(element,sources){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"input":var input=(new Input).parse(child);var source=sources[input.source];if(input.semantic==="JOINT"){this.joints=source.read()}else if(input.semantic==="INV_BIND_MATRIX"){this.invBindMatrices=source.read()}break;default:break}}};Skin.prototype.parseWeights=function(element,sources){var v,vcount,inputs=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"input":inputs.push((new Input).parse(child));break;case"v":v=_ints(child.textContent);break;case"vcount":vcount=_ints(child.textContent);break;default:break}}var index=0;for(var i=0;i<vcount.length;i++){var numBones=vcount[i];var vertex_weights=[];for(var j=0;j<numBones;j++){var influence={};for(var k=0;k<inputs.length;k++){var input=inputs[k];var value=v[index+input.offset];switch(input.semantic){case"JOINT":influence.joint=value;break;case"WEIGHT":influence.weight=sources[input.source].data[value];break;default:break}}vertex_weights.push(influence);index+=inputs.length}for(var j=0;j<vertex_weights.length;j++){vertex_weights[j].index=i}this.weights.push(vertex_weights)}};function VisualScene(){this.id="";this.name="";this.nodes=[];this.scene=new THREE.Group}VisualScene.prototype.getChildById=function(id,recursive){for(var i=0;i<this.nodes.length;i++){var node=this.nodes[i].getChildById(id,recursive);if(node){return node}}return null};VisualScene.prototype.getChildBySid=function(sid,recursive){for(var i=0;i<this.nodes.length;i++){var node=this.nodes[i].getChildBySid(sid,recursive);if(node){return node}}return null};VisualScene.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");this.nodes=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"node":this.nodes.push((new Node).parse(child));break;default:break}}return this};function Node(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4}Node.prototype.getChannelForTransform=function(transformSid){for(var i=0;i<this.channels.length;i++){var channel=this.channels[i];var parts=channel.target.split("/");var id=parts.shift();var sid=parts.shift();var dotSyntax=sid.indexOf(".")>=0;var arrSyntax=sid.indexOf("(")>=0;var arrIndices;var member;if(dotSyntax){parts=sid.split(".");sid=parts.shift();member=parts.shift()}else if(arrSyntax){arrIndices=sid.split("(");sid=arrIndices.shift();for(var j=0;j<arrIndices.length;j++){arrIndices[j]=parseInt(arrIndices[j].replace(/\)/,""))}}if(sid===transformSid){channel.info={sid:sid,dotSyntax:dotSyntax,arrSyntax:arrSyntax,arrIndices:arrIndices};return channel}}return null};Node.prototype.getChildById=function(id,recursive){if(this.id===id){return this}if(recursive){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(id,recursive);if(n){return n}}}return null};Node.prototype.getChildBySid=function(sid,recursive){if(this.sid===sid){return this}if(recursive){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(sid,recursive);if(n){return n}}}return null};Node.prototype.getTransformBySid=function(sid){for(var i=0;i<this.transforms.length;i++){if(this.transforms[i].sid===sid)return this.transforms[i]}return null};Node.prototype.parse=function(element){var url;this.id=element.getAttribute("id");this.sid=element.getAttribute("sid");this.name=element.getAttribute("name");this.type=element.getAttribute("type");this.layer=element.getAttribute("layer");this.type=this.type==="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.lights=[];this.controllers=[];this.matrix=new THREE.Matrix4;for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"node":this.nodes.push((new Node).parse(child));break;case"instance_camera":this.cameras.push((new InstanceCamera).parse(child));break;case"instance_controller":this.controllers.push((new InstanceController).parse(child));break;case"instance_geometry":this.geometries.push((new InstanceGeometry).parse(child));break;case"instance_light":this.lights.push((new InstanceLight).parse(child));break;case"instance_node":url=child.getAttribute("url").replace(/^#/,"");var iNode=getLibraryNode(url);if(iNode){this.nodes.push((new Node).parse(iNode))}break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new Transform).parse(child));break;case"extra":break;default:console.log(child.nodeName);break}}this.channels=getChannelsForNode(this);bakeAnimations(this);this.updateMatrix();return this};Node.prototype.updateMatrix=function(){this.matrix.identity();for(var i=0;i<this.transforms.length;i++){this.transforms[i].apply(this.matrix)}};function Transform(){this.sid="";this.type="";this.data=[];this.obj=null}Transform.prototype.parse=function(element){this.sid=element.getAttribute("sid");this.type=element.nodeName;this.data=_floats(element.textContent);this.convert();return this};Transform.prototype.convert=function(){switch(this.type){case"matrix":this.obj=getConvertedMat4(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":fixCoords(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":fixCoords(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}};Transform.prototype.apply=function(){var m1=new THREE.Matrix4;return function(matrix){switch(this.type){case"matrix":matrix.multiply(this.obj);break;case"translate":matrix.multiply(m1.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":matrix.multiply(m1.makeRotationAxis(this.obj,this.angle));break;case"scale":matrix.scale(this.obj);break}}}();Transform.prototype.update=function(data,member){var members=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!member){this.obj.copy(data)}else if(member.length===1){switch(member[0]){case 0:this.obj.n11=data[0];this.obj.n21=data[1];this.obj.n31=data[2];this.obj.n41=data[3];break;case 1:this.obj.n12=data[0];this.obj.n22=data[1];this.obj.n32=data[2];this.obj.n42=data[3];break;case 2:this.obj.n13=data[0];this.obj.n23=data[1];this.obj.n33=data[2];this.obj.n43=data[3];break;case 3:this.obj.n14=data[0];this.obj.n24=data[1];this.obj.n34=data[2];this.obj.n44=data[3];break}}else if(member.length===2){var propName="n"+(member[0]+1)+(member[1]+1);this.obj[propName]=data}else{console.log("Incorrect addressing of matrix in transform.")}break;case"translate":case"scale":if(Object.prototype.toString.call(member)==="[object Array]"){member=members[member[0]]}switch(member){case"X":this.obj.x=data;break;case"Y":this.obj.y=data;break;case"Z":this.obj.z=data;break;default:this.obj.x=data[0];this.obj.y=data[1];this.obj.z=data[2];break}break;case"rotate":if(Object.prototype.toString.call(member)==="[object Array]"){member=members[member[0]]}switch(member){case"X":this.obj.x=data;break;case"Y":this.obj.y=data;break;case"Z":this.obj.z=data;break;case"ANGLE":this.angle=THREE.Math.degToRad(data);break;default:this.obj.x=data[0];this.obj.y=data[1];this.obj.z=data[2];this.angle=THREE.Math.degToRad(data[3]);break}break}};function InstanceController(){this.url="";this.skeleton=[];this.instance_material=[]}InstanceController.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!==1)continue;switch(child.nodeName){case"skeleton":this.skeleton.push(child.textContent.replace(/^#/,""));break;case"bind_material":var instances=child.querySelectorAll("instance_material");for(var j=0;j<instances.length;j++){var instance=instances[j];this.instance_material.push((new InstanceMaterial).parse(instance))}break;case"extra":break;default:break}}return this};function InstanceMaterial(){this.symbol="";this.target=""}InstanceMaterial.prototype.parse=function(element){this.symbol=element.getAttribute("symbol");this.target=element.getAttribute("target").replace(/^#/,"");return this};function InstanceGeometry(){this.url="";this.instance_material=[]}InstanceGeometry.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;if(child.nodeName==="bind_material"){var instances=child.querySelectorAll("instance_material");for(var j=0;j<instances.length;j++){var instance=instances[j];this.instance_material.push((new InstanceMaterial).parse(instance))}break}}return this};function Geometry(){this.id="";this.mesh=null}Geometry.prototype.parse=function(element){this.id=element.getAttribute("id");extractDoubleSided(this,element);for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"mesh":this.mesh=new Mesh(this).parse(child);break;case"extra":break;default:break}}return this};function Mesh(geometry){this.geometry=geometry.id;this.primitives=[];this.vertices=null;this.geometry3js=null}Mesh.prototype.parse=function(element){this.primitives=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"source":_source(child);break;case"vertices":this.vertices=(new Vertices).parse(child);break;case"linestrips":this.primitives.push((new LineStrips).parse(child));break;case"triangles":this.primitives.push((new Triangles).parse(child));break;case"polygons":this.primitives.push((new Polygons).parse(child));break;case"polylist":this.primitives.push((new Polylist).parse(child));break;default:break}}this.geometry3js=new THREE.Geometry;if(this.vertices===null){return this}var vertexData=sources[this.vertices.input["POSITION"].source].data;for(var i=0;i<vertexData.length;i+=3){this.geometry3js.vertices.push(getConvertedVec3(vertexData,i).clone())}for(var i=0;i<this.primitives.length;i++){var primitive=this.primitives[i];primitive.setVertices(this.vertices);this.handlePrimitive(primitive,this.geometry3js)}if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals}return this};Mesh.prototype.handlePrimitive=function(primitive,geom){if(primitive instanceof LineStrips){geom.isLineStrip=true;return}var j,k,pList=primitive.p,inputs=primitive.inputs;var input,index,idx32;var source,numParams;var vcIndex=0,vcount=3,maxOffset=0;var texture_sets=[];for(j=0;j<inputs.length;j++){input=inputs[j];var offset=input.offset+1;maxOffset=maxOffset<offset?offset:maxOffset;switch(input.semantic){case"TEXCOORD":texture_sets.push(input.set);break}}for(var pCount=0;pCount<pList.length;++pCount){var p=pList[pCount],i=0;while(i<p.length){var vs=[];var ns=[];var ts=null;var cs=[];if(primitive.vcount){vcount=primitive.vcount.length?primitive.vcount[vcIndex++]:primitive.vcount}else{vcount=p.length/maxOffset}for(j=0;j<vcount;j++){for(k=0;k<inputs.length;k++){input=inputs[k];source=sources[input.source];index=p[i+j*maxOffset+input.offset];numParams=source.accessor.params.length;idx32=index*numParams;switch(input.semantic){case"VERTEX":vs.push(index);break;case"NORMAL":ns.push(getConvertedVec3(source.data,idx32));break;case"TEXCOORD":ts=ts||{};if(ts[input.set]===undefined)ts[input.set]=[];ts[input.set].push(new THREE.Vector2(source.data[idx32],source.data[idx32+1]));break;case"COLOR":cs.push((new THREE.Color).setRGB(source.data[idx32],source.data[idx32+1],source.data[idx32+2]));break;default:break}}}if(ns.length===0){input=this.vertices.input.NORMAL;if(input){source=sources[input.source];numParams=source.accessor.params.length;for(var ndx=0,len=vs.length;ndx<len;ndx++){ns.push(getConvertedVec3(source.data,vs[ndx]*numParams))}}else{geom.calcNormals=true}}if(!ts){ts={};input=this.vertices.input.TEXCOORD;if(input){texture_sets.push(input.set);source=sources[input.source];numParams=source.accessor.params.length;for(var ndx=0,len=vs.length;ndx<len;ndx++){idx32=vs[ndx]*numParams;if(ts[input.set]===undefined)ts[input.set]=[];ts[input.set].push(new THREE.Vector2(source.data[idx32],1-source.data[idx32+1]))}}}if(cs.length===0){input=this.vertices.input.COLOR;if(input){source=sources[input.source];numParams=source.accessor.params.length;for(var ndx=0,len=vs.length;ndx<len;ndx++){idx32=vs[ndx]*numParams;cs.push((new THREE.Color).setRGB(source.data[idx32],source.data[idx32+1],source.data[idx32+2]))}}}var face=null,faces=[],uv,uvArr;if(vcount===3){faces.push(new THREE.Face3(vs[0],vs[1],vs[2],ns,cs.length?cs:new THREE.Color))}else if(vcount===4){faces.push(new THREE.Face3(vs[0],vs[1],vs[3],[ns[0].clone(),ns[1].clone(),ns[3].clone()],cs.length?[cs[0],cs[1],cs[3]]:new THREE.Color));faces.push(new THREE.Face3(vs[1],vs[2],vs[3],[ns[1].clone(),ns[2].clone(),ns[3].clone()],cs.length?[cs[1],cs[2],cs[3]]:new THREE.Color))}else if(vcount>4&&options.subdivideFaces){var clr=cs.length?cs:new THREE.Color,vec1,vec2,vec3,v1,v2,norm;for(k=1;k<vcount-1;){faces.push(new THREE.Face3(vs[0],vs[k],vs[k+1],[ns[0].clone(),ns[k++].clone(),ns[k].clone()],clr))}}if(faces.length){for(var ndx=0,len=faces.length;ndx<len;ndx++){face=faces[ndx];face.daeMaterial=primitive.material;geom.faces.push(face);for(k=0;k<texture_sets.length;k++){uv=ts[texture_sets[k]];if(vcount>4){uvArr=[uv[0],uv[ndx+1],uv[ndx+2]]}else if(vcount===4){if(ndx===0){uvArr=[uv[0],uv[1],uv[3]]}else{uvArr=[uv[1].clone(),uv[2],uv[3].clone()]}}else{uvArr=[uv[0],uv[1],uv[2]]}if(geom.faceVertexUvs[k]===undefined){geom.faceVertexUvs[k]=[]}geom.faceVertexUvs[k].push(uvArr)}}}else{console.log("dropped face with vcount "+vcount+" for geometry with id: "+geom.id)}i+=maxOffset*vcount}}};function Polygons(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry}Polygons.prototype.setVertices=function(vertices){for(var i=0;i<this.inputs.length;i++){if(this.inputs[i].source===vertices.id){this.inputs[i].source=vertices.input["POSITION"].source}}};Polygons.prototype.parse=function(element){this.material=element.getAttribute("material");this.count=_attr_as_int(element,"count",0);for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"input":this.inputs.push((new Input).parse(element.childNodes[i]));break;case"vcount":this.vcount=_ints(child.textContent);break;case"p":this.p.push(_ints(child.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function Polylist(){Polygons.call(this);this.vcount=[]}Polylist.prototype=Object.create(Polygons.prototype);Polylist.prototype.constructor=Polylist;function LineStrips(){Polygons.call(this);this.vcount=1}LineStrips.prototype=Object.create(Polygons.prototype);LineStrips.prototype.constructor=LineStrips;function Triangles(){Polygons.call(this);this.vcount=3}Triangles.prototype=Object.create(Polygons.prototype);Triangles.prototype.constructor=Triangles;function Accessor(){this.source="";this.count=0;this.stride=0;this.params=[]}Accessor.prototype.parse=function(element){this.params=[];this.source=element.getAttribute("source");this.count=_attr_as_int(element,"count",0);this.stride=_attr_as_int(element,"stride",0);for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeName==="param"){var param={};param["name"]=child.getAttribute("name");param["type"]=child.getAttribute("type");this.params.push(param)}}return this};function Vertices(){this.input={}}Vertices.prototype.parse=function(element){this.id=element.getAttribute("id");for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].nodeName==="input"){var input=(new Input).parse(element.childNodes[i]);this.input[input.semantic]=input}}return this};function Input(){this.semantic="";this.offset=0;this.source="";this.set=0}Input.prototype.parse=function(element){this.semantic=element.getAttribute("semantic");this.source=element.getAttribute("source").replace(/^#/,"");this.set=_attr_as_int(element,"set",-1);this.offset=_attr_as_int(element,"offset",0);if(this.semantic==="TEXCOORD"&&this.set<0){this.set=0}return this};function Source(id){this.id=id;this.type=null}Source.prototype.parse=function(element){this.id=element.getAttribute("id");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"bool_array":this.data=_bools(child.textContent);this.type=child.nodeName;break;case"float_array":this.data=_floats(child.textContent);this.type=child.nodeName;break;case"int_array":this.data=_ints(child.textContent);this.type=child.nodeName;break;case"IDREF_array":case"Name_array":this.data=_strings(child.textContent);this.type=child.nodeName;break;case"technique_common":for(var j=0;j<child.childNodes.length;j++){if(child.childNodes[j].nodeName==="accessor"){this.accessor=(new Accessor).parse(child.childNodes[j]);break}}break;default:break}}return this};Source.prototype.read=function(){var result=[];var param=this.accessor.params[0];switch(param.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var j=0;j<this.data.length;j+=16){var s=this.data.slice(j,j+16);var m=getConvertedMat4(s);result.push(m)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+param.type+".");break}return result};function Material(){this.id="";this.name="";this.instance_effect=null}Material.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].nodeName==="instance_effect"){this.instance_effect=(new InstanceEffect).parse(element.childNodes[i]);break}}return this};function ColorOrTexture(){this.color=new THREE.Color;this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texture=null;this.texcoord=null;this.texOpts=null}ColorOrTexture.prototype.isColor=function(){return this.texture===null};ColorOrTexture.prototype.isTexture=function(){return this.texture!=null};ColorOrTexture.prototype.parse=function(element){if(element.nodeName==="transparent"){this.opaque=element.getAttribute("opaque")}for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"color":var rgba=_floats(child.textContent);this.color=new THREE.Color;this.color.setRGB(rgba[0],rgba[1],rgba[2]);this.color.a=rgba[3];break;case"texture":this.texture=child.getAttribute("texture");this.texcoord=child.getAttribute("texcoord");this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1};this.parseTexture(child);break;default:break}}return this};ColorOrTexture.prototype.parseTexture=function(element){if(!element.childNodes)return this;if(element.childNodes[1]&&element.childNodes[1].nodeName==="extra"){element=element.childNodes[1];if(element.childNodes[1]&&element.childNodes[1].nodeName==="technique"){element=element.childNodes[1]}}for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[child.nodeName]=parseFloat(child.textContent);break;case"wrapU":case"wrapV":if(child.textContent.toUpperCase()==="TRUE"){this.texOpts[child.nodeName]=1}else{this.texOpts[child.nodeName]=parseInt(child.textContent)}break;default:this.texOpts[child.nodeName]=child.textContent;break}}return this};function Shader(type,effect){this.type=type;this.effect=effect;this.material=null}Shader.prototype.parse=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[child.nodeName]=(new ColorOrTexture).parse(child);break;case"bump":var bumpType=child.getAttribute("bumptype");if(bumpType){if(bumpType.toLowerCase()==="heightfield"){this["bump"]=(new ColorOrTexture).parse(child)}else if(bumpType.toLowerCase()==="normalmap"){this["normal"]=(new ColorOrTexture).parse(child)}else{console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+bumpType+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'");this["bump"]=(new ColorOrTexture).parse(child)}}else{console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'");this["bump"]=(new ColorOrTexture).parse(child)}break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var f=child.querySelectorAll("float");if(f.length>0)this[child.nodeName]=parseFloat(f[0].textContent);break;default:break}}this.create();return this};Shader.prototype.create=function(){var props={};var transparent=false;if(this["transparency"]!==undefined&&this["transparent"]!==undefined){var transparentColor=this["transparent"];var transparencyLevel=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;if(transparencyLevel>0){transparent=true;props["transparent"]=true;props["opacity"]=1-transparencyLevel}}var keys={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var prop in this){switch(prop){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var cot=this[prop];if(cot instanceof ColorOrTexture){if(cot.isTexture()){var samplerId=cot.texture;var surfaceId=this.effect.sampler[samplerId];if(surfaceId!==undefined&&surfaceId.source!==undefined){var surface=this.effect.surface[surfaceId.source];if(surface!==undefined){var image=images[surface.init_from];if(image){var url=baseUrl+image.init_from;var texture;var loader=THREE.Loader.Handlers.get(url);if(loader!==null){texture=loader.load(url)}else{texture=new THREE.Texture;loadTextureImage(texture,url)}texture.wrapS=cot.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;texture.wrapT=cot.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;texture.offset.x=cot.texOpts.offsetU;texture.offset.y=cot.texOpts.offsetV;texture.repeat.x=cot.texOpts.repeatU;texture.repeat.y=cot.texOpts.repeatV;props[keys[prop]]=texture;if(prop==="emission")props["emissive"]=16777215}}}}else if(prop==="diffuse"||!transparent){if(prop==="emission"){props["emissive"]=cot.color.getHex()}else{props[prop]=cot.color.getHex()}}}break;case"shininess":props[prop]=this[prop];break;case"reflectivity":props[prop]=this[prop];if(props[prop]>0)props["envMap"]=options.defaultEnvMap;props["combine"]=THREE.MixOperation;break;case"index_of_refraction":props["refractionRatio"]=this[prop];if(this[prop]!==1)props["envMap"]=options.defaultEnvMap;break;case"transparency":break;default:break}}props["shading"]=preferredShading;props["side"]=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;switch(this.type){case"constant":if(props.emissive!=undefined)props.color=props.emissive;this.material=new THREE.MeshBasicMaterial(props);break;case"phong":case"blinn":if(props.diffuse!=undefined)props.color=props.diffuse;this.material=new THREE.MeshPhongMaterial(props);break;case"lambert":default:if(props.diffuse!=undefined)props.color=props.diffuse;this.material=new THREE.MeshLambertMaterial(props);break}return this.material};function Surface(effect){this.effect=effect;this.init_from=null;this.format=null}Surface.prototype.parse=function(element){
for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"init_from":this.init_from=child.textContent;break;case"format":this.format=child.textContent;break;default:console.log("unhandled Surface prop: "+child.nodeName);break}}return this};function Sampler2D(effect){this.effect=effect;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null}Sampler2D.prototype.parse=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"source":this.source=child.textContent;break;case"minfilter":this.minfilter=child.textContent;break;case"magfilter":this.magfilter=child.textContent;break;case"mipfilter":this.mipfilter=child.textContent;break;case"wrap_s":this.wrap_s=child.textContent;break;case"wrap_t":this.wrap_t=child.textContent;break;default:console.log("unhandled Sampler2D prop: "+child.nodeName);break}}return this};function Effect(){this.id="";this.name="";this.shader=null;this.surface={};this.sampler={}}Effect.prototype.create=function(){if(this.shader===null){return null}};Effect.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");extractDoubleSided(this,element);this.shader=null;for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(child));break;default:break}}return this};Effect.prototype.parseNewparam=function(element){var sid=element.getAttribute("sid");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"surface":this.surface[sid]=new Surface(this).parse(child);break;case"sampler2D":this.sampler[sid]=new Sampler2D(this).parse(child);break;case"extra":break;default:console.log(child.nodeName);break}}};Effect.prototype.parseProfileCOMMON=function(element){var technique;for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"profile_COMMON":this.parseProfileCOMMON(child);break;case"technique":technique=child;break;case"newparam":this.parseNewparam(child);break;case"image":var _image=(new _Image).parse(child);images[_image.id]=_image;break;case"extra":break;default:console.log(child.nodeName);break}}return technique};Effect.prototype.parseTechnique=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new Shader(child.nodeName,this).parse(child);break;case"extra":this.parseExtra(child);break;default:break}}};Effect.prototype.parseExtra=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"technique":this.parseExtraTechnique(child);break;default:break}}};Effect.prototype.parseExtraTechnique=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"bump":this.shader.parse(element);break;default:break}}};function InstanceEffect(){this.url=""}InstanceEffect.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,"");return this};function Animation(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[]}Animation.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");this.source={};for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"animation":var anim=(new Animation).parse(child);for(var src in anim.source){this.source[src]=anim.source[src]}for(var j=0;j<anim.channel.length;j++){this.channel.push(anim.channel[j]);this.sampler.push(anim.sampler[j])}break;case"source":var src=(new Source).parse(child);this.source[src.id]=src;break;case"sampler":this.sampler.push(new Sampler(this).parse(child));break;case"channel":this.channel.push(new Channel(this).parse(child));break;default:break}}return this};function Channel(animation){this.animation=animation;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null}Channel.prototype.parse=function(element){this.source=element.getAttribute("source").replace(/^#/,"");this.target=element.getAttribute("target");var parts=this.target.split("/");var id=parts.shift();var sid=parts.shift();var dotSyntax=sid.indexOf(".")>=0;var arrSyntax=sid.indexOf("(")>=0;if(dotSyntax){parts=sid.split(".");this.sid=parts.shift();this.member=parts.shift()}else if(arrSyntax){var arrIndices=sid.split("(");this.sid=arrIndices.shift();for(var j=0;j<arrIndices.length;j++){arrIndices[j]=parseInt(arrIndices[j].replace(/\)/,""))}this.arrIndices=arrIndices}else{this.sid=sid}this.fullSid=sid;this.dotSyntax=dotSyntax;this.arrSyntax=arrSyntax;return this};function Sampler(animation){this.id="";this.animation=animation;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0}Sampler.prototype.parse=function(element){this.id=element.getAttribute("id");this.inputs=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"input":this.inputs.push((new Input).parse(child));break;default:break}}return this};Sampler.prototype.create=function(){for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i];var source=this.animation.source[input.source];switch(input.semantic){case"INPUT":this.input=source.read();break;case"OUTPUT":this.output=source.read();this.strideOut=source.accessor.stride;break;case"INTERPOLATION":this.interpolation=source.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(input.semantic);break}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=1e8;this.endTime=-1e8;for(var i=0;i<this.input.length;i++){this.startTime=Math.min(this.startTime,this.input[i]);this.endTime=Math.max(this.endTime,this.input[i])}this.duration=this.endTime-this.startTime}};Sampler.prototype.getData=function(type,ndx,member){var data;if(type==="matrix"&&this.strideOut===16){data=this.output[ndx]}else if(this.strideOut>1){data=[];ndx*=this.strideOut;for(var i=0;i<this.strideOut;++i){data[i]=this.output[ndx+i]}if(this.strideOut===3){switch(type){case"rotate":case"translate":fixCoords(data,-1);break;case"scale":fixCoords(data,1);break}}else if(this.strideOut===4&&type==="matrix"){fixCoords(data,-1)}}else{data=this.output[ndx];if(member&&type==="translate"){data=getConvertedTranslation(member,data)}}return data};function Key(time){this.targets=[];this.time=time}Key.prototype.addTarget=function(fullSid,transform,member,data){this.targets.push({sid:fullSid,member:member,transform:transform,data:data})};Key.prototype.apply=function(opt_sid){for(var i=0;i<this.targets.length;++i){var target=this.targets[i];if(!opt_sid||target.sid===opt_sid){target.transform.update(target.data,target.member)}}};Key.prototype.getTarget=function(fullSid){for(var i=0;i<this.targets.length;++i){if(this.targets[i].sid===fullSid){return this.targets[i]}}return null};Key.prototype.hasTarget=function(fullSid){for(var i=0;i<this.targets.length;++i){if(this.targets[i].sid===fullSid){return true}}return false};Key.prototype.interpolate=function(nextKey,time){for(var i=0,l=this.targets.length;i<l;i++){var target=this.targets[i],nextTarget=nextKey.getTarget(target.sid),data;if(target.transform.type!=="matrix"&&nextTarget){var scale=(time-this.time)/(nextKey.time-this.time),nextData=nextTarget.data,prevData=target.data;if(scale<0)scale=0;if(scale>1)scale=1;if(prevData.length){data=[];for(var j=0;j<prevData.length;++j){data[j]=prevData[j]+(nextData[j]-prevData[j])*scale}}else{data=prevData+(nextData-prevData)*scale}}else{data=target.data}target.transform.update(data,target.member)}};function Camera(){this.id="";this.name="";this.technique=""}Camera.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"optics":this.parseOptics(child);break;default:break}}return this};Camera.prototype.parseOptics=function(element){for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].nodeName==="technique_common"){var technique=element.childNodes[i];for(var j=0;j<technique.childNodes.length;j++){this.technique=technique.childNodes[j].nodeName;if(this.technique==="perspective"){var perspective=technique.childNodes[j];for(var k=0;k<perspective.childNodes.length;k++){var param=perspective.childNodes[k];switch(param.nodeName){case"yfov":this.yfov=param.textContent;break;case"xfov":this.xfov=param.textContent;break;case"znear":this.znear=param.textContent;break;case"zfar":this.zfar=param.textContent;break;case"aspect_ratio":this.aspect_ratio=param.textContent;break}}}else if(this.technique==="orthographic"){var orthographic=technique.childNodes[j];for(var k=0;k<orthographic.childNodes.length;k++){var param=orthographic.childNodes[k];switch(param.nodeName){case"xmag":this.xmag=param.textContent;break;case"ymag":this.ymag=param.textContent;break;case"znear":this.znear=param.textContent;break;case"zfar":this.zfar=param.textContent;break;case"aspect_ratio":this.aspect_ratio=param.textContent;break}}}}}}return this};function InstanceCamera(){this.url=""}InstanceCamera.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,"");return this};function Light(){this.id="";this.name="";this.technique=""}Light.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"technique_common":this.parseCommon(child);break;case"technique":this.parseTechnique(child);break;default:break}}return this};Light.prototype.parseCommon=function(element){for(var i=0;i<element.childNodes.length;i++){switch(element.childNodes[i].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=element.childNodes[i].nodeName;var light=element.childNodes[i];for(var j=0;j<light.childNodes.length;j++){var child=light.childNodes[j];switch(child.nodeName){case"color":var rgba=_floats(child.textContent);this.color=new THREE.Color(0);this.color.setRGB(rgba[0],rgba[1],rgba[2]);this.color.a=rgba[3];break;case"falloff_angle":this.falloff_angle=parseFloat(child.textContent);break;case"quadratic_attenuation":var f=parseFloat(child.textContent);this.distance=f?Math.sqrt(1/f):0}}}}return this};Light.prototype.parseTechnique=function(element){this.profile=element.getAttribute("profile");for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];switch(child.nodeName){case"intensity":this.intensity=parseFloat(child.textContent);break}}return this};function InstanceLight(){this.url=""}InstanceLight.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,"");return this};function KinematicsModel(){this.id="";this.name="";this.joints=[];this.links=[]}KinematicsModel.prototype.parse=function(element){this.id=element.getAttribute("id");this.name=element.getAttribute("name");this.joints=[];this.links=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"technique_common":this.parseCommon(child);break;default:break}}return this};KinematicsModel.prototype.parseCommon=function(element){for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(element.childNodes[i].nodeName){case"joint":this.joints.push((new Joint).parse(child));break;case"link":this.links.push((new Link).parse(child));break;default:break}}return this};function Joint(){this.sid="";this.name="";this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this.static=false;this.zeroPosition=0;this.middlePosition=0}Joint.prototype.parse=function(element){this.sid=element.getAttribute("sid");this.name=element.getAttribute("name");this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this.static=false;this.zeroPosition=0;this.middlePosition=0;var axisElement=element.querySelector("axis");var _axis=_floats(axisElement.textContent);this.axis=getConvertedVec3(_axis,0);var min=element.querySelector("limits min")?parseFloat(element.querySelector("limits min").textContent):-360;var max=element.querySelector("limits max")?parseFloat(element.querySelector("limits max").textContent):360;this.limits={min:min,max:max};var jointTypes=["prismatic","revolute"];for(var i=0;i<jointTypes.length;i++){var type=jointTypes[i];var jointElement=element.querySelector(type);if(jointElement){this.type=type}}if(this.limits.min>=this.limits.max){this.static=true}this.middlePosition=(this.limits.min+this.limits.max)/2;return this};function Link(){this.sid="";this.name="";this.transforms=[];this.attachments=[]}Link.prototype.parse=function(element){this.sid=element.getAttribute("sid");this.name=element.getAttribute("name");this.transforms=[];this.attachments=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"attachment_full":this.attachments.push((new Attachment).parse(child));break;case"rotate":case"translate":case"matrix":this.transforms.push((new Transform).parse(child));break;default:break}}return this};function Attachment(){this.joint="";this.transforms=[];this.links=[]}Attachment.prototype.parse=function(element){this.joint=element.getAttribute("joint").split("/").pop();this.links=[];for(var i=0;i<element.childNodes.length;i++){var child=element.childNodes[i];if(child.nodeType!=1)continue;switch(child.nodeName){case"link":this.links.push((new Link).parse(child));break;case"rotate":case"translate":case"matrix":this.transforms.push((new Transform).parse(child));break;default:break}}return this};function _source(element){var id=element.getAttribute("id");if(sources[id]!=undefined){return sources[id]}sources[id]=new Source(id).parse(element);return sources[id]}function _nsResolver(nsPrefix){if(nsPrefix==="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function _bools(str){var raw=_strings(str);var data=[];for(var i=0,l=raw.length;i<l;i++){data.push(raw[i]==="true"||raw[i]==="1"?true:false)}return data}function _floats(str){var raw=_strings(str);var data=[];for(var i=0,l=raw.length;i<l;i++){data.push(parseFloat(raw[i]))}return data}function _ints(str){var raw=_strings(str);var data=[];for(var i=0,l=raw.length;i<l;i++){data.push(parseInt(raw[i],10))}return data}function _strings(str){return str.length>0?_trimString(str).split(/\s+/):[]}function _trimString(str){return str.replace(/^\s+/,"").replace(/\s+$/,"")}function _attr_as_float(element,name,defaultValue){if(element.hasAttribute(name)){return parseFloat(element.getAttribute(name))}else{return defaultValue}}function _attr_as_int(element,name,defaultValue){if(element.hasAttribute(name)){return parseInt(element.getAttribute(name),10)}else{return defaultValue}}function _attr_as_string(element,name,defaultValue){if(element.hasAttribute(name)){return element.getAttribute(name)}else{return defaultValue}}function _format_float(f,num){if(f===undefined){var s="0.";while(s.length<num+2){s+="0"}return s}num=num||2;var parts=f.toString().split(".");parts[1]=parts.length>1?parts[1].substr(0,num):"0";while(parts[1].length<num){parts[1]+="0"}return parts.join(".")}function loadTextureImage(texture,url){loader=new THREE.ImageLoader;loader.load(url,function(image){texture.image=image;texture.needsUpdate=true})}function extractDoubleSided(obj,element){obj.doubleSided=false;var node=element.querySelectorAll("extra double_sided")[0];if(node){if(node&&parseInt(node.textContent,10)===1){obj.doubleSided=true}}}function setUpConversion(){if(options.convertUpAxis!==true||colladaUp===options.upAxis){upConversion=null}else{switch(colladaUp){case"X":upConversion=options.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":upConversion=options.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":upConversion=options.upAxis==="X"?"ZtoX":"ZtoY";break}}}function fixCoords(data,sign){if(options.convertUpAxis!==true||colladaUp===options.upAxis){return}switch(upConversion){case"XtoY":var tmp=data[0];data[0]=sign*data[1];data[1]=tmp;break;case"XtoZ":var tmp=data[2];data[2]=data[1];data[1]=data[0];data[0]=tmp;break;case"YtoX":var tmp=data[0];data[0]=data[1];data[1]=sign*tmp;break;case"YtoZ":var tmp=data[1];data[1]=sign*data[2];data[2]=tmp;break;case"ZtoX":var tmp=data[0];data[0]=data[1];data[1]=data[2];data[2]=tmp;break;case"ZtoY":var tmp=data[1];data[1]=data[2];data[2]=sign*tmp;break}}function getConvertedTranslation(axis,data){if(options.convertUpAxis!==true||colladaUp===options.upAxis){return data}switch(axis){case"X":data=upConversion==="XtoY"?data*-1:data;break;case"Y":data=upConversion==="YtoZ"||upConversion==="YtoX"?data*-1:data;break;case"Z":data=upConversion==="ZtoY"?data*-1:data;break;default:break}return data}function getConvertedVec3(data,offset){var arr=[data[offset],data[offset+1],data[offset+2]];fixCoords(arr,-1);return new THREE.Vector3(arr[0],arr[1],arr[2])}function getConvertedMat4(data){if(options.convertUpAxis){var arr=[data[0],data[4],data[8]];fixCoords(arr,-1);data[0]=arr[0];data[4]=arr[1];data[8]=arr[2];arr=[data[1],data[5],data[9]];fixCoords(arr,-1);data[1]=arr[0];data[5]=arr[1];data[9]=arr[2];arr=[data[2],data[6],data[10]];fixCoords(arr,-1);data[2]=arr[0];data[6]=arr[1];data[10]=arr[2];arr=[data[0],data[1],data[2]];fixCoords(arr,-1);data[0]=arr[0];data[1]=arr[1];data[2]=arr[2];arr=[data[4],data[5],data[6]];fixCoords(arr,-1);data[4]=arr[0];data[5]=arr[1];data[6]=arr[2];arr=[data[8],data[9],data[10]];fixCoords(arr,-1);data[8]=arr[0];data[9]=arr[1];data[10]=arr[2];arr=[data[3],data[7],data[11]];fixCoords(arr,-1);data[3]=arr[0];data[7]=arr[1];data[11]=arr[2]}return(new THREE.Matrix4).set(data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],data[8],data[9],data[10],data[11],data[12],data[13],data[14],data[15])}function getConvertedIndex(index){if(index>-1&&index<3){var members=["X","Y","Z"],indices={X:0,Y:1,Z:2};index=getConvertedMember(members[index]);index=indices[index]}return index}function getConvertedMember(member){if(options.convertUpAxis){switch(member){case"X":switch(upConversion){case"XtoY":case"XtoZ":case"YtoX":member="Y";break;case"ZtoX":member="Z";break}break;case"Y":switch(upConversion){case"XtoY":case"YtoX":case"ZtoX":member="X";break;case"XtoZ":case"YtoZ":case"ZtoY":member="Z";break}break;case"Z":switch(upConversion){case"XtoZ":member="X";break;case"YtoZ":case"ZtoX":case"ZtoY":member="Y";break}break}}return member}return{load:load,parse:parse,setPreferredShading:setPreferredShading,applySkin:applySkin,geometries:geometries,options:options}};this.createjs=this.createjs||{},createjs.extend=function(a,b){"use strict";function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c},this.createjs=this.createjs||{},createjs.promote=function(a,b){"use strict";var c=a.prototype,d=Object.getPrototypeOf&&Object.getPrototypeOf(c)||c.__proto__;if(d){c[(b+="_")+"constructor"]=d.constructor;for(var e in d)c.hasOwnProperty(e)&&"function"==typeof d[e]&&(c[b+e]=d[e])}return a},this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!b,this.cancelable=!!c,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var b=a.prototype;b.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._listeners=null,this._captureListeners=null}var b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a){if("string"==typeof a){var b=this._listeners;if(!b||!b[a])return!1;a=new createjs.Event(a)}else a.target&&a.clone&&(a=a.clone());try{a.target=this}catch(c){}if(a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;try{a.currentTarget=this}catch(f){}try{a.eventPhase=b}catch(f){}a.removed=!1,e=e.slice();for(var g=0;c>g&&!a.immediatePropagationStopped;g++){var h=e[g];h.handleEvent?h.handleEvent(a):h(a),a.removed&&(this.off(a.type,h,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ticker cannot be instantiated."}a.RAF_SYNCHED="synched",a.RAF="raf",a.TIMEOUT="timeout",a.useRAF=!1,a.timingMode=null,a.maxDelta=0,a.paused=!1,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._addEventListener=a.addEventListener,a.addEventListener=function(){return!a._inited&&a.init(),a._addEventListener.apply(a,arguments)},a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._timerId=null,a._raf=!0,a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval};try{Object.defineProperties(a,{interval:{get:a.getInterval,set:a.setInterval},framerate:{get:a.getFPS,set:a.setFPS}})}catch(b){console.log(b)}a.init=function(){a._inited||(a._inited=!0,a._times=[],a._tickTimes=[],a._startTime=a._getTime(),a._times.push(a._lastTime=0),a.interval=a._interval)},a.reset=function(){if(a._raf){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b&&b(a._timerId)}else clearTimeout(a._timerId);a.removeAllEventListeners("tick"),a._timerId=a._times=a._tickTimes=null,a._startTime=a._lastTime=a._ticks=0,a._inited=!1},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(!d||d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){var c=a._times;return!c||c.length<2?-1:(b=Math.min(c.length-1,b||0|a.getFPS()),1e3/((c[0]-c[b])/b))},a.setPaused=function(b){a.paused=b},a.getPaused=function(){return a.paused},a.getTime=function(b){return a._startTime?a._getTime()-(b?a._pausedTime:0):-1},a.getEventTime=function(b){return a._startTime?(a._lastTime||a._startTime)-(b?a._pausedTime:0):-1},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleSynch=function(){a._timerId=null,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleRAF=function(){a._timerId=null,a._setupTick(),a._tick()},a._handleTimeout=function(){a._timerId=null,a._setupTick(),a._tick()},a._setupTick=function(){if(null==a._timerId){var b=a.timingMode||a.useRAF&&a.RAF_SYNCHED;if(b==a.RAF_SYNCHED||b==a.RAF){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(c)return a._timerId=c(b==a.RAF?a._handleRAF:a._handleSynch),void(a._raf=!0)}a._raf=!1,a._timerId=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a.paused,c=a._getTime(),d=c-a._lastTime;if(a._lastTime=c,a._ticks++,b&&(a._pausedTicks++,a._pausedTime+=d),a.hasEventListener("tick")){var e=new createjs.Event("tick"),f=a.maxDelta;e.delta=f&&d>f?f:d,e.paused=b,e.time=c,e.runTime=c-a._pausedTime,a.dispatchEvent(e)}for(a._tickTimes.unshift(a._getTime()-c);a._tickTimes.length>100;)a._tickTimes.pop();for(a._times.unshift(c);a._times.length>100;)a._times.pop()};var c=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return(c&&c.call(performance)||(new Date).getTime())-a._startTime},createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d){this.ignoreGlobalPause=!1,this.loop=!1,this.duration=0,this.pluginData=d||{},this.target=b,this.position=null,this.passive=!1,this._paused=!1,this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],this._prevPosition=0,this._stepPosition=0,this._prevPos=-1,this._target=b,this._useTicks=!1,this._inited=!1,c&&(this._useTicks=c.useTicks,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,c.onChange&&this.addEventListener("change",c.onChange),c.override&&a.removeTweens(b)),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,a.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);a.NONE=0,a.LOOP=1,a.REVERSE=2,a.IGNORE={},a._tweens=[],a._plugins={},a.get=function(b,c,d,e){return e&&a.removeTweens(b),new a(b,c,d)},a.tick=function(b,c){for(var d=a._tweens.slice(),e=d.length-1;e>=0;e--){var f=d[e];c&&!f.ignoreGlobalPause||f._paused||f.tick(f._useTicks?1:b)}},a.handleEvent=function(a){"tick"==a.type&&this.tick(a.delta,a.paused)},a.removeTweens=function(b){if(b.tweenjs_count){for(var c=a._tweens,d=c.length-1;d>=0;d--){var e=c[d];e._target==b&&(e._paused=!0,c.splice(d,1))}b.tweenjs_count=0}},a.removeAllTweens=function(){for(var b=a._tweens,c=0,d=b.length;d>c;c++){var e=b[c];e._paused=!0,e.target.tweenjs_count=0}b.length=0},a.hasActiveTweens=function(b){return b?b.tweenjs_count:a._tweens&&!!a._tweens.length},a.installPlugin=function(b,c){var d=b.priority;null==d&&(b.priority=d=0);for(var e=0,f=c.length,g=a._plugins;f>e;e++){var h=c[e];if(g[h]){for(var i=g[h],j=0,k=i.length;k>j&&!(d<i[j].priority);j++);g[h].splice(j,0,b)}else g[h]=[b]}},a._register=function(b,c){var d=b._target,e=a._tweens;if(c)d&&(d.tweenjs_count=d.tweenjs_count?d.tweenjs_count+1:1),e.push(b),!a._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",a),a._inited=!0);else{d&&d.tweenjs_count--;for(var f=e.length;f--;)if(e[f]==b)return void e.splice(f,1)}},b.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:this._linearEase,p1:c,v:b})},b.to=function(a,b,c){return(isNaN(b)||0>b)&&(b=0),this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})},b.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})},b.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})},b.play=function(a){return a||(a=this),this.call(a.setPaused,[!1],a)},b.pause=function(a){return a||(a=this),this.call(a.setPaused,[!0],a)},b.setPosition=function(a,b){0>a&&(a=0),null==b&&(b=1);var c=a,d=!1;if(c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0)),c==this._prevPos)return d;var e=this._prevPos;if(this.position=this._prevPos=c,this._prevPosition=a,this._target)if(d)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var f=0,g=this._steps.length;g>f&&!(this._steps[f].t>c);f++);var h=this._steps[f-1];this._updateTargetProps(h,(this._stepPosition=c-h.t)/h.d)}return 0!=b&&this._actions.length>0&&(this._useTicks?this._runActions(c,c):1==b&&e>c?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c)),d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)},b.setPaused=function(b){return this._paused===!!b?this:(this._paused=!!b,a._register(this,!b),this)},b.w=b.wait,b.t=b.to,b.c=b.call,b.s=b.set,b.toString=function(){return"[Tween]"},b.clone=function(){throw"Tween can not be cloned."},b._updateTargetProps=function(b,c){var d,e,f,g,h,i;if(b||1!=c){if(this.passive=!!b.v,this.passive)return;b.e&&(c=b.e(c,0,1,1)),d=b.p0,e=b.p1}else this.passive=!1,d=e=this._curQueueProps;for(var j in this._initQueueProps){null==(g=d[j])&&(d[j]=g=this._initQueueProps[j]),null==(h=e[j])&&(e[j]=h=g),f=g==h||0==c||1==c||"number"!=typeof g?1==c?h:g:g+(h-g)*c;var k=!1;if(i=a._plugins[j])for(var l=0,m=i.length;m>l;l++){var n=i[l].tween(this,j,f,d,e,c,!!b&&d==e,!b);n==a.IGNORE?k=!0:f=n}k||(this._target[j]=f)}},b._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;for(a>b&&(d=b,e=a,f=g,g=h=-1);(f+=h)!=g;){var i=this._actions[f],j=i.t;(j==e||j>d&&e>j||c&&j==a)&&i.f.apply(i.o,i.p)}},b._appendQueueProps=function(b){var c,d,e,f,g;for(var h in b)if(void 0===this._initQueueProps[h]){if(d=this._target[h],c=a._plugins[h])for(e=0,f=c.length;f>e;e++)d=c[e].init(this,h,d);this._initQueueProps[h]=this._curQueueProps[h]=void 0===d?null:d}else d=this._curQueueProps[h];for(var h in b){if(d=this._curQueueProps[h],c=a._plugins[h])for(g=g||{},e=0,f=c.length;f>e;e++)c[e].step&&c[e].step(this,h,d,b[h],g);this._curQueueProps[h]=b[h]}return g&&this._appendQueueProps(g),this._curQueueProps},b._cloneProps=function(a){var b={};for(var c in a)b[c]=a[c];return b},b._addStep=function(a){return a.d>0&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d),this},b._addAction=function(a){return a.t=this.duration,this._actions.push(a),this},b._set=function(a,b){for(var c in a)b[c]=a[c]},createjs.Tween=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.ignoreGlobalPause=!1,this.duration=0,this.loop=!1,this.position=null,this._paused=!1,this._tweens=[],this._labels=null,this._labelList=null,this._prevPosition=0,this._prevPos=-1,this._useTicks=!1,
c&&(this._useTicks=c.useTicks,this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,c.onChange&&this.addEventListener("change",c.onChange)),a&&this.addTween.apply(this,a),this.setLabels(b),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,createjs.Tween.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);b.addTween=function(a){var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addTween(arguments[c]);return arguments[0]}return 0==b?null:(this.removeTween(a),this._tweens.push(a),a.setPaused(!0),a._paused=!1,a._useTicks=this._useTicks,a.duration>this.duration&&(this.duration=a.duration),this._prevPos>=0&&a.setPosition(this._prevPos,createjs.Tween.NONE),a)},b.removeTween=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;for(var e=this._tweens,d=e.length;d--;)if(e[d]==a)return e.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1},b.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;e>d&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}},b.setLabels=function(a){this._labels=a?a:{}},b.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels;for(var c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a},b.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;c>d&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null},b.gotoAndPlay=function(a){this.setPaused(!1),this._goto(a)},b.gotoAndStop=function(a){this.setPaused(!0),this._goto(a)},b.setPosition=function(a,b){0>a&&(a=0);var c=this.loop?a%this.duration:a,d=!this.loop&&a>=this.duration;if(c==this._prevPos)return d;this._prevPosition=a,this.position=this._prevPos=c;for(var e=0,f=this._tweens.length;f>e;e++)if(this._tweens[e].setPosition(c,b),c!=this._prevPos)return!1;return d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.setPaused=function(a){this._paused=!!a,createjs.Tween._register(this,!a)},b.updateDuration=function(){this.duration=0;for(var a=0,b=this._tweens.length;b>a;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}},b.tick=function(a){this.setPosition(this._prevPosition+a)},b.resolve=function(a){var b=Number(a);return isNaN(b)&&(b=this._labels[a]),b},b.toString=function(){return"[Timeline]"},b.clone=function(){throw"Timeline can not be cloned."},b._goto=function(a){var b=this.resolve(a);null!=b&&this.setPosition(b)},createjs.Timeline=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ease cannot be instantiated."}a.linear=function(a){return a},a.none=a.linear,a.get=function(a){return-1>a&&(a=-1),a>1&&(a=1),function(b){return 0==a?b:0>a?b*(b*-a+1+a):b*((2-b)*a+(1-a))}},a.getPowIn=function(a){return function(b){return Math.pow(b,a)}},a.getPowOut=function(a){return function(b){return 1-Math.pow(1-b,a)}},a.getPowInOut=function(a){return function(b){return(b*=2)<1?.5*Math.pow(b,a):1-.5*Math.abs(Math.pow(2-b,a))}},a.quadIn=a.getPowIn(2),a.quadOut=a.getPowOut(2),a.quadInOut=a.getPowInOut(2),a.cubicIn=a.getPowIn(3),a.cubicOut=a.getPowOut(3),a.cubicInOut=a.getPowInOut(3),a.quartIn=a.getPowIn(4),a.quartOut=a.getPowOut(4),a.quartInOut=a.getPowInOut(4),a.quintIn=a.getPowIn(5),a.quintOut=a.getPowOut(5),a.quintInOut=a.getPowInOut(5),a.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.sineOut=function(a){return Math.sin(a*Math.PI/2)},a.sineInOut=function(a){return-.5*(Math.cos(Math.PI*a)-1)},a.getBackIn=function(a){return function(b){return b*b*((a+1)*b-a)}},a.backIn=a.getBackIn(1.7),a.getBackOut=function(a){return function(b){return--b*b*((a+1)*b+a)+1}},a.backOut=a.getBackOut(1.7),a.getBackInOut=function(a){return a*=1.525,function(b){return(b*=2)<1?.5*b*b*((a+1)*b-a):.5*((b-=2)*b*((a+1)*b+a)+2)}},a.backInOut=a.getBackInOut(1.7),a.circIn=function(a){return-(Math.sqrt(1-a*a)-1)},a.circOut=function(a){return Math.sqrt(1- --a*a)},a.circInOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.bounceIn=function(b){return 1-a.bounceOut(1-b)},a.bounceOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.bounceInOut=function(b){return.5>b?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5},a.getElasticIn=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b))}},a.elasticIn=a.getElasticIn(1,.3),a.getElasticOut=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*c/b)+1}},a.elasticOut=a.getElasticOut(1,.3),a.getElasticInOut=function(a,b){var c=2*Math.PI;return function(d){var e=b/c*Math.asin(1/a);return(d*=2)<1?-.5*a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b):a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*c/b)*.5+1}},a.elasticInOut=a.getElasticInOut(1,.3*1.5),createjs.Ease=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"MotionGuidePlugin cannot be instantiated."}a.priority=0,a._rotOffS,a._rotOffE,a._rotNormS,a._rotNormE,a.install=function(){return createjs.Tween.installPlugin(a,["guide","x","y","rotation"]),createjs.Tween.IGNORE},a.init=function(a,b,c){var d=a.target;return d.hasOwnProperty("x")||(d.x=0),d.hasOwnProperty("y")||(d.y=0),d.hasOwnProperty("rotation")||(d.rotation=0),"rotation"==b&&(a.__needsRot=!0),"guide"==b?null:c},a.step=function(b,c,d,e,f){if("rotation"==c&&(b.__rotGlobalS=d,b.__rotGlobalE=e,a.testRotData(b,f)),"guide"!=c)return e;var g,h=e;h.hasOwnProperty("path")||(h.path=[]);var i=h.path;if(h.hasOwnProperty("end")||(h.end=1),h.hasOwnProperty("start")||(h.start=d&&d.hasOwnProperty("end")&&d.path===i?d.end:0),h.hasOwnProperty("_segments")&&h._length)return e;var j=i.length,k=10;if(!(j>=6&&(j-2)%4==0))throw"invalid 'path' data, please see documentation for valid paths";h._segments=[],h._length=0;for(var l=2;j>l;l+=4){for(var m,n,o=i[l-2],p=i[l-1],q=i[l+0],r=i[l+1],s=i[l+2],t=i[l+3],u=o,v=p,w=0,x=[],y=1;k>=y;y++){var z=y/k,A=1-z;m=A*A*o+2*A*z*q+z*z*s,n=A*A*p+2*A*z*r+z*z*t,w+=x[x.push(Math.sqrt((g=m-u)*g+(g=n-v)*g))-1],u=m,v=n}h._segments.push(w),h._segments.push(x),h._length+=w}g=h.orient,h.orient=!0;var B={};return a.calc(h,h.start,B),b.__rotPathS=Number(B.rotation.toFixed(5)),a.calc(h,h.end,B),b.__rotPathE=Number(B.rotation.toFixed(5)),h.orient=!1,a.calc(h,h.end,f),h.orient=g,h.orient?(b.__guideData=h,a.testRotData(b,f),e):e},a.testRotData=function(a,b){if(void 0===a.__rotGlobalS||void 0===a.__rotGlobalE){if(a.__needsRot)return;a.__rotGlobalS=a.__rotGlobalE=void 0!==a._curQueueProps.rotation?a._curQueueProps.rotation:b.rotation=a.target.rotation||0}if(void 0!==a.__guideData){var c=a.__guideData,d=a.__rotGlobalE-a.__rotGlobalS,e=a.__rotPathE-a.__rotPathS,f=d-e;if("auto"==c.orient)f>180?f-=360:-180>f&&(f+=360);else if("cw"==c.orient){for(;0>f;)f+=360;0==f&&d>0&&180!=d&&(f+=360)}else if("ccw"==c.orient){for(f=d-(e>180?360-e:e);f>0;)f-=360;0==f&&0>d&&-180!=d&&(f-=360)}c.rotDelta=f,c.rotOffS=a.__rotGlobalS-a.__rotPathS,a.__rotGlobalS=a.__rotGlobalE=a.__guideData=a.__needsRot=void 0}},a.tween=function(b,c,d,e,f,g,h){var i=f.guide;if(void 0==i||i===e.guide)return d;if(i.lastRatio!=g){var j=(i.end-i.start)*(h?i.end:g)+i.start;switch(a.calc(i,j,b.target),i.orient){case"cw":case"ccw":case"auto":b.target.rotation+=i.rotOffS+i.rotDelta*g;break;case"fixed":default:b.target.rotation+=i.rotOffS}i.lastRatio=g}return"rotation"!=c||i.orient&&"false"!=i.orient?b.target[c]:d},a.calc=function(b,c,d){void 0==b._segments&&a.validate(b),void 0==d&&(d={x:0,y:0,rotation:0});for(var e=b._segments,f=b.path,g=b._length*c,h=e.length-2,i=0;g>e[i]&&h>i;)g-=e[i],i+=2;var j=e[i+1],k=0;for(h=j.length-1;g>j[k]&&h>k;)g-=j[k],k++;var l=k/++h+g/(h*j[k]);i=2*i+2;var m=1-l;return d.x=m*m*f[i-2]+2*m*l*f[i+0]+l*l*f[i+2],d.y=m*m*f[i-1]+2*m*l*f[i+1]+l*l*f[i+3],b.orient&&(d.rotation=57.2957795*Math.atan2((f[i+1]-f[i-1])*m+(f[i+3]-f[i+1])*l,(f[i+0]-f[i-2])*m+(f[i+2]-f[i+0])*l)),d},createjs.MotionGuidePlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.TweenJS=createjs.TweenJS||{};a.version="0.6.0",a.buildDate="Thu, 11 Dec 2014 23:32:09 GMT"}();var signals=signals||{};(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function validateListener(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}}function Signal(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}Signal.prototype={VERSION:"1.0.0",memorize:false,_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){validateListener(listener,"add");return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){validateListener(listener,"addOnce");return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length,bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};signals=Signal;signals.Signal=Signal;if(typeof define==="function"&&define.amd){define(function(){return signals})}else if(typeof module!=="undefined"&&module.exports){module.exports=signals}else{global["signals"]=signals}})(this);Formide=function(settings){this.settings=settings;this.setBaseUrl=function(baseUrl){this.settings.baseUrl=baseUrl};this.setAccessToken=function(accessToken){this.settings.accessToken=accessToken};this.callApi=function(url,data,method,callback){var xmlHttp=null;xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4&&xmlHttp.status==200){callback(xmlHttp.responseText)}};xmlHttp.open(method,url,true);xmlHttp.setRequestHeader("Authorization","Bearer "+this.settings.accessToken);xmlHttp.setRequestHeader("Content-type","application/json");if(method=="GET"){xmlHttp.send(data)}else if(method=="POST"){xmlHttp.send(JSON.stringify(data))}};this.downloadBase64=function(parameters,callback){return this.callApi(this.settings.baseUrl+"/files/download?id="+parameters.id+"&hash="+parameters.hash+"&encoding=base64",{},"GET",callback)};this.uploadBase64=function(parameters,callback){return this.callApi(this.settings.baseUrl+"/files/upload",{file:window.btoa(parameters.file),encoding:"base64",filetype:parameters.filetype,filename:parameters.filename},"POST",callback)};this.uploadGeometry=function(parameters,callback){return this.callApi(this.settings.baseUrl+"/files/upload/geometry",{file:parameters.file,encoding:"json",filetype:parameters.filetype,filename:parameters.filename},"POST",callback)};this.uploadScreenshot=function(parameters,callback){return this.callApi(this.settings.baseUrl+"/db/files/"+parameters.modelfileId+"/images/base64",{file:parameters.dataURL,filename:parameters.filename},"POST",callback)}};function workerFunction(){var gcodeLineMatch=/^(G0|G1|T)/i;var gcode=[];var lines=[];var currentLine=0;var sendEveryLines=5e3;var linesCount=0;var linesToSend=[];var currentPosition={x:0,y:0,z:0};var currentExtrusion=0;var currentExtruder="T0";var currentVolume=0;var currentLayer=0;var currentLineInLayer=0;var currentType="NONE";var currentSpeed=0;var sendLines=function(){self.postMessage({type:"parseLine",lines:linesToSend,progress:parseInt(currentLine/lines.length*100),totalLines:lines.length});linesToSend=[];linesCount=0};var run=function(data){parseGcode(data);self.postMessage({type:"parseGcode"});gcode=[];lines=[];currentPosition={x:0,y:0,z:0};currentExtrusion=0;currentExtruder="T0";currentLine=0;currentLayer=0;currentLineInLayer=0;currentType="NONE";linesToSend=[];linesCount=0;currentSpeed=0};var parseGcode=function(data){gcode=data.gcode;lines=gcode.split(/\n/);for(var i=0;i<lines.length;i++){currentLine++;currentLineInLayer++;var line=lines[i];if(!line)continue;if(line.match(gcodeLineMatch)){linesCount++;var parsedLine=parseLine(line,i);linesToSend.push(parsedLine);if(linesCount===sendEveryLines){sendLines()}}else{if(line.indexOf(";TYPE:")>-1){currentType=line.replace(";TYPE:","").trim()}else if(line.indexOf(";Volume:")>-1){var volume=line.split(", ")[0].replace(";Volume:","").trim();currentVolume=parseInt(volume)}}}sendLines()};var parseLine=function(line,lineNumber){line=line.split(";")[0];var lineSegments=line.split(" ");var parseData={raw:line,segments:lineSegments,prevPosition:{x:currentPosition.x,y:currentPosition.y,z:currentPosition.z},position:{x:currentPosition.x,y:currentPosition.y,z:currentPosition.z},extrusion:currentExtrusion,nonExtrusion:true,volume:currentVolume,layer:currentLayer,lineInLayer:currentLineInLayer,type:currentType,speed:currentSpeed,movement:null,extruder:currentExtruder,lineNumber:lineNumber};for(var i=0;i<lineSegments.length;i++){var lineSegment=lineSegments[i].toUpperCase();if(lineSegment.indexOf("G")>-1){parseData.movement=lineSegment}else if(lineSegment.indexOf("F")>-1){currentSpeed=parseFloat(lineSegment.replace("F",""));parseData.speed=currentSpeed}else if(lineSegment.indexOf("X")>-1){parseData.position.x=parseFloat(lineSegment.replace("X",""))}else if(lineSegment.indexOf("Y")>-1){parseData.position.y=parseFloat(lineSegment.replace("Y",""))}else if(lineSegment.indexOf("Z")>-1){parseData.position.z=parseFloat(lineSegment.replace("Z",""))}else if(lineSegment.indexOf("E")>-1){parseData.extrusion=parseFloat(lineSegment.replace("E",""))}else if(lineSegment.indexOf("T")>-1){parseData.extruder=lineSegment}else{}}if(parseData.extrusion>currentExtrusion){parseData.nonExtrusion=false}if(parseData.extruder!==currentExtruder){currentExtruder=parseData.extruder;parseData.nonExtrusion=true}var dx=parseData.position.x-parseData.prevPosition.x;var dy=parseData.position.y-parseData.prevPosition.y;var dz=parseData.position.z-parseData.prevPosition.z;parseData.distance={x:dx,y:dy,z:dz,total:Math.sqrt(dx*dx+dy*dy+dz*dz)};if(currentPosition.z<parseData.position.z){currentLayer++}else if(currentPosition.z>parseData.position.z&&parseData.movement==="G1"){currentLayer--}if(currentLayer<0)currentLayer=0;currentPosition={x:parseData.position.x,y:parseData.position.y,z:parseData.position.z};currentExtrusion=parseData.extrusion;parseData.layer=currentLayer;return parseData};onmessage=function(e){switch(e.data.type){case"parseGcode":run(e.data);break;default:self.postMessage({type:"error",message:"Unknown request type: "+e.data.type})}}}var workerCode=workerFunction.toString();workerCode=workerCode.substring(workerCode.indexOf("{")+1,workerCode.lastIndexOf("}"));var workerblob=new Blob([workerCode],{type:"application/javascript"});var worker=new Worker(URL.createObjectURL(workerblob));var Fcode={};Fcode.GcodeParser=function(gcode,handleDone,handleProgress){this._raw=gcode;this._nested={volumes:[]};this._flat=[];this._lineCount=0;this._layerCount=0;this._volumeCount=0;this.doneCallback=handleDone;this.progressCallback=handleProgress;this.parseGcode()};Fcode.GcodeParser.prototype.parseGcode=function(){var self=this;var numberOfVolumes=0;var numberOfLayers=0;var numberOfLines=0;var startPosition={x:0,y:0,z:0};worker.postMessage({type:"parseGcode",gcode:self._raw,startPosition:startPosition});worker.addEventListener("message",function(e){if(e.data.type==="parseGcode"){self.doneCallback({flatGcode:self.getFlat(),layers:numberOfLayers,volumes:numberOfVolumes+1,lines:numberOfLines})}else if(e.data.type==="parseLine"){numberOfLines=e.data.totalLines;for(var i=0;i<e.data.lines.length;i++){var line=e.data.lines[i];var gcodeCommand=new Fcode.GcodeCommand(line);self._lineCount++;if(line.volume>self._volumeCount)self._volumeCount++;if(line.layer>self._layerCount)self._layerCount++;if(!self._nested.volumes[line.volume]){self._nested.volumes[line.volume]={layers:[]}}if(!self._nested.volumes[line.volume].layers[line.layer]){self._nested.volumes[line.volume].layers[line.layer]={types:{}}}if(!self._nested.volumes[line.volume].layers[line.layer].types[line.type]){self._nested.volumes[line.volume].layers[line.layer].types[line.type]=[]}self._nested.volumes[line.volume].layers[line.layer].types[line.type].push(gcodeCommand);self._flat.push(gcodeCommand);if(line.layer>numberOfLayers)numberOfLayers=line.layer;if(line.volume>numberOfVolumes)numberOfVolumes=line.volume}self.progressCallback(e.data.progress)}else if(e.data.type==="log"){console.log(e.data)}},false);worker.onerror=function(e){throw new Error(e.message+" ("+e.filename+":"+e.lineno+")")}};Fcode.GcodeParser.prototype.getRaw=function(){return this._raw};Fcode.GcodeParser.prototype.getFlat=function(){return this._flat};Fcode.GcodeParser.prototype.getParsed=function(){return this._nested};Fcode.GcodeParser.prototype.getStats=function(){return{lineCount:this._lineCount+1,layerCount:this._layerCount+1,volumeCount:this._volumeCount+1}};Fcode.GcodeCommand=function(line){this.raw=line.raw;this.segments=line.segments;this.startPosition=line.prevPosition;this.endPosition=line.position;this.distance=line.distance;this.movement=line.movement;this.extrusion=line.extrusion;this.extruder=line.extruder;this.nonExtrusion=line.nonExtrusion;this.volume=line.volume;this.layer=line.layer;this.lineInLayer=line.lineInLayer;this.type=line.type;this.speed=line.speed;this.lineNumber=line.lineNumber};window.DEBUG=window.DEBUG||false;FormideSDK=V3=function(canvas,settings){var scene;var renderer;var camera;var api;var managers={};var plugins=[];var sdk;function getUrlParameter(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))}V3.settings={camera:{fov:60,nearClip:.1,farClip:1e5,backgroundColor:16777215},cameraMode:{allowBottomViewing:false,center:"bedCenter"},behaviour:{selectionIntensity:.2},quality:{targetFPS:30,shadows:true,shadowType:THREE.PCFSoftShadowMap,antialias:true},printer:{size:{x:200,y:200,z:200,r:140},bedHeight:5,grid:5,type:"xyz",colors:{tiles:16316664,lines:16514043,base:16316664}},api:{baseUrl:"https://api.formide.com",accessToken:getUrlParameter("access_token")}};V3.events={startTransform:new signals.Signal,endTransform:new signals.Signal,modelSelected:new signals.Signal,modelUnselected:new signals.Signal,geometryChanged:new signals.Signal,modelChanged:new signals.Signal,modelCopied:new signals.Signal,modelRemoved:new signals.Signal,modelTransformAllowChanged:new signals.Signal,progress:new signals.Signal,bedChanged:new signals.Signal,render:new signals.Signal};V3.plugins=plugins;Object.deepExtend=function(destination,source){for(var property in source){if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};arguments.callee(destination[property],source[property])}else{destination[property]=source[property]}}return destination};if(settings!==undefined){Object.deepExtend(V3.settings,settings)}scene=new THREE.Scene;renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:V3.settings.quality.antialias,alpha:true,preserveDrawingBuffer:true});renderer.shadowMapEnabled=V3.settings.quality.shadows;renderer.shadowMapType=V3.settings.quality.shadowType;renderer.shadowMapSoft=true;renderer.shadowMapWidth=1024;renderer.shadowMapHeight=1024;renderer.physicallyBasedShading=true;renderer.shadowMapBias=.0039;renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1);renderer.setSize(canvas.offsetWidth,canvas.offsetHeight);renderer.setClearColor(V3.settings.camera.backgroundColor);camera=new THREE.CombinedCamera(canvas.offsetWidth/2,canvas.offsetHeight/2,V3.settings.camera.fov,V3.settings.camera.nearClip,V3.settings.camera.farClip,(-500),1e3);scene.add(camera);api=new Formide(V3.settings.api);if(V3.AmbientManager!==undefined){managers.AmbientManager=new V3.AmbientManager(scene,renderer,V3.settings)}if(V3.ModelManager!==undefined){managers.ModelManager=new V3.ModelManager(scene,renderer,V3.settings)}if(V3.ControlsManager!==undefined){managers.ControlsManager=new V3.ControlsManager(scene,camera,canvas,managers.ModelManager,V3.settings)}if(V3.HelperManager!==undefined){managers.HelperManager=new V3.HelperManager(scene,camera,managers.ModelManager,managers.ControlsManager,V3.settings)}if(V3.CameraManager!==undefined){managers.CameraManager=new V3.CameraManager(canvas,scene,camera,managers.ControlsManager,managers.ModelManager,V3.settings)}if(V3.TransformManager!==undefined){managers.TransformManager=new V3.TransformManager(managers.ModelManager,V3.HelperManager,scene,V3.settings)}if(V3.GcodeManager!==undefined){managers.GcodeManager=new V3.GcodeManager(managers.ModelManager)}if(V3.ExportManager!==undefined){managers.ExportManager=new V3.ExportManager(scene,api,managers.ModelManager,V3.settings)}function animate(){requestAnimationFrame(animate);if(THREE.AnimationHandler.animations.length>0)THREE.AnimationHandler.update(.016)}function render(){if(typeof renderer!=="undefined"){renderer.clear();managers.ModelManager.getModels(function(models){for(var model in models){models[model].render()}});renderer.render(scene,camera)}}V3.events.render.add(render);V3.events.modelChanged.add(render);animate();if(V3.SDK!==undefined){sdk=new V3.SDK(canvas,scene,renderer,api,camera,managers,settings,this);return sdk}};V3=typeof V3==="undefined"?{}:V3;V3.CameraManager=function(canvas,scene,camera,ControlsManager,ModelManager,settings){function init(){if(settings.printer.type=="xyz"){camera.position.x=settings.printer.size.x;camera.position.y=settings.printer.size.y;camera.position.z=settings.printer.size.z}else{camera.position.x=settings.printer.size.r/Math.sqrt(2);camera.position.y=settings.printer.size.r/Math.sqrt(2);camera.position.z=settings.printer.size.z}camera.up.set(0,0,1);camera.toPerspective();camera.setZoom(1)}init();ControlsManager.centerOnBed({callback:function(){}});this.setCameraType=function(parameters,callback){if(parameters.type==="depth"){init()}else if(parameters.type==="flat"){camera.toOrthographic();camera.setZoom(400)}V3.events.render.dispatch()};this.switchSideView=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.calculateNewBounds();if(parameters.view==="front"){camera.position.x=model.position.x;camera.position.y=model.currentBounds.max.y+100;camera.position.z=model.position.z}else if(parameters.view==="back"){camera.position.x=model.position.x;camera.position.y=model.currentBounds.min.y-100;camera.position.z=model.position.z}else if(parameters.view==="left"){camera.position.x=model.currentBounds.max.x+100;camera.position.y=model.position.y;camera.position.z=model.position.z}else if(parameters.view==="right"){camera.position.x=model.currentBounds.min.x-100;camera.position.y=model.position.y;camera.position.z=model.position.z}else if(parameters.view==="top"){if(settings.printer.type=="xyz"){camera.position.x=settings.printer.size.x/2;camera.position.y=settings.printer.size.y/2;camera.position.z=settings.printer.size.z}else{camera.position.x=0;camera.position.y=0;camera.position.z=settings.printer.size.z}}else if(parameters.view==="default"){init()}ControlsManager.centerCameraOnModel(parameters,callback)})};this.resetCameraPosition=function(parameters,callback){init()}};V3=typeof V3==="undefined"?{}:V3;V3.AmbientManager=function(scene,renderer,settings){var ambientLight=new THREE.AmbientLight(9474192);scene.add(ambientLight);var addShadowedLight=function(x,y,z,color,intensity){var light=new THREE.SpotLight(color,intensity);light.position.set(x,y,z);light.castShadow=true;light.shadowBias=1e-5;light.shadowDarkness=.2;light.shadowMapWidth=2048;light.shadowMapHeight=2048;light.shadowCameraNear=.01;light.shadowCameraFar=1e4;light.shadowCameraFov=5e3;scene.add(light)};addShadowedLight(500,700,400,16777215,.9);var light=new THREE.DirectionalLight(14540253,.2);light.position.set(-500,-700,-400);light.castShadow=false;scene.add(light);this.setLightColor=function(parameters,callback){callback("OK")};this.setBackgroundColor=function(parameters,callback){renderer.setClearColor((new THREE.Color).setRGB(parameters.r/255,parameters.g/255,parameters.b/255));V3.events.render.dispatch();callback("OK")};this.setBackgroundGradient=function(parameters){callback("OK")}};V3=typeof V3==="undefined"?{}:V3;V3.ModelManager=function(scene,renderer,settings){var models={};var selectedModel=null;var STLLoader=new THREE.STLLoader;var GcodeLoader=new V3.GcodeManager(this);var root=new THREE.Object3D;scene.add(root);V3.events.modelSelected.add(function(event){selectedModel=event.model});this.getModels=function(callback){callback(models)};this.getModelsSync=function(){return models};this.getModel=function(modelId,callback){if(models[modelId]!==undefined){var model=models[modelId];callback(model)}else{callback(null,{message:"Model with ID "+modelId+" not found"})}};this.getModelSync=function(modelId){var model=models[modelId];return model};this.addModelByUrl=function(url,parameters,callback){if(parameters.type!==undefined){switch(parameters.type){default:case"STL":STLLoader.load(url,function(geometry){if(geometry instanceof THREE.BufferGeometry){geometry=(new THREE.Geometry).fromBufferGeometry(geometry)}this.addGeometry(geometry,parameters,callback)}.bind(this),function(request){},function(err){callback(null,{message:"something went wrong when loading the STL model. This probably means that the file doesn't exist.",error:err})});break}}};this.addModelByContents=function(contents,parameters,callback){switch(parameters.type){default:case"STL":var geometry=STLLoader.parse(contents);this.addGeometry(geometry,parameters,callback);break;case"GCODE":var gcodeParser=new Fcode.GcodeParser(contents,function(parsedGcode){scene.traverse(function(object){if(object.type==="gcode"){scene.remove(object)}});var gcodeObject=GcodeLoader.gcodeToLine(parsedGcode.flatGcode);gcodeObject.type="gcode";gcodeObject.layers=parsedGcode.layers;gcodeObject.volumes=parsedGcode.volumes;gcodeObject.lines=parsedGcode.lines;root.add(gcodeObject);V3.events.render.dispatch();callback()},function(progress){V3.events.progress.dispatch({progress:progress})});break}};this.resetGeometryRoot=function(geometry){if(geometry instanceof THREE.Geometry){geometry.computeBoundingBox();geometry.computeVertexNormals();var sub=geometry.boundingBox.min;var matrix=new THREE.Matrix4;matrix.setPosition(new THREE.Vector3((-sub.x),(-sub.y),(-sub.z)));geometry.applyMatrix(matrix)}else if(geometry instanceof THREE.BufferGeometry){geometry.computeBoundingBox();geometry.computeVertexNormals();var sub=geometry.boundingBox.min;var attr=geometry.getAttribute("position");for(var i=0;i<attr.array.length;i++){attr.array[i*3+0]-=sub.x;attr.array[i*3+1]-=sub.y;attr.array[i*3+2]-=sub.z}geometry.needsUpdate=true;geometry.computeBoundingBox()}};this.addGeometry=function(geometry,parameters,callback){parameters==parameters||{};var mesh=new V3.Model({geometry:geometry});mesh.modelId=mesh.uuid;root.add(mesh);if(parameters.copiedModelId){V3.events.modelCopied.dispatch({copiedModel:parameters.copiedModelId,newModel:mesh.modelId});formideSDK.getModel({modelId:parameters.copiedModelId},function(response,err){mesh.scale.set(response.scale.x,response.scale.y,response.scale.z);mesh.rotation.set(response.rotation.x,response.rotation.y,response.rotation.z);mesh.calculateNewBounds();mesh.name=response.name+" (copy)"})}var offset=mesh.geometry.center();mesh.position.sub(offset);if(settings.printer.type=="xyz"){mesh.position.x=settings.printer.size.x/2;mesh.position.y=settings.printer.size.y/2}else{mesh.position.x=0;mesh.position.y=0}mesh.originalPosition={x:mesh.position.x,y:mesh.position.y,z:mesh.position.z};mesh.name=mesh.name||parameters.name||mesh.modelId.substring(0,6);if(Object.keys(models).length>0){var maxModelX,minModelX,maxX,minX,maxModelY,minModelY,maxY,minY,offset;offset=5;mesh.calculateNewBounds();if(settings.printer.type=="xyz"){maxX=settings.printer.size.x;minX=0;maxY=settings.printer.size.y;minY=0;maxModelX=0;minModelX=settings.printer.size.x;maxModelY=0;minModelY=settings.printer.size.y}else{maxX=settings.printer.size.r;minX=-1*settings.printer.size.r;maxY=settings.printer.size.r;minY=-1*settings.printer.size.r;maxModelX=-1*settings.printer.size.r;minModelX=settings.printer.size.r;maxModelY=-1*settings.printer.size.r;minModelY=settings.printer.size.r}for(var key in models){models[key].calculateNewBounds();if(models.hasOwnProperty(key)){if(maxModelX<models[key].currentBounds.max.x){maxModelX=models[key].currentBounds.max.x}if(minModelX>models[key].currentBounds.min.x){minModelX=models[key].currentBounds.min.x}if(maxModelY<models[key].currentBounds.max.y){maxModelY=models[key].currentBounds.max.y}if(minModelY>models[key].currentBounds.min.y){minModelY=models[key].currentBounds.min.y}}}if(maxModelX+(mesh.currentBounds.max.x-mesh.currentBounds.min.x)+offset<maxX){mesh.position.x=maxModelX+(mesh.currentBounds.max.x-mesh.position.x)+offset}else if(minModelX+(mesh.currentBounds.min.x-mesh.currentBounds.max.x)-offset>minX){
mesh.position.x=minModelX+(mesh.currentBounds.min.x-mesh.position.x)-offset}else if(maxModelY+(mesh.currentBounds.max.y-mesh.currentBounds.min.y)+offset<maxY){mesh.position.y=maxModelY+(mesh.currentBounds.max.y-mesh.position.y)+offset}else if(minModelY+(mesh.currentBounds.min.y-mesh.currentBounds.max.y)-offset>minY){mesh.position.y=minModelY+(mesh.currentBounds.min.y-mesh.position.y)-offset}}V3.events.geometryChanged.dispatch({geometry:mesh.geometry});V3.events.modelChanged.dispatch({model:mesh});models[mesh.modelId]=mesh;V3.events.render.dispatch();mesh.saveTransformations();callback({modelId:mesh.modelId})};this.renderMesh=function(object){object.render()};this.setModelColor=function(parameters,callback){var mesh=models[parameters.modelId];mesh.baseColor=(new THREE.Color).setRGB(parameters.r/255,parameters.g/255,parameters.b/255);mesh.validColor=(new THREE.Color).setRGB(parameters.r/255,parameters.g/255,parameters.b/255);V3.events.render.dispatch();callback({modelId:parameters.modelId,color:mesh.baseColor})};this.setModelColorInvalid=function(parameters,callback){var mesh=models[parameters.modelId];mesh.baseColor=(new THREE.Color).setRGB(130/255,130/255,130/255);V3.events.render.dispatch();callback({modelId:parameters.modelId,color:mesh.baseColor})};this.copyModel=function(parameters,callback){this.getModel(parameters.modelId,function(model,err){var newGeometry=model.geometry.clone();this.addGeometry(newGeometry,{copiedModelId:parameters.modelId},callback)}.bind(this))};this.removeModel=function(parameters,callback){var mesh=models[parameters.modelId];mesh.geometry.dispose();mesh.material.dispose();root.remove(mesh);scene.remove(mesh);mesh=undefined;delete models[parameters.modelId];V3.events.modelRemoved.dispatch({model:parameters.modelId});V3.events.render.dispatch();callback({modelId:parameters.modelId,message:"Model removed"})};this.removeAllModels=function(callback){for(var model in models){var mesh=models[model];mesh.geometry.dispose();mesh.material.dispose();root.remove(mesh);scene.remove(mesh);mesh=undefined}models=[];V3.events.render.dispatch();callback({message:"All models removed"})};this.getSelectedModel=function(callback){callback(selectedModel)};this.showBoundingBox=function(parameters,callback){this.getModel(parameters.modelId,function(model,err){var box=new THREE.BoxHelper(model);box.name="boundingBox_"+model.id;scene.add(box);V3.events.render.dispatch();callback()})};this.hideBoundingBox=function(parameters,callback){this.getModel(parameters.modelId,function(model,err){var name="boundingBox_"+model.id;var box=scene.getObjectByName(name);scene.remove(box);V3.events.render.dispatch();callback()})};this.addBox=function(parameters,callback){this.addGeometry(new THREE.BoxGeometry(parameters.x,parameters.y,parameters.z),parameters,callback)};this.addSphere=function(parameters,callback){this.addGeometry(new THREE.SphereGeometry(parameters.radius,parameters.segments,parameters.segments),parameters,callback)};this.addCylinder=function(parameters,callback){this.addGeometry(new THREE.CylinderGeometry(parameters.radiusTop,parameters.radiusBottom,parameters.height,parameters.segments),parameters,callback)};this.addEmpty=function(parameters,callback){this.addGeometry(undefined,parameters,calback)};this.setRoot=function(position,parameters){if(parameters.smooth===undefined||parameters.smooth!==undefined&&parameters.smooth===true){createjs.Tween.get(root.position).to({x:parameters.position.x,y:parameters.position.y,z:parameters.position.z},settings.behaviour.animationSpeed,createjs.Ease.cubicIn)}root.position=parameters.position};this.addText=function(parameters){if(parameters.size===undefined){parameters.size=30}if(parameters.height===undefined){parameters.height=4}if(parameters.segments===undefined){parameters.segments=3}if(parameters.bevelThickness===undefined){parameters.bevelThickness=1}if(parameters.bevelSize===undefined){parameters.bevelSize=2}if(parameters.bevelEnabled===undefined){parameters.bevelEnabled=false}if(parameters.font===undefined){parameters.font="helvetiker"}if(parameters.weight===undefined){parameters.weight="bold"}if(parameters.style===undefined){parameters.style="normal"}var textGeom=new THREE.TextGeometry(parameters.text,{size:parameters.size,height:parameters.height,curveSegments:parameters.segments,font:parameters.font,weight:parameters.weight,style:parameters.style,bevelThickness:parameters.bevelThickness,bevelSize:parameters.bevelSize,bevelEnabled:parameters.bevelEnabled});this.addGeometry(textGeom,{callback:parameters.callback})};this.getRoot=function(){return root}};V3=typeof V3==="undefined"?{}:V3;V3.TransformManager=function(ModelManager,helper,scene,settings){this.centerGeometry=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){var offset=model.geometry.center();model.position.sub(offset);V3.events.geometryChanged.dispatch({geometry:model.geometry});V3.events.modelChanged.dispatch({model:model});callback({model:model})}.bind(this))};this.flattenGeometry=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.geometry.applyMatrix(model.matrix);model.position.set(0,0,0);model.rotation.set(0,0,0);model.scale.set(1,1,1);V3.events.geometryChanged.dispatch({geometry:model.geometry});V3.events.modelChanged.dispatch({model:model});callback({model:model})})};this.resetModelTransformations=function(parameters,callback){var self=this;ModelManager.getModel(parameters.modelId,function(model){model.rotation.set(0,0,0);model.scale.set(1,1,1);self.resetModelPosition(parameters,callback);V3.events.geometryChanged.dispatch({geometry:model.geometry});V3.events.modelChanged.dispatch({model:model});callback({model:model})})};this.resetModelPosition=function(parameters,callback){var self=this;ModelManager.getModel(parameters.modelId,function(model){model.calculateNewBounds();if(settings.printer.type=="xyz"){model.position.x=settings.printer.size.x/2;model.position.y=settings.printer.size.y/2}else{model.position.x=0;model.position.y=0}model.position.z=model.originalPosition.z;callback({modelId:parameters.modelId})})};this.resetModelPositionZ=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.calculateNewBounds();model.position.z=(model.currentBounds.max.z-model.currentBounds.min.z)/2;model.calculateNewBounds();model.position.z-=model.currentBounds.min.z;V3.events.modelChanged.dispatch({model:model});callback({model:model})})};this.resetModelRotation=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.rotation.set(0,0,0);V3.events.modelChanged.dispatch({model:model});callback({model:model})})};this.resetModelScale=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.scale.set(1,1,1);V3.events.modelChanged.dispatch({model:model});callback({model:model})})};this.setModelPosition=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.position.set(parameters.x,parameters.y,parameters.z);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.setModelTargetPosition=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){createjs.Tween.get(model.position).to({x:parameters.x,y:parameters.y,z:parameters.z},parameters.animationTime,createjs.Ease.cubicOut);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.setModelRotation=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.rotation.set(parameters.x,parameters.y,parameters.z);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.setModelTargetRotation=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){createjs.Tween.get(model.rotation).to({x:parameters.x,y:parameters.y,z:parameters.z},parameters.animationTime,createjs.Ease.cubicOut);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.setModelScale=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.scale.set(parameters.x,parameters.y,parameters.z);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.setModelTargetScale=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){var target=new THREE.Vector3(parameters.x,parameters.y,parameters.z).divide(model.originalBounds.size());createjs.Tween.get(model.scale).to({x:target.x,y:target.y,z:target.z},parameters.animationTime,createjs.Ease.cubicOut);model.calculateNewBounds();V3.events.modelChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.allowTranslate=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowTranslate=true;V3.events.modelTransformAllowChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.allowRotate=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowRotate=true;V3.events.modelTransformAllowChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.allowScale=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowScale=true;V3.events.modelTransformAllowChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.disallowTranslate=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowTranslate=false;V3.events.modelTransformAllowChanged.dispatch({model:model});callback({modelId:parameters.modelId})}.bind(this))};this.disallowRotate=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowRotate=false;V3.events.modelTransformAllowChanged.dispatch({model:model});return callback({modelId:parameters.modelId})}.bind(this))};this.disallowScale=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.transforms.allowScale=false;V3.events.modelTransformAllowChanged.dispatch({model:model});return callback({modelId:parameters.modelId})}.bind(this))};this.getTransformations=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){return callback(model.getTransformations())}.bind(this))};this.undoTransformation=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.undoTransformation();return callback()}.bind(this))};this.redoTransformation=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.redoTransformation();return callback()}.bind(this))};this.autofitModel=function(parameters,callback){var self=this;ModelManager.getModel(parameters.modelId,function(model,err){if(err)return callback(null,err);if(model){if(settings.printer.type==="xyz"){model.calculateNewBounds();var bestScale=model.scale.x;if(model.currentBounds.min.x<0||model.currentBounds.max.x>settings.printer.size.x){var newScale=model.scale;var xSize=model.currentBounds.max.x-model.currentBounds.min.x;var xOriginalSize=model.originalBounds.max.x-model.originalBounds.min.x;var xTargetSize=settings.printer.size.x;if(xSize>xTargetSize){newScale=xTargetSize/xOriginalSize;if(newScale<bestScale){bestScale=newScale}}}if(model.currentBounds.min.y<0||model.currentBounds.max.y>settings.printer.size.y){var newScale=model.scale;var ySize=model.currentBounds.max.y-model.currentBounds.min.y;var yOriginalSize=model.originalBounds.max.y-model.originalBounds.min.y;var yTargetSize=settings.printer.size.y;if(ySize>yTargetSize){newScale=yTargetSize/yOriginalSize;if(newScale<bestScale){bestScale=newScale}}}model.calculateNewBounds();if(model.currentBounds.min.z<0||model.currentBounds.max.z>settings.printer.size.z){var newScale=model.scale;var zSize=model.currentBounds.max.z-model.currentBounds.min.z;var zOriginalSize=model.originalBounds.max.z-model.originalBounds.min.z;var zTargetSize=settings.printer.size.z;if(zSize>zTargetSize){newScale=zTargetSize/zOriginalSize;if(newScale<bestScale){bestScale=newScale}}}model.scale.set(bestScale,bestScale,bestScale)}self.recenterModel(parameters,callback)}})};this.putModelOnBed=function(parameters,callback){this.resetModelPositionZ(parameters,callback)};this.recenterModel=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){model.calculateNewBounds();if(settings.printer.type=="xyz"){model.position.x=settings.printer.size.x/2;model.position.y=settings.printer.size.y/2}else{model.position.x=0;model.position.y=0}callback({modelId:parameters.modelId})})};this.recenterAllModels=function(callback){var self=this;ModelManager.getModels(function(models){for(var i in models){self.resetModelPosition(models[i],callback)}})};this.resetModel=function(parameters,callback){this.resetModelTransformations(parameters,callback)}};V3=typeof V3==="undefined"?{}:V3;V3.ControlsManager=function(scene,camera,canvas,ModelManager,settings){camera.up.set(0,0,1);var transformControls=new V3.TransformControls(camera,canvas);var cameraControls=new THREE.OrbitControls(camera,canvas);var onDownPosition=new THREE.Vector2;var onUpPosition=new THREE.Vector2;var onDoubleClickPosition=new THREE.Vector2;var raycaster=new THREE.Raycaster;var cameraRotationTimeout=3;var rotationTimeoutTimer=0;var activeModel=null;var transformMode="translate";var allowTransforms=false;var somethingSelected=false;var zoom=.02;this.transform=transformControls;this.camera=cameraControls;transformControls.addEventListener("mouseDown",function(){V3.events.startTransform.dispatch({model:activeModel});cameraControls.enabled=false});transformControls.addEventListener("mouseUp",function(){V3.events.endTransform.dispatch({model:activeModel});V3.events.modelChanged.dispatch({model:activeModel});cameraControls.enabled=true});transformControls.addEventListener("change",function(event){V3.events.render.dispatch()}.bind(this));scene.add(transformControls);cameraControls.center.fromArray([0,0,0]);cameraControls.addEventListener("change",function(event){V3.events.render.dispatch();transformControls.update()});var getIntersects=function(point,object){var vector=new THREE.Vector3;vector.set(point.x*2-1,-(point.y*2)+1,.5);vector.unproject(camera);raycaster.set(camera.position,vector.sub(camera.position).normalize());if(object instanceof Array){return raycaster.intersectObjects(object)}if(object instanceof Object){var arr=Object.keys(object).map(function(key){return object[key]});return raycaster.intersectObjects(arr)}return raycaster.intersectObject(object)};var getMousePosition=function(dom,x,y){var rect=dom.getBoundingClientRect();return[(x-rect.left)/rect.width,(y-rect.top)/rect.height]};var handleClick=function(){if(onDownPosition.distanceTo(onUpPosition)===0){transformControls.detach();ModelManager.getModels(function(models){var intersects=getIntersects(onUpPosition,models);somethingSelected=false;for(var model in models){var mesh=models[model];if(intersects.length>0&&intersects[0].object===mesh){setTransformForModel(mesh,transformMode);somethingSelected=true;mesh.selected=true;activeModel=mesh;V3.events.modelSelected.dispatch({model:activeModel})}else{mesh.selected=false}}if(!somethingSelected){V3.events.modelUnselected.dispatch()}}.bind(this));V3.events.render.dispatch()}};var setTransformForModel=function(mesh,transform){if(mesh){if(transform==="translate"&&mesh.transforms.allowTranslate||transform==="rotate"&&mesh.transforms.allowRotate||transform==="scale"&&mesh.transforms.allowScale){transformControls.setMode(transform);if(transform==="scale"){transformControls.setSpace("local")}else{transformControls.setSpace("world")}transformControls.attach(mesh)}}else{transformControls.attach(null)}};var onMouseDown=function(event){event.preventDefault();var array=getMousePosition(canvas,event.clientX,event.clientY);onDownPosition.fromArray(array);document.addEventListener("mouseup",onMouseUp,false)};var onMouseUp=function(event){var array=getMousePosition(canvas,event.clientX,event.clientY);onUpPosition.fromArray(array);handleClick();document.removeEventListener("mouseup",onMouseUp,false)};var onMouseMove=function(event){rotationTimeoutTimer=0;cameraControls.autoRotate=false};var onTouchStart=function(event){var touch=event.changedTouches[0];var array=getMousePosition(canvas,touch.clientX,touch.clientY);onDownPosition.fromArray(array);document.addEventListener("touchend",onTouchEnd,false)};var onTouchEnd=function(event){var touch=event.changedTouches[0];var array=getMousePosition(canvas,touch.clientX,touch.clientY);onUpPosition.fromArray(array);handleClick();document.removeEventListener("touchend",onTouchEnd,false)};canvas.addEventListener("mousemove",onMouseMove,false);canvas.addEventListener("mousedown",onMouseDown,false);canvas.addEventListener("touchstart",onTouchStart,false);this.updateTimeout=function(time){cameraControls.update();transformControls.update();rotationTimeoutTimer+=time;if(rotationTimeoutTimer>=cameraRotationTimeout){cameraControls.autoRotate=true}};this.selectModel=function(model,callback){ModelManager.getModels(function(models){somethingSelected=false;for(var i in models){var mesh=models[i];if(model===mesh){setTransformForModel(mesh,transformMode);somethingSelected=true;mesh.selected=true;activeModel=mesh;V3.events.modelSelected.dispatch({model:activeModel})}else{mesh.selected=false}}});V3.events.render.dispatch();callback()};this.unselectModel=function(){transformControls.detach();ModelManager.getModels(function(models){somethingSelected=false;for(var i in models){var mesh=models[i];mesh.selected=false}});V3.events.modelUnselected.dispatch();V3.events.render.dispatch()};this.setTransform=function(callback){setTransformForModel(activeModel,transformMode);callback()};this.setTransformTranslate=function(callback){transformMode="translate";setTransformForModel(activeModel,transformMode);callback()};this.setTransformRotate=function(callback){transformMode="rotate";setTransformForModel(activeModel,transformMode);callback()};this.setTransformScale=function(callback){transformMode="scale";setTransformForModel(activeModel,transformMode);callback()};this.setTransformSnap=function(parameters,callback){if(parameters.snap===false){transformControls.setSnap(null);transformControls.setSnapRotation(null);transformControls.setSnapScale(-1)}else{transformControls.setSnap(parameters.positionSnap);transformControls.setSnapRotation(parameters.rotationSnap);transformControls.setSnapScale(parameters.scaleSnap)}callback("OK")};this.setRotationTimeout=function(parameters,callback){cameraRotationTimeout=parameters.ms/1e3;callback("OK")};this.setRotationSpeed=function(parameters,callback){cameraControls.autoRotateSpeed=parameters.speed;callback("OK")};this.centerCameraOnModel=function(parameters,callback){ModelManager.getModel(parameters.modelId,function(model){cameraControls.target=model.position;cameraControls.update();callback()})};this.centerCameraOnBed=function(callback){if(settings.printer.type==="xyz"){cameraControls.target=new THREE.Vector3(settings.printer.size.x/2,settings.printer.size.y/2,0)}callback()};this.allowBottomViewing=function(parameters){if(parameters.callback!==undefined){parameters.callback({status:200,data:"TBD"})}};this.setDragAnimationSpeed=function(parameters){if(parameters.callback!==undefined){parameters.callback({status:200,data:"TBD"})}};this.zoomToFit=function(parameters){ModelManager.getModel(parameters.modelId,function(mesh){cameraControls.target=mesh.position;cameraControls.update()});if(parameters.callback!==undefined){parameters.callback({status:200,data:"OK"})}};this.zoomToFitModel=function(parameters){if(parameters.callback!==undefined){parameters.callback({status:200,data:"TBD"})}};this.zoomToFitModels=function(parameters){if(parameters.callback!==undefined){parameters.callback({status:200,data:"TBD"})}};this.centerOnBed=function(parameters){if(settings.cameraMode.center=="bedCenter"){if(settings.printer.type==="xyz"){cameraControls.target=new THREE.Vector3(settings.printer.size.x/2,settings.printer.size.y/2,0)}else{cameraControls.target=new THREE.Vector3(0,0,0)}}else{cameraControls.target=ModelManager.getRoot().position}cameraControls.update();if(parameters&&parameters.callback!==undefined){parameters.callback({status:200,data:"OK"})}};this.centerOnModel=function(parameters){ModelManager.getModel(parameters.modelId,function(mesh){cameraControls.target=mesh.position;cameraControls.update();if(parameters.callback!==undefined){parameters.callback({status:200,data:{modelId:parameters.modelId,position:mesh.position}})}}.bind(this))};this.centerOnModels=function(parameters){if(parameters.callback!==undefined){parameters.callback({status:200,data:"TBD"})}};this.zoomOut=function(parameters){cameraControls.dollyOut(parameters.zoom);cameraControls.update();if(parameters.callback!==undefined){parameters.callback({status:200,data:{zoom:parameters.zoom}})}};this.zoomIn=function(parameters){cameraControls.dollyIn(parameters.zoom);cameraControls.update();if(parameters.callback!==undefined){parameters.callback({status:200,data:{zoom:parameters.zoom}})}};this.addRotation=function(parameters){cameraControls.rotateLeft(parameters.angle);cameraControls.update();if(parameters.callback!==undefined){parameters.callback({status:200,data:{angle:parameters.angle}})}};this.setCameraMode=function(parameters){if(parameters.center){if(parameters.center==="root"){settings.cameraMode.center="root"}else if(parameters.center==="bedCenter"){settings.cameraMode.center==="bedCenter"}}if(parameters.allowBottomViewing){if(parameters.allowBottomViewing===true){settings.cameraMode.allowBottomViewing=true}else if(parameters.allowBottomViewing===false){settings.cameraMode.allowBottomViewing=false}}}};V3=typeof V3==="undefined"?{}:V3;V3.HelperManager=function(scene,camera,ModelManager,ControlsManager,settings){var _printBeds={};var _printers={};var that=this;var addXyzPrinter=function(){var _printerGeometry=new THREE.CubeGeometry(1,1,1);var _printerMaterials=[new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.BackSide}),new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.BackSide}),new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.BackSide}),new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.FrontSide}),new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.BackSide}),new THREE.MeshBasicMaterial({color:4633062,transparent:true,opacity:.3,side:THREE.BackSide})];var _printerMaterial=new THREE.MeshFaceMaterial(_printerMaterials);_printers.xyz=new THREE.Mesh(_printerGeometry,_printerMaterial);_printers.xyz.position.set(settings.printer.size.x/2,settings.printer.size.y/2,settings.printer.size.z/2);_printers.xyz.scale.set(settings.printer.size.x,settings.printer.size.y,settings.printer.size.z);_printers.xyz.visible=false;_printers.xyz.castShadow=false;scene.add(_printers.xyz);V3.events.render.dispatch()};var generatePrintbedXyz=function(x,y,h,gridSize){var topOffset=2;var bottomOffset=4;var base=new THREE.Mesh(new THREE.BoxGeometry(x+bottomOffset*2,y+bottomOffset*2,h),new THREE.MeshBasicMaterial({color:settings.printer.colors.base}));base.castShadow=false;base.receiveShadow=true;base.visible=false;base.setSize=function(gridSize,x,y,h){base.geometry=new THREE.BoxGeometry(x+bottomOffset*2,y+bottomOffset*2,h);base.position.set(x/2,y/2,-h/2-topOffset/2);base.drawTop(gridSize,x,y)};base.drawTop=function(gridSize,x,y){base.children=[];var gridTexture=new THREE.ImageUtils.loadTexture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAACXBIWXMAADIAAAAyAAHydpMhAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAEFpaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzExMSA3OS4xNTgzMjUsIDIwMTUvMDkvMTAtMDE6MTA6MjAgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNi0wMy0zMFQxNzoyMTo1MiswMjowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTYtMDMtMzFUMTA6MTE6MjUrMDI6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE2LTAzLTMxVDEwOjExOjI1KzAyOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDoxYmM3MGM2NC03ZDg4LTQ2NTYtOGQ4ZS0yMDlhOGY3N2JhMWM8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDphY2U5YmI4MC0zNzIzLTExNzktOTU0Mi1kMjE3MjE1YmUxYTM8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDplZjhiZDJlNS0wOTgyLTQ2MmEtYmUyZS02YTYyYmIyMTgyOTA8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZWY4YmQyZTUtMDk4Mi00NjJhLWJlMmUtNmE2MmJiMjE4MjkwPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMwVDE3OjIxOjUyKzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZmQyMDFhZWEtYWZiNS00MWZiLWIyNGMtMWFhZmE5ZjM5OGRhPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMwVDE3OjIyOjM3KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6Y2IyYWFmODQtZjY3Yi00NWRiLTlhOTYtYTkxNjI3NWI0ZjY0PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMxVDEwOjExOjI1KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPmNvbnZlcnRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5mcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nPC9zdEV2dDpwYXJhbWV0ZXJzPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+ZGVyaXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5jb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZzwvc3RFdnQ6cGFyYW1ldGVycz4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6MWJjNzBjNjQtN2Q4OC00NjU2LThkOGUtMjA5YThmNzdiYTFjPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMxVDEwOjExOjI1KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOmNiMmFhZjg0LWY2N2ItNDVkYi05YTk2LWE5MTYyNzViNGY2NDwvc3RSZWY6aW5zdGFuY2VJRD4KICAgICAgICAgICAgPHN0UmVmOmRvY3VtZW50SUQ+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjkwYzA2MGQxLTM3MTktMTE3OS05NTQyLWQyMTcyMTViZTFhMzwvc3RSZWY6ZG9jdW1lbnRJRD4KICAgICAgICAgICAgPHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD54bXAuZGlkOmVmOGJkMmU1LTA5ODItNDYyYS1iZTJlLTZhNjJiYjIxODI5MDwvc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj4xMjgwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj4xMjgwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4zPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjEwMjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MTAyNDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+Bm1ELgAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAbQUlEQVR42uzasa3DSBBEweOBkUz+Kc2ksmcxgwNGf7vKkrfqpSDjgU93n38AAACAq/3rCgAAAOB+7/ehqla+wMysnb95tv32229/8v70Z+8e/Abst99++/33e/YbZ3sDAAAAAAIIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgADgCgAAAEAAAAAAAC7wdPdxDQAAAHA3bwAAAABAgPf7UFUrX2Bm1s7fPNt+++23P3l/+rN3D34D9ttvv/3++z37jbO9AQAAAAABBAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAcAUAAAAgAAAAAAACAAAAACAAAAAAAD/h6e7jGgAAAOBu3gAAAACAAO/3oapWvsDMrJ2/ebb99ttvf/L+9GfvHvwG7Lfffvv993v2G2d7AwAAAAACCAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAA4AoAAABAAAAAAAAu8HT3cQ0AAABwN28AAAAAQID3+1BVK19gZtbO3zzbfvvttz95f/qzdw9+A/bbb7/9/vs9+42zvQEAAAAAAQQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAHAFAAAAIAAAAAAAAgAAAADwFzzdfVwDAAAA3M0bAAAAABDg/T5U1coXmJm18zfPtt9+++1P3p/+7N2D34D99ttvv/9+z37jbG8AAAAAQAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEABcAQAAAAgAAAAAwAWe7j6uAQAAAO7mDQAAAAAI8H4fqmrlC8zM2vmbZ9tvv/32J+9Pf/buwW/Afvvtt99/v2e/cbY3AAAAACCAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgArgAAAAAEAAAAAEAAAAAAAAQAAAAA4Cc83X1cAwAAANzNGwAAAAAQ4P0+VNXKF5iZtfM3z7bffvvtT96f/uzdg9+A/fbbb7//fs9+42xvAAAAAEAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAXAEAAAAIAAAAAMAFnu4+rgEAAADu5g0AAAAACPB+H6pq5QvMzNr5m2fbb7/99ifvT3/27sFvwH777bfff79nv3G2NwAAAAAggAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAK4AAAAABAAAAABAAAAAAAAEAAAAAOAnPN19XAMAAADczRsAAAAAEOD9PlTVyheYmbXzN8+233777U/en/7s3YPfgP3222+//37PfuNsbwAAAABAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAFwBAAAACAAAAADABZ7uPq4BAAAA7uYNAAAAAAjwfh+qauULzMza+Ztn22+//fYn709/9u7Bb8B+++2333+/Z79xtjcAAAAAIIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACACuAAAAAAQAAAAAQAAAAAAABAAAAADgJzzdfVwDAAAA3M0bAAAAABDg/T5U1coXmJm18zfPtt9+++1P3p/+7N2D34D99ttvv/9+z37jbG8AAAAAQAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEABcAQAAAAgAAAAAwAWe7j6uAQAAAO7mDQAAAAAI8H4fqmrlC8zM2vmbZ9tvv/32J+9Pf/buwW/Afvvtt99/v2e/cbY3AAAAACCAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgArgAAAAAEAAAAAEAAAAAAAAQAAAAA4Cc83X1cAwAAANzNGwAAAAAQ4P0+VNXKF5iZtfM3z7bffvvtT96f/uzdg9+A/fbbb7//fs9+42xvAAAAAEAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAXAEAAAAIAAAAAMAFnu4+rgEAAADu5g0AAAAACPB+H6pq5QvMzNr5m2fbb7/99ifvT3/27sFvwH777bfff79nv3G2NwAAAAAggAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAK4AAAAABAAAAABAAAAAAAAEAAAAAOAnPN19XAMAAADczRsAAAAAEOD9PlTVyheYmbXzN8+233777U/en/7s3YPfgP3222+//37PfuNsbwAAAABAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAFwBAAAACAAAAADABZ7uPq4BAAAA7uYNAAAAAAjwfh+qauULzMza+Ztn22+//fYn709/9u7Bb8B+++2333+/Z79xtjcAAAAAIIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACACuAAAAAAQAAAAAQAAAAAAA/oKnu49rAAAAgLt5AwAAAAACvN+Hqlr5AjOzdv7m2fbbb7/9yfvTn7178Buw33777fff79lvnO0NAAAAAAggAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAKAKwAAAAABAAAAALjA093HNQAAAMDdvAEAAAAAAd7vQ1WtfIGZWTt/82z77bff/uT96c/ePfgN2G+//fb77/fsN872BgAAAAAEEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABwBUAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAA/E+e7j6uAQAAAO7mDQAAAAAI8H4fqmrlC8zM2vmbZ9tvv/32J+9Pf/buwW/Afvvtt99/v2e/cbY3AAAAACCAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgArgAAAAAEAAAAAOACT3cf1wAAAAB38wYAAAAABHi/D1W18gVmZu38zbPtt99++5P3pz979+A3YL/99tvvv9+z3zjbGwAAAAAQQAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAFcAAAAAAgAAAAAgAAAAAAB/wdPdxzUAAADA3bwBAAAAAAHe70NVrXyBmVk7f/Ns++233/7k/enP3j34Ddhvv/32++/37DfO9gYAAAAABBAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAcAVAAAAgAAAAAAAXODp7uMaAAAA4G7eAAAAAIAA7/ehqla+wMysnb95tv32229/8v70Z+8e/Abst99++/33e/YbZ3sDAAAAAAIIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgADgCgAAAEAAAAAAAAQAAAAAQAAAAAAAfsLT3cc1AAAAwN28AQAAAAAB3u9DVa18gZlZO3/zbPvtt9/+5P3pz949+A3Yb7/99vvv9+w3zvYGAAAAAAQQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAHAFQAAAIAAAAAAAFzg6e7jGgAAAOBu3gAAAACAAO/3oapWvsDMrJ2/ebb99ttvf/L+9GfvHvwG7Lfffvv993v2G2d7AwAAAAACCAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAA4AoAAABAAAAAAAAEAAAAAEAAAAAAAH7C093HNQAAAMDdvAEAAAAAAd7vQ1WtfIGZWTt/82z77bff/uT96c/ePfgN2G+//fb77/fsN872BgAAAAAEEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABwBUAAACAAAAAAABc4Onu4xoAAADgbt4AAAAAgADv96GqVr7AzKydv3m2/fbbb3/y/vRn7x78Buy33377/fd79htnewMAAAAAAggAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAOAKAAAAQAAAAAAABAAAAABAAAAAAAB+wtPdxzUAAADA3bwBAAAAAAHe70NVrXyBmVk7f/Ns++233/7k/enP3j34Ddhvv/32++/37DfO9gYAAAAABBAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAcAVAAAAgAAAAAAAXODp7uMaAAAA4G7eAAAAAIAA7/ehqla+wMysnb95tv32229/8v70Z+8e/Abst99++/33e/YbZ3sDAAAAAAIIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgADgCgAAAEAAAAAAAAQAAAAAQAAAAAAAfsLT3cc1AAAAwN28AQAAAAAB3u9DVa18gZlZO3/zbPvtt9/+5P3pz949+A3Yb7/99vvv9+w3zvYGAAAAAAQQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAHAFQAAAIAAAAAAAFzg6e7jGgAAAOBu3gAAAACAAO/3oapWvsDMrJ2/ebb99ttvf/L+9GfvHvwG7Lfffvv993v2G2d7AwAAAAACCAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAA4AoAAABAAAAAAAAEAAAAAEAAAAAAAH7C093HNQAAAMDdvAEAAAAAAd7vQ1WtfIGZWTt/82z77bff/uT96c/ePfgN2G+//fb77/fsN872BgAAAAAEEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABwBUAAACAAAAAAABc4Onu4xoAAADgbt4AAAAAgADv96GqVr7AzKydv3m2/fbbb3/y/vRn7x78Buy33377/fd79htnewMAAAAAAggAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAOAKAAAAQAAAAAAABAAAAADgL3i6+7gGAAAAuJs3AAAAACDAfwMAiKl/KjJoYKUAAAAASUVORK5CYII=");
var topLayerHeight=h/10;var top=new THREE.Mesh(new THREE.BoxGeometry(x,y,topLayerHeight),new THREE.MeshBasicMaterial({color:settings.printer.colors.lines,map:gridTexture}));top.castShadow=false;top.receiveShadow=true;top.position.set(x/2,y/2,-(topLayerHeight/2));var zeorPoint=new THREE.AxisHelper(5);zeorPoint.position.set(0,0,0);base.children.push(top);base.children.push(zeorPoint)};base.setSize(gridSize,x,y,h);return base};var generatePrintbedR=function(r,h,gridSize){var topOffset=2;var bottomOffset=2;var base=new THREE.Mesh(new THREE.CylinderGeometry(r+bottomOffset*2,r+bottomOffset*2,h,64),new THREE.MeshBasicMaterial({color:settings.printer.colors.base}));base.castShadow=false;base.receiveShadow=true;base.visible=false;base.setSize=function(gridSize,r,h){base.geometry=new THREE.CylinderGeometry(r+bottomOffset*2,r+bottomOffset*2,h,64),base.position.set(0,0,-h/2-topOffset/2);base.rotation.x=Math.PI/2;base.drawTop(gridSize,r,h)};base.drawTop=function(gridSize,r,h){base.children=[];var linesTexture=new THREE.ImageUtils.loadTexture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAACXBIWXMAADIAAAAyAAHydpMhAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAEFpaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzExMSA3OS4xNTgzMjUsIDIwMTUvMDkvMTAtMDE6MTA6MjAgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNi0wMy0zMFQxNzoyMTo1MiswMjowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTYtMDMtMzFUMTA6MjM6MDYrMDI6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE2LTAzLTMxVDEwOjIzOjA2KzAyOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo4NjRlMjIxOC1lMGU2LTRjMzEtYTRjNi0xOGI4ZDAyOGI0NDE8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0ZjU5YTNhMC0zNzI1LTExNzktOTU0Mi1kMjE3MjE1YmUxYTM8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDplZjhiZDJlNS0wOTgyLTQ2MmEtYmUyZS02YTYyYmIyMTgyOTA8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZWY4YmQyZTUtMDk4Mi00NjJhLWJlMmUtNmE2MmJiMjE4MjkwPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMwVDE3OjIxOjUyKzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZmQyMDFhZWEtYWZiNS00MWZiLWIyNGMtMWFhZmE5ZjM5OGRhPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMwVDE3OjIyOjM3KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6NjBiMWZkYzUtMGNiZC00MGViLTkxNzgtODhlMjM1Y2JhN2U5PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMxVDEwOjIzOjA2KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPmNvbnZlcnRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5mcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nPC9zdEV2dDpwYXJhbWV0ZXJzPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+ZGVyaXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6cGFyYW1ldGVycz5jb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZzwvc3RFdnQ6cGFyYW1ldGVycz4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ODY0ZTIyMTgtZTBlNi00YzMxLWE0YzYtMThiOGQwMjhiNDQxPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTMxVDEwOjIzOjA2KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjYwYjFmZGM1LTBjYmQtNDBlYi05MTc4LTg4ZTIzNWNiYTdlOTwvc3RSZWY6aW5zdGFuY2VJRD4KICAgICAgICAgICAgPHN0UmVmOmRvY3VtZW50SUQ+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjkwYzA2MGQxLTM3MTktMTE3OS05NTQyLWQyMTcyMTViZTFhMzwvc3RSZWY6ZG9jdW1lbnRJRD4KICAgICAgICAgICAgPHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD54bXAuZGlkOmVmOGJkMmU1LTA5ODItNDYyYS1iZTJlLTZhNjJiYjIxODI5MDwvc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj4xMjgwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj4xMjgwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4zPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjEwMjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MTAyNDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+TF36pQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAXL0lEQVR42uzawY0YMRADQY+h/DM8pkKn4NfiNKoKgc8G5+fnp38AAACA1f6aAAAAAPabth4AAAAAsJwHAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIACYAAAAAAQAAAAAQAAAAAAAbnCSWAEAAACW8wAAAACAB0zbmgEAAAB28wAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEABMAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAwDdOEisAAADAch4AAAAA8IBpWzMAAADAbh4AAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAGACAAAAEAAAAAAAAQAAAAC4wUliBQAAAFjOAwAAAAAeMG1rBgAAANjNAwAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAATAAAAAACAAAAACAAAAAAAAIAAAAA8CucJFYAAACA5TwAAAAA4AHTtmYAAACA3TwAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAcAEAAAAIAAAAAAAAgAAAABwg5PECgAAALCcBwAAAAA8YNrWDAAAALCbBwAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAmAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAvnGSWAEAAACW8wAAAACAB0zbmgEAAAB28wAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEABMAAACAAAAAAAAIAAAAAMANThIrAAAAwHIeAAAAAPCAaVszAAAAwG4eAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgABgAgAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAD4xkliBQAAAFjOAwAAAAAeMG1rBgAAANjNAwAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAATAAAAAACAAAAACAAAAAAADc4SawAAAAAy3kAAAAAwAOmbc0AAAAAu3kAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAoAJAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAOAbJ4kVAAAAYDkPAAAAAHjAtK0ZAAAAYDcPAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAQAAwAQAAAAgAAAAAgAAAAAAA3OAksQIAAAAs5wEAAAAAD5i2NQMAAADs5gEAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIACYAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAgG+cJFYAAACA5TwAAAAA4AHTtmYAAACA3TwAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAcAEAAAAIAAAAAAAAgAAAABwg5PECgAAALCcBwAAAAA8YNrWDAAAALCbBwAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAmAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAvnGSWAEAAACW8wAAAACAB0zbmgEAAAB28wAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEABMAAACAAAAAAAAIAAAAAMANThIrAAAAwHIeAAAAAPCAaVszAAAAwG4eAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgABgAgAAABAAAAAAAAEAAAAAEAAAAACAX+EksQIAAAAs5wEAAAAAD5i2NQMAAADs5gEAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIACYAAAAAAQAAAAAQAAAAAIAbnCRWAAAAgOU8AAAAAOAB07ZmAAAAgN08AAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAHABAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAPC/ThIrAAAAwHIeAAAAAPCAaVszAAAAwG4eAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgABgAgAAABAAAAAAAAEAAAAAuMFJYgUAAABYzgMAAAAAHjBtawYAAADYzQMAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAEwAAAAAAgAAAAAgAAAAAAACAAAAAPArnCRWAAAAgOU8AAAAAOAB07ZmAAAAgN08AAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAHABAAAACAAAAAAAAIAAAAAcIOTxAoAAACwnAcAAAAAPGDa1gwAAACwmwcAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAJgAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAL5xklgBAAAAlvMAAAAAgAdM25oBAAAAdvMAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAATAAAAgAAAAAAACAAAAADADU4SKwAAAMByHgAAAADwgGlbMwAAAMBuHgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAYAIAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAA+MZJYgUAAABYzgMAAAAAHjBtawYAAADYzQMAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAEwAAAAAAgAAAAAgAAAAAAA3OEmsAAAAAMt5AAAAAMADpm3NAAAAALt5AAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAKACQAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAADgGyeJFQAAAGA5DwAAAAB4wLStGQAAAGA3DwAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAEAAMAEAAAAIAAAAAIAAAAAAANzgJLECAAAALOcBAAAAAA+YtjUDAAAA7OYBAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAACAAmAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAIBvnCRWAAAAgOU8AAAAAOAB07ZmAAAAgN08AAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAAHABAAAACAAAAAAAAIAAAAAcIOTxAoAAACwnAcAAAAAPGDa1gwAAACwmwcAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAJgAAAAABAAAAABAAAAAAAAEAAAAAEAAAAAAAL5xklgBAAAAlvMAAAAAgAdM25oBAAAAdvMAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAAAAAAAAEAAAAAEAAAAAAAAQAAAAAQAAAAAAABAAAAABAAAAAAAAEAAAAABAATAAAAgAAAAAAACAAAAADADU4SKwAAAMByHgAAAADwgGlbMwAAAMBuHgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAACAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAAAAgAAAAAgAAAAAAACAAAAACAAAAAAAAIAAAAAIAAAAAAAAgAAAAAgAAAAAIAAYAIAAAAQAAAAAAABAAAAABAAAAAAgF/hJLECAAAALOcBAAAAAA/4NwCZzN528kDN1QAAAABJRU5ErkJggg==");
var topLayerHeight=h/10;var top=new THREE.Mesh(new THREE.CylinderGeometry(r,r,topLayerHeight,64),new THREE.MeshBasicMaterial({color:settings.printer.colors.lines,map:linesTexture}));top.castShadow=false;top.receiveShadow=true;top.position.set(0,0,-(topLayerHeight/2));top.rotation.x=Math.PI/2;var zeorPoint=new THREE.AxisHelper(5);zeorPoint.position.set(0,0,0);base.children.push(top);base.children.push(zeorPoint)};base.setSize(gridSize,r,h);return base};addXyzPrinter();_printBeds["xyz"]=new generatePrintbedXyz(settings.printer.size.x,settings.printer.size.y,settings.printer.bedHeight,settings.printer.grid);scene.add(_printBeds["xyz"]);_printBeds["round"]=new generatePrintbedR(settings.printer.size.r,settings.printer.bedHeight,settings.printer.grid);scene.add(_printBeds["round"]);this.setSelectionIntensity=function(parameters){settings.behaviour.selectionIntensity=parameters.intensity;if(parameters.callback!==undefined){V3.events.render.dispatch();parameters.callback({status:200,data:"OK"})}};this.setGridSize=function(parameters,callback){settings.printer.grid=parameters.size;for(var key in _printBeds){_printBeds[key].drawTop(parameters.size)}V3.events.render.dispatch();callback("OK")};this.showBed=function(parameters,callback){var type=parameters.type||"xyz";settings.printer.type=type;for(var key in _printBeds){if(key===settings.printer.type){_printBeds[key].visible=parameters.show}else{_printBeds[key].visible=false}}that.resetRoot();V3.events.bedChanged.dispatch({printer:settings.printer});V3.events.render.dispatch();callback("OK")};this.showPrintSize=function(parameters,callback){var type=parameters.type||"xyz";settings.printer.type=type;for(var key in _printers){if(key===settings.printer.type){_printers[key].visible=parameters.show}else{_printers[key].visible=false}}that.resetRoot();V3.events.render.dispatch();callback("OK")};this.setBedColor=function(parameters,callback){settings.printer.colors=parameters;callback("OK")};this.setBedHeight=function(parameters,callback){var height=parameters.height||10;settings.printer.bedHeight=height;for(var key in _printBeds){_printBeds[key].setSize(settings.printer.grid,settings.printer.size.x,settings.printer.size.y,height)}V3.events.render.dispatch();callback("OK")};this.setPrinterSize=function(parameters,callback){settings.printer.size.x=parameters.x;settings.printer.size.y=parameters.y;settings.printer.size.z=parameters.z;settings.printer.size.r=parameters.r;var _printBeds_xyz=_printBeds["xyz"];_printBeds["xyz"].setSize(settings.printer.grid,parameters.x,parameters.y,settings.printer.bedHeight);_printers["xyz"].scale.set(parameters.x,parameters.z,parameters.y);_printers["xyz"].position.set(parameters.x/2,parameters.y/2,parameters.z/2);_printBeds["round"].setSize(settings.printer.grid,parameters.r,settings.printer.bedHeight);V3.events.bedChanged.dispatch({printer:settings.printer});V3.events.render.dispatch();callback("OK")};this.showWireframe=function(callback){ModelManager.getModels(function(models){for(var i=0;i<models.length;i++){var mesh=models[i];var egh=new THREE.EdgesHelper(mesh,0);egh.material.linewidth=2;scene.add(egh)}V3.events.render.dispatch();callback("OK")}.bind(this))};this.hideWireframe=function(callback){for(var i=scene.children.length-1;i>=0;i--){var object=scene.children[i];if(object instanceof THREE.EdgesHelper){scene.remove(object)}}V3.events.render.dispatch();callback("OK")};this.resetRoot=function(){if(settings.printer.type==="delta"){ModelManager.setRoot(new THREE.Vector3(0,0,0),{smooth:false})}else if(settings.printer.type==="xyz"){ModelManager.setRoot(new THREE.Vector3(_printBeds.xyz.scale.x/2,_printBeds.xyz.scale.y/2,0),{smooth:false})}};this.refreshScene=function(callback){V3.events.render.dispatch();callback()}};V3=typeof V3==="undefined"?{}:V3;V3.ExportManager=function(scene,api,ModelManager,settings){this.exportScene=function(parameters,callback){if(parameters.type==="ascii"){var exporter=new V3.STLAsciiExporter;var parsed=exporter.parse(ModelManager.getRoot());callback({stl:parsed})}else if(parameters.type==="geometry"){var exporter=new V3.GeometryExporter;var parsed=exporter.parse(ModelManager.getRoot());callback({geometry:parsed})}else if(parameters.type==="binary"){var exporter=new V3.STLBinaryExporter;var parsed=exporter.parse(ModelManager.getRoot());callback({stl:parsed})}V3.events.render.dispatch()}};V3=typeof V3==="undefined"?{}:V3;var speedColors={0:16777215,200:2955337,540:3026018,880:2572426,1220:2654348,1560:2133586,1900:9622320,2240:15063840,2580:14856749,2920:14511662,3260:14557230,3600:11279910};function getSpeedColor(speed){var keys=Object.keys(speedColors);for(var i=0;i<keys.length;i++){if(speed>=keys[i]&&speed<keys[i+1]||!keys[i+1]){return speedColors[keys[i]]}}}var typeColors={};var toolColors={};V3.GcodeManager=function(ModelManager){var minLayer=0;var maxLayer=99999;var maxLineNumber=0;var colorScheme="speed";var positionScheme="layers";this.gcodeToLine=function(gcode){var gcodeMaterial=new THREE.LineBasicMaterial({linewidth:1,vertexColors:THREE.VertexColors});var gcodeGeometry=new THREE.BufferGeometry;var gcodeLine=new THREE.Line(gcodeGeometry,gcodeMaterial,THREE.LinePieces);gcodeLine.positions=new Float32Array(gcode.length*6);gcodeLine.colors=new Float32Array(gcode.length*6);gcodeLine.gcode=gcode;for(var i=0;i<gcode.length;i++){if(!gcode[i].nonExtrusion){gcodeLine.positions[i*6]=gcode[i].startPosition.x;gcodeLine.positions[i*6+1]=gcode[i].startPosition.y;gcodeLine.positions[i*6+2]=gcode[i].startPosition.z;gcodeLine.positions[i*6+3]=gcode[i].endPosition.x;gcodeLine.positions[i*6+4]=gcode[i].endPosition.y;gcodeLine.positions[i*6+5]=gcode[i].endPosition.z;gcodeLine.colors[i*6]=new THREE.Color(getSpeedColor(gcode[i].speed)).r;gcodeLine.colors[i*6+1]=new THREE.Color(getSpeedColor(gcode[i].speed)).g;gcodeLine.colors[i*6+2]=new THREE.Color(getSpeedColor(gcode[i].speed)).b;gcodeLine.colors[i*6+3]=new THREE.Color(getSpeedColor(gcode[i].speed)).r;gcodeLine.colors[i*6+4]=new THREE.Color(getSpeedColor(gcode[i].speed)).g;gcodeLine.colors[i*6+5]=new THREE.Color(getSpeedColor(gcode[i].speed)).b}}gcodeGeometry.addAttribute("position",new THREE.BufferAttribute(gcodeLine.positions,3));gcodeGeometry.addAttribute("color",new THREE.BufferAttribute(gcodeLine.colors,3));return gcodeLine};this.setMinLayer=function(parameters,callback){minLayer=parameters.minLayer;positionScheme="layers";this.redrawPositions("layers",callback)};this.setMaxLayer=function(parameters,callback){maxLayer=parameters.maxLayer;positionScheme="layers";this.redrawPositions("layers",callback)};this.setMaxLineNumber=function(parameters,callback){maxLineNumber=parameters.maxLineNumber;positionScheme="lines";this.redrawPositions("lines",callback)};this.getInfo=function(callback){var root=ModelManager.getRoot();var gcodeObject=null;root.traverse(function(object){if(object.type==="gcode"){gcodeObject=object}});return callback({layers:gcodeObject.layers,volumes:gcodeObject.volumes,lines:gcodeObject.lines})};this.setColorScheme=function(parameters,callback){if(parameters.colorScheme==="speed"||parameters.colorScheme==="type"||parameters.colorScheme==="tool"){colorScheme=parameters.colorScheme;this.redrawColors(callback)}else{callback(null,new Error("parameters.colorScheme should be speed, type or tool, "+parameters.colorScheme+" given"))}};this.applyPositions=function(gcodeObject,scheme){for(var i=0;i<gcodeObject.gcode.length;i++){if(!gcodeObject.gcode[i].nonExtrusion){if(scheme==="layers"){if(gcodeObject.gcode[i].layer<minLayer||gcodeObject.gcode[i].layer>maxLayer){gcodeObject.positions[i*6]=0;gcodeObject.positions[i*6+1]=0;gcodeObject.positions[i*6+2]=0;gcodeObject.positions[i*6+3]=0;gcodeObject.positions[i*6+4]=0;gcodeObject.positions[i*6+5]=0}else{gcodeObject.positions[i*6]=gcodeObject.gcode[i].startPosition.x;gcodeObject.positions[i*6+1]=gcodeObject.gcode[i].startPosition.y;gcodeObject.positions[i*6+2]=gcodeObject.gcode[i].startPosition.z;gcodeObject.positions[i*6+3]=gcodeObject.gcode[i].endPosition.x;gcodeObject.positions[i*6+4]=gcodeObject.gcode[i].endPosition.y;gcodeObject.positions[i*6+5]=gcodeObject.gcode[i].endPosition.z}}else if(scheme==="lines"){if(gcodeObject.gcode[i].lineNumber>maxLineNumber){gcodeObject.positions[i*6]=0;gcodeObject.positions[i*6+1]=0;gcodeObject.positions[i*6+2]=0;gcodeObject.positions[i*6+3]=0;gcodeObject.positions[i*6+4]=0;gcodeObject.positions[i*6+5]=0}else{gcodeObject.positions[i*6]=gcodeObject.gcode[i].startPosition.x;gcodeObject.positions[i*6+1]=gcodeObject.gcode[i].startPosition.y;gcodeObject.positions[i*6+2]=gcodeObject.gcode[i].startPosition.z;gcodeObject.positions[i*6+3]=gcodeObject.gcode[i].endPosition.x;gcodeObject.positions[i*6+4]=gcodeObject.gcode[i].endPosition.y;gcodeObject.positions[i*6+5]=gcodeObject.gcode[i].endPosition.z}}}}gcodeObject.geometry.attributes.position.needsUpdate=true};this.redrawPositions=function(scheme,callback){var root=ModelManager.getRoot();var gcodeObject=null;root.traverse(function(object){if(object.type==="gcode"){gcodeObject=object}});this.applyPositions(gcodeObject,scheme);V3.events.geometryChanged.dispatch({geometry:gcodeObject.geometry});V3.events.modelChanged.dispatch({model:gcodeObject});if(callback)return callback({model:gcodeObject});return gcodeObject};this.applyColors=function(gcodeObject){for(var i=0;i<gcodeObject.gcode.length;i++){if(colorScheme==="speed"){gcodeObject.colors[i*6]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).r;gcodeObject.colors[i*6+1]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).g;gcodeObject.colors[i*6+2]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).b;gcodeObject.colors[i*6+3]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).r;gcodeObject.colors[i*6+4]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).g;gcodeObject.colors[i*6+5]=new THREE.Color(getSpeedColor(gcodeObject.gcode[i].speed)).b}}gcodeObject.geometry.attributes.color.needsUpdate=true};this.redrawColors=function(callback){var root=ModelManager.getRoot();var gcodeObject=null;root.traverse(function(object){if(object.type==="gcode"){gcodeObject=object}});this.applyColors(gcodeObject);V3.events.modelChanged.dispatch({model:gcodeObject});if(callback)return callback({model:gcodeObject});return gcodeObject}};V3=typeof V3==="undefined"?{}:V3;V3.Model=function(parameters){THREE.Mesh.call(this);this.type="Model";this.geometry=parameters.geometry!==undefined?parameters.geometry:new THREE.Geometry;this.geometry.dynamic=true;this.material=new THREE.MeshPhongMaterial({specular:new THREE.Color(.2,.2,.2),envmap:false,fresnel0:.067,gloss:1,roughness:1,smooth:true,shininess:50});this.castShadow=true;this.receiveShadow=true;this.baseColor=(new THREE.Color).setRGB(1,1,1);this.selected=false;this.transforms={allowTranslate:false,allowRotate:false,allowScale:false,transformMode:0};this.transformationHistory=[];this.transformationHistoryIndex=-1;var bounds=new THREE.Box3;bounds.setFromObject(this);this.originalBounds=bounds;this.currentBounds=bounds};V3.Model.prototype=Object.create(THREE.Mesh.prototype);V3.Model.prototype.constructor=V3.Model;V3.Model.prototype.calculateNewBounds=function(){var bounds=new THREE.Box3;bounds.setFromObject(this);this.currentBounds=bounds};V3.Model.prototype.getTransformations=function(){this.calculateNewBounds();this.calculateNewBounds();return{modelId:this.modelId,position:{x:parseInt(Math.floor(this.position.x*1e3)),y:parseInt(Math.floor(this.position.y*1e3)),z:parseInt(Math.floor(this.position.z*1e3))},rotation:{x:parseFloat(this.rotation._x.toFixed(3)),y:parseFloat(this.rotation._y.toFixed(3)),z:parseFloat(this.rotation._z.toFixed(3))},scale:{x:parseFloat(this.scale.x.toFixed(3)),y:parseFloat(this.scale.y.toFixed(3)),z:parseFloat(this.scale.z.toFixed(3))},color:{r:this.baseColor.r*255,g:this.baseColor.g*255,b:this.baseColor.b*255},aboveBed:this.currentBounds.min.z<=.05?false:true,belowBed:this.currentBounds.min.z>=-.05?false:true}};V3.Model.prototype.saveTransformations=function(){this.transformationHistoryIndex+=1;this.transformationHistory.splice(this.transformationHistoryIndex,0,this.getTransformations())};V3.Model.prototype.undoTransformation=function(){console.log(this.transformationHistoryIndex);this.applyTransformationAtIndex(this.transformationHistoryIndex);this.transformationHistoryIndex-=1;if(this.transformationHistoryIndex<0){this.transformationHistoryIndex=0}};V3.Model.prototype.redoTransformation=function(){this.applyTransformationAtIndex(this.transformationHistoryIndex);this.transformationHistoryIndex+=1;if(this.transformationHistoryIndex>this.transformationHistory.length-1){this.transformationHistoryIndex=this.transformationHistory.length-1}};V3.Model.prototype.applyTransformationAtIndex=function(index){var transformationsAtIndex=this.transformationHistory[index];this.position.set(transformationsAtIndex.position.x/1e3,transformationsAtIndex.position.y/1e3,transformationsAtIndex.position.z/1e3);this.rotation.set(transformationsAtIndex.rotation.x,transformationsAtIndex.rotation.y,transformationsAtIndex.rotation.z);this.scale.set(transformationsAtIndex.scale.x,transformationsAtIndex.scale.y,transformationsAtIndex.scale.z)};V3.Model.prototype.render=function(){this.material.color=this.baseColor;if(this.selected){this.material.emissive=new THREE.Color(this.material.color.r*V3.settings.behaviour.selectionIntensity,this.material.color.g*V3.settings.behaviour.selectionIntensity,this.material.color.b*V3.settings.behaviour.selectionIntensity)}else{this.material.emissive=new THREE.Color(0,0,0)}};V3.TransformControls=function(camera,domElement){THREE.Object3D.call(this);domElement=domElement!==undefined?domElement:document;this.gizmo={};this.gizmo["translate"]=new THREE.TransformGizmoTranslate;this.gizmo["rotate"]=new THREE.TransformGizmoRotate;this.gizmo["scale"]=new THREE.TransformGizmoScale;this.add(this.gizmo["translate"]);this.add(this.gizmo["rotate"]);this.add(this.gizmo["scale"]);this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.object=undefined;this.snap=10;this.snapRotation=Math.PI/8;this.snapScale=10;this.space="world";this.size=1;this.axis=null;var scope=this;var _dragging=false;var _mode="translate";var _plane="XY";var changeEvent={type:"change"};var mouseDownEvent={type:"mouseDown"};var mouseUpEvent={type:"mouseUp",mode:_mode};var objectChangeEvent={type:"objectChange"};var ray=new THREE.Raycaster;var pointerVector=new THREE.Vector3;var point=new THREE.Vector3;var offset=new THREE.Vector3;var rotation=new THREE.Vector3;var snappedRotation=new THREE.Vector3;var offsetRotation=new THREE.Vector3;var scale=1;var lookAtMatrix=new THREE.Matrix4;var eye=new THREE.Vector3;var tempMatrix=new THREE.Matrix4;var tempVector=new THREE.Vector3;var tempQuaternion=new THREE.Quaternion;var unitX=new THREE.Vector3(1,0,0);var unitY=new THREE.Vector3(0,1,0);var unitZ=new THREE.Vector3(0,0,1);var quaternionXYZ=new THREE.Quaternion;var quaternionX=new THREE.Quaternion;var quaternionY=new THREE.Quaternion;var quaternionZ=new THREE.Quaternion;var quaternionE=new THREE.Quaternion;var oldPosition=new THREE.Vector3;var oldScale=new THREE.Vector3;var oldRotationMatrix=new THREE.Matrix4;var parentRotationMatrix=new THREE.Matrix4;var parentScale=new THREE.Vector3;var worldPosition=new THREE.Vector3;var worldRotation=new THREE.Euler;var worldRotationMatrix=new THREE.Matrix4;var camPosition=new THREE.Vector3;var camRotation=new THREE.Euler;domElement.addEventListener("mousedown",onPointerDown,false);domElement.addEventListener("touchstart",onPointerDown,false);domElement.addEventListener("mousemove",onPointerHover,false);domElement.addEventListener("touchmove",onPointerHover,false);domElement.addEventListener("mousemove",onPointerMove,false);domElement.addEventListener("touchmove",onPointerMove,false);domElement.addEventListener("mouseup",onPointerUp,false);domElement.addEventListener("mouseout",onPointerUp,false);domElement.addEventListener("touchend",onPointerUp,false);domElement.addEventListener("touchcancel",onPointerUp,false);domElement.addEventListener("touchleave",onPointerUp,false);this.attach=function(object){scope.object=object;this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.gizmo[_mode].show();scope.update()};this.detach=function(object){scope.object=undefined;this.axis=null;this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide()};this.setMode=function(mode){_mode=mode?mode:_mode;if(_mode=="scale")scope.space="local";this.gizmo["translate"].hide();this.gizmo["rotate"].hide();this.gizmo["scale"].hide();this.gizmo[_mode].show();this.update();scope.dispatchEvent(changeEvent)};this.setSnap=function(snap){scope.snap=snap};this.setSnapRotation=function(snap){scope.snapRotation=snap};this.setSnapScale=function(snap){scope.snapScale=snap};this.setSize=function(size){scope.size=size;this.update();scope.dispatchEvent(changeEvent)};this.setSpace=function(space){scope.space=space;this.update();scope.dispatchEvent(changeEvent)};this.update=function(){if(scope.object===undefined)return;scope.object.updateMatrixWorld();worldPosition.setFromMatrixPosition(scope.object.matrixWorld);worldRotation.setFromRotationMatrix(tempMatrix.extractRotation(scope.object.matrixWorld));camera.updateMatrixWorld();camPosition.setFromMatrixPosition(camera.matrixWorld);camRotation.setFromRotationMatrix(tempMatrix.extractRotation(camera.matrixWorld));scale=worldPosition.distanceTo(camPosition)/6*scope.size;this.position.copy(worldPosition);this.scale.set(scale,scale,scale);eye.copy(camPosition).sub(worldPosition).normalize();if(scope.space=="local")this.gizmo[_mode].update(worldRotation,eye);else if(scope.space=="world")this.gizmo[_mode].update(new THREE.Euler,eye);this.gizmo[_mode].highlight(scope.axis)};function onPointerHover(event){if(scope.object===undefined||_dragging===true)return;event.preventDefault();var pointer=event.changedTouches?event.changedTouches[0]:event;var intersect=intersectObjects(pointer,scope.gizmo[_mode].pickers.children);var axis=null;if(intersect){axis=intersect.object.name}if(scope.axis!==axis){scope.axis=axis;scope.update();scope.dispatchEvent(changeEvent)}}function onPointerDown(event){if(scope.object===undefined||_dragging===true)return;event.preventDefault();event.stopPropagation();var pointer=event.changedTouches?event.changedTouches[0]:event;if(pointer.button===0||pointer.button===undefined){var intersect=intersectObjects(pointer,scope.gizmo[_mode].pickers.children);if(intersect){scope.dispatchEvent(mouseDownEvent);scope.axis=intersect.object.name;scope.update();eye.copy(camPosition).sub(worldPosition).normalize();scope.gizmo[_mode].setActivePlane(scope.axis,eye);var planeIntersect=intersectObjects(pointer,[scope.gizmo[_mode].activePlane]);oldPosition.copy(scope.object.position);oldScale.copy(scope.object.scale);oldRotationMatrix.extractRotation(scope.object.matrix);worldRotationMatrix.extractRotation(scope.object.matrixWorld);parentRotationMatrix.extractRotation(scope.object.parent.matrixWorld);parentScale.setFromMatrixScale(tempMatrix.getInverse(scope.object.parent.matrixWorld));offset.copy(planeIntersect.point)}}_dragging=true}function onPointerMove(event){if(scope.object===undefined||scope.axis===null||_dragging===false)return;event.preventDefault();event.stopPropagation();var pointer=event.changedTouches?event.changedTouches[0]:event;var planeIntersect=intersectObjects(pointer,[scope.gizmo[_mode].activePlane]);point.copy(planeIntersect.point);if(_mode=="translate"){point.sub(offset);point.multiply(parentScale);if(scope.space=="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis.search("X")==-1)point.x=0;if(scope.axis.search("Y")==-1)point.y=0;if(scope.axis.search("Z")==-1)point.z=0;point.applyMatrix4(oldRotationMatrix);scope.object.position.copy(oldPosition);scope.object.position.add(point)}if(scope.space=="world"||scope.axis.search("XYZ")!=-1){if(scope.axis.search("X")==-1)point.x=0;if(scope.axis.search("Y")==-1)point.y=0;if(scope.axis.search("Z")==-1)point.z=0;point.applyMatrix4(tempMatrix.getInverse(parentRotationMatrix));scope.object.position.copy(oldPosition);scope.object.position.add(point)}if(scope.snap!==null){if(scope.axis.search("X")!=-1)scope.object.position.x=Math.round(scope.object.position.x/scope.snap)*scope.snap;if(scope.axis.search("Y")!=-1)scope.object.position.y=Math.round(scope.object.position.y/scope.snap)*scope.snap;if(scope.axis.search("Z")!=-1)scope.object.position.z=Math.round(scope.object.position.z/scope.snap)*scope.snap}}else if(_mode=="scale"){point.sub(offset);point.multiply(parentScale);if(scope.space=="local"){if(scope.axis=="XYZ"){if(scope.object.originalBounds!==undefined){var originalX=scope.object.originalBounds.max.x-scope.object.originalBounds.min.x;var originalY=scope.object.originalBounds.max.y-scope.object.originalBounds.min.y;var originalZ=scope.object.originalBounds.max.z-scope.object.originalBounds.min.z;var currentX=oldScale.x*originalX+point.y;var currentY=oldScale.y*originalY+point.y;var currentZ=oldScale.z*originalZ+point.y;if(scope.snapScale!==null){scope.object.scale.x=Math.round(currentX/scope.snapScale)*scope.snapScale/originalX;scope.object.scale.y=scope.object.scale.x*(oldScale.y/oldScale.x);scope.object.scale.z=scope.object.scale.x*(oldScale.z/oldScale.x)}else{scope.object.scale.x=currentX;scope.object.scale.y=currentY;scope.object.scale.z=currentZ}}else{scope.object.scale.x=oldScale.x*(1+point.y/50);scope.object.scale.y=oldScale.y*(1+point.y/50);scope.object.scale.z=oldScale.z*(1+point.y/50)}}else{point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis=="X"){if(scope.object.originalBounds!==undefined){var original=scope.object.originalBounds.max.x-scope.object.originalBounds.min.x;var current=oldScale.x*original+point.x;if(scope.snapScale!==null){scope.object.scale.x=Math.round(current/scope.snapScale)*scope.snapScale/original}else{scope.object.scale.x=current}}else{scope.object.scale.x=oldScale.x*(1+point.x/50)}}if(scope.axis=="Y"){if(scope.object.originalBounds!==undefined){var original=scope.object.originalBounds.max.y-scope.object.originalBounds.min.y;var current=oldScale.y*original+point.y;if(scope.snapScale!==null){scope.object.scale.y=Math.round(current/scope.snapScale)*scope.snapScale/original}else{scope.object.scale.y=current}}else{scope.object.scale.y=oldScale.y*(1+point.y/50)}}if(scope.axis=="Z"){if(scope.object.originalBounds!==undefined){var original=scope.object.originalBounds.max.z-scope.object.originalBounds.min.z;var current=oldScale.z*original+point.z;if(scope.snapScale!==null){scope.object.scale.z=Math.round(current/scope.snapScale)*scope.snapScale/original}else{scope.object.scale.z=current}}else{scope.object.scale.z=oldScale.z*(1+point.z/50)}}}if(scope.object.scale.x<=1e-4)scope.object.scale.x=1e-4;if(scope.object.scale.y<=1e-4)scope.object.scale.y=1e-4;if(scope.object.scale.z<=1e-4)scope.object.scale.z=1e-4}}else if(_mode=="rotate"){point.sub(worldPosition);point.multiply(parentScale);tempVector.copy(offset).sub(worldPosition);tempVector.multiply(parentScale);if(scope.axis=="E"){point.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionE.setFromAxisAngle(eye,rotation.z-offsetRotation.z);quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionE);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}else if(scope.axis=="XYZE"){quaternionE.setFromEuler(point.clone().cross(tempVector).normalize());tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionX.setFromAxisAngle(quaternionE,-point.clone().angleTo(tempVector));quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}else if(scope.space=="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));quaternionXYZ.setFromRotationMatrix(oldRotationMatrix);snappedRotation=rotation;snappedRotation.sub(offsetRotation);if(scope.snapRotation!==null){snappedRotation.x=Math.round(snappedRotation.x/scope.snapRotation)*scope.snapRotation;snappedRotation.y=Math.round(snappedRotation.y/scope.snapRotation)*scope.snapRotation;snappedRotation.z=Math.round(snappedRotation.z/scope.snapRotation)*scope.snapRotation}quaternionX.setFromAxisAngle(unitX,snappedRotation.x);quaternionY.setFromAxisAngle(unitY,snappedRotation.y);quaternionZ.setFromAxisAngle(unitZ,snappedRotation.z);if(scope.axis=="X")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionX);if(scope.axis=="Y")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionY);if(scope.axis=="Z")quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionZ);scope.object.quaternion.copy(quaternionXYZ)}else if(scope.space=="world"){rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));snappedRotation=rotation;snappedRotation.sub(offsetRotation);if(scope.snapRotation!==null){snappedRotation.x=Math.round(snappedRotation.x/scope.snapRotation)*scope.snapRotation;snappedRotation.y=Math.round(snappedRotation.y/scope.snapRotation)*scope.snapRotation;snappedRotation.z=Math.round(snappedRotation.z/scope.snapRotation)*scope.snapRotation}quaternionX.setFromAxisAngle(unitX,snappedRotation.x);quaternionY.setFromAxisAngle(unitY,snappedRotation.y);quaternionZ.setFromAxisAngle(unitZ,snappedRotation.z);quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);if(scope.axis=="X")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);if(scope.axis=="Y")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionY);if(scope.axis=="Z")tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionZ);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion)}}scope.update();scope.dispatchEvent(changeEvent);scope.dispatchEvent(objectChangeEvent)}function onPointerUp(event){offsetRotation;if(_dragging&&scope.axis!==null){mouseUpEvent.mode=_mode;scope.dispatchEvent(mouseUpEvent)}_dragging=false;onPointerHover(event)}function intersectObjects(pointer,objects){var rect=domElement.getBoundingClientRect();var x=(pointer.clientX-rect.left)/rect.width;var y=(pointer.clientY-rect.top)/rect.height;pointerVector.set(x*2-1,-(y*2)+1,.5);pointerVector.unproject(camera);ray.set(camPosition,pointerVector.sub(camPosition).normalize());var intersections=ray.intersectObjects(objects,true);return intersections[0]?intersections[0]:false}};V3.TransformControls.prototype=Object.create(THREE.Object3D.prototype);V3.TransformControls.prototype.constructor=V3.TransformControls;V3=typeof V3==="undefined"?{}:V3;V3.GeometryExporter=function(){};V3.GeometryExporter.prototype={parse:function(root){var self=this;var geometries=[];root.traverse(function(object){if(object instanceof THREE.Mesh){var geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){geometry=(new THREE.Geometry).fromBufferGeometry(object.geometry)}var newGeometry=geometry.clone();var transformation=(new THREE.Matrix4).makeRotationX(Math.PI/2);newGeometry.applyMatrix(object.matrixWorld);newGeometry.applyMatrix(transformation);geometries.push({faces:newGeometry.faces,vertices:newGeometry.vertices})}});return JSON.stringify(geometries)}};V3=typeof V3==="undefined"?{}:V3;V3.STLAsciiExporter=function(){};V3.STLAsciiExporter.prototype={parse:function(root){var self=this;var stl="";stl+="solid exported\n";root.traverse(function(object){if(object instanceof THREE.Mesh){var geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){geometry=(new THREE.Geometry).fromBufferGeometry(object.geometry)}var vertices=geometry.vertices;var faces=geometry.faces;for(var i=0;i<faces.length;i++){stl+="facet normal "+self.stringifyVector(faces[i].normal)+" \n";stl+="outer loop \n";stl+=self.stringifyVertex(vertices[faces[i].a]);stl+=self.stringifyVertex(vertices[faces[i].b]);stl+=self.stringifyVertex(vertices[faces[i].c]);stl+="endloop \n";stl+="endfacet \n"}}});stl+="endsolid";return stl},stringifyVector:function(vec){return""+vec.x+" "+vec.y+" "+vec.z},stringifyVertex:function(vec){return"vertex "+this.stringifyVector(vec)+" \n"}};V3=typeof V3==="undefined"?{}:V3;V3.STLBinaryExporter=function(){};V3.STLBinaryExporter.prototype={parse:function(root){var self=this;var triangles=0;root.traverse(function(object){var geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){geometry=(new THREE.Geometry).fromBufferGeometry(object.geometry)}triangles+=geometry.faces.length});var offset=80;var bufferLength=triangles*2+triangles*3*4*4+80+4;var arrayBuffer=new ArrayBuffer(bufferLength);var header="Made with Viewer3 - Formide's 3D viewer and editor.";var output=new DataView(arrayBuffer);for(var i=0;i<80&&i<header.length;i++){output.setUint8(i,header.charCodeAt(i))}output.setUint32(offset,triangles,true);offset+=4;root.traverse(function(object){var geometry=object.geometry;var matrixWorld=object.matrixWorld;if(geometry instanceof THREE.BufferGeometry){geometry=(new THREE.Geometry).fromBufferGeometry(object.geometry)}var vertices=geometry.vertices;var faces=geometry.faces;normalMatrixWorld.getNormalMatrix(matrixWorld);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];vector.copy(face.normal).applyMatrix3(normalMatrixWorld).normalize();output.setFloat32(offset,vector.x,true);offset+=4;output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4;var indices=[face.a,face.b,face.c];for(var j=0;j<3;j++){vector.copy(vertices[indices[j]]).applyMatrix4(matrixWorld);output.setFloat32(offset,vector.x,true);offset+=4;output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4}output.setUint16(offset,0,true);offset+=2}});return output}};(function(w){var k=function(b,c){typeof c=="undefined"&&(c={});this.init(b,c)},a=k.prototype,o,p=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],x=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,v=navigator.appVersion.indexOf("MSIE")!==-1&&parseFloat(navigator.appVersion.split("MSIE")[1])===8?true:false,y=!!document.createElement("canvas").getContext,q=true,n=function(b,c,a){var b=document.createElement(b),d;for(d in a)b[d]=a[d];typeof c!=="undefined"&&c.appendChild(b);return b},m=function(b,c){for(var a in c)b.style[a]=c[a];return b},t=function(b,c){for(var a in c)b.setAttribute(a,c[a]);return b},u=function(b,c,a,d){b.save();b.translate(c,a);b.rotate(d);b.translate(-c,-a);b.beginPath()};a.init=function(b,c){if(typeof c.safeVML==="boolean")q=c.safeVML;try{this.mum=document.getElementById(b)!==void 0?document.getElementById(b):document.body}catch(a){this.mum=document.body}c.id=typeof c.id!=="undefined"?c.id:"canvasLoader";this.cont=n("div",this.mum,{id:c.id});if(y)o=p[0],this.can=n("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=m(n("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{o=p[1];if(typeof k.vmlSheet==="undefined"){
document.getElementsByTagName("head")[0].appendChild(n("style"));k.vmlSheet=document.styleSheets[document.styleSheets.length-1];var d=["group","oval","roundrect","fill"],e;for(e in d)k.vmlSheet.addRule(d[e],"behavior:url(#default#VML); position:absolute;")}this.vml=n("group",this.cont)}this.setColor(this.color);this.draw();m(this.cont,{display:"none"})};a.cont={};a.can={};a.con={};a.cCan={};a.cCon={};a.timer={};a.activeId=0;a.diameter=40;a.setDiameter=function(b){this.diameter=Math.round(Math.abs(b));this.redraw()};a.getDiameter=function(){return this.diameter};a.cRGB={};a.color="#000000";a.setColor=function(b){this.color=x.test(b)?b:"#000000";this.cRGB=this.getRGB(this.color);this.redraw()};a.getColor=function(){return this.color};a.shape=f[0];a.setShape=function(b){for(var c in f)if(b===f[c]){this.shape=b;this.redraw();break}};a.getShape=function(){return this.shape};a.density=40;a.setDensity=function(b){this.density=q&&o===p[1]?Math.round(Math.abs(b))<=40?Math.round(Math.abs(b)):40:Math.round(Math.abs(b));if(this.density>360)this.density=360;this.activeId=0;this.redraw()};a.getDensity=function(){return this.density};a.range=1.3;a.setRange=function(b){this.range=Math.abs(b);this.redraw()};a.getRange=function(){return this.range};a.speed=2;a.setSpeed=function(b){this.speed=Math.round(Math.abs(b))};a.getSpeed=function(){return this.speed};a.fps=24;a.setFPS=function(b){this.fps=Math.round(Math.abs(b));this.reset()};a.getFPS=function(){return this.fps};a.getRGB=function(b){b=b.charAt(0)==="#"?b.substring(1,7):b;return{r:parseInt(b.substring(0,2),16),g:parseInt(b.substring(2,4),16),b:parseInt(b.substring(4,6),16)}};a.draw=function(){var b=0,c,a,d,e,h,k,j,r=this.density,s=Math.round(r*this.range),l,i,q=0;i=this.cCon;var g=this.diameter;if(o===p[0]){i.clearRect(0,0,1e3,1e3);t(this.can,{width:g,height:g});for(t(this.cCan,{width:g,height:g});b<r;){l=b<=s?1-1/s*b:l=0;k=270-360/r*b;j=k/180*Math.PI;i.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+l.toString()+")";switch(this.shape){case f[0]:case f[1]:c=g*.07;e=g*.47+Math.cos(j)*(g*.47-c)-g*.47;h=g*.47+Math.sin(j)*(g*.47-c)-g*.47;i.beginPath();this.shape===f[1]?i.arc(g*.5+e,g*.5+h,c*l,0,Math.PI*2,false):i.arc(g*.5+e,g*.5+h,c,0,Math.PI*2,false);break;case f[2]:c=g*.12;e=Math.cos(j)*(g*.47-c)+g*.5;h=Math.sin(j)*(g*.47-c)+g*.5;u(i,e,h,j);i.fillRect(e,h-c*.5,c,c);break;case f[3]:case f[4]:a=g*.3,d=a*.27,e=Math.cos(j)*(d+(g-d)*.13)+g*.5,h=Math.sin(j)*(d+(g-d)*.13)+g*.5,u(i,e,h,j),this.shape===f[3]?i.fillRect(e,h-d*.5,a,d):(c=d*.55,i.moveTo(e+c,h-d*.5),i.lineTo(e+a-c,h-d*.5),i.quadraticCurveTo(e+a,h-d*.5,e+a,h-d*.5+c),i.lineTo(e+a,h-d*.5+d-c),i.quadraticCurveTo(e+a,h-d*.5+d,e+a-c,h-d*.5+d),i.lineTo(e+c,h-d*.5+d),i.quadraticCurveTo(e,h-d*.5+d,e,h-d*.5+d-c),i.lineTo(e,h-d*.5+c),i.quadraticCurveTo(e,h-d*.5,e+c,h-d*.5))}i.closePath();i.fill();i.restore();++b}}else{m(this.cont,{width:g,height:g});m(this.vml,{width:g,height:g});switch(this.shape){case f[0]:case f[1]:j="oval";c=140;break;case f[2]:j="roundrect";c=120;break;case f[3]:case f[4]:j="roundrect",c=300}a=d=c;e=500-d;for(h=-d*.5;b<r;){l=b<=s?1-1/s*b:l=0;k=270-360/r*b;switch(this.shape){case f[1]:a=d=c*l;e=500-c*.5-c*l*.5;h=(c-c*l)*.5;break;case f[0]:case f[2]:v&&(h=0,this.shape===f[2]&&(e=500-d*.5));break;case f[3]:case f[4]:a=c*.95,d=a*.28,v?(e=0,h=500-d*.5):(e=500-a,h=-d*.5),q=this.shape===f[4]?.6:0}i=t(m(n("group",this.vml),{width:1e3,height:1e3,rotation:k}),{coordsize:"1000,1000",coordorigin:"-500,-500"});i=m(n(j,i,{stroked:false,arcSize:q}),{width:a,height:d,top:h,left:e});n("fill",i,{color:this.color,opacity:l});++b}}this.tick(true)};a.clean=function(){if(o===p[0])this.con.clearRect(0,0,1e3,1e3);else{var b=this.vml;if(b.hasChildNodes())for(;b.childNodes.length>=1;)b.removeChild(b.firstChild)}};a.redraw=function(){this.clean();this.draw()};a.reset=function(){typeof this.timer==="number"&&(this.hide(),this.show())};a.tick=function(b){var a=this.con,f=this.diameter;b||(this.activeId+=360/this.density*this.speed);o===p[0]?(a.clearRect(0,0,f,f),u(a,f*.5,f*.5,this.activeId/180*Math.PI),a.drawImage(this.cCan,0,0,f,f),a.restore()):(this.activeId>=360&&(this.activeId-=360),m(this.vml,{rotation:this.activeId}))};a.show=function(){if(typeof this.timer!=="number"){var a=this;this.timer=self.setInterval(function(){a.tick()},Math.round(1e3/this.fps));m(this.cont,{display:"block"})}};a.hide=function(){typeof this.timer==="number"&&(clearInterval(this.timer),delete this.timer,m(this.cont,{display:"none"}))};a.kill=function(){var a=this.cont;typeof this.timer==="number"&&this.hide();o===p[0]?(a.removeChild(this.can),a.removeChild(this.cCan)):a.removeChild(this.vml);for(var c in this)delete this[c]};w.CanvasLoader=k})(window);V3=typeof V3==="undefined"?{}:V3;function handleCallback(response,err){console.log(response);if(err)console.error(err)}V3.SDK=function(canvas,scene,renderer,api,camera,managers){this.scene=scene;this.camera=camera;this.api=api;this.setCanvasSize=function(parameters,cb){cb=cb||handleCallback;camera.aspect=parameters.width/parameters.height;camera.updateProjectionMatrix();renderer.setSize(parameters.width,parameters.height);return cb("OK")};this.setBackgroundColor=function(parameters,cb){cb=cb||handleCallback;managers.AmbientManager.setBackgroundColor({r:parameters.r,g:parameters.g,b:parameters.b},cb)};this.setBedColor=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.setBedColor(parameters,cb)};this.setCameraAutoRotationTimeout=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.setRotationTimeout(parameters,cb)};this.setCameraAutoRotationSpeed=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.setRotationSpeed(parameters,cb)};this.setCameraType=function(parameters,cb){cb=cb||handleCallback;managers.CameraManager.setCameraType(parameters,cb)};this.setGridSize=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.setGridSize(parameters,cb)};this.snapToGrid=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.setTransformSnap(parameters,cb)};this.setBedHeight=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.setBedHeight(parameters,cb)};this.showPrintSize=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.showPrintSize(parameters,cb)};this.setPrintSize=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.setPrinterSize(parameters,cb)};this.showPrintBed=function(parameters,cb){cb=cb||handleCallback;managers.HelperManager.showBed(parameters,cb)};this.showWireframe=function(parameters,cb){cb=cb||handleCallback;if(parameters.show){managers.HelperManager.showWireframe(cb)}else{managers.HelperManager.hideWireframe(cb)}};this.refreshScene=function(cb){cb=cb||handleCallback;managers.HelperManager.refreshScene(cb)};this.centerCameraOnModel=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.centerCameraOnModel(parameters,cb)};this.centerCameraOnBed=function(cb){cb=cb||handleCallback;managers.ControlsManager.centerOnBed(cb)};this.switchSideView=function(parameters,cb){cb=cb||handleCallback;managers.CameraManager.switchSideView(parameters,cb)};this.resetCameraPosition=function(parameters,cb){cb=cb||handleCallback;managers.CameraManager.resetCameraPosition(parameters,cb)};this.getModel=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.getModel(parameters.modelId,cb)};this.getModels=function(cb){cb=cb||handleCallback;managers.ModelManager.getModels(cb)};this.getSelectedModel=function(cb){cb=cb||handleCallback;managers.ModelManager.getSelectedModel(cb)};this.getModelTransformations=function(parameters,cb){cb=cb||handleCallback;managers.TransformManager.getTransformations(parameters,cb)};this.addModel=function(parameters,cb){cb=cb||handleCallback;parameters.type=parameters.type||"STL";if(parameters.contents){managers.ModelManager.addModelByContents(parameters.contents,{type:parameters.type,resetRoot:parameters.resetRoot,name:parameters.name},cb)}else if(parameters.url){managers.ModelManager.addModelByUrl(parameters.url,{type:parameters.type,resetRoot:parameters.resetRoot,name:parameters.name},cb)}else if(parameters.geometry){managers.ModelManager.addGeometry(parameters.geometry,{callback:cb,resetRoot:parameters.resetRoot,name:parameters.name},cb)}else{return cb("Please provide either parameters.contents, parameters.url or parameters.geometry")}};this.copyModel=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.copyModel(parameters,cb)};this.removeModel=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.removeModel(parameters,cb)};this.removeAllModels=function(cb){cb=cb||handleCallback;managers.ModelManager.removeAllModels(cb)};this.showBoundingBox=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.showBoundingBox(parameters,cb)};this.hideBoundingBox=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.hideBoundingBox(parameters,cb)};this.allowModelTranslate=function(parameters,cb){cb=cb||handleCallback;if(parameters.allow){managers.TransformManager.allowTranslate(parameters,cb)}else{managers.TransformManager.disallowTranslate(parameters,cb)}};this.allowModelScale=function(parameters,cb){cb=cb||handleCallback;if(parameters.allow){managers.TransformManager.allowScale(parameters,cb)}else{managers.TransformManager.disallowScale(parameters,cb)}};this.allowModelRotate=function(parameters,cb){cb=cb||handleCallback;if(parameters.allow){managers.TransformManager.allowRotate(parameters,cb)}else{managers.TransformManager.disallowRotate(parameters,cb)}};this.selectModel=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.selectModel(parameters,cb)};this.unselectModel=function(parameters,cb){cb=cb||handleCallback;managers.ControlsManager.unselectModel(parameters,cb)};this.setTransform=function(cb){cb=cb||handleCallback;managers.ControlsManager.setTransform(cb)};this.setTransformTranslate=function(cb){cb=cb||handleCallback;managers.ControlsManager.setTransformTranslate(cb)};this.setTransformRotate=function(cb){cb=cb||handleCallback;managers.ControlsManager.setTransformRotate(cb)};this.setTransformScale=function(cb){cb=cb||handleCallback;managers.ControlsManager.setTransformScale(cb)};this.setModelColor=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.setModelColor(parameters,cb)};this.setModelColorInvalid=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.setModelColorInvalid(parameters,cb)};this.setModelPosition=function(parameters,cb){cb=cb||handleCallback;if(parameters.animationTime){managers.TransformManager.setModelTargetPosition(parameters,cb)}else{managers.TransformManager.setModelPosition(parameters,cb)}};this.setModelRotation=function(parameters,cb){cb=cb||handleCallback;if(parameters.animationTime){managers.TransformManager.setModelTargetRotation(parameters,cb)}else{managers.TransformManager.setModelRotation(parameters,cb)}};this.setModelScale=function(parameters,cb){cb=cb||handleCallback;if(parameters.animationTime){managers.TransformManager.setModelTargetScale(parameters,cb)}else{managers.TransformManager.setModelScale(parameters,cb)}};this.recenterModel=function(parameters,cb){cb=cb||handleCallback;managers.TransformManager.recenterModel(parameters,cb)};this.recenterAllModels=function(cb){cb=cb||handleCallback;managers.TransformManager.recenterAllModels(cb)};this.autofitModel=function(parameters,cb){cb=cb||handleCallback;managers.TransformManager.autofitModel(parameters,cb)};this.putModelOnBed=function(parameters,cb){cb=cb||handleCallback;managers.TransformManager.putModelOnBed(parameters,cb)};this.resetModel=function(parameters,cb){cb=cb||handleCallback;managers.TransformManager.resetModel(parameters,cb)};this.addBox=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.addBox({x:parameters.x,y:parameters.y,z:parameters.z},cb)};this.addSphere=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.addSphere({radius:parameters.radius,segments:parameters.segments},cb)};this.addCylinder=function(parameters,cb){cb=cb||handleCallback;managers.ModelManager.addCylinder({radiusTop:parameters.radiusTop,radiusBottom:parameters.radiusBottom,height:parameters.height,segments:parameters.segments},cb)};this.setMinGcodeLayer=function(parameters,cb){cb=cb||handleCallback;managers.GcodeManager.setMinLayer(parameters,cb)};this.setMaxGcodeLayer=function(parameters,cb){cb=cb||handleCallback;managers.GcodeManager.setMaxLayer(parameters,cb)};this.setMaxGcodeLineNumber=function(parameters,cb){cb=cb||handleCallback;managers.GcodeManager.setMaxLineNumber(parameters,cb)};this.setGcodeColorScheme=function(parameters,cb){cb=cb||handleCallback;managers.GcodeManager.setColorScheme(parameters,cb)};this.getGcodeInfo=function(cb){cb=cb||handleCallback;managers.GcodeManager.getInfo(cb)};this.exportScene=function(parameters,cb){cb=cb||handleCallback;managers.ExportManager.exportScene(parameters,cb)};this.exportModel=function(parameters,cb){cb=cb||handleCallback;managers.ExportManager.exportModel(parameters,cb)};this.on=function(event,cb){return V3.events[event].add(cb)};this.require=function(fileName,cb){xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&(xmlhttp.status==200||xmlhttp.status==0)){return cb(xmlhttp.responseText)}};xmlhttp.open("GET",fileName,false);xmlhttp.send()};this.registerApp=function(plugin,cb){if(window.DEBUG)console.log(plugin);V3.plugins.push(plugin);if(typeof plugin.init=="function"){setTimeout(plugin.init,200)}else{if(window.DEBUG)console.log("no init function found!")}};this.takeScreenshot=function(parameters,cb){cb=cb||handleCallback;this.api.uploadScreenshot({dataURL:renderer.domElement.toDataURL("image/png"),filename:parameters.filename,modelfileId:parameters.modelfileId},cb)}};(function(){function formideViewer($compile,$timeout,$sce,$window,$rootScope,$interval){var directive={restrict:"EA",templateUrl:"threejs-viewer-template.html",scope:{app:"=",onSave:"=",height:"@",width:"@",background:"@",url:"=",settings:"="},link:function(scope,element,attrs){$timeout(function(){scope.app=scope.app||{};scope.settings=scope.settings||{};scope.settings.changeCamera=scope.settings.changeCamera===undefined?true:scope.settings.changeCamera;scope.settings.toggleBedButton=scope.settings.toggleBedButton===undefined?true:scope.settings.toggleBedButton;scope.settings.toggleBedtype=scope.settings.toggleBedtype===undefined?"options":scope.settings.toggleBedtype;scope.settings.colorButton=scope.settings.colorButton===undefined?true:scope.settings.colorButton;scope.settings.editButtons=scope.settings.editButtons===undefined?true:scope.settings.editButtons;scope.settings.resetButton=scope.settings.resetButton===undefined?true:scope.settings.resetButton;scope.settings.autoFitButton=scope.settings.autoFitButton===undefined?true:scope.settings.autoFitButton;scope.settings.putOnBedButton=scope.settings.putOnBedButton===undefined?true:scope.settings.putOnBedButton;scope.settings.autoCenterButton=scope.settings.autoCenterButton===undefined?true:scope.settings.autoCenterButton;scope.settings.copyButton=scope.settings.copyButton===undefined?true:scope.settings.copyButton;scope.settings.removeButton=scope.settings.removeButton===undefined?true:scope.settings.removeButton;scope.settings.scaleButton=scope.settings.scaleButton===undefined?true:scope.settings.scaleButton;scope.settings.rotateButton=scope.settings.rotateButton===undefined?true:scope.settings.rotateButton;scope.settings.translateButton=scope.settings.translateButton===undefined?true:scope.settings.translateButton;scope.settings.saveButton=false;scope.settings.boundaries=false;scope.settings.gcodeFilters=scope.settings.gcodeFilters===undefined?false:scope.settings.gcodeFilters;if(scope.settings.gcodeFilters){scope.settings.editButtons=false;scope.settings.colorButton=false;scope.settings.changeCamera=false}scope.height=scope.height||"100%";scope.width=scope.width||"100%";if(scope.width=="100%"){scope.width==element.offsetWidth}scope.editMode=false;scope.showBedOptions=false;scope.cameraView="default";scope.setModalMethod="setModelPosition";scope.setInputsIcon="move";scope.setModalstep=.1;scope.setInputsUnit=$sce.trustAsHtml("&#13212;");scope.buttons=scope.buttons||false;scope.colorButton=scope.colorButton||false;var threejsModels=[];var id="3d-viewer";var canvas=angular.element('<canvas id="'+id+'"></canvas>');canvas.css("height",scope.height);canvas.css("width",scope.width);element.css("height",scope.height);element.css("width",scope.width);element.css("display","block");element.css("position","relative");element.append(canvas);$compile(canvas)(scope);formideSDK=new FormideSDK(document.getElementById(id),scope.settings);formideSDK.registerApp(new scope.app);scope.userSettings={};if(localStorage.getItem("formide.viewer:settings")){scope.userSettings=getSettings();scope.userSettings.showPrintBed=scope.userSettings.showPrintBed||false;scope.settings.printer=scope.settings.printer||{};scope.settings.printer.type=scope.settings.printer.type||"xyz";if(scope.userSettings.showPrintBed&&scope.settings.printer.type==="xyz"){formideSDK.showPrintBed({show:true,type:"xyz"})}else if(scope.userSettings.showPrintBed){formideSDK.showPrintBed({show:true,type:"round"})}if(!scope.userSettings.showPrintBed){scope.toggleBedTitle="Show Bed"}else{scope.toggleBedTitle="Hide Bed"}}scope.settings.snapOptions=scope.settings.snapOptions||{};scope.settings.snapOptions.snap=scope.settings.snapOptions.snap===undefined?true:scope.settings.snapOptions.snap;scope.settings.snapOptions.positionSnap=scope.settings.snapOptions.positionSnap||5;scope.settings.snapOptions.rotationSnap=scope.settings.snapOptions.rotationSnap||5;scope.settings.snapOptions.scaleSnap=scope.settings.snapOptions.scaleSnap||5;formideSDK.snapToGrid({snap:scope.settings.snapOptions.snap,positionSnap:scope.settings.snapOptions.positionSnap,rotationSnap:Math.PI/scope.settings.snapOptions.rotationSnap,scaleSnap:scope.settings.snapOptions.scaleSnap});formideSDK.getModels(function(response,err){scope.models=response});function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}function getSettings(){return JSON.parse(localStorage.getItem("formide.viewer:settings"))}function setSettings(result){localStorage.setItem("formide.viewer:settings",JSON.stringify(result));scope.userSettings=result}if(scope.background){var rgb=hexToRgb(scope.background);formideSDK.setBackgroundColor({r:rgb.r,g:rgb.g,b:rgb.b})}function convertRotationToDegs(model){model.rotation_deg={};model.rotation_deg.x=model.rotation.x*180/Math.PI;model.rotation_deg.y=model.rotation.y*180/Math.PI;model.rotation_deg.z=model.rotation.z*180/Math.PI}function convertRotationToRad(model){model.rotation.x=model.rotation_deg.x*Math.PI/180;model.rotation.y=model.rotation_deg.y*Math.PI/180;model.rotation.z=model.rotation_deg.z*Math.PI/180}function convertColorToRGB(){scope.userSettings.defaultModelColor={r:scope.selectedModel.baseColor.r*255,g:scope.selectedModel.baseColor.g*255,b:scope.selectedModel.baseColor.b*255}}function getModelByIndex(index){formideSDK.getModel({modelId:Object.keys(scope.models)[index]},function(response,err){scope.selectedModel=response})}scope.altDown=false,scope.shiftDown=false;scope.altKey=18,scope.shiftKey=16;scope.cKey=67,scope.mKey=77,scope.rKey=82,scope.sKey=83;scope.aKey=65,scope.bKey=66,scope.fKey=70,scope.dKey=68;scope.delKey=46,scope.spaceKey=32;scope.upKey=38,scope.leftKey=37,scope.rightKey=39,scope.downKey=40;angular.element($window).bind("keyup",function($event){if($event.keyCode==scope.altKey){scope.altDown=false}else if($event.keyCode==scope.shiftKey){scope.shiftDown=false}else if(scope.altDown&&$event.keyCode==scope.spaceKey||scope.shiftDown&&$event.keyCode==scope.spaceKey){if(!scope.editMode){scope.editMode=true;if(!scope.selectedModel){getModelByIndex(0)}}else{var i=0;var index;for(var key in scope.models){if(key==scope.selectedModel.modelId){if(scope.altDown){index=i+1}else{index=i-1}}if(scope.models.hasOwnProperty(key))i++}if(index>=i)index=0;if(index<0)index=i-1;getModelByIndex(index)}formideSDK.selectModel(scope.selectedModel)}else if(scope.editMode&&scope.altDown){switch($event.keyCode){case scope.cKey:copy();break;case scope.mKey:setTransformTranslate();break;case scope.rKey:setTransformRotate();break;case scope.sKey:setTransformScale();break;case scope.delKey:remove();break;case scope.aKey:autoCenter();break;case scope.bKey:putOnBed();break;case scope.fKey:autoFit();break;case scope.dKey:reset();break}}scope.$apply()});angular.element($window).bind("keydown",function($event){if($event.keyCode==scope.altKey){scope.altDown=true}else if($event.keyCode==scope.shiftKey){scope.shiftDown=true}else if(scope.selectedModel&&$event.keyCode==scope.upKey){keyTransform("z")}else if(scope.selectedModel&&$event.keyCode==scope.leftKey){keyTransform("x")}else if(scope.selectedModel&&$event.keyCode==scope.rightKey){keyTransform("y")}else if(scope.selectedModel&&$event.keyCode==scope.downKey&&scope.setModalMethod=="setModelScale"){keyTransform("all")}scope.$apply()});function keyTransform(axis){if(scope.setModalMethod=="setModelPosition"){if(scope.altDown){scope.selectedModel.position[axis]+=scope.setModalstep*10;setModelPosition()}else if(scope.shiftDown){scope.selectedModel.position[axis]-=scope.setModalstep*10;setModelPosition()}}else if(scope.setModalMethod=="setModelRotation"){if(scope.altDown){scope.selectedModel.rotation[axis]+=scope.setModalstep*Math.PI/180;convertRotationToDegs(scope.selectedModel);setModelRotation()}else if(scope.shiftDown){scope.selectedModel.rotation[axis]-=scope.setModalstep*Math.PI/180;convertRotationToDegs(scope.selectedModel);setModelRotation()}}else if(scope.setModalMethod=="setModelScale"){if(scope.altDown){scope.selectedModel.scale[axis]+=scope.setModalstep;if(axis=="all"){setModelScaleAll()}else{setModelScale()}}else if(scope.shiftDown){scope.selectedModel.scale[axis]-=scope.setModalstep;if(axis=="all"){setModelScaleAll()}else{setModelScale()}}}}formideSDK.on("modelSelected",function(response){if(scope.selectedModel){checkModelBoundaries()}scope.selectedModel=response.model;if(scope.setModalMethod=="setModelRotation"){convertRotationToDegs(scope.selectedModel)}formideSDK.setTransform();convertColorToRGB();if(scope.selectedModel.baseColor.b!==scope.selectedModel.validColor.b&&scope.selectedModel.baseColor.g!==scope.selectedModel.validColor.g&&scope.selectedModel.baseColor.r!==scope.selectedModel.validColor.r){scope.colorsDisabled=true}else{scope.colorsDisabled=false}$timeout(function(){scope.editMode=true})});formideSDK.on("modelUnselected",function(event){if(scope.selectedModel){checkModelBoundaries()}$timeout(function(){scope.editMode=false;scope.gcodeFilterMode=false;scope.colorsOpened=false;scope.showBedOptions=false;scope.showCameraOptions=false})});formideSDK.on("endTransform",function(event){if(scope.setModalMethod=="setModelRotation"){convertRotationToDegs(scope.selectedModel);putOnBed()}else if(scope.setModalMethod=="setModelScale"){if(scope.selectedModel.scale.x==scope.selectedModel.scale.y&&scope.selectedModel.scale.y==scope.selectedModel.scale.z){scope.selectedModel.scale.all=scope.selectedModel.scale.x}putOnBed()}checkModelBoundaries(true);scope.$apply()});formideSDK.on("bedChanged",function(response){scope.settings.printer=response.printer});if(scope.url){formideSDK.addModel({url:scope.url},function(response){scope.setModelColor(response.modelId)})}function toggleShowBed(){scope.userSettings=getSettings();scope.userSettings.showPrintBed=!scope.userSettings.showPrintBed;if(!scope.userSettings.showPrintBed){scope.toggleBedTitle="Show Bed"}else{scope.toggleBedTitle="Hide Bed"}if(scope.settings.printer.type==="xyz"){formideSDK.showPrintBed({show:scope.userSettings.showPrintBed,type:"xyz"})}else{formideSDK.showPrintBed({show:scope.userSettings.showPrintBed,type:"round"})}setSettings(scope.userSettings)}function toggleShowBedOptions(){scope.showBedOptions=!scope.showBedOptions;scope.colorsOpened=false;scope.showCameraOptions=false}function showPrintBed(type){var bedChange;if(scope.settings.printer.type!==type){bedChange=true}scope.userSettings.showPrintBed=true;formideSDK.showPrintBed({show:scope.userSettings.showPrintBed,type:type});setSettings(scope.userSettings);formideSDK.resetCameraPosition();formideSDK.centerCameraOnBed();if(bedChange){formideSDK.recenterAllModels()}formideSDK.refreshScene();scope.cameraView="default";scope.showBedOptions=false}function hidePrintBed(){scope.userSettings.showPrintBed=false;formideSDK.showPrintBed({show:scope.userSettings.showPrintBed});setSettings(scope.userSettings);scope.showBedOptions=false}function toggleCameraOptions(){scope.showCameraOptions=!scope.showCameraOptions;scope.colorsOpened=false;scope.showBedOptions=false}function focusOnAngle(view){scope.cameraView=view;if(!scope.selectedModel){getModelByIndex(0);convertColorToRGB()}formideSDK.switchSideView({modelId:scope.selectedModel.modelId,view:view});scope.showCameraOptions=false;if(view=="default"||view=="top"){formideSDK.centerCameraOnBed()}}function toggleEdit(){scope.editMode=!scope.editMode;if(!scope.selectedModel){getModelByIndex(0);convertColorToRGB()}if(scope.editMode){formideSDK.selectModel(scope.selectedModel)}else{formideSDK.unselectModel()}}function toggleFilter(){if(!scope.layerLimit){formideSDK.getGcodeInfo(function(info){console.log("info",info);scope.layerLimit=parseInt(info.layers);scope.minLayer=0;scope.maxLayer=parseInt(info.layers);scope.minLayerInput=0;scope.maxLayerInput=parseInt(info.layers);scope.lineLimit=parseInt(info.lines);scope.gcodeFilterMode=!scope.gcodeFilterMode})}else{scope.gcodeFilterMode=!scope.gcodeFilterMode}}function listSelectModel(){if(!scope.selectedModel){getModelByIndex(0)}formideSDK.selectModel(scope.selectedModel)}function checkModelBoundaries(setTransform){var model=scope.selectedModel;if(scope.settings.printer.type=="xyz"){maxX=scope.settings.printer.size.x;minX=0;maxY=scope.settings.printer.size.y;minY=0}else{maxX=scope.settings.printer.size.r;minX=-1*scope.settings.printer.size.r;maxY=scope.settings.printer.size.r;minY=-1*scope.settings.printer.size.r}model.calculateNewBounds();if(model.currentBounds.max.x>maxX||model.currentBounds.min.x<minX||model.currentBounds.max.y>maxY||model.currentBounds.min.y<minY){formideSDK.setModelColorInvalid({modelId:model.modelId});scope.colorsOpened=false;scope.colorsDisabled=true}else{formideSDK.setModelColor({modelId:model.modelId,r:model.validColor.r*255,g:model.validColor.g*255,b:model.validColor.b*255});scope.colorsDisabled=false}}function setModelPosition(){if(!isNaN(scope.selectedModel.position.x)&&!isNaN(scope.selectedModel.position.y)&&!isNaN(scope.selectedModel.position.z)){formideSDK.setModelPosition({modelId:scope.selectedModel.modelId,x:scope.selectedModel.position.x,y:scope.selectedModel.position.y,z:scope.selectedModel.position.z},function(response,err){formideSDK.setTransformTranslate()})}}function setModelRotation(){convertRotationToRad(scope.selectedModel);if(!isNaN(scope.selectedModel.rotation.x)&&!isNaN(scope.selectedModel.rotation.y)&&!isNaN(scope.selectedModel.rotation.z)){formideSDK.setModelRotation({modelId:scope.selectedModel.modelId,x:scope.selectedModel.rotation.x,y:scope.selectedModel.rotation.y,z:scope.selectedModel.rotation.z},function(response,err){putOnBed();formideSDK.setTransformRotate()})}}function setModelScale(){if(!isNaN(scope.selectedModel.scale.x)&&!isNaN(scope.selectedModel.scale.y)&&!isNaN(scope.selectedModel.scale.z)){formideSDK.setModelScale({modelId:scope.selectedModel.modelId,x:scope.selectedModel.scale.x,y:scope.selectedModel.scale.y,z:scope.selectedModel.scale.z},function(response,err){putOnBed();formideSDK.setTransformScale()});if(scope.selectedModel.scale.x==scope.selectedModel.scale.y&&scope.selectedModel.scale.y==scope.selectedModel.scale.z){scope.selectedModel.scale.all=scope.selectedModel.scale.x}}}function setModelScaleAll(){formideSDK.setModelScale({modelId:scope.selectedModel.modelId,x:scope.selectedModel.scale.all,y:scope.selectedModel.scale.all,z:scope.selectedModel.scale.all},function(response,err){putOnBed();formideSDK.setTransformScale()})}function setTransformTranslate(){scope.setModalMethod="setModelPosition";scope.setModalstep=.1;scope.setInputsUnit=$sce.trustAsHtml("&#13212;");formideSDK.setTransformTranslate()}function setTransformRotate(){scope.setModalMethod="setModelRotation";convertRotationToDegs(scope.selectedModel);scope.setModalstep=1;scope.setInputsUnit=$sce.trustAsHtml("&deg;");formideSDK.setTransformRotate()}function setTransformScale(){scope.setModalMethod="setModelScale";scope.selectedModel.scale.all=scope.selectedModel.scale.all||1;scope.setModalstep=.01;scope.setInputsUnit=$sce.trustAsHtml("&times;");if(scope.selectedModel.scale.x==scope.selectedModel.scale.y&&scope.selectedModel.scale.y==scope.selectedModel.scale.z){scope.selectedModel.scale.all=scope.selectedModel.scale.x}formideSDK.setTransformScale()}function copy(){formideSDK.copyModel({modelId:scope.selectedModel.modelId},function(response,err){if(typeof scope.userSettings.defaultModelColor!=="object"){scope.userSettings.defaultModelColor={r:70,g:97,b:230};setSettings(scope.userSettings)}formideSDK.setModelColor({modelId:response.modelId,r:scope.userSettings.defaultModelColor.r,g:scope.userSettings.defaultModelColor.g,b:scope.userSettings.defaultModelColor.b});formideSDK.putModelOnBed({modelId:response.modelId});formideSDK.allowModelTranslate({modelId:response.modelId,allow:true});formideSDK.allowModelRotate({modelId:response.modelId,allow:true});formideSDK.allowModelScale({modelId:response.modelId,allow:true})})}function remove(){if(Object.keys(scope.models).length>1){formideSDK.removeModel({modelId:scope.selectedModel.modelId},function(response,err){formideSDK.setTransform()})}}function autoFit(){formideSDK.autofitModel({modelId:scope.selectedModel.modelId},function(response,err){formideSDK.putModelOnBed({modelId:response.modelId});formideSDK.setTransform();checkModelBoundaries();scope.selectedModel.scale.all=scope.selectedModel.scale.x})}function autoCenter(){formideSDK.recenterModel({modelId:scope.selectedModel.modelId},function(response,err){formideSDK.setTransform();checkModelBoundaries()})}function putOnBed(){formideSDK.putModelOnBed({modelId:scope.selectedModel.modelId});formideSDK.setTransform()}function reset(){formideSDK.resetModel({modelId:scope.selectedModel.modelId});convertRotationToDegs(scope.selectedModel);scope.selectedModel.scale.all=scope.selectedModel.scale.x;formideSDK.setTransform();checkModelBoundaries()}function undo(){formideSDK.undoModelTransformation({modelId:scope.selectedModel.modelId});formideSDK.setTransform()}function redo(){formideSDK.redoModelTransformation({modelId:scope.selectedModel.modelId});formideSDK.setTransform()}function saveEditor(event){formideSDK.exportScene({type:"geometry"},function(response,err){scope.onSave(response)})}var colors=[{r:70,g:97,b:230},{r:203,g:70,b:230},{r:230,g:70,b:97},{r:230,g:203,b:70},{r:97,g:230,b:70},{r:70,g:230,b:203},{r:114,g:115,b:128},{r:56,g:58,b:81}];scope.colorsOpened=false;function toggleColors(event){scope.colors=[];if(!scope.colorsOpened){for(var i=0;i<colors.length;i++){scope.colors.push(colors[i])}}scope.colorsOpened=!scope.colorsOpened;scope.showBedOptions=false;scope.showCameraOptions=false;event.stopPropagation()}function setModelColor(id,r,g,b){var id=id||Object.keys(scope.models)[0];if(r===parseInt(r,10)&&g===parseInt(g,10)&&b===parseInt(b,10)){scope.userSettings.defaultModelColor=scope.settings.defaultModelColor||{};scope.userSettings.defaultModelColor.r=r;scope.userSettings.defaultModelColor.g=g;scope.userSettings.defaultModelColor.b=b}else if(!scope.userSettings.defaultModelColor){scope.userSettings.defaultModelColor={};
scope.userSettings.defaultModelColor.r=70;scope.userSettings.defaultModelColor.g=97;scope.userSettings.defaultModelColor.b=230}formideSDK.setModelColor({modelId:id,r:scope.userSettings.defaultModelColor.r,g:scope.userSettings.defaultModelColor.g,b:scope.userSettings.defaultModelColor.b});setSettings(scope.userSettings)}function isSelectedColor(r,g,b){scope.userSettings.defaultModelColor=scope.userSettings.defaultModelColor||{};if(scope.userSettings.defaultModelColor.r==r&&scope.userSettings.defaultModelColor.g==g&&scope.userSettings.defaultModelColor.b==b){return true}else{return false}}function boundaries(event){if(!scope.showBoundaries){for(var model in scope.models){if(scope.models.hasOwnProperty(model)){formideSDK.showBoundingBox({modelId:model})}}scope.showBoundaries=true}else{for(var model in scope.models){if(scope.models.hasOwnProperty(model)){formideSDK.hideBoundingBox({modelId:model})}}scope.showBoundaries=false}}function updateMinLayer(opp,value){if(opp=="add"&&scope.minLayer<scope.layerLimit){scope.minLayer=parseInt(scope.minLayer)+value}else if(opp=="minus"&&scope.minLayer>0){scope.minLayer=parseInt(scope.minLayer)-value}if(opp=="set"){scope.minLayer=parseInt(value)}if(parseInt(scope.minLayer)>parseInt(scope.maxLayer)){scope.maxLayer=scope.minLayer;formideSDK.setMaxGcodeLayer({maxLayer:scope.maxLayer})}formideSDK.setMinGcodeLayer({minLayer:scope.minLayer});scope.minLayerInput=parseInt(scope.minLayer);scope.maxLayerInput=parseInt(scope.maxLayer)}function updateMaxLayer(opp,value){if(opp=="add"&&scope.maxLayer<scope.layerLimit){scope.maxLayer=parseInt(scope.maxLayer)+value}else if(opp=="minus"&&scope.maxLayer>0){scope.maxLayer=parseInt(scope.maxLayer)-value}else if(opp=="set"){scope.maxLayer=parseInt(value)}if(parseInt(scope.maxLayer)<parseInt(scope.minLayer)){scope.minLayer=scope.maxLayer;formideSDK.setMinGcodeLayer({minLayer:scope.minLayer})}formideSDK.setMaxGcodeLayer({maxLayer:scope.maxLayer});scope.minLayerInput=parseInt(scope.minLayer);scope.maxLayerInput=parseInt(scope.maxLayer)}scope.animatingGcode=false;scope.animateGcodeLine=0;var animateStarted=false;$rootScope.animationInterval;function animateGcode(){if(scope.animatingGcode&&animateStarted){$interval.cancel($rootScope.animationInterval);scope.animatingGcode=false;return true}else{scope.animatingGcode=true}animateStarted=true;$rootScope.animationInterval=$interval(function(){if(scope.animateGcodeLine>scope.lineLimit)$interval.cancel($rootScope.animationInterval);formideSDK.setMaxGcodeLineNumber({maxLineNumber:scope.animateGcodeLine});scope.animateGcodeLine+=20},5)}function stopGcode(){if(animateStarted){$interval.cancel($rootScope.animationInterval);formideSDK.setMaxGcodeLayer({maxLayer:scope.maxLayer});scope.animateGcodeLine=0;scope.animatingGcode=false;animateStarted=false}}angular.extend(scope,{showPrintBed:showPrintBed,hidePrintBed:hidePrintBed,saveEditor:saveEditor,toggleColors:toggleColors,toggleCameraOptions:toggleCameraOptions,setModelColor:setModelColor,autoFit:autoFit,autoCenter:autoCenter,putOnBed:putOnBed,isSelectedColor:isSelectedColor,copy:copy,remove:remove,reset:reset,undo:undo,redo:redo,boundaries:boundaries,setTransformTranslate:setTransformTranslate,setTransformRotate:setTransformRotate,setTransformScale:setTransformScale,listSelectModel:listSelectModel,setModelPosition:setModelPosition,setModelRotation:setModelRotation,setModelScale:setModelScale,setModelScaleAll:setModelScaleAll,toggleEdit:toggleEdit,toggleFilter:toggleFilter,updateMinLayer:updateMinLayer,updateMaxLayer:updateMaxLayer,toggleShowBedOptions:toggleShowBedOptions,toggleShowBed:toggleShowBed,checkModelBoundaries:checkModelBoundaries,focusOnAngle:focusOnAngle,animateGcode:animateGcode,stopGcode:stopGcode})})},transclude:true};return directive}angular.module("formide.viewer",[]).directive("formideViewer",formideViewer)})();angular.module("formide.viewer").run(["$templateCache",function($templateCache){$templateCache.put("threejs-viewer-template.html",'<link rel="stylesheet" type="text/css" href="../tmp/styles.css"><ul class="viewer-buttons" ng-if="settings.toggleBedButton || settings.colorButton || settings.changeCamera"><ul class="camera-picker animate-show" ng-if="showCameraOptions"><li title="Model" ng-click="focusOnAngle(\'front\')" ng-class="{\'active\': cameraView == \'front\'}"><i class="model"></i></li><li title="Top Down" ng-click="focusOnAngle(\'top\')" ng-class="{\'active\': cameraView == \'top\'}"><i class="arrow-down"></i></li><li title="Bed" ng-click="focusOnAngle(\'default\')" ng-class="{\'active\': cameraView == \'default\'}"><i class="bed--blue"></i></li></ul><li title="Change Camera" ng-click="toggleCameraOptions()" ng-if="settings.changeCamera"><i class="camera"></i></li><ul class="bed-picker animate-show" ng-if="showBedOptions && settings.toggleBedtype == \'options\'" ng-class="{ \'noCameraOptions\': !settings.changeCamera }"><li title="Round Bed" ng-click="showPrintBed(\'round\')" ng-class="{\'active\': settings.printer.type == \'round\' && userSettings.showPrintBed}"><i class="circle"></i></li><li title="Square Bed" ng-click="showPrintBed(\'xyz\')" ng-class="{\'active\': settings.printer.type == \'xyz\' && userSettings.showPrintBed}"><i class="square"></i></li><li title="Hide Bed" ng-click="hidePrintBed()" ng-class="{\'active\': !userSettings.showPrintBed}"><i class="cancel"></i></li></ul><ul class="bed-picker animate-show" ng-if="showBedOptions && settings.toggleBedtype == \'toggle\'" ng-class="{ \'noCameraOptions\': !settings.changeCamera }"><li title="{{toggleBedTitle}}" ng-click="toggleShowBed()"><i ng-if="userSettings.showPrintBed" class="cancel"></i> <i ng-if="!userSettings.showPrintBed && settings.printer.type != \'xyz\'" class="circle"></i> <i ng-if="!userSettings.showPrintBed && settings.printer.type == \'xyz\'" class="square"></i></li></ul><li title="Change Bed" ng-click="toggleShowBedOptions()" ng-if="settings.toggleBedButton"><i class="bed"></i></li><li title="Boundaries" ng-click="boundaries($event)" ng-if="settings.boundaries"><i class=""></i></li><li title="Change Color" ng-click="toggleColors($event)" ng-if="settings.colorButton" style="background-color: rgb({{selectedModel.baseColor.r * 255}}, {{selectedModel.baseColor.g * 255}}, {{selectedModel.baseColor.b * 255}})"><i class="color"></i></li><ul class="color-picker" ng-class="{\'alignLeft\': !settings.toggleBedButton || !settings.changeCamera}" ng-if="colorsOpened && !colorsDisabled"><li ng-repeat="color in colors" ng-class="{\'selected\': isSelectedColor(color.r, color.g, color.b)}" class="color-picker-item" ng-click="setModelColor(selectedModel.modelId, color.r, color.g, color.b)" ng-style="{\'background-color\': \'rgb(\'+color.r+\', \'+color.g+\', \'+color.b+\')\'}"></li></ul></ul><ul class="viewer-buttons edit-menu" ng-if="settings.editButtons || settings.gcodeFilters"><ul class="edit-options animate-show" ng-if="editMode"><li title="Save" ng-click="saveEditor($event)" ng-if="settings.saveButton"><i class="save"></i></li><li title="Reset" ng-click="reset($event)" ng-if="settings.resetButton"><i class="reset"></i></li><li title="Auto Fit" ng-click="autoFit($event)" ng-if="settings.autoFitButton"><i class="fit"></i></li><li title="Put on Bed" ng-click="putOnBed($event)" ng-if="settings.putOnBedButton"><i class="level"></i></li><li title="Auto Center" ng-click="autoCenter($event)" ng-if="settings.autoCenterButton"><i class="center"></i></li><li title="Copy" ng-click="copy($event)" ng-if="settings.copyButton"><i class="copy"></i></li><li title="Remove" ng-click="remove($event)" ng-if="settings.removeButton"><i class="remove"></i></li><li title="Scale" ng-click="setTransformScale($event)" ng-if="settings.scaleButton"><i class="scale"></i></li><li title="Rotate" ng-click="setTransformRotate($event)" ng-if="settings.rotateButton"><i class="rotate"></i></li><li title="Move" ng-click="setTransformTranslate($event)" ng-if="settings.translateButton"><i class="move"></i></li></ul><li title="Edit" ng-click="toggleEdit()" ng-if="settings.editButtons"><i class="edit"></i></li><li title="Filter" ng-click="toggleFilter()" ng-if="settings.gcodeFilters"><i class="edit"></i></li></ul><div id="transformation-inputs" class="animate-show" ng-show="settings.editButtons && editMode"><div class="form-group select-list"><label for="">Model</label><select ng-model="selectedModel" ng-change="listSelectModel()" ng-options="model.name for model in models"></select></div><span ng-if="settings.editButtons"><div class="inputs animate-show" ng-if="setModalMethod==\'setModelPosition\'"><div class="form-group"><label class="icon"><i class="move"></i></label><label for="x-axis">x</label><input id="x-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.position.x" ng-change="this[setModalMethod]()"><label class="unit" for="x-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="y-axis">y</label><input id="y-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.position.y" ng-change="this[setModalMethod]()"><label class="unit" for="y-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="z-axis">z</label><input id="z-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.position.z" ng-change="this[setModalMethod]()"><label class="unit" for="z-axis" ng-bind-html="setInputsUnit"></label></div></div><div class="inputs animate-show" ng-if="setModalMethod==\'setModelRotation\'"><div class="form-group"><label class="icon"><i class="rotate"></i></label><label for="x-axis">x</label><input id="x-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.rotation_deg.x" ng-change="this[setModalMethod]()"><label class="unit" for="x-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="y-axis">y</label><input id="y-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.rotation_deg.y" ng-change="this[setModalMethod]()"><label class="unit" for="y-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="z-axis">z</label><input id="z-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.rotation_deg.z" ng-change="this[setModalMethod]()"><label class="unit" for="z-axis" ng-bind-html="setInputsUnit"></label></div></div><div class="inputs animate-show" ng-if="setModalMethod==\'setModelScale\'"><div class="form-group"><label class="icon"><i class="scale"></i></label><label for="x-axis">x</label><input id="x-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.scale.x" ng-change="this[setModalMethod]()"><label class="unit" for="x-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="y-axis">y</label><input id="y-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.scale.y" ng-change="this[setModalMethod]()"><label class="unit" for="y-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group"><label for="z-axis">z</label><input id="z-axis" type="number" step="{{setModalstep}}" ng-model="selectedModel.scale.z" ng-change="this[setModalMethod]()"><label class="unit" for="z-axis" ng-bind-html="setInputsUnit"></label></div><div class="form-group scaleAll"><label for="all">all</label><input id="all" type="number" step="{{setModalstep}}" ng-model="selectedModel.scale.all" ng-change="setModelScaleAll()"><label class="unit" for="all" ng-bind-html="setInputsUnit"></label></div></div></span></div><div id="gcode-inputs" class="animate-show" ng-show="settings.gcodeFilters && gcodeFilterMode"><div class="range-btn-group"><button class="square-btn range-btn--up" ng-click="updateMinLayer(\'add\', 1)"><i class="angle-up"></i></button> <button class="square-btn range-btn--down" ng-click="updateMinLayer(\'minus\', 1)"><i class="angle-down"></i></button></div><div class="slider slider--minLayer"><input type="range" orient="vertical" class="input--minLayer" min="0" max="{{layerLimit}}" step="1" ng-model="minLayer" ng-change="updateMinLayer()"><div class="inner" ng-style="{ height: ( (layerLimit - minLayer) / layerLimit) * 295 + \'px\' || \'0px\' }"><div class="knob"></div></div></div><div class="range-btn-group"><button class="square-btn range-btn--up" ng-click="updateMaxLayer(\'add\', 1)"><i class="angle-up"></i></button> <button class="square-btn range-btn--down" ng-click="updateMaxLayer(\'minus\', 1)"><i class="angle-down"></i></button></div><div class="slider slider--maxLayer"><input type="range" orient="vertical" class="input--maxLayer" min="0" max="{{layerLimit}}" step="1" ng-model="maxLayer" ng-change="updateMaxLayer()"><div class="inner" ng-style="{ height: (maxLayer / layerLimit) * 295 + \'px\' || \'0px\' }"><div class="knob"></div></div></div><div class="input-group"><div class="label">Filter Layers</div><input type="number" ng-model="minLayerInput" ng-blur="updateMinLayer(\'set\', minLayerInput)" ng-keyup="$event.keyCode == 13 && updateMinLayer(\'set\', minLayerInput)" min="0" max="{{layerLimit}}"> <input type="number" ng-model="maxLayerInput" ng-blur="updateMaxLayer(\'set\', maxLayerInput)" ng-keyup="$event.keyCode == 13 && updateMaxLayer(\'set\', maxLayerInput)" min="0" max="{{layerLimit}}"></div><div class="animate-btn-group"><div class="label">Animate Lines</div><button class="square-btn animate-btn" ng-click="animateGcode()"><i ng-class="{false:\'play\',true:\'pause\'}[animatingGcode]"></i></button> <button class="square-btn animate-btn" ng-click="stopGcode()"><i class="stop"></i></button></div></div><div id="gcode-key" ng-if="settings.gcodeFilters"><div class="gcode-key-container"><div class="key-title">Speed (mm/min)</div><div class="key-colours"></div><div class="key-values"><div class="top">200</div><div class="bottom">3600</div></div></div></div>')}]);!function(){"use strict";var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){var s=t.which;switch(s){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return!!(t.metaKey||t.ctrlKey||t.altKey)},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)},toSeparator:function(t){var s={ENTER:"\n",TAB:"\t",SPACE:" "}[t];return s?s:e[t]?void 0:t}};void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),void 0===angular.element.prototype.closest&&(angular.element.prototype.closest=function(e){for(var t=this[0],s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(s.bind(t)(e))return t;t=t.parentElement}return!1});var t=0,s=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,skipFocusser:!1,dropdownPosition:"auto",removeSelected:!0,resetSearchInput:!0,generateId:function(){return t++},appendToBody:!1,spinnerEnabled:!1,spinnerClass:"glyphicon-refresh ui-select-spin"}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments),s=t.message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(s)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,s,i,c){c(e,function(e){t.append(e)})}}}).filter("highlight",function(){function e(e){return(""+e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,s){return s&&t?(""+t).replace(new RegExp(e(s),"gi"),'<span class="ui-select-highlight">$&</span>'):t}}).factory("uisOffset",["$document","$window",function(e,t){return function(s){var i=s[0].getBoundingClientRect();return{width:i.width||s.prop("offsetWidth"),height:i.height||s.prop("offsetHeight"),top:i.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:i.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);s.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile","$window",function(e,t,s,i,c){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){t.addClass("ui-select-choices");var s=t.parent().attr("theme")||e.theme;return s+"/choices.tpl.html"},compile:function(i,n){if(!n.repeat)throw s("repeat","Expected 'repeat' expression.");var l=n.groupBy,a=n.groupFilter;if(l){var r=i.querySelectorAll(".ui-select-choices-group");if(1!==r.length)throw s("rows","Expected 1 .ui-select-choices-group but got '{0}'.",r.length);r.attr("ng-repeat",t.getGroupNgRepeatExpression())}var o=t.parse(n.repeat),u=i.querySelectorAll(".ui-select-choices-row");if(1!==u.length)throw s("rows","Expected 1 .ui-select-choices-row but got '{0}'.",u.length);u.attr("ng-repeat",o.repeatExpression(l)).attr("ng-if","$select.open");var d=i.querySelectorAll(".ui-select-choices-row-inner");if(1!==d.length)throw s("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",d.length);d.attr("uis-transclude-append","");var p=c.document.addEventListener?u:d;return p.attr("ng-click","$select.select("+o.itemName+",$select.skipFocusser,$event)"),function(t,s,c,n){n.parseRepeatAttr(c.repeat,l,a),n.disableChoiceExpression=c.uiDisableChoice,n.onHighlightCallback=c.onHighlight,n.dropdownPosition=c.position?c.position.toLowerCase():e.dropdownPosition,t.$on("$destroy",function(){u.remove()}),t.$watch("$select.search",function(e){e&&!n.open&&n.multiple&&n.activate(!1,!0),n.activeIndex=n.tagging.isActivated?-1:0,!c.minimumInputLength||n.search.length>=c.minimumInputLength?n.refresh(c.refresh):n.items=[]}),c.$observe("refreshDelay",function(){var s=t.$eval(c.refreshDelay);n.refreshDelay=void 0!==s?s:e.refreshDelay}),t.$watch("$select.open",function(e){e?i.attr("role","listbox"):i.removeAttr("role")})}}}}]),s.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","$$uisDebounce","uisRepeatParser","uiSelectMinErr","uiSelectConfig","$parse","$injector","$window",function(t,s,i,c,n,l,a,r,o,u,d){function p(e,t,s){if(e.findIndex)return e.findIndex(t,s);for(var i,c=Object(e),n=c.length>>>0,l=0;n>l;l++)if(i=c[l],t.call(s,i,l,c))return l;return-1}function h(){w.resetSearchInput&&(w.search=y,w.selected&&w.items.length&&!w.multiple&&(w.activeIndex=p(w.items,function(e){return angular.equals(this,e)},w.selected)))}function g(e,t){var s,i,c=[];for(s=0;s<t.length;s++)for(i=0;i<e.length;i++)e[i].name==[t[s]]&&c.push(e[i]);return c}function f(e,t){var s=S.indexOf(e);t&&-1===s&&S.push(e),!t&&s>-1&&S.splice(s,1)}function v(e){return S.indexOf(e)>-1}function $(e){function t(e,t){var s=i.indexOf(e);t&&-1===s&&i.push(e),!t&&s>-1&&i.splice(s,0)}function s(e){return i.indexOf(e)>-1}if(e){var i=[];w.isLocked=function(e,i){var c=!1,n=w.selected[i];return n&&(e?(c=!!e.$eval(w.lockChoiceExpression),t(n,c)):c=s(n)),c}}}function m(t){var s=!0;switch(t){case e.DOWN:!w.open&&w.multiple?w.activate(!1,!0):w.activeIndex<w.items.length-1&&w.activeIndex++;break;case e.UP:!w.open&&w.multiple?w.activate(!1,!0):(w.activeIndex>0||0===w.search.length&&w.tagging.isActivated&&w.activeIndex>-1)&&w.activeIndex--;break;case e.TAB:w.multiple&&!w.open||w.select(w.items[w.activeIndex],!0);break;case e.ENTER:w.open&&(w.tagging.isActivated||w.activeIndex>=0)?w.select(w.items[w.activeIndex],w.skipFocusser):w.activate(!1,!0);break;case e.ESC:w.close();break;default:s=!1}return s}function b(){var e=s.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw a("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(!(w.activeIndex<0)){var i=t[w.activeIndex],c=i.offsetTop+i.clientHeight-e[0].scrollTop,n=e[0].offsetHeight;c>n?e[0].scrollTop+=c-n:c<i.clientHeight&&(w.isGrouped&&0===w.activeIndex?e[0].scrollTop=0:e[0].scrollTop-=i.clientHeight-c)}}var w=this,y="";if(w.placeholder=r.placeholder,w.searchEnabled=r.searchEnabled,w.sortable=r.sortable,w.refreshDelay=r.refreshDelay,w.paste=r.paste,w.resetSearchInput=r.resetSearchInput,w.refreshing=!1,w.spinnerEnabled=r.spinnerEnabled,w.spinnerClass=r.spinnerClass,w.removeSelected=r.removeSelected,w.closeOnSelect=!0,w.skipFocusser=!1,w.search=y,w.activeIndex=0,w.items=[],w.open=!1,w.focus=!1,w.disabled=!1,w.selected=void 0,w.dropdownPosition="auto",w.focusser=void 0,w.multiple=void 0,w.disableChoiceExpression=void 0,w.tagging={isActivated:!1,fct:void 0},w.taggingTokens={isActivated:!1,tokens:void 0},w.lockChoiceExpression=void 0,w.clickTriggeredSelect=!1,w.$filter=c,w.$element=s,w.$animate=function(){try{return u.get("$animate")}catch(e){return null}}(),w.searchInput=s.querySelectorAll("input.ui-select-search"),1!==w.searchInput.length)throw a("searchInput","Expected 1 input.ui-select-search but got '{0}'.",w.searchInput.length);w.isEmpty=function(){return angular.isUndefined(w.selected)||null===w.selected||""===w.selected||w.multiple&&0===w.selected.length},w.activate=function(e,c){if(w.disabled||w.open)w.open&&!w.searchEnabled&&w.close();else{c||h(),t.$broadcast("uis:activate"),w.open=!0,w.activeIndex=w.activeIndex>=w.items.length?0:w.activeIndex,-1===w.activeIndex&&w.taggingLabel!==!1&&(w.activeIndex=0);var n=s.querySelectorAll(".ui-select-choices-content"),l=s.querySelectorAll(".ui-select-search");if(w.$animate&&w.$animate.on&&w.$animate.enabled(n[0])){var a=function(t,s){"start"===s&&0===w.items.length?(w.$animate.off("removeClass",l[0],a),i(function(){w.focusSearchInput(e)})):"close"===s&&(w.$animate.off("enter",n[0],a),i(function(){w.focusSearchInput(e)}))};w.items.length>0?w.$animate.on("enter",n[0],a):w.$animate.on("removeClass",l[0],a)}else i(function(){w.focusSearchInput(e),!w.tagging.isActivated&&w.items.length>1&&b()})}},w.focusSearchInput=function(e){w.search=e||w.search,w.searchInput[0].focus()},w.findGroupByName=function(e){return w.groups&&w.groups.filter(function(t){return t.name===e})[0]},w.parseRepeatAttr=function(e,s,i){function c(e){var c=t.$eval(s);if(w.groups=[],angular.forEach(e,function(e){var t=angular.isFunction(c)?c(e):e[c],s=w.findGroupByName(t);s?s.items.push(e):w.groups.push({name:t,items:[e]})}),i){var n=t.$eval(i);angular.isFunction(n)?w.groups=n(w.groups):angular.isArray(n)&&(w.groups=g(w.groups,n))}w.items=[],w.groups.forEach(function(e){w.items=w.items.concat(e.items)})}function n(e){w.items=e}w.setItemsFn=s?c:n,w.parserResult=l.parse(e),w.isGrouped=!!s,w.itemProperty=w.parserResult.itemName;var r=w.parserResult.source,u=function(){var e=r(t);t.$uisSource=Object.keys(e).map(function(t){var s={};return s[w.parserResult.keyName]=t,s.value=e[t],s})};w.parserResult.keyName&&(u(),w.parserResult.source=o("$uisSource"+w.parserResult.filters),t.$watch(r,function(e,t){e!==t&&u()},!0)),w.refreshItems=function(e){e=e||w.parserResult.source(t);var s=w.selected;if(w.isEmpty()||angular.isArray(s)&&!s.length||!w.multiple||!w.removeSelected)w.setItemsFn(e);else if(void 0!==e&&null!==e){var i=e.filter(function(e){return angular.isArray(s)?s.every(function(t){return!angular.equals(e,t)}):!angular.equals(e,s)});w.setItemsFn(i)}"auto"!==w.dropdownPosition&&"up"!==w.dropdownPosition||t.calculateDropdownPos(),t.$broadcast("uis:refresh")},t.$watchCollection(w.parserResult.source,function(e){if(void 0===e||null===e)w.items=[];else{if(!angular.isArray(e))throw a("items","Expected an array but got '{0}'.",e);w.refreshItems(e),angular.isDefined(w.ngModel.$modelValue)&&(w.ngModel.$modelValue=null)}})};var x;w.refresh=function(e){void 0!==e&&(x&&i.cancel(x),x=i(function(){var s=t.$eval(e);s&&angular.isFunction(s.then)&&!w.refreshing&&(w.refreshing=!0,s.then(function(){w.refreshing=!1}))},w.refreshDelay))},w.isActive=function(e){if(!w.open)return!1;var t=w.items.indexOf(e[w.itemProperty]),s=t==w.activeIndex;return!s||0>t?!1:(s&&!angular.isUndefined(w.onHighlightCallback)&&e.$eval(w.onHighlightCallback),s)};var E=function(e){return w.selected&&angular.isArray(w.selected)&&w.selected.filter(function(t){return angular.equals(t,e)}).length>0},S=[];w.isDisabled=function(e){if(w.open){var t=e[w.itemProperty],s=w.items.indexOf(t),i=!1;if(s>=0&&(angular.isDefined(w.disableChoiceExpression)||w.multiple)){if(t.isTag)return!1;w.multiple&&(i=E(t)),!i&&angular.isDefined(w.disableChoiceExpression)&&(i=!!e.$eval(w.disableChoiceExpression)),f(t,i)}return i}},w.select=function(e,s,c){if(void 0===e||!v(e)){if(!w.items&&!w.search&&!w.tagging.isActivated)return;if(!e||!v(e)){if(w.clickTriggeredSelect=!1,c&&("click"===c.type||"touchend"===c.type)&&e&&(w.clickTriggeredSelect=!0),w.tagging.isActivated&&w.clickTriggeredSelect===!1){if(w.taggingLabel===!1)if(w.activeIndex<0){if(void 0===e&&(e=void 0!==w.tagging.fct?w.tagging.fct(w.search):w.search),!e||angular.equals(w.items[0],e))return}else e=w.items[w.activeIndex];else if(0===w.activeIndex){if(void 0===e)return;if(void 0!==w.tagging.fct&&"string"==typeof e){if(e=w.tagging.fct(e),!e)return}else"string"==typeof e&&(e=e.replace(w.taggingLabel,"").trim())}if(E(e))return void w.close(s)}h(),t.$broadcast("uis:select",e);var n={};n[w.parserResult.itemName]=e,i(function(){w.onSelectCallback(t,{$item:e,$model:w.parserResult.modelMapper(t,n)})}),w.closeOnSelect&&w.close(s)}}},w.close=function(e){w.open&&(w.ngModel&&w.ngModel.$setTouched&&w.ngModel.$setTouched(),w.open=!1,h(),t.$broadcast("uis:close",e))},w.setFocus=function(){w.focus||w.focusInput[0].focus()},w.clear=function(e){w.select(void 0),e.stopPropagation(),i(function(){w.focusser[0].focus()},0,!1)},w.toggle=function(e){w.open?(w.close(),e.preventDefault(),e.stopPropagation()):w.activate()},w.isLocked=function(){return!1},t.$watch(function(){return angular.isDefined(w.lockChoiceExpression)&&""!==w.lockChoiceExpression},$);var C=null,I=!1;w.sizeSearchInput=function(){var e=w.searchInput[0],s=w.searchInput.parent().parent()[0],c=function(){return s.clientWidth*!!e.offsetParent},n=function(t){if(0===t)return!1;var s=t-e.offsetLeft-10;return 50>s&&(s=t),w.searchInput.css("width",s+"px"),!0};w.searchInput.css("width","10px"),i(function(){null!==C||n(c())||(C=t.$watch(function(){I||(I=!0,t.$$postDigest(function(){I=!1,n(c())&&(C(),C=null)}))},angular.noop))})},w.searchInput.on("keydown",function(s){var c=s.which;~[e.ENTER,e.ESC].indexOf(c)&&(s.preventDefault(),s.stopPropagation()),t.$apply(function(){var t=!1;if((w.items.length>0||w.tagging.isActivated)&&(m(c)||w.searchEnabled||(s.preventDefault(),s.stopPropagation()),w.taggingTokens.isActivated)){for(var n=0;n<w.taggingTokens.tokens.length;n++)w.taggingTokens.tokens[n]===e.MAP[s.keyCode]&&w.search.length>0&&(t=!0);t&&i(function(){w.searchInput.triggerHandler("tagged");var t=w.search.replace(e.MAP[s.keyCode],"").trim();w.tagging.fct&&(t=w.tagging.fct(t)),t&&w.select(t,!0)})}}),e.isVerticalMovement(c)&&w.items.length>0&&b(),c!==e.ENTER&&c!==e.ESC||(s.preventDefault(),s.stopPropagation())}),w.searchInput.on("paste",function(t){var s;if(s=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain"),s=w.search+s,s&&s.length>0)if(w.taggingTokens.isActivated){for(var i=[],c=0;c<w.taggingTokens.tokens.length;c++){var n=e.toSeparator(w.taggingTokens.tokens[c])||w.taggingTokens.tokens[c];if(s.indexOf(n)>-1){i=s.split(n);break}}0===i.length&&(i=[s]);var l=w.search;angular.forEach(i,function(e){var t=w.tagging.fct?w.tagging.fct(e):e;t&&w.select(t,!0)}),w.search=l||y,t.preventDefault(),t.stopPropagation()}else w.paste&&(w.paste(s),w.search=y,t.preventDefault(),t.stopPropagation())}),w.searchInput.on("tagged",function(){i(function(){h()})});var A=n(function(){w.sizeSearchInput()},50);angular.element(d).bind("resize",A),t.$on("$destroy",function(){w.searchInput.off("keyup keydown tagged blur paste"),angular.element(d).off("resize",A)}),t.$watch("$select.activeIndex",function(e){e&&s.find("input").attr("aria-activedescendant","ui-select-choices-row-"+w.generatedId+"-"+e)}),t.$watch("$select.open",function(e){e||s.find("input").removeAttr("aria-activedescendant")})}]),s.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,s,i,c,n,l){return{restrict:"EA",templateUrl:function(e,s){var i=s.theme||t.theme;return i+(angular.isDefined(s.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(c,a){var r=/{(.*)}\s*{(.*)}/.exec(a.ngClass);if(r){var o="{"+r[1]+", "+r[2]+"}";a.ngClass=o,c.attr("ng-class",o)}return angular.isDefined(a.multiple)?c.append("<ui-select-multiple/>").removeAttr("multiple"):c.append("<ui-select-single/>"),a.inputId&&(c.querySelectorAll("input.ui-select-search")[0].id=a.inputId),function(c,a,r,o,u){function d(e){if(g.open){var t=!1;if(t=window.jQuery?window.jQuery.contains(a[0],e.target):a[0].contains(e.target),!t&&!g.clickTriggeredSelect){var s;if(g.skipFocusser)s=!0;else{var i=["input","button","textarea","select"],n=angular.element(e.target).controller("uiSelect");s=n&&n!==g,s||(s=~i.indexOf(e.target.tagName.toLowerCase()))}g.close(s),c.$digest()}g.clickTriggeredSelect=!1}}function p(){var t=i(a);$=angular.element('<div class="ui-select-placeholder"></div>'),$[0].style.width=t.width+"px",$[0].style.height=t.height+"px",a.after($),m=a[0].style.width,e.find("body").append(a),a[0].style.position="absolute",a[0].style.left=t.left+"px",a[0].style.top=t.top+"px",a[0].style.width=t.width+"px"}function h(){null!==$&&($.replaceWith(a),$=null,a[0].style.position="",a[0].style.left="",a[0].style.top="",a[0].style.width=m,g.setFocus())}var g=o[0],f=o[1];g.generatedId=t.generateId(),g.baseTitle=r.title||"Select box",g.focusserTitle=g.baseTitle+" focus",g.focusserId="focusser-"+g.generatedId,g.closeOnSelect=function(){return angular.isDefined(r.closeOnSelect)?n(r.closeOnSelect)():t.closeOnSelect}(),c.$watch("skipFocusser",function(){var e=c.$eval(r.skipFocusser);g.skipFocusser=void 0!==e?e:t.skipFocusser}),g.onSelectCallback=n(r.onSelect),g.onRemoveCallback=n(r.onRemove),g.ngModel=f,g.choiceGrouped=function(e){return g.isGrouped&&e&&e.name},r.tabindex&&r.$observe("tabindex",function(e){g.focusInput.attr("tabindex",e),a.removeAttr("tabindex")}),c.$watch(function(){return c.$eval(r.searchEnabled)},function(e){g.searchEnabled=void 0!==e?e:t.searchEnabled}),c.$watch("sortable",function(){var e=c.$eval(r.sortable);g.sortable=void 0!==e?e:t.sortable}),r.$observe("limit",function(){g.limit=angular.isDefined(r.limit)?parseInt(r.limit,10):void 0}),c.$watch("removeSelected",function(){var e=c.$eval(r.removeSelected);g.removeSelected=void 0!==e?e:t.removeSelected}),r.$observe("disabled",function(){g.disabled=void 0!==r.disabled?r.disabled:!1}),r.$observe("resetSearchInput",function(){var e=c.$eval(r.resetSearchInput);g.resetSearchInput=void 0!==e?e:!0}),r.$observe("paste",function(){g.paste=c.$eval(r.paste)}),r.$observe("tagging",function(){if(void 0!==r.tagging){var e=c.$eval(r.tagging);g.tagging={isActivated:!0,fct:e!==!0?e:void 0}}else g.tagging={isActivated:!1,fct:void 0}}),r.$observe("taggingLabel",function(){
void 0!==r.tagging&&("false"===r.taggingLabel?g.taggingLabel=!1:g.taggingLabel=void 0!==r.taggingLabel?r.taggingLabel:"(new)")}),r.$observe("taggingTokens",function(){if(void 0!==r.tagging){var e=void 0!==r.taggingTokens?r.taggingTokens.split("|"):[",","ENTER"];g.taggingTokens={isActivated:!0,tokens:e}}}),r.$observe("spinnerEnabled",function(){var e=c.$eval(r.spinnerEnabled);g.spinnerEnabled=void 0!==e?e:t.spinnerEnabled}),r.$observe("spinnerClass",function(){var e=r.spinnerClass;g.spinnerClass=void 0!==e?r.spinnerClass:t.spinnerClass}),angular.isDefined(r.autofocus)&&l(function(){g.setFocus()}),angular.isDefined(r.focusOn)&&c.$on(r.focusOn,function(){l(function(){g.setFocus()})}),e.on("click",d),c.$on("$destroy",function(){e.off("click",d)}),u(c,function(e){var t=angular.element("<div>").append(e),i=t.querySelectorAll(".ui-select-match");if(i.removeAttr("ui-select-match"),i.removeAttr("data-ui-select-match"),1!==i.length)throw s("transcluded","Expected 1 .ui-select-match but got '{0}'.",i.length);a.querySelectorAll(".ui-select-match").replaceWith(i);var c=t.querySelectorAll(".ui-select-choices");if(c.removeAttr("ui-select-choices"),c.removeAttr("data-ui-select-choices"),1!==c.length)throw s("transcluded","Expected 1 .ui-select-choices but got '{0}'.",c.length);a.querySelectorAll(".ui-select-choices").replaceWith(c);var n=t.querySelectorAll(".ui-select-no-choice");n.removeAttr("ui-select-no-choice"),n.removeAttr("data-ui-select-no-choice"),1==n.length&&a.querySelectorAll(".ui-select-no-choice").replaceWith(n)});var v=c.$eval(r.appendToBody);(void 0!==v?v:t.appendToBody)&&(c.$watch("$select.open",function(e){e?p():h()}),c.$on("$destroy",function(){h()}));var $=null,m="",b=null,w="direction-up";c.$watch("$select.open",function(){"auto"!==g.dropdownPosition&&"up"!==g.dropdownPosition||c.calculateDropdownPos()});var y=function(e,t){e=e||i(a),t=t||i(b),b[0].style.position="absolute",b[0].style.top=-1*t.height+"px",a.addClass(w)},x=function(e,t){a.removeClass(w),e=e||i(a),t=t||i(b),b[0].style.position="",b[0].style.top=""},E=function(){l(function(){if("up"===g.dropdownPosition)y();else{a.removeClass(w);var t=i(a),s=i(b),c=e[0].documentElement.scrollTop||e[0].body.scrollTop;t.top+t.height+s.height>c+e[0].documentElement.clientHeight?y(t,s):x(t,s)}b[0].style.opacity=1})},S=!1;c.calculateDropdownPos=function(){if(g.open){if(b=angular.element(a).querySelectorAll(".ui-select-dropdown"),0===b.length)return;if(""!==g.search||S||(b[0].style.opacity=0,S=!0),!i(b).height&&g.$animate&&g.$animate.on&&g.$animate.enabled(b)){var e=!0;g.$animate.on("enter",b,function(t,s){"close"===s&&e&&(E(),e=!1)})}else E()}else{if(null===b||0===b.length)return;b[0].style.opacity=0,b[0].style.position="",b[0].style.top="",a.removeClass(w)}}}}}}]),s.directive("uiSelectMatch",["uiSelectConfig",function(e){function t(e,t){return e[0].hasAttribute(t)?e.attr(t):e[0].hasAttribute("data-"+t)?e.attr("data-"+t):e[0].hasAttribute("x-"+t)?e.attr("x-"+t):void 0}return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(s){s.addClass("ui-select-match");var i=s.parent(),c=t(i,"theme")||e.theme,n=angular.isDefined(t(i,"multiple"));return c+(n?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,s,i,c){function n(e){c.allowClear=angular.isDefined(e)?""===e?!0:"true"===e.toLowerCase():!1}c.lockChoiceExpression=i.uiLockChoice,i.$observe("placeholder",function(t){c.placeholder=void 0!==t?t:e.placeholder}),i.$observe("allowClear",n),n(i.allowClear),c.multiple&&c.sizeSearchInput()}}}]),s.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(t,s){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var s,i=this,c=e.$select;angular.isUndefined(c.selected)&&(c.selected=[]),e.$evalAsync(function(){s=e.ngModel}),i.activeMatchIndex=-1,i.updateModel=function(){s.$setViewValue(Date.now()),i.refreshComponent()},i.refreshComponent=function(){c.refreshItems&&c.refreshItems(),c.sizeSearchInput&&c.sizeSearchInput()},i.removeChoice=function(s){if(c.isLocked(null,s))return!1;var n=c.selected[s],l={};return l[c.parserResult.itemName]=n,c.selected.splice(s,1),i.activeMatchIndex=-1,c.sizeSearchInput(),t(function(){c.onRemoveCallback(e,{$item:n,$model:c.parserResult.modelMapper(e,l)})}),i.updateModel(),!0},i.getPlaceholder=function(){return c.selected&&c.selected.length?void 0:c.placeholder}}],controllerAs:"$selectMultiple",link:function(i,c,n,l){function a(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function r(t){function s(){switch(t){case e.LEFT:return~h.activeMatchIndex?u:l;case e.RIGHT:return~h.activeMatchIndex&&r!==l?o:(d.activate(),!1);case e.BACKSPACE:return~h.activeMatchIndex?h.removeChoice(r)?u:r:l;case e.DELETE:return~h.activeMatchIndex?(h.removeChoice(h.activeMatchIndex),r):!1}}var i=a(d.searchInput[0]),c=d.selected.length,n=0,l=c-1,r=h.activeMatchIndex,o=h.activeMatchIndex+1,u=h.activeMatchIndex-1,p=r;return i>0||d.search.length&&t==e.RIGHT?!1:(d.close(),p=s(),d.selected.length&&p!==!1?h.activeMatchIndex=Math.min(l,Math.max(n,p)):h.activeMatchIndex=-1,!0)}function o(e){if(void 0===e||void 0===d.search)return!1;var t=e.filter(function(e){return void 0===d.search.toUpperCase()||void 0===e?!1:e.toUpperCase()===d.search.toUpperCase()}).length>0;return t}function u(e,t){var s=-1;if(angular.isArray(e))for(var i=angular.copy(e),c=0;c<i.length;c++)if(void 0===d.tagging.fct)i[c]+" "+d.taggingLabel===t&&(s=c);else{var n=i[c];angular.isObject(n)&&(n.isTag=!0),angular.equals(n,t)&&(s=c)}return s}var d=l[0],p=i.ngModel=l[1],h=i.$selectMultiple;d.multiple=!0,d.focusInput=d.searchInput,p.$isEmpty=function(e){return!e||0===e.length},p.$parsers.unshift(function(){for(var e,t={},s=[],c=d.selected.length-1;c>=0;c--)t={},t[d.parserResult.itemName]=d.selected[c],e=d.parserResult.modelMapper(i,t),s.unshift(e);return s}),p.$formatters.unshift(function(e){var t,s=d.parserResult&&d.parserResult.source(i,{$select:{search:""}}),c={};if(!s)return e;var n=[],l=function(e,s){if(e&&e.length){for(var l=e.length-1;l>=0;l--){if(c[d.parserResult.itemName]=e[l],t=d.parserResult.modelMapper(i,c),d.parserResult.trackByExp){var a=/(\w*)\./.exec(d.parserResult.trackByExp),r=/\.([^\s]+)/.exec(d.parserResult.trackByExp);if(a&&a.length>0&&a[1]==d.parserResult.itemName&&r&&r.length>0&&t[r[1]]==s[r[1]])return n.unshift(e[l]),!0}if(angular.equals(t,s))return n.unshift(e[l]),!0}return!1}};if(!e)return n;for(var a=e.length-1;a>=0;a--)l(d.selected,e[a])||l(s,e[a])||n.unshift(e[a]);return n}),i.$watchCollection(function(){return p.$modelValue},function(e,t){t!=e&&(angular.isDefined(p.$modelValue)&&(p.$modelValue=null),h.refreshComponent())}),p.$render=function(){if(!angular.isArray(p.$viewValue)){if(!angular.isUndefined(p.$viewValue)&&null!==p.$viewValue)throw t("multiarr","Expected model value to be array but got '{0}'",p.$viewValue);p.$viewValue=[]}d.selected=p.$viewValue,h.refreshComponent(),i.$evalAsync()},i.$on("uis:select",function(e,t){d.selected.length>=d.limit||(d.selected.push(t),h.updateModel())}),i.$on("uis:activate",function(){h.activeMatchIndex=-1}),i.$watch("$select.disabled",function(e,t){t&&!e&&d.sizeSearchInput()}),d.searchInput.on("keydown",function(t){var s=t.which;i.$apply(function(){var i=!1;e.isHorizontalMovement(s)&&(i=r(s)),i&&s!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),d.searchInput.on("keyup",function(t){if(e.isVerticalMovement(t.which)||i.$evalAsync(function(){d.activeIndex=d.taggingLabel===!1?-1:0}),d.tagging.isActivated&&d.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;if(d.activeIndex=d.taggingLabel===!1?-1:0,d.taggingLabel===!1)return;var s,c,n,l,a=angular.copy(d.items),r=angular.copy(d.items),p=!1,h=-1;if(void 0!==d.tagging.fct){if(n=d.$filter("filter")(a,{isTag:!0}),n.length>0&&(l=n[0]),a.length>0&&l&&(p=!0,a=a.slice(1,a.length),r=r.slice(1,r.length)),s=d.tagging.fct(d.search),r.some(function(e){return angular.equals(e,s)})||d.selected.some(function(e){return angular.equals(e,s)}))return void i.$evalAsync(function(){d.activeIndex=0,d.items=a});s&&(s.isTag=!0)}else{if(n=d.$filter("filter")(a,function(e){return e.match(d.taggingLabel)}),n.length>0&&(l=n[0]),c=a[0],void 0!==c&&a.length>0&&l&&(p=!0,a=a.slice(1,a.length),r=r.slice(1,r.length)),s=d.search+" "+d.taggingLabel,u(d.selected,d.search)>-1)return;if(o(r.concat(d.selected)))return void(p&&(a=r,i.$evalAsync(function(){d.activeIndex=0,d.items=a})));if(o(r))return void(p&&(d.items=r.slice(1,r.length)))}p&&(h=u(d.selected,s)),h>-1?a=a.slice(h+1,a.length-1):(a=[],s&&a.push(s),a=a.concat(r)),i.$evalAsync(function(){if(d.activeIndex=0,d.items=a,d.isGrouped){var e=s?a.slice(1):a;d.setItemsFn(e),s&&(d.items.unshift(s),d.groups.unshift({name:"",items:[s],tagging:!0}))}})}}),d.searchInput.on("blur",function(){s(function(){h.activeMatchIndex=-1})})}}}]),s.directive("uiSelectNoChoice",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){t.addClass("ui-select-no-choice");var s=t.parent().attr("theme")||e.theme;return s+"/no-choice.tpl.html"}}}]),s.directive("uiSelectSingle",["$timeout","$compile",function(t,s){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(i,c,n,l){var a=l[0],r=l[1];r.$parsers.unshift(function(e){var t,s={};return s[a.parserResult.itemName]=e,t=a.parserResult.modelMapper(i,s)}),r.$formatters.unshift(function(e){var t,s=a.parserResult&&a.parserResult.source(i,{$select:{search:""}}),c={};if(s){var n=function(s){return c[a.parserResult.itemName]=s,t=a.parserResult.modelMapper(i,c),t===e};if(a.selected&&n(a.selected))return a.selected;for(var l=s.length-1;l>=0;l--)if(n(s[l]))return s[l]}return e}),i.$watch("$select.selected",function(e){r.$viewValue!==e&&r.$setViewValue(e)}),r.$render=function(){a.selected=r.$viewValue},i.$on("uis:select",function(e,t){a.selected=t}),i.$on("uis:close",function(e,s){t(function(){a.focusser.prop("disabled",!1),s||a.focusser[0].focus()},0,!1)}),i.$on("uis:activate",function(){o.prop("disabled",!0)});var o=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");s(o)(i),a.focusser=o,a.focusInput=o,c.parent().append(o),o.bind("focus",function(){i.$evalAsync(function(){a.focus=!0})}),o.bind("blur",function(){i.$evalAsync(function(){a.focus=!1})}),o.bind("keydown",function(t){return t.which===e.BACKSPACE?(t.preventDefault(),t.stopPropagation(),a.select(void 0),void i.$apply()):void(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||(t.which!=e.DOWN&&t.which!=e.UP&&t.which!=e.ENTER&&t.which!=e.SPACE||(t.preventDefault(),t.stopPropagation(),a.activate()),i.$digest()))}),o.bind("keyup input",function(t){t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE||(a.activate(o.val()),o.val(""),i.$digest())})}}}]),s.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,s){return{require:["^^uiSelect","^ngModel"],link:function(t,i,c,n){if(null===t[c.uiSelectSort])throw s("sort","Expected a list to sort");var l=n[0],a=n[1],r=angular.extend({axis:"horizontal"},t.$eval(c.uiSelectSortOptions)),o=r.axis,u="dragging",d="dropping",p="dropping-before",h="dropping-after";t.$watch(function(){return l.sortable},function(e){e?i.attr("draggable",!0):i.removeAttr("draggable")}),i.on("dragstart",function(e){i.addClass(u),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text",t.$index.toString())}),i.on("dragend",function(){v(u)});var g,f=function(e,t){this.splice(t,0,this.splice(e,1)[0])},v=function(e){angular.forEach(l.$element.querySelectorAll("."+e),function(t){angular.element(t).removeClass(e)})},$=function(e){e.preventDefault();var t="vertical"===o?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0);t<this["vertical"===o?"offsetHeight":"offsetWidth"]/2?(v(h),i.addClass(p)):(v(p),i.addClass(h))},m=function(t){t.preventDefault();var s=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text"),10);e.cancel(g),g=e(function(){b(s)},20)},b=function(e){var s=t.$eval(c.uiSelectSort),n=s[e],l=null;l=i.hasClass(p)?e<t.$index?t.$index-1:t.$index:e<t.$index?t.$index:t.$index+1,f.apply(s,[e,l]),a.$setViewValue(Date.now()),t.$apply(function(){t.$emit("uiSelectSort:change",{array:s,item:n,from:e,to:l})}),v(d),v(p),v(h),i.off("drop",m)};i.on("dragenter",function(){i.hasClass(u)||(i.addClass(d),i.on("dragover",$),i.on("drop",m))}),i.on("dragleave",function(e){e.target==i&&(v(d),v(p),v(h),i.off("dragover",$),i.off("drop",m))})}}}]),s.factory("$$uisDebounce",["$timeout",function(e){return function(t,s){var i;return function(){var c=this,n=Array.prototype.slice.call(arguments);i&&e.cancel(i),i=e(function(){t.apply(c,n)},s)}}}]),s.directive("uisOpenClose",["$parse","$timeout",function(e,t){return{restrict:"A",require:"uiSelect",link:function(s,i,c,n){n.onOpenCloseCallback=e(c.uisOpenClose),s.$watch("$select.open",function(e,i){e!==i&&t(function(){n.onOpenCloseCallback(s,{isOpen:e})})})}}}]),s.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){var s=this;s.parse=function(s){var i;if(i=s.match(/^\s*(?:([\s\S]+?)\s+as\s+)?(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(\s*[\s\S]+?)?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),!i)throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",s);var c=i[5],n="";if(i[3]){c=i[5].replace(/(^\()|(\)$)/g,"");var l=i[5].match(/^\s*(?:[\s\S]+?)(?:[^\|]|\|\|)+([\s\S]*)\s*$/);l&&l[1].trim()&&(n=l[1],c=c.replace(n,""))}return{itemName:i[4]||i[2],keyName:i[3],source:t(c),filters:n,trackByExp:i[6],modelMapper:t(i[1]||i[4]||i[2]),repeatExpression:function(e){var t=this.itemName+" in "+(e?"$group.items":"$select.items");return this.trackByExp&&(t+=" track by "+this.trackByExp),t}}},s.getGroupNgRepeatExpression=function(){return"$group in $select.groups track by $group.name"}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu" ng-show="$select.open && $select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><span class="ui-select-choices-row-inner"></span></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected track by $index"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/no-choice.tpl.html",'<ul class="ui-select-no-choice dropdown-menu" ng-show="$select.items.length == 0"><li ng-transclude=""></li></ul>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-expanded="{{$select.open}}" aria-label="{{$select.baseTitle}}" ng-class="{\'spinner\': $select.refreshing}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><span ng-show="$select.open && $select.refreshing && $select.spinnerEnabled" class="ui-select-refreshing {{$select.spinnerClass}}"></span> <input type="search" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" class="form-control ui-select-search" ng-class="{ \'ui-select-search-hidden\' : !$select.searchEnabled }" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.open"><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("select2/choices.tpl.html",'<ul tabindex="-1" class="ui-select-choices ui-select-choices-content select2-results"><li class="ui-select-choices-group" ng-class="{\'select2-result-with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label select2-result-label" ng-bind="$group.name"></div><ul id="ui-select-choices-{{ $select.generatedId }}" ng-class="{\'select2-result-sub\': $select.choiceGrouped($group), \'select2-result-single\': !$select.choiceGrouped($group) }"><li role="option" ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{\'select2-highlighted\': $select.isActive(this), \'select2-disabled\': $select.isDisabled(this)}"><div class="select2-result-label ui-select-choices-row-inner"></div></li></ul></li></ul>'),e.put("select2/match-multiple.tpl.html",'<span class="ui-select-match"><li class="ui-select-match-item select2-search-choice" ng-repeat="$item in $select.selected track by $index" ng-class="{\'select2-search-choice-focus\':$selectMultiple.activeMatchIndex === $index, \'select2-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span uis-transclude-append=""></span> <a href="javascript:;" class="ui-select-match-close select2-search-choice-close" ng-click="$selectMultiple.removeChoice($index)" tabindex="-1"></a></li></span>'),e.put("select2/match.tpl.html",'<a class="select2-choice ui-select-match" ng-class="{\'select2-default\': $select.isEmpty()}" ng-click="$select.toggle($event)" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="select2-chosen">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="select2-chosen" ng-transclude=""></span> <abbr ng-if="$select.allowClear && !$select.isEmpty()" class="select2-search-choice-close" ng-click="$select.clear($event)"></abbr> <span class="select2-arrow ui-select-toggle"><b></b></span></a>'),e.put("select2/no-choice.tpl.html",'<div class="ui-select-no-choice dropdown" ng-show="$select.items.length == 0"><div class="dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("select2/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple select2 select2-container select2-container-multi" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled}"><ul class="select2-choices"><span class="ui-select-match"></span><li class="select2-search-field"><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="select2-input ui-select-search" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-model="$select.search" ng-click="$select.activate()" style="width: 34px;" ondrop="return false;"></li></ul><div class="ui-select-dropdown select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open || $select.items.length === 0}"><div class="ui-select-choices"></div></div></div>'),e.put("select2/select.tpl.html",'<div class="ui-select-container select2 select2-container" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled, \'select2-container-active\': $select.focus, \'select2-allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="ui-select-dropdown select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="search-container" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled, \'select2-search\':$select.searchEnabled}"><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" ng-class="{\'select2-active\': $select.refreshing}" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" class="ui-select-search select2-input" ng-model="$select.search"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div></div>'),e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices ui-select-dropdown selectize-dropdown" ng-class="{\'single\': !$select.multiple, \'multi\': $select.multiple}"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match-multiple.tpl.html",'<div class="ui-select-match" data-value="" ng-repeat="$item in $select.selected track by $index" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'active\':$selectMultiple.activeMatchIndex === $index}" ui-select-sort="$select.selected"><span class="ui-select-match-item" ng-class="{\'select-locked\':$select.isLocked(this, $index)}"><span uis-transclude-append=""></span> <span class="remove ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&times;</span></span></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="$select.searchEnabled && ($select.open || $select.isEmpty())" class="ui-select-match"><span ng-show="!$select.searchEnabled && ($select.isEmpty() || $select.open)" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty() || $select.open" ng-transclude=""></span></div>'),e.put("selectize/no-choice.tpl.html",'<div class="ui-select-no-choice selectize-dropdown" ng-show="$select.items.length == 0"><div class="selectize-dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("selectize/select-multiple.tpl.html",'<div class="ui-select-container selectize-control multi plugin-remove_button" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-model="$select.search" ng-disabled="$select.disabled" aria-expanded="{{$select.open}}" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-class="{\'ui-select-search-hidden\':!$select.searchEnabled}" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.isEmpty() && !$select.open" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>')}]);!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Chart=t()}}(function(){return function t(e,a,i){function n(r,l){if(!a[r]){if(!e[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[r]={exports:{}};e[r][0].call(u.exports,function(t){var a=e[r][1][t];return n(a?a:t)},u,u.exports,t,e,a,i)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(t,e,a){},{}],2:[function(t,e,a){function i(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,a=/^#([a-fA-F0-9]{6})$/,i=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,n=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/(\w+)/,r=[0,0,0],l=1,s=t.match(e);if(s){s=s[1];for(var d=0;d<r.length;d++)r[d]=parseInt(s[d]+s[d],16)}else if(s=t.match(a)){s=s[1];for(var d=0;d<r.length;d++)r[d]=parseInt(s.slice(2*d,2*d+2),16)}else if(s=t.match(i)){for(var d=0;d<r.length;d++)r[d]=parseInt(s[d+1]);l=parseFloat(s[4])}else if(s=t.match(n)){for(var d=0;d<r.length;d++)r[d]=Math.round(2.55*parseFloat(s[d+1]));l=parseFloat(s[4])}else if(s=t.match(o)){if("transparent"==s[1])return[0,0,0,0];if(r=y[s[1]],!r)return}for(var d=0;d<r.length;d++)r[d]=v(r[d],0,255);return l=l||0==l?v(l,0,1):1,r[3]=l,r}}function n(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,a=t.match(e);if(a){var i=parseFloat(a[4]),n=v(parseInt(a[1]),0,360),o=v(parseFloat(a[2]),0,100),r=v(parseFloat(a[3]),0,100),l=v(isNaN(i)?1:i,0,1);return[n,o,r,l]}}}function o(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,a=t.match(e);if(a){var i=parseFloat(a[4]),n=v(parseInt(a[1]),0,360),o=v(parseFloat(a[2]),0,100),r=v(parseFloat(a[3]),0,100),l=v(isNaN(i)?1:i,0,1);return[n,o,r,l]}}}function r(t){var e=i(t);return e&&e.slice(0,3)}function l(t){var e=n(t);return e&&e.slice(0,3)}function s(t){var e=i(t);return e?e[3]:(e=n(t))?e[3]:(e=o(t))?e[3]:void 0}function d(t){return"#"+x(t[0])+x(t[1])+x(t[2])}function u(t,e){return 1>e||t[3]&&t[3]<1?c(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function c(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function h(t,e){if(1>e||t[3]&&t[3]<1)return f(t,e);var a=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return"rgb("+a+"%, "+i+"%, "+n+"%)"}function f(t,e){var a=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return"rgba("+a+"%, "+i+"%, "+n+"%, "+(e||t[3]||1)+")"}function g(t,e){return 1>e||t[3]&&t[3]<1?p(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function p(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function m(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function b(t){return k[t.slice(0,3)]}function v(t,e,a){return Math.min(Math.max(e,t),a)}function x(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var y=t(6);e.exports={getRgba:i,getHsla:n,getRgb:r,getHsl:l,getHwb:o,getAlpha:s,hexString:d,rgbString:u,rgbaString:c,percentString:h,percentaString:f,hslString:g,hslaString:p,hwbString:m,keyword:b};var k={};for(var S in y)k[y[S]]=S},{6:6}],3:[function(t,e,a){var i=t(5),n=t(2),o=function(t){if(t instanceof o)return t;if(!(this instanceof o))return new o(t);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var e;if("string"==typeof t)if(e=n.getRgba(t))this.setValues("rgb",e);else if(e=n.getHsla(t))this.setValues("hsl",e);else{if(!(e=n.getHwb(t)))throw new Error('Unable to parse color from string "'+t+'"');this.setValues("hwb",e)}else if("object"==typeof t)if(e=t,void 0!==e.r||void 0!==e.red)this.setValues("rgb",e);else if(void 0!==e.l||void 0!==e.lightness)this.setValues("hsl",e);else if(void 0!==e.v||void 0!==e.value)this.setValues("hsv",e);else if(void 0!==e.w||void 0!==e.whiteness)this.setValues("hwb",e);else{if(void 0===e.c&&void 0===e.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(t));this.setValues("cmyk",e)}};o.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){var t=this.values;return 1!==t.alpha?t.hwb.concat([t.alpha]):t.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values;return t.rgb.concat([t.alpha])},hslaArray:function(){var t=this.values;return t.hsl.concat([t.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=0>t?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){
return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return n.hexString(this.values.rgb)},rgbString:function(){return n.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return n.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return n.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return n.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return n.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return n.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return n.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){var t=this.values.rgb;return t[0]<<16|t[1]<<8|t[2]},luminosity:function(){for(var t=this.values.rgb,e=[],a=0;a<t.length;a++){var i=t[a]/255;e[a]=.03928>=i?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),a=t.luminosity();return e>a?(e+.05)/(a+.05):(a+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return 128>e},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;3>e;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){var e=this.values.hsl;return e[2]+=e[2]*t,this.setValues("hsl",e),this},darken:function(t){var e=this.values.hsl;return e[2]-=e[2]*t,this.setValues("hsl",e),this},saturate:function(t){var e=this.values.hsl;return e[1]+=e[1]*t,this.setValues("hsl",e),this},desaturate:function(t){var e=this.values.hsl;return e[1]-=e[1]*t,this.setValues("hsl",e),this},whiten:function(t){var e=this.values.hwb;return e[1]+=e[1]*t,this.setValues("hwb",e),this},blacken:function(t){var e=this.values.hwb;return e[2]+=e[2]*t,this.setValues("hwb",e),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){var e=this.values.alpha;return this.setValues("alpha",e-e*t),this},opaquer:function(t){var e=this.values.alpha;return this.setValues("alpha",e+e*t),this},rotate:function(t){var e=this.values.hsl,a=(e[0]+t)%360;return e[0]=0>a?360+a:a,this.setValues("hsl",e),this},mix:function(t,e){var a=this,i=t,n=void 0===e?.5:e,o=2*n-1,r=a.alpha()-i.alpha(),l=((o*r===-1?o:(o+r)/(1+o*r))+1)/2,s=1-l;return this.rgb(l*a.red()+s*i.red(),l*a.green()+s*i.green(),l*a.blue()+s*i.blue()).alpha(a.alpha()*n+i.alpha()*(1-n))},toJSON:function(){return this.rgb()},clone:function(){var t,e,a=new o,i=this.values,n=a.values;for(var r in i)i.hasOwnProperty(r)&&(t=i[r],e={}.toString.call(t),"[object Array]"===e?n[r]=t.slice(0):"[object Number]"===e?n[r]=t:console.error("unexpected color value:",t));return a}},o.prototype.spaces={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},o.prototype.maxes={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o.prototype.getValues=function(t){for(var e=this.values,a={},i=0;i<t.length;i++)a[t.charAt(i)]=e[t][i];return 1!==e.alpha&&(a.a=e.alpha),a},o.prototype.setValues=function(t,e){var a,n=this.values,o=this.spaces,r=this.maxes,l=1;if("alpha"===t)l=e;else if(e.length)n[t]=e.slice(0,t.length),l=e[t.length];else if(void 0!==e[t.charAt(0)]){for(a=0;a<t.length;a++)n[t][a]=e[t.charAt(a)];l=e.a}else if(void 0!==e[o[t][0]]){var s=o[t];for(a=0;a<t.length;a++)n[t][a]=e[s[a]];l=e.alpha}if(n.alpha=Math.max(0,Math.min(1,void 0===l?n.alpha:l)),"alpha"===t)return!1;var d;for(a=0;a<t.length;a++)d=Math.max(0,Math.min(r[t][a],n[t][a])),n[t][a]=Math.round(d);for(var u in o)u!==t&&(n[u]=i[t][u](n[t]));return!0},o.prototype.setSpace=function(t,e){var a=e[0];return void 0===a?this.getValues(t):("number"==typeof a&&(a=Array.prototype.slice.call(e)),this.setValues(t,a),this)},o.prototype.setChannel=function(t,e,a){var i=this.values[t];return void 0===a?i[e]:a===i[e]?this:(i[e]=a,this.setValues(t,i),this)},"undefined"!=typeof window&&(window.Color=o),e.exports=o},{2:2,5:5}],4:[function(t,e,a){function i(t){var e,a,i,n=t[0]/255,o=t[1]/255,r=t[2]/255,l=Math.min(n,o,r),s=Math.max(n,o,r),d=s-l;return s==l?e=0:n==s?e=(o-r)/d:o==s?e=2+(r-n)/d:r==s&&(e=4+(n-o)/d),e=Math.min(60*e,360),0>e&&(e+=360),i=(l+s)/2,a=s==l?0:.5>=i?d/(s+l):d/(2-s-l),[e,100*a,100*i]}function n(t){var e,a,i,n=t[0],o=t[1],r=t[2],l=Math.min(n,o,r),s=Math.max(n,o,r),d=s-l;return a=0==s?0:d/s*1e3/10,s==l?e=0:n==s?e=(o-r)/d:o==s?e=2+(r-n)/d:r==s&&(e=4+(n-o)/d),e=Math.min(60*e,360),0>e&&(e+=360),i=s/255*1e3/10,[e,a,i]}function o(t){var e=t[0],a=t[1],n=t[2],o=i(t)[0],r=1/255*Math.min(e,Math.min(a,n)),n=1-1/255*Math.max(e,Math.max(a,n));return[o,100*r,100*n]}function l(t){var e,a,i,n,o=t[0]/255,r=t[1]/255,l=t[2]/255;return n=Math.min(1-o,1-r,1-l),e=(1-o-n)/(1-n)||0,a=(1-r-n)/(1-n)||0,i=(1-l-n)/(1-n)||0,[100*e,100*a,100*i,100*n]}function s(t){return G[JSON.stringify(t)]}function d(t){var e=t[0]/255,a=t[1]/255,i=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var n=.4124*e+.3576*a+.1805*i,o=.2126*e+.7152*a+.0722*i,r=.0193*e+.1192*a+.9505*i;return[100*n,100*o,100*r]}function u(t){var e,a,i,n=d(t),o=n[0],r=n[1],l=n[2];return o/=95.047,r/=100,l/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*r-16,a=500*(o-r),i=200*(r-l),[e,a,i]}function c(t){return W(u(t))}function h(t){var e,a,i,n,o,r=t[0]/360,l=t[1]/100,s=t[2]/100;if(0==l)return o=255*s,[o,o,o];a=.5>s?s*(1+l):s+l-s*l,e=2*s-a,n=[0,0,0];for(var d=0;3>d;d++)i=r+1/3*-(d-1),0>i&&i++,i>1&&i--,o=1>6*i?e+6*(a-e)*i:1>2*i?a:2>3*i?e+(a-e)*(2/3-i)*6:e,n[d]=255*o;return n}function f(t){var e,a,i=t[0],n=t[1]/100,o=t[2]/100;return 0===o?[0,0,0]:(o*=2,n*=1>=o?o:2-o,a=(o+n)/2,e=2*n/(o+n),[i,100*e,100*a])}function p(t){return o(h(t))}function m(t){return l(h(t))}function v(t){return s(h(t))}function x(t){var e=t[0]/60,a=t[1]/100,i=t[2]/100,n=Math.floor(e)%6,o=e-Math.floor(e),r=255*i*(1-a),l=255*i*(1-a*o),s=255*i*(1-a*(1-o)),i=255*i;switch(n){case 0:return[i,s,r];case 1:return[l,i,r];case 2:return[r,i,s];case 3:return[r,l,i];case 4:return[s,r,i];case 5:return[i,r,l]}}function y(t){var e,a,i=t[0],n=t[1]/100,o=t[2]/100;return a=(2-n)*o,e=n*o,e/=1>=a?a:2-a,e=e||0,a/=2,[i,100*e,100*a]}function k(t){return o(x(t))}function S(t){return l(x(t))}function w(t){return s(x(t))}function C(t){var e,a,i,n,o=t[0]/360,l=t[1]/100,s=t[2]/100,d=l+s;switch(d>1&&(l/=d,s/=d),e=Math.floor(6*o),a=1-s,i=6*o-e,0!=(1&e)&&(i=1-i),n=l+i*(a-l),e){default:case 6:case 0:r=a,g=n,b=l;break;case 1:r=n,g=a,b=l;break;case 2:r=l,g=a,b=n;break;case 3:r=l,g=n,b=a;break;case 4:r=n,g=l,b=a;break;case 5:r=a,g=l,b=n}return[255*r,255*g,255*b]}function M(t){return i(C(t))}function D(t){return n(C(t))}function I(t){return l(C(t))}function A(t){return s(C(t))}function T(t){var e,a,i,n=t[0]/100,o=t[1]/100,r=t[2]/100,l=t[3]/100;return e=1-Math.min(1,n*(1-l)+l),a=1-Math.min(1,o*(1-l)+l),i=1-Math.min(1,r*(1-l)+l),[255*e,255*a,255*i]}function P(t){return i(T(t))}function F(t){return n(T(t))}function R(t){return o(T(t))}function _(t){return s(T(t))}function V(t){var e,a,i,n=t[0]/100,o=t[1]/100,r=t[2]/100;return e=3.2406*n+-1.5372*o+r*-.4986,a=n*-.9689+1.8758*o+.0415*r,i=.0557*n+o*-.204+1.057*r,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:e=12.92*e,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=12.92*a,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i=12.92*i,e=Math.min(Math.max(0,e),1),a=Math.min(Math.max(0,a),1),i=Math.min(Math.max(0,i),1),[255*e,255*a,255*i]}function L(t){var e,a,i,n=t[0],o=t[1],r=t[2];return n/=95.047,o/=100,r/=108.883,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,e=116*o-16,a=500*(n-o),i=200*(o-r),[e,a,i]}function O(t){return W(L(t))}function B(t){var e,a,i,n,o=t[0],r=t[1],l=t[2];return 8>=o?(a=100*o/903.3,n=7.787*(a/100)+16/116):(a=100*Math.pow((o+16)/116,3),n=Math.pow(a/100,1/3)),e=.008856>=e/95.047?e=95.047*(r/500+n-16/116)/7.787:95.047*Math.pow(r/500+n,3),i=.008859>=i/108.883?i=108.883*(n-l/200-16/116)/7.787:108.883*Math.pow(n-l/200,3),[e,a,i]}function W(t){var e,a,i,n=t[0],o=t[1],r=t[2];return e=Math.atan2(r,o),a=360*e/2/Math.PI,0>a&&(a+=360),i=Math.sqrt(o*o+r*r),[n,i,a]}function z(t){return V(B(t))}function N(t){var e,a,i,n=t[0],o=t[1],r=t[2];return i=r/360*2*Math.PI,e=o*Math.cos(i),a=o*Math.sin(i),[n,e,a]}function H(t){return B(N(t))}function E(t){return z(N(t))}function U(t){return Z[t]}function q(t){return i(U(t))}function j(t){return n(U(t))}function Y(t){return o(U(t))}function K(t){return l(U(t))}function X(t){return u(U(t))}function J(t){return d(U(t))}e.exports={rgb2hsl:i,rgb2hsv:n,rgb2hwb:o,rgb2cmyk:l,rgb2keyword:s,rgb2xyz:d,rgb2lab:u,rgb2lch:c,hsl2rgb:h,hsl2hsv:f,hsl2hwb:p,hsl2cmyk:m,hsl2keyword:v,hsv2rgb:x,hsv2hsl:y,hsv2hwb:k,hsv2cmyk:S,hsv2keyword:w,hwb2rgb:C,hwb2hsl:M,hwb2hsv:D,hwb2cmyk:I,hwb2keyword:A,cmyk2rgb:T,cmyk2hsl:P,cmyk2hsv:F,cmyk2hwb:R,cmyk2keyword:_,keyword2rgb:U,keyword2hsl:q,keyword2hsv:j,keyword2hwb:Y,keyword2cmyk:K,keyword2lab:X,keyword2xyz:J,xyz2rgb:V,xyz2lab:L,xyz2lch:O,lab2xyz:B,lab2rgb:z,lab2lch:W,lch2lab:N,lch2xyz:H,lch2rgb:E};var Z={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},G={};for(var Q in Z)G[JSON.stringify(Z[Q])]=Q},{}],5:[function(t,e,a){var i=t(4),n=function(){return new d};for(var o in i){n[o+"Raw"]=function(t){return function(e){return"number"==typeof e&&(e=Array.prototype.slice.call(arguments)),i[t](e)}}(o);var r=/(\w+)2(\w+)/.exec(o),l=r[1],s=r[2];n[l]=n[l]||{},n[l][s]=n[o]=function(t){return function(e){"number"==typeof e&&(e=Array.prototype.slice.call(arguments));var a=i[t](e);if("string"==typeof a||void 0===a)return a;for(var n=0;n<a.length;n++)a[n]=Math.round(a[n]);return a}}(o)}var d=function(){this.convs={}};d.prototype.routeSpace=function(t,e){var a=e[0];return void 0===a?this.getValues(t):("number"==typeof a&&(a=Array.prototype.slice.call(e)),this.setValues(t,a))},d.prototype.setValues=function(t,e){return this.space=t,this.convs={},this.convs[t]=e,this},d.prototype.getValues=function(t){var e=this.convs[t];if(!e){var a=this.space,i=this.convs[a];e=n[a][t](i),this.convs[t]=e}return e},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(t){d.prototype[t]=function(e){return this.routeSpace(t,arguments)}}),e.exports=n},{4:4}],6:[function(t,e,a){e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},{}],7:[function(t,e,a){var i=t(27)();t(26)(i),t(22)(i),t(25)(i),t(21)(i),t(23)(i),t(24)(i),t(28)(i),t(32)(i),t(30)(i),t(31)(i),t(33)(i),t(29)(i),t(34)(i),t(35)(i),t(36)(i),t(37)(i),t(38)(i),t(41)(i),t(39)(i),t(40)(i),t(42)(i),t(43)(i),t(44)(i),t(15)(i),t(16)(i),t(17)(i),t(18)(i),t(19)(i),t(20)(i),t(8)(i),t(9)(i),t(10)(i),t(11)(i),t(12)(i),t(13)(i),t(14)(i),window.Chart=e.exports=i},{10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,8:8,9:9}],8:[function(t,e,a){"use strict";e.exports=function(t){t.Bar=function(e,a){return a.type="bar",new t(e,a)}}},{}],9:[function(t,e,a){"use strict";e.exports=function(t){t.Bubble=function(e,a){return a.type="bubble",new t(e,a)}}},{}],10:[function(t,e,a){"use strict";e.exports=function(t){t.Doughnut=function(e,a){return a.type="doughnut",new t(e,a)}}},{}],11:[function(t,e,a){"use strict";e.exports=function(t){t.Line=function(e,a){return a.type="line",new t(e,a)}}},{}],12:[function(t,e,a){"use strict";e.exports=function(t){t.PolarArea=function(e,a){return a.type="polarArea",new t(e,a)}}},{}],13:[function(t,e,a){"use strict";e.exports=function(t){t.Radar=function(e,a){return a.options=t.helpers.configMerge({aspectRatio:1},a.options),a.type="radar",new t(e,a)}}},{}],14:[function(t,e,a){"use strict";e.exports=function(t){var e={hover:{mode:"single"},scales:{xAxes:[{type:"linear",position:"bottom",id:"x-axis-1"}],yAxes:[{type:"linear",position:"left",id:"y-axis-1"}]},tooltips:{callbacks:{title:function(){return""},label:function(t){return"("+t.xLabel+", "+t.yLabel+")"}}}};t.defaults.scatter=e,t.controllers.scatter=t.controllers.line,t.Scatter=function(e,a){return a.type="scatter",new t(e,a)}}},{}],15:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.bar={hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:.8,barPercentage:.9,gridLines:{offsetGridLines:!0}}],yAxes:[{type:"linear"}]}},t.controllers.bar=t.DatasetController.extend({dataElementType:t.elements.Rectangle,initialize:function(e,a){t.DatasetController.prototype.initialize.call(this,e,a),this.getMeta().bar=!0},getBarCount:function(){var t=this,a=0;return e.each(t.chart.data.datasets,function(e,i){var n=t.chart.getDatasetMeta(i);n.bar&&t.chart.isDatasetVisible(i)&&++a},t),a},update:function(t){var a=this;e.each(a.getMeta().data,function(e,i){a.updateElement(e,i,t)},a)},updateElement:function(t,a,i){var n=this,o=n.getMeta(),r=n.getScaleForId(o.xAxisID),l=n.getScaleForId(o.yAxisID),s=l.getBasePixel(),d=n.chart.options.elements.rectangle,u=t.custom||{},c=n.getDataset();e.extend(t,{_xScale:r,_yScale:l,_datasetIndex:n.index,_index:a,_model:{x:n.calculateBarX(a,n.index),y:i?s:n.calculateBarY(a,n.index),label:n.chart.data.labels[a],datasetLabel:c.label,base:i?s:n.calculateBarBase(n.index,a),width:n.calculateBarWidth(a),backgroundColor:u.backgroundColor?u.backgroundColor:e.getValueAtIndexOrDefault(c.backgroundColor,a,d.backgroundColor),borderSkipped:u.borderSkipped?u.borderSkipped:d.borderSkipped,borderColor:u.borderColor?u.borderColor:e.getValueAtIndexOrDefault(c.borderColor,a,d.borderColor),borderWidth:u.borderWidth?u.borderWidth:e.getValueAtIndexOrDefault(c.borderWidth,a,d.borderWidth)}}),t.pivot()},calculateBarBase:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.yAxisID),o=0;if(n.options.stacked){for(var r=a.chart,l=r.data.datasets,s=Number(l[t].data[e]),d=0;t>d;d++){var u=l[d],c=r.getDatasetMeta(d);if(c.bar&&c.yAxisID===n.id&&r.isDatasetVisible(d)){var h=Number(u.data[e]);o+=0>s?Math.min(h,0):Math.max(h,0)}}return n.getPixelForValue(o)}return n.getBasePixel()},getRuler:function(t){var e,a=this,i=a.getMeta(),n=a.getScaleForId(i.xAxisID),o=a.getBarCount();e="category"===n.options.type?n.getPixelForTick(t+1)-n.getPixelForTick(t):n.width/n.ticks.length;var r=e*n.options.categoryPercentage,l=(e-e*n.options.categoryPercentage)/2,s=r/o;if(n.ticks.length!==a.chart.data.labels.length){var d=n.ticks.length/a.chart.data.labels.length;s*=d}var u=s*n.options.barPercentage,c=s-s*n.options.barPercentage;return{datasetCount:o,tickWidth:e,categoryWidth:r,categorySpacing:l,fullBarWidth:s,barWidth:u,barSpacing:c}},calculateBarWidth:function(t){var e=this.getScaleForId(this.getMeta().xAxisID);if(e.options.barThickness)return e.options.barThickness;var a=this.getRuler(t);return e.options.stacked?a.categoryWidth:a.barWidth},getBarIndex:function(t){var e,a,i=0;for(a=0;t>a;++a)e=this.chart.getDatasetMeta(a),e.bar&&this.chart.isDatasetVisible(a)&&++i;return i},calculateBarX:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.xAxisID),o=a.getBarIndex(e),r=a.getRuler(t),l=n.getPixelForValue(null,t,e,a.chart.isCombo);return l-=a.chart.isCombo?r.tickWidth/2:0,n.options.stacked?l+r.categoryWidth/2+r.categorySpacing:l+r.barWidth/2+r.categorySpacing+r.barWidth*o+r.barSpacing/2+r.barSpacing*o},calculateBarY:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.yAxisID),o=Number(a.getDataset().data[t]);if(n.options.stacked){for(var r=0,l=0,s=0;e>s;s++){var d=a.chart.data.datasets[s],u=a.chart.getDatasetMeta(s);if(u.bar&&u.yAxisID===n.id&&a.chart.isDatasetVisible(s)){var c=Number(d.data[t]);0>c?l+=c||0:r+=c||0}}return 0>o?n.getPixelForValue(l+o):n.getPixelForValue(r+o)}return n.getPixelForValue(o)},draw:function(t){var a=this,i=t||1;e.each(a.getMeta().data,function(t,e){var n=a.getDataset().data[e];null===n||void 0===n||isNaN(n)||t.transition(i).draw()},a)},setHoverStyle:function(t){var a=this.chart.data.datasets[t._datasetIndex],i=t._index,n=t.custom||{},o=t._model;o.backgroundColor=n.hoverBackgroundColor?n.hoverBackgroundColor:e.getValueAtIndexOrDefault(a.hoverBackgroundColor,i,e.getHoverColor(o.backgroundColor)),o.borderColor=n.hoverBorderColor?n.hoverBorderColor:e.getValueAtIndexOrDefault(a.hoverBorderColor,i,e.getHoverColor(o.borderColor)),o.borderWidth=n.hoverBorderWidth?n.hoverBorderWidth:e.getValueAtIndexOrDefault(a.hoverBorderWidth,i,o.borderWidth)},removeHoverStyle:function(t){var a=this.chart.data.datasets[t._datasetIndex],i=t._index,n=t.custom||{},o=t._model,r=this.chart.options.elements.rectangle;o.backgroundColor=n.backgroundColor?n.backgroundColor:e.getValueAtIndexOrDefault(a.backgroundColor,i,r.backgroundColor),o.borderColor=n.borderColor?n.borderColor:e.getValueAtIndexOrDefault(a.borderColor,i,r.borderColor),o.borderWidth=n.borderWidth?n.borderWidth:e.getValueAtIndexOrDefault(a.borderWidth,i,r.borderWidth)}}),t.defaults.horizontalBar={hover:{mode:"label"},scales:{xAxes:[{type:"linear",position:"bottom"}],yAxes:[{position:"left",type:"category",categoryPercentage:.8,barPercentage:.9,gridLines:{offsetGridLines:!0}}]},elements:{rectangle:{borderSkipped:"left"}},tooltips:{callbacks:{title:function(t,e){var a="";return t.length>0&&(t[0].yLabel?a=t[0].yLabel:e.labels.length>0&&t[0].index<e.labels.length&&(a=e.labels[t[0].index])),a},label:function(t,e){var a=e.datasets[t.datasetIndex].label||"";return a+": "+t.xLabel}}}},t.controllers.horizontalBar=t.controllers.bar.extend({updateElement:function(t,a,i){var n=this,o=n.getMeta(),r=n.getScaleForId(o.xAxisID),l=n.getScaleForId(o.yAxisID),s=r.getBasePixel(),d=t.custom||{},u=n.getDataset(),c=n.chart.options.elements.rectangle;e.extend(t,{_xScale:r,_yScale:l,_datasetIndex:n.index,_index:a,_model:{x:i?s:n.calculateBarX(a,n.index),y:n.calculateBarY(a,n.index),label:n.chart.data.labels[a],datasetLabel:u.label,base:i?s:n.calculateBarBase(n.index,a),height:n.calculateBarHeight(a),backgroundColor:d.backgroundColor?d.backgroundColor:e.getValueAtIndexOrDefault(u.backgroundColor,a,c.backgroundColor),borderSkipped:d.borderSkipped?d.borderSkipped:c.borderSkipped,borderColor:d.borderColor?d.borderColor:e.getValueAtIndexOrDefault(u.borderColor,a,c.borderColor),borderWidth:d.borderWidth?d.borderWidth:e.getValueAtIndexOrDefault(u.borderWidth,a,c.borderWidth)},draw:function(){function t(t){return s[(u+t)%4]}var e=this._chart.ctx,a=this._view,i=a.height/2,n=a.y-i,o=a.y+i,r=a.base-(a.base-a.x),l=a.borderWidth/2;a.borderWidth&&(n+=l,o-=l,r+=l),e.beginPath(),e.fillStyle=a.backgroundColor,e.strokeStyle=a.borderColor,e.lineWidth=a.borderWidth;var s=[[a.base,o],[a.base,n],[r,n],[r,o]],d=["bottom","left","top","right"],u=d.indexOf(a.borderSkipped,0);-1===u&&(u=0),e.moveTo.apply(e,t(0));for(var c=1;4>c;c++)e.lineTo.apply(e,t(c));e.fill(),a.borderWidth&&e.stroke()},inRange:function(t,e){var a=this._view,i=!1;return a&&(i=a.x<a.base?e>=a.y-a.height/2&&e<=a.y+a.height/2&&t>=a.x&&t<=a.base:e>=a.y-a.height/2&&e<=a.y+a.height/2&&t>=a.base&&t<=a.x),i}}),t.pivot()},calculateBarBase:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.xAxisID),o=0;if(n.options.stacked){for(var r=a.chart,l=r.data.datasets,s=Number(l[t].data[e]),d=0;t>d;d++){var u=l[d],c=r.getDatasetMeta(d);if(c.bar&&c.xAxisID===n.id&&r.isDatasetVisible(d)){var h=Number(u.data[e]);o+=0>s?Math.min(h,0):Math.max(h,0)}}return n.getPixelForValue(o)}return n.getBasePixel()},getRuler:function(t){var e,a=this,i=a.getMeta(),n=a.getScaleForId(i.yAxisID),o=a.getBarCount();e="category"===n.options.type?n.getPixelForTick(t+1)-n.getPixelForTick(t):n.width/n.ticks.length;var r=e*n.options.categoryPercentage,l=(e-e*n.options.categoryPercentage)/2,s=r/o;if(n.ticks.length!==a.chart.data.labels.length){var d=n.ticks.length/a.chart.data.labels.length;s*=d}var u=s*n.options.barPercentage,c=s-s*n.options.barPercentage;return{datasetCount:o,tickHeight:e,categoryHeight:r,categorySpacing:l,fullBarHeight:s,barHeight:u,barSpacing:c}},calculateBarHeight:function(t){var e=this,a=e.getScaleForId(e.getMeta().yAxisID);if(a.options.barThickness)return a.options.barThickness;var i=e.getRuler(t);return a.options.stacked?i.categoryHeight:i.barHeight},calculateBarX:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.xAxisID),o=Number(a.getDataset().data[t]);if(n.options.stacked){for(var r=0,l=0,s=0;e>s;s++){var d=a.chart.data.datasets[s],u=a.chart.getDatasetMeta(s);if(u.bar&&u.xAxisID===n.id&&a.chart.isDatasetVisible(s)){var c=Number(d.data[t]);0>c?l+=c||0:r+=c||0}}return 0>o?n.getPixelForValue(l+o):n.getPixelForValue(r+o)}return n.getPixelForValue(o)},calculateBarY:function(t,e){var a=this,i=a.getMeta(),n=a.getScaleForId(i.yAxisID),o=a.getBarIndex(e),r=a.getRuler(t),l=n.getPixelForValue(null,t,e,a.chart.isCombo);return l-=a.chart.isCombo?r.tickHeight/2:0,n.options.stacked?l+r.categoryHeight/2+r.categorySpacing:l+r.barHeight/2+r.categorySpacing+r.barHeight*o+r.barSpacing/2+r.barSpacing*o}})}},{}],16:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.bubble={hover:{mode:"single"},scales:{xAxes:[{type:"linear",position:"bottom",id:"x-axis-0"}],yAxes:[{type:"linear",position:"left",id:"y-axis-0"}]},tooltips:{callbacks:{title:function(){return""},label:function(t,e){var a=e.datasets[t.datasetIndex].label||"",i=e.datasets[t.datasetIndex].data[t.index];return a+": ("+i.x+", "+i.y+", "+i.r+")"}}}},t.controllers.bubble=t.DatasetController.extend({dataElementType:t.elements.Point,update:function(t){var a=this,i=a.getMeta(),n=i.data;e.each(n,function(e,i){a.updateElement(e,i,t)})},updateElement:function(a,i,n){var o=this,r=o.getMeta(),l=o.getScaleForId(r.xAxisID),s=o.getScaleForId(r.yAxisID),d=a.custom||{},u=o.getDataset(),c=u.data[i],h=o.chart.options.elements.point,f=o.index;e.extend(a,{_xScale:l,_yScale:s,_datasetIndex:f,_index:i,_model:{x:n?l.getPixelForDecimal(.5):l.getPixelForValue("object"==typeof c?c:NaN,i,f,o.chart.isCombo),y:n?s.getBasePixel():s.getPixelForValue(c,i,f),radius:n?0:d.radius?d.radius:o.getRadius(c),hitRadius:d.hitRadius?d.hitRadius:e.getValueAtIndexOrDefault(u.hitRadius,i,h.hitRadius)}}),t.DatasetController.prototype.removeHoverStyle.call(o,a,h);var g=a._model;g.skip=d.skip?d.skip:isNaN(g.x)||isNaN(g.y),a.pivot()},getRadius:function(t){return t.r||this.chart.options.elements.point.radius},setHoverStyle:function(a){var i=this;t.DatasetController.prototype.setHoverStyle.call(i,a);var n=i.chart.data.datasets[a._datasetIndex],o=a._index,r=a.custom||{},l=a._model;l.radius=r.hoverRadius?r.hoverRadius:e.getValueAtIndexOrDefault(n.hoverRadius,o,i.chart.options.elements.point.hoverRadius)+i.getRadius(n.data[o])},removeHoverStyle:function(e){var a=this;t.DatasetController.prototype.removeHoverStyle.call(a,e,a.chart.options.elements.point);var i=a.chart.data.datasets[e._datasetIndex].data[e._index],n=e.custom||{},o=e._model;o.radius=n.radius?n.radius:a.getRadius(i)}})}},{}],17:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=t.defaults;a.doughnut={animation:{animateRotate:!0,animateScale:!1},aspectRatio:1,hover:{mode:"single"},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var a=t.data,i=a.datasets,n=a.labels;if(i.length)for(var o=0;o<i[0].data.length;++o)e.push('<li><span style="background-color:'+i[0].backgroundColor[o]+'"></span>'),n[o]&&e.push(n[o]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var a=t.data;return a.labels.length&&a.datasets.length?a.labels.map(function(i,n){var o=t.getDatasetMeta(0),r=a.datasets[0],l=o.data[n],s=l&&l.custom||{},d=e.getValueAtIndexOrDefault,u=t.options.elements.arc,c=s.backgroundColor?s.backgroundColor:d(r.backgroundColor,n,u.backgroundColor),h=s.borderColor?s.borderColor:d(r.borderColor,n,u.borderColor),f=s.borderWidth?s.borderWidth:d(r.borderWidth,n,u.borderWidth);return{text:i,fillStyle:c,strokeStyle:h,lineWidth:f,hidden:isNaN(r.data[n])||o.data[n].hidden,index:n}}):[]}},onClick:function(t,e){var a,i,n,o=e.index,r=this.chart;for(a=0,i=(r.data.datasets||[]).length;i>a;++a)n=r.getDatasetMeta(a),n.data[o]&&(n.data[o].hidden=!n.data[o].hidden);r.update()}},cutoutPercentage:50,rotation:Math.PI*-.5,circumference:2*Math.PI,tooltips:{callbacks:{title:function(){return""},label:function(t,e){return e.labels[t.index]+": "+e.datasets[t.datasetIndex].data[t.index]}}}},a.pie=e.clone(a.doughnut),e.extend(a.pie,{cutoutPercentage:0}),t.controllers.doughnut=t.controllers.pie=t.DatasetController.extend({dataElementType:t.elements.Arc,linkScales:e.noop,getRingIndex:function(t){for(var e=0,a=0;t>a;++a)this.chart.isDatasetVisible(a)&&++e;return e},update:function(t){var a=this,i=a.chart,n=i.chartArea,o=i.options,r=o.elements.arc,l=n.right-n.left-r.borderWidth,s=n.bottom-n.top-r.borderWidth,d=Math.min(l,s),u={
x:0,y:0},c=a.getMeta(),h=o.cutoutPercentage,f=o.circumference;if(f<2*Math.PI){var g=o.rotation%(2*Math.PI);g+=2*Math.PI*(g>=Math.PI?-1:g<-Math.PI?1:0);var p=g+f,m={x:Math.cos(g),y:Math.sin(g)},b={x:Math.cos(p),y:Math.sin(p)},v=0>=g&&p>=0||g<=2*Math.PI&&2*Math.PI<=p,x=g<=.5*Math.PI&&.5*Math.PI<=p||g<=2.5*Math.PI&&2.5*Math.PI<=p,y=g<=-Math.PI&&-Math.PI<=p||g<=Math.PI&&Math.PI<=p,k=g<=.5*-Math.PI&&.5*-Math.PI<=p||g<=1.5*Math.PI&&1.5*Math.PI<=p,S=h/100,w={x:y?-1:Math.min(m.x*(m.x<0?1:S),b.x*(b.x<0?1:S)),y:k?-1:Math.min(m.y*(m.y<0?1:S),b.y*(b.y<0?1:S))},C={x:v?1:Math.max(m.x*(m.x>0?1:S),b.x*(b.x>0?1:S)),y:x?1:Math.max(m.y*(m.y>0?1:S),b.y*(b.y>0?1:S))},M={width:.5*(C.x-w.x),height:.5*(C.y-w.y)};d=Math.min(l/M.width,s/M.height),u={x:(C.x+w.x)*-.5,y:(C.y+w.y)*-.5}}i.borderWidth=a.getMaxBorderWidth(c.data),i.outerRadius=Math.max((d-i.borderWidth)/2,0),i.innerRadius=Math.max(h?i.outerRadius/100*h:1,0),i.radiusLength=(i.outerRadius-i.innerRadius)/i.getVisibleDatasetCount(),i.offsetX=u.x*i.outerRadius,i.offsetY=u.y*i.outerRadius,c.total=a.calculateTotal(),a.outerRadius=i.outerRadius-i.radiusLength*a.getRingIndex(a.index),a.innerRadius=a.outerRadius-i.radiusLength,e.each(c.data,function(e,i){a.updateElement(e,i,t)})},updateElement:function(t,a,i){var n=this,o=n.chart,r=o.chartArea,l=o.options,s=l.animation,d=(r.left+r.right)/2,u=(r.top+r.bottom)/2,c=l.rotation,h=l.rotation,f=n.getDataset(),g=i&&s.animateRotate?0:t.hidden?0:n.calculateCircumference(f.data[a])*(l.circumference/(2*Math.PI)),p=i&&s.animateScale?0:n.innerRadius,m=i&&s.animateScale?0:n.outerRadius,b=e.getValueAtIndexOrDefault;e.extend(t,{_datasetIndex:n.index,_index:a,_model:{x:d+o.offsetX,y:u+o.offsetY,startAngle:c,endAngle:h,circumference:g,outerRadius:m,innerRadius:p,label:b(f.label,a,o.data.labels[a])}});var v=t._model;this.removeHoverStyle(t),i&&s.animateRotate||(0===a?v.startAngle=l.rotation:v.startAngle=n.getMeta().data[a-1]._model.endAngle,v.endAngle=v.startAngle+v.circumference),t.pivot()},removeHoverStyle:function(e){t.DatasetController.prototype.removeHoverStyle.call(this,e,this.chart.options.elements.arc)},calculateTotal:function(){var t,a=this.getDataset(),i=this.getMeta(),n=0;return e.each(i.data,function(e,i){t=a.data[i],isNaN(t)||e.hidden||(n+=Math.abs(t))}),n},calculateCircumference:function(t){var e=this.getMeta().total;return e>0&&!isNaN(t)?2*Math.PI*(t/e):0},getMaxBorderWidth:function(t){for(var e,a,i=0,n=this.index,o=t.length,r=0;o>r;r++)e=t[r]._model?t[r]._model.borderWidth:0,a=t[r]._chart?t[r]._chart.config.data.datasets[n].hoverBorderWidth:0,i=e>i?e:i,i=a>i?a:i;return i}})}},{}],18:[function(t,e,a){"use strict";e.exports=function(t){function e(t,e){return a.getValueOrDefault(t.showLine,e.showLines)}var a=t.helpers;t.defaults.line={showLines:!0,spanGaps:!1,hover:{mode:"label"},scales:{xAxes:[{type:"category",id:"x-axis-0"}],yAxes:[{type:"linear",id:"y-axis-0"}]}},t.controllers.line=t.DatasetController.extend({datasetElementType:t.elements.Line,dataElementType:t.elements.Point,addElementAndReset:function(a){var i=this,n=i.chart.options,o=i.getMeta();t.DatasetController.prototype.addElementAndReset.call(i,a),e(i.getDataset(),n)&&0!==o.dataset._model.tension&&i.updateBezierControlPoints()},update:function(t){var i,n,o,r=this,l=r.getMeta(),s=l.dataset,d=l.data||[],u=r.chart.options,c=u.elements.line,h=r.getScaleForId(l.yAxisID),f=r.getDataset(),g=e(f,u);for(g&&(o=s.custom||{},void 0!==f.tension&&void 0===f.lineTension&&(f.lineTension=f.tension),s._scale=h,s._datasetIndex=r.index,s._children=d,s._model={spanGaps:f.spanGaps?f.spanGaps:u.spanGaps,tension:o.tension?o.tension:a.getValueOrDefault(f.lineTension,c.tension),backgroundColor:o.backgroundColor?o.backgroundColor:f.backgroundColor||c.backgroundColor,borderWidth:o.borderWidth?o.borderWidth:f.borderWidth||c.borderWidth,borderColor:o.borderColor?o.borderColor:f.borderColor||c.borderColor,borderCapStyle:o.borderCapStyle?o.borderCapStyle:f.borderCapStyle||c.borderCapStyle,borderDash:o.borderDash?o.borderDash:f.borderDash||c.borderDash,borderDashOffset:o.borderDashOffset?o.borderDashOffset:f.borderDashOffset||c.borderDashOffset,borderJoinStyle:o.borderJoinStyle?o.borderJoinStyle:f.borderJoinStyle||c.borderJoinStyle,fill:o.fill?o.fill:void 0!==f.fill?f.fill:c.fill,steppedLine:o.steppedLine?o.steppedLine:a.getValueOrDefault(f.steppedLine,c.stepped),cubicInterpolationMode:o.cubicInterpolationMode?o.cubicInterpolationMode:a.getValueOrDefault(f.cubicInterpolationMode,c.cubicInterpolationMode),scaleTop:h.top,scaleBottom:h.bottom,scaleZero:h.getBasePixel()},s.pivot()),i=0,n=d.length;n>i;++i)r.updateElement(d[i],i,t);for(g&&0!==s._model.tension&&r.updateBezierControlPoints(),i=0,n=d.length;n>i;++i)d[i].pivot()},getPointBackgroundColor:function(t,e){var i=this.chart.options.elements.point.backgroundColor,n=this.getDataset(),o=t.custom||{};return o.backgroundColor?i=o.backgroundColor:n.pointBackgroundColor?i=a.getValueAtIndexOrDefault(n.pointBackgroundColor,e,i):n.backgroundColor&&(i=n.backgroundColor),i},getPointBorderColor:function(t,e){var i=this.chart.options.elements.point.borderColor,n=this.getDataset(),o=t.custom||{};return o.borderColor?i=o.borderColor:n.pointBorderColor?i=a.getValueAtIndexOrDefault(n.pointBorderColor,e,i):n.borderColor&&(i=n.borderColor),i},getPointBorderWidth:function(t,e){var i=this.chart.options.elements.point.borderWidth,n=this.getDataset(),o=t.custom||{};return o.borderWidth?i=o.borderWidth:n.pointBorderWidth?i=a.getValueAtIndexOrDefault(n.pointBorderWidth,e,i):n.borderWidth&&(i=n.borderWidth),i},updateElement:function(t,e,i){var n,o,r=this,l=r.getMeta(),s=t.custom||{},d=r.getDataset(),u=r.index,c=d.data[e],h=r.getScaleForId(l.yAxisID),f=r.getScaleForId(l.xAxisID),g=r.chart.options.elements.point,p=r.chart.data.labels||[],m=1===p.length||1===d.data.length||r.chart.isCombo;void 0!==d.radius&&void 0===d.pointRadius&&(d.pointRadius=d.radius),void 0!==d.hitRadius&&void 0===d.pointHitRadius&&(d.pointHitRadius=d.hitRadius),n=f.getPixelForValue("object"==typeof c?c:NaN,e,u,m),o=i?h.getBasePixel():r.calculatePointY(c,e,u),t._xScale=f,t._yScale=h,t._datasetIndex=u,t._index=e,t._model={x:n,y:o,skip:s.skip||isNaN(n)||isNaN(o),radius:s.radius||a.getValueAtIndexOrDefault(d.pointRadius,e,g.radius),pointStyle:s.pointStyle||a.getValueAtIndexOrDefault(d.pointStyle,e,g.pointStyle),backgroundColor:r.getPointBackgroundColor(t,e),borderColor:r.getPointBorderColor(t,e),borderWidth:r.getPointBorderWidth(t,e),tension:l.dataset._model?l.dataset._model.tension:0,steppedLine:l.dataset._model?l.dataset._model.steppedLine:!1,hitRadius:s.hitRadius||a.getValueAtIndexOrDefault(d.pointHitRadius,e,g.hitRadius)}},calculatePointY:function(t,e,a){var i,n,o,r=this,l=r.chart,s=r.getMeta(),d=r.getScaleForId(s.yAxisID),u=0,c=0;if(d.options.stacked){for(i=0;a>i;i++)if(n=l.data.datasets[i],o=l.getDatasetMeta(i),"line"===o.type&&o.yAxisID===d.id&&l.isDatasetVisible(i)){var h=Number(d.getRightValue(n.data[e]));0>h?c+=h||0:u+=h||0}var f=Number(d.getRightValue(t));return 0>f?d.getPixelForValue(c+f):d.getPixelForValue(u+f)}return d.getPixelForValue(t)},updateBezierControlPoints:function(){function t(t,e,a){return Math.max(Math.min(t,a),e)}var e,i,n,o,r,l=this,s=l.getMeta(),d=l.chart.chartArea,u=s.data||[];if(s.dataset._model.spanGaps&&(u=u.filter(function(t){return!t._model.skip})),"monotone"===s.dataset._model.cubicInterpolationMode)a.splineCurveMonotone(u);else for(e=0,i=u.length;i>e;++e)n=u[e],o=n._model,r=a.splineCurve(a.previousItem(u,e)._model,o,a.nextItem(u,e)._model,s.dataset._model.tension),o.controlPointPreviousX=r.previous.x,o.controlPointPreviousY=r.previous.y,o.controlPointNextX=r.next.x,o.controlPointNextY=r.next.y;if(l.chart.options.elements.line.capBezierPoints)for(e=0,i=u.length;i>e;++e)o=u[e]._model,o.controlPointPreviousX=t(o.controlPointPreviousX,d.left,d.right),o.controlPointPreviousY=t(o.controlPointPreviousY,d.top,d.bottom),o.controlPointNextX=t(o.controlPointNextX,d.left,d.right),o.controlPointNextY=t(o.controlPointNextY,d.top,d.bottom)},draw:function(t){var a,i,n=this,o=n.getMeta(),r=o.data||[],l=t||1;for(a=0,i=r.length;i>a;++a)r[a].transition(l);for(e(n.getDataset(),n.chart.options)&&o.dataset.transition(l).draw(),a=0,i=r.length;i>a;++a)r[a].draw()},setHoverStyle:function(t){var e=this.chart.data.datasets[t._datasetIndex],i=t._index,n=t.custom||{},o=t._model;o.radius=n.hoverRadius||a.getValueAtIndexOrDefault(e.pointHoverRadius,i,this.chart.options.elements.point.hoverRadius),o.backgroundColor=n.hoverBackgroundColor||a.getValueAtIndexOrDefault(e.pointHoverBackgroundColor,i,a.getHoverColor(o.backgroundColor)),o.borderColor=n.hoverBorderColor||a.getValueAtIndexOrDefault(e.pointHoverBorderColor,i,a.getHoverColor(o.borderColor)),o.borderWidth=n.hoverBorderWidth||a.getValueAtIndexOrDefault(e.pointHoverBorderWidth,i,o.borderWidth)},removeHoverStyle:function(t){var e=this,i=e.chart.data.datasets[t._datasetIndex],n=t._index,o=t.custom||{},r=t._model;void 0!==i.radius&&void 0===i.pointRadius&&(i.pointRadius=i.radius),r.radius=o.radius||a.getValueAtIndexOrDefault(i.pointRadius,n,e.chart.options.elements.point.radius),r.backgroundColor=e.getPointBackgroundColor(t,n),r.borderColor=e.getPointBorderColor(t,n),r.borderWidth=e.getPointBorderWidth(t,n)}})}},{}],19:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.polarArea={scale:{type:"radialLinear",lineArc:!0,ticks:{beginAtZero:!0}},animation:{animateRotate:!0,animateScale:!0},startAngle:-.5*Math.PI,aspectRatio:1,legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var a=t.data,i=a.datasets,n=a.labels;if(i.length)for(var o=0;o<i[0].data.length;++o)e.push('<li><span style="background-color:'+i[0].backgroundColor[o]+'">'),n[o]&&e.push(n[o]),e.push("</span></li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var a=t.data;return a.labels.length&&a.datasets.length?a.labels.map(function(i,n){var o=t.getDatasetMeta(0),r=a.datasets[0],l=o.data[n],s=l.custom||{},d=e.getValueAtIndexOrDefault,u=t.options.elements.arc,c=s.backgroundColor?s.backgroundColor:d(r.backgroundColor,n,u.backgroundColor),h=s.borderColor?s.borderColor:d(r.borderColor,n,u.borderColor),f=s.borderWidth?s.borderWidth:d(r.borderWidth,n,u.borderWidth);return{text:i,fillStyle:c,strokeStyle:h,lineWidth:f,hidden:isNaN(r.data[n])||o.data[n].hidden,index:n}}):[]}},onClick:function(t,e){var a,i,n,o=e.index,r=this.chart;for(a=0,i=(r.data.datasets||[]).length;i>a;++a)n=r.getDatasetMeta(a),n.data[o].hidden=!n.data[o].hidden;r.update()}},tooltips:{callbacks:{title:function(){return""},label:function(t,e){return e.labels[t.index]+": "+t.yLabel}}}},t.controllers.polarArea=t.DatasetController.extend({dataElementType:t.elements.Arc,linkScales:e.noop,update:function(t){var a=this,i=a.chart,n=i.chartArea,o=a.getMeta(),r=i.options,l=r.elements.arc,s=Math.min(n.right-n.left,n.bottom-n.top);i.outerRadius=Math.max((s-l.borderWidth/2)/2,0),i.innerRadius=Math.max(r.cutoutPercentage?i.outerRadius/100*r.cutoutPercentage:1,0),i.radiusLength=(i.outerRadius-i.innerRadius)/i.getVisibleDatasetCount(),a.outerRadius=i.outerRadius-i.radiusLength*a.index,a.innerRadius=a.outerRadius-i.radiusLength,o.count=a.countVisibleElements(),e.each(o.data,function(e,i){a.updateElement(e,i,t)})},updateElement:function(t,a,i){for(var n=this,o=n.chart,r=n.getDataset(),l=o.options,s=l.animation,d=o.scale,u=e.getValueAtIndexOrDefault,c=o.data.labels,h=n.calculateCircumference(r.data[a]),f=d.xCenter,g=d.yCenter,p=0,m=n.getMeta(),b=0;a>b;++b)isNaN(r.data[b])||m.data[b].hidden||++p;var v=l.startAngle,x=t.hidden?0:d.getDistanceFromCenterForValue(r.data[a]),y=v+h*p,k=y+(t.hidden?0:h),S=s.animateScale?0:d.getDistanceFromCenterForValue(r.data[a]);e.extend(t,{_datasetIndex:n.index,_index:a,_scale:d,_model:{x:f,y:g,innerRadius:0,outerRadius:i?S:x,startAngle:i&&s.animateRotate?v:y,endAngle:i&&s.animateRotate?v:k,label:u(c,a,c[a])}}),n.removeHoverStyle(t),t.pivot()},removeHoverStyle:function(e){t.DatasetController.prototype.removeHoverStyle.call(this,e,this.chart.options.elements.arc)},countVisibleElements:function(){var t=this.getDataset(),a=this.getMeta(),i=0;return e.each(a.data,function(e,a){isNaN(t.data[a])||e.hidden||i++}),i},calculateCircumference:function(t){var e=this.getMeta().count;return e>0&&!isNaN(t)?2*Math.PI/e:0}})}},{}],20:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.radar={scale:{type:"radialLinear"},elements:{line:{tension:0}}},t.controllers.radar=t.DatasetController.extend({datasetElementType:t.elements.Line,dataElementType:t.elements.Point,linkScales:e.noop,addElementAndReset:function(e){t.DatasetController.prototype.addElementAndReset.call(this,e),this.updateBezierControlPoints()},update:function(t){var a=this,i=a.getMeta(),n=i.dataset,o=i.data,r=n.custom||{},l=a.getDataset(),s=a.chart.options.elements.line,d=a.chart.scale;void 0!==l.tension&&void 0===l.lineTension&&(l.lineTension=l.tension),e.extend(i.dataset,{_datasetIndex:a.index,_children:o,_loop:!0,_model:{tension:r.tension?r.tension:e.getValueOrDefault(l.lineTension,s.tension),backgroundColor:r.backgroundColor?r.backgroundColor:l.backgroundColor||s.backgroundColor,borderWidth:r.borderWidth?r.borderWidth:l.borderWidth||s.borderWidth,borderColor:r.borderColor?r.borderColor:l.borderColor||s.borderColor,fill:r.fill?r.fill:void 0!==l.fill?l.fill:s.fill,borderCapStyle:r.borderCapStyle?r.borderCapStyle:l.borderCapStyle||s.borderCapStyle,borderDash:r.borderDash?r.borderDash:l.borderDash||s.borderDash,borderDashOffset:r.borderDashOffset?r.borderDashOffset:l.borderDashOffset||s.borderDashOffset,borderJoinStyle:r.borderJoinStyle?r.borderJoinStyle:l.borderJoinStyle||s.borderJoinStyle,scaleTop:d.top,scaleBottom:d.bottom,scaleZero:d.getBasePosition()}}),i.dataset.pivot(),e.each(o,function(e,i){a.updateElement(e,i,t)},a),a.updateBezierControlPoints()},updateElement:function(t,a,i){var n=this,o=t.custom||{},r=n.getDataset(),l=n.chart.scale,s=n.chart.options.elements.point,d=l.getPointPositionForValue(a,r.data[a]);e.extend(t,{_datasetIndex:n.index,_index:a,_scale:l,_model:{x:i?l.xCenter:d.x,y:i?l.yCenter:d.y,tension:o.tension?o.tension:e.getValueOrDefault(r.tension,n.chart.options.elements.line.tension),radius:o.radius?o.radius:e.getValueAtIndexOrDefault(r.pointRadius,a,s.radius),backgroundColor:o.backgroundColor?o.backgroundColor:e.getValueAtIndexOrDefault(r.pointBackgroundColor,a,s.backgroundColor),borderColor:o.borderColor?o.borderColor:e.getValueAtIndexOrDefault(r.pointBorderColor,a,s.borderColor),borderWidth:o.borderWidth?o.borderWidth:e.getValueAtIndexOrDefault(r.pointBorderWidth,a,s.borderWidth),pointStyle:o.pointStyle?o.pointStyle:e.getValueAtIndexOrDefault(r.pointStyle,a,s.pointStyle),hitRadius:o.hitRadius?o.hitRadius:e.getValueAtIndexOrDefault(r.hitRadius,a,s.hitRadius)}}),t._model.skip=o.skip?o.skip:isNaN(t._model.x)||isNaN(t._model.y)},updateBezierControlPoints:function(){var t=this.chart.chartArea,a=this.getMeta();e.each(a.data,function(i,n){var o=i._model,r=e.splineCurve(e.previousItem(a.data,n,!0)._model,o,e.nextItem(a.data,n,!0)._model,o.tension);o.controlPointPreviousX=Math.max(Math.min(r.previous.x,t.right),t.left),o.controlPointPreviousY=Math.max(Math.min(r.previous.y,t.bottom),t.top),o.controlPointNextX=Math.max(Math.min(r.next.x,t.right),t.left),o.controlPointNextY=Math.max(Math.min(r.next.y,t.bottom),t.top),i.pivot()})},draw:function(t){var a=this.getMeta(),i=t||1;e.each(a.data,function(t){t.transition(i)}),a.dataset.transition(i).draw(),e.each(a.data,function(t){t.draw()})},setHoverStyle:function(t){var a=this.chart.data.datasets[t._datasetIndex],i=t.custom||{},n=t._index,o=t._model;o.radius=i.hoverRadius?i.hoverRadius:e.getValueAtIndexOrDefault(a.pointHoverRadius,n,this.chart.options.elements.point.hoverRadius),o.backgroundColor=i.hoverBackgroundColor?i.hoverBackgroundColor:e.getValueAtIndexOrDefault(a.pointHoverBackgroundColor,n,e.getHoverColor(o.backgroundColor)),o.borderColor=i.hoverBorderColor?i.hoverBorderColor:e.getValueAtIndexOrDefault(a.pointHoverBorderColor,n,e.getHoverColor(o.borderColor)),o.borderWidth=i.hoverBorderWidth?i.hoverBorderWidth:e.getValueAtIndexOrDefault(a.pointHoverBorderWidth,n,o.borderWidth)},removeHoverStyle:function(t){var a=this.chart.data.datasets[t._datasetIndex],i=t.custom||{},n=t._index,o=t._model,r=this.chart.options.elements.point;o.radius=i.radius?i.radius:e.getValueAtIndexOrDefault(a.radius,n,r.radius),o.backgroundColor=i.backgroundColor?i.backgroundColor:e.getValueAtIndexOrDefault(a.pointBackgroundColor,n,r.backgroundColor),o.borderColor=i.borderColor?i.borderColor:e.getValueAtIndexOrDefault(a.pointBorderColor,n,r.borderColor),o.borderWidth=i.borderWidth?i.borderWidth:e.getValueAtIndexOrDefault(a.pointBorderWidth,n,r.borderWidth)}})}},{}],21:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.global.animation={duration:1e3,easing:"easeOutQuart",onProgress:e.noop,onComplete:e.noop},t.Animation=t.Element.extend({currentStep:null,numSteps:60,easing:"",render:null,onAnimationProgress:null,onAnimationComplete:null}),t.animationService={frameDuration:17,animations:[],dropFrames:0,request:null,addAnimation:function(t,e,a,i){var n=this;i||(t.animating=!0);for(var o=0;o<n.animations.length;++o)if(n.animations[o].chartInstance===t)return void(n.animations[o].animationObject=e);n.animations.push({chartInstance:t,animationObject:e}),1===n.animations.length&&n.requestAnimationFrame()},cancelAnimation:function(t){var a=e.findIndex(this.animations,function(e){return e.chartInstance===t});-1!==a&&(this.animations.splice(a,1),t.animating=!1)},requestAnimationFrame:function(){var t=this;null===t.request&&(t.request=e.requestAnimFrame.call(window,function(){t.request=null,t.startDigest()}))},startDigest:function(){var t=this,e=Date.now(),a=0;t.dropFrames>1&&(a=Math.floor(t.dropFrames),t.dropFrames=t.dropFrames%1);for(var i=0;i<t.animations.length;)null===t.animations[i].animationObject.currentStep&&(t.animations[i].animationObject.currentStep=0),t.animations[i].animationObject.currentStep+=1+a,t.animations[i].animationObject.currentStep>t.animations[i].animationObject.numSteps&&(t.animations[i].animationObject.currentStep=t.animations[i].animationObject.numSteps),t.animations[i].animationObject.render(t.animations[i].chartInstance,t.animations[i].animationObject),t.animations[i].animationObject.onAnimationProgress&&t.animations[i].animationObject.onAnimationProgress.call&&t.animations[i].animationObject.onAnimationProgress.call(t.animations[i].chartInstance,t.animations[i]),t.animations[i].animationObject.currentStep===t.animations[i].animationObject.numSteps?(t.animations[i].animationObject.onAnimationComplete&&t.animations[i].animationObject.onAnimationComplete.call&&t.animations[i].animationObject.onAnimationComplete.call(t.animations[i].chartInstance,t.animations[i]),t.animations[i].chartInstance.animating=!1,t.animations.splice(i,1)):++i;var n=Date.now(),o=(n-e)/t.frameDuration;t.dropFrames+=o,t.animations.length>0&&t.requestAnimationFrame()}}}},{}],22:[function(t,e,a){"use strict";e.exports=function(t){var e=t.canvasHelpers={};e.drawPoint=function(t,e,a,i,n){var o,r,l,s,d,u;if("object"==typeof e&&(o=e.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return void t.drawImage(e,i-e.width/2,n-e.height/2);if(!(isNaN(a)||0>=a)){switch(e){default:t.beginPath(),t.arc(i,n,a,0,2*Math.PI),t.closePath(),t.fill();break;case"triangle":t.beginPath(),r=3*a/Math.sqrt(3),d=r*Math.sqrt(3)/2,t.moveTo(i-r/2,n+d/3),t.lineTo(i+r/2,n+d/3),t.lineTo(i,n-2*d/3),t.closePath(),t.fill();break;case"rect":u=1/Math.SQRT2*a,t.beginPath(),t.fillRect(i-u,n-u,2*u,2*u),t.strokeRect(i-u,n-u,2*u,2*u);break;case"rectRot":u=1/Math.SQRT2*a,t.beginPath(),t.moveTo(i-u,n),t.lineTo(i,n+u),t.lineTo(i+u,n),t.lineTo(i,n-u),t.closePath(),t.fill();break;case"cross":t.beginPath(),t.moveTo(i,n+a),t.lineTo(i,n-a),t.moveTo(i-a,n),t.lineTo(i+a,n),t.closePath();break;case"crossRot":t.beginPath(),l=Math.cos(Math.PI/4)*a,s=Math.sin(Math.PI/4)*a,t.moveTo(i-l,n-s),t.lineTo(i+l,n+s),t.moveTo(i-l,n+s),t.lineTo(i+l,n-s),t.closePath();break;case"star":t.beginPath(),t.moveTo(i,n+a),t.lineTo(i,n-a),t.moveTo(i-a,n),t.lineTo(i+a,n),l=Math.cos(Math.PI/4)*a,s=Math.sin(Math.PI/4)*a,t.moveTo(i-l,n-s),t.lineTo(i+l,n+s),t.moveTo(i-l,n+s),t.lineTo(i+l,n-s),t.closePath();break;case"line":t.beginPath(),t.moveTo(i-a,n),t.lineTo(i+a,n),t.closePath();break;case"dash":t.beginPath(),t.moveTo(i,n),t.lineTo(i+a,n),t.closePath()}t.stroke()}}}},{}],23:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.types={},t.instances={},t.controllers={},t.Controller=function(a){return this.chart=a,this.config=a.config,this.options=this.config.options=e.configMerge(t.defaults.global,t.defaults[this.config.type],this.config.options||{}),this.id=e.uid(),Object.defineProperty(this,"data",{get:function(){return this.config.data}}),t.instances[this.id]=this,this.options.responsive&&this.resize(!0),this.initialize(),this},e.extend(t.Controller.prototype,{initialize:function(){var e=this;return t.plugins.notify("beforeInit",[e]),e.bindEvents(),e.ensureScalesHaveIDs(),e.buildOrUpdateControllers(),e.buildScales(),e.updateLayout(),e.resetElements(),e.initToolTip(),e.update(),t.plugins.notify("afterInit",[e]),e},clear:function(){return e.clear(this.chart),this},stop:function(){return t.animationService.cancelAnimation(this),this},resize:function(a){var i=this,n=i.chart,o=n.canvas,r=e.getMaximumWidth(o),l=n.aspectRatio,s=i.options.maintainAspectRatio&&isNaN(l)===!1&&isFinite(l)&&0!==l?r/l:e.getMaximumHeight(o),d=n.width!==r||n.height!==s;if(!d)return i;o.width=n.width=r,o.height=n.height=s,e.retinaScale(n);var u={width:r,height:s};return t.plugins.notify("resize",[i,u]),i.options.onResize&&i.options.onResize(i,u),a||(i.stop(),i.update(i.options.responsiveAnimationDuration)),i},ensureScalesHaveIDs:function(){var t=this.options,a=t.scales||{},i=t.scale;e.each(a.xAxes,function(t,e){t.id=t.id||"x-axis-"+e}),e.each(a.yAxes,function(t,e){t.id=t.id||"y-axis-"+e}),i&&(i.id=i.id||"scale")},buildScales:function(){var a=this,i=a.options,n=a.scales={},o=[];i.scales&&(o=o.concat((i.scales.xAxes||[]).map(function(t){return{options:t,dtype:"category"}}),(i.scales.yAxes||[]).map(function(t){return{options:t,dtype:"linear"}}))),i.scale&&o.push({options:i.scale,dtype:"radialLinear",isDefault:!0}),e.each(o,function(i){var o=i.options,r=e.getValueOrDefault(o.type,i.dtype),l=t.scaleService.getScaleConstructor(r);if(l){var s=new l({id:o.id,options:o,ctx:a.chart.ctx,chart:a});n[s.id]=s,i.isDefault&&(a.scale=s)}}),t.scaleService.addScalesToLayout(this)},updateLayout:function(){t.layoutService.update(this,this.chart.width,this.chart.height)},buildOrUpdateControllers:function(){var a=this,i=[],n=[];if(e.each(a.data.datasets,function(e,o){var r=a.getDatasetMeta(o);r.type||(r.type=e.type||a.config.type),i.push(r.type),r.controller?r.controller.updateIndex(o):(r.controller=new t.controllers[r.type](a,o),n.push(r.controller))},a),i.length>1)for(var o=1;o<i.length;o++)if(i[o]!==i[o-1]){a.isCombo=!0;break}return n},resetElements:function(){var t=this;e.each(t.data.datasets,function(e,a){t.getDatasetMeta(a).controller.reset()},t)},update:function(a,i){var n=this;t.plugins.notify("beforeUpdate",[n]),n.tooltip._data=n.data;var o=n.buildOrUpdateControllers();e.each(n.data.datasets,function(t,e){n.getDatasetMeta(e).controller.buildOrUpdateElements()},n),t.layoutService.update(n,n.chart.width,n.chart.height),t.plugins.notify("afterScaleUpdate",[n]),e.each(o,function(t){t.reset()}),n.updateDatasets(),t.plugins.notify("afterUpdate",[n]),n.render(a,i)},updateDatasets:function(){var e,a,i=this;if(t.plugins.notify("beforeDatasetsUpdate",[i])){for(e=0,a=i.data.datasets.length;a>e;++e)i.getDatasetMeta(e).controller.update();t.plugins.notify("afterDatasetsUpdate",[i])}},render:function(a,i){var n=this;t.plugins.notify("beforeRender",[n]);var o=n.options.animation;if(o&&("undefined"!=typeof a&&0!==a||"undefined"==typeof a&&0!==o.duration)){var r=new t.Animation;r.numSteps=(a||o.duration)/16.66,r.easing=o.easing,r.render=function(t,a){var i=e.easingEffects[a.easing],n=a.currentStep/a.numSteps,o=i(n);t.draw(o,n,a.currentStep)},r.onAnimationProgress=o.onProgress,r.onAnimationComplete=o.onComplete,t.animationService.addAnimation(n,r,a,i)}else n.draw(),o&&o.onComplete&&o.onComplete.call&&o.onComplete.call(n);return n},draw:function(a){var i=this,n=a||1;i.clear(),t.plugins.notify("beforeDraw",[i,n]),e.each(i.boxes,function(t){t.draw(i.chartArea)},i),i.scale&&i.scale.draw(),t.plugins.notify("beforeDatasetsDraw",[i,n]),e.each(i.data.datasets,function(t,e){i.isDatasetVisible(e)&&i.getDatasetMeta(e).controller.draw(a)},i,!0),t.plugins.notify("afterDatasetsDraw",[i,n]),i.tooltip.transition(n).draw(),t.plugins.notify("afterDraw",[i,n])},getElementAtEvent:function(t){var a=this,i=e.getRelativePosition(t,a.chart),n=[];return e.each(a.data.datasets,function(t,o){if(a.isDatasetVisible(o)){var r=a.getDatasetMeta(o);e.each(r.data,function(t){return t.inRange(i.x,i.y)?(n.push(t),n):void 0})}}),n.slice(0,1)},getElementsAtEvent:function(t){var a=this,i=e.getRelativePosition(t,a.chart),n=[],o=function(){if(a.data.datasets)for(var t=0;t<a.data.datasets.length;t++){var e=a.getDatasetMeta(t);if(a.isDatasetVisible(t))for(var n=0;n<e.data.length;n++)if(e.data[n].inRange(i.x,i.y))return e.data[n]}}.call(a);return o?(e.each(a.data.datasets,function(t,e){if(a.isDatasetVisible(e)){var i=a.getDatasetMeta(e),r=i.data[o._index];r&&!r._view.skip&&n.push(r)}},a),n):n},getElementsAtXAxis:function(t){var a=this,i=e.getRelativePosition(t,a.chart),n=[],o=function(){if(a.data.datasets)for(var t=0;t<a.data.datasets.length;t++){var e=a.getDatasetMeta(t);if(a.isDatasetVisible(t))for(var n=0;n<e.data.length;n++)if(e.data[n].inLabelRange(i.x,i.y))return e.data[n]}}.call(a);return o?(e.each(a.data.datasets,function(t,i){if(a.isDatasetVisible(i)){var r=a.getDatasetMeta(i),l=e.findIndex(r.data,function(t){return o._model.x===t._model.x});-1===l||r.data[l]._view.skip||n.push(r.data[l])}},a),n):n},getElementsAtEventForMode:function(t,e){var a=this;switch(e){case"single":return a.getElementAtEvent(t);case"label":return a.getElementsAtEvent(t);case"dataset":return a.getDatasetAtEvent(t);case"x-axis":return a.getElementsAtXAxis(t);default:return t}},getDatasetAtEvent:function(t){var e=this.getElementAtEvent(t);return e.length>0&&(e=this.getDatasetMeta(e[0]._datasetIndex).data),e},getDatasetMeta:function(t){var e=this,a=e.data.datasets[t];a._meta||(a._meta={});var i=a._meta[e.id];return i||(i=a._meta[e.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}),i},getVisibleDatasetCount:function(){for(var t=0,e=0,a=this.data.datasets.length;a>e;++e)this.isDatasetVisible(e)&&t++;return t},isDatasetVisible:function(t){var e=this.getDatasetMeta(t);return"boolean"==typeof e.hidden?!e.hidden:!this.data.datasets[t].hidden},generateLegend:function(){return this.options.legendCallback(this)},destroy:function(){var a=this;a.stop(),a.clear(),e.unbindEvents(a,a.events),e.removeResizeListener(a.chart.canvas.parentNode);var i=a.chart.canvas;i.width=a.chart.width,i.height=a.chart.height,void 0!==a.chart.originalDevicePixelRatio&&a.chart.ctx.scale(1/a.chart.originalDevicePixelRatio,1/a.chart.originalDevicePixelRatio),i.style.width=a.chart.originalCanvasStyleWidth,i.style.height=a.chart.originalCanvasStyleHeight,t.plugins.notify("destroy",[a]),delete t.instances[a.id]},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)},initToolTip:function(){var e=this;e.tooltip=new t.Tooltip({_chart:e.chart,_chartInstance:e,_data:e.data,_options:e.options.tooltips},e)},bindEvents:function(){var t=this;e.bindEvents(t,t.options.events,function(e){t.eventHandler(e)})},updateHoverStyle:function(t,e,a){var i,n,o,r=a?"setHoverStyle":"removeHoverStyle";switch(e){case"single":t=[t[0]];break;case"label":case"dataset":case"x-axis":break;default:return}for(n=0,o=t.length;o>n;++n)i=t[n],i&&this.getDatasetMeta(i._datasetIndex).controller[r](i)},eventHandler:function(t){var a=this,i=a.tooltip,n=a.options||{},o=n.hover,r=n.tooltips;return a.lastActive=a.lastActive||[],a.lastTooltipActive=a.lastTooltipActive||[],"mouseout"===t.type?(a.active=[],a.tooltipActive=[]):(a.active=a.getElementsAtEventForMode(t,o.mode),a.tooltipActive=a.getElementsAtEventForMode(t,r.mode)),o.onHover&&o.onHover.call(a,a.active),a.legend&&a.legend.handleEvent&&a.legend.handleEvent(t),("mouseup"===t.type||"click"===t.type)&&n.onClick&&n.onClick.call(a,t,a.active),a.lastActive.length&&a.updateHoverStyle(a.lastActive,o.mode,!1),a.active.length&&o.mode&&a.updateHoverStyle(a.active,o.mode,!0),(r.enabled||r.custom)&&(i.initialize(),i._active=a.tooltipActive,i.update(!0)),i.pivot(),a.animating||e.arrayEquals(a.active,a.lastActive)&&e.arrayEquals(a.tooltipActive,a.lastTooltipActive)||(a.stop(),(r.enabled||r.custom)&&i.update(!0),a.render(o.animationDuration,!0)),a.lastActive=a.active,a.lastTooltipActive=a.tooltipActive,a}})}},{}],24:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=e.noop;t.DatasetController=function(t,e){this.initialize(t,e)},e.extend(t.DatasetController.prototype,{datasetElementType:null,dataElementType:null,initialize:function(t,e){var a=this;a.chart=t,a.index=e,a.linkScales(),a.addElements()},updateIndex:function(t){this.index=t},linkScales:function(){var t=this,e=t.getMeta(),a=t.getDataset();null===e.xAxisID&&(e.xAxisID=a.xAxisID||t.chart.options.scales.xAxes[0].id),null===e.yAxisID&&(e.yAxisID=a.yAxisID||t.chart.options.scales.yAxes[0].id)},getDataset:function(){return this.chart.data.datasets[this.index]},getMeta:function(){return this.chart.getDatasetMeta(this.index)},getScaleForId:function(t){return this.chart.scales[t]},reset:function(){this.update(!0)},createMetaDataset:function(){var t=this,e=t.datasetElementType;return e&&new e({_chart:t.chart.chart,_datasetIndex:t.index})},createMetaData:function(t){var e=this,a=e.dataElementType;return a&&new a({_chart:e.chart.chart,_datasetIndex:e.index,_index:t})},addElements:function(){var t,e,a=this,i=a.getMeta(),n=a.getDataset().data||[],o=i.data;for(t=0,e=n.length;e>t;++t)o[t]=o[t]||a.createMetaData(i,t);i.dataset=i.dataset||a.createMetaDataset()},addElementAndReset:function(t){var e=this,a=e.createMetaData(t);e.getMeta().data.splice(t,0,a),e.updateElement(a,t,!0)},buildOrUpdateElements:function(){var t=this.getMeta(),e=t.data,a=this.getDataset().data.length,i=e.length;if(i>a)e.splice(a,i-a);else if(a>i)for(var n=i;a>n;++n)this.addElementAndReset(n)},update:a,draw:function(t){var a=t||1;e.each(this.getMeta().data,function(t){t.transition(a).draw()})},removeHoverStyle:function(t,a){var i=this.chart.data.datasets[t._datasetIndex],n=t._index,o=t.custom||{},r=e.getValueAtIndexOrDefault,l=t._model;l.backgroundColor=o.backgroundColor?o.backgroundColor:r(i.backgroundColor,n,a.backgroundColor),l.borderColor=o.borderColor?o.borderColor:r(i.borderColor,n,a.borderColor),l.borderWidth=o.borderWidth?o.borderWidth:r(i.borderWidth,n,a.borderWidth)},setHoverStyle:function(t){var a=this.chart.data.datasets[t._datasetIndex],i=t._index,n=t.custom||{},o=e.getValueAtIndexOrDefault,r=e.getHoverColor,l=t._model;l.backgroundColor=n.hoverBackgroundColor?n.hoverBackgroundColor:o(a.hoverBackgroundColor,i,r(l.backgroundColor)),l.borderColor=n.hoverBorderColor?n.hoverBorderColor:o(a.hoverBorderColor,i,r(l.borderColor)),l.borderWidth=n.hoverBorderWidth?n.hoverBorderWidth:o(a.hoverBorderWidth,i,l.borderWidth)}}),t.DatasetController.extend=e.inherits}},{}],25:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.elements={},t.Element=function(t){e.extend(this,t),this.initialize.apply(this,arguments)},e.extend(t.Element.prototype,{initialize:function(){this.hidden=!1},pivot:function(){var t=this;return t._view||(t._view=e.clone(t._model)),t._start=e.clone(t._view),t},transition:function(t){var a=this;return a._view||(a._view=e.clone(a._model)),1===t?(a._view=a._model,a._start=null,
a):(a._start||a.pivot(),e.each(a._model,function(i,n){if("_"===n[0]);else if(a._view.hasOwnProperty(n))if(i===a._view[n]);else if("string"==typeof i)try{var o=e.color(a._model[n]).mix(e.color(a._start[n]),t);a._view[n]=o.rgbString()}catch(r){a._view[n]=i}else if("number"==typeof i){var l=void 0!==a._start[n]&&isNaN(a._start[n])===!1?a._start[n]:0;a._view[n]=(a._model[n]-l)*t+l}else a._view[n]=i;else"number"!=typeof i||isNaN(a._view[n])?a._view[n]=i:a._view[n]=i*t},a),a)},tooltipPosition:function(){return{x:this._model.x,y:this._model.y}},hasValue:function(){return e.isNumber(this._model.x)&&e.isNumber(this._model.y)}}),t.Element.extend=e.inherits}},{}],26:[function(t,e,a){"use strict";var i=t(3);e.exports=function(t){function e(t,e,a){var i;return"string"==typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[a])):i=t,i}function a(t){return void 0!==t&&null!==t&&"none"!==t}function n(t,i,n){var o=document.defaultView,r=t.parentNode,l=o.getComputedStyle(t)[i],s=o.getComputedStyle(r)[i],d=a(l),u=a(s),c=Number.POSITIVE_INFINITY;return d||u?Math.min(d?e(l,t,n):c,u?e(s,r,n):c):"none"}var o=t.helpers={};o.each=function(t,e,a,i){var n,r;if(o.isArray(t))if(r=t.length,i)for(n=r-1;n>=0;n--)e.call(a,t[n],n);else for(n=0;r>n;n++)e.call(a,t[n],n);else if("object"==typeof t){var l=Object.keys(t);for(r=l.length,n=0;r>n;n++)e.call(a,t[l[n]],l[n])}},o.clone=function(t){var e={};return o.each(t,function(t,a){o.isArray(t)?e[a]=t.slice(0):"object"==typeof t&&null!==t?e[a]=o.clone(t):e[a]=t}),e},o.extend=function(t){for(var e=function(e,a){t[a]=e},a=1,i=arguments.length;i>a;a++)o.each(arguments[a],e);return t},o.configMerge=function(e){var a=o.clone(e);return o.each(Array.prototype.slice.call(arguments,1),function(e){o.each(e,function(e,i){if("scales"===i)a[i]=o.scaleMerge(a.hasOwnProperty(i)?a[i]:{},e);else if("scale"===i)a[i]=o.configMerge(a.hasOwnProperty(i)?a[i]:{},t.scaleService.getScaleDefaults(e.type),e);else if(a.hasOwnProperty(i)&&o.isArray(a[i])&&o.isArray(e)){var n=a[i];o.each(e,function(t,e){e<n.length?"object"==typeof n[e]&&null!==n[e]&&"object"==typeof t&&null!==t?n[e]=o.configMerge(n[e],t):n[e]=t:n.push(t)})}else a.hasOwnProperty(i)&&"object"==typeof a[i]&&null!==a[i]&&"object"==typeof e?a[i]=o.configMerge(a[i],e):a[i]=e})}),a},o.scaleMerge=function(e,a){var i=o.clone(e);return o.each(a,function(e,a){"xAxes"===a||"yAxes"===a?i.hasOwnProperty(a)?o.each(e,function(e,n){var r=o.getValueOrDefault(e.type,"xAxes"===a?"category":"linear"),l=t.scaleService.getScaleDefaults(r);n>=i[a].length||!i[a][n].type?i[a].push(o.configMerge(l,e)):e.type&&e.type!==i[a][n].type?i[a][n]=o.configMerge(i[a][n],l,e):i[a][n]=o.configMerge(i[a][n],e)}):(i[a]=[],o.each(e,function(e){var n=o.getValueOrDefault(e.type,"xAxes"===a?"category":"linear");i[a].push(o.configMerge(t.scaleService.getScaleDefaults(n),e))})):i.hasOwnProperty(a)&&"object"==typeof i[a]&&null!==i[a]&&"object"==typeof e?i[a]=o.configMerge(i[a],e):i[a]=e}),i},o.getValueAtIndexOrDefault=function(t,e,a){return void 0===t||null===t?a:o.isArray(t)?e<t.length?t[e]:a:t},o.getValueOrDefault=function(t,e){return void 0===t?e:t},o.indexOf=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var a=0,i=t.length;i>a;++a)if(t[a]===e)return a;return-1},o.where=function(t,e){if(o.isArray(t)&&Array.prototype.filter)return t.filter(e);var a=[];return o.each(t,function(t){e(t)&&a.push(t)}),a},o.findIndex=Array.prototype.findIndex?function(t,e,a){return t.findIndex(e,a)}:function(t,e,a){a=void 0===a?t:a;for(var i=0,n=t.length;n>i;++i)if(e.call(a,t[i],i,t))return i;return-1},o.findNextWhere=function(t,e,a){(void 0===a||null===a)&&(a=-1);for(var i=a+1;i<t.length;i++){var n=t[i];if(e(n))return n}},o.findPreviousWhere=function(t,e,a){(void 0===a||null===a)&&(a=t.length);for(var i=a-1;i>=0;i--){var n=t[i];if(e(n))return n}},o.inherits=function(t){var e=this,a=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return e.apply(this,arguments)},i=function(){this.constructor=a};return i.prototype=e.prototype,a.prototype=new i,a.extend=o.inherits,t&&o.extend(a.prototype,t),a.__super__=e.prototype,a},o.noop=function(){},o.uid=function(){var t=0;return function(){return t++}}(),o.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},o.almostEquals=function(t,e,a){return Math.abs(t-e)<a},o.max=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.max(t,e)},Number.NEGATIVE_INFINITY)},o.min=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.min(t,e)},Number.POSITIVE_INFINITY)},o.sign=Math.sign?function(t){return Math.sign(t)}:function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},o.log10=Math.log10?function(t){return Math.log10(t)}:function(t){return Math.log(t)/Math.LN10},o.toRadians=function(t){return t*(Math.PI/180)},o.toDegrees=function(t){return t*(180/Math.PI)},o.getAngleFromPoint=function(t,e){var a=e.x-t.x,i=e.y-t.y,n=Math.sqrt(a*a+i*i),o=Math.atan2(i,a);return o<-.5*Math.PI&&(o+=2*Math.PI),{angle:o,distance:n}},o.aliasPixel=function(t){return t%2===0?0:.5},o.splineCurve=function(t,e,a,i){var n=t.skip?e:t,o=e,r=a.skip?e:a,l=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),s=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),d=l/(l+s),u=s/(l+s);d=isNaN(d)?0:d,u=isNaN(u)?0:u;var c=i*d,h=i*u;return{previous:{x:o.x-c*(r.x-n.x),y:o.y-c*(r.y-n.y)},next:{x:o.x+h*(r.x-n.x),y:o.y+h*(r.y-n.y)}}},o.EPSILON=Number.EPSILON||1e-14,o.splineCurveMonotone=function(t){var e,a,i,n,r=(t||[]).map(function(t){return{model:t._model,deltaK:0,mK:0}}),l=r.length;for(e=0;l>e;++e)i=r[e],i.model.skip||(a=e>0?r[e-1]:null,n=l-1>e?r[e+1]:null,n&&!n.model.skip&&(i.deltaK=(n.model.y-i.model.y)/(n.model.x-i.model.x)),!a||a.model.skip?i.mK=i.deltaK:!n||n.model.skip?i.mK=a.deltaK:this.sign(a.deltaK)!==this.sign(i.deltaK)?i.mK=0:i.mK=(a.deltaK+i.deltaK)/2);var s,d,u,c;for(e=0;l-1>e;++e)i=r[e],n=r[e+1],i.model.skip||n.model.skip||(o.almostEquals(i.deltaK,0,this.EPSILON)?i.mK=n.mK=0:(s=i.mK/i.deltaK,d=n.mK/i.deltaK,c=Math.pow(s,2)+Math.pow(d,2),9>=c||(u=3/Math.sqrt(c),i.mK=s*u*i.deltaK,n.mK=d*u*i.deltaK)));var h;for(e=0;l>e;++e)i=r[e],i.model.skip||(a=e>0?r[e-1]:null,n=l-1>e?r[e+1]:null,a&&!a.model.skip&&(h=(i.model.x-a.model.x)/3,i.model.controlPointPreviousX=i.model.x-h,i.model.controlPointPreviousY=i.model.y-h*i.mK),n&&!n.model.skip&&(h=(n.model.x-i.model.x)/3,i.model.controlPointNextX=i.model.x+h,i.model.controlPointNextY=i.model.y+h*i.mK))},o.nextItem=function(t,e,a){return a?e>=t.length-1?t[0]:t[e+1]:e>=t.length-1?t[t.length-1]:t[e+1]},o.previousItem=function(t,e,a){return a?0>=e?t[t.length-1]:t[e-1]:0>=e?t[0]:t[e-1]},o.niceNum=function(t,e){var a,i=Math.floor(o.log10(t)),n=t/Math.pow(10,i);return a=e?1.5>n?1:3>n?2:7>n?5:10:1>=n?1:2>=n?2:5>=n?5:10,a*Math.pow(10,i)};var r=o.easingEffects={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-1*t*(t-2)},easeInOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1*((t=t/1-1)*t*t+1)},easeInOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-1*((t=t/1-1)*t*t*t-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},easeInQuint:function(t){return 1*(t/=1)*t*t*t*t},easeOutQuint:function(t){return 1*((t=t/1-1)*t*t*t*t+1)},easeInOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return-1*Math.cos(t/1*(Math.PI/2))+1},easeOutSine:function(t){return 1*Math.sin(t/1*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t/1)-1)},easeInExpo:function(t){return 0===t?1:1*Math.pow(2,10*(t/1-1))},easeOutExpo:function(t){return 1===t?1:1*(-Math.pow(2,-10*t/1)+1)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){return t>=1?t:-1*(Math.sqrt(1-(t/=1)*t)-1)},easeOutCirc:function(t){return 1*Math.sqrt(1-(t=t/1-1)*t)},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){var e=1.70158,a=0,i=1;return 0===t?0:1===(t/=1)?1:(a||(a=.3),i<Math.abs(1)?(i=1,e=a/4):e=a/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/a)))},easeOutElastic:function(t){var e=1.70158,a=0,i=1;return 0===t?0:1===(t/=1)?1:(a||(a=.3),i<Math.abs(1)?(i=1,e=a/4):e=a/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*t)*Math.sin((1*t-e)*(2*Math.PI)/a)+1)},easeInOutElastic:function(t){var e=1.70158,a=0,i=1;return 0===t?0:2===(t/=.5)?1:(a||(a=1*(.3*1.5)),i<Math.abs(1)?(i=1,e=a/4):e=a/(2*Math.PI)*Math.asin(1/i),1>t?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/a)):i*Math.pow(2,-10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/a)*.5+1)},easeInBack:function(t){var e=1.70158;return 1*(t/=1)*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return 1*((t=t/1-1)*t*((e+1)*t+e)+1)},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:function(t){return 1-r.easeOutBounce(1-t)},easeOutBounce:function(t){return(t/=1)<1/2.75?1*(7.5625*t*t):2/2.75>t?1*(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1*(7.5625*(t-=2.25/2.75)*t+.9375):1*(7.5625*(t-=2.625/2.75)*t+.984375)},easeInOutBounce:function(t){return.5>t?.5*r.easeInBounce(2*t):.5*r.easeOutBounce(2*t-1)+.5}};o.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),o.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){return window.clearTimeout(t,1e3/60)}}(),o.getRelativePosition=function(t,e){var a,i,n=t.originalEvent||t,r=t.currentTarget||t.srcElement,l=r.getBoundingClientRect(),s=n.touches;s&&s.length>0?(a=s[0].clientX,i=s[0].clientY):(a=n.clientX,i=n.clientY);var d=parseFloat(o.getStyle(r,"padding-left")),u=parseFloat(o.getStyle(r,"padding-top")),c=parseFloat(o.getStyle(r,"padding-right")),h=parseFloat(o.getStyle(r,"padding-bottom")),f=l.right-l.left-d-c,g=l.bottom-l.top-u-h;return a=Math.round((a-l.left-d)/f*r.width/e.currentDevicePixelRatio),i=Math.round((i-l.top-u)/g*r.height/e.currentDevicePixelRatio),{x:a,y:i}},o.addEvent=function(t,e,a){t.addEventListener?t.addEventListener(e,a):t.attachEvent?t.attachEvent("on"+e,a):t["on"+e]=a},o.removeEvent=function(t,e,a){t.removeEventListener?t.removeEventListener(e,a,!1):t.detachEvent?t.detachEvent("on"+e,a):t["on"+e]=o.noop},o.bindEvents=function(t,e,a){var i=t.events=t.events||{};o.each(e,function(e){i[e]=function(){a.apply(t,arguments)},o.addEvent(t.chart.canvas,e,i[e])})},o.unbindEvents=function(t,e){var a=t.chart.canvas;o.each(e,function(t,e){o.removeEvent(a,e,t)})},o.getConstraintWidth=function(t){return n(t,"max-width","clientWidth")},o.getConstraintHeight=function(t){return n(t,"max-height","clientHeight")},o.getMaximumWidth=function(t){var e=t.parentNode,a=parseInt(o.getStyle(e,"padding-left"),10),i=parseInt(o.getStyle(e,"padding-right"),10),n=e.clientWidth-a-i,r=o.getConstraintWidth(t);return isNaN(r)?n:Math.min(n,r)},o.getMaximumHeight=function(t){var e=t.parentNode,a=parseInt(o.getStyle(e,"padding-top"),10),i=parseInt(o.getStyle(e,"padding-bottom"),10),n=e.clientHeight-a-i,r=o.getConstraintHeight(t);return isNaN(r)?n:Math.min(n,r)},o.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,null).getPropertyValue(e)},o.retinaScale=function(t){var e=t.ctx,a=t.canvas,i=a.width,n=a.height,o=t.currentDevicePixelRatio=window.devicePixelRatio||1;1!==o&&(a.height=n*o,a.width=i*o,e.scale(o,o),t.originalDevicePixelRatio=t.originalDevicePixelRatio||o),a.style.width=i+"px",a.style.height=n+"px"},o.clear=function(t){t.ctx.clearRect(0,0,t.width,t.height)},o.fontString=function(t,e,a){return e+" "+t+"px "+a},o.longestText=function(t,e,a,i){i=i||{};var n=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(n=i.data={},r=i.garbageCollect=[],i.font=e),t.font=e;var l=0;o.each(a,function(e){void 0!==e&&null!==e&&o.isArray(e)!==!0?l=o.measureText(t,n,r,l,e):o.isArray(e)&&o.each(e,function(e){void 0===e||null===e||o.isArray(e)||(l=o.measureText(t,n,r,l,e))})});var s=r.length/2;if(s>a.length){for(var d=0;s>d;d++)delete n[r[d]];r.splice(0,s)}return l},o.measureText=function(t,e,a,i,n){var o=e[n];return o||(o=e[n]=t.measureText(n).width,a.push(n)),o>i&&(i=o),i},o.numberOfLabelLines=function(t){var e=1;return o.each(t,function(t){o.isArray(t)&&t.length>e&&(e=t.length)}),e},o.drawRoundedRectangle=function(t,e,a,i,n,o){t.beginPath(),t.moveTo(e+o,a),t.lineTo(e+i-o,a),t.quadraticCurveTo(e+i,a,e+i,a+o),t.lineTo(e+i,a+n-o),t.quadraticCurveTo(e+i,a+n,e+i-o,a+n),t.lineTo(e+o,a+n),t.quadraticCurveTo(e,a+n,e,a+n-o),t.lineTo(e,a+o),t.quadraticCurveTo(e,a,e+o,a),t.closePath()},o.color=function(e){return i?i(e instanceof CanvasGradient?t.defaults.global.defaultColor:e):(console.error("Color.js not found!"),e)},o.addResizeListener=function(t,e){var a=document.createElement("iframe"),i="chartjs-hidden-iframe";a.classlist?a.classlist.add(i):a.setAttribute("class",i),a.tabIndex=-1;var n=a.style;n.width="100%",n.display="block",n.border=0,n.height=0,n.margin=0,n.position="absolute",n.left=0,n.right=0,n.top=0,n.bottom=0,t.insertBefore(a,t.firstChild),(a.contentWindow||a).onresize=function(){return e?e():void 0}},o.removeResizeListener=function(t){var e=t.querySelector(".chartjs-hidden-iframe");e&&e.parentNode.removeChild(e)},o.isArray=Array.isArray?function(t){return Array.isArray(t)}:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o.arrayEquals=function(t,e){var a,i,n,r;if(!t||!e||t.length!==e.length)return!1;for(a=0,i=t.length;i>a;++a)if(n=t[a],r=e[a],n instanceof Array&&r instanceof Array){if(!o.arrayEquals(n,r))return!1}else if(n!==r)return!1;return!0},o.callCallback=function(t,e,a){t&&"function"==typeof t.call&&t.apply(a,e)},o.getHoverColor=function(t){return t instanceof CanvasPattern?t:o.color(t).saturate(.5).darken(.1).rgbString()}}},{3:3}],27:[function(t,e,a){"use strict";e.exports=function(){var t=function(e,a){var i=this,n=t.helpers;return i.config=a||{data:{datasets:[]}},e.length&&e[0].getContext&&(e=e[0]),e.getContext&&(e=e.getContext("2d")),i.ctx=e,i.canvas=e.canvas,e.canvas.style.display=e.canvas.style.display||"block",i.width=e.canvas.width||parseInt(n.getStyle(e.canvas,"width"),10)||n.getMaximumWidth(e.canvas),i.height=e.canvas.height||parseInt(n.getStyle(e.canvas,"height"),10)||n.getMaximumHeight(e.canvas),i.aspectRatio=i.width/i.height,(isNaN(i.aspectRatio)||isFinite(i.aspectRatio)===!1)&&(i.aspectRatio=void 0!==a.aspectRatio?a.aspectRatio:2),i.originalCanvasStyleWidth=e.canvas.style.width,i.originalCanvasStyleHeight=e.canvas.style.height,n.retinaScale(i),i.controller=new t.Controller(i),n.addResizeListener(e.canvas.parentNode,function(){i.controller&&i.controller.config.options.responsive&&i.controller.resize()}),i.controller?i.controller:i};return t.defaults={global:{responsive:!0,responsiveAnimationDuration:0,maintainAspectRatio:!0,events:["mousemove","mouseout","click","touchstart","touchmove"],hover:{onHover:null,mode:"single",animationDuration:400},onClick:null,defaultColor:"rgba(0,0,0,0.1)",defaultFontColor:"#666",defaultFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",defaultFontSize:12,defaultFontStyle:"normal",showLines:!0,elements:{},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');for(var a=0;a<t.data.datasets.length;a++)e.push('<li><span style="background-color:'+t.data.datasets[a].backgroundColor+'"></span>'),t.data.datasets[a].label&&e.push(t.data.datasets[a].label),e.push("</li>");return e.push("</ul>"),e.join("")}}},t.Chart=t,t}},{}],28:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.layoutService={defaults:{},addBox:function(t,e){t.boxes||(t.boxes=[]),t.boxes.push(e)},removeBox:function(t,e){t.boxes&&t.boxes.splice(t.boxes.indexOf(e),1)},update:function(t,a,i){function n(t){var e,a=t.isHorizontal();a?(e=t.update(t.options.fullWidth?p:k,y),S-=e.height):(e=t.update(x,v),k-=e.width),w.push({horizontal:a,minSize:e,box:t})}function o(t){var a=e.findNextWhere(w,function(e){return e.box===t});if(a)if(t.isHorizontal()){var i={left:C,right:M,top:0,bottom:0};t.update(t.options.fullWidth?p:k,m/2,i)}else t.update(a.minSize.width,S)}function r(t){var a=e.findNextWhere(w,function(e){return e.box===t}),i={left:0,right:0,top:D,bottom:I};a&&t.update(a.minSize.width,S,i)}function l(t){t.isHorizontal()?(t.left=t.options.fullWidth?s:C,t.right=t.options.fullWidth?a-s:C+k,t.top=F,t.bottom=F+t.height,F=t.bottom):(t.left=P,t.right=P+t.width,t.top=D,t.bottom=D+S,P=t.right)}if(t){var s=0,d=0,u=e.where(t.boxes,function(t){return"left"===t.options.position}),c=e.where(t.boxes,function(t){return"right"===t.options.position}),h=e.where(t.boxes,function(t){return"top"===t.options.position}),f=e.where(t.boxes,function(t){return"bottom"===t.options.position}),g=e.where(t.boxes,function(t){return"chartArea"===t.options.position});h.sort(function(t,e){return(e.options.fullWidth?1:0)-(t.options.fullWidth?1:0)}),f.sort(function(t,e){return(t.options.fullWidth?1:0)-(e.options.fullWidth?1:0)});var p=a-2*s,m=i-2*d,b=p/2,v=m/2,x=(a-b)/(u.length+c.length),y=(i-v)/(h.length+f.length),k=p,S=m,w=[];e.each(u.concat(c,h,f),n);var C=s,M=s,D=d,I=d;e.each(u.concat(c),o),e.each(u,function(t){C+=t.width}),e.each(c,function(t){M+=t.width}),e.each(h.concat(f),o),e.each(h,function(t){D+=t.height}),e.each(f,function(t){I+=t.height}),e.each(u.concat(c),r),C=s,M=s,D=d,I=d,e.each(u,function(t){C+=t.width}),e.each(c,function(t){M+=t.width}),e.each(h,function(t){D+=t.height}),e.each(f,function(t){I+=t.height});var A=i-D-I,T=a-C-M;(T!==k||A!==S)&&(e.each(u,function(t){t.height=A}),e.each(c,function(t){t.height=A}),e.each(h,function(t){t.options.fullWidth||(t.width=T)}),e.each(f,function(t){t.options.fullWidth||(t.width=T)}),S=A,k=T);var P=s,F=d;e.each(u.concat(h),l),P+=k,F+=S,e.each(c,l),e.each(f,l),t.chartArea={left:C,top:D,right:C+k,bottom:D+S},e.each(g,function(e){e.left=t.chartArea.left,e.top=t.chartArea.top,e.right=t.chartArea.right,e.bottom=t.chartArea.bottom,e.update(k,S)})}}}}},{}],29:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=e.noop;t.defaults.global.legend={display:!0,position:"top",fullWidth:!0,reverse:!1,onClick:function(t,e){var a=e.datasetIndex,i=this.chart,n=i.getDatasetMeta(a);n.hidden=null===n.hidden?!i.data.datasets[a].hidden:null,i.update()},onHover:null,labels:{boxWidth:40,padding:10,generateLabels:function(t){var a=t.data;return e.isArray(a.datasets)?a.datasets.map(function(a,i){return{text:a.label,fillStyle:e.isArray(a.backgroundColor)?a.backgroundColor[0]:a.backgroundColor,hidden:!t.isDatasetVisible(i),lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:a.borderWidth,strokeStyle:a.borderColor,pointStyle:a.pointStyle,datasetIndex:i}},this):[]}}},t.Legend=t.Element.extend({initialize:function(t){e.extend(this,t),this.legendHitBoxes=[],this.doughnutMode=!1},beforeUpdate:a,update:function(t,e,a){var i=this;return i.beforeUpdate(),i.maxWidth=t,i.maxHeight=e,i.margins=a,i.beforeSetDimensions(),i.setDimensions(),i.afterSetDimensions(),i.beforeBuildLabels(),i.buildLabels(),i.afterBuildLabels(),i.beforeFit(),i.fit(),i.afterFit(),i.afterUpdate(),i.minSize},afterUpdate:a,beforeSetDimensions:a,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:a,beforeBuildLabels:a,buildLabels:function(){var t=this;t.legendItems=t.options.labels.generateLabels.call(t,t.chart),t.options.reverse&&t.legendItems.reverse()},afterBuildLabels:a,beforeFit:a,fit:function(){var a=this,i=a.options,n=i.labels,o=i.display,r=a.ctx,l=t.defaults.global,s=e.getValueOrDefault,d=s(n.fontSize,l.defaultFontSize),u=s(n.fontStyle,l.defaultFontStyle),c=s(n.fontFamily,l.defaultFontFamily),h=e.fontString(d,u,c),f=a.legendHitBoxes=[],g=a.minSize,p=a.isHorizontal();if(p?(g.width=a.maxWidth,g.height=o?10:0):(g.width=o?10:0,g.height=a.maxHeight),o)if(r.font=h,p){var m=a.lineWidths=[0],b=a.legendItems.length?d+n.padding:0;r.textAlign="left",r.textBaseline="top",e.each(a.legendItems,function(t,e){var i=n.usePointStyle?d*Math.sqrt(2):n.boxWidth,o=i+d/2+r.measureText(t.text).width;m[m.length-1]+o+n.padding>=a.width&&(b+=d+n.padding,m[m.length]=a.left),f[e]={left:0,top:0,width:o,height:d},m[m.length-1]+=o+n.padding}),g.height+=b}else{var v=n.padding,x=a.columnWidths=[],y=n.padding,k=0,S=0,w=d+v;e.each(a.legendItems,function(t,e){var a=n.usePointStyle?2*n.boxWidth:n.boxWidth,i=a+d/2+r.measureText(t.text).width;S+w>g.height&&(y+=k+n.padding,x.push(k),k=0,S=0),k=Math.max(k,i),S+=w,f[e]={left:0,top:0,width:i,height:d}}),y+=k,x.push(k),g.width+=y}a.width=g.width,a.height=g.height},afterFit:a,isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},draw:function(){var a=this,i=a.options,n=i.labels,o=t.defaults.global,r=o.elements.line,l=a.width,s=a.lineWidths;if(i.display){var d,u=a.ctx,c=e.getValueOrDefault,h=c(n.fontColor,o.defaultFontColor),f=c(n.fontSize,o.defaultFontSize),g=c(n.fontStyle,o.defaultFontStyle),p=c(n.fontFamily,o.defaultFontFamily),m=e.fontString(f,g,p);u.textAlign="left",u.textBaseline="top",u.lineWidth=.5,u.strokeStyle=h,u.fillStyle=h,u.font=m;var b=n.boxWidth,v=a.legendHitBoxes,x=function(e,a,n){if(!(isNaN(b)||0>=b)){u.save(),u.fillStyle=c(n.fillStyle,o.defaultColor),u.lineCap=c(n.lineCap,r.borderCapStyle),u.lineDashOffset=c(n.lineDashOffset,r.borderDashOffset),u.lineJoin=c(n.lineJoin,r.borderJoinStyle),u.lineWidth=c(n.lineWidth,r.borderWidth),u.strokeStyle=c(n.strokeStyle,o.defaultColor);var l=0===c(n.lineWidth,r.borderWidth);if(u.setLineDash&&u.setLineDash(c(n.lineDash,r.borderDash)),i.labels&&i.labels.usePointStyle){var s=f*Math.SQRT2/2,d=s/Math.SQRT2,h=e+d,g=a+d;t.canvasHelpers.drawPoint(u,n.pointStyle,s,h,g)}else l||u.strokeRect(e,a,b,f),u.fillRect(e,a,b,f);u.restore()}},y=function(t,e,a,i){u.fillText(a.text,b+f/2+t,e),a.hidden&&(u.beginPath(),u.lineWidth=2,u.moveTo(b+f/2+t,e+f/2),u.lineTo(b+f/2+t+i,e+f/2),u.stroke())},k=a.isHorizontal();d=k?{x:a.left+(l-s[0])/2,y:a.top+n.padding,line:0}:{x:a.left+n.padding,y:a.top+n.padding,line:0};var S=f+n.padding;e.each(a.legendItems,function(t,e){var i=u.measureText(t.text).width,o=n.usePointStyle?f+f/2+i:b+f/2+i,r=d.x,c=d.y;k?r+o>=l&&(c=d.y+=S,d.line++,r=d.x=a.left+(l-s[d.line])/2):c+S>a.bottom&&(r=d.x=r+a.columnWidths[d.line]+n.padding,c=d.y=a.top,d.line++),x(r,c,t),v[e].left=r,v[e].top=c,y(r,c,t,i),k?d.x+=o+n.padding:d.y+=S})}},handleEvent:function(t){var a=this,i=a.options,n="mouseup"===t.type?"click":t.type;if("mousemove"===n){if(!i.onHover)return}else{if("click"!==n)return;if(!i.onClick)return}var o=e.getRelativePosition(t,a.chart.chart),r=o.x,l=o.y;if(r>=a.left&&r<=a.right&&l>=a.top&&l<=a.bottom)for(var s=a.legendHitBoxes,d=0;d<s.length;++d){var u=s[d];if(r>=u.left&&r<=u.left+u.width&&l>=u.top&&l<=u.top+u.height){if("click"===n){i.onClick.call(a,t,a.legendItems[d]);break}if("mousemove"===n){i.onHover.call(a,t,a.legendItems[d]);break}}}}}),t.plugins.register({beforeInit:function(e){var a=e.options,i=a.legend;i&&(e.legend=new t.Legend({ctx:e.chart.ctx,options:i,chart:e}),t.layoutService.addBox(e,e.legend))}})}},{}],30:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers.noop;t.plugins={_plugins:[],register:function(t){var e=this._plugins;[].concat(t).forEach(function(t){-1===e.indexOf(t)&&e.push(t)})},unregister:function(t){var e=this._plugins;[].concat(t).forEach(function(t){var a=e.indexOf(t);-1!==a&&e.splice(a,1)})},clear:function(){this._plugins=[]},count:function(){return this._plugins.length},getAll:function(){return this._plugins},notify:function(t,e){var a,i,n=this._plugins,o=n.length;for(a=0;o>a;++a)if(i=n[a],"function"==typeof i[t]&&i[t].apply(i,e||[])===!1)return!1;return!0}},t.PluginBase=t.Element.extend({beforeInit:e,afterInit:e,beforeUpdate:e,afterUpdate:e,beforeDraw:e,afterDraw:e,destroy:e}),t.pluginService=t.plugins}},{}],31:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.scale={display:!0,position:"left",gridLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",offsetGridLines:!1,borderDash:[],borderDashOffset:0},scaleLabel:{labelString:"",display:!1},ticks:{beginAtZero:!1,minRotation:0,maxRotation:50,mirror:!1,padding:10,reverse:!1,display:!0,autoSkip:!0,autoSkipPadding:0,labelOffset:0,callback:function(t){return e.isArray(t)?t:""+t}}},t.Scale=t.Element.extend({beforeUpdate:function(){e.callCallback(this.options.beforeUpdate,[this])},update:function(t,a,i){var n=this;return n.beforeUpdate(),n.maxWidth=t,n.maxHeight=a,n.margins=e.extend({left:0,right:0,top:0,bottom:0},i),n.beforeSetDimensions(),n.setDimensions(),n.afterSetDimensions(),n.beforeDataLimits(),n.determineDataLimits(),n.afterDataLimits(),n.beforeBuildTicks(),n.buildTicks(),n.afterBuildTicks(),n.beforeTickToLabelConversion(),n.convertTicksToLabels(),n.afterTickToLabelConversion(),n.beforeCalculateTickRotation(),n.calculateTickRotation(),n.afterCalculateTickRotation(),n.beforeFit(),n.fit(),n.afterFit(),n.afterUpdate(),n.minSize},afterUpdate:function(){e.callCallback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){e.callCallback(this.options.beforeSetDimensions,[this])},setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0},afterSetDimensions:function(){e.callCallback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){e.callCallback(this.options.beforeDataLimits,[this])},determineDataLimits:e.noop,afterDataLimits:function(){e.callCallback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){e.callCallback(this.options.beforeBuildTicks,[this])},buildTicks:e.noop,afterBuildTicks:function(){e.callCallback(this.options.afterBuildTicks,[this])},beforeTickToLabelConversion:function(){e.callCallback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){var t=this;t.ticks=t.ticks.map(function(e,a,i){return t.options.ticks.userCallback?t.options.ticks.userCallback(e,a,i):t.options.ticks.callback(e,a,i)},t)},afterTickToLabelConversion:function(){e.callCallback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){e.callCallback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var a=this,i=a.ctx,n=t.defaults.global,o=a.options.ticks,r=e.getValueOrDefault(o.fontSize,n.defaultFontSize),l=e.getValueOrDefault(o.fontStyle,n.defaultFontStyle),s=e.getValueOrDefault(o.fontFamily,n.defaultFontFamily),d=e.fontString(r,l,s);i.font=d;var u,c=i.measureText(a.ticks[0]).width,h=i.measureText(a.ticks[a.ticks.length-1]).width;if(a.labelRotation=o.minRotation||0,a.paddingRight=0,a.paddingLeft=0,a.options.display&&a.isHorizontal()){a.paddingRight=h/2+3,a.paddingLeft=c/2+3,a.longestTextCache||(a.longestTextCache={});for(var f,g,p=e.longestText(i,d,a.ticks,a.longestTextCache),m=p,b=a.getPixelForTick(1)-a.getPixelForTick(0)-6;m>b&&a.labelRotation<o.maxRotation;){if(f=Math.cos(e.toRadians(a.labelRotation)),g=Math.sin(e.toRadians(a.labelRotation)),u=f*c,u+r/2>a.yLabelWidth&&(a.paddingLeft=u+r/2),a.paddingRight=r/2,g*p>a.maxHeight){a.labelRotation--;break}a.labelRotation++,m=f*p}}a.margins&&(a.paddingLeft=Math.max(a.paddingLeft-a.margins.left,0),a.paddingRight=Math.max(a.paddingRight-a.margins.right,0))},afterCalculateTickRotation:function(){e.callCallback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){e.callCallback(this.options.beforeFit,[this])},fit:function(){var a=this,i=a.minSize={width:0,height:0},n=a.options,o=t.defaults.global,r=n.ticks,l=n.scaleLabel,s=n.gridLines,d=n.display,u=a.isHorizontal(),c=e.getValueOrDefault(r.fontSize,o.defaultFontSize),h=e.getValueOrDefault(r.fontStyle,o.defaultFontStyle),f=e.getValueOrDefault(r.fontFamily,o.defaultFontFamily),g=e.fontString(c,h,f),p=e.getValueOrDefault(l.fontSize,o.defaultFontSize),m=n.gridLines.tickMarkLength;if(u?i.width=a.isFullWidth()?a.maxWidth-a.margins.left-a.margins.right:a.maxWidth:i.width=d&&s.drawTicks?m:0,u?i.height=d&&s.drawTicks?m:0:i.height=a.maxHeight,l.display&&d&&(u?i.height+=1.5*p:i.width+=1.5*p),r.display&&d){a.longestTextCache||(a.longestTextCache={});var b=e.longestText(a.ctx,g,a.ticks,a.longestTextCache),v=e.numberOfLabelLines(a.ticks),x=.5*c;if(u){a.longestLabelWidth=b;var y=Math.sin(e.toRadians(a.labelRotation))*a.longestLabelWidth+c*v+x*v;i.height=Math.min(a.maxHeight,i.height+y),a.ctx.font=g;var k=a.ctx.measureText(a.ticks[0]).width,S=a.ctx.measureText(a.ticks[a.ticks.length-1]).width,w=Math.cos(e.toRadians(a.labelRotation)),C=Math.sin(e.toRadians(a.labelRotation));a.paddingLeft=0!==a.labelRotation?w*k+3:k/2+3,a.paddingRight=0!==a.labelRotation?C*(c/2)+3:S/2+3}else{var M=a.maxWidth-i.width,D=r.mirror;D?b=0:b+=a.options.ticks.padding,M>b?i.width+=b:i.width=a.maxWidth,a.paddingTop=c/2,a.paddingBottom=c/2}}a.margins&&(a.paddingLeft=Math.max(a.paddingLeft-a.margins.left,0),a.paddingTop=Math.max(a.paddingTop-a.margins.top,0),a.paddingRight=Math.max(a.paddingRight-a.margins.right,0),a.paddingBottom=Math.max(a.paddingBottom-a.margins.bottom,0)),a.width=i.width,a.height=i.height},afterFit:function(){e.callCallback(this.options.afterFit,[this])},isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},isFullWidth:function(){return this.options.fullWidth},getRightValue:function(t){return null===t||"undefined"==typeof t?NaN:"number"==typeof t&&isNaN(t)?NaN:"object"==typeof t?t instanceof Date||t.isValid?t:this.getRightValue(this.isHorizontal()?t.x:t.y):t},getLabelForIndex:e.noop,getPixelForValue:e.noop,getValueForPixel:e.noop,getPixelForTick:function(t,e){var a=this;if(a.isHorizontal()){var i=a.width-(a.paddingLeft+a.paddingRight),n=i/Math.max(a.ticks.length-(a.options.gridLines.offsetGridLines?0:1),1),o=n*t+a.paddingLeft;e&&(o+=n/2);var r=a.left+Math.round(o);return r+=a.isFullWidth()?a.margins.left:0}var l=a.height-(a.paddingTop+a.paddingBottom);return a.top+t*(l/(a.ticks.length-1))},getPixelForDecimal:function(t){var e=this;if(e.isHorizontal()){var a=e.width-(e.paddingLeft+e.paddingRight),i=a*t+e.paddingLeft,n=e.left+Math.round(i);return n+=e.isFullWidth()?e.margins.left:0}return e.top+t*e.height},getBasePixel:function(){var t=this,e=t.min,a=t.max;return t.getPixelForValue(t.beginAtZero?0:0>e&&0>a?a:e>0&&a>0?e:0)},draw:function(a){var i=this,n=i.options;if(n.display){var o,r,l=i.ctx,s=t.defaults.global,d=n.ticks,u=n.gridLines,c=n.scaleLabel,h=0!==i.labelRotation,f=d.autoSkip,g=i.isHorizontal();d.maxTicksLimit&&(r=d.maxTicksLimit);var p=e.getValueOrDefault(d.fontColor,s.defaultFontColor),m=e.getValueOrDefault(d.fontSize,s.defaultFontSize),b=e.getValueOrDefault(d.fontStyle,s.defaultFontStyle),v=e.getValueOrDefault(d.fontFamily,s.defaultFontFamily),x=e.fontString(m,b,v),y=u.tickMarkLength,k=e.getValueOrDefault(u.borderDash,s.borderDash),S=e.getValueOrDefault(u.borderDashOffset,s.borderDashOffset),w=e.getValueOrDefault(c.fontColor,s.defaultFontColor),C=e.getValueOrDefault(c.fontSize,s.defaultFontSize),M=e.getValueOrDefault(c.fontStyle,s.defaultFontStyle),D=e.getValueOrDefault(c.fontFamily,s.defaultFontFamily),I=e.fontString(C,M,D),A=e.toRadians(i.labelRotation),T=Math.cos(A),P=i.longestLabelWidth*T;l.fillStyle=p;
var F=[];if(g){if(o=!1,h&&(P/=2),(P+d.autoSkipPadding)*i.ticks.length>i.width-(i.paddingLeft+i.paddingRight)&&(o=1+Math.floor((P+d.autoSkipPadding)*i.ticks.length/(i.width-(i.paddingLeft+i.paddingRight)))),r&&i.ticks.length>r)for(;!o||i.ticks.length/(o||1)>r;)o||(o=1),o+=1;f||(o=!1)}var R="right"===n.position?i.left:i.right-y,_="right"===n.position?i.left+y:i.right,V="bottom"===n.position?i.top:i.bottom-y,L="bottom"===n.position?i.top+y:i.bottom;if(e.each(i.ticks,function(t,r){if(void 0!==t&&null!==t){var l=i.ticks.length===r+1,s=o>1&&r%o>0||r%o===0&&r+o>=i.ticks.length;if((!s||l)&&void 0!==t&&null!==t){var c,f;r===("undefined"!=typeof i.zeroLineIndex?i.zeroLineIndex:0)?(c=u.zeroLineWidth,f=u.zeroLineColor):(c=e.getValueAtIndexOrDefault(u.lineWidth,r),f=e.getValueAtIndexOrDefault(u.color,r));var p,m,b,v,x,w,C,M,D,I,T="middle",P="middle";if(g){h||(P="top"===n.position?"bottom":"top"),T=h?"right":"center";var O=i.getPixelForTick(r)+e.aliasPixel(c);D=i.getPixelForTick(r,u.offsetGridLines)+d.labelOffset,I=h?i.top+12:"top"===n.position?i.bottom-y:i.top+y,p=b=x=C=O,m=V,v=L,w=a.top,M=a.bottom}else{"left"===n.position?d.mirror?(D=i.right+d.padding,T="left"):(D=i.right-d.padding,T="right"):d.mirror?(D=i.left-d.padding,T="right"):(D=i.left+d.padding,T="left");var B=i.getPixelForTick(r);B+=e.aliasPixel(c),I=i.getPixelForTick(r,u.offsetGridLines),p=R,b=_,x=a.left,C=a.right,m=v=w=M=B}F.push({tx1:p,ty1:m,tx2:b,ty2:v,x1:x,y1:w,x2:C,y2:M,labelX:D,labelY:I,glWidth:c,glColor:f,glBorderDash:k,glBorderDashOffset:S,rotation:-1*A,label:t,textBaseline:P,textAlign:T})}}}),e.each(F,function(t){if(u.display&&(l.save(),l.lineWidth=t.glWidth,l.strokeStyle=t.glColor,l.setLineDash&&(l.setLineDash(t.glBorderDash),l.lineDashOffset=t.glBorderDashOffset),l.beginPath(),u.drawTicks&&(l.moveTo(t.tx1,t.ty1),l.lineTo(t.tx2,t.ty2)),u.drawOnChartArea&&(l.moveTo(t.x1,t.y1),l.lineTo(t.x2,t.y2)),l.stroke(),l.restore()),d.display){l.save(),l.translate(t.labelX,t.labelY),l.rotate(t.rotation),l.font=x,l.textBaseline=t.textBaseline,l.textAlign=t.textAlign;var a=t.label;if(e.isArray(a))for(var i=0,n=-(a.length-1)*m*.75;i<a.length;++i)l.fillText(""+a[i],0,n),n+=1.5*m;else l.fillText(a,0,0);l.restore()}}),c.display){var O,B,W=0;if(g)O=i.left+(i.right-i.left)/2,B="bottom"===n.position?i.bottom-C/2:i.top+C/2;else{var z="left"===n.position;O=z?i.left+C/2:i.right-C/2,B=i.top+(i.bottom-i.top)/2,W=z?-.5*Math.PI:.5*Math.PI}l.save(),l.translate(O,B),l.rotate(W),l.textAlign="center",l.textBaseline="middle",l.fillStyle=w,l.font=I,l.fillText(c.labelString,0,0),l.restore()}if(u.drawBorder){l.lineWidth=e.getValueAtIndexOrDefault(u.lineWidth,0),l.strokeStyle=e.getValueAtIndexOrDefault(u.color,0);var N=i.left,H=i.right,E=i.top,U=i.bottom,q=e.aliasPixel(l.lineWidth);g?(E=U="top"===n.position?i.bottom:i.top,E+=q,U+=q):(N=H="left"===n.position?i.right:i.left,N+=q,H+=q),l.beginPath(),l.moveTo(N,E),l.lineTo(H,U),l.stroke()}}}})}},{}],32:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.scaleService={constructors:{},defaults:{},registerScaleType:function(t,a,i){this.constructors[t]=a,this.defaults[t]=e.clone(i)},getScaleConstructor:function(t){return this.constructors.hasOwnProperty(t)?this.constructors[t]:void 0},getScaleDefaults:function(a){return this.defaults.hasOwnProperty(a)?e.scaleMerge(t.defaults.scale,this.defaults[a]):{}},updateScaleDefaults:function(t,a){var i=this.defaults;i.hasOwnProperty(t)&&(i[t]=e.extend(i[t],a))},addScalesToLayout:function(a){e.each(a.scales,function(e){t.layoutService.addBox(a,e)})}}}},{}],33:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.global.title={display:!1,position:"top",fullWidth:!0,fontStyle:"bold",padding:10,text:""};var a=e.noop;t.Title=t.Element.extend({initialize:function(a){var i=this;e.extend(i,a),i.options=e.configMerge(t.defaults.global.title,a.options),i.legendHitBoxes=[]},beforeUpdate:function(){var a=this.chart.options;a&&a.title&&(this.options=e.configMerge(t.defaults.global.title,a.title))},update:function(t,e,a){var i=this;return i.beforeUpdate(),i.maxWidth=t,i.maxHeight=e,i.margins=a,i.beforeSetDimensions(),i.setDimensions(),i.afterSetDimensions(),i.beforeBuildLabels(),i.buildLabels(),i.afterBuildLabels(),i.beforeFit(),i.fit(),i.afterFit(),i.afterUpdate(),i.minSize},afterUpdate:a,beforeSetDimensions:a,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:a,beforeBuildLabels:a,buildLabels:a,afterBuildLabels:a,beforeFit:a,fit:function(){var a=this,i=e.getValueOrDefault,n=a.options,o=t.defaults.global,r=n.display,l=i(n.fontSize,o.defaultFontSize),s=a.minSize;a.isHorizontal()?(s.width=a.maxWidth,s.height=r?l+2*n.padding:0):(s.width=r?l+2*n.padding:0,s.height=a.maxHeight),a.width=s.width,a.height=s.height},afterFit:a,isHorizontal:function(){var t=this.options.position;return"top"===t||"bottom"===t},draw:function(){var a=this,i=a.ctx,n=e.getValueOrDefault,o=a.options,r=t.defaults.global;if(o.display){var l,s,d=n(o.fontSize,r.defaultFontSize),u=n(o.fontStyle,r.defaultFontStyle),c=n(o.fontFamily,r.defaultFontFamily),h=e.fontString(d,u,c),f=0,g=a.top,p=a.left,m=a.bottom,b=a.right;i.fillStyle=n(o.fontColor,r.defaultFontColor),i.font=h,a.isHorizontal()?(l=p+(b-p)/2,s=g+(m-g)/2):(l="left"===o.position?p+d/2:b-d/2,s=g+(m-g)/2,f=Math.PI*("left"===o.position?-.5:.5)),i.save(),i.translate(l,s),i.rotate(f),i.textAlign="center",i.textBaseline="middle",i.fillText(o.text,0,0),i.restore()}}}),t.plugins.register({beforeInit:function(e){var a=e.options,i=a.title;i&&(e.titleBlock=new t.Title({ctx:e.chart.ctx,options:i,chart:e}),t.layoutService.addBox(e,e.titleBlock))}})}},{}],34:[function(t,e,a){"use strict";e.exports=function(t){function e(t,e){return e&&(n.isArray(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function a(t){if(!t.length)return!1;var e,a,i=[],n=[];for(e=0,a=t.length;a>e;++e){var o=t[e];if(o&&o.hasValue()){var r=o.tooltipPosition();i.push(r.x),n.push(r.y)}}var l=0,s=0;for(e=0;e<i.length;++e)i[e]&&(l+=i[e],s+=n[e]);return{x:Math.round(l/i.length),y:Math.round(s/i.length)}}function i(t){var e=t._xScale,a=t._yScale||t._scale,i=t._index,n=t._datasetIndex;return{xLabel:e?e.getLabelForIndex(i,n):"",yLabel:a?a.getLabelForIndex(i,n):"",index:i,datasetIndex:n}}var n=t.helpers;t.defaults.global.tooltips={enabled:!0,custom:null,mode:"single",backgroundColor:"rgba(0,0,0,0.8)",titleFontStyle:"bold",titleSpacing:2,titleMarginBottom:6,titleFontColor:"#fff",titleAlign:"left",bodySpacing:2,bodyFontColor:"#fff",bodyAlign:"left",footerFontStyle:"bold",footerSpacing:2,footerMarginTop:6,footerFontColor:"#fff",footerAlign:"left",yPadding:6,xPadding:6,yAlign:"center",xAlign:"center",caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",callbacks:{beforeTitle:n.noop,title:function(t,e){var a="",i=e.labels,n=i?i.length:0;if(t.length>0){var o=t[0];o.xLabel?a=o.xLabel:n>0&&o.index<n&&(a=i[o.index])}return a},afterTitle:n.noop,beforeBody:n.noop,beforeLabel:n.noop,label:function(t,e){var a=e.datasets[t.datasetIndex].label||"";return a+": "+t.yLabel},labelColor:function(t,e){var a=e.getDatasetMeta(t.datasetIndex),i=a.data[t.index],n=i._view;return{borderColor:n.borderColor,backgroundColor:n.backgroundColor}},afterLabel:n.noop,afterBody:n.noop,beforeFooter:n.noop,footer:n.noop,afterFooter:n.noop}},t.Tooltip=t.Element.extend({initialize:function(){var e=this,a=t.defaults.global,i=e._options,o=n.getValueOrDefault;n.extend(e,{_model:{xPadding:i.xPadding,yPadding:i.yPadding,xAlign:i.xAlign,yAlign:i.yAlign,bodyFontColor:i.bodyFontColor,_bodyFontFamily:o(i.bodyFontFamily,a.defaultFontFamily),_bodyFontStyle:o(i.bodyFontStyle,a.defaultFontStyle),_bodyAlign:i.bodyAlign,bodyFontSize:o(i.bodyFontSize,a.defaultFontSize),bodySpacing:i.bodySpacing,titleFontColor:i.titleFontColor,_titleFontFamily:o(i.titleFontFamily,a.defaultFontFamily),_titleFontStyle:o(i.titleFontStyle,a.defaultFontStyle),titleFontSize:o(i.titleFontSize,a.defaultFontSize),_titleAlign:i.titleAlign,titleSpacing:i.titleSpacing,titleMarginBottom:i.titleMarginBottom,footerFontColor:i.footerFontColor,_footerFontFamily:o(i.footerFontFamily,a.defaultFontFamily),_footerFontStyle:o(i.footerFontStyle,a.defaultFontStyle),footerFontSize:o(i.footerFontSize,a.defaultFontSize),_footerAlign:i.footerAlign,footerSpacing:i.footerSpacing,footerMarginTop:i.footerMarginTop,caretSize:i.caretSize,cornerRadius:i.cornerRadius,backgroundColor:i.backgroundColor,opacity:0,legendColorBackground:i.multiKeyBackground}})},getTitle:function(){var t=this,a=t._options,i=a.callbacks,n=i.beforeTitle.apply(t,arguments),o=i.title.apply(t,arguments),r=i.afterTitle.apply(t,arguments),l=[];return l=e(l,n),l=e(l,o),l=e(l,r)},getBeforeBody:function(){var t=this._options.callbacks.beforeBody.apply(this,arguments);return n.isArray(t)?t:void 0!==t?[t]:[]},getBody:function(t,a){var i=this,o=i._options.callbacks,r=[];return n.each(t,function(t){var n={before:[],lines:[],after:[]};e(n.before,o.beforeLabel.call(i,t,a)),e(n.lines,o.label.call(i,t,a)),e(n.after,o.afterLabel.call(i,t,a)),r.push(n)}),r},getAfterBody:function(){var t=this._options.callbacks.afterBody.apply(this,arguments);return n.isArray(t)?t:void 0!==t?[t]:[]},getFooter:function(){var t=this,a=t._options.callbacks,i=a.beforeFooter.apply(t,arguments),n=a.footer.apply(t,arguments),o=a.afterFooter.apply(t,arguments),r=[];return r=e(r,i),r=e(r,n),r=e(r,o)},update:function(t){var e,o,r=this,l=r._options,s=r._model,d=r._active,u=r._data,c=r._chartInstance;if(d.length){s.opacity=1;var h=[],f=a(d),g=[];for(e=0,o=d.length;o>e;++e)g.push(i(d[e]));l.itemSort&&(g=g.sort(function(t,e){return l.itemSort(t,e,u)})),d.length>1&&n.each(g,function(t){h.push(l.callbacks.labelColor.call(r,t,c))}),n.extend(s,{title:r.getTitle(g,u),beforeBody:r.getBeforeBody(g,u),body:r.getBody(g,u),afterBody:r.getAfterBody(g,u),footer:r.getFooter(g,u),x:Math.round(f.x),y:Math.round(f.y),caretPadding:n.getValueOrDefault(f.padding,2),labelColors:h});var p=r.getTooltipSize(s);r.determineAlignment(p),n.extend(s,r.getBackgroundPoint(s,p))}else r._model.opacity=0;return t&&l.custom&&l.custom.call(r,s),r},getTooltipSize:function(t){var e=this._chart.ctx,a={height:2*t.yPadding,width:0},i=t.body,o=i.reduce(function(t,e){return t+e.before.length+e.lines.length+e.after.length},0);o+=t.beforeBody.length+t.afterBody.length;var r=t.title.length,l=t.footer.length,s=t.titleFontSize,d=t.bodyFontSize,u=t.footerFontSize;a.height+=r*s,a.height+=(r-1)*t.titleSpacing,a.height+=r?t.titleMarginBottom:0,a.height+=o*d,a.height+=o?(o-1)*t.bodySpacing:0,a.height+=l?t.footerMarginTop:0,a.height+=l*u,a.height+=l?(l-1)*t.footerSpacing:0;var c=0,h=function(t){a.width=Math.max(a.width,e.measureText(t).width+c)};return e.font=n.fontString(s,t._titleFontStyle,t._titleFontFamily),n.each(t.title,h),e.font=n.fontString(d,t._bodyFontStyle,t._bodyFontFamily),n.each(t.beforeBody.concat(t.afterBody),h),c=i.length>1?d+2:0,n.each(i,function(t){n.each(t.before,h),n.each(t.lines,h),n.each(t.after,h)}),c=0,e.font=n.fontString(u,t._footerFontStyle,t._footerFontFamily),n.each(t.footer,h),a.width+=2*t.xPadding,a},determineAlignment:function(t){var e=this,a=e._model,i=e._chart,n=e._chartInstance.chartArea;a.y<t.height?a.yAlign="top":a.y>i.height-t.height&&(a.yAlign="bottom");var o,r,l,s,d,u=(n.left+n.right)/2,c=(n.top+n.bottom)/2;"center"===a.yAlign?(o=function(t){return u>=t},r=function(t){return t>u}):(o=function(e){return e<=t.width/2},r=function(e){return e>=i.width-t.width/2}),l=function(e){return e+t.width>i.width},s=function(e){return e-t.width<0},d=function(t){return c>=t?"top":"bottom"},o(a.x)?(a.xAlign="left",l(a.x)&&(a.xAlign="center",a.yAlign=d(a.y))):r(a.x)&&(a.xAlign="right",s(a.x)&&(a.xAlign="center",a.yAlign=d(a.y)))},getBackgroundPoint:function(t,e){var a={x:t.x,y:t.y},i=t.caretSize,n=t.caretPadding,o=t.cornerRadius,r=t.xAlign,l=t.yAlign,s=i+n,d=o+n;return"right"===r?a.x-=e.width:"center"===r&&(a.x-=e.width/2),"top"===l?a.y+=s:"bottom"===l?a.y-=e.height+s:a.y-=e.height/2,"center"===l?"left"===r?a.x+=s:"right"===r&&(a.x-=s):"left"===r?a.x-=d:"right"===r&&(a.x+=d),a},drawCaret:function(t,e,a){var i,o,r,l,s,d,u=this._view,c=this._chart.ctx,h=u.caretSize,f=u.cornerRadius,g=u.xAlign,p=u.yAlign,m=t.x,b=t.y,v=e.width,x=e.height;"center"===p?("left"===g?(i=m,o=i-h,r=i):(i=m+v,o=i+h,r=i),s=b+x/2,l=s-h,d=s+h):("left"===g?(i=m+f,o=i+h,r=o+h):"right"===g?(i=m+v-f,o=i-h,r=o-h):(o=m+v/2,i=o-h,r=o+h),"top"===p?(l=b,s=l-h,d=l):(l=b+x,s=l+h,d=l));var y=n.color(u.backgroundColor);c.fillStyle=y.alpha(a*y.alpha()).rgbString(),c.beginPath(),c.moveTo(i,l),c.lineTo(o,s),c.lineTo(r,d),c.closePath(),c.fill()},drawTitle:function(t,e,a,i){var o=e.title;if(o.length){a.textAlign=e._titleAlign,a.textBaseline="top";var r=e.titleFontSize,l=e.titleSpacing,s=n.color(e.titleFontColor);a.fillStyle=s.alpha(i*s.alpha()).rgbString(),a.font=n.fontString(r,e._titleFontStyle,e._titleFontFamily);var d,u;for(d=0,u=o.length;u>d;++d)a.fillText(o[d],t.x,t.y),t.y+=r+l,d+1===o.length&&(t.y+=e.titleMarginBottom-l)}},drawBody:function(t,e,a,i){var o=e.bodyFontSize,r=e.bodySpacing,l=e.body;a.textAlign=e._bodyAlign,a.textBaseline="top";var s=n.color(e.bodyFontColor),d=s.alpha(i*s.alpha()).rgbString();a.fillStyle=d,a.font=n.fontString(o,e._bodyFontStyle,e._bodyFontFamily);var u=0,c=function(e){a.fillText(e,t.x+u,t.y),t.y+=o+r};n.each(e.beforeBody,c);var h=l.length>1;u=h?o+2:0,n.each(l,function(r,l){n.each(r.before,c),n.each(r.lines,function(r){h&&(a.fillStyle=n.color(e.legendColorBackground).alpha(i).rgbaString(),a.fillRect(t.x,t.y,o,o),a.strokeStyle=n.color(e.labelColors[l].borderColor).alpha(i).rgbaString(),a.strokeRect(t.x,t.y,o,o),a.fillStyle=n.color(e.labelColors[l].backgroundColor).alpha(i).rgbaString(),a.fillRect(t.x+1,t.y+1,o-2,o-2),a.fillStyle=d),c(r)}),n.each(r.after,c)}),u=0,n.each(e.afterBody,c),t.y-=r},drawFooter:function(t,e,a,i){var o=e.footer;if(o.length){t.y+=e.footerMarginTop,a.textAlign=e._footerAlign,a.textBaseline="top";var r=n.color(e.footerFontColor);a.fillStyle=r.alpha(i*r.alpha()).rgbString(),a.font=n.fontString(e.footerFontSize,e._footerFontStyle,e._footerFontFamily),n.each(o,function(i){a.fillText(i,t.x,t.y),t.y+=e.footerFontSize+e.footerSpacing})}},draw:function(){var t=this._chart.ctx,e=this._view;if(0!==e.opacity){var a=this.getTooltipSize(e),i={x:e.x,y:e.y},o=Math.abs(e.opacity<.001)?0:e.opacity;if(this._options.enabled){var r=n.color(e.backgroundColor);t.fillStyle=r.alpha(o*r.alpha()).rgbString(),n.drawRoundedRectangle(t,i.x,i.y,a.width,a.height,e.cornerRadius),t.fill(),this.drawCaret(i,a,o),i.x+=e.xPadding,i.y+=e.yPadding,this.drawTitle(i,e,t,o),this.drawBody(i,e,t,o),this.drawFooter(i,e,t,o)}}}})}},{}],35:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=t.defaults.global;a.elements.arc={backgroundColor:a.defaultColor,borderColor:"#fff",borderWidth:2},t.elements.Arc=t.Element.extend({inLabelRange:function(t){var e=this._view;return e?Math.pow(t-e.x,2)<Math.pow(e.radius+e.hoverRadius,2):!1},inRange:function(t,a){var i=this._view;if(i){for(var n=e.getAngleFromPoint(i,{x:t,y:a}),o=n.angle,r=n.distance,l=i.startAngle,s=i.endAngle;l>s;)s+=2*Math.PI;for(;o>s;)o-=2*Math.PI;for(;l>o;)o+=2*Math.PI;var d=o>=l&&s>=o,u=r>=i.innerRadius&&r<=i.outerRadius;return d&&u}return!1},tooltipPosition:function(){var t=this._view,e=t.startAngle+(t.endAngle-t.startAngle)/2,a=(t.outerRadius-t.innerRadius)/2+t.innerRadius;return{x:t.x+Math.cos(e)*a,y:t.y+Math.sin(e)*a}},draw:function(){var t=this._chart.ctx,e=this._view,a=e.startAngle,i=e.endAngle;t.beginPath(),t.arc(e.x,e.y,e.outerRadius,a,i),t.arc(e.x,e.y,e.innerRadius,i,a,!0),t.closePath(),t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,t.fillStyle=e.backgroundColor,t.fill(),t.lineJoin="bevel",e.borderWidth&&t.stroke()}})}},{}],36:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=t.defaults.global;t.defaults.global.elements.line={tension:.4,backgroundColor:a.defaultColor,borderWidth:3,borderColor:a.defaultColor,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",capBezierPoints:!0,fill:!0},t.elements.Line=t.Element.extend({draw:function(){function t(t,e){var a=e._view;e._view.steppedLine===!0?(s.lineTo(a.x,t._view.y),s.lineTo(a.x,a.y)):0===e._view.tension?s.lineTo(a.x,a.y):s.bezierCurveTo(t._view.controlPointNextX,t._view.controlPointNextY,a.controlPointPreviousX,a.controlPointPreviousY,a.x,a.y)}var i=this,n=i._view,o=n.spanGaps,r=n.scaleZero,l=i._loop,s=i._chart.ctx;s.save();var d=i._children.slice(),u=-1;l&&d.length&&d.push(d[0]);var c,h,f,g;if(d.length&&n.fill){for(s.beginPath(),c=0;c<d.length;++c)h=d[c],f=e.previousItem(d,c),g=h._view,0===c?(l?s.moveTo(r.x,r.y):s.moveTo(g.x,r),g.skip||(u=c,s.lineTo(g.x,g.y))):(f=-1===u?f:d[u],g.skip?o||u!==c-1||(l?s.lineTo(r.x,r.y):s.lineTo(f._view.x,r)):(u!==c-1?o&&-1!==u?t(f,h):l?s.lineTo(g.x,g.y):(s.lineTo(g.x,r),s.lineTo(g.x,g.y)):t(f,h),u=c));l||-1===u||s.lineTo(d[u]._view.x,r),s.fillStyle=n.backgroundColor||a.defaultColor,s.closePath(),s.fill()}var p=a.elements.line;for(s.lineCap=n.borderCapStyle||p.borderCapStyle,s.setLineDash&&s.setLineDash(n.borderDash||p.borderDash),s.lineDashOffset=n.borderDashOffset||p.borderDashOffset,s.lineJoin=n.borderJoinStyle||p.borderJoinStyle,s.lineWidth=n.borderWidth||p.borderWidth,s.strokeStyle=n.borderColor||a.defaultColor,s.beginPath(),u=-1,c=0;c<d.length;++c)h=d[c],f=e.previousItem(d,c),g=h._view,0===c?g.skip||(s.moveTo(g.x,g.y),u=c):(f=-1===u?f:d[u],g.skip||(u!==c-1&&!o||-1===u?s.moveTo(g.x,g.y):t(f,h),u=c));s.stroke(),s.restore()}})}},{}],37:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=t.defaults.global,i=a.defaultColor;a.elements.point={radius:3,pointStyle:"circle",backgroundColor:i,borderWidth:1,borderColor:i,hitRadius:1,hoverRadius:4,hoverBorderWidth:1},t.elements.Point=t.Element.extend({inRange:function(t,e){var a=this._view;return a?Math.pow(t-a.x,2)+Math.pow(e-a.y,2)<Math.pow(a.hitRadius+a.radius,2):!1},inLabelRange:function(t){var e=this._view;return e?Math.pow(t-e.x,2)<Math.pow(e.radius+e.hitRadius,2):!1},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y,padding:t.radius+t.borderWidth}},draw:function(){var n=this._view,o=this._chart.ctx,r=n.pointStyle,l=n.radius,s=n.x,d=n.y;n.skip||(o.strokeStyle=n.borderColor||i,o.lineWidth=e.getValueOrDefault(n.borderWidth,a.elements.point.borderWidth),o.fillStyle=n.backgroundColor||i,t.canvasHelpers.drawPoint(o,r,l,s,d))}})}},{}],38:[function(t,e,a){"use strict";e.exports=function(t){var e=t.defaults.global;e.elements.rectangle={backgroundColor:e.defaultColor,borderWidth:0,borderColor:e.defaultColor,borderSkipped:"bottom"},t.elements.Rectangle=t.Element.extend({draw:function(){function t(t){return s[(u+t)%4]}var e=this._chart.ctx,a=this._view,i=a.width/2,n=a.x-i,o=a.x+i,r=a.base-(a.base-a.y),l=a.borderWidth/2;a.borderWidth&&(n+=l,o-=l,r+=l),e.beginPath(),e.fillStyle=a.backgroundColor,e.strokeStyle=a.borderColor,e.lineWidth=a.borderWidth;var s=[[n,a.base],[n,r],[o,r],[o,a.base]],d=["bottom","left","top","right"],u=d.indexOf(a.borderSkipped,0);-1===u&&(u=0),e.moveTo.apply(e,t(0));for(var c=1;4>c;c++)e.lineTo.apply(e,t(c));e.fill(),a.borderWidth&&e.stroke()},height:function(){var t=this._view;return t.base-t.y},inRange:function(t,e){var a=this._view;return a?a.y<a.base?t>=a.x-a.width/2&&t<=a.x+a.width/2&&e>=a.y&&e<=a.base:t>=a.x-a.width/2&&t<=a.x+a.width/2&&e>=a.base&&e<=a.y:!1},inLabelRange:function(t){var e=this._view;return e?t>=e.x-e.width/2&&t<=e.x+e.width/2:!1},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y}}})}},{}],39:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a={position:"bottom"},i=t.Scale.extend({getLabels:function(){var t=this.chart.data;return(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels},determineDataLimits:function(){var t=this,a=t.getLabels();t.minIndex=0,t.maxIndex=a.length-1;var i;void 0!==t.options.ticks.min&&(i=e.indexOf(a,t.options.ticks.min),t.minIndex=-1!==i?i:t.minIndex),void 0!==t.options.ticks.max&&(i=e.indexOf(a,t.options.ticks.max),t.maxIndex=-1!==i?i:t.maxIndex),t.min=a[t.minIndex],t.max=a[t.maxIndex]},buildTicks:function(){var t=this,e=t.getLabels();t.ticks=0===t.minIndex&&t.maxIndex===e.length-1?e:e.slice(t.minIndex,t.maxIndex+1)},getLabelForIndex:function(t,e){var a=this,i=a.chart.data,n=a.isHorizontal();return i.xLabels&&n||i.yLabels&&!n?a.getRightValue(i.datasets[e].data[t]):a.ticks[t]},getPixelForValue:function(t,e,a,i){var n=this,o=Math.max(n.maxIndex+1-n.minIndex-(n.options.gridLines.offsetGridLines?0:1),1);if(void 0!==t&&isNaN(e)){var r=n.getLabels(),l=r.indexOf(t);e=-1!==l?l:e}if(n.isHorizontal()){var s=n.width-(n.paddingLeft+n.paddingRight),d=s/o,u=d*(e-n.minIndex)+n.paddingLeft;return(n.options.gridLines.offsetGridLines&&i||n.maxIndex===n.minIndex&&i)&&(u+=d/2),n.left+Math.round(u)}var c=n.height-(n.paddingTop+n.paddingBottom),h=c/o,f=h*(e-n.minIndex)+n.paddingTop;return n.options.gridLines.offsetGridLines&&i&&(f+=h/2),n.top+Math.round(f)},getPixelForTick:function(t,e){return this.getPixelForValue(this.ticks[t],t+this.minIndex,null,e)},getValueForPixel:function(t){var e,a=this,i=Math.max(a.ticks.length-(a.options.gridLines.offsetGridLines?0:1),1),n=a.isHorizontal(),o=n?a.width-(a.paddingLeft+a.paddingRight):a.height-(a.paddingTop+a.paddingBottom),r=o/i;return t-=n?a.left:a.top,a.options.gridLines.offsetGridLines&&(t-=r/2),t-=n?a.paddingLeft:a.paddingTop,e=0>=t?0:Math.round(t/r)},getBasePixel:function(){return this.bottom}});t.scaleService.registerScaleType("category",i,a)}},{}],40:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a={position:"left",ticks:{callback:function(t,a,i){var n=i.length>3?i[2]-i[1]:i[1]-i[0];Math.abs(n)>1&&t!==Math.floor(t)&&(n=t-Math.floor(t));var o=e.log10(Math.abs(n)),r="";if(0!==t){var l=-1*Math.floor(o);l=Math.max(Math.min(l,20),0),r=t.toFixed(l)}else r="0";return r}}},i=t.LinearScaleBase.extend({determineDataLimits:function(){function t(t){return l?t.xAxisID===a.id:t.yAxisID===a.id}var a=this,i=a.options,n=a.chart,o=n.data,r=o.datasets,l=a.isHorizontal();if(a.min=null,a.max=null,i.stacked){var s={};e.each(r,function(o,r){var l=n.getDatasetMeta(r);void 0===s[l.type]&&(s[l.type]={positiveValues:[],negativeValues:[]});var d=s[l.type].positiveValues,u=s[l.type].negativeValues;n.isDatasetVisible(r)&&t(l)&&e.each(o.data,function(t,e){var n=+a.getRightValue(t);isNaN(n)||l.data[e].hidden||(d[e]=d[e]||0,u[e]=u[e]||0,i.relativePoints?d[e]=100:0>n?u[e]+=n:d[e]+=n)})}),e.each(s,function(t){var i=t.positiveValues.concat(t.negativeValues),n=e.min(i),o=e.max(i);a.min=null===a.min?n:Math.min(a.min,n),a.max=null===a.max?o:Math.max(a.max,o)})}else e.each(r,function(i,o){var r=n.getDatasetMeta(o);n.isDatasetVisible(o)&&t(r)&&e.each(i.data,function(t,e){var i=+a.getRightValue(t);isNaN(i)||r.data[e].hidden||(null===a.min?a.min=i:i<a.min&&(a.min=i),null===a.max?a.max=i:i>a.max&&(a.max=i))})});this.handleTickRangeOptions()},getTickLimit:function(){var a,i=this,n=i.options.ticks;if(i.isHorizontal())a=Math.min(n.maxTicksLimit?n.maxTicksLimit:11,Math.ceil(i.width/50));else{var o=e.getValueOrDefault(n.fontSize,t.defaults.global.defaultFontSize);a=Math.min(n.maxTicksLimit?n.maxTicksLimit:11,Math.ceil(i.height/(2*o)))}return a},handleDirectionalChanges:function(){this.isHorizontal()||this.ticks.reverse()},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForValue:function(t){var e,a,i=this,n=i.paddingLeft,o=i.paddingBottom,r=i.start,l=+i.getRightValue(t),s=i.end-r;return i.isHorizontal()?(a=i.width-(n+i.paddingRight),e=i.left+a/s*(l-r),Math.round(e+n)):(a=i.height-(i.paddingTop+o),e=i.bottom-o-a/s*(l-r),Math.round(e))},getValueForPixel:function(t){var e=this,a=e.isHorizontal(),i=e.paddingLeft,n=e.paddingBottom,o=a?e.width-(i+e.paddingRight):e.height-(e.paddingTop+n),r=(a?t-e.left-i:e.bottom-n-t)/o;return e.start+(e.end-e.start)*r},getPixelForTick:function(t){return this.getPixelForValue(this.ticksAsNumbers[t])}});t.scaleService.registerScaleType("linear",i,a)}},{}],41:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=e.noop;t.LinearScaleBase=t.Scale.extend({handleTickRangeOptions:function(){var t=this,a=t.options,i=a.ticks;if(i.beginAtZero){var n=e.sign(t.min),o=e.sign(t.max);0>n&&0>o?t.max=0:n>0&&o>0&&(t.min=0)}void 0!==i.min?t.min=i.min:void 0!==i.suggestedMin&&(t.min=Math.min(t.min,i.suggestedMin)),void 0!==i.max?t.max=i.max:void 0!==i.suggestedMax&&(t.max=Math.max(t.max,i.suggestedMax)),t.min===t.max&&(t.max++,i.beginAtZero||t.min--)},getTickLimit:a,handleDirectionalChanges:a,buildTicks:function(){var t=this,a=t.options,i=t.ticks=[],n=a.ticks,o=e.getValueOrDefault,r=t.getTickLimit();r=Math.max(2,r);var l,s=n.fixedStepSize&&n.fixedStepSize>0||n.stepSize&&n.stepSize>0;if(s)l=o(n.fixedStepSize,n.stepSize);else{var d=e.niceNum(t.max-t.min,!1);l=e.niceNum(d/(r-1),!0)}var u=Math.floor(t.min/l)*l,c=Math.ceil(t.max/l)*l,h=(c-u)/l;h=e.almostEquals(h,Math.round(h),l/1e3)?Math.round(h):Math.ceil(h),i.push(void 0!==n.min?n.min:u);for(var f=1;h>f;++f)i.push(u+f*l);i.push(void 0!==n.max?n.max:c),t.handleDirectionalChanges(),t.max=e.max(i),t.min=e.min(i),n.reverse?(i.reverse(),t.start=t.max,t.end=t.min):(t.start=t.min,t.end=t.max)},convertTicksToLabels:function(){var e=this;e.ticksAsNumbers=e.ticks.slice(),e.zeroLineIndex=e.ticks.indexOf(0),t.Scale.prototype.convertTicksToLabels.call(e)}})}},{}],42:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a={position:"left",ticks:{callback:function(t,a,i){var n=t/Math.pow(10,Math.floor(e.log10(t)));return 0===t?"0":1===n||2===n||5===n||0===a||a===i.length-1?t.toExponential():""}}},i=t.Scale.extend({determineDataLimits:function(){function t(t){return d?t.xAxisID===a.id:t.yAxisID===a.id}var a=this,i=a.options,n=i.ticks,o=a.chart,r=o.data,l=r.datasets,s=e.getValueOrDefault,d=a.isHorizontal();if(a.min=null,a.max=null,a.minNotZero=null,i.stacked){var u={};e.each(l,function(n,r){var l=o.getDatasetMeta(r);o.isDatasetVisible(r)&&t(l)&&(void 0===u[l.type]&&(u[l.type]=[]),e.each(n.data,function(t,e){var n=u[l.type],o=+a.getRightValue(t);isNaN(o)||l.data[e].hidden||(n[e]=n[e]||0,i.relativePoints?n[e]=100:n[e]+=o)}))}),e.each(u,function(t){var i=e.min(t),n=e.max(t);a.min=null===a.min?i:Math.min(a.min,i),a.max=null===a.max?n:Math.max(a.max,n)})}else e.each(l,function(i,n){var r=o.getDatasetMeta(n);o.isDatasetVisible(n)&&t(r)&&e.each(i.data,function(t,e){var i=+a.getRightValue(t);isNaN(i)||r.data[e].hidden||(null===a.min?a.min=i:i<a.min&&(a.min=i),null===a.max?a.max=i:i>a.max&&(a.max=i),0!==i&&(null===a.minNotZero||i<a.minNotZero)&&(a.minNotZero=i))})});a.min=s(n.min,a.min),a.max=s(n.max,a.max),a.min===a.max&&(0!==a.min&&null!==a.min?(a.min=Math.pow(10,Math.floor(e.log10(a.min))-1),a.max=Math.pow(10,Math.floor(e.log10(a.max))+1)):(a.min=1,a.max=10))},buildTicks:function(){for(var t=this,a=t.options,i=a.ticks,n=e.getValueOrDefault,o=t.ticks=[],r=n(i.min,Math.pow(10,Math.floor(e.log10(t.min))));r<t.max;){o.push(r);var l,s;0===r?(l=Math.floor(e.log10(t.minNotZero)),s=Math.round(t.minNotZero/Math.pow(10,l))):(l=Math.floor(e.log10(r)),s=Math.floor(r/Math.pow(10,l))+1),10===s&&(s=1,++l),r=s*Math.pow(10,l)}var d=n(i.max,r);o.push(d),t.isHorizontal()||o.reverse(),t.max=e.max(o),t.min=e.min(o),i.reverse?(o.reverse(),t.start=t.max,t.end=t.min):(t.start=t.min,t.end=t.max)},convertTicksToLabels:function(){this.tickValues=this.ticks.slice(),t.Scale.prototype.convertTicksToLabels.call(this)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForTick:function(t){return this.getPixelForValue(this.tickValues[t])},getPixelForValue:function(t){var a,i,n,o=this,r=o.start,l=+o.getRightValue(t),s=o.paddingTop,d=o.paddingBottom,u=o.paddingLeft,c=o.options,h=c.ticks;return o.isHorizontal()?(n=e.log10(o.end)-e.log10(r),0===l?i=o.left+u:(a=o.width-(u+o.paddingRight),i=o.left+a/n*(e.log10(l)-e.log10(r)),i+=u)):(a=o.height-(s+d),0!==r||h.reverse?0===o.end&&h.reverse?(n=e.log10(o.start)-e.log10(o.minNotZero),i=l===o.end?o.top+s:l===o.minNotZero?o.top+s+.02*a:o.top+s+.02*a+.98*a/n*(e.log10(l)-e.log10(o.minNotZero))):(n=e.log10(o.end)-e.log10(r),a=o.height-(s+d),i=o.bottom-d-a/n*(e.log10(l)-e.log10(r))):(n=e.log10(o.end)-e.log10(o.minNotZero),i=l===r?o.bottom-d:l===o.minNotZero?o.bottom-d-.02*a:o.bottom-d-.02*a-.98*a/n*(e.log10(l)-e.log10(o.minNotZero)))),i},getValueForPixel:function(t){var a,i,n=this,o=e.log10(n.end)-e.log10(n.start);return n.isHorizontal()?(i=n.width-(n.paddingLeft+n.paddingRight),a=n.start*Math.pow(10,(t-n.left-n.paddingLeft)*o/i)):(i=n.height-(n.paddingTop+n.paddingBottom),a=Math.pow(10,(n.bottom-n.paddingBottom-t)*o/i)/n.start),a}});t.scaleService.registerScaleType("logarithmic",i,a)}},{}],43:[function(t,e,a){"use strict";e.exports=function(t){var e=t.helpers,a=t.defaults.global,i={display:!0,animate:!0,lineArc:!1,position:"chartArea",angleLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1},ticks:{showLabelBackdrop:!0,backdropColor:"rgba(255,255,255,0.75)",backdropPaddingY:2,backdropPaddingX:2},pointLabels:{fontSize:10,callback:function(t){return t}}},n=t.LinearScaleBase.extend({getValueCount:function(){return this.chart.data.labels.length},setDimensions:function(){var t=this,i=t.options,n=i.ticks;t.width=t.maxWidth,t.height=t.maxHeight,t.xCenter=Math.round(t.width/2),t.yCenter=Math.round(t.height/2);var o=e.min([t.height,t.width]),r=e.getValueOrDefault(n.fontSize,a.defaultFontSize);t.drawingArea=i.display?o/2-(r/2+n.backdropPaddingY):o/2},determineDataLimits:function(){var t=this,a=t.chart;t.min=null,t.max=null,e.each(a.data.datasets,function(i,n){if(a.isDatasetVisible(n)){var o=a.getDatasetMeta(n);e.each(i.data,function(e,a){var i=+t.getRightValue(e);isNaN(i)||o.data[a].hidden||(null===t.min?t.min=i:i<t.min&&(t.min=i),null===t.max?t.max=i:i>t.max&&(t.max=i))})}}),t.handleTickRangeOptions()},getTickLimit:function(){var t=this.options.ticks,i=e.getValueOrDefault(t.fontSize,a.defaultFontSize);return Math.min(t.maxTicksLimit?t.maxTicksLimit:11,Math.ceil(this.drawingArea/(1.5*i)))},convertTicksToLabels:function(){var e=this;t.LinearScaleBase.prototype.convertTicksToLabels.call(e),e.pointLabels=e.chart.data.labels.map(e.options.pointLabels.callback,e)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},fit:function(){var t,i,n,o,r,l,s,d,u,c,h,f,g=this.options.pointLabels,p=e.getValueOrDefault(g.fontSize,a.defaultFontSize),m=e.getValueOrDefault(g.fontStyle,a.defaultFontStyle),b=e.getValueOrDefault(g.fontFamily,a.defaultFontFamily),v=e.fontString(p,m,b),x=e.min([this.height/2-p-5,this.width/2]),y=this.width,k=0;for(this.ctx.font=v,i=0;i<this.getValueCount();i++){t=this.getPointPosition(i,x),n=this.ctx.measureText(this.pointLabels[i]?this.pointLabels[i]:"").width+5;var S=this.getIndexAngle(i)+Math.PI/2,w=360*S/(2*Math.PI)%360;0===w||180===w?(o=n/2,t.x+o>y&&(y=t.x+o,r=i),t.x-o<k&&(k=t.x-o,s=i)):180>w?t.x+n>y&&(y=t.x+n,r=i):t.x-n<k&&(k=t.x-n,s=i)}u=k,c=Math.ceil(y-this.width),l=this.getIndexAngle(r),d=this.getIndexAngle(s),h=c/Math.sin(l+Math.PI/2),f=u/Math.sin(d+Math.PI/2),h=e.isNumber(h)?h:0,f=e.isNumber(f)?f:0,this.drawingArea=Math.round(x-(f+h)/2),this.setCenterPoint(f,h)},setCenterPoint:function(t,e){var a=this,i=a.width-e-a.drawingArea,n=t+a.drawingArea;a.xCenter=Math.round((n+i)/2+a.left),a.yCenter=Math.round(a.height/2+a.top)},getIndexAngle:function(t){var e=2*Math.PI/this.getValueCount(),a=this.chart.options&&this.chart.options.startAngle?this.chart.options.startAngle:0,i=a*Math.PI*2/360;return t*e-Math.PI/2+i},getDistanceFromCenterForValue:function(t){var e=this;if(null===t)return 0;var a=e.drawingArea/(e.max-e.min);return e.options.reverse?(e.max-t)*a:(t-e.min)*a},getPointPosition:function(t,e){var a=this,i=a.getIndexAngle(t);return{x:Math.round(Math.cos(i)*e)+a.xCenter,y:Math.round(Math.sin(i)*e)+a.yCenter}},getPointPositionForValue:function(t,e){
return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))},getBasePosition:function(){var t=this,e=t.min,a=t.max;return t.getPointPositionForValue(0,t.beginAtZero?0:0>e&&0>a?a:e>0&&a>0?e:0)},draw:function(){var t=this,i=t.options,n=i.gridLines,o=i.ticks,r=i.angleLines,l=i.pointLabels,s=e.getValueOrDefault;if(i.display){var d=t.ctx,u=s(o.fontSize,a.defaultFontSize),c=s(o.fontStyle,a.defaultFontStyle),h=s(o.fontFamily,a.defaultFontFamily),f=e.fontString(u,c,h);if(e.each(t.ticks,function(r,l){if(l>0||i.reverse){var c=t.getDistanceFromCenterForValue(t.ticksAsNumbers[l]),h=t.yCenter-c;if(n.display&&0!==l)if(d.strokeStyle=e.getValueAtIndexOrDefault(n.color,l-1),d.lineWidth=e.getValueAtIndexOrDefault(n.lineWidth,l-1),i.lineArc)d.beginPath(),d.arc(t.xCenter,t.yCenter,c,0,2*Math.PI),d.closePath(),d.stroke();else{d.beginPath();for(var g=0;g<t.getValueCount();g++){var p=t.getPointPosition(g,c);0===g?d.moveTo(p.x,p.y):d.lineTo(p.x,p.y)}d.closePath(),d.stroke()}if(o.display){var m=s(o.fontColor,a.defaultFontColor);if(d.font=f,o.showLabelBackdrop){var b=d.measureText(r).width;d.fillStyle=o.backdropColor,d.fillRect(t.xCenter-b/2-o.backdropPaddingX,h-u/2-o.backdropPaddingY,b+2*o.backdropPaddingX,u+2*o.backdropPaddingY)}d.textAlign="center",d.textBaseline="middle",d.fillStyle=m,d.fillText(r,t.xCenter,h)}}}),!i.lineArc){d.lineWidth=r.lineWidth,d.strokeStyle=r.color;for(var g=t.getDistanceFromCenterForValue(i.reverse?t.min:t.max),p=s(l.fontSize,a.defaultFontSize),m=s(l.fontStyle,a.defaultFontStyle),b=s(l.fontFamily,a.defaultFontFamily),v=e.fontString(p,m,b),x=t.getValueCount()-1;x>=0;x--){if(r.display){var y=t.getPointPosition(x,g);d.beginPath(),d.moveTo(t.xCenter,t.yCenter),d.lineTo(y.x,y.y),d.stroke(),d.closePath()}var k=t.getPointPosition(x,g+5),S=s(l.fontColor,a.defaultFontColor);d.font=v,d.fillStyle=S;var w=t.pointLabels,C=this.getIndexAngle(x)+Math.PI/2,M=360*C/(2*Math.PI)%360;0===M||180===M?d.textAlign="center":180>M?d.textAlign="left":d.textAlign="right",90===M||270===M?d.textBaseline="middle":M>270||90>M?d.textBaseline="bottom":d.textBaseline="top",d.fillText(w[x]?w[x]:"",k.x,k.y)}}}}});t.scaleService.registerScaleType("radialLinear",n,i)}},{}],44:[function(t,e,a){"use strict";var i=t(1);i="function"==typeof i?i:window.moment,e.exports=function(t){var e=t.helpers,a={units:[{name:"millisecond",steps:[1,2,5,10,20,50,100,250,500]},{name:"second",steps:[1,2,5,10,30]},{name:"minute",steps:[1,2,5,10,30]},{name:"hour",steps:[1,2,3,6,12]},{name:"day",steps:[1,2,5]},{name:"week",maxStep:4},{name:"month",maxStep:3},{name:"quarter",maxStep:4},{name:"year",maxStep:!1}]},n={position:"bottom",time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm:ss a",hour:"MMM D, hA",day:"ll",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!1}},o=t.Scale.extend({initialize:function(){if(!i)throw new Error("Chart.js - Moment.js could not be found! You must include it before Chart.js to use the time scale. Download at https://momentjs.com");t.Scale.prototype.initialize.call(this)},getLabelMoment:function(t,e){return null===t||null===e?null:"undefined"!=typeof this.labelMoments[t]?this.labelMoments[t][e]:null},getLabelDiff:function(t,e){var a=this;return null===t||null===e?null:(void 0===a.labelDiffs&&a.buildLabelDiffs(),"undefined"!=typeof a.labelDiffs[t]?a.labelDiffs[t][e]:null)},getMomentStartOf:function(t){var e=this;return"week"===e.options.time.unit&&e.options.time.isoWeekday!==!1?t.clone().startOf("isoWeek").isoWeekday(e.options.time.isoWeekday):t.clone().startOf(e.tickUnit)},determineDataLimits:function(){var t=this;t.labelMoments=[];var a=[];t.chart.data.labels&&t.chart.data.labels.length>0?(e.each(t.chart.data.labels,function(e){var i=t.parseTime(e);i.isValid()&&(t.options.time.round&&i.startOf(t.options.time.round),a.push(i))},t),t.firstTick=i.min.call(t,a),t.lastTick=i.max.call(t,a)):(t.firstTick=null,t.lastTick=null),e.each(t.chart.data.datasets,function(n,o){var r=[],l=t.chart.isDatasetVisible(o);"object"==typeof n.data[0]&&null!==n.data[0]?e.each(n.data,function(e){var a=t.parseTime(t.getRightValue(e));a.isValid()&&(t.options.time.round&&a.startOf(t.options.time.round),r.push(a),l&&(t.firstTick=null!==t.firstTick?i.min(t.firstTick,a):a,t.lastTick=null!==t.lastTick?i.max(t.lastTick,a):a))},t):r=a,t.labelMoments.push(r)},t),t.options.time.min&&(t.firstTick=t.parseTime(t.options.time.min)),t.options.time.max&&(t.lastTick=t.parseTime(t.options.time.max)),t.firstTick=(t.firstTick||i()).clone(),t.lastTick=(t.lastTick||i()).clone()},buildLabelDiffs:function(){var t=this;t.labelDiffs=[];var a=[];t.chart.data.labels&&t.chart.data.labels.length>0&&e.each(t.chart.data.labels,function(e){var i=t.parseTime(e);i.isValid()&&(t.options.time.round&&i.startOf(t.options.time.round),a.push(i.diff(t.firstTick,t.tickUnit,!0)))},t),e.each(t.chart.data.datasets,function(i){var n=[];"object"==typeof i.data[0]&&null!==i.data[0]?e.each(i.data,function(e){var a=t.parseTime(t.getRightValue(e));a.isValid()&&(t.options.time.round&&a.startOf(t.options.time.round),n.push(a.diff(t.firstTick,t.tickUnit,!0)))},t):n=a,t.labelDiffs.push(n)},t)},buildTicks:function(){var i=this;i.ctx.save();var n=e.getValueOrDefault(i.options.ticks.fontSize,t.defaults.global.defaultFontSize),o=e.getValueOrDefault(i.options.ticks.fontStyle,t.defaults.global.defaultFontStyle),r=e.getValueOrDefault(i.options.ticks.fontFamily,t.defaults.global.defaultFontFamily),l=e.fontString(n,o,r);if(i.ctx.font=l,i.ticks=[],i.unitScale=1,i.scaleSizeInUnits=0,i.options.time.unit)i.tickUnit=i.options.time.unit||"day",i.displayFormat=i.options.time.displayFormats[i.tickUnit],i.scaleSizeInUnits=i.lastTick.diff(i.firstTick,i.tickUnit,!0),i.unitScale=e.getValueOrDefault(i.options.time.unitStepSize,1);else{var s=i.isHorizontal()?i.width-(i.paddingLeft+i.paddingRight):i.height-(i.paddingTop+i.paddingBottom),d=i.tickFormatFunction(i.firstTick,0,[]),u=i.ctx.measureText(d).width,c=Math.cos(e.toRadians(i.options.ticks.maxRotation)),h=Math.sin(e.toRadians(i.options.ticks.maxRotation));u=u*c+n*h;var f=s/u;i.tickUnit=i.options.time.minUnit,i.scaleSizeInUnits=i.lastTick.diff(i.firstTick,i.tickUnit,!0),i.displayFormat=i.options.time.displayFormats[i.tickUnit];for(var g=0,p=a.units[g];g<a.units.length;){if(i.unitScale=1,e.isArray(p.steps)&&Math.ceil(i.scaleSizeInUnits/f)<e.max(p.steps)){for(var m=0;m<p.steps.length;++m)if(p.steps[m]>=Math.ceil(i.scaleSizeInUnits/f)){i.unitScale=e.getValueOrDefault(i.options.time.unitStepSize,p.steps[m]);break}break}if(p.maxStep===!1||Math.ceil(i.scaleSizeInUnits/f)<p.maxStep){i.unitScale=e.getValueOrDefault(i.options.time.unitStepSize,Math.ceil(i.scaleSizeInUnits/f));break}++g,p=a.units[g],i.tickUnit=p.name;var b=i.firstTick.diff(i.getMomentStartOf(i.firstTick),i.tickUnit,!0),v=i.getMomentStartOf(i.lastTick.clone().add(1,i.tickUnit)).diff(i.lastTick,i.tickUnit,!0);i.scaleSizeInUnits=i.lastTick.diff(i.firstTick,i.tickUnit,!0)+b+v,i.displayFormat=i.options.time.displayFormats[p.name]}}var x;if(i.options.time.min?x=i.getMomentStartOf(i.firstTick):(i.firstTick=i.getMomentStartOf(i.firstTick),x=i.firstTick),!i.options.time.max){var y=i.getMomentStartOf(i.lastTick),k=y.diff(i.lastTick,i.tickUnit,!0);0>k?i.lastTick=i.getMomentStartOf(i.lastTick.add(1,i.tickUnit)):k>=0&&(i.lastTick=y),i.scaleSizeInUnits=i.lastTick.diff(i.firstTick,i.tickUnit,!0)}i.options.time.displayFormat&&(i.displayFormat=i.options.time.displayFormat),i.ticks.push(i.firstTick.clone());for(var S=1;S<=i.scaleSizeInUnits;++S){var w=x.clone().add(S,i.tickUnit);if(i.options.time.max&&w.diff(i.lastTick,i.tickUnit,!0)>=0)break;S%i.unitScale===0&&i.ticks.push(w)}var C=i.ticks[i.ticks.length-1].diff(i.lastTick,i.tickUnit);(0!==C||0===i.scaleSizeInUnits)&&(i.options.time.max?(i.ticks.push(i.lastTick.clone()),i.scaleSizeInUnits=i.lastTick.diff(i.ticks[0],i.tickUnit,!0)):(i.ticks.push(i.lastTick.clone()),i.scaleSizeInUnits=i.lastTick.diff(i.firstTick,i.tickUnit,!0))),i.ctx.restore(),i.labelDiffs=void 0},getLabelForIndex:function(t,e){var a=this,i=a.chart.data.labels&&t<a.chart.data.labels.length?a.chart.data.labels[t]:"";return"object"==typeof a.chart.data.datasets[e].data[0]&&(i=a.getRightValue(a.chart.data.datasets[e].data[t])),a.options.time.tooltipFormat&&(i=a.parseTime(i).format(a.options.time.tooltipFormat)),i},tickFormatFunction:function(t,a,i){var n=t.format(this.displayFormat),o=this.options.ticks,r=e.getValueOrDefault(o.callback,o.userCallback);return r?r(n,a,i):n},convertTicksToLabels:function(){var t=this;t.tickMoments=t.ticks,t.ticks=t.ticks.map(t.tickFormatFunction,t)},getPixelForValue:function(t,e,a){var i=this,n=null;if(void 0!==e&&void 0!==a&&(n=i.getLabelDiff(a,e)),null===n&&(t&&t.isValid||(t=i.parseTime(i.getRightValue(t))),t&&t.isValid&&t.isValid()&&(n=t.diff(i.firstTick,i.tickUnit,!0))),null!==n){var o=0!==n?n/i.scaleSizeInUnits:n;if(i.isHorizontal()){var r=i.width-(i.paddingLeft+i.paddingRight),l=r*o+i.paddingLeft;return i.left+Math.round(l)}var s=i.height-(i.paddingTop+i.paddingBottom),d=s*o+i.paddingTop;return i.top+Math.round(d)}},getPixelForTick:function(t){return this.getPixelForValue(this.tickMoments[t],null,null)},getValueForPixel:function(t){var e=this,a=e.isHorizontal()?e.width-(e.paddingLeft+e.paddingRight):e.height-(e.paddingTop+e.paddingBottom),n=(t-(e.isHorizontal()?e.left+e.paddingLeft:e.top+e.paddingTop))/a;return n*=e.scaleSizeInUnits,e.firstTick.clone().add(i.duration(n,e.tickUnit).asSeconds(),"seconds")},parseTime:function(t){var e=this;return"string"==typeof e.options.time.parser?i(t,e.options.time.parser):"function"==typeof e.options.time.parser?e.options.time.parser(t):"function"==typeof t.getMonth||"number"==typeof t?i(t):t.isValid&&t.isValid()?t:"string"!=typeof e.options.time.format&&e.options.time.format.call?(console.warn("options.time.format is deprecated and replaced by options.time.parser. See http://nnnick.github.io/Chart.js/docs-v2/#scales-time-scale"),e.options.time.format(t)):i(t,e.options.time.format)}});t.scaleService.registerScaleType("time",o,n)}},{1:1}]},{},[7])(7)});!function(t){"use strict";if("object"==typeof exports)module.exports=t("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof Chart?Chart:require("chart.js"));else if("function"==typeof define&&define.amd)define(["angular","chart"],t);else{if("undefined"==typeof angular||"undefined"==typeof Chart)throw new Error("Chart.js library needs to be included, see http://jtblin.github.io/angular-chart.js/");t(angular,Chart)}}(function(t,r){"use strict";function a(){var a={responsive:!0},e={Chart:r,getOptions:function(r){var e=r&&a[r]||{};return t.extend({},a,e)}};this.setOptions=function(r,n){n?a[r]=t.merge(a[r]||{},n):(n=r,a=t.merge(a,n)),t.merge(e.Chart.defaults,a)},this.$get=function(){return e}}function e(a,e){function o(t,r,e){var n=w(t,r);if(v(r)&&$(t,r,e,n)){var o=e[0],c=o.getContext("2d");r.chartGetColor=C(r);var i=y(t,r);F(r),r.chart=new a.Chart(c,{type:t,data:i,options:n}),r.$emit("chart-create",r.chart),D(o,r)}}function c(t,r){return!!(t&&r&&t.length&&r.length)&&(Array.isArray(t[0])?t.length===r.length&&t.every(function(t,a){return t.length===r[a].length}):r.reduce(i,0)>0&&t.length===r.length)}function i(t,r){return t+r}function u(r,a,e){var n=null;return function(o){var c=r.chart.getElementsAtEvent||r.chart.getPointsAtEvent;if(c){var i=c.call(r.chart,o);e!==!1&&t.equals(n,i)!==!1||(n=i,r[a](i,o))}}}function h(e,n){for(var o=t.copy(n.chartColors||a.getOptions(e).chartColors||r.defaults.global.colors),c=o.length<n.chartData.length;o.length<n.chartData.length;)o.push(n.chartGetColor());return c&&(n.chartColors=o),o.map(l)}function l(t){return"object"==typeof t&&null!==t?t:"string"==typeof t&&"#"===t[0]?f(p(t.substr(1))):s()}function s(){var t=[d(0,255),d(0,255),d(0,255)];return f(t)}function f(t){return{backgroundColor:g(t,.2),pointBackgroundColor:g(t,1),pointHoverBackgroundColor:g(t,.8),borderColor:g(t,1),pointBorderColor:"#fff",pointHoverBorderColor:g(t,1)}}function d(t,r){return Math.floor(Math.random()*(r-t+1))+t}function g(t,r){return n?"rgb("+t.join(",")+")":"rgba("+t.concat(r).join(",")+")"}function p(t){var r=parseInt(t,16),a=r>>16&255,e=r>>8&255,n=255&r;return[a,e,n]}function v(t){return t.chartData&&t.chartData.length}function C(t){return"function"==typeof t.chartGetColor?t.chartGetColor:s}function y(t,r){var a=h(t,r);return Array.isArray(r.chartData[0])?b(r.chartLabels,r.chartData,r.chartSeries||[],a,r.chartDatasetOverride):m(r.chartLabels,r.chartData,a,r.chartDatasetOverride)}function b(r,a,e,n,o){return{labels:r,datasets:a.map(function(r,a){var c=t.extend({},n[a],{label:e[a],data:r});return o&&o.length>=a&&t.merge(c,o[a]),c})}}function m(r,a,e,n){var o={labels:r,datasets:[{data:a,backgroundColor:e.map(function(t){return t.pointBackgroundColor}),hoverBackgroundColor:e.map(function(t){return t.backgroundColor})}]};return n&&t.merge(o.datasets[0],n),o}function w(r,e){return t.extend({},a.getOptions(r),e.chartOptions)}function D(r,a){r.onclick=a.chartClick?u(a,"chartClick",!1):t.noop,r.onmousemove=a.chartHover?u(a,"chartHover",!0):t.noop}function B(t,r){Array.isArray(r.chartData[0])?r.chart.data.datasets.forEach(function(r,a){r.data=t[a]}):r.chart.data.datasets[0].data=t,r.chart.update(),r.$emit("chart-update",r.chart)}function A(t){return!t||Array.isArray(t)&&!t.length||"object"==typeof t&&!Object.keys(t).length}function $(t,r,a,n){return!n.responsive||0!==a[0].clientHeight||(e(function(){o(t,r,a)},50,!1),!1)}function F(t){t.chart&&(t.chart.destroy(),t.$emit("chart-destroy",t.chart))}return function(r){return{restrict:"CA",scope:{chartGetColor:"=?",chartType:"=",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColors:"=?",chartClick:"=?",chartHover:"=?",chartDatasetOverride:"=?"},link:function(a,e){function i(t,n){if(!t||!t.length||Array.isArray(t[0])&&!t[0].length)return void F(a);var i=r||a.chartType;if(i)return a.chart&&c(t,n)?B(t,a):void o(i,a,e)}function u(n,c){if(!A(n)&&!t.equals(n,c)){var i=r||a.chartType;i&&o(i,a,e)}}function h(r,n){A(r)||t.equals(r,n)||o(r,a,e)}n&&window.G_vmlCanvasManager.initElement(e[0]),a.$watch("chartData",i,!0),a.$watch("chartSeries",u,!0),a.$watch("chartLabels",u,!0),a.$watch("chartOptions",u,!0),a.$watch("chartColors",u,!0),a.$watch("chartDatasetOverride",u,!0),a.$watch("chartType",h,!1),a.$on("$destroy",function(){F(a)}),a.$on("$resize",function(){a.chart&&a.chart.resize()})}}}}r.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>",r.defaults.global.tooltips.mode="label",r.defaults.global.elements.line.borderWidth=2,r.defaults.global.elements.rectangle.borderWidth=2,r.defaults.global.legend.display=!1,r.defaults.global.colors=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var n="object"==typeof window.G_vmlCanvasManager&&null!==window.G_vmlCanvasManager&&"function"==typeof window.G_vmlCanvasManager.initElement;return n&&(r.defaults.global.animation=!1),t.module("chart.js",[]).provider("ChartJs",a).factory("ChartJsFactory",["ChartJs","$timeout",e]).directive("chartBase",["ChartJsFactory",function(t){return new t}]).directive("chartLine",["ChartJsFactory",function(t){return new t("line")}]).directive("chartBar",["ChartJsFactory",function(t){return new t("bar")}]).directive("chartHorizontalBar",["ChartJsFactory",function(t){return new t("horizontalBar")}]).directive("chartRadar",["ChartJsFactory",function(t){return new t("radar")}]).directive("chartDoughnut",["ChartJsFactory",function(t){return new t("doughnut")}]).directive("chartPie",["ChartJsFactory",function(t){return new t("pie")}]).directive("chartPolarArea",["ChartJsFactory",function(t){return new t("polarArea")}]).directive("chartBubble",["ChartJsFactory",function(t){return new t("bubble")}]).name});var module=module||{};module.angular=angular.module("module.angular",["ngAnimate","ngNewRouter","ngSanitize","ngResource","ngTouch"]);var module=module||{};module.vendor=angular.module("module.vendor",["angular.filter","ngFileUpload","btford.socket-io","ngDialog","angular-multi-check","angular-carousel","ng-context-menu","ig.linkHeaderParser","bgf.paginateAnything","chart.js"]);var module=module||{};module.filters=angular.module("module.filters",["filter.ceil","filter.title","filter.num","filter.bool","filter.removeFiletype","filter.removeDashes","filter.bytes","filter.slice","filter.duration","filter.timeAgo","filter.timestamp"]);var module=module||{};module.templateCache=angular.module("module.templateCache",["templateCache.shared","templateCache.core","templateCache.components"]);var module=module||{};module.services=angular.module("module.services",["service.api","service.api.printerControl","service.auth","service.printer","service.notification","service.socket","service.queue","service.file","service.material","service.sliceprofile","service.printjob","service.device"]);var module=module||{};module.shared=angular.module("module.shared",["shared.avatarImg","shared.printerFan","shared.selectionList","shared.selectionBlock","shared.addNew","shared.commandLine","shared.progressBar","shared.temperatureBar","shared.queueList","shared.queueListItem","shared.printerControls","shared.printerList","shared.printerListItem","shared.notificationList","shared.notificationListItem","shared.loadingScreen","shared.deviceList","shared.deviceListItem","shared.rangeSlider","shared.alertBox","shared.float","shared.printerControlsFlowRate","shared.printerControlsSpeed","shared.printerControlsFan","shared.printerControlsSlider","shared.printerSpeed","shared.statusIcon","shared.deviceStatusIcon","shared.alertBox","shared.libraryDragDrop","shared.fileDroppable","shared.libraryOverlay","shared.sliceDetailsList","shared.dashboardPanel","shared.dashboardSlices","shared.dashboardNews","shared.dashboardQueue","shared.dashboardCommunity","shared.dashboardStorage","shared.dashboardWebcam","shared.dashboardTemperatures","shared.dragWebcam","shared.pagination","shared.focusNext","shared.onEnter"]);var module=module||{};module.components=angular.module("module.components",[]);var module=module||{};module.core=angular.module("module.core",["core.header","core.nav","core.aside"]);function distOrSrcPath(env){return env=="development"?"/src":"/dist"}function dashCase(str){return str.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function httpGetAsync(url,callback){var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(xmlEvent){if(xmlHttp.readyState===4){if(xmlHttp.status===200){callback(xmlHttp.responseText)}else{console.error("Error",xmlHttp.statusText);callback({})}}};xmlHttp.open("GET",url,true);xmlHttp.send(null)}window.ENV=window.ENV||{};window.ENV.name="formide-os";window.ENV.type="development";window.DEBUG=window.ENV.type=="development"||window.ENV.type=="testing"?true:false;window.AUTH=window.AUTH||{};window.PATH=window.PATH||{};window.PATH.root=window.location.protocol+"//"+window.location.hostname+":"+window.location.port;window.PATH.api=window.location.protocol+"//"+window.location.hostname+":1337/api";window.PATH.socket=window.location.protocol+"//"+window.location.hostname+":1337";window.PATH.app=window.PATH.root+"/app";window.PATH.public=window.PATH.root+"/public";window.PATH.assets={javascripts:window.PATH.public+"/assets/javascripts/application.js",stylesheets:window.PATH.public+"/assets/stylesheets/application.css"};window.PATH.tmp=window.PATH.public+"/tmp";window.PATH.partials=window.PATH.app+"/views/partials";window.PATH.modelfiles={uploadPath:"",downloadPath:""};window.PATH.auth={login:"/auth/login",logout:"/auth/logout",session:"/auth/session"};window.PATH.login="/login";function angularLoaded(){if(window.ENV.type=="development"||window.ENV.type=="testing"){console.groupCollapsed("Development- or Testing Mode");if(window.DEBUG){console.log("Debugging Mode: On")}else{console.log("Debugging Mode: Off","color: red;")}console.groupEnd();console.groupCollapsed("App",window.ENV.name);console.log("Environment",window.ENV);console.log("Paths",window.PATH);console.groupEnd()}else if(window.DEBUG){console.log("Debugging Mode: On","color: blue;")}if(window.DEBUG){console.time("Angular loaded")}}(function(){function bool(){return function(s){s.isChecked=!!+s.isChecked;return s}}angular.module("filter.bool",[]).filter("bool",bool)})();(function(){function filter(){return function(bytes,precision){if(isNaN(parseFloat(bytes))||!isFinite(bytes))return"-";if(typeof precision==="undefined")precision=1;var units=["bytes","kB","MB","GB","TB","PB"],number=Math.floor(Math.log(bytes)/Math.log(1024));return(bytes/Math.pow(1024,Math.floor(number))).toFixed(precision)+" "+units[number]}}angular.module("filter.bytes",[]).filter("bytes",filter)})();(function(){function filter(){return function(s){return Math.ceil(s)}}angular.module("filter.ceil",[]).filter("ceil",filter)})();(function(){function duration(){return function(s){return moment.duration(s,"seconds").format("h [hours]",2)}}angular.module("filter.duration",[]).filter("duration",duration)})();(function(){function float(){return function(s){return parseFloat(s)}}angular.module("filter.float",[]).filter("float",float)})();(function(){function num(){return function(s){return parseInt(s,10)}}angular.module("filter.num",[]).filter("num",num)})();(function(){function removeDashes(){return function(s){if(s)return s.replace(/[_-]/g," ")}}angular.module("filter.removeDashes",[]).filter("removeDashes",removeDashes)})();(function(){function removeFiletype(){return function(s){if(s)return s.replace(/(\.[^\/.]+)+$/,"")}}angular.module("filter.removeFiletype",[]).filter("removeFiletype",removeFiletype)})();(function(){function seconds(){return function(s){return moment.duration(s,"milliseconds").format("s [seconds]")}}angular.module("filter.seconds",[]).filter("seconds",seconds)})();(function(){function slice(){return function(arr,start,end){return(arr||[]).slice(start,end)}}angular.module("filter.slice",[]).filter("slice",slice)})();(function(){function smartbytes(){var units=["bytes","KB","MB","GB","TB"];return function(bytes,precision){if(isNaN(parseFloat(bytes))||!isFinite(bytes)){return"?"}var unit=0;while(bytes>=1024){bytes/=1024;unit++}if(bytes%1===0){return bytes+" "+units[unit]}else{return bytes.toFixed(+precision)+" "+units[unit]}}}angular.module("filter.smartbytes",[]).filter("smartbytes",smartbytes)})();(function(){function smartduration(){return function(number){var date=new Date(number*100);var str="";var days=date.getUTCDate()-1;var hours=date.getUTCHours();var minutes=date.getUTCMinutes();var seconds=date.getUTCSeconds();if(days>0){str+=days+" days";str+=hours>0?" and ":" "}if(hours>0){str+=hours+" hours";str+=hours<5&&days<1?" and ":" "}if(hours<5&&days<1&&minutes>0){str+=minutes+" minutes";str+=hours<1&&minutes<5?" and ":" "}if(hours<1&&days<1&&minutes<5){str+=seconds+" seconds"}return str}}angular.module("filter.smartduration",[]).filter("smartduration",smartduration)})();(function(){function tenth(){return function(number){number=number||0;return number>0?Math.round(number/10)*10:0}}angular.module("filter.tenth",[]).filter("tenth",tenth)})();(function(){function timeAgo(){return function(s){return moment(s,[moment.ISO_8601,"x"]).fromNow()}}angular.module("filter.timeAgo",[]).filter("timeAgo",timeAgo)})();(function(){function timestamp(){return function(s){if(s)return Date.parse(s)}}angular.module("filter.timestamp",[]).filter("timestamp",timestamp)})();(function(){function filter(){return function(s){s=s===undefined||s===null?"":s;return s.toString().toLowerCase().split(".stl").join("").split(".").join(" ").split("_").join(" ").replace(/\b([a-z])/g,function(ch){return ch.toUpperCase()})}}angular.module("filter.title",[]).filter("title",filter)})();(function(){function unique(){return function(items,filterOn){if(filterOn===false){return items}if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var hashCheck={},newItems=[];var extractValueToCompare=function(item){if(angular.isObject(item)&&angular.isString(filterOn)){return item[filterOn]}else{return item}};angular.forEach(items,function(item){var valueToCheck,isDuplicate=false;for(var i=0;i<newItems.length;i++){if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=true;break}}if(!isDuplicate){newItems.push(item)}});items=newItems}return items}}angular.module("filter.unique",[]).filter("unique",unique)})();(function(){function parse_link_header(header){if(header.length===0){throw new Error("input must not be of zero length")}var parts=header.split(",");var links={};for(var i=0;i<parts.length;i++){var section=parts[i].split(";");if(section.length!==2){throw new Error("section could not be split on ';'")}var url=section[0].replace(/<(.*)>/,"$1").trim();var name=section[1].replace(/rel="(.*)"/,"$1").trim();links[name]=url}return links}function MainService($http,$location,$resource,$q,$timeout,linkHeaderParser,$notification){function getAccessToken(){var deferred=$q.defer();$timeout(function(){switch(window.ENV.location){case"cloud":var auth_url=window.PATH.root+"/api";break;default:var auth_url=window.PATH.api}if(window.localStorage.getItem("formide.auth:token")&&window.ENV.location=="cloud"){deferred.resolve(window.localStorage.getItem("formide.auth:token"))}else{var request={method:"GET",url:auth_url+"/auth/session",headers:{Authorization:"Bearer "+window.localStorage.getItem("formide.auth:token"),"Content-Type":"application/json;charset=UTF-8"}};$http(request).then(function(result){if(result&&result.status===200&&(result.data.token||result.data.accessToken)){window.localStorage.setItem("formide.auth:token",result.data.token||result.data.accessToken);$timeout(function(){deferred.resolve(result.data.token||result.data.accessToken)})}else{if(window.DEBUG)console.log("No token found, resolving empty string.");$timeout(function(){$location.path("login")},500);deferred.resolve("")}},function(err){if(window.DEBUG)console.log("No token found, resolving empty string. 2",err);$timeout(function(){$location.path("login")},500);deferred.resolve("")})}},100);return deferred.promise}function ApiRequest(method,path,parameters,url){var method=typeof method==="undefined"?"GET":method;var path=typeof path==="undefined"?"":path;var parameters=typeof parameters==="undefined"?{}:parameters;var url=typeof url==="undefined"?window.PATH.api:url;if(window.DEBUG){console.time("Response Time")}var promise=getAccessToken().then(function(access_token){path=interpolateUrl(path,parameters);if(access_token.length>1){var request={method:method.toUpperCase(),url:url+path,headers:{Authorization:"Bearer "+access_token,"Content-Type":"application/json;charset=UTF-8"},data:parameters}}else{var request={method:method.toUpperCase(),url:url+path,headers:{"Content-Type":"application/json;charset=UTF-8"},data:parameters}}if(method.toUpperCase()==="GET"){request.params=parameters}var deferred=$q.defer();$http(request).then(function(response){if(window.DEBUG){if(path==="/proxy"){console.groupCollapsed("API Proxy Request ("+parameters.url+")");console.log("This API Request Uses the Formide Proxy.");console.log("Full Request Path: ",url+parameters.url);console.log("Parameters: ",parameters.data);console.log("Response: %s (%i)",response.statusText,response.status);console.log("Method",response.config.method);console.log("Headers",response.headers());console.log("Data Object %O",response.data);console.timeEnd("Response Time");console.groupEnd()}else{console.groupCollapsed("API Request ("+path+")");console.log("Full Request Path: ",url+path);console.log("Parameters: ",parameters);console.log("Response: %s (%i)",response.statusText,response.status);console.log("Method",response.config.method);console.log("Headers",response.headers());console.log("Data Object %O",response.data);console.timeEnd("Response Time");console.groupEnd()}}var linkHeader;try{if(response.headers()&&response.headers("Link")){console.log(response.headers("Link"));linkHeader=parse_link_header(response.headers("Link"))}}catch(e){console.info("No Link-header Found.",e)}return deferred.resolve(response.data)},function(error){if(window.DEBUG){console.groupCollapsed("Error: API Request (%s)",path);console.log("Full Request Path: ",url+path);console.log("Parameters: ",parameters);console.error("Error: %s (%i)",error.statusText,error.status);console.error(error.data);console.timeEnd("Response Time");console.groupEnd()}if(error.status==401){$timeout(function(){$location.path("login")},500)}return deferred.reject(error.data)});return deferred.promise},function(error){if(window.DEBUG){console.timeEnd("Response Time");console.error("Error: %s",error)}return error});return promise}function interpolateUrl(url,params){url=url||"";params=params||{};url=url.replace(/(\(\s*|\s*\)|\s*\|\s*)/g,"");url=url.replace(/:([a-z_]\w*)/gi,function($0,label){return popFirstKey(params,label)||""});url=url.replace(/(^|[^:])[\/]{2,}/g,"$1/");url=url.replace(/\/+$/i,"");return url}function popFirstKey(object1,object2,objectN,key){var objects=Array.prototype.slice.call(arguments);var key=objects.pop();var object=null;while(object=objects.shift()){if(object.hasOwnProperty(key)){return object[key]}}}function ApiProxyRequest(method,path,parameters){parameters=typeof parameters==="undefined"?{}:parameters;return ApiRequest("POST","/proxy",{method:method,url:path,data:parameters,token:window.localStorage.getItem("formide.auth:token")})}function ApiResources(path){var parameters=parameters||{};var resources={};resources.query=function(parameters){return ApiRequest("GET",path,parameters)};resources.get=function(parameters){return ApiRequest("GET",path,parameters)};resources.post=function(parameters){return ApiRequest("POST",path,parameters)};resources.create=function(parameters){return ApiRequest("POST",path,parameters)};resources.update=function(parameters){return ApiRequest("PUT",path,parameters)};resources.put=function(parameters){return ApiRequest("PUT",path,parameters)};resources.delete=function(parameters){return ApiRequest("DELETE",path,parameters)};return resources}var factory={};factory.getAccessToken=getAccessToken;factory.req=function(method,path,parameters,url){return ApiRequest(method,path,parameters,url)},factory.get=function(path,parameters,url){return ApiRequest("GET",path,parameters,url)},factory.post=function(path,parameters,url){return ApiRequest("POST",path,parameters,url)},factory.put=function(path,parameters,url){return ApiRequest("PUT",path,parameters,url)},factory.delete=function(path,parameters,url){return ApiRequest("DELETE",path,parameters,url)};var proxy={};proxy.req=function(method,path,parameters,url){return ApiProxyRequest(method,path,parameters)},proxy.get=function(path,parameters,url){return ApiProxyRequest("GET",path,parameters)},proxy.post=function(path,parameters,url){return ApiProxyRequest("POST",path,parameters)},proxy.put=function(path,parameters,url){return ApiProxyRequest("PUT",path,parameters,url)},proxy.delete=function(path,parameters,url){return ApiProxyRequest("DELETE",path,parameters,url)};factory.proxy=proxy;factory.sliceprofiles=ApiResources("/db/sliceprofiles/(:id)");factory.printers=ApiResources("/db/printers/(:id)");factory.materials=ApiResources("/db/materials/(:id)");factory.printjobs=ApiResources("/db/printjobs/(:id)");factory.files=ApiResources("/db/files/(:id)");factory.users=ApiResources("/auth/users/(:id)");factory.queue=ApiResources("/db/queue/(:id)");factory.resource=function(path,paramDefaults,actions,url){var token=window.localStorage.getItem("formide.auth:token");if(token!==null&&token!=="undefined"&&token.length>0){var MY_ACTIONS={get:{method:"GET",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"}},save:{method:"POST",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"}},query:{method:"GET",isArray:true,headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"
}},remove:{method:"DELETE",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"}},"delete":{method:"DELETE",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"}},update:{method:"PUT",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json;charset=UTF-8"}}};window.PATH.api=window.PATH.api||{};var path=typeof path==="undefined"?"":path;var actions=angular.extend({},MY_ACTIONS,actions);var paramDefaults=typeof paramDefaults==="undefined"?null:paramDefaults;var url=typeof url==="undefined"?window.PATH.api+path:url+path;if(window.DEBUG){console.groupCollapsed("Resource Request ("+path+")");console.log("Full Request Path: ",url);console.log("Param Defaults: ",paramDefaults);console.groupEnd()}return $resource(url,paramDefaults,actions)}else{getAccessToken().then(function(access_token){if(access_token.length<1){$timeout(function(){$location.path("login")},500)}},function(error){$timeout(function(){$location.path("login")},500)})}};return factory}angular.module("service.api",[]).factory("$api",["$http","$location","$resource","$q","$timeout","linkHeaderParser","$notification",MainService]).config(function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"})})();(function(){function MainRun($api,$rootScope,$router){}function MainService($http,$api,$q,$timeout,$router,$location,$timeout,$rootScope){var factory={};window.AUTH=window.AUTH||{};window.PATH.login=window.PATH.login||window.PATH.root+"/login";window.PATH.root=window.PATH.root||window.location.protocol+"//"+window.location.hostname+":"+window.location.port;switch(window.ENV.location){case"cloud":var auth_url=window.PATH.root+"/api";break;default:var auth_url=window.PATH.api}factory.login=function(email,password){var deferred=$q.defer();$api.post("/auth/login",{email:email,password:password},auth_url).then(function(response){window.AUTH.sessionid=response;if(window.DEBUG){console.groupCollapsed("Secure Route: API Authentication");console.log("Session ID: ",window.AUTH.sessionid);console.groupEnd()}$rootScope.$emit("auth:loggedin",true);deferred.resolve(response)},function(error){deferred.reject(error)});return deferred.promise};factory.getLoginURL=function(){return $api.get("/auth/login",{},auth_url).then(function(response){return response})};factory.logout=function(){var promise=$api.get("/auth/logout",{},auth_url).then(function(response){window.localStorage.removeItem("formide.auth:token");$rootScope.$emit("auth:loggedout",true)});return promise};factory.redirectToLogin=function(){$timeout(function(){$location.path("login")},500)};factory.checkLoggedin=function(){var deferred=$q.defer();$api.getAccessToken().then(function(access_token){if(access_token.length<1){deferred.reject("Not loggedin.");factory.redirectToLogin()}else{deferred.resolve(access_token)}},function(error){if(window.DEBUG){console.error("Error: %s","API Request");console.error(error)}deferred.reject(error);factory.redirectToLogin()});return deferred.promise};function changeAuth(loggedIn){factory.user.isAuthenticated=loggedIn}return factory}angular.module("service.auth",[]).run(["$api","$rootScope","$router",MainRun]).factory("$auth",["$http","$api","$q","$timeout","$router","$location","$timeout","$rootScope",MainService])})();(function(){function MainService($api){var factory={};window.ENV.location=window.ENV.location||"local";try{switch(window.ENV.location){case"cloud":var resource=$api.resource("/devices/:id",{id:"@id"});factory.endpoint=resource;factory.resource=resource.query();break;default:factory.resource=[]}}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.device",[]).factory("Device",["$api",MainService])})();(function(){function MainService($api,$q,$filter){var factory={resource:[],$resolved:false};var limit=24;try{var userSettings={};if(window.localStorage.getItem("formide.settings:files")){userSettings=JSON.parse(window.localStorage.getItem("formide.settings:files"))}var sort=userSettings.filesSortBy||"createdAt";var sortOrder=userSettings.sortOrder||"-";var resource=$api.resource("/db/files/?sort="+sortOrder+sort+"&limit="+limit,{id:"@id"});factory.endpoint=resource;factory.resource=resource.query()}catch(err){if(window.DEBUG)console.error(err)}function files_load(params,cb){params=params||{};var filetype=params.filetype;var prettyname=params.prettyname;var parent=params.parent;var sort=params.sort;var sortOrder=params.sortOrder||"-";var resultsPage=params.resultsPage;var query="/db/files?";var queryParams={};var i=0;if(filetype){query=query+"filter[filetype]=:filetypeValue&type[filetype]=regexi";queryParams.filetypeValue=filetype;i++}if(prettyname){if(i>0)query=query+"&";query=query+"filter[prettyname]=:prettynameValue&type[prettyname]=regexi";queryParams.prettynameValue=prettyname;i++}if(parent){if(i>0)query=query+"&";query=query+"filter[parent]=:parentValue";queryParams.parentValue=parent;i++}if(sort){if(i>0)query=query+"&";query=query+"sort="+sortOrder+sort;i++}if(limit){if(i>0)query=query+"&";query=query+"limit="+limit}if(resultsPage){query=query+"&skip="+resultsPage*limit}try{var resource=$api.resource(query,queryParams);factory.endpoint=resource;data=resource.query(function(){if(resultsPage){for(var i=0;i<data.length;i++){factory.resource.push(data[i])}}else{factory.resource=data}if(typeof cb=="function"){cb(data.length)}factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory})}catch(err){if(window.DEBUG)console.error(err);factory.resource=[];if(typeof cb=="function"){cb(0)}factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}}var file_single=function(params,cb){var resource=$api.resource("/db/files/:id",{id:"@id"});factory.endpoint=resource;var promise=$q(function(resolve,reject){try{factory.endpoint.get({id:params.id},function(response){resolve(response);if(typeof cb=="function"){cb(response)}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}});return promise};var file_remove=function(params,cb){var id=params.file.id;if(params.newParent==0){var resource=$api.resource("/db/files/:id?deleteChildren=:deleteChildren",{id:"@id",deleteChildren:params.deleteChildren})}else{var resource=$api.resource("/db/files/:id?deleteChildren=:deleteChildren&newParent=:newParent",{id:"@id",deleteChildren:params.deleteChildren,newParent:params.newParent})}factory.endpoint=resource;try{factory.endpoint.delete({id:id},function(response){for(var i in factory.resource){if(factory.resource[i].id===id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var file_update=function(file,cb){var resource=$api.resource("/db/files/:id",{id:"@id"});factory.endpoint=resource;try{factory.endpoint.update(file,function(response){if(typeof cb=="function"){cb()}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var file_add=function(file,cb){factory.resource.unshift(file);if(typeof cb=="function"){cb()}};var file_move=function(file,cb){var resource=$api.resource("/db/files/:id",{id:"@id"});factory.endpoint=resource;try{factory.endpoint.update(file,function(response){for(var i in factory.resource){if(factory.resource[i].id===file.id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var folder_create=function(params,cb){var filename=params.filename;var parent=params.parent;var resource=$api.resource("/db/files/:id",{id:"@id"});factory.endpoint=resource;try{factory.endpoint.save({filename:filename,parent:parent},function(response){factory.resource.unshift(response.data);if(typeof cb=="function"){cb(params.files,response.data)}})}catch(e){console.error(e)}};var init=function(){factory.resource.$load=files_load;factory.resource.$update=file_update;factory.resource.$move=file_move;factory.resource.$remove=file_remove;factory.resource.$single=file_single;factory.resource.$add=file_add;factory.resource.$create=folder_create};factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.file",[]).factory("File",["$api","$q","$filter",MainService])})();(function(){function MainService($api,$q){var factory={};try{var resource=$api.resource("/db/materials/:id",{id:"@id"});factory.endpoint=resource;factory.resource=resource.query()}catch(err){if(window.DEBUG)console.error(err)}var materials_filter=function(params,cb){params=params||{};var materials;var sort=params.sort;var sortOrder=params.sortOrder||"-";var limit=params.limit;var resultsPage=params.resultsPage;var query="/db/materials";var queryParams={};var i=0;if(sort){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"sort="+sortOrder+sort;i++}if(limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"limit="+limit;i++}if(resultsPage&&limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"skip="+resultsPage*limit}try{var resource=$api.resource(query,queryParams);materials=resource.query(function(){cb()})}catch(err){if(window.DEBUG)console.error(err);materials=[]}return materials};var materials_save=function(material,cb){try{factory.endpoint.save({},material,function(response){factory.resource.unshift(response.data);if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var materials_remove=function(params,cb){var params=params||{};var id=params.id;try{factory.endpoint.delete({id:id},function(response){for(var i in factory.resource){if(factory.resource[i].id===id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var materials_update=function(material,cb){try{factory.endpoint.update({id:material.id},material,function(response){for(var i in factory.resource){if(factory.resource[i].id==material.id){factory.resource[i]=angular.extend(factory.resource[i],material);break}}if(typeof cb=="function"){cb()}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var init=function(){factory.resource.$filter=materials_filter;factory.resource.$save=materials_save;factory.resource.$remove=materials_remove;factory.resource.$update=materials_update};factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.material",[]).factory("Material",["$api",MainService])})();(function(){function MainService($rootScope,$timeout){var factory={};factory.list=[];factory.active=[];factory.getNotifications=function(){if(window.localStorage.getItem("formide.notifications:list")){return JSON.parse(window.localStorage.getItem("formide.notifications:list"))}else{return[]}};factory.init=function(){factory.list=factory.getNotifications()};factory.addNotification=function(data){var description=data.message||"";var channel=data.channel||"system";var duration=data.duration||4e3;var actions=data.actions||{};var popup=data.popup||false;var title=data.title||"";var save=data.save||false;var link=data.urlLink;console.log("save",save);var type;switch(data.type){case"log":type="log";break;case"error":type="error";break;case"warn":type="warn";break;case"info":type="info";break;case"success":type="success";break;default:if(window.DEBUG)console.info('Unknown notification type, used "log".');type="log"}var notifications=factory.getNotifications()||[];if(title){var found=false;var foundId=null;var timestamp=Date.now();for(var i=0;i<notifications.length;i++){if(notifications[i].title===title&&notifications[i].description===description){if(timestamp-parseInt(notifications[i].updatedAt)<60*60*1e3){found=true;foundId=i;break}}}if(found){notifications[foundId].count++;notifications[foundId].updatedAt=timestamp}else if(save){notifications.unshift({id:factory.list.length+1,title:title,description:description,type:type,count:1,channel:channel,createdAt:timestamp,updatedAt:timestamp,save:save,link:link});if(notifications.length>10){notifications.pop()}}if(save){window.localStorage.setItem("formide.notifications:list",JSON.stringify(notifications))}factory.showNotification(title,description,type,duration,actions,popup,link);factory.list=notifications;$timeout(function(){$rootScope.$emit("notification.saved",true)},50)}};factory.showNotification=function(title,description,type,duration,actions,popup,link){var id=Math.floor(Math.random()*9999);var notification={id:id,title:title,message:description,type:type,actions:actions,popup:popup,link:link};factory.active.push(notification);if(duration>0){$timeout(function(){factory.removeNotification(id)},duration)}};factory.removeNotification=function(id){angular.forEach(factory.active,function(notification,key){if(notification.id===id){factory.active.splice(key,1)}});return true};factory.clearSingle=function(index){for(var i in factory.list){if(factory.list[i].id==parseInt(index)){factory.list.splice(i,1);window.localStorage.setItem("formide.notifications:list",JSON.stringify(factory.list));break}}};factory.clearAll=function(){window.localStorage.setItem("formide.notifications:list",JSON.stringify([]));factory.list=[]};return factory}angular.module("service.notification",[]).factory("$notification",["$rootScope","$timeout",MainService])})();(function(){function MainService($api,Printer){var factory={};window.ENV.location=window.ENV.location||"local";function port(port){return port.split("/")[2]}function emit(channel,data){if(window.DEBUG){console.groupCollapsed("Printer Control (%s)",data.method);console.log("Channel: ",channel)}if(data==undefined||data==null){console.error("Data not defined.")}else{if(data.port==undefined){console.error("No port selected.")}else{var urlParams=[];for(key in data.parameters){urlParams.push(key+"="+data.parameters[key])}switch(window.ENV.location){case"cloud":var api_url="/devices/"+Printer.$active.device.id+"/api/printer/"+data.port+"/"+data.method;break;default:var api_url="/printer/"+data.port+"/"+data.method}if(window.DEBUG)console.log("Url: ",api_url);$api.get(api_url,data.parameters).then(function(response){if(window.DEBUG)console.log("Data: ",data)})}}if(window.DEBUG){console.groupEnd()}return true}function post(channel,data){if(window.DEBUG){console.groupCollapsed("Printer Control (%s)",data.method);console.log("Channel: ",channel)}if(data==undefined||data==null){console.error("Data not defined.")}else{if(data.port==undefined){console.error("No port selected.")}else{switch(window.ENV.location){case"cloud":var api_url="/devices/"+Printer.$active.device.id+"/api/printer/"+data.port+"/"+data.method;break;default:var api_url="/printer/"+data.port+"/"+data.method}if(window.DEBUG)console.log("Url: ",api_url);$api.post(api_url,data.parameters).then(function(response){if(window.DEBUG)console.log("Data: ",data)})}}if(window.DEBUG){console.groupEnd()}return true}factory.gcode=function(gcode){return post("command",{method:"gcode",parameters:{command:gcode},port:port(Printer.$active.port)})};factory.tune=function(gcode){return post("command",{method:"tune",parameters:{command:gcode},port:port(Printer.$active.port)})};factory.jog=function(axis,distance){return emit("command",{method:"jog",parameters:{axis:axis,dist:parseFloat(distance)},port:port(Printer.$active.port)})};factory.move=function(axis,distance){return this.jog(axis,distance)};factory.bed={temperature:function(temperature){return emit("command",{method:"temp_bed",parameters:{temp:parseInt(temperature)},port:port(Printer.$active.port)})}};factory.extruder=function(id){return{temperature:function(temperature){return emit("command",{method:"temp_extruder",parameters:{temp:parseInt(temperature),extnr:id},port:port(Printer.$active.port)})},extrude:function(distance){return emit("command",{method:"extrude",parameters:{dist:parseFloat(distance),extnr:id},port:port(Printer.$active.port)})},retract:function(distance){return emit("command",{method:"retract",parameters:{dist:parseFloat(distance),extnr:id},port:port(Printer.$active.port)})}}};factory.home={all:function(){return emit("command",{method:"home",port:port(Printer.$active.port)})},x:function(){return emit("command",{method:"home_x",port:port(Printer.$active.port)})},y:function(){return emit("command",{method:"home_y",port:port(Printer.$active.port)})},z:function(){return emit("command",{method:"home_z",port:port(Printer.$active.port)})}};factory.park=function(){return emit("command",{method:"park",port:port(Printer.$active.port)})};factory.start=function(id,gcode){return emit("command",{method:"start",parameters:{queueItem:id},port:port(Printer.$active.port)})};factory.pause=function(){return emit("command",{method:"pause",port:port(Printer.$active.port)})};factory.resume=function(){return emit("command",{method:"resume",port:port(Printer.$active.port)})};factory.stop=function(){return emit("command",{method:"stop",port:port(Printer.$active.port)})};factory.stopAll=function(){return emit("command",{method:"stop_all",port:port(Printer.$active.port)})};factory.autolevel=function(){return emit("command",{method:"autolevel",port:port(port)})};factory.reconnect=function(){return emit("command",{method:"reconnect",port:port(Printer.$active.port)})};factory.LCDMessage=function(message){return emit("command",{method:"lcd_message",parameters:{message:message},port:port(port)})};return factory}angular.module("service.api.printerControl",[]).factory("printerCtrl",["$api","Printer",MainService])})();(function(){function MainService($socket,$q,$api,$rootScope,$timeout,$filter,Device){var factory={resource:[],$active:{$resolved:false}};function _debounce(callback,interval){var timeout=null;return function(){$timeout.cancel(timeout);var args=arguments;timeout=$timeout(function(){callback.apply(this,args)},interval)}}window.ENV.location=window.ENV.location||"local";try{var resource=$api.resource("/db/printers/:id",{id:"@id"});factory.endpoint=resource;factory.resource=resource.query(function(){configurePrinters(factory.resource,function(){factory.$setActive()})})}catch(err){if(window.DEBUG)console.error(err)}function configurePrinters(printers,cb){switch(window.ENV.location){case"cloud":Device.resource.$promise.then(function(devices){for(var i in printers){printers[i].active=printers[i].active||false;printers[i].startGcode=printers[i].startGcode||[];printers[i].endGcode=printers[i].endGcode||[];printers[i].customCommands=printers[i].customCommands||[];printers[i].deviceName=null;printers[i].deviceStatus=null;for(var j in devices){if(printers[i].device){try{if(printers[i].device.id==devices[j].id){printers[i].deviceName=devices[j].name;printers[i].deviceStatus=devices[j].status;break}}catch(e){console.error(e)}}}}if(typeof cb=="function"){cb()}});break;default:for(var i in printers){printers[i].active=printers[i].active||false;printers[i].deviceName="Local device";printers[i].deviceStatus="online";printers[i].startGcode=printers[i].startGcode||[];printers[i].endGcode=printers[i].endGcode||[]}if(typeof cb=="function"){cb()}}}function updateResource(resource,type){var resource=resource||{};factory.resource.$promise.then(function(result){angular.forEach(factory.resource,function(printer,key){if(typeof printer.device==="string"){printer.device={id:printer.device,deviceStatus:"online",deviceType:"the_element"}}var device=angular.copy(printer.device);printer.device=printer.device||{id:"local",deviceStatus:"offline",deviceType:"the_element"};resource.device=resource.device||"local";try{if(type=="slicer.finished"){factory.endpoint.get({id:printer.id},function(response){angular.merge(printer,response)});$rootScope.$emit("formide.printer:updated")}else if(printer.port===resource.port&&printer.device.id.toLowerCase()===resource.device.toLowerCase()){switch(type){case"printer.status":printer.active=true;printer.deviceStatus="online";angular.merge(printer,resource);printer.device=device;var arr=printer.timeStarted.split(/-|\.|:/);printer.timePassed=moment.duration(Date.now()-new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]))._milliseconds;break;case"printer.connected":printer.status="connecting";printer.active=true;printer.deviceStatus="online";angular.merge(printer,resource);printer.device=device;$rootScope.$emit("formide.printer:updated",factory.$active);if(factory.$active.port==printer.port&&factory.$active.device.id==printer.device.id){$rootScope.$broadcast("formide.activePrinter:updated",factory.$active)}break;case"printer.started":factory.endpoint.get({id:printer.id},function(response){angular.merge(printer,response);printer.device=device});break;case"printer.paused":break;case"printer.resumed":break;case"printer.stopped":factory.endpoint.get({id:printer.id},function(response){angular.merge(printer,response);printer.device=device;if(factory.$active.port==printer.port&&factory.$active.device.id==printer.device.id){$rootScope.$broadcast("formide.activePrinter:updated",factory.$active)}});break;case"printer.finished":break;case"printer.disconnected":printer.status="offline";printer.active=false;factory.endpoint.get({id:printer.id},function(response){angular.merge(printer,response);printer.device=device;$rootScope.$emit("formide.printer:updated",factory.$active);if(factory.$active.port==printer.port&&factory.$active.device.id==printer.device.id){$rootScope.$broadcast("formide.activePrinter:updated",factory.$active)}});break;default:if(window.DEBUG)console.error("Unknown printer status.")}}else if(printer.device.id===resource.device){switch(type){case"device.connected":printer.deviceStatus="online";$rootScope.$emit("formide.printer:updated",factory.$active);if(factory.$active.device.id==printer.device.id){$rootScope.$broadcast("formide.activePrinter:updated",factory.$active)}break;case"device.disconnected":printer.status="offline";printer.active=false;printer.deviceStatus="offline";$rootScope.$emit("formide.printer:updated",factory.$active);if(factory.$active.device.id==printer.device.id){$rootScope.$broadcast("formide.activePrinter:updated",factory.$active)}break;default:}}}catch(e){}factory.resource[key]=printer})})}$socket.socket.on("printer.status",function(resource){updateResource(resource,"printer.status");saveTemperatures(resource)});$socket.socket.on("printer.connected",function(resource){updateResource(resource,"printer.connected")});$socket.socket.on("printer.disconnected",function(resource){updateResource(resource,"printer.disconnected")});$socket.socket.on("printer.started",function(resource){updateResource(resource,"printer.started")});$socket.socket.on("printer.paused",function(resource){updateResource(resource,"printer.paused")});$socket.socket.on("printer.resumed",function(resource){updateResource(resource,"printer.resumed")});$socket.socket.on("printer.stopped",function(resource){updateResource(resource,"printer.stopped")});$socket.socket.on("printer.finished",function(resource){updateResource(resource,"printer.finished")});$socket.socket.on("device.connected",function(resource){updateResource(resource,"device.connected")});$socket.socket.on("device.disconnected",function(resource){updateResource(resource,"device.disconnected")});$socket.socket.on("slicer.finished",function(data){updateResource(resource,"slicer.finished")});$rootScope.$on("formide.device:removed",function(event,deviceId){for(var i in factory.resource){if(factory.resource[i].device){try{if(factory.resource[i].device.id==deviceId){factory.resource[i].deviceName=null;factory.resource[i].deviceStatus=null}}catch(e){console.error(e)}}}$rootScope.$emit("formide.device:updated",true);$rootScope.$emit("formide.printer:updated",true)});$rootScope.$on("formide.device:added",function(event,deviceId,deviceName){for(var i in factory.resource){if(factory.resource[i].device){try{if(factory.resource[i].device.id==deviceId){factory.resource[i].deviceName=deviceName;factory.resource[i].deviceStatus="online"}}catch(e){console.error(e)}}}$rootScope.$emit("formide.device:updated",true);$rootScope.$emit("formide.printer:updated",true)});function saveTemperatures(resource){$timeout(function(){if(factory.$active&&factory.$active.active&&factory.$active.port==resource.port&&factory.$active.device.id==resource.device&&(resource.status!=="offline"||resource.status!=="connecting")){var temps={};var time=(new Date).getTime();temps.time=time;if(factory.$active.bed.heated){temps.bed={};temps.bed.temp=resource.bed.temp;temps.bed.targetTemp=resource.bed.targetTemp}temps.extruders=[];for(var i=0;i<factory.$active.extruders.length;i++){temps.extruders.push({temp:resource.extruders[i].temp,targetTemp:resource.extruders[i].targetTemp})}factory.$active.statusTemperatures.push(temps);if(factory.$active.statusTemperatures.length>30)factory.$active.statusTemperatures.splice(0,1)}})}$rootScope.$on("formide.activePrinter:updated",function(event,resource){factory.$active.statusTemperatures=[]});var printer_filter=function(params,cb){params=params||{};var printers;var sort=params.sort;var sortOrder=params.sortOrder||"-";var limit=params.limit;var resultsPage=params.resultsPage;var query="/db/printers";var queryParams={};var i=0;if(sort){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"sort="+sortOrder+sort;i++}if(limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"limit="+limit;i++}if(resultsPage&&limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"skip="+resultsPage*limit}try{var resource=$api.resource(query,queryParams);printers=resource.query(function(){configurePrinters(printers,function(){if(typeof cb=="function"){cb()}})})}catch(err){if(window.DEBUG)console.error(err);printers=[]}return printers};factory.$setActive=function(params,cb){var params=params||{};var promise=$q(function(resolve,reject){if(typeof params.id==="undefined"){if(window.localStorage.getItem("formide.printer:selected.id")!==null){params.id=window.localStorage.getItem("formide.printer:selected.id")}else{var printersFiltered=factory.resource.filter(function(value){return value.port&&value.device});if(printersFiltered[0]){factory.$setActive(printersFiltered[0])}else{if(window.DEBUG)console.warn("Could not set an active printer!");reject("Could not set an active printer!")}}}else{window.localStorage.setItem("formide.printer:selected.id",params.id)}if(typeof params.id!=="undefined"){factory.$active.status=factory.$active.status||"offline";if(factory.$active.id!==params.id){factory.$active.$resolved=false;var deviceSelected=false;for(var i in factory.resource){if(factory.resource[i].id==params.id){$timeout(function(){factory.resource[i].$resolved=true},1e3);factory.resource[i].selected=true;factory.$active=factory.resource[i];factory.$active.statusTemperatures=[];try{window.localStorage.setItem("formide.printer:selected.port",factory.resource[i].port.split("/")[2]||"")}catch(e){}$rootScope.$emit("formide.printer:updated",factory.$active);$rootScope.$broadcast("formide.activePrinter:updated",factory.$active);$rootScope.$broadcast("formide.activePrinter:changed",factory.$active);deviceSelected=true}else{factory.resource[i].selected=false}}if(!deviceSelected){var printersFiltered=factory.resource.filter(function(value){return value.port&&value.device});if(printersFiltered[0]){factory.$setActive(printersFiltered[0])}else{if(window.DEBUG)console.warn("Could not set an active printer!");reject("Could not set an active printer!")}}}}});return promise};var printer_single=function(params,cb){try{factory.endpoint.get({id:params.id},function(response){if(typeof cb=="function"){cb(response)}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var printer_remove=function(params,cb){var params=params||{};var id=params.id;try{factory.endpoint.delete({id:id},function(response){for(var i in factory.resource){if(factory.resource[i].id===id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var printer_update=function(printer,cb){try{factory.endpoint.update({id:printer.id},printer,function(response){for(var i in factory.resource){if(factory.resource[i].id==printer.id){factory.resource[i]=angular.extend(factory.resource[i],response.printer);break}}configurePrinters(factory.resource);if(typeof cb=="function"){cb()}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var printer_save=function(printer,cb){try{factory.endpoint.save({},printer,function(response){var printers=[response.printer];configurePrinters(printers,function(){for(var i=0;i<printers.length;i++){factory.resource.unshift(printers[i])}factory.$setActive()});if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var init=function(){factory.resource.$filter=printer_filter;factory.resource.$remove=printer_remove;factory.resource.$single=printer_single;factory.resource.$update=printer_update;factory.resource.$save=printer_save};factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.printer",[]).factory("Printer",["$socket","$q","$api","$rootScope","$timeout","$filter","Device",MainService])})();(function(){function MainService($api,$rootScope){window.ENV.location=window.ENV.location||"local";var factory={resource:[]};var path="/db/printjobs/:id";try{var resource=$api.resource(path,{id:"@id"});factory.endpoint=resource;factory.resource=resource.query()}catch(err){if(window.DEBUG)console.error(err)}var slices_single=function(params,cb){var resource=$api.resource("/db/printjobs/:id",{id:"@id"});factory.endpoint=resource;try{factory.resource=factory.endpoint.get({id:params.id},function(response){if(typeof cb=="function"){cb(response)}})}catch(e){if(window.DEBUG)console.error(e)}};function slices_load(params,cb){params=params||{};var sort=params.sort;var sortOrder=params.sortOrder||"-";var limit=params.limit;var printerFilter=params.printerFilter;var name=params.name;var resultsPage=params.resultsPage;var query="/db/printjobs/slices";var queryParams={};var i=0;if(printerFilter){query=query+"?filter[printer]=:printerFilter";queryParams.printerFilter=printerFilter;i++}if(name){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"filter[name]=:name&type[name]=regexi";queryParams.name=name;i++}if(sort){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"sort="+sortOrder+sort;i++}if(limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"limit="+limit;i++}if(resultsPage&&limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"skip="+resultsPage*limit}try{var resource=$api.resource(query,queryParams);factory.endpoint=resource;factory.resource=resource.query(function(){if(typeof cb=="function"){cb()}})}catch(err){if(window.DEBUG)console.error(err);factory.resource=[];if(typeof cb=="function"){cb()}}factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}function slices_remove(params,cb){var id=params.id;factory.endpoint=resource;try{factory.endpoint.delete({id:id},function(response){for(var i in factory.resource){if(factory.resource[i].id===id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}}var init=function(){factory.resource.$slices=slices_load;factory.resource.$remove=slices_remove;factory.resource.$single=slices_single};factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.printjob",[]).factory("Printjob",["$api","$rootScope",MainService])})();(function(){function MainService($socket,$rootScope,$q,$api,$timeout,Printer){window.ENV.location=window.ENV.location||"local";var factory={resource:[],$resolved:false};function updateQueue(event,data){factory.$resolved=false;$timeout(function(){data.device=data.device||{id:"local",deviceType:"the_element"};switch(Printer.$active.deviceStatus){case"online":factory.$online=true;try{var id=angular.copy(data.device.id);var port=angular.copy(data.port);if(typeof id==="string"&&typeof port==="string"){factory.resource=resource.query({device:id,port:port},function(){factory.$resolved=true})}}catch(e){console.log("Could not load queue",e)}break;default:factory.$online=false}factory.resource.$remove=function(params){var params=params||{};try{for(var i=0;i<factory.resource.length;i++){var item=factory.resource[i];
var remove=true;for(var key in params)if(item[key]!==params[key])remove=false;if(remove){(function(){var removeIndex=i;try{factory.endpoint.delete({device:data.device.id,port:data.port,id:item.id},function(){factory.resource.splice(removeIndex,1)})}catch(e){console.warn("Could not remove item!",e)}})()}}}catch(e){console.error(e)}}})}var path=window.ENV.location=="cloud"?"/devices/:device/api/db/queue/:id":"/db/queue/:id";try{var resource=$api.resource(path,{device:"@device",port:"@port"});factory.endpoint=resource;updateQueue({},Printer.$active)}catch(err){if(window.DEBUG)console.error(err)}factory.$addToQueue=function(file,printjob){if(file&&file.printJobs){printjob=printjob||file.printJobs[0]||{}}else{printjob=printjob||{}}function port(port){return port.split("/")[2]}var promise=$q(function(resolve,reject){switch(window.ENV.location){case"cloud":Printer.endpoint.get({id:Printer.$active.id},function(printer_response){try{switch(file.filetype){case"text/gcode":if(file.printJobs&&file.printJobs[0]){$api.post("/db/queue",{printJob:file.printJobs[0].id,device:printer_response.device.id,port:Printer.$active.port}).then(function(queueResponse){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(queueResponse)})}else{$api.post("/db/printjobs/",{file:file.id}).then(function(printJobResponse){$api.post("/db/queue",{printJob:printJobResponse.data.id,device:printer_response.device.id,port:Printer.$active.port}).then(function(queueResponse){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(queueResponse)})})}break;case"text/stl":$api.post("/db/queue/",{printJob:printjob.id,device:printer_response.device.id,port:Printer.$active.port}).then(function(response){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(response)});break;default:reject("Unknown filetype")}}catch(e){if(window.DEBUG)console.error(e);reject(e)}});break;default:try{switch(file.filetype){case"text/gcode":if(file.printJobs&&file.printJobs[0]){$api.post("/db/queue",{printJob:file.printJobs[0].id,device:"local",port:Printer.$active.port}).then(function(queueResponse){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(queueResponse)})}else{$api.post("/db/printjobs/",{file:file.id}).then(function(printJobResponse){$api.post("/db/queue",{printJob:printJobResponse.data.id,device:"local",port:Printer.$active.port}).then(function(queueResponse){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(queueResponse)})})}break;case"text/stl":$api.post("/db/queue/",{printJob:printjob.id,device:"local",port:Printer.$active.port}).then(function(response){updateQueue({},Printer.$active);$rootScope.$emit("queue:added");resolve(response)});break;default:reject("Unknown filetype")}}catch(e){if(window.DEBUG)console.error(e);reject(e)}}});return promise};$socket.socket.on("device.connected",function(resource){factory.$online=true});$socket.socket.on("device.disconnected",function(resource){factory.$online=false});$socket.socket.on("queueItem.downloaded",function(resource){updateQueue({},Printer.$active)});$socket.socket.on("queueItem.delete",function(resource){updateQueue({},Printer.$active)});$socket.socket.on("printer.finished",function(data){updateQueue({},Printer.$active)});$rootScope.$on("formide.activePrinter:updated",function(event,data){updateQueue(event,data)});$rootScope.$on("queue:added",function(){updateQueue({},Printer.$active)});return factory}angular.module("service.queue",[]).factory("Queue",["$socket","$rootScope","$q","$api","$timeout","Printer",MainService])})();(function(){function MainService($rootScope,$timeout){var factory={};factory.setSidebar=function(controller,template,width){$rootScope.sidebar={width:width||360,controller:controller||"SidebarController",template:template||"sidebar/componentTemplate.html"}};return factory}angular.module("service.sidebar",[]).factory("$sidebar",["$rootScope","$timeout",MainService])})();(function(){function MainService($api,$q){var factory={};try{var resource=$api.resource("/db/sliceprofiles/:id",{id:"@id"});factory.endpoint=resource;factory.resource=resource.query()}catch(err){if(window.DEBUG)console.error(err)}var sliceprofiles_filter=function(params,cb){params=params||{};var sliceprofiles;var sort=params.sort;var sortOrder=params.sortOrder||"-";var limit=params.limit;var resultsPage=params.resultsPage;var query="/db/sliceprofiles";var queryParams={};var i=0;if(sort){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"sort="+sortOrder+sort;i++}if(limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"limit="+limit;i++}if(resultsPage&&limit){if(i>0){query=query+"&"}else{query=query+"?"}query=query+"skip="+resultsPage*limit}try{var resource=$api.resource(query,queryParams);sliceprofiles=resource.query(function(){cb()})}catch(err){if(window.DEBUG)console.error(err);sliceprofiles=[]}return sliceprofiles};var sliceprofiles_save=function(sliceprofile,cb){try{factory.endpoint.save({},sliceprofile,function(response){factory.resource.unshift(response.data);if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var sliceprofiles_remove=function(params,cb){var params=params||{};var id=params.id;try{factory.endpoint.delete({id:id},function(response){for(var i in factory.resource){if(factory.resource[i].id===id){factory.resource.splice(i,1);break}}if(typeof cb=="function"){cb()}})}catch(e){console.error(e)}};var sliceprofiles_update=function(sliceprofile,cb){try{factory.endpoint.update({id:sliceprofile.id},sliceprofile,function(response){for(var i in factory.resource){if(factory.resource[i].id==sliceprofile.id){factory.resource[i]=angular.extend(factory.resource[i],sliceprofile);break}}if(typeof cb=="function"){cb()}})}catch(e){if(window.DEBUG)console.error(e);reject(e)}};var init=function(){factory.resource.$filter=sliceprofiles_filter;factory.resource.$save=sliceprofiles_save;factory.resource.$remove=sliceprofiles_remove;factory.resource.$update=sliceprofiles_update};factory.init=init;try{init()}catch(err){if(window.DEBUG)console.error(err)}return factory}angular.module("service.sliceprofile",[]).factory("Sliceprofile",["$api",MainService])})();(function(){function MainService($api,$q,$rootScope,Printer){window.DEBUG=window.DEBUG||false;var factory={};var path="/slicer/slice";function merge_options(obj1,obj2){var obj3={};for(var attrname in obj1){obj3[attrname]=obj1[attrname]}for(var attrname in obj2){obj3[attrname]=obj2[attrname]}return obj3}factory.slice=function(sliceprofile,materials,models,printer,overrideSettings,name){var settings={bed:{use:true},queue:{use:false},brim:{use:false,extruder:0},raft:{use:false,extruder:0},skirt:{use:true,extruder:0},support:{use:false,extruder:0},fan:{use:true,extruder:0},override:{},files:[],postProcessing:[]};printer=printer||Printer.$active;overrideSettings=overrideSettings||{};settings.queue.printerId=printer.id;angular.merge(settings,overrideSettings);var promise=$q(function(resolve,reject){if(!printer.bed.heated){settings.bed={};settings.bed.use=false}if(typeof sliceprofile==="undefined"||sliceprofile.length<1){var e="Error, slice profile not defined!";if(window.DEBUG)console.error(e);return reject(e)}else if(typeof materials==="undefined"||materials.length<1){var e="Error, materials not defined!";if(window.DEBUG)console.error(e);return reject(e)}else if(typeof models==="undefined"||models.length<1){var e="Error, models not defined!";if(window.DEBUG)console.error(e);return reject(e)}else if(settings.bed.use&&(settings.bed.temperature==undefined||settings.bed.firstLayersTemperature==undefined)){var e="Error, heated bed is used but temperature not defined!";if(window.DEBUG)console.error(e);return reject(e)}settings.files=[];for(var i in models){if(typeof models[i]==="object"){var model=models[i];try{formideSDK.getModelTransformations({modelId:model.modelId},function(response,err){model=merge_options(model,response);settings.files.push({color:model.color,extruder:parseInt(model.extruder,10),filetype:model.filetype,modelId:model.id,position:model.position,rotation:model.rotation,scale:model.scale})})}catch(e){settings.files.push({bounds:{max:{x:0,y:0,z:0},min:{x:0,y:0,z:0}},device:model.device,deviceName:model.deviceName,deviceStatus:model.deviceStatus,color:model.color,extruder:parseInt(model.extruder,10),filetype:model.filetype,modelId:model.id,port:model.port,position:{x:0,y:0,z:0},root:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},status:model.status});if(window.DEBUG){console.info("Could not get model transformations, used position 0,0,0.",e)}}}}var printjob={files:models.map(function(val){if(typeof val==="object")return val.id}),sliceProfile:sliceprofile.id,materials:materials.map(function(val){return val.id}),printer:printer.id,settings:settings,name:name};$api.post(path,printjob).then(function successCallback(response){console.log("response slice",response);return resolve(response)},function errorCallback(e){console.log("response slice error",e);if(window.DEBUG)console.error(e);return reject(e)})});return promise};return factory}angular.module("service.slicer",[]).factory("Slicer",["$api","$q","$rootScope","Printer",MainService])})();(function(){function MainRun($socket){$socket.socket.on("log.debug",function(data){if(window.DEBUG){console.groupCollapsed("Log [%s] (%s)",data.device,data.message);console.log("Message: ",data.message);console.log("Module Path: ",data.modulePath);console.log("Timestamp: ",data.timestampDate+data.timestampString);console.groupEnd()}})}function MainService(socketFactory,$api,$auth,$interval){var factory={};var access_token=window.localStorage.getItem("formide.auth:token");window.PATH.socket=window.PATH.socket||window.location.protocol+"//"+window.location.hostname+":4000";factory.authenticate=function(){$api.getAccessToken().then(function(access_token){if(access_token.length<1){if(window.DEBUG)console.info("Not loggedin, could not connect to sockets.");return false}else{var type=type||"user";try{factory.socket.emit("authenticate",{type:type,accessToken:access_token},function(response){if(response.success===false){if(window.DEBUG)console.warn("Could not authenticate socket.",e)}else{if(window.DEBUG)console.info("Authenticated socket",response)}})}catch(e){if(window.DEBUG)console.warn("Could not authenticate socket.",e)}}},function(e){if(window.DEBUG)console.error("Not loggedin, could not connect to sockets.",e);return false})};factory.reconnect=function(){console.log("reconect to socket");factory.socket.disconnect();factory.socket.connect();factory.authenticate()};factory.socket=socketFactory({ioSocket:io.connect(window.PATH.socket)});return factory}angular.module("service.socket",[]).run(["$socket",MainRun]).factory("$socket",["socketFactory","$api","$auth","$interval",MainService])})();(function(){function coreHeader(){var directive={restrict:"EA",templateUrl:"header/componentTemplate.html",scope:{maxWidth:"@"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($router,$rootScope,$location,ngDialog,$auth){var vm=this;vm.mobilenavInvisible=true;vm.maxWidth=vm.maxWidth||896;vm.environmentLocation=window.ENV.location;function navigate(route){$auth.checkLoggedin().then(function(access_token){$location.search("folder",null);$location.path(route)})}function toggleMobilenav(){$rootScope.bodyNoScroll=!$rootScope.bodyNoScroll;vm.mobilenavInvisible=vm.mobilenavInvisible?false:true}$rootScope.$watch(function(){return $router.navigating},function(){if(!$router.navigating){vm.mobilenavInvisible=true}if($location.$$path=="/login"||$location.$$path=="/connectWifi"){vm.logout=true;ngDialog.closeAll()}else{vm.logout=false}});angular.extend(vm,{toggleMobilenav:toggleMobilenav,navigate:navigate})}MainController.$inject=["$router","$rootScope","$location","ngDialog","$auth"];angular.module("core.header",[]).directive("coreHeader",coreHeader)})();(function(){function coreNav(){var directive={restrict:"EA",templateUrl:"nav/componentTemplate.html",scope:{routeConfig:"=",coreNavSub:"@"},controller:MainController,controllerAs:"vm",link:MainLink,bindToController:true};return directive}function MainController($router,$rootScope,$api,$auth,$location,$notification,$scope,$timeout,$window){var vm=this;var routes=[];if(vm.coreNavSub===undefined){vm.subNav=false}else{vm.subNav=true}vm.showSubNav=false;vm.environmentLocation=window.ENV.location;if(!vm.subNav){vm.userImg="public/assets/images/user.png";vm.notifications=$notification;$notification.init();vm.account={};vm.isLoggedIn=false;if(routes){$rootScope.$watch(function(){return $router.navigating},function(){if(!$router.navigating){getRoutes();$rootScope.$emit("formide.navigated",true);window.scrollTo(0,0);for(var i in routes){if(routes[i].path){routes[i].nav.active=$router.lastNavigationAttempt.substring(1).split("/").indexOf(routes[i].path.substring(1))>-1;if(routes[i].nav.active&&routes[i].loggedIn){$auth.checkLoggedin().then(function(access_token){if(access_token.length>0){if(vm.environmentLocation==="cloud"){getAccount()}vm.isLoggedIn=true}else{vm.account={};vm.isLoggedIn=false}},function(error){vm.account={};vm.isLoggedIn=false})}}}}})}$window.addEventListener("click",documentClick);$scope.$watch("vm.notifications.list.length",function(){if(vm.notifications.list.length>0&&vm.showNotifications){setNotificationsHeight()}else if(vm.notifications.list.length>0&&!vm.showNotifications){vm.animateNotification=true;$timeout(function(){vm.animateNotification=false},1100)}},true)}else{if(routes){$rootScope.$watch(function(){return $router.navigating},function(){for(var i in routes){if(routes[i].path){routes[i].nav.active=$router.lastNavigationAttempt.substring(1).split("/").indexOf(routes[i].path.substring(1))>-1}}})}}function getRoutes(){try{routes=vm.routeConfig.filter(function(item){return item.nav!==undefined?true:false})}catch(err){if(window.DEBUG)console.info("RouteConfig not defined, could not populate navigation items.")}}getRoutes();function navigate(route){$location.path(route);vm.showSubNav=false;clearFolder()}function validateExpression(expression){try{return expression.key===expression.value}catch(e){return false}}function getAccount(){$api.get("/me").then(function(data){vm.account=data;if(vm.account.avatar){vm.userImg=window.PATH.images+"/"+vm.account.avatar}},function(){vm.account={}})}function clearFolder(){$location.search("folder",null)}function openAvatarMenu(){vm.showAvatarMenu=!vm.showAvatarMenu;vm.showNotifications=false;vm.notificationsHeight=null}function closeAvatarMenu(){vm.showAvatarMenu=false}function documentClick(){vm.showAvatarMenu=false;vm.showNotifications=false;vm.notificationsHeight=null}function openNotifications(){vm.showNotifications=true;vm.showAvatarMenu=false;setNotificationsHeight()}function notificationsClearAll(){$notification.clearAll();setNotificationsHeight()}function setNotificationsHeight(){var offset=158,row=69,height;height=row*vm.notifications.list.length+offset;if(height>offset+row*4){height=offset+row*4}else if(height<offset+row){height=offset+row}vm.notificationsHeight={height:height+"px"}}function setNoScroll(){$root.bodyNoScroll=false}angular.extend(vm,{routes:routes||{},validateExpression:validateExpression,clearFolder:clearFolder,openNotifications:openNotifications,openAvatarMenu:openAvatarMenu,closeAvatarMenu:closeAvatarMenu,notificationsClearAll:notificationsClearAll,setNoScroll:setNoScroll,navigate:navigate})}function MainLink(scope,element,attrs,controller){var attributes=Array.prototype.slice.call(element[0].attributes).map(function(obj){return obj.name})}MainController.$inject=["$router","$rootScope","$api","$auth","$location","$notification","$scope","$timeout","$window"];angular.module("core.nav",[]).directive("coreNav",coreNav)})();(function(){function coreAside(){var directive={restrict:"EA",templateUrl:"sidebar/componentTemplate.html",scope:{printers:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($rootScope,$api,$socket,$interval,Printer,$location,ngDialog){var vm=this;vm.showCloudMsg=true;vm.environmentLocation=window.ENV.location;vm.printer=[];vm.resolved=false;Printer.resource.$promise.then(function(data){vm.printer=Printer.resource;setActivePrinter(vm.printer);if(vm.environmentLocation=="local"){vm.resolved=true}});function setActivePrinter(printers){vm.printerActive=null;for(var i=0;i<printers.length;i++){if(printers[i].selected){if(printers[i].port&&(printers[i].device&&printers[i].device.id!=""&&printers[i].deviceName||vm.environmentLocation=="local")){vm.printerActive=printers[i]}break}}}function getStarted(){ngDialog.open({className:"ngdialog-info",template:"formide-info/componentView.html",controller:"FormideInfo",controllerAs:"modal",trapFocus:false})}$rootScope.$on("formide.printer:updated",function(event,state){vm.printer=Printer.resource;setActivePrinter(vm.printer)});$rootScope.$on("formide.printer:selectedRemoved",function(event,state){vm.printerActive=null});vm.devices=[];function getDevices(){vm.resolved=false;$api.get("/devices").then(function(response){vm.devices=response;vm.resolved=true})}if(vm.environmentLocation=="cloud"){getDevices()}$rootScope.$on("formide.device:updated",function(){getDevices()});vm.slicingInProgress=false;vm.unknownPrinter=false;vm.onboarding=$rootScope.onboarding;vm.deviceIsSetup=function(value){return value.port&&(value.device&&value.device.id!=""&&value.deviceName||vm.environmentLocation=="local")};vm.activeSliceMessage=0;vm.sliceMessages=["Sharpening katana swords","Calculating polygons","Repairing Models","We are testing your patience","Would you like fries with that?","It is still faster than you could draw it","Reticulating Spines","Reconfiguring the office coffee machine","Prepare for awesomeness!","Adjusting Bell Curves","Applying Feng Shui","Building Data Trees","Calculating Inverse Probability Matrices","Computing Optimal Bin Packing","Deciding What Message to Display Next","Dicing Models","Integrating Curves","Synthesizing Gravity","Synthesizing Wavelets"];function setVisible(index){if(index==vm.activeSliceMessage){return"1"}else{return"0"}}$interval(function(){vm.activeSliceMessage=Math.floor(Math.random()*vm.sliceMessages.length)},2e3);$rootScope.$on("formide.printer:updated",function(){});function printerSetupDialog(){if(vm.unknownPrinter){$rootScope.printerSetupDialog(vm.unknownPrinter.device,vm.unknownPrinter.port,true);vm.unknownPrinter=false}else{$rootScope.printerSetupDialog()}}var printerSortFunction=function(printer){switch(printer.status){case"printing":return 1;break;case"heating":return 2;break;case"paused":return 3;break;case"online":return 4;break;case"connecting":return 6;break;default:return 7;break}};$rootScope.$on("modal.printers.setup",function(){vm.unknownPrinter=false});$socket.socket.on("slicer.started",function(data){vm.slicingInProgress=true});$socket.socket.on("slicer.failed",function(data){vm.slicingInProgress=false});$socket.socket.on("slicer.finished",function(data){vm.slicingInProgress=false});$socket.socket.on("printer.connected",function(data){Printer.resource.$promise.then(function(result){if(!foundPrinter(Printer.resource,data)){vm.selectedPort=data.port;vm.unknownPrinter={device:data.device||"Local device",port:data.port}}})});$socket.socket.on("printer.disconnected",function(data){vm.unknownPrinter=false});angular.extend(vm,{printerSortFunction:printerSortFunction,setVisible:setVisible,getStarted:getStarted,printerSetupDialog:printerSetupDialog})}MainController.$inject=["$rootScope","$api","$socket","$interval","Printer","$location","ngDialog"];angular.module("core.aside",[]).directive("coreAside",coreAside)})();(function(){function addNew(){var directive={restrict:"EA",templateUrl:"add-new/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.addNew",[]).directive("addNew",addNew)})();(function(){function alertBox(){var directive={restrict:"EA",templateUrl:"alert-box/componentTemplate.html",scope:{alertId:"=",type:"@",title:"=",message:"=",actions:"=",link:"=?"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($notification){var vm=this;function closeNotification(){$notification.removeNotification(vm.alertId)}function executeCallback(callback){var cb=callback();if(cb){$notification.removeNotification(vm.alertId)}}angular.extend(vm,{closeNotification:closeNotification,executeCallback:executeCallback})}MainController.$inject=["$notification"];angular.module("shared.alertBox",[]).directive("alertBox",alertBox)})();(function(){function avatarImg(){var directive={restrict:"EA",templateUrl:"avatar-img/componentTemplate.html",scope:{size:"=",src:"=",title:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($scope){var vm=this;vm.style={height:vm.size+"px",width:vm.size+"px","background-image":"url('"+vm.src+"')"};$scope.$watch("vm.src",function(){vm.style={height:vm.size+"px",width:vm.size+"px","background-image":"url('"+vm.src+"')"}});angular.extend(vm,{})}MainController.$inject=["$scope"];angular.module("shared.avatarImg",[]).directive("avatarImg",avatarImg)})();(function(){function commandLine(){var directive={restrict:"EA",templateUrl:"command-line/componentTemplate.html",scope:{commands:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.lines=[{text:"Type HELP to get a list of commands","class":"terminal--header"}];var userCommands=vm.commands||{};var shellCommands={help:[function(cmd,args){var response="Commands: \n\r";for(command in shellCommands){if(shellCommands[command].length>1){response+="  "+command+' <span class="input--arguments">'+shellCommands[command][1]+"</span>\n\r"}else{response+="  "+command+"\n\r"}}return response.substring(0,response.length-2)}],clear:[function(cmd,args){vm.lines=[];return false}]};shellCommands=angular.extend({},shellCommands,userCommands);function terminalInputKeydown(keycode){if(keycode==13){try{execute()}catch(er){alert(er)}vm.input=""}}function println(s,classType){var classType=classType||"terminal--output";if(s=String(s)){vm.lines.push({text:s,"class":classType})}}function printError(er){println(er,"terminal--output is-not-defined")}function execute(s){var key=vm.input.substr(0,vm.input.indexOf(" "))||vm.input;var args=vm.input.substr(vm.input.indexOf(" ")+1)||"";args=args.split(" ");if(key===args[0]){args=[]}println(key+" "+args.join(" "),"terminal--input");if(shellCommands[key.toLowerCase()]){var response=shellCommands[key.toLowerCase()][0](key.toLowerCase(),args);if(response){println(response,"terminal--output")}}else{printError("Command not found: "+key)}}angular.extend(vm,{terminalInputKeydown:terminalInputKeydown})}MainController.$inject=[];angular.module("shared.commandLine",[]).directive("commandLine",commandLine)})();(function(){function dashboardCommunity(){var directive={restrict:"EA",templateUrl:"dashboard-community/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($http){var vm=this;var req={method:"GET",url:"https://formide.zendesk.com/api/v2/community/posts.json"};$http(req).then(function(response){vm.articles=response.data.posts},function(){console.log("error")});angular.extend(vm,{})}MainController.$inject=["$http"];angular.module("shared.dashboardCommunity",[]).directive("dashboardCommunity",dashboardCommunity)})();(function(){function dashboardNews(){var directive={restrict:"EA",templateUrl:"dashboard-news/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function UpdateDeviceController($api,$scope,$location){var vm=this;function getDevices(){vm.onlineDevices=[];vm.resolved=false;$api.get("/devices").then(function(response){var devices=response;for(var i=0;i<devices.length;i++){if(devices[i].status=="online"){vm.onlineDevices.push(devices[i])}}vm.resolved=true})}getDevices();function updateDevice(id){$location.path("manage/devices/"+id+"/update");$scope.closeThisDialog()}angular.extend(vm,{updateDevice:updateDevice})}function MainController($http,ngDialog){var vm=this;var req={method:"GET",url:"https://push.superfeedr.com/?hub.mode=retrieve&hub.topic=https%3A%2F%2Fblog.printr.com%2Ffeed&count=5&format=json&authorization=cHJpbnI6MTQzMDllMWIxNjczY2MzMzI4NWNiZjUwMzRkZmZmMmQ%3D&"};$http(req).then(function(response){vm.articles=response.data.items},function(){console.log("error")});var updateArticles=[];var req={method:"GET",url:"https://push.superfeedr.com/?hub.mode=retrieve&hub.topic=https%3A%2F%2Fblog.printr.com%2Ffeed%2Ftagged%2Flatest-updates&count=5&format=json&authorization=cHJpbnI6MTQzMDllMWIxNjczY2MzMzI4NWNiZjUwMzRkZmZmMmQ%3D&"};$http(req).then(function(response){var items=response.data.items;for(var i=0;i<items.length;i++){updateArticles.push(items[i].id)}},function(){console.log("error")});function isUpdateArticle(id){for(var i=0;i<updateArticles.length;i++){if(id===updateArticles[i]){return true}}return false}function truncateCell(id){var clientHeight=document.getElementById(id).clientHeight;if(clientHeight>48){return true}else{return false}}function updateDevice(){ngDialog.open({className:"printjob-printer-dialog",template:"updateDevice",controller:"ModalUpdateDevice",controllerAs:"modal",trapFocus:false})}angular.extend(vm,{truncateCell:truncateCell,isUpdateArticle:isUpdateArticle,updateDevice:updateDevice})}MainController.$inject=["$http","ngDialog"];UpdateDeviceController.$inject=["$api","$scope","$location"];angular.module("shared.dashboardNews",[]).controller("ModalUpdateDevice",UpdateDeviceController).directive("dashboardNews",dashboardNews)})();(function(){function dashboardPanel(){var directive={restrict:"EA",templateUrl:"dashboard-panel/componentTemplate.html",scope:{headerTitle:"=",headerIcon:"=?",headerBtn:"=?",headerBtnDisable:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.dashboardPanel",[]).directive("dashboardPanel",dashboardPanel)})();(function(){function dashboardQueue(){var directive={restrict:"EA",templateUrl:"dashboard-queue/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(Printer,Queue,$notification,printerCtrl,$location){var vm=this;function navigate(route){$location.path(route)}function filterQueue(item){if(item.status==="printing"){return[1,"updatedAt"]}else{return[2,"updatedAt"]}}function startPrint(id,gcode,status){$notification.addNotification({title:"Printbed Cleared",message:"Is the printbed cleared?",type:"info",duration:-1,actions:[{title:"Abort",callback:function(){console.log("abort!");return true}},{title:"Continue",callback:function(){status="printing";printerCtrl.start(id,gcode);$rootScope.$emit("print.started",true);return true}}],popup:true})}angular.extend(vm,{printer:Printer,queue:Queue,filterQueue:filterQueue,startPrint:startPrint})}MainController.$inject=["Printer","Queue","$notification","printerCtrl","$location"];angular.module("shared.dashboardQueue",[]).directive("dashboardQueue",dashboardQueue)})();(function(){function dashboardSlices(){var directive={restrict:"EA",templateUrl:"dashboard-slices/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(Printjob,$scope,$rootScope,ngDialog,$interval,$timeout,Printer,Queue,$socket,$location){var vm=this;vm.environmentLocation=window.ENV.location;vm.resolved=false;var file={filetype:"text/stl"};$socket.socket.on("slicer.finished",function(data){vm.resolved=false;$timeout(function(){getPrintjobs()},2e3)});getPrintjobs();function getPrintjobs(){vm.lastSlices=[];var params={};params.sort="createdAt";params.sortOrder="-";params.limit=5;Printjob.resource.$slices(params,function(){vm.lastSlices=Printjob.resource;vm.resolved=true})}function navigate(route){$location.path(route)}function openGcodeViewer(printjob){var data={printjob:printjob,file:file};ngDialog.open({template:"gcode-viewer/componentView.html",controller:"GcodeViewerController",controllerAs:"modal",className:"printjob-dialog",data:data,showClose:true,trapFocus:false,preCloseCallback:function(){$interval.cancel($rootScope.animationInterval);return true}})}function addToQueue(printjob){if((!Printer.$active.port||Printer.$active.deviceStatus!=="online")&&vm.environmentLocation==="cloud"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue");$scope.closeThisDialog()})});return true}})}else{Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue")})})}}function truncateCell(id){var clientHeight=document.getElementById(id).clientHeight;if(clientHeight>48){return true}else{return false}}angular.extend(vm,{openGcodeViewer:openGcodeViewer,addToQueue:addToQueue,truncateCell:truncateCell,navigate:navigate})}MainController.$inject=["Printjob","$scope","$rootScope","ngDialog","$interval","$timeout","Printer","Queue","$socket","$location"];angular.module("shared.dashboardSlices",[]).directive("dashboardSlices",dashboardSlices)})();(function(){function dashboardStorage(){var directive={restrict:"EA",templateUrl:"dashboard-storage/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($api,$timeout){var vm=this;vm.chart={};vm.storage={};vm.storage.max=1073741824*5;$api.get("/me/full").then(function(data,status,headers,config){vm.storage.used=data.storageUsed;vm.storage.percentageUsed=(vm.storage.used/vm.storage.max*100).toFixed(2);vm.storage.percentageUsedRnd=Math.round(vm.storage.percentageUsed);vm.storage.percentageLeft=100-vm.storage.percentageUsed;vm.chart.labels=["",""];vm.chart.data=[vm.storage.percentageUsed,vm.storage.percentageLeft]});vm.chart.options={cutoutPercentage:80,tooltips:{enabled:false},animation:{animateRotate:false},responsive:true,maintainAspectRatio:false};var color1="#46b1e6";var color2="#e4e4e4";vm.chart.datasetOverride={backgroundColor:[color1,color2],hoverBackgroundColor:[color1,color2],borderColor:["#FFF","#FFF"],hoverBorderColor:["#FFF","#FFF"],borderWidth:[2,2],hoverBorderWidth:[2,2]};angular.extend(vm,{})}MainController.$inject=["$api","$timeout"];angular.module("shared.dashboardStorage",[]).directive("dashboardStorage",dashboardStorage)})();(function(){function dashboardTemperatures(){var directive={restrict:"EA",templateUrl:"dashboard-temperatures/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(Printer,$filter,$socket,$rootScope,$timeout,$scope){var vm=this;vm.environmentLocation=window.ENV.location;vm.chart={};function setupChart(){vm.chart.labels=[];vm.chart.series=[];vm.chart.data=[];var maxTemp=Printer.$active.maxTemperature+50||450;if(Printer.$active.bed&&Printer.$active.bed.heated){vm.chart.series.push("Bed");vm.chart.data.push([]);vm.chart.series.push("Target");vm.chart.data.push([]);vm.chart.colors=["#F7464A","#FBC1C3","#46BFBD","#C2E9E9","#FDB45C","#FDE6CA","#D473AC","#EFD0E3","#46b1e6","#CAC7D9","#615892","#CAC7D9"];
}else{vm.chart.colors=["#46BFBD","#C2E9E9","#FDB45C","#FDE6CA","#D473AC","#EFD0E3","#46b1e6","#CAC7D9","#615892","#CAC7D9"]}if(Printer.$active.extruders){for(var i=0;i<Printer.$active.extruders.length;i++){vm.chart.series.push("Ext "+(i+1));vm.chart.data.push([]);vm.chart.series.push("Target");vm.chart.data.push([])}}else{vm.chart.series.push("Ext 1");vm.chart.data.push([]);vm.chart.series.push("Target");vm.chart.data.push([])}vm.chart.options={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:true,position:"left",ticks:{min:0,max:maxTemp,beginAtZero:true}}],xAxes:[{ticks:{autoSkip:true,maxTicksLimit:11}}]},datasetFill:false,elements:{point:{radius:0,hitRadius:10,hoverRadius:3},line:{fill:false}},animation:false,responsive:true,maintainAspectRatio:false}}function populateChart(resource){var b=0;var n=vm.chart.data[0].length;var time=(new Date).getTime();if(n==0){if(Printer.$active.statusTemperatures.length>0){for(var i=0;i<Printer.$active.statusTemperatures.length;i++){vm.chart.labels.push($filter("date")(Printer.$active.statusTemperatures[i].time,"HH:mm:ss"));if(Printer.$active.bed.heated){b=2;vm.chart.data[0].push(Printer.$active.statusTemperatures[i].bed.temp);vm.chart.data[1].push(Printer.$active.statusTemperatures[i].bed.targetTemp)}for(var r=0;r<Printer.$active.extruders.length;r++){vm.chart.data[r*2+b].push(Printer.$active.statusTemperatures[i].extruders[r].temp);vm.chart.data[r*2+b+1].push(Printer.$active.statusTemperatures[i].extruders[r].targetTemp)}}}for(var i=0;i<31-Printer.$active.statusTemperatures.length;i++){var tempTime=time+2e3*i;vm.chart.labels.push($filter("date")(tempTime,"HH:mm:ss"))}}else if(n>30){vm.chart.labels.splice(0,1);vm.chart.labels.push($filter("date")(time,"HH:mm:ss"))}if(Printer.$active.bed.heated){b=2;vm.chart.data[0].push(resource.bed.temp);vm.chart.data[1].push(resource.bed.targetTemp);if(n>30){vm.chart.data[0].splice(0,1);vm.chart.data[1].splice(0,1)}}for(var i=0;i<Printer.$active.extruders.length;i++){vm.chart.data[i*2+b].push(resource.extruders[i].temp);vm.chart.data[i*2+b+1].push(resource.extruders[i].targetTemp);if(n>30){vm.chart.data[i*2+b].splice(0,1);vm.chart.data[i*2+b+1].splice(0,1)}}}Printer.resource.$promise.then(function(data){$timeout(function(){setupChart()})});$scope.$on("formide.activePrinter:updated",function(event,resource){setupChart()});$socket.socket.on("printer.status",function(resource){if(typeof resource.device=="string"){resource.device=resource.device.toLowerCase()}if(Printer.$active&&Printer.$active.active&&Printer.$active.port==resource.port&&Printer.$active.device.id==resource.device&&(resource.status!=="offline"||resource.status!=="connecting")){populateChart(resource)}});angular.extend(vm,{})}MainController.$inject=["Printer","$filter","$socket","$rootScope","$timeout","$scope"];angular.module("shared.dashboardTemperatures",[]).directive("dashboardTemperatures",dashboardTemperatures)})();(function(){function dashboardWebcam(){var directive={restrict:"EA",templateUrl:"dashboard-webcam/componentTemplate.html",scope:{showClose:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(Printer,Queue,$api,$rootScope,$scope){var vm=this;vm.environmentLocation=window.ENV.location;function webcamConnection(){$rootScope.webcamError=false;vm.webcamLoaded=false;if(vm.environmentLocation=="local"){vm.webcamPath=window.PATH.socket=window.location.protocol+"//"+window.location.hostname+":8081/?action=stream&random="+Math.round(Math.random()*999999)}else{if(Printer.$active.device){cloudWebcamConnection()}}}webcamConnection();function cloudWebcamConnection(){$api.get("/devices/"+Printer.$active.device.id).then(function(data,status,headers,config){vm.device=data;if(vm.device.session){vm.webcamPath="http://"+vm.device.session.ip+":8081/?action=stream&random="+Math.round(Math.random()*999999)}else{$rootScope.webcamError=true}})}$scope.$on("formide.activePrinter:changed",function(event,resource){$rootScope.webcamError=false;vm.webcamLoaded=false;if(vm.environmentLocation=="cloud"){cloudWebcamConnection()}});angular.extend(vm,{printer:Printer,queue:Queue})}MainController.$inject=["Printer","Queue","$api","$rootScope","$scope"];angular.module("shared.dashboardWebcam",[]).directive("dashboardWebcam",dashboardWebcam)})();(function(){function deviceListItem(){var directive={restrict:"EA",templateUrl:"device-list-item/componentTemplate.html",scope:{device:"=",edit:"=?"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($api,$notification,$location){var vm=this;function navigate(route){$location.path(route)}function changeName(device){$api.put("/devices/"+device.id,{name:device.name}).then(function(response){$notification.addNotification({title:"Device Settings Saved",message:response.message,channel:"system",type:"success"})})}angular.extend(vm,{changeName:changeName,navigate:navigate})}MainController.$inject=["$api","$notification","$location"];angular.module("shared.deviceListItem",[]).directive("deviceListItem",deviceListItem)})();(function(){function deviceList(){var directive={restrict:"EA",templateUrl:"device-list/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.deviceList",[]).directive("deviceList",deviceList)})();(function(){function deviceStatusIcon(){var directive={restrict:"EA",templateUrl:"device-status-icon/componentTemplate.html",transclude:true,scope:{status:"="},controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.deviceStatusIcon",[]).directive("deviceStatusIcon",deviceStatusIcon)})();(function(){function dragWebcam($timeout,$location,$rootScope){var directive={link:function(scope,element){var el=element[0];var dragObj=null;el.onmousedown=function(){dragObj=el};document.onmouseup=function(e){dragObj=null};document.onmousemove=function(e){if(dragObj==null)return;var offsetX=document.getElementById("floating-webcam").offsetWidth;var offsetY=document.getElementById("floating-webcam").offsetHeight;var maxX=window.innerWidth;var maxY=window.innerHeight;var x=e.pageX-offsetX/2;var y=e.pageY-offsetY/2;if(x<0)x=0;if(x>maxX-offsetX)x=maxX-offsetX;if(y<0)y=0;if(y>maxY-offsetY)y=maxY-offsetY;dragObj.style.left=x+"px";dragObj.style.top=y+"px";window.localStorage.setItem("formide.webcam:position",JSON.stringify({x:x,y:y}))}}};return directive}angular.module("shared.dragWebcam",[]).directive("dragWebcam",dragWebcam)})();(function(){function fileDroppable($timeout,$location,$rootScope){var directive={link:function(scope,element){var el=element[0];var leaveTimeout;var dragOverClass;el.addEventListener("dragover",function(e){if($location.$$path=="/files"){var dt=e.dataTransfer;if(dt.types&&(dt.types.indexOf?dt.types.indexOf("Files")!=-1:e.dataTransfer.types[0]!="draggable"&&e.dataTransfer.types[1]!="draggable")&&!$rootScope.fileUploading){if(e.preventDefault)e.preventDefault();$timeout.cancel(leaveTimeout);dragOverClass="file-dragover";el.classList.add(dragOverClass)}}else{e.dataTransfer.dropEffect="none"}return false},false);el.addEventListener("dragleave",function(e){leaveTimeout=$timeout(function(){if(dragOverClass)el.classList.remove(dragOverClass);dragOverClass=null},100);return false},false);el.addEventListener("drop",function(e){if(e.preventDefault)e.preventDefault();if(dragOverClass)el.classList.remove(dragOverClass);dragOverClass=null;return false},false)}};return directive}angular.module("shared.fileDroppable",[]).directive("fileDroppable",fileDroppable)})();(function(){function float(){var directive={require:"ngModel",link:function(scope,ele,attr,ctrl){ctrl.$parsers.unshift(function(viewValue){return parseFloat(viewValue)})}};return directive}angular.module("shared.float",[]).directive("float",float)})();(function(){function focusNext(){var directive={restrict:"A",scope:{submit:"=",maxLength:"="},link:function($scope,element,attrs){element.bind("keyup",function(e){var target=e.srcElement;var myLength=target.value.length;if(myLength>=$scope.maxLength){var next=target;if(next.nextElementSibling==null){$scope.submit()}else{while(next=next.nextElementSibling){if(next==null){break}if(next.tagName.toLowerCase()=="input"){next.focus();break}}}}else if(e.keyCode===8){var previous=target;while(previous=previous.previousElementSibling){if(previous.tagName.toLowerCase()=="input"){previous.focus();previous.value="";break}}}})}};return directive}angular.module("shared.focusNext",[]).directive("focusNext",focusNext)})();(function(){function libraryDragDrop(){var directive={scope:{drop:"&",file:"="},link:function(scope,element){var el=element[0];if(scope.file.filetype!="path"){el.draggable=true;el.addEventListener("dragstart",function(e){scope.file.$selected=true;e.dataTransfer.effectAllowed="move";e.dataTransfer.setData("draggable","");this.classList.add("drag");return false},false);el.addEventListener("dragend",function(e){this.classList.remove("drag");return false},false)}if(scope.file.filetype=="folder"||scope.file.filetype=="path"){el.addEventListener("dragover",function(e){if(e.preventDefault)e.preventDefault();if(e.dataTransfer.types[0]=="draggable"||e.dataTransfer.types[1]=="draggable"){this.classList.add("over")}return false},false);el.addEventListener("dragleave",function(e){this.classList.remove("over");return false},false);el.addEventListener("drop",function(e){if(e.preventDefault)e.preventDefault();this.classList.remove("over");var fn=scope.drop();if("undefined"!==typeof fn){fn(scope.file)}return false},false)}}};return directive}angular.module("shared.libraryDragDrop",[]).directive("libraryDragDrop",libraryDragDrop)})();(function(){function libraryOverlay(){var directive={restrict:"EA",templateUrl:"library-overlay/componentTemplate.html",scope:{overlayClose:"=?",overlayTitle:"@"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.libraryOverlay",[]).directive("libraryOverlay",libraryOverlay)})();(function(){function loadingScreen($timeout){return{link:link,restrict:"EA"};function link(scope,element,attributes){element.css("opacity",0);$timeout(function(){element.remove();scope=element=attributes=null},500)}}angular.module("shared.loadingScreen",[]).directive("loadingScreen",loadingScreen)})();(function(){function notificationListItem(){var directive={restrict:"EA",templateUrl:"notification-list-item/componentTemplate.html",scope:{notificationId:"=",title:"=",description:"=",count:"=",updatedAt:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($location,$notification){var vm=this;function clearSingle(index){$notification.clearSingle(index)}angular.extend(vm,{clearSingle:clearSingle})}MainController.$inject=["$location","$notification"];angular.module("shared.notificationListItem",[]).directive("notificationListItem",notificationListItem)})();(function(){function notificationList(){var directive={restrict:"EA",templateUrl:"notification-list/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.notificationList",[]).directive("notificationList",notificationList)})();(function(){function onEnter(){var directive={restrict:"A",link:function(scope,element,attrs){element.bind("keydown",function(e){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.onEnter)});event.preventDefault()}});scope.$on("$destroy",function(){element.unbind("keydown")})}};return directive}angular.module("shared.onEnter",[]).directive("onEnter",onEnter)})();(function(){function pagination($timeout,$window){var directive={scope:{paginationNextPage:"=?",paginationScrollDistance:"=?"},link:function(scope,element,attrs){var el=element[0];var scrollDistance,container,screenSize;scrollDistance=scope.paginationScrollDistance||0;function containerHeight(){if(screenSize==="sm"){return container[0].innerHeight}else{return container[0].offsetHeight}}function containerScroll(){if(screenSize==="sm"){return container[0].pageYOffset}else{return container[0].scrollTop}}function scrollHandler(){var elementBottom,remaining,loadNextPage,containerBottom;containerBottom=containerHeight()+containerScroll();elementBottom=el.offsetTop+el.offsetHeight;remaining=elementBottom-containerBottom;loadNextPage=remaining<=containerHeight()*scrollDistance+1;if(loadNextPage){scope.paginationNextPage()}}function setContainer(){if($window.innerWidth<1060){screenSize="sm";if(container){container.off("scroll",scrollHandler)}container=angular.element($window);container.on("scroll",scrollHandler)}else{screenSize="lg";if(container){container.off("scroll",scrollHandler)}container=angular.element(document.querySelector("#main__content"));container.on("scroll",scrollHandler)}}setContainer();angular.element($window).on("resize",setContainer);scope.$on("$destroy",handleDestroy);function handleDestroy(){container.off("scroll",scrollHandler);angular.element($window).off("resize",setContainer)}}};return directive}angular.module("shared.pagination",[]).directive("pagination",pagination)})();(function(){function printerControlsFan(){var directive={restrict:"EA",templateUrl:"printer-controls-fan/componentTemplate.html",scope:{size:"=",max:"=",speed:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.size=vm.size||0;vm.max=vm.max||0;vm.speed=vm.speed||100;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.printerControlsFan",[]).directive("printerControlsFan",printerControlsFan)})();(function(){function printerControlsFlowRate(){var directive={restrict:"EA",templateUrl:"printer-controls-flow-rate/componentTemplate.html",scope:{size:"=",max:"=",speed:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($scope){var vm=this;vm.size=vm.size||0;vm.max=vm.max||0;vm.speed=vm.speed||100;$scope.$watch("vm.speed",function(){if(vm.speed==0){vm.duration="0s"}else{vm.duration=(1.01-vm.speed/vm.max)*2+"s"}});angular.extend(vm,{})}MainController.$inject=["$scope"];angular.module("shared.printerControlsFlowRate",[]).directive("printerControlsFlowRate",printerControlsFlowRate)})();(function(){function printerControlsSlider(){var directive={restrict:"EA",templateUrl:"printer-controls-slider/componentTemplate.html",scope:{min:"@",max:"@",step:"@",value:"=",prettyMin:"@",prettyMax:"@",inputField:"@",gcode:"=",disableInput:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($scope,$rootScope,printerCtrl){var vm=this;vm.min=vm.min||0;vm.max=vm.max||100;vm.step=vm.step||1;vm.value=vm.value||0;vm.inputField=vm.inputField||false;vm.disableInput=vm.disableInput||false;function postTuneGcode(){if(vm.gcode=="M106 S"&&typeof vm.value!=="undefined"&&vm.value!=null){var finalValue=vm.value*255/100||0;printerCtrl.tune(vm.gcode+finalValue)}else if(vm.gcode&&typeof vm.value!=="undefined"&&vm.value!=null){printerCtrl.tune(vm.gcode+vm.value)}$rootScope.$emit("formide.printer:tune",true)}angular.extend(vm,{postTuneGcode:postTuneGcode,printerCtrl:printerCtrl})}MainController.$inject=["$scope","$rootScope","printerCtrl"];angular.module("shared.printerControlsSlider",[]).directive("printerControlsSlider",printerControlsSlider)})();(function(){function printerControlsSpeed(){var directive={restrict:"EA",templateUrl:"printer-controls-speed/componentTemplate.html",scope:{size:"=",max:"=",speed:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($scope){var vm=this;vm.size=vm.size||0;vm.max=vm.max||0;vm.speed=vm.speed||100;$scope.$watch("vm.speed",function(){if(vm.speed==0){vm.duration="0s"}else{vm.duration=(1.01-vm.speed/vm.max)*1.5+"s"}});angular.extend(vm,{})}MainController.$inject=["$scope"];angular.module("shared.printerControlsSpeed",[]).directive("printerControlsSpeed",printerControlsSpeed)})();(function(){function printerControls(){var directive={restrict:"EA",templateUrl:"printer-controls/componentTemplate.html",scope:{axisPos:"=",extruders:"=",disableInput:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(printerCtrl,$timeout){var vm=this;vm.extruders=vm.extruders||{};vm.disableInput=vm.disableInput||false;vm.extruderWidth={width:vm.extruders.length*65+"px"};function opacity(value,array,range){value=Math.abs(value);var length=array.length-1;var step=(range[1]-range[0])/length;return range[0]+step*(length-array.indexOf(value))}var axis=[{key:"x",orientation:"vertical",positive:[100,10,1,.1],negative:[-.1,-1,-10,-100]},{key:"y",orientation:"horizontal",positive:[100,10,1,.1],negative:[-.1,-1,-10,-100]},{key:"z",orientation:"vertical",positive:[100,10,1,.1],negative:[-.1,-1,-10,-100]}];var extruder_settings={orientation:"vertical",extrude:[100,10,1,.1],retract:[-.1,-1,-10,-100]};for(extruder in vm.extruders){for(var attrname in extruder_settings){vm.extruders[extruder][attrname]=extruder_settings[attrname]}}function setOpacity(value,array){return opacity(value,array,[.25,1])}function move(key,item){vm.printerCtrl.move(key,parseFloat(vm.axisPos[key])*parseFloat(item))}angular.extend(vm,{axis:axis,move:move,setOpacity:setOpacity,printerCtrl:printerCtrl,extruder_settings:extruder_settings})}MainController.$inject=["printerCtrl","$timeout"];angular.module("shared.printerControls",[]).directive("printerControls",printerControls)})();(function(){function printerFan(){var directive={restrict:"EA",templateUrl:"printer-fan/componentTemplate.html",scope:{size:"=",max:"=",speed:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.size=vm.size||0;vm.max=vm.max||0;vm.speed=vm.speed||100;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.printerFan",[]).directive("printerFan",printerFan)})();(function(){function printerListItem(){var directive={restrict:"EA",templateUrl:"printer-list-item/componentTemplate.html",scope:{printer:"=",type:"@"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($timeout,$location,$rootScope,Printer,Queue,printerCtrl,$notification){var vm=this;vm.environmentLocation=window.ENV.location;vm.printer.status=vm.printer.status||"offline";vm.showWebcam=false;function getPrintjobName(id){Queue.endpoint.get({device:vm.printer.device,id:id},function(resource){if(resource.printjob.sliceMethod!=="custom"){vm.printjobName=resource.printjob.modelfiles[0].filename}else{vm.printjobName=resource.printjob.gcodefile.filename}})}function navigate(route){$location.search("folder",null);$location.path(route)}function pausePrint(){printerCtrl.pause();vm.executingCommand=true}function resumePrint(){printerCtrl.resume();vm.executingCommand=true}function stopPrint(){$notification.addNotification({title:"Stop Print",message:"Do you really want to stop this print?",type:"info",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Stop Print",callback:function(){printerCtrl.stop();vm.executingCommand=true;for(var i=0;i<Queue.resource.length;i++){if(Queue.resource[i].status==="printing"){Queue.resource[i].status="queued";break}}return true}}],popup:true})}angular.extend(vm,{printerService:Printer,getPrintjobName:getPrintjobName,pausePrint:pausePrint,resumePrint:resumePrint,stopPrint:stopPrint,navigate:navigate})}MainController.$inject=["$timeout","$location","$rootScope","Printer","Queue","printerCtrl","$notification"];angular.module("shared.printerListItem",[]).directive("printerListItem",printerListItem)})();(function(){function printerList(){var directive={restrict:"EA",templateUrl:"printer-list/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.printerList",[]).directive("printerList",printerList)})();(function(){function printerSpeed(){var directive={restrict:"EA",templateUrl:"printer-speed/componentTemplate.html",scope:{size:"=",max:"=",speed:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController($scope){var vm=this;vm.size=vm.size||0;vm.max=vm.max||0;vm.speed=vm.speed||Math.round(vm.max/2);$scope.$watch("vm.speed",function(){if(vm.speed==0){vm.duration="0s"}else{vm.duration=(1.01-vm.speed/vm.max)*2+"s"}});angular.extend(vm,{})}MainController.$inject=["$scope"];angular.module("shared.printerSpeed",[]).directive("printerSpeed",printerSpeed)})();(function(){function progressBar(){var directive={restrict:"EA",templateUrl:"progress-bar/componentTemplate.html",scope:{valuenow:"@",valuemax:"@"},controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.valuemax=vm.valuemax||100;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.progressBar",[]).directive("progressBar",progressBar)})();(function(){function queueListItem(){var directive={restrict:"EA",templateUrl:"queue-list-item/componentTemplate.html",scope:{queueItem:"=",method:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(printerCtrl,$rootScope,$timeout,Printer,File,$notification,ngDialog,$api,$location){var vm=this;vm.wait=true;vm.clicked=false;vm.printer=Printer.$active;vm.environmentLocation=window.ENV.location;if(vm.environmentLocation=="local"){$api.getAccessToken().then(function(access_token){vm.access_token=access_token;vm.imagesRootLocation=window.PATH.images})}else{vm.imagesRootLocation=window.PATH.images}$timeout(function(){vm.wait=false},3e3);function navigate(route){$location.path(route)}function clicked(){vm.clicked=true;$timeout(function(){vm.clicked=false},2e3)}function onClick(item){clicked();vm.method(item)}function startPrint(id,gcode){$notification.addNotification({title:"Printbed Cleared",message:"Is the printbed cleared?",type:"info",duration:-1,actions:[{title:"Abort",callback:function(){console.log("abort!");return true}},{title:"Continue",callback:function(){vm.queueItem.status="printing";printerCtrl.start(id,gcode);$rootScope.$emit("print.started",true);return true}}],popup:true})}function pausePrint(){printerCtrl.pause();vm.executingCommand=true}function resumePrint(){printerCtrl.resume();vm.executingCommand=true}function stopPrint(){$notification.addNotification({title:"Stop Print",message:"Do you really want to stop this print?",type:"info",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Stop Print",callback:function(){printerCtrl.stop();vm.queueItem.status="queued";vm.executingCommand=true;return true}}],popup:true})}function previewPrint(){var data={printjob:vm.queueItem.printJob};ngDialog.open({template:"gcode-viewer/componentView.html",controller:"GcodeViewerController",controllerAs:"modal",className:"printjob-dialog",data:data,showClose:true,trapFocus:false})}angular.extend(vm,{startPrint:startPrint,pausePrint:pausePrint,resumePrint:resumePrint,stopPrint:stopPrint,onClick:onClick,previewPrint:previewPrint,navigate:navigate})}MainController.$inject=["printerCtrl","$rootScope","$timeout","Printer","File","$notification","ngDialog","$api","$location"];angular.module("shared.queueListItem",[]).directive("queueListItem",queueListItem)})();(function(){function queueList(){var directive={restrict:"EA",templateUrl:"queue-list/componentTemplate.html",scope:{},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.queueList",[]).directive("queueList",queueList)})();(function(){function rangeSlider($timeout){var directive={restrict:"EA",templateUrl:"range-slider/componentTemplate.html",require:"ngModel",scope:{min:"@",max:"@",step:"@",prettyMin:"@",prettyMax:"@",inputField:"@",value:"=",showValue:"@"},link:function(scope,element,attrs,ctrl){scope.min=scope.min||0;scope.max=scope.max||100;scope.step=scope.step||1;scope.inputField=scope.inputField||false;scope.updateModel=function(value){ctrl.$setViewValue(value)}}};return directive}angular.module("shared.rangeSlider",[]).directive("rangeSlider",rangeSlider)})();(function(){function selectionBlock(){var directive={restrict:"EA",templateUrl:"selection-block/componentTemplate.html",scope:{currentItem:"@",ngModel:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.item=JSON.parse(vm.currentItem);angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.selectionBlock",[]).directive("selectionBlock",selectionBlock)})();(function(){function selectionList(){var directive={restrict:"EA",templateUrl:"selection-list/componentTemplate.html",scope:{extruders:"=",ngModel:"=",name:"@"},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.selectionList",[]).directive("selectionList",selectionList)})();(function(){function sliceDetailsList(){var directive={restrict:"EA",templateUrl:"slice-details-list/componentTemplate.html",scope:{printjob:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;vm.imagesRootLocation=window.PATH.images;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.sliceDetailsList",[]).directive("sliceDetailsList",sliceDetailsList)})();(function(){function statusIcon(){var directive={restrict:"EA",templateUrl:"status-icon/componentTemplate.html",scope:{status:"="},transclude:true,controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;if(vm.status!==undefined){vm.status=vm.status.toLowerCase()}else{vm.status="offline"}angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.statusIcon",[]).directive("statusIcon",statusIcon)})();(function(){function temperatureBar(){var directive={restrict:"EA",templateUrl:"temperature-bar/componentTemplate.html",scope:{valuenow:"@",valuetarget:"@",valuemax:"@"},controller:MainController,controllerAs:"vm",bindToController:true};return directive}function MainController(){var vm=this;angular.extend(vm,{})}MainController.$inject=[];angular.module("shared.temperatureBar",[]).directive("temperatureBar",temperatureBar)})();(function(){function MainController($timeout,$auth,$location,$rootScope,$api){var vm=this;$rootScope.setSidebarHide();vm.loginPage=window.localStorage.getItem("theElement:loginPage")||"cloudCode";function logout(){$auth.logout().then(function(){window.location="/api/auth/login"})}switch(window.ENV.location){case"cloud":logout();break;default:window.localStorage.removeItem("formide.auth:token")}function submitLoginForm(){vm.errorMessage="";if(!vm.user||!vm.user.email||!vm.user.password){console.log("Login error");vm.errorMessage="Incorrect Login"}else{vm.loading=true;$auth.login(vm.user.email,vm.user.password).then(function(result){vm.loading=false;window.localStorage.setItem("formide.auth:token",result.access_token);$timeout(function(){window.location.href=window.location.protocol+"//"+window.location.hostname+":"+window.location.port;$rootScope.setSidebarShow()},1e3)},function(e){vm.loading=false;console.log("Login error");vm.errorMessage="Incorrect Login"})}}function connectToCloud(){var url="http://"+$location.$$host+":1337";window.location=url}function connectToFormide(){if(vm.url){window.location=vm.url}else{vm.connecting=true;vm.connectingError=false;$api.get("/cloud/code").then(function(response){var cloudCode=response.code;$api.get("/").then(function(status){vm.url=status.platformURL+"/#/manage/devices/setup?cloud_code="+cloudCode;window.location=vm.url},function(e){vm.connecting=false;vm.connectingError=e.message})},function(e){vm.connecting=false;vm.connectingError=e.message})}}function setLoginPage(page){vm.loginPage=page;window.localStorage.setItem("theElement:loginPage",page)}angular.extend(vm,{submitLoginForm:submitLoginForm,connectToCloud:connectToCloud,connectToFormide:connectToFormide,setLoginPage:setLoginPage})}MainController.$inject=["$timeout","$auth","$location","$rootScope","$api"];angular.module("component.auth.login",[]).controller("AuthLoginController",MainController)})();(function(){function MainController($auth,$http,$location,$timeout){var vm=this;switch(window.ENV.location){case"cloud":function logout(){localStorage.removeItem("formide.auth:token");$auth.logout();window.location=window.PATH.root+"/api/auth/logout"}logout();break;default:}angular.extend(vm,{})}MainController.$inject=["$auth","$http","$location","$timeout"];angular.module("component.auth.logout",[]).controller("AuthLogoutController",MainController)})();(function(){function MainController($rootScope){var vm=this;$rootScope.setSidebarHide();angular.extend(vm,{})}MainController.$inject=["$rootScope"];angular.module("component.connectWifi",[]).controller("ConnectWifiController",MainController)})();(function(){function MainController($location,ngDialog,$window){var vm=this;var widgetConfig={selector:"#latestChanges",account:"7NAD9x"};$window.Headway.init(widgetConfig);vm.newsHeaderBtn={title:"View All",action:goToNews};vm.communityHeaderBtn={title:"View All",action:goToCommunity};vm.slicesHeaderBtn={title:"View All",action:goToSlices};vm.storageHeaderBtn={title:"Upgrade",action:goToStorage};vm.queueHeaderBtn={title:"View All",action:goToQueue};function goToNews(){window.open("https://blog.printr.com/")}function goToCommunity(){window.open("https://formide.zendesk.com/hc/en-us/community/topics/")}function goToSlices(){$location.path("print/jobs")}function goToStorage(){console.log("goToStorage")}function goToQueue(){$location.path("print/queue")}angular.extend(vm,{})}MainController.$inject=["$location","ngDialog","$window"];angular.module("component.dashboard",[]).controller("DashboardController",MainController).filter("trustedHTML",function($sce){return function(ss){return $sce.trustAsHtml(ss)}})})();(function(){function MainController($auth,$http,$api,Device,$socket,$scope,$rootScope,$timeout,$interval,$notification,$filter,ngDialog,$location){var vm=this;vm.registrationToken=$scope.ngDialogData.registrationToken;vm.cloudCode=$scope.ngDialogData.cloudCode;vm.detecting=true;vm.errorMessage="";var promise;function closeSetup(){if(!vm.confirmCloseSetup&&vm.registrationToken){vm.warningMessage="'Cancel setup' will restart the Element's registration. Please confirm by clicking 'Cancel setup' again.";vm.confirmCloseSetup=true}else if(vm.registrationToken){window.localStorage.removeItem("formide:registrationToken");$rootScope.onboarding("setupSingleDevice");$scope.closeThisDialog()}else if(vm.cloudCode){window.localStorage.removeItem("formide:cloudCode");$scope.closeThisDialog()}}function searchForDevice(){$api.get("/devices/register/"+vm.registrationToken).then(function(response){$interval.cancel(promise);
vm.detecting=false},function(e){if(e.statusCode===404){$timeout(function(){vm.errorMessage=e.message},1e4)}else{$interval.cancel(promise);vm.errorMessage=e.message;$notification.addNotification({title:"Device Registration Failed",message:e.message,channel:"system",type:"warn"});$scope.closeThisDialog()}})}function finishRegistration(){if(vm.registrationToken){$api.put("/devices/register/"+vm.registrationToken).then(function(response){window.localStorage.removeItem("formide:registrationToken");$location.path("manage/devices");$rootScope.$emit("formide.device:added",response.deviceUser.device,response.deviceUser.name);vm.setupComplete=true},function(e){vm.errorMessage=e.message})}else if(vm.cloudCode){$rootScope.printerSetupDialog();$scope.closeThisDialog()}}function connectPrinter(){$rootScope.printerSetupDialog();$scope.closeThisDialog()}function closeConnectPrinter(){$scope.closeThisDialog()}function submitCloudCode(){$api.post("/devices/register/code/"+vm.cloudCode).then(function(response){if(response.device){vm.detecting=false;$notification.addNotification({title:"Device Registered",message:"Succesfully connected device to your acount",channel:"device",type:"success"});$rootScope.$emit("formide.device:added",response.deviceUser.device,response.deviceUser.name);$location.path("manage/devices");window.localStorage.removeItem("formide:cloudCode")}else{vm.errorMessage="Cloud Code was invalid. Please try and connect your device again"}},function(e){vm.errorMessage="Cloud Code was invalid. Please try and connect your device again"})}if(vm.registrationToken){promise=$interval(searchForDevice,2e3,30)}else if(vm.cloudCode){submitCloudCode()}angular.extend(vm,{closeSetup:closeSetup,finishRegistration:finishRegistration,connectPrinter:connectPrinter,closeConnectPrinter:closeConnectPrinter})}MainController.$inject=["$auth","$http","$api","Device","$socket","$scope","$rootScope","$timeout","$interval","$notification","$filter","ngDialog","$location"];angular.module("component.device.setup",[]).controller("DeviceSetupController",MainController)})();(function(){function MainController($auth,$api,$rootScope){var vm=this;function searchAccounts(){$api.get("/public/accounts").then(function(result){vm.accounts=result})}function init(){searchAccounts()}init();angular.extend(vm,{})}MainController.$inject=["$auth","$api","$rootScope"];angular.module("component.discover.accounts",[]).controller("DiscoverAccountsController",MainController)})();(function(){function MainController($auth,$api,$rootScope){var vm=this;vm.searchQuery="";vm.resultsPage=1;vm.results=[];vm.busy=false;vm.noResults=false;vm.accounts=[];vm.threedshapes=[];function doSearch(){$api.get("/integrations/3dshapes?text="+vm.searchQuery+"&page="+vm.resultsPage+"&perPage24").then(function(result){vm.resultsPage=1;vm.threedshapes=result.models})}function nextPage(){if(vm.busy)return;vm.busy=true;$api.get("/integrations/3dshapes?text="+vm.searchQuery+"&page="+vm.resultsPage+"&perPage=24").then(function(result){var items=result.models;if(items){for(var i=0;i<items.length;i++){vm.threedshapes.push(items[i])}vm.busy=false;vm.noResults=false;vm.resultsPage++}else{vm.noResults=true}})}function preview(){$rootScope.$emit("discover.preview","model")}function init(){doSearch()}init();angular.extend(vm,{doSearch:doSearch,nextPage:nextPage,preview:preview})}MainController.$inject=["$auth","$api","$rootScope"];angular.module("component.discover.models",[]).controller("DiscoverModelsController",MainController)})();(function(){function MainController($auth,$api,$rootScope,$routeParams){var vm=this;vm.searchQuery="";vm.resultsPage=1;vm.results=[];vm.busy=false;vm.accounts=[];function search3dshapes(query){$api.get("/integrations/3dshapes?text="+query+"&page="+vm.resultsPage+"&perPage=24").then(function(result){vm.resultsPage=1;vm.threedshapes=result.models})}function nextPage(){if(vm.busy)return;vm.busy=true;$api.get("/integrations/3dshapes?text="+$routeParams.query+"&page="+vm.resultsPage+"&perPage=24").then(function(result){var items=result.models;for(var i=0;i<items.length;i++){vm.threedshapes.push(items[i])}vm.busy=false;vm.resultsPage++})}function preview(){$rootScope.$emit("discover.preview","model")}function init(){var query=$routeParams.query;search3dshapes(query)}init();angular.extend(vm,{nextPage:nextPage,preview:preview})}MainController.$inject=["$auth","$api","$rootScope","$routeParams"];angular.module("component.discover.search",[]).controller("DiscoverSearchController",MainController)})();(function(){function PreviewController($api,$rootScope,$scope,$timeout,File,$location){var vm=this;var data=$scope.ngDialogData.data||{};vm.data=data;var modelfile_url="";modelfile_url=window.PATH.api+"/integrations/3dshapes/download/"+data.id+"?access_token="+window.localStorage.getItem("formide.auth:token");vm.id=data.id;function appFunction(file){var self=this;vm.viewerLoading=true;$scope.$apply();this.init=function(){formideSDK.showPrintBed({show:false});formideSDK.setCameraAutoRotationSpeed({speed:0});formideSDK.setBackgroundColor({r:255,g:255,b:255});formideSDK.addModel({url:modelfile_url},function(response,err){var settings=JSON.parse(window.localStorage.getItem("formide.viewer:settings"))||{};vm.viewerLoading=false;$scope.$apply();formideSDK.centerCameraOnModel({modelId:response.modelId});formideSDK.setModelColor({modelId:response.modelId,r:settings.defaultModelColor.r,g:settings.defaultModelColor.g,b:settings.defaultModelColor.b})})}}var appSettings={models:{xyzprinter:"./public/assets/data/models/simplePrinter.dae",deltaprinter:"./public/assets/data/models/deltaPrinter.dae",attachmentPoint:"./public/assets/data/models/attachmentPoint.dae",scalePivot:"./public/assets/data/models/scalePivot.obj",translatePivot:"./public/assets/data/models/translatePivot.obj",rotatePivot:"./public/assets/data/models/rotatePivot.obj",ruler:"./public/assets/data/models/ruler.obj",rotationRuler:"./public/assets/data/models/rulerRotation.obj"},materials:{scalePivot:"./public/assets/data/materials/scalePivot.mtl",translatePivot:"./public/assets/data/materials/translatePivot.mtl",rotatePivot:"./public/assets/data/materials/rotatePivot.mtl",ruler:"./public/assets/data/materials/ruler.mtl",virtualGrid:"./public/assets/data/materials/virtualGrid.tga"},api:{baseUrl:window.PATH.api,accessToken:window.localStorage.getItem("formide.auth:token")},toggleBedButton:false,editButtons:false,changeCamera:false};vm.downloading=[];function fileDifference(previous,current){var previousid=previous.map(function(val){if(typeof val==="object")return val.id});var currentid=current.map(function(val){if(typeof val==="object")return val.id});return currentid.filter(function(x){return previousid.indexOf(x)<0})}function downloadFile(id,name){if(!vm.downloading[id]){vm.downloading[id]={status:"downloading"};var previous=File.resource;$api.post("/files/upload/url",{filetype:"stl",filename:name,url:window.PATH.api+"/integrations/3dshapes/download/"+data.id+"?access_token="+window.localStorage.getItem("formide.auth:token")}).then(function(response){formideSDK.takeScreenshot({filename:"Screenshot "+response.uploadedFile.filename,modelfileId:response.uploadedFile.id},function(res){$timeout(function(){File.resource.push(JSON.parse(res).file);vm.downloading[data.id]=response;vm.downloading[data.id].success=true},1e3)})})}}function navigate(route){$location.path(route)}angular.extend(vm,{appFunction:appFunction,appSettings:appSettings,downloadFile:downloadFile,navigate:navigate})}function MainController($routeParams,$timeout,$location,$auth,$api,$rootScope,ngDialog){var vm=this;if($routeParams.childRoute===undefined){$timeout(function(){$location.path("discover/models")})}function doSearch(){var query=encodeURIComponent(vm.searchQuery).replace(/%20/g,"+");if(query.length>1){$location.path("/discover/search/"+query)}else{$location.path("/discover/models")}}function previewModal(type,data){ngDialog.open({template:"discover/previewModal.html",controller:"PreviewController",controllerAs:"modal",data:{type:type,data:data}})}angular.extend(vm,{routeConfig:MainController.$routeConfig,doSearch:doSearch,previewModal:previewModal})}MainController.$inject=["$routeParams","$timeout","$location","$auth","$api","$rootScope","ngDialog"];PreviewController.$inject=["$api","$rootScope","$scope","$timeout","File","$location"];MainController.$routeConfig=[{path:"/search/:query",component:{subView:"discoverSearch"},as:"discoverSearch"},{path:"/models",component:{subView:"discoverModels"},as:"discoverModels"}];angular.module("component.discover",[]).controller("PreviewController",PreviewController).controller("DiscoverController",MainController)})();(function(){function FileDetailsController(Printjob,Printer,File,Queue,$scope,$socket,$api,$rootScope,$timeout,$location,ngDialog,$window,$interval){var vm=this;vm.environmentLocation=window.ENV.location;if(vm.environmentLocation=="local"){$api.getAccessToken().then(function(access_token){vm.access_token=access_token;vm.imagesRootLocation=window.PATH.images})}else{vm.imagesRootLocation=window.PATH.images}vm.file=$scope.ngDialogData;vm.file.$resolved=false;vm.file.filetype=vm.file.filetype||"gcode";vm.activePrinterPort=Printer.$active.port;vm.loadingEdit=false;vm.tags=[];function selectedFilter(item){return item.$selected===true}function newPrintjob(models){var models=models||$filter("filter")(vm.file.resource,selectedFilter);printjobModal=ngDialog.open({template:"printjob/componentView.html",className:"printjob-dialog",controller:"ModalPrintjobController",controllerAs:"modal",data:models,preCloseCallback:function(){angular.element($window).unbind("keyup");if(vm.dialogAway){return false}else{return true}}});$scope.closeThisDialog()}File.resource.$single({id:vm.file.id,filetype:vm.file.filetype}).then(function(response){vm.file=response});$socket.socket.on("slicer.finished",function(data){File.resource.$single({id:vm.file.id,filetype:vm.file.filetype}).then(function(response){vm.file=response})});function detailsClass(){if(vm.editMode){className="u-1/1"}else{className="u-1/2-sm"}return className}function appFunction(file){var self=this;vm.viewerLoading=true;$rootScope.$apply();this.init=function(){formideSDK.showPrintBed({show:false});formideSDK.setCameraAutoRotationSpeed({speed:0});formideSDK.setBackgroundColor({r:255,g:255,b:255});formideSDK.addModel({url:window.PATH.api+"/files/download/?id="+vm.file.id+"&hash="+vm.file.hash+"&access_token="+window.localStorage.getItem("formide.auth:token")},function(response,err){vm.viewerLoading=false;$rootScope.$apply();var settings=JSON.parse(window.localStorage.getItem("formide.viewer:settings"))||{};if(typeof settings.defaultModelColor!=="object"){settings.defaultModelColor={r:70,g:97,b:230};window.localStorage.setItem("formide.viewer:settings",JSON.stringify(settings))}formideSDK.centerCameraOnModel({modelId:response.modelId});formideSDK.setModelColor({modelId:response.modelId,r:settings.defaultModelColor.r,g:settings.defaultModelColor.g,b:settings.defaultModelColor.b})})}}var appViewerSettings={models:{xyzprinter:"./public/assets/data/models/simplePrinter.dae",deltaprinter:"./public/assets/data/models/deltaPrinter.dae",attachmentPoint:"./public/assets/data/models/attachmentPoint.dae",scalePivot:"./public/assets/data/models/scalePivot.obj",translatePivot:"./public/assets/data/models/translatePivot.obj",rotatePivot:"./public/assets/data/models/rotatePivot.obj",ruler:"./public/assets/data/models/ruler.obj",rotationRuler:"./public/assets/data/models/rulerRotation.obj"},materials:{scalePivot:"./public/assets/data/materials/scalePivot.mtl",translatePivot:"./public/assets/data/materials/translatePivot.mtl",rotatePivot:"./public/assets/data/materials/rotatePivot.mtl",ruler:"./public/assets/data/materials/ruler.mtl",virtualGrid:"./public/assets/data/materials/virtualGrid.tga"},api:{baseUrl:window.PATH.api,accessToken:window.localStorage.getItem("formide.auth:token")},toggleBedButton:false,editButtons:false,changeCamera:false};function takeScreenshot(){vm.thumbnailLoading=true;formideSDK.takeScreenshot({filename:"Screenshot "+vm.file.filename,modelfileId:vm.file.id},function(res){$timeout(function(){vm.file.images=JSON.parse(res).data.images;vm.thumbnailLoading=false;$rootScope.$apply()},1e3)})}function removeScreenshot(index){vm.file.images.splice(index,1)}function saveModelfile(file,close){var close=close||false;File.resource.$update(file,function(){console.log("File updated");$rootScope.$emit("files.getFiles",false)});if(close){closeModal()}return true}function addToQueue(file,printjob){if(!Printer.$active.port||Printer.$active.deviceStatus!=="online"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){if(Printer.$active.port&&Printer.$active.deviceStatus=="online"){vm.addingToQueue=true;Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue");closeModal()})})}return true}})}else{if(Printer.$active.id){vm.addingToQueue=true;Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue");closeModal()})})}}}function removePrintjob(id){Printjob.resource.$remove({id:id},function(){for(var i in vm.file.printJobs){var printjob=vm.file.printJobs[i];if(printjob.id===id){vm.file.printJobs.splice(i,1)}}})}function closeModal(){$scope.closeThisDialog();return true}function toggleEdit(){vm.editMode=!vm.editMode;vm.loadingEdit=true;$timeout(function(){vm.loadingEdit=false},1e3)}function cancelEdit(){vm.editMode=false;vm.loadingEdit=true;$timeout(function(){vm.loadingEdit=false},1e3);return true}function additionalModel(item){return item.id!==vm.file.id}function openGcodeViewer(printjob){printjob=printjob||null;$scope.closeThisDialog();var data={printjob:printjob,file:vm.file};ngDialog.open({template:"gcode-viewer/componentView.html",controller:"GcodeViewerController",controllerAs:"modal",className:"printjob-dialog",data:data,showClose:true,trapFocus:false,preCloseCallback:function(){$interval.cancel($rootScope.animationInterval);if($rootScope.returnToDetails){if(vm.file.filetype=="text/gcode"){var className="gcode-details-modal"}else{var className="file-details-modal"}$timeout(function(){ngDialog.open({template:"files-details/fileDetailsModal.html",controller:"FileDetailsController",controllerAs:"modal",className:className,data:vm.file,showClose:true})},200)}return true}})}function downloadGcode(printjob){ngDialog.open({className:"ngdialog-info no-overlay",template:"gcode-download/componentView.html",controller:"DownloadGcodeModalController",controllerAs:"modal",data:printjob.gcode,trapFocus:false})}angular.extend(vm,{printer:Printer,appViewerSettings:appViewerSettings,appFunction:appFunction,takeScreenshot:takeScreenshot,removeScreenshot:removeScreenshot,saveModelfile:saveModelfile,toggleEdit:toggleEdit,cancelEdit:cancelEdit,closeModal:closeModal,newPrintjob:newPrintjob,selectedFilter:selectedFilter,addToQueue:addToQueue,removePrintjob:removePrintjob,additionalModel:additionalModel,detailsClass:detailsClass,openGcodeViewer:openGcodeViewer,downloadGcode:downloadGcode})}FileDetailsController.$inject=["Printjob","Printer","File","Queue","$scope","$socket","$api","$rootScope","$timeout","$location","ngDialog","$window","$interval"];angular.module("component.files.details",[]).controller("FileDetailsController",FileDetailsController)})();(function(){function FilePreUploadController($scope,File,ngDialog,Upload,$notification,$api,$rootScope,$timeout,$location){var vm=this;var containsZip=false;vm.environmentLocation=window.ENV.location;vm.loadingDrive=false;vm.loadingDropbox=false;if($scope.ngDialogData){vm.dragDrop=true;uploadFiles($scope.ngDialogData)}var access_token=window.localStorage.getItem("formide.auth:token");var uploadUrl=window.PATH.api+"/files/upload";var upload=function(files,errFiles){if(files&&files.length>0){if(!$rootScope.fileUploading){var parentFolder=$location.search().folder;if(parentFolder&&parentFolder!=0){uploadUrl=uploadUrl+"?parentFolder="+parentFolder}var data={headers:{Authorization:"Bearer "+access_token},url:uploadUrl,file:files};uploadFiles(data)}else{vm.URLerrorMessage="There is an upload already in progress, please wait for this to finish first."}}};function uploadFiles(data){$rootScope.fileUploading=true;for(var i=0;i<data.file.length;i++){if(data.file[i].name.substring(data.file[i].name.length-4,data.file[i].name.length)==".zip"){containsZip=true;break}}Upload.upload(data).then(function(response){$scope.closeThisDialog();ngDialog.open({template:"files-upload/fileUploadModal.html",controller:"FileUploadController",controllerAs:"modal",className:"file-upload-modal",data:{files:response.data.data,containsZip:containsZip},showClose:false,closeByEscape:false,closeByDocument:false})},function(response){if(response.status===400&&vm.environmentLocation==="local"){$notification.addNotification({title:"File Upload Failed",message:"File is too large to slice on the Element. Use the full power of the Cloud to slice larger models.",channel:"system",type:"error",duration:-1,actions:[{title:"Close",callback:function(){return true}},{title:"Use Formide",callback:function(){ngDialog.open({className:"ngdialog-info",template:"formide-info/componentView.html",controller:"FormideInfo",controllerAs:"modal",trapFocus:false});return true}}]})}else{$notification.addNotification({title:"File Upload Failed",message:response.data.message,channel:"system",type:"error"})}$rootScope.fileUploading=false;$rootScope.uploadProgress=0;ngDialog.closeAll()},function(evt){$rootScope.uploadProgress=parseInt(100*evt.loaded/evt.total);console.log("uploadProgress",$rootScope.uploadProgress)})}function submitDriveLink(){vm.URLerrorMessage="";if(vm.driveLink){if(!$rootScope.fileUploading){$rootScope.fileUploading=true;vm.loadingDrive=true;var link=vm.driveLink;var output=link.replace(/https:\/\/drive\.google\.com\/file\/d\//g,"");output=output.replace(/\/view\?usp=sharing/g,"");output=output.replace(/https:\/\/drive\.google\.com\/open\?id=/g,"");output="https://drive.google.com/uc?export=download&id="+output;uploadFromURL(output)}else{vm.URLerrorMessage="There is an upload already in progress, please wait for this to finish first."}}}function submitDropboxLink(){vm.URLerrorMessage="";if(vm.dropboxLink){if(!$rootScope.fileUploading){$rootScope.fileUploading=true;vm.loadingDropbox=true;var link=vm.dropboxLink;var output=link.replace("?dl=0","");output=output+"?dl=1";uploadFromURL(output)}else{vm.URLerrorMessage="There is an upload already in progress, please wait for this to finish first."}}}function uploadFromURL(url){$api.post("/files/upload/url",{filetype:"stl",filename:name,url:url}).then(function(response){vm.loadingDropbox=false;vm.loadingDrive=false;$scope.closeThisDialog();ngDialog.open({template:"files-upload/fileUploadModal.html",controller:"FileUploadController",controllerAs:"modal",className:"file-upload-modal",showClose:false,closeByEscape:false,closeByDocument:false,data:{files:response.uploadedFile,containsZip:false}})},function(data){console.log("error",data);if(data.statusCode==400&&data.message!=="The given URL has no downloadable file"){vm.URLerrorMessage=data.message}else{vm.URLerrorMessage="The file could not be uploaded. Please check that your link is correct and has the correct sharing permissions."}vm.loadingDropbox=false;vm.loadingDrive=false;$rootScope.fileUploading=false})}angular.extend(vm,{upload:upload,submitDriveLink:submitDriveLink,submitDropboxLink:submitDropboxLink})}FilePreUploadController.$inject=["$scope","File","ngDialog","Upload","$notification","$api","$rootScope","$timeout","$location"];angular.module("component.files.preUpload",[]).controller("FilePreUploadController",FilePreUploadController)})();(function(){function FileUploadController(Printjob,File,Queue,$scope,$socket,$rootScope,$timeout,$filter,$location){function uploadedFilter(item){item.upload=item.upload||{};return item.upload.uploading===true}var vm=this;var loadedFile;var currentModel=0;if($scope.ngDialogData.files){vm.model=$scope.ngDialogData.files[currentModel]}function loadedViewer(file){loadedFile=file}function appFunction(){var self=this;$rootScope.$applyAsync();this.init=function(){formideSDK.showPrintBed({show:false});formideSDK.setCameraAutoRotationSpeed({speed:0});formideSDK.setBackgroundColor({r:255,g:255,b:255});addModel(loadedFile)}}function addModel(model){vm.viewerLoading=true;formideSDK.addModel({url:window.PATH.api+"/files/download/?id="+model.id+"&hash="+model.hash+"&access_token="+window.localStorage.getItem("formide.auth:token")},function(response,err){vm.model.modelId=response.modelId;vm.viewerLoading=false;$rootScope.$applyAsync();var settings=JSON.parse(window.localStorage.getItem("formide.viewer:settings"))||{};formideSDK.centerCameraOnModel({modelId:response.modelId});formideSDK.setModelColor({modelId:response.modelId,r:settings.defaultModelColor.r,g:settings.defaultModelColor.g,b:settings.defaultModelColor.b})})}function removeModel(model){try{formideSDK.removeModel({modelId:model.modelId},function(response,err){formideSDK.unselectModel();formideSDK.refreshScene()})}catch(e){if(window.DEBUG){console.warn("Could not remove model!",e)}}}var appViewerSettings={models:{xyzprinter:"./public/assets/data/models/simplePrinter.dae",deltaprinter:"./public/assets/data/models/deltaPrinter.dae",attachmentPoint:"./public/assets/data/models/attachmentPoint.dae",scalePivot:"./public/assets/data/models/scalePivot.obj",translatePivot:"./public/assets/data/models/translatePivot.obj",rotatePivot:"./public/assets/data/models/rotatePivot.obj",ruler:"./public/assets/data/models/ruler.obj",rotationRuler:"./public/assets/data/models/rulerRotation.obj"},materials:{scalePivot:"./public/assets/data/materials/scalePivot.mtl",translatePivot:"./public/assets/data/materials/translatePivot.mtl",rotatePivot:"./public/assets/data/materials/rotatePivot.mtl",ruler:"./public/assets/data/materials/ruler.mtl",virtualGrid:"./public/assets/data/materials/virtualGrid.tga"},api:{baseUrl:window.PATH.api,accessToken:window.localStorage.getItem("formide.auth:token")},toggleBedButton:false,editButtons:false,changeCamera:false};function takeScreenshot(){vm.thumbnailLoading=true;formideSDK.takeScreenshot({filename:"Screenshot "+vm.file.filename,modelfileId:vm.file.id},function(res){$timeout(function(){vm.file.images.push(JSON.parse(res).imagefile);vm.thumbnailLoading=false;$rootScope.$applyAsync()},1e3)})}function removeScreenshot(item){var index=vm.file.images.indexOf(item);vm.file.images.splice(index,1)}function saveModelfile(file){var n=currentModel+1;switch(file.filetype){case"text/gcode":vm.thumbnailLoading=false;if(!$scope.ngDialogData.containsZip){File.resource.$add(file,function(){$rootScope.$emit("files.getFiles",false)})}break;default:formideSDK.takeScreenshot({filename:"Screenshot "+file.filename,modelfileId:file.id},function(res){vm.thumbnailLoading=false;$rootScope.$apply();if(!$scope.ngDialogData.containsZip){File.resource.$add(JSON.parse(res).data,function(){$rootScope.$emit("files.getFiles",false)})}})}if(n<$scope.ngDialogData.files.length){removeModel(vm.model);currentModel++;vm.model=$scope.ngDialogData.files[currentModel];addModel(vm.model)}else{if($scope.ngDialogData.containsZip){$rootScope.$emit("files.getFiles",true)}closeModal()}}function closeModal(){$rootScope.fileUploading=false;$rootScope.uploadProgress=0;$scope.closeThisDialog();return true}function cancelModelfile(file){var file=file;file.upload={};var n=currentModel+1;File.resource.$remove({file:file},function(){if(n===$scope.ngDialogData.files.length){$rootScope.$emit("files.getFiles",false)}});if(n<$scope.ngDialogData.files.length){removeModel(vm.model);currentModel++;vm.model=$scope.ngDialogData.files[currentModel];addModel(vm.model)}else{closeModal()}}angular.extend(vm,{appViewerSettings:appViewerSettings,appFunction:appFunction,takeScreenshot:takeScreenshot,removeScreenshot:removeScreenshot,saveModelfile:saveModelfile,loadedViewer:loadedViewer,cancelModelfile:cancelModelfile,closeModal:closeModal})}FileUploadController.$inject=["Printjob","File","Queue","$scope","$socket","$rootScope","$timeout","$filter","$location"];angular.module("component.files.upload",[]).controller("FileUploadController",FileUploadController)})();(function(){function MainController($routeParams,$rootScope,$location,$timeout,$filter,$auth,$api,$socket,$notification,Upload,ngDialog,File,Queue,$document,$window,Printer){var vm=this;vm.environmentLocation=window.ENV.location;if(vm.environmentLocation=="local"){$api.getAccessToken().then(function(access_token){vm.access_token=access_token;vm.imagesRootLocation=window.PATH.images})}else{vm.imagesRootLocation=window.PATH.images}var resultsPage=0;var resultsAvalible=true;var printjobModal={};var previousSelectedFiles=[];vm.$active={$resolved:false};vm.thumbnailhover=true;var userSettings={};File.resource.$promise.then(function(devices){vm.resolved=File.resource.$resolved});if(window.localStorage.getItem("formide.settings:files")&&vm.environmentLocation=="cloud"){userSettings=getSettings()}vm.filesSortBy=userSettings.filesSortBy||"createdAt";vm.sortOrder=userSettings.sortOrder||"-";vm.filesViewList=userSettings.filesViewList||false;vm.folderListOverlay=false;vm.filesSortOverlay=false;vm.filesFilterBy="all";vm.fileToMove={};vm.currentFolder={prettyname:"Library",id:0};vm.folderPath=[angular.copy(vm.currentFolder)];var pathFolder=$location.search().folder;if(pathFolder&&pathFolder!=0){File.resource.$single({id:pathFolder},function(response){vm.currentFolder=response;var folder={id:vm.currentFolder.id,prettyname:vm.currentFolder.prettyname};vm.folderPath.push(folder);if(response.parent!=null){addToPath(response.parent)}getFiles()})}else{getFiles()}function addToPath(id){File.resource.$single({id:id},function(response){var folder={id:response.id,prettyname:response.prettyname};vm.folderPath.splice(1,0,folder);if(response.parent!=null){addToPath(response.parent)}})}if(window.matchMedia("(max-width: 44.9375em)").matches){vm.palm=true}else{vm.palm=false}vm.checked=[];vm.addingToQueue=false;function newPrintjob(models){var models=models||$filter("filter")(vm.currentFolder.children,selectedFilter);previousSelectedFiles=angular.copy(models);printjobModal=ngDialog.open({template:"printjob/componentView.html",className:"printjob-dialog",controller:"ModalPrintjobController",controllerAs:"modal",data:models,preCloseCallback:function(){angular.element($window).unbind("keyup");if(vm.dialogAway){return false}else{return true}}})}function selectedFilter(item){return item.$selected===true}function selectedFilterSTL(item){return item.$selected===true&&item.filetype==="text/stl"}function removeModel(file){File.resource.$remove({file:file,deleteChildren:vm.deleteFolderContent,newParent:vm.currentFolder.id},function(){vm.currentFolder.children=File.resource})}function removeMultiple(files){for(var i=0;i<files.length;i++){var file=files[i];File.resource.$remove({file:file,deleteChildren:vm.deleteFolderContent,newParent:vm.currentFolder.id},function(response){vm.currentFolder.children=File.resource;if(!vm.deleteFolderContent&&vm.filesToDeleteFolder&&i==files.length){getFiles()}})}}function removeConfirmMultiple(files){vm.filesToDeleteFolder=false;vm.deleteFolderContent=false;vm.filesToDelete=files;for(var i=0;i<files.length;i++){if(files[i].filetype=="folder"){vm.filesToDeleteFolder=true;vm.deleteFolderContent=true;break}}}function downloadFile(files){vm.showMenuOverlay=false;for(var i=0;i<files.length;i++){var file=files[i];var url=window.PATH.api+"/files/download?id="+file.id+"&hash="+file.hash+"&access_token="+window.localStorage.getItem("formide.auth:token");window.open(url)}}function addToQueue(file){vm.addingToQueue=true;if(!Printer.$active.port||Printer.$active.deviceStatus!=="online"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){Queue.$addToQueue(file).then(function(response){$timeout(function(){vm.addingToQueue=false;$location.path("print/queue")})});vm.addingToQueue=false;return true}})}else{Queue.$addToQueue(file).then(function(response){$timeout(function(){vm.addingToQueue=false;$location.path("print/queue")})})}}function editModel(file){file.editing=true}function togglePublic(files){if(files.constructor===Array){for(var i in files){var file=files[i];file.public=!file.public;File.resource.$update(file)}}else{var file=files;file.public=!file.public;File.resource.$update(file)}}function upload(){ngDialog.open({template:"files-pre-upload/componentView.html",controller:"FilePreUploadController",controllerAs:"modal",className:"files-pre-upload",showClose:true,closeByEscape:false,closeByDocument:false})}function upload_local(files){if(files&&files.length>0&&!$rootScope.fileUploading){var access_token=window.localStorage.getItem("formide.auth:token");var uploadUrl=window.PATH.api+"/files/upload";var parentFolder=$location.search().folder;if(parentFolder&&parentFolder!=0){uploadUrl=uploadUrl+"?parentFolder="+parentFolder}var data={headers:{Authorization:"Bearer "+access_token},url:uploadUrl,file:files};ngDialog.open({template:"files-pre-upload/componentView.html",controller:"FilePreUploadController",controllerAs:"modal",className:"files-pre-upload",showClose:true,closeByEscape:false,closeByDocument:false,data:data})}}function toggleFileDetails(file){if(file.filetype=="folder"){selectFolder(file)}else{if(file.filetype=="text/gcode"){var className="gcode-details-modal"}else{var className="file-details-modal"}ngDialog.open({template:"files-details/fileDetailsModal.html",controller:"FileDetailsController",controllerAs:"modal",className:className,data:file,showClose:true})}}function sortToggle(){if(vm.filesSortOverlay){hideAllOverlays()}else{hideAllOverlays();vm.filesSortOverlay=true}}function filterToggle(){if(vm.filesFilterOverlay){hideAllOverlays()}else{hideAllOverlays();vm.filesFilterOverlay=true}}function deleteToggle(files){if(vm.deleteOverlay){hideAllOverlays()}else{hideAllOverlays();vm.deleteOverlay=true}removeConfirmMultiple(files)}function folderToggle(){if(vm.folderListOverlay){hideAllOverlays()}else{hideAllOverlays();vm.folderListOverlay=true}}function setFilesView(){vm.filesViewList=!vm.filesViewList;userSettings.filesViewList=vm.filesViewList;setSettings(userSettings)}function showMenu(event,file){hideAllOverlays();vm.showMenuOverlay=true;vm.menuData=file;vm.positionMenu=setMenuPosition(event)}function showGlobalMenu(event){hideAllOverlays();vm.showGlobalMenuOverlay=true;vm.positionGlobalMenu=setMenuPosition(event)}function setMenuPosition(event){var y=window.innerHeight;var x=document.getElementById("files").offsetWidth;var top=event.clientY;var left=event.clientX;if(top>y-240)top=y-240;if(left>x-270)left=x-270;var menuPosition={top:top+"px",left:left+"px"};return menuPosition}function handleDrop(folder){var files=[];for(var i in vm.currentFolder.children){if(vm.currentFolder.children[i].$selected&&vm.currentFolder.children[i].id!==folder.id){files.push(vm.currentFolder.children[i])}}addToFolder(files,folder)}function hideAllOverlays(){for(var i in vm.currentFolder.children){vm.currentFolder.children[i].showMenu=false}vm.showGlobalMenuOverlay=false;vm.showMenuOverlay=false;vm.deleteOverlay=false;vm.filesFilterOverlay=false;vm.filesSortOverlay=false;vm.folderListOverlay=false;vm.folderListMenu=false;vm.deleteListMenu=false}var previousSelected=0;var previousItems=[];vm.file=vm.file||[];var mouseselect=false;function documentClick(){if(!vm.dialogAway&&!mouseselect){for(var i in vm.currentFolder.children){vm.currentFolder.children[i].$selected=false}}else{mouseselect=false}hideAllOverlays()}$window.onmousedown=function(){documentClick();
};function checkKey(event){event=event||window.event;if(event.keyCode=="38"){event.preventDefault();event.stopPropagation();if(previousSelected>4){var index=previousSelected;previousSelected=index-4;selectOneFile(previousSelected)}}else if(event.keyCode=="40"){event.preventDefault();event.stopPropagation();if(previousSelected<vm.currentFolder.children.length-4){var index=previousSelected;previousSelected=index+4;selectOneFile(previousSelected)}}else if(event.keyCode=="37"){event.preventDefault();event.stopPropagation();if(previousSelected>0){var index=previousSelected;previousSelected=index-1;selectOneFile(previousSelected)}}else if(event.keyCode=="39"){event.preventDefault();event.stopPropagation();if(previousSelected<vm.currentFolder.children.length-1){var index=previousSelected;previousSelected=index+1;selectOneFile(previousSelected)}}else if(event.keyCode=="8"){if(event.ctrlKey||event.metaKey){var models=$filter("filter")(vm.currentFolder.children,selectedFilter);removeMultiple(models)}}}function selectOneFile(index){for(var i in vm.currentFolder.children){if(!isNaN(i)){if(i==index){vm.currentFolder.children[i].$selected=true||false}else{vm.currentFolder.children[i].$selected=false}}else{vm.currentFolder.children[i].$selected=false}}}function selectFile(index,event,file){if(!vm.dialogAway){if(window.matchMedia("(max-width: 44.9375em)").matches){toggleFileDetails(file)}else{event.preventDefault();event.stopPropagation();var index=vm.currentFolder.children.indexOf(file);if(event.ctrlKey||event.metaKey){console.info("Control- or Command Key Pressed");vm.currentFolder.children[index].$selected=!vm.currentFolder.children[index].$selected}else if(event.shiftKey){shiftSelect(index,file)}else{previousSelected=index;selectOneFile(index)}}}else{event.preventDefault();event.stopPropagation();if(event.shiftKey){shiftSelect(index,file)}else{vm.currentFolder.children[index].$selected=!vm.currentFolder.children[index].$selected;if(vm.currentFolder.children[index].$selected){previousSelected=index}}}}function shiftSelect(index,file){console.info("Shift Key Pressed");for(var i in vm.currentFolder.children){vm.currentFolder.children[i].$selected=false}if(previousSelected<index){for(var i=previousSelected;i<=index;i++){vm.currentFolder.children[i].$selected=true}}else if(previousSelected>index){for(var i=index;i<=previousSelected;i++){vm.currentFolder.children[i].$selected=true}}else{vm.currentFolder.children[index].$selected=true}}var x,xi,y,yi,h,w,yo,ys,offset;vm.dragbox=false;vm.dragboxStyle={};offset=document.getElementById("main__header").offsetHeight;function drawRectangle(event){if(vm.mousedown&&!vm.filesViewList&&!event.ctrlKey&&!event.metaKey&&!event.shiftKey){mouseselect=true;if(vm.dragbox==false){vm.dragbox=true;ys=document.getElementById("main__content").scrollTop>0?document.getElementById("main__content").scrollTop:$window.pageYOffset;x=event.clientX;yo=event.clientY-offset;y=yo+ys;xi=document.getElementById("files").offsetWidth-x;yi=document.getElementById("files").offsetHeight-y}w=event.clientX-x;h=event.clientY-offset-yo;for(var i in vm.currentFolder.children){vm.currentFolder.children[i].$selected=false}if(h>=0&&w>=0){vm.dragboxStyle={top:y+"px",left:x+"px",height:h+"px",width:w+"px"};var top1=y;var bottom1=top1+h;var left1=x;var right1=left1+w;selectFilesRectangle(top1,bottom1,left1,right1,function(top1,bottom1,left1,right1,top2,bottom2,left2,right2){if(bottom1>top2&&top1<bottom2&&right1>left2&&left1<right2&&(top1<top2||left1<left2))return true;return false})}else if(h<0&&w>=0){vm.dragboxStyle={bottom:yi+"px",left:x+"px",height:h*-1+"px",width:w+"px"};var top1=y-h*-1;var bottom1=y;var left1=x;var right1=left1+w;selectFilesRectangle(top1,bottom1,left1,right1,function(top1,bottom1,left1,right1,top2,bottom2,left2,right2){if(top1<bottom2&&bottom1>top2&&right1>left2&&left1<right2&&(bottom1>bottom2||left1<left2))return true;return false})}else if(h>=0&&w<0){vm.dragboxStyle={top:y+"px",right:xi+"px",height:h+"px",width:w*-1+"px"};var top1=y;var bottom1=top1+h;var left1=x-w*-1;var right1=x;selectFilesRectangle(top1,bottom1,left1,right1,function(top1,bottom1,left1,right1,top2,bottom2,left2,right2){if(bottom1>top2&&top1<bottom2&&right1>left2&&left1<right2&&(top1<top2||right1>right2))return true;return false})}else if(h<0&&w<0){vm.dragboxStyle={bottom:yi+"px",right:xi+"px",height:h*-1+"px",width:w*-1+"px"};var top1=y-h*-1;var bottom1=y;var left1=x-w*-1;var right1=x;selectFilesRectangle(top1,bottom1,left1,right1,function(top1,bottom1,left1,right1,top2,bottom2,left2,right2){if(top1<bottom2&&bottom1>top2&&right1>left2&&left1<right2&&(bottom1>bottom2||right1>right2))return true;return false})}}}function selectFilesRectangle(top1,bottom1,left1,right1,overlap){for(var i=0;i<vm.currentFolder.children.length;i++){var top2=document.getElementById("file"+vm.currentFolder.children[i].id).offsetTop;var bottom2=top2+document.getElementById("file"+vm.currentFolder.children[i].id).offsetHeight;var left2=document.getElementById("file"+vm.currentFolder.children[i].id).offsetLeft;var right2=left2+document.getElementById("file"+vm.currentFolder.children[i].id).offsetWidth;if(overlap(top1,bottom1,left1,right1,top2,bottom2,left2,right2)){vm.currentFolder.children[i].$selected=true}}}function removeRectangle(){vm.dragbox=false}function renameFile(file){file.filename=file.prettyname;File.resource.$update(file,function(){console.log("Folder name updated")})}function createFolder(files){var parent;if(vm.currentFolder.id==0){parent=null}else{parent=vm.currentFolder.id}if(files){File.resource.$create({filename:"newly created folder",parent:parent,files:files},function(files,folder){addToFolder(files,folder)})}else{File.resource.$create({filename:"newly created folder",parent:parent},function(){vm.currentFolder.children=File.resource})}}function addToFolder(files,folder,cb){for(var i=0;i<files.length;i++){var file=files[i];if(folder.id==0){file.parent=null}else{file.parent=folder.id}File.resource.$move(file,function(){vm.currentFolder.children=File.resource;if(cb&&typeof cb=="function"){cb()}})}vm.fileToMove=[];vm.folderListOverlay=false}function selectFolder(folder){vm.currentFolder.id=folder.id;vm.currentFolder.prettyname=folder.prettyname;var path={id:folder.id,prettyname:folder.prettyname};vm.folderPath.push(path);$location.search("folder",folder.id);if(vm.dialogAway){previousSelectedFiles=previousSelectedFiles.concat($filter("filter")(vm.currentFolder.children,selectedFilterSTL))}}function selectParentFolder(folder){vm.currentFolder.id=folder.id;vm.currentFolder.prettyname=folder.prettyname;for(var i=0;i<vm.folderPath.length;i++){if(vm.currentFolder.id==vm.folderPath[i].id){vm.folderPath=vm.folderPath.slice(0,i+1);break}}$location.search("folder",folder.id);if(vm.dialogAway){previousSelectedFiles=previousSelectedFiles.concat($filter("filter")(vm.currentFolder.children,selectedFilterSTL))}}function reSelectFiles(){for(var i in vm.currentFolder.children){for(var j in previousSelectedFiles){if(vm.currentFolder.children[i].id&&vm.currentFolder.children[i].id==previousSelectedFiles[j].id){vm.currentFolder.children[i].$selected=true;previousSelectedFiles.splice(j,1);if(j==0){previousSelected=i}break}}}}function clearFolder(){$location.search("folder",null)}var files_updateFiles=$rootScope.$on("files.getFiles",function(event,fullRefresh){event.stopPropagation();if(fullRefresh){getFiles()}else{vm.currentFolder.children=File.resource}});var files_urlChange=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/files"){return false}pathFolder=$location.search().folder;if(pathFolder==0||!pathFolder){vm.currentFolder={prettyname:"Library",id:0};vm.folderPath=[angular.copy(vm.currentFolder)];getFiles(null,null,function(){if(vm.dialogAway){reSelectFiles()}})}else if(vm.currentFolder.id!=pathFolder){var previousFolder=vm.currentFolder;File.resource.$single({id:pathFolder},function(response){vm.currentFolder=response;var parent=vm.currentFolder.parent||0;if(previousFolder.id==parent){var path={id:vm.currentFolder.id,prettyname:vm.currentFolder.prettyname};vm.folderPath.push(path)}else{var found=false;for(var i=0;i<vm.folderPath.length;i++){if(vm.currentFolder.id==vm.folderPath[i].id){vm.folderPath=vm.folderPath.slice(0,i+1);found=true;break}}if(!found){for(var i=0;i<vm.folderPath.length;i++){if(vm.currentFolder.id==vm.folderPath[i].id){vm.folderPath=vm.folderPath.slice(0,i+1);break}}vm.folderPath=[];var path={id:0,prettyname:"Library"};vm.folderPath.push(path);path={id:vm.currentFolder.id,prettyname:vm.currentFolder.prettyname};vm.folderPath.push(path);if(response.parent!=null){addToPath(response.parent)}}}getFiles(null,null,function(){if(vm.dialogAway){reSelectFiles()}})})}else{getFiles(null,null,function(){if(vm.dialogAway){reSelectFiles()}})}});var files_addMore=$rootScope.$on("files.addMore",function(event,state){vm.dialogAway=state;var dialog=document.querySelector("#"+document.getElementsByClassName("printjob-dialog")[0].id);if(state){dialog.className="ngdialog printjob-dialog printjob-dialog--addMore ng-scope";reSelectFiles()}else{dialog.className="ngdialog printjob-dialog ng-scope"}});function backToPrintjob(){var models=previousSelectedFiles.concat($filter("filter")(vm.currentFolder.children,selectedFilterSTL));previousSelectedFiles=angular.copy(models);if(models.length>0){$rootScope.$emit("files.addMore",false);$rootScope.$broadcast("files.addMore.files",models)}else{$notification.addNotification({title:"No models selected",message:"Please select a model before returning to the viewer",type:"error"})}}function setFilesSortBy(sort){if(vm.filesSortBy==sort){if(vm.sortOrder=="-"){vm.sortOrder="+"}else{vm.sortOrder="-"}}else{vm.filesSortBy=sort}userSettings.filesSortBy=vm.filesSortBy;userSettings.sortOrder=vm.sortOrder;setSettings(userSettings)}function getFiles(applyFilters,loadNextPage,cb){vm.resolved=false;applyFilters=applyFilters||false;loadNextPage=loadNextPage||false;var params={};if(applyFilters){if(vm.filesFilterBy!=="all"){params.filetype=vm.filesFilterBy}if(vm.filesSearchValue){params.prettyname=vm.filesSearchValue}}else{vm.filesSearchValue=null;vm.filesFilterBy="all"}if(loadNextPage){params.resultsPage=resultsPage}else{resultsPage=0;resultsAvalible=true}if(vm.currentFolder.id!=0){params.parent=vm.currentFolder.id}params.sort=vm.filesSortBy;params.sortOrder=vm.sortOrder;File.resource.$load(params,function(count){if(count>0){resultsAvalible=true}else{resultsAvalible=false}vm.currentFolder.children=File.resource;vm.resolved=true;if(cb&&typeof cb=="function"){cb()}})}function getNextPage(){if(!vm.resolved||!resultsAvalible||vm.environmentLocation=="local")return;resultsPage++;getFiles(true,true)}function getSettings(){return JSON.parse(window.localStorage.getItem("formide.settings:files"))}function setSettings(result){window.localStorage.setItem("formide.settings:files",JSON.stringify(result))}function loadedViewer(){}var files_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/files"){files_urlChange();files_updateFiles();files_addMore();files_clearUp()}});angular.extend(vm,{file:File,upload:upload,upload_local:upload_local,removeMultiple:removeMultiple,renameFile:renameFile,newPrintjob:newPrintjob,backToPrintjob:backToPrintjob,removeModel:removeModel,removeConfirmMultiple:removeConfirmMultiple,editModel:editModel,selectedFilter:selectedFilter,selectedFilterSTL:selectedFilterSTL,addToQueue:addToQueue,togglePublic:togglePublic,loadedViewer:loadedViewer,toggleFileDetails:toggleFileDetails,selectFile:selectFile,checkKey:checkKey,downloadFile:downloadFile,createFolder:createFolder,addToFolder:addToFolder,selectFolder:selectFolder,selectParentFolder:selectParentFolder,getFiles:getFiles,handleDrop:handleDrop,drawRectangle:drawRectangle,removeRectangle:removeRectangle,documentClick:documentClick,showMenu:showMenu,showGlobalMenu:showGlobalMenu,setFilesSortBy:setFilesSortBy,setFilesView:setFilesView,sortToggle:sortToggle,filterToggle:filterToggle,deleteToggle:deleteToggle,folderToggle:folderToggle,getNextPage:getNextPage})}MainController.$inject=["$routeParams","$rootScope","$location","$timeout","$filter","$auth","$api","$socket","$notification","Upload","ngDialog","File","Queue","$document","$window","Printer"];MainController.$routeConfig=[{path:"/:fileType/:fileId",component:{subView:"filesActive"},as:"filesActive"}];angular.module("component.files",[]).filter("propsFilter",function(){return function(items,props){var out=[];if(angular.isArray(items)){items.forEach(function(item){var itemMatches=false;var keys=Object.keys(props);for(var i=0;i<keys.length;i++){var prop=keys[i];var text=props[prop].toLowerCase();if(item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=true;break}}if(itemMatches){out.push(item)}})}else{out=items}return out}}).directive("focus",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.focus);scope.$watch(model,function(value){if(value===true){$timeout(function(){element[0].focus()})}});element.bind("blur",function(){scope.$apply(model.assign(scope,false))})}}}).directive("ngRightClick",function($parse){return function(scope,element,attrs){var fn=$parse(attrs.ngRightClick);element.bind("contextmenu",function(event){scope.$apply(function(){event.preventDefault();fn(scope,{$event:event})})})}}).controller("FilesController",MainController)})();(function(){function FormideInfo($location){var vm=this;function connectToCloud(){var url="http://"+$location.$$host+":1337";window.location=url}angular.extend(vm,{connectToCloud:connectToCloud})}FormideInfo.$inject=["$location"];angular.module("component.formide-info",[]).controller("FormideInfo",FormideInfo)})();(function(){function DownloadGcodeModalController($scope){var gcode=$scope.ngDialogData;function downloadGcode(){var url=window.PATH.api+"/files/download/gcode?hash="+gcode+"&access_token="+window.localStorage.getItem("formide.auth:token");window.location.href=url;$scope.closeThisDialog()}angular.extend(this,{downloadGcode:downloadGcode})}DownloadGcodeModalController.$inject=["$scope"];angular.module("component.gcode-download",[]).controller("DownloadGcodeModalController",DownloadGcodeModalController)})();(function(){function GcodeViewerController($scope,ngDialog,Printer,Queue,$window,$timeout,$socket,$rootScope,$location,Printjob){var vm=this;vm.environmentLocation=window.ENV.location;$rootScope.returnToDetails=true;vm.loadingModels=true;vm.loadingPrintjob=true;var file=$scope.ngDialogData.file||{};vm.filetype=file.filetype||"live";if(vm.filetype=="live"){vm.hideAside=true;vm.hideAsideToggle=true}Printer.$active.status=Printer.$active.status||"offline";vm.printjob=$scope.ngDialogData.printjob;if(vm.filetype!=="text/gcode"&&(typeof vm.printjob.sliceProfile!=="object"||typeof vm.printjob.printer!=="object")){var printjobId=$scope.ngDialogData.printjob.id;Printjob.resource.$single({id:printjobId},function(response){vm.printjob=response;vm.loadingPrintjob=false})}else{vm.loadingPrintjob=false}var printerType;if(Printer.$active.bed&&Printer.$active.bed.printerType=="DELTA"&&Printer.$active.bed.placeOfOrigin=="CENTER"){printerType="round"}else{printerType="xyz"}function hideSettings(){vm.hideAside=true;var canvas=document.getElementById("3d-viewer");canvas.style.height="1074px";canvas.style.margin="-150px 0 0 0";canvas.style.width="100%";if(vm.filetype!=="live"){var key=document.getElementById("gcode-key");key.style.margin="0 0 0 4rem"}}function showSettings(){vm.hideAside=false;var canvas=document.getElementById("3d-viewer");canvas.style.height="725px";canvas.style.margin="0 0 0 0";canvas.style.width="100%";var key=document.getElementById("gcode-key");key.style.margin="0 0 0 0"}function downloadGcodeModal(){ngDialog.open({className:"ngdialog-info no-overlay",template:"gcode-download/componentView.html",controller:"DownloadGcodeModalController",controllerAs:"modal",data:vm.printjob.gcode,trapFocus:false})}function choosePrinter(){var data={readytoPrint:false};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:data,preCloseCallback:function(){Printer.$active.status=Printer.$active.status||"offline";formideSDK.unselectModel();setupPrinter();formideSDK.refreshScene();return true}})}function setupPrinter(){if(Printer.$active.bed){try{var r=Printer.$active.bed.diameter/2||Printer.$active.bed.x/2;var printerType;if(Printer.$active.bed.printerType=="DELTA"&&Printer.$active.bed.placeOfOrigin=="CENTER"){printerType="round"}else{printerType="xyz"}appSettings.printer.type=printerType;formideSDK.setPrintSize({x:Printer.$active.bed.x,y:Printer.$active.bed.y,z:Printer.$active.bed.z,r:r},function(response,err){formideSDK.showPrintBed({show:true,type:printerType});formideSDK.resetCameraPosition();formideSDK.centerCameraOnBed()})}catch(e){console.error("Failed setting printer bed size",e)}}else{console.info("No printer selected, defaulting to standard bed size!");formideSDK.showPrintBed({show:true,type:"xyz"})}}function newPrintjob(){$rootScope.returnToDetails=false;$scope.closeThisDialog();$timeout(function(){printjobModal=ngDialog.open({template:"printjob/componentView.html",className:"printjob-dialog",controller:"ModalPrintjobController",controllerAs:"modal",data:vm.printjob,preCloseCallback:function(){angular.element($window).unbind("keyup");if(vm.dialogAway){return false}else{return true}}})},500)}function addToQueue(){if(!Printer.$active.port||Printer.$active.deviceStatus!=="online"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){Queue.$addToQueue(file,vm.printjob).then(function(response){$timeout(function(){$rootScope.returnToDetails=false;$location.path("print/queue");$scope.closeThisDialog()})});return true}})}else{Queue.$addToQueue(file,vm.printjob).then(function(response){$timeout(function(){$rootScope.returnToDetails=false;$location.path("print/queue");$scope.closeThisDialog()})})}}function appFunction(){var self=this;this.init=function(){formideSDK.setBackgroundColor({r:255,g:255,b:255});if(vm.filetype=="text/gcode"){var url=window.PATH.api+"/files/download?id="+file.id+"&hash="+file.hash+"&access_token="+window.localStorage.getItem("formide.auth:token")}else{var gcodeId=$scope.ngDialogData.printjob.gcode;var url=window.PATH.api+"/files/download/gcode?hash="+gcodeId+"&access_token="+window.localStorage.getItem("formide.auth:token")}var client=new XMLHttpRequest;client.open("GET",url,true);client.onreadystatechange=function(){if(client.readyState===4){gcode=client.responseText;formideSDK.addModel({contents:gcode,type:"GCODE"},function(response,err){console.log("done");vm.loadingModels=false;if(vm.filetype=="live"){updateGcodeAnimation=true}})}};client.send()}}var appSettings={models:{xyzprinter:"./public/assets/data/models/simplePrinter.dae",deltaprinter:"./public/assets/data/models/deltaPrinter.dae",attachmentPoint:"./public/assets/data/models/attachmentPoint.dae",scalePivot:"./public/assets/data/models/scalePivot.obj",translatePivot:"./public/assets/data/models/translatePivot.obj",rotatePivot:"./public/assets/data/models/rotatePivot.obj",ruler:"./public/assets/data/models/ruler.obj",rotationRuler:"./public/assets/data/models/rulerRotation.obj"},materials:{scalePivot:"./public/assets/data/materials/scalePivot.mtl",translatePivot:"./public/assets/data/materials/translatePivot.mtl",rotatePivot:"./public/assets/data/materials/rotatePivot.mtl",ruler:"./public/assets/data/materials/ruler.mtl",virtualGrid:"./public/assets/data/materials/virtualGrid.tga"},api:{baseUrl:window.PATH.api,accessToken:window.localStorage.getItem("formide.auth:token")},toggleBedtype:"toggle",colorButton:false,editButtons:false,changeCamera:false,gcodeFilters:vm.filetype!=="live"?true:false,printer:{size:{x:Printer.$active.bed?Printer.$active.bed.x:200,y:Printer.$active.bed?Printer.$active.bed.y:200,z:Printer.$active.bed?Printer.$active.bed.z:200,r:Printer.$active.bed?Printer.$active.bed.diameter/2||Printer.$active.bed.x/2:140},type:printerType}};angular.extend(vm,{appFunction:appFunction,appSettings:appSettings,hideSettings:hideSettings,showSettings:showSettings,downloadGcodeModal:downloadGcodeModal,newPrintjob:newPrintjob,addToQueue:addToQueue,printer:Printer,choosePrinter:choosePrinter})}GcodeViewerController.$inject=["$scope","ngDialog","Printer","Queue","$window","$timeout","$socket","$rootScope","$location","Printjob"];function DownloadGcodeModalController($scope){var gcode=$scope.ngDialogData;function downloadGcode(){$scope.closeThisDialog();var url=window.PATH.api+"/files/download/gcode?hash="+gcode+"&access_token="+window.localStorage.getItem("formide.auth:token");window.open(url)}angular.extend(this,{downloadGcode:downloadGcode})}DownloadGcodeModalController.$inject=["$scope"];angular.module("component.gcode-viewer",[]).controller("GcodeViewerController",GcodeViewerController)})();(function(){function MainController($auth,$api,$routeParams,$notification,$socket,$interval,$location){var vm=this;vm.device=null;vm.deviceUpdateStatus={};vm.deviceUpdateNeeded={};vm.updateResponse="";var promise;var start=function(){stop();promise=$interval(function(){if(vm.valuenow<99){vm.valuenow++}},6e3)};var stop=function(){$interval.cancel(promise)};vm.valuenow=0;function navigate(route){$location.path(route)}function getUpdateStatus(){$api.get("/update/status").then(function(data,status,headers,config){vm.deviceUpdateStatus=data})}function getUpdateNeeded(){$api.get("/update/check").then(function(data,status,headers,config){vm.deviceUpdateNeeded=data})}vm.updating=false;function doUpdate(){vm.updating=true;start();$api.post("/update/do").then(function(data,status,headers,config){vm.updateResponse=data})}$socket.socket.on("device.connected",function(data){});function init(){getUpdateStatus();getUpdateNeeded()}vm.updated=false;$socket.socket.on("device.connected",function(data){if(data.device==$routeParams.deviceId){stop();vm.valuenow=100;vm.updating=true;vm.updated=true;init()}});init();angular.extend(vm,{doUpdate:doUpdate,getUpdateNeeded:getUpdateNeeded,navigate:navigate})}MainController.$inject=["$auth","$api","$routeParams","$notification","$socket","$interval","$location"];angular.module("component.manage.device.update",[]).controller("ManageDeviceUpdateController",MainController)})();(function(){function UpdateController($api,$rootScope,$scope,$notification){var vm=this;function submitForm(user){$api.users.update(user).then(function(response){$notification.addNotification({title:"Settings Saved",message:"Device Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.user.saved",true);return true},function(e){$notification.addNotification({title:e.error.error,message:e.error.summary,channel:"system",type:"error"})})}angular.extend(vm,{submitForm:submitForm,user:$scope.ngDialogData})}function CreateController($api,$rootScope,$scope,$notification){var vm=this;var user={};function submitForm(user){$api.users.create(user).then(function(data,status,headers,config){$rootScope.$emit("modal.user.saved",true);return true})}angular.extend(vm,{submitForm:submitForm,user:user})}function InviteController($api,$rootScope,$scope,$notification){var vm=this;var user={};vm.ssids=[];function submitInvite(user){$api.post("/auth/invite",{email:user.email}).then(function(response){$notification.addNotification({title:"Settings Saved",message:"Device Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.user.saved",true);return true},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{submitInvite:submitInvite,user:user})}function MainController($auth,$api,$rootScope,ngDialog,$notification,$timeout,$location){var vm=this;vm.wifi={};function navigate(route){$location.path(route)}function getUsers(){$api.users.query().then(function(response){vm.users=response})}function getDiskspace(){$api.get("/files/diskspace").then(function(response){vm.diskspace=response})}vm.network={};function getNetwork(){$api.get("/cloud/network").then(function(response){vm.network=response})}function getSSIDs(){$api.get("/cloud/networks").then(function(response){vm.ssids=[];for(var key in response){vm.ssids.push(response[key])}})}function resetWifi(){$notification.addNotification({title:"Reset Wi-Fi ",message:"Are you sure? This will cause the devcice to emit its Wi-Fi network, and you will need to connect to it again.",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){$api.post("/cloud/setup").then(function(response){$notification.addNotification({title:"Settings Reset",message:"Wi-Fi settings reset, you will be redirected.",channel:"system",type:"success"});$rootScope.$emit("modal.user.saved",true);$timeout(function(){window.location="http://platform.formide.com"},2e3);return true},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})});return true}}],popup:true})}function connectWifi(){$api.post("/cloud/wifi",vm.wifi).then(function(response){$notification.addNotification({title:"Settings Saved",message:"Wi-Fi Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.user.saved",true);return true},function(e){$location.$$path="/manage/device";$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"});$timeout(function(){$rootScope.setSidebarShow()},1e3)});$location.$$path="/connectWifi"}getSSIDs();getNetwork();this.submitForm=function(){};function updateModal(user){ngDialog.open({template:"settingsModal",controller:"ModalUsersUpdateController",controllerAs:"modal",data:user})}function createModal(){ngDialog.open({template:"settingsModal",controller:"ModalUsersCreateController",controllerAs:"modal"})}function inviteModal(){ngDialog.open({template:"inviteModal",controller:"ModalUsersInviteController",controllerAs:"modal"})}function deleteUser(user){$notification.addNotification({title:"Delete "+user.email,message:"Are you sure?",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){$api.users.delete({id:user.id}).then(function(response){init()});return true}}],popup:true})}var manageDevice_userSaved=$rootScope.$on("modal.user.saved",function(event,data){init();event.stopPropagation()});function init(){getUsers();getDiskspace()}var auth=$auth;init();var manageDevice_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/device"){manageDevice_userSaved();manageDevice_clearUp()}});angular.extend(vm,{getUsers:getUsers,updateModal:updateModal,createModal:createModal,inviteModal:inviteModal,deleteUser:deleteUser,connectWifi:connectWifi,resetWifi:resetWifi,navigate:navigate})}MainController.$inject=["$auth","$api","$rootScope","ngDialog","$notification","$timeout","$location"];InviteController.$inject=["$api","$rootScope","$scope","$notification"];UpdateController.$inject=["$api","$rootScope","$scope","$notification"];CreateController.$inject=["$api","$rootScope","$notification"];angular.module("component.manage.device",[]).controller("ManageDeviceController",MainController).controller("ModalUsersUpdateController",UpdateController).controller("ModalUsersCreateController",CreateController).controller("ModalUsersInviteController",InviteController)})();(function(){function LocalInterface($api,$rootScope,$scope,$location,$timeout){var vm=this;vm.connectingLocal=false;function connectToLocal(){vm.connectingError=false;if($scope.ngDialogData.device){vm.connectingLocal=true;var url="http://"+$scope.ngDialogData.device.session.ip_internal+":8080/";window.location=url;$timeout(function(){vm.connectingLocal=false;vm.connectingError=true;window.stop()},15e3)}else{vm.connectingError=true}}angular.extend(vm,{connectToLocal:connectToLocal})}function MainController($auth,$api,$routeParams,$notification,$socket,$timeout,$location,$rootScope,ngDialog){var vm=this;vm.imagesRootLocation=window.PATH.images;vm.device={};vm.sessions=[];vm.me={};function navigate(route){$location.path(route)}function getDevice(){$api.get("/devices/"+$routeParams.deviceId).then(function(data,status,headers,config){vm.device=data;getDeviceUsers()})}function getDeviceUsers(){$api.get("/devices/"+vm.device.id+"/users").then(function(data,status,headers,config){vm.deviceUsers=data})}function getAccount(){switch(window.ENV.location){case"cloud":try{$api.get("/me").then(function(data,status,headers,config){vm.me=data})}catch(e){vm.me={}}break;default:vm.me={}}}function permissionChanged(deviceUser){$api.put("/devices/"+vm.device.id+"/users/"+deviceUser.id,{isAdmin:deviceUser.isAdmin}).then(function(response){$notification.addNotification({title:"User Permissions Saved",message:response.message,channel:"system",type:"success"})})}function removedeviceUser(deviceUser){if(deviceUser){$api.delete("/devices/"+vm.device.id+"/users/"+deviceUser.id).then(function(response){$notification.addNotification({title:"User Removed",message:response.message,channel:"system",type:"success"});getDeviceUsers()})}else{$api.delete("/devices/"+vm.device.id).then(function(response){$notification.addNotification({title:"Revoked Access",message:response.message,channel:"system",type:"success"});$timeout(function(){$location.path("manage/devices")})});$rootScope.$emit("formide.device:removed",vm.device.id)}}function sendInvitations(emails){emails=emails.match(/[^\r\n,]+/g)||[];for(var i in emails){if(typeof emails[i]=="string"){$api.post("/devices/"+vm.device.id+"/users",{email:emails[i]}).then(function(response){getDeviceUsers()})}}$notification.addNotification("Invitations Sent",emails.length+" users have been invited","success","system");vm.inviteEmail=""}function revokeOwnership(){if(!vm.device||!vm.device.status||vm.device.status=="offline"){$notification.addNotification({title:"Revoke Ownership",message:"Your device is offline, and so the Wi-Fi cannot be reset. You can continue to revoke ownership, but the Wi-Fi will need to be reset manually later on",urlLink:{href:"https://formide.zendesk.com/hc/en-us/articles/206865349-The-Element-is-not-emitting-a-network",pretext:"More information on how manually reset your Wi-Fi can be found",text:"here"},type:"info",duration:-1,popup:true,actions:[{title:"Cancel",callback:function(){return true}},{title:"Continue",callback:function(){$api.post("/devices/"+vm.device.id+"/revokeownership/").then(function(response){$notification.addNotification({title:"Revoked Ownership",message:response.message,channel:"system",type:"success"});$rootScope.$emit("formide.device:removed",vm.device.id);$timeout(function(){$location.path("manage/devices")},200)});return true}}]})}else{$notification.addNotification({title:"Revoke Ownership",message:"Are you sure you want to revoke ownership of this device?",duration:-1,type:"info",actions:[{title:"Cancel",callback:function(){return true}},{title:"Continue",callback:function(){$api.post("/devices/"+vm.device.id+"/api/cloud/setup").then(function(response){$api.post("/devices/"+vm.device.id+"/revokeownership/").then(function(response){$notification.addNotification({title:"Revoked Ownership",message:response.message,channel:"system",type:"success"});$rootScope.$emit("formide.device:removed",vm.device.id);$timeout(function(){$location.path("manage/devices")},200)})});return true}}],popup:true})}}function goToLocalInterface(){ngDialog.open({className:"ngdialog-info",template:"localInterfaceModal",controller:"ModalLocalInterface",controllerAs:"modal",data:{device:vm.device}})}$socket.socket.on("device.connected",function(data){getDevice()});$socket.socket.on("device.disconnected",function(data){
getDevice()});getDevice();getAccount();angular.extend(vm,{permissionChanged:permissionChanged,removedeviceUser:removedeviceUser,sendInvitations:sendInvitations,revokeOwnership:revokeOwnership,goToLocalInterface:goToLocalInterface,navigate:navigate})}MainController.$inject=["$auth","$api","$routeParams","$notification","$socket","$timeout","$location","$rootScope","ngDialog"];LocalInterface.$inject=["$api","$rootScope","$scope","$location","$timeout"];angular.module("component.manage.devices.info",[]).controller("ManageDevicesInfoController",MainController).controller("ModalLocalInterface",LocalInterface)})();(function(){function MainController($auth,$api,$routeParams,$notification,$socket,$location){var vm=this;vm.device=null;vm.sessions=[];function getDevice(){$api.get("/devices/"+$routeParams.deviceId).then(function(data,status,headers,config){vm.device=data})}function getDeviceSessions(){$api.get("/devices/"+$routeParams.deviceId+"/sessions",{limit:20,sort:"-createdAt"}).then(function(data,status,headers,config){vm.sessions=data})}function navigate(route){$location.path(route)}$socket.socket.on("device.connected",function(data){getDevice();getDeviceSessions()});$socket.socket.on("device.disconnected",function(data){getDevice();getDeviceSessions()});getDevice();getDeviceSessions();angular.extend(vm,{navigate:navigate})}MainController.$inject=["$auth","$api","$routeParams","$notification","$socket","$location"];angular.module("component.manage.devices.sessions",[]).controller("ManageDevicesSessionsController",MainController)})();(function(){function MainController($timeout,$location){$timeout(function(){$location.path("manage/devices")})}MainController.$inject=["$timeout","$location"];angular.module("component.manage.devices.setup",[]).controller("ManageDevicesSetupController",MainController)})();(function(){function UpdatingController($scope){var vm=this;function close(){$scope.closeThisDialog()}angular.extend(vm,{close:close})}function MainController($auth,$api,$routeParams,$notification,$socket,$interval,ngDialog,Printer,$location){var vm=this;var deviceRootUrl="/devices/"+$routeParams.deviceId;vm.device=null;vm.deviceUpdateStatus={};vm.deviceUpdateNeeded={};vm.deviceBusy=false;vm.loadingPrinters=true;vm.updateResponse="";Printer.resource.$promise.then(function(data){vm.loadingPrinters=false});function getDevice(){$api.get("/devices/"+$routeParams.deviceId).then(function(data,status,headers,config){vm.device=data})}function checkDeviceBusy(){for(var i=0;i<Printer.resource.length;i++){if(Printer.resource[i].device&&Printer.resource[i].device.id==$routeParams.deviceId&&(Printer.resource[i].status==="printing"||Printer.resource[i].status==="paused"||Printer.resource[i].status=="heating")){return true}}return false}var promise;var start=function(){stop();promise=$interval(function(){if(vm.valuenow<99){vm.valuenow++}},6e3)};var stop=function(){$interval.cancel(promise)};vm.valuenow=0;function navigate(route){$location.path(route)}function getUpdateStatus(){$api.get(deviceRootUrl+"/api/update/status").then(function(data,status,headers,config){vm.deviceUpdateStatus=data})}function getUpdateNeeded(){$api.get(deviceRootUrl+"/api/update/check").then(function(data,status,headers,config){vm.deviceUpdateNeeded=data})}vm.updating=false;function doUpdate(){if(!checkDeviceBusy()){vm.deviceBusy=false;ngDialog.open({className:"ngdialog-info",template:"updating",controller:"ModalUpdating",controllerAs:"modal",trapFocus:false});vm.updating=true;start();$api.post(deviceRootUrl+"/api/update/do").then(function(data,status,headers,config){vm.updateResponse=data})}else{vm.deviceBusy=true}}$socket.socket.on("device.connected",function(data){});function init(){getDevice();getUpdateStatus();getUpdateNeeded()}vm.updated=false;$socket.socket.on("device.connected",function(data){if(data.device==$routeParams.deviceId){stop();vm.valuenow=100;vm.updating=true;vm.updated=true;init()}});$socket.socket.on("device.disconnected",function(data){getDevice()});init();angular.extend(vm,{doUpdate:doUpdate,getUpdateNeeded:getUpdateNeeded,navigate:navigate})}MainController.$inject=["$auth","$api","$routeParams","$notification","$socket","$interval","ngDialog","Printer","$location"];UpdatingController.$inject=["$scope"];angular.module("component.manage.devices.update",[]).controller("ManageDevicesUpdateController",MainController).controller("ModalUpdating",UpdatingController)})();(function(){function MainController($auth,$api,$socket,$rootScope,ngDialog,$location){var vm=this;vm.devices=[];vm.filterKeyword="";vm.setupLocation=window.PATH.setup;function getDevices(){vm.invite=false;$api.get("/devices").then(function(response){vm.devices=response;vm.invite=true})}function deviceFilter(item){return item.name.indexOf(vm.filterKeyword)!=-1||JSON.stringify(item.tags).indexOf(vm.filterKeyword)!=-1}getDevices();var manageDevices_deviceUpdated=$rootScope.$on("formide.device:updated",function(event,data){getDevices()});var deviceSortFunction=function(device){switch(device.status){case"online":return 4;break;default:return 7;break}};$socket.socket.on("device.connected",function(data){getDevices()});$socket.socket.on("device.disconnected",function(data){getDevices()});var manageDevices_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/devices"){manageDevices_deviceUpdated();manageDevices_clearUp()}});angular.extend(vm,{deviceFilter:deviceFilter,deviceSortFunction:deviceSortFunction})}MainController.$inject=["$auth","$api","$socket","$rootScope","ngDialog","$location"];angular.module("component.manage.devices",[]).controller("ManageDevicesController",MainController)})();(function(){function UpdateController($api,$rootScope,$scope,$notification,Material){var vm=this;vm.presets=false;vm.material=angular.copy($scope.ngDialogData);function submitForm(material){Material.resource.$update(material,function(response){$notification.addNotification({title:"Settings Saved",message:"Materials Settings Saved",channel:"system",type:"success"});$scope.closeThisDialog();$rootScope.$emit("modal.materials.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{submitForm:submitForm})}function CreateController($api,$rootScope,$scope,$notification,Material){var vm=this;vm.environmentLocation=window.ENV.location;vm.presets=[];vm.material={};function initPresets(){vm.preset={bedTemperature:75,feedRate:100,filamentDiameter:1750,firstLayersBedTemperature:75,firstLayersTemperature:220,name:"Generic-PLA",temperature:220,type:"PLA"};presetChanged()}function getPresets(query){var url="/preset/materials?";var queryParams={};if(query&&query.length>1){url+="filter[name]=:name&type[name]=regexi&";queryParams.name=query}url+="sort=+name&limit=24";$api.get(url,queryParams).then(function(response){vm.presets=response})}function presetChanged(){var material=angular.copy(vm.preset);vm.material.name=material.name;vm.material.type=material.type;vm.material.temperature=material.temperature;vm.material.firstLayersTemperature=material.firstLayersTemperature;vm.material.bedTemperature=material.bedTemperature;vm.material.firstLayersBedTemperature=material.firstLayersBedTemperature;vm.material.feedRate=material.feedRate}getPresets();function submitForm(material){Material.resource.$save(material,function(response){$notification.addNotification({title:"Settings Saved",message:"Materials Settings Saved",channel:"system",type:"success"});$scope.closeThisDialog();$rootScope.$emit("modal.materials.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{submitForm:submitForm,getPresets:getPresets,presetChanged:presetChanged,initPresets:initPresets})}function MainController($auth,$api,$rootScope,ngDialog,$notification,$timeout,$location,$http,Material){var vm=this;vm.environmentLocation=window.ENV.location;vm.routeParams=$location.search();var resultsPage=0;var resultsAvalible=true;var userSettings={};if(window.localStorage.getItem("formide.settings:materials")&&vm.environmentLocation=="cloud"){userSettings=getSettings()}vm.sort=userSettings.sort||"createdAt";vm.sortOrder=userSettings.sortOrder||"-";vm.$resolved=false;Material.resource.$promise.then(function(){getMaterials()});function getSettings(){return JSON.parse(window.localStorage.getItem("formide.settings:materials"))}function setSettings(result){window.localStorage.setItem("formide.settings:materials",JSON.stringify(result))}function getMaterials(){vm.materials=Material.resource;vm.$resolved=true}function setSortBy(sort){if(vm.sort==sort){if(vm.sortOrder=="-"){vm.sortOrder="+"}else{vm.sortOrder="-"}}else{vm.sort=sort}getMaterials();userSettings.sort=vm.sort;userSettings.sortOrder=vm.sortOrder;setSettings(userSettings)}function addAsPreset(printer){$http.post(vm.routeParams.redirectUri+printer.id,{}).then(function(response){$notification.addNotification({title:"Preset Added",message:"Printer Preset Added",channel:"system",type:"success"})},function(response){console.error("Error adding preset",response)})}function updateModal(material){ngDialog.open({template:"settingsModal",controller:"ModalMaterialsUpdateController",controllerAs:"modal",data:material,trapFocus:false})}function createModal(){ngDialog.open({template:"settingsModal",controller:"ModalMaterialsCreateController",controllerAs:"modal"})}function deleteMaterial(material){$notification.addNotification({title:"Delete "+material.name,message:"Are you sure?",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){Material.resource.$remove({id:material.id},function(){getMaterials()});return true}}],popup:true})}var manageMaterials_materialSaved=$rootScope.$on("modal.materials.saved",function(event,data){getMaterials();event.stopPropagation()});var auth=$auth;var manageMaterials_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/materials"){manageMaterials_materialSaved();manageMaterials_clearUp()}});angular.extend(vm,{getMaterials:getMaterials,updateModal:updateModal,createModal:createModal,deleteMaterial:deleteMaterial,addAsPreset:addAsPreset,setSortBy:setSortBy})}MainController.$inject=["$auth","$api","$rootScope","ngDialog","$notification","$timeout","$location","$http","Material"];UpdateController.$inject=["$api","$rootScope","$scope","$notification","Material"];CreateController.$inject=["$api","$rootScope","$scope","$notification","Material"];angular.module("component.manage.materials",[]).controller("ManageMaterialsController",MainController).controller("ModalMaterialsUpdateController",UpdateController).controller("ModalMaterialsCreateController",CreateController)})();(function(){function UpdateController($api,$rootScope,$scope,Printer,Device,$notification,$location){var vm=this;vm.environmentLocation=window.ENV.location;vm.devices=[];vm.ports=[];vm.refreshingPorts=false;vm.printer=angular.copy($scope.ngDialogData);function getDevices(){$api.get("/devices").then(function(response){vm.devices=response})}if(vm.environmentLocation=="cloud"){getDevices()}var managePrinters_update_deviceUpdated=$rootScope.$on("formide.device:updated",function(){getDevices()});function submitForm(printer){if(printer.extruders.length<1){$notification.addNotification({title:"Extruder Missing",message:"Please add at least one extruder!",channel:"system",type:"error"})}else{Printer.resource.$update(printer,function(response){$notification.addNotification({title:"Settings Saved",message:"Printer Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.printers.saved",true)})}}function addExtruder(item){vm.printer.extruders.push({name:"New Extruder",nozzleSize:vm.printer.extruders[0].nozzleSize,filamentDiameter:vm.printer.extruders[0].filamentDiameter})}function removeExtruder(item){if(vm.printer.extruders.length<2){$notification.addNotification({title:"Extruder Missing",message:"You need to have at least one extruder!",channel:"system",type:"error"})}else{var index=vm.printer.extruders.indexOf(item);vm.printer.extruders.splice(index,1)}}function addCustomCommand(item){vm.printer.customCommands=vm.printer.customCommands||[];vm.printer.customCommands.push({label:"New Custom Command",command:"G28"})}function removeCustomCommand(item){var index=vm.printer.customCommands.indexOf(item);vm.printer.customCommands.splice(index,1)}function getAvailablePorts(){vm.ports=[];if(vm.printer&&(vm.printer.device||vm.environmentLocation=="local")){vm.refreshingPorts=true;if(vm.environmentLocation=="local"){var call="/printer"}else{var call="/devices/"+vm.printer.device.id+"/api/printer"}var found=false;$api.get(call).then(function(ports){vm.refreshingPorts=false;for(var i in ports){if(vm.printer.port===ports[i].port)found=true;if(ports.hasOwnProperty(i)){vm.ports.push({port:ports[i].port,status:ports[i].status})}}if(!found){vm.ports.push({port:vm.printer.port,status:"disconnected"})}},function(){vm.refreshingPorts=false;vm.ports.push({port:vm.printer.port,status:"disconnected"});console.error})}}getAvailablePorts();var managePrinters_update_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/printers"){managePrinters_update_deviceUpdated();managePrinters_update_clearUp()}});angular.extend(vm,{submitForm:submitForm,addExtruder:addExtruder,removeExtruder:removeExtruder,addCustomCommand:addCustomCommand,removeCustomCommand:removeCustomCommand,getAvailablePorts:getAvailablePorts})}function MainController($location,$auth,$api,$rootScope,Printer,ngDialog,$notification,$timeout,$http,$socket){var vm=this;vm.environmentLocation=window.ENV.location;var resultsPage=0;var resultsAvalible=true;var userSettings={};if(window.localStorage.getItem("formide.settings:printers")&&vm.environmentLocation=="cloud"){userSettings=getSettings()}vm.sort=userSettings.sort||"createdAt";vm.sortOrder=userSettings.sortOrder||"-";vm.printer=[];vm.user={};vm.$resolved=false;Printer.resource.$promise.then(function(devices){getPrinters()});vm.routeParams=$location.search();function getSettings(){return JSON.parse(window.localStorage.getItem("formide.settings:printers"))}function setSettings(result){window.localStorage.setItem("formide.settings:printers",JSON.stringify(result))}switch(window.ENV.location){case"cloud":$api.get("/me/full").then(function(data,status,headers,config){vm.user=data});break;default:}$socket.socket.on("printer.connected",function(data){Printer.resource.$promise.then(function(result){if(!foundPrinter(Printer.resource,data)){vm.selectedPort=data.port;vm.unknownPrinter={device:data.device||"Local device",port:data.port}}})});var managePrinters_printerSetup=$rootScope.$on("modal.printers.setup",function(){vm.unknownPrinter=false});$socket.socket.on("printer.disconnected",function(data){vm.unknownPrinter=false});function setSortBy(sort){if(vm.sort==sort){if(vm.sortOrder=="-"){vm.sortOrder="+"}else{vm.sortOrder="-"}}else{vm.sort=sort}userSettings.sort=vm.sort;userSettings.sortOrder=vm.sortOrder;setSettings(userSettings)}function printerSetupDialog(){if(vm.unknownPrinter){$rootScope.printerSetupDialog(vm.unknownPrinter.device,vm.unknownPrinter.port,true)}else{$rootScope.printerSetupDialog()}}function addAsPreset(printer){$http.post(vm.routeParams.redirectUri+printer.id,{}).then(function(response){},function(response){console.error("Error adding preset",response)})}function updateModal(printer){ngDialog.open({template:"settingsModal",controller:"ModalPrintersUpdateController",controllerAs:"modal",data:printer,trapFocus:false})}function createModal(){ngDialog.open({template:"settingsModal",controller:"ModalPrintersCreateController",controllerAs:"modal"})}function deletePrinter(printer){$notification.addNotification({title:"Delete "+printer.name,message:"Are you sure?",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){Printer.resource.$remove({id:printer.id},function(){if(printer.selected){$rootScope.$emit("formide.printer:selectedRemoved",true)}getPrinters()});return true}}],popup:true})}function getPrinters(){vm.printer=Printer.resource;vm.$resolved=true}var managePrinters_printerSaved=$rootScope.$on("modal.printers.saved",function(event,data){getPrinters();event.stopPropagation()});var auth=$auth;var managePrinters_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/printers"){managePrinters_printerSaved();managePrinters_printerSetup();managePrinters_clearUp()}});angular.extend(vm,{updateModal:updateModal,createModal:createModal,deletePrinter:deletePrinter,addAsPreset:addAsPreset,printerSetupDialog:printerSetupDialog,setSortBy:setSortBy,getPrinters:getPrinters})}MainController.$inject=["$location","$auth","$api","$rootScope","Printer","ngDialog","$notification","$timeout","$http","$socket"];UpdateController.$inject=["$api","$rootScope","$scope","Printer","Device","$notification","$location"];angular.module("component.manage.printers",[]).controller("ManagePrintersController",MainController).controller("ModalPrintersUpdateController",UpdateController)})();(function(){function extractDefaults(data){var object={};for(var i in data){if(data[i].default==undefined&&data[i].options==undefined){object[i]=extractDefaults(data[i])}else{object[i]=data[i].default}}return object}function AdvancedUpdateController($api,$rootScope,$scope,$notification,Sliceprofile){var vm=this;vm.slicePreference=window.localStorage.getItem("formide.settings:slicePreference")||"quick";vm.tabs={};vm.activeTab="fan";vm.update=true;vm.types={};vm.sliceProfile={};function setSlicePreference(preference){vm.slicePreference=preference;window.localStorage.setItem("formide.settings:slicePreference",preference)}$api.req("GET","/slicer/reference").then(function(data,status,headers,config){vm.types=data.sliceProfile;vm.sliceprofile=extractDefaults(data.sliceProfile);angular.merge(vm.sliceprofile,$scope.ngDialogData);for(var i in data.sliceProfile){vm.tabs[i]=data.sliceProfile[i]}vm.jsonSliceprofileSettings=JSON.stringify(vm.sliceprofile.settings);vm.katanaVersion=data.version});function selectTab(tabName){vm.activeTab=tabName}function submitForm(sliceprofile){Sliceprofile.resource.$update(sliceprofile,function(response){$notification.addNotification({title:"Settings Saved",message:"Slice Profile Settings Saved",channel:"system",type:"success"});$scope.closeThisDialog();$rootScope.$emit("modal.sliceprofile.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{setSlicePreference:setSlicePreference,submitForm:submitForm,selectTab:selectTab})}function AdvancedCreateController($api,$rootScope,$scope,$notification,Upload,Sliceprofile){var vm=this;vm.environmentLocation=window.ENV.location;vm.slicePreference=window.localStorage.getItem("formide.settings:slicePreference")||"quick";vm.tabs={};vm.activeTab="fan";vm.update=false;vm.types={};vm.preset={};vm.presets=[];vm.sliceprofile={};$api.req("GET","/slicer/reference").then(function(data,status,headers,config){vm.types=data.sliceProfile;for(var i in data.sliceProfile){vm.tabs[i]=data.sliceProfile[i]}vm.katanaVersion=data.version});function getPresets(query){var url="/preset/sliceprofiles?";var queryParams={};if(query){url+="filter[name]=:name&type[name]=regexi&";queryParams.name=query}url+="sort=+name&limit=24";$api.get(url,queryParams).then(function(response){vm.presets=response})}function presetChanged(){var sliceProfile=angular.copy(vm.preset);vm.sliceprofile.name=sliceProfile.name;vm.sliceprofile.settings=sliceProfile.settings;vm.jsonSliceprofileSettings=JSON.stringify(vm.sliceprofile.settings)}getPresets();vm.jsonSliceprofileSettings=JSON.stringify(vm.sliceprofile.settings);function setSlicePreference(preference){vm.slicePreference=preference;window.localStorage.setItem("formide.settings:slicePreference",preference)}var access_token=window.localStorage.getItem("formide.auth:token");var upload=function(files){if(files&&files.length){var file=files[0];Upload.upload({headers:{Authorization:"Bearer "+access_token},url:window.PATH.api+"/db/sliceprofiles/cura",file:file}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total)}).success(function(data,status,headers,config){$scope.closeThisDialog();$notification.addNotification({title:"Settings Saved",message:data.message,channel:"system",type:"success"});$rootScope.$emit("modal.sliceprofile.saved",true)})}};function selectTab(tabName){vm.activeTab=tabName}function submitForm(sliceprofile){Sliceprofile.resource.$save(sliceprofile,function(response){$notification.addNotification({title:"Settings Saved",message:"Slice profile Settings Saved",channel:"system",type:"success"});$scope.closeThisDialog();$rootScope.$emit("modal.sliceprofile.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{submitForm:submitForm,sliceprofile:$scope.ngDialogData,selectTab:selectTab,upload:upload,setSlicePreference:setSlicePreference,getPresets:getPresets,presetChanged:presetChanged})}function MainController($auth,$api,$rootScope,ngDialog,$notification,$location,$http,Sliceprofile,$timeout,$location){var vm=this;vm.environmentLocation=window.ENV.location;var resultsPage=0;var resultsAvalible=true;var userSettings={};if(window.localStorage.getItem("formide.settings:sliceprofiles")&&vm.environmentLocation=="cloud"){userSettings=getSettings()}vm.sort=userSettings.sort||"createdAt";vm.sortOrder=userSettings.sortOrder||"-";vm.routeParams=$location.search();vm.sliceprofiles=[];vm.$resolved=false;Sliceprofile.resource.$promise.then(function(){getSliceprofiles()});function getSettings(){return JSON.parse(window.localStorage.getItem("formide.settings:sliceprofiles"))}function setSettings(result){window.localStorage.setItem("formide.settings:sliceprofiles",JSON.stringify(result))}var defaultSliceprofile={};defaultSliceprofile.name="New Slice Profile";$api.req("GET","/slicer/reference").then(function(data,status,headers,config){defaultSliceprofile.settings=extractDefaults(data.sliceProfile)});function getSliceprofiles(loadNextPage){vm.sliceprofiles=Sliceprofile.resource;vm.$resolved=true}function setSortBy(sort){if(vm.sort==sort){if(vm.sortOrder=="-"){vm.sortOrder="+"}else{vm.sortOrder="-"}}else{vm.sort=sort}userSettings.sort=vm.sort;userSettings.sortOrder=vm.sortOrder;setSettings(userSettings)}function advancedUpdateModal(sliceprofile){ngDialog.open({template:"advancedSettingsModal",controller:"ModalSliceprofilesAdvancedUpdateController",controllerAs:"modal",data:sliceprofile,trapFocus:false})}function advancedCreateModal(sliceprofile){ngDialog.open({template:"advancedSettingsModal",controller:"ModalSliceprofilesAdvancedCreateController",controllerAs:"modal",data:defaultSliceprofile})}function deleteSliceprofile(sliceprofile){$notification.addNotification({title:"Delete "+sliceprofile.name,message:"Are you sure?",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){Sliceprofile.resource.$remove({id:sliceprofile.id},function(){getSliceprofiles()});return true}}],popup:true})}var manageSliceprofiles_sliceprofileSaved=$rootScope.$on("modal.sliceprofile.saved",function(event,data){getSliceprofiles();event.stopPropagation()});var auth=$auth;var manageSliceprofiles_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/manage/sliceprofiles"){manageSliceprofiles_sliceprofileSaved();manageSliceprofiles_clearUp()}});angular.extend(vm,{getSliceprofiles:getSliceprofiles,advancedUpdateModal:advancedUpdateModal,advancedCreateModal:advancedCreateModal,deleteSliceprofile:deleteSliceprofile,setSortBy:setSortBy})}MainController.$inject=["$auth","$api","$rootScope","ngDialog","$notification","$location","$http","Sliceprofile","$timeout","$location"];AdvancedUpdateController.$inject=["$api","$rootScope","$scope","$notification","Sliceprofile"];AdvancedCreateController.$inject=["$api","$rootScope","$scope","$notification","Upload","Sliceprofile"];angular.module("component.manage.sliceprofiles",[]).controller("ManageSliceprofilesController",MainController).controller("ModalSliceprofilesAdvancedUpdateController",AdvancedUpdateController).controller("ModalSliceprofilesAdvancedCreateController",AdvancedCreateController).directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var lastValid;ngModelCtrl.$parsers.push(fromUser);ngModelCtrl.$formatters.push(toUser);element.bind("blur",function(){element.val(toUser(scope.$eval(attrs.ngModel)))});scope.$watch(attrs.ngModel,function(newValue,oldValue){lastValid=lastValid||newValue;if(newValue!=oldValue){ngModelCtrl.$setViewValue(toUser(newValue));ngModelCtrl.$render()}},true);function fromUser(text){if(!text||text.trim()===""){return{}}else{try{lastValid=angular.fromJson(text);ngModelCtrl.$setValidity("invalidJson",true)}catch(e){ngModelCtrl.$setValidity("invalidJson",false)}return lastValid}}function toUser(object){return angular.toJson(object,true)}}}}).filter("trustedIcon",function($sce){return function(ss){return"("+$sce.trustAsHtml(ss)+")"}})})();(function(){function MainController($router,$routeParams,$timeout,$location,$auth){var vm=this;vm.environmentLocation=window.ENV.location;try{if($routeParams.childRoute===undefined){$timeout(function(){if(vm.environmentLocation=="local"){$location.path("manage/device")}else{$location.path("manage/devices")}})}}catch(e){}angular.extend(vm,{routeConfig:MainController.$routeConfig})}MainController.$inject=["$router","$routeParams","$timeout","$location","$auth"];MainController.$routeConfig=[{path:"/",redirectTo:"/"},{path:"/devices",parent:"/manage",nav:{name:"Devices",title:"Device Settings"},env:"cloud",component:{subView:"manageDevices"},as:"manageDevices"},{path:"/devices/setup",parent:"/manage",component:{subView:"manageDevicesSetup"},env:"cloud",as:"manageDevicesSetup"},{path:"/devices/:deviceId",parent:"/manage",component:{subView:"manageDevicesInfo"},env:"cloud",as:"manageDevicesInfo"},{path:"/devices/:deviceId/sessions",parent:"/manage",component:{subView:"manageDevicesSessions"},env:"cloud",as:"manageDevicesSessions"},{path:"/devices/:deviceId/update",parent:"/manage",component:{subView:"manageDevicesUpdate"},env:"cloud",as:"manageDevicesUpdate"},{path:"/device",parent:"/manage",nav:{name:"Device",title:"Device Settings"},env:"local",component:{subView:"manageDevice"},as:"manageDevice"},{path:"/device/update",parent:"/manage",component:{subView:"manageDeviceUpdate"},env:"local",as:"manageDeviceUpdate"},{path:"/printers",parent:"/manage",nav:{name:"Printers",title:"Manage Printers"},component:{subView:"managePrinters"},as:"managePrinters"},{path:"/sliceprofiles",parent:"/manage",nav:{name:"Slice Profiles",title:"Manage Slice Profiles"},component:{subView:"manageSliceprofiles"},as:"manageSliceprofiles"},{path:"/materials",parent:"/manage",nav:{name:"Materials",title:"Manage Material"},component:{subView:"manageMaterials"},as:"manageMaterials"}];angular.module("component.manage",[]).controller("ManageController",MainController)})();(function(){function MainController($rootScope,$scope,$location,$api,$http,$notification,$interval,Device,Printer,$timeout){var vm=this;vm.currentStep=$scope.ngDialogData.currentStep;vm.printerSetupDialog=$rootScope.printerSetupDialog;vm.onboarding=$rootScope.onboarding;vm.loading=false;var registrationToken=$location.search().registration_token;vm.environmentLocation=window.ENV.location;vm.setupLocation=window.PATH.setup||"http://setup.formide.com";function useFormide(){window.localStorage.setItem("formide.onboarding:success","true");$scope.closeThisDialog()}function redirectToSetup(){vm.loadErrorMessage="";window.localStorage.setItem("formide.onboarding:success","true");window.location="http://10.20.30.40/";$timeout(function(){vm.loadErrorMessage="Ensure that you are connected to the Element's Wi-Fi before you continue"},7500);$timeout(function(){window.stop()},15e3)}vm.connectedToElement=false;vm.connectedToElement=true;function register(){$api.put("/devices/register/"+registrationToken).then(function(response){$notification.addNotification({title:"Device Registered",message:"Succesfully connected device to your acount",channel:"device",type:"success"});$location.path("manage/devices")},function(e){$notification.addNotification({title:"Unable to register",message:e.message,channel:"system",type:"error"})})}var wasOffline=false;vm.continueSetup=true;vm.cloudCode={};function submitCloudCode(){vm.loading=true;var code=vm.cloudCode.c1+vm.cloudCode.c2+vm.cloudCode.c3+vm.cloudCode.c4+vm.cloudCode.c5;$api.post("/devices/register/code/"+code).then(function(response){if(response.device){$notification.addNotification({title:"Device Registered",message:"Succesfully connected device to your acount",channel:"device",type:"success"});$rootScope.$emit("formide.device:added",response.deviceUser.device,response.deviceUser.name);$location.path("manage/devices");vm.setupDevice=response.device;vm.loading=false;vm.currentStep="setupIntegratedFinished"}else{vm.loading=false;vm.setupDeviceError="Cloud Code was invalid. Please generate a new code on your printer and try again";vm.cloudCode={};document.getElementById("cloudCode_c1").focus()}},function(e){vm.loading=false;vm.setupDeviceError="Cloud Code was invalid. Please generate a new code on your printer and try again";vm.cloudCode={};document.getElementById("cloudCode_c1").focus()})}function setupIntegratedFinished(){var port="";if(vm.setupDevice.deviceType=="integrated_felix"){port="/dev/ttyS1"}else if(vm.setupDevice.deviceType=="integrated_builder"){port="/dev/ttyACM0"}vm.printerSetupDialog(vm.setupDevice.id,port,true);$scope.closeThisDialog()}angular.extend(vm,{device:Device,printer:Printer,useFormide:useFormide,redirectToSetup:redirectToSetup,register:register,setupIntegratedFinished:setupIntegratedFinished,submitCloudCode:submitCloudCode})}MainController.$inject=["$rootScope","$scope","$location","$api","$http","$notification","$interval","Device","Printer","$timeout"];angular.module("component.onboarding",[]).controller("OnboardingController",MainController)})();(function(){function MainController($auth,Printer,printerCtrl){var vm=this;var commands={move:[function(cmd,args){printerCtrl.move(args[0],args[1]);return"Moved "+args[0]+"-axis "+args[1]+"mm"},"axis(char) amount(float)"],extrude:[function(cmd,args){printerCtrl.extruder(args[0]).extrude(args[1]);return"Extruding extruder "+args[0]+" "+args[1]+"mm"},"ext_number(int) amount(float)"],retract:[function(cmd,args){printerCtrl.extruder(args[0]).retract("-"+args[1]);return"Retracting extruder "+args[0]+" "+args[1]+"mm"},"ext_number(int) amount(float)"],temp:[function(cmd,args){printerCtrl.extruder(args[0]).temperature(args[1]);return"Set extruder "+args[0]+" temperature to "+args[1]+" degrees"},"ext_number(int) temperature(int)"],bedtemp:[function(cmd,args){printerCtrl.bed.temperature(args[0]);return"Set bed temerature to "+args[0]+" degrees"},"temperature(int)"],gcode:[function(cmd,args){printerCtrl.gcode(args[0]);return"Executed GCODE "+args[0]},"command(gcode)"],steppers:[function(cmd,args){switch(args[0]){case"on":printerCtrl.gcode("M17");return"Powering steppers on";break;case"off":printerCtrl.gcode("M18");return"Powering steppers off";break}},"power(on|off)"],home:[function(cmd,args){switch(args[0]){case"x":printerCtrl.home.x();return"Homing X axis";break;case"y":printerCtrl.home.y();return"Homing Y axis";break;case"z":printerCtrl.home.z();return"Homing Z axis";break;default:printerCtrl.home.all();return"Homing all axis"}},"axis(string)"]};angular.extend(vm,{printer:Printer,commands:commands})}MainController.$inject=["$auth","Printer","printerCtrl"];
angular.module("component.print.console",[]).controller("PrintConsoleController",MainController)})();(function(){function MainController($rootScope,$api,$auth,printerCtrl,Printer,$socket,$interval,$timeout,$location){var vm=this;vm.environmentLocation=window.ENV.location;vm.devices=[];function getDevices(){$api.get("/devices").then(function(response){vm.devices=response})}getDevices();vm.targetTempExt=[];vm.tuneGcode={printSpeed:"M220 S",flowRate:"M221 S",fanSpeed:"M106 S",extTemp:"M104 S",bedTemp:"M140 S"};var updateTuneValues=true;Printer.resource.$promise.then(function(data){vm.maxExtTemp=Printer.$active.maxTemperature||450;vm.maxBedTemp=Printer.$active.maxBedTemperature||100});var printControls_printerUpdated=$rootScope.$on("formide.printer:updated",function(){vm.maxExtTemp=Printer.$active.maxTemperature||450;vm.maxBedTemp=Printer.$active.maxBedTemperature||100});$socket.socket.on("printer.status",function(resource){if(updateTuneValues){vm.printSpeed=Printer.$active.speedMultiplier;vm.flowRate=Printer.$active.flowRate;vm.fanSpeed=Printer.$active.fanSpeed}});var timer;var printControls_printerTune=$rootScope.$on("formide.printer:tune",function(){updateTuneValues=false;$timeout.cancel(timer);timer=$timeout(function(){updateTuneValues=true},1e4)});function navigate(route){$location.path(route)}function runCustomCommand(command){var commands=command.split(", ");for(var i=0;i<commands.length;i++){printerCtrl.gcode(commands[i])}}function runExtruderCommand(index){if(checkValue(vm.targetTempExt[index])&&(Printer.$active.status=="printing"||Printer.$active.status=="paused"||Printer.$active.status=="heating")){if(index>0){printerCtrl.tune(vm.tuneGcode.extTemp+vm.targetTempExt[index]+" T"+index)}else{printerCtrl.tune(vm.tuneGcode.extTemp+vm.targetTempExt[index])}}else if(checkValue(vm.targetTempExt[index])){printerCtrl.extruder(index).temperature(vm.targetTempExt[index])}}function runBedCommand(){if(checkValue(vm.targetTempBed)&&(Printer.$active.status=="printing"||Printer.$active.status=="paused"||Printer.$active.status=="heating")){printerCtrl.tune(vm.tuneGcode.bedTemp+vm.targetTempBed)}else if(checkValue(vm.targetTempBed)){printerCtrl.bed.temperature(vm.targetTempBed)}}function checkValue(value){if(typeof value!=="undefined"&&value!=null){return true}else{return false}}var printControls_clearUp=$rootScope.$on("$locationChangeSuccess",function(event){if($location.path()!=="/print/controls"){printControls_printerUpdated();printControls_printerTune();printControls_clearUp()}});angular.extend(vm,{printerCtrl:printerCtrl,printer:Printer,runCustomCommand:runCustomCommand,runExtruderCommand:runExtruderCommand,runBedCommand:runBedCommand,checkValue:checkValue,navigate:navigate})}MainController.$inject=["$rootScope","$api","$auth","printerCtrl","Printer","$socket","$interval","$timeout","$location"];angular.module("component.print.controls",[]).controller("PrintControlsController",MainController)})();(function(){function MainController(Printjob,Printer,Queue,ngDialog,$interval,$timeout,$location,$rootScope,$notification,$window,$api){var vm=this;vm.environmentLocation=window.ENV.location;var file={filetype:"text/stl"};var resultsPage=0;var resultsAvalible=true;var userSettings={};if(window.localStorage.getItem("formide.settings:printjobs")&&vm.environmentLocation=="cloud"){userSettings=getSettings()}vm.environmentLocation=window.ENV.location;vm.$resolved=false;vm.printjobs=[];vm.sort=userSettings.sort||"createdAt";vm.sortOrder=userSettings.sortOrder||"-";vm.filterBy=userSettings.filterBy||"selected";if(vm.environmentLocation=="cloud"){vm.limit=24}if(vm.environmentLocation=="local"){$api.getAccessToken().then(function(access_token){vm.access_token=access_token;vm.imagesRootLocation=window.PATH.images})}else{vm.imagesRootLocation=window.PATH.images}Printer.resource.$promise.then(function(devices){if(Printer.$active.id){getPrintjobs()}else{vm.$resolved=true}});$rootScope.$on("formide.activePrinter:updated",function(event,resource){getPrintjobs()});function getSettings(){return JSON.parse(window.localStorage.getItem("formide.settings:printjobs"))}function setSettings(result){window.localStorage.setItem("formide.settings:printjobs",JSON.stringify(result))}function navigate(route){$location.path(route)}function setSortBy(sort){if(vm.sort==sort){if(vm.sortOrder=="-"){vm.sortOrder="+"}else{vm.sortOrder="-"}}else{vm.sort=sort}getPrintjobs();userSettings.sort=vm.sort;userSettings.sortOrder=vm.sortOrder;setSettings(userSettings)}function filterPrintjobs(value){vm.filterBy=value;getPrintjobs();userSettings.filterBy=vm.filterBy;setSettings(userSettings)}function addToQueue(printjob){if((!Printer.$active.port||Printer.$active.deviceStatus!=="online")&&vm.environmentLocation==="cloud"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue");$scope.closeThisDialog()})});return true}})}else{Queue.$addToQueue(file,printjob).then(function(response){$timeout(function(){$location.path("print/queue")})})}}function openGcodeViewer(printjob){var data={printjob:printjob,file:file};ngDialog.open({template:"gcode-viewer/componentView.html",controller:"GcodeViewerController",controllerAs:"modal",className:"printjob-dialog",data:data,showClose:true,trapFocus:false,preCloseCallback:function(){$interval.cancel($rootScope.animationInterval);return true}})}function removePrintjob(job){$notification.addNotification({title:"Delete "+job.name,message:"Are you sure?",type:"error",duration:-1,actions:[{title:"Cancel",callback:function(){console.log("abort!");return true}},{title:"Confirm",callback:function(){Printjob.resource.$remove({id:job.id},function(){vm.printjobs=Printjob.resource});return true}}],popup:true})}function filterToggle(){if(vm.filterOverlay){vm.filterOverlay=false}else{vm.filterOverlay=true}}$window.onmousedown=function(){vm.filterOverlay=false};function getPrintjobs(loadNextPage){vm.$resolved=false;loadNextPage=loadNextPage||false;var params={};params.sort=vm.sort;params.sortOrder=vm.sortOrder;params.limit=vm.limit;params.name=vm.filterSearchValue;if(vm.filterBy==="selected"){params.printerFilter=Printer.$active.id}if(loadNextPage){params.resultsPage=resultsPage}else{resultsPage=0;resultsAvalible=true}Printjob.resource.$slices(params,function(){if(loadNextPage){if(Printjob.resource.length>0){for(var i=0;i<Printjob.resource.length;i++){vm.printjobs.push(Printjob.resource[i])}resultsAvalible=true}else{resultsAvalible=false}}else{vm.printjobs=Printjob.resource}$timeout(function(){vm.$resolved=true})})}function getNextPage(){if(!vm.$resolved||!resultsAvalible||vm.environmentLocation=="local")return;resultsPage++;getPrintjobs(true)}angular.extend(vm,{setSortBy:setSortBy,addToQueue:addToQueue,openGcodeViewer:openGcodeViewer,removePrintjob:removePrintjob,navigate:navigate,filterToggle:filterToggle,getPrintjobs:getPrintjobs,getNextPage:getNextPage,filterPrintjobs:filterPrintjobs})}MainController.$inject=["Printjob","Printer","Queue","ngDialog","$interval","$timeout","$location","$rootScope","$notification","$window","$api"];angular.module("component.print.jobs",[]).controller("PrintJobsController",MainController)})();(function(){function MainController($rootScope,Printer,Queue,$timeout,$socket,$location){var vm=this;vm.environmentLocation=window.ENV.location;vm.webcamBtn={title:"Overlay",action:showFloatingWebcam};$socket.socket.on("printer.status",function(resource){vm.printSpeed=Printer.$active.speedMultiplier;vm.flowRate=Printer.$active.flowRate;vm.fanSpeed=Printer.$active.fanSpeed});function navigate(route){$location.path(route)}function showFloatingWebcam(){$rootScope.floatingWebcam=!$rootScope.floatingWebcam;if($rootScope.floatingWebcam){var width="325";var height="235";var webcamPosition=JSON.parse(window.localStorage.getItem("formide.webcam:position"));if(webcamPosition){var x=webcamPosition.x;var y=webcamPosition.y;var maxX=window.innerWidth;var maxY=window.innerHeight;if(x<0)x=0;if(x>maxX-width)x=maxX-width;if(y<0)y=0;if(y>maxY-height)y=maxY-height;$rootScope.floatingWebcamPosition={top:y+"px",left:x+"px",width:width+"px",height:height+"px"}}else{$rootScope.floatingWebcamPosition={width:width+"px",height:height+"px"}}}}angular.extend(vm,{printer:Printer,queue:Queue})}MainController.$inject=["$rootScope","Printer","Queue","$timeout","$socket","$location"];angular.module("component.print.monitor",[]).controller("PrintMonitorController",MainController)})();(function(){function MainController($auth,$api,$rootScope,Printer,Queue,$timeout,$notification,printerCtrl,$socket,$location){var vm=this;vm.environmentLocation=window.ENV.location;Printer.resource.$promise.then(function(data){vm.queue=Queue});var previousPort="";function filterQueue(item){return item.status==="queued"||item.status==="downloading"}function filterFinished(item){return item.status!=="finished"}function removeFromQueue(id){Queue.resource.$remove({id:id})}var auth=$auth;function navigate(route){$location.path(route)}angular.extend(vm,{printer:Printer,queue:Queue,removeFromQueue:removeFromQueue,filterQueue:filterQueue,filterFinished:filterFinished,navigate:navigate})}MainController.$inject=["$auth","$api","$rootScope","Printer","Queue","$timeout","$notification","printerCtrl","$socket","$location"];angular.module("component.print.queue",[]).controller("PrintQueueController",MainController)})();(function(){function MainController($router,$routeParams,Printer,$location,$timeout,$auth){var vm=this;if($routeParams.childRoute===undefined){$timeout(function(){$location.path("print/jobs")})}angular.extend(vm,{routeConfig:MainController.$routeConfig,printer:Printer,auth:$auth})}MainController.$inject=["$router","$routeParams","Printer","$location","$timeout","$auth"];MainController.$routeConfig=[{path:"/",redirectTo:"/"},{path:"/jobs",parent:"/print",nav:{name:"Jobs",title:"List of print jobs"},component:{subView:"printJobs"},as:"printJobs"},{path:"/queue",parent:"/print",nav:{name:"Queue",title:"Queue of print jobs"},component:{subView:"printQueue"},as:"printQueue"},{path:"/monitor",parent:"/print",nav:{name:"Monitor",title:"Monitor your print job"},component:{subView:"printMonitor"},as:"printMonitor"},{path:"/controls",parent:"/print",nav:{name:"Controls",title:"Control your selected 3D printer"},component:{subView:"printControls"},as:"printControls"},{path:"/console",parent:"/print",nav:{name:"Console",title:"Connected 3D printer console"},expression:{key:window.localStorage.getItem("formide.settings:n3rd"),value:"true"},component:{subView:"printConsole"},as:"printConsole"}];angular.module("component.print",[]).controller("PrintController",MainController)})();(function(){function MainController($auth,$http,$api,Printer,Device,$socket,$scope,$rootScope,$timeout,$notification,$filter,ngDialog,Material,Sliceprofile,$location){var vm=this;vm.environmentLocation=window.ENV.location;if($scope.ngDialogData.printerFound){vm.port=$scope.ngDialogData.port;vm.device=$scope.ngDialogData.device;vm.detecting=false;vm.targets=1}else{vm.port=undefined;vm.device=undefined;vm.detecting=true;vm.targets=0}vm.customPrinter={};vm.customPrinter.extruders=[];vm.overridePrevious=true;vm.material={};vm.materials=[];vm.materials=Material.resource;vm.sliceprofile={};vm.sliceprofiles=[];vm.sliceprofiles=Sliceprofile.resource;var extruder_index=1;vm.customPrinter.extruders.push({name:"Extruder "+extruder_index});function navigate(route){$location.path(route)}function isEmpty(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))return false}return true}function checkPresets(){var url="/preset/printers";$api.get(url).then(function(response){if(response.length>0){vm.showPresets=true}})}if(vm.environmentLocation==="local"){checkPresets()}function getPresets(query){var url="/preset/printers?";var queryParams={};if(query&&query.length>1){url+="filter[name]=:name&type[name]=regexi&";queryParams.name=query}url+="sort=+name&limit=24";$api.get(url,queryParams).then(function(response){vm.presets=response})}function getSavedPresets(){function printersFilter(item){return!item.port}var vm=this;var loadedFile;var savedPresets=[];var printers=Printer.resource;for(var i=0;i<printers.length;i++){if(!printers[i].preset){savedPresets.push(printers[i])}}angular.forEach(savedPresets,function(preset,key){savedPresets[key].notPreset=true});vm.savedPresets=savedPresets;return savedPresets}function getSliceprofilePresets(query){var url="/preset/sliceprofiles";if(query){url+="/search?s="+encodeURIComponent(query)}$api.get(url).then(function(response){vm.sliceprofilePresets=response})}function sliceprofilePresetsChanged(){var sliceProfile=angular.copy(vm.sliceprofilePreset);vm.sliceprofile.name=sliceProfile.name;vm.sliceprofile.settings=sliceProfile.settings;vm.jsonSliceprofileSettings=JSON.stringify(vm.sliceprofile.settings)}function getMaterialPresets(query){var url="/preset/materials";if(query&&query.length>1){url+="/search?s="+encodeURIComponent(query)}$api.get(url).then(function(response){vm.materialPresets=response})}function materialPresetsChanged(){var material=angular.copy(vm.materialPreset);vm.material.name=material.name;vm.material.type=material.type;vm.material.temperature=material.temperature;vm.material.firstLayersTemperature=material.firstLayersTemperature;vm.material.bedTemperature=material.bedTemperature;vm.material.firstLayersBedTemperature=material.firstLayersBedTemperature;vm.material.feedRate=material.feedRate}function initMaterialPresets(){vm.materialPreset={bedTemperature:75,feedRate:100,filamentDiameter:1750,firstLayersBedTemperature:75,firstLayersTemperature:220,name:"Generic-PLA",temperature:220,type:"PLA"};materialPresetsChanged()}function closeSetup(){$rootScope.onboarding("setupPrinter");$scope.closeThisDialog()}function saveSettings(sliceprofile,material){Sliceprofile.resource.$save(sliceprofile,function(response){$notification.addNotification({title:"Settings Saved",message:"Slice Profile Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.sliceprofile.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})});Material.resource.$save(material,function(response){$notification.addNotification({title:"Settings Saved",message:"Materials Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.materials.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})});vm.setupComplete=true}function submitForm(invalidForm){if(vm.manualSetup&&!invalidForm||!vm.manualSetup){if(vm.detecting){vm.disableSaveBtn=true;$notification.addNotification({title:"Printer not detected",message:"To use your printer with The Element it must first detect it before saving. To add a printer without The Element click continue, otherwise go back.",type:"error",duration:-1,actions:[{title:"Go Back",callback:function(){vm.disableSaveBtn=false;return true}},{title:"Continue",callback:function(){savePrinter();return true}}],popup:true})}else{savePrinter()}}}function savePrinter(){var printer={bed:{heated:false}};printer=vm.customPrinter;if(vm.manualSetup){printer.bed.heated=printer.bed.heated||false;printer.startGcode=["G21","G28","G1 Z5 F5000","G90","G92 E0","M82","G92 E0"];printer.endGcode=["G92 E0","M104 S0","G28 X0","M84"];printer.gcodeFlavour="GCODE_FLAVOR_REPRAP"}else{printer.startGcode=vm.presetPrinter.startGcode||null;printer.endGcode=vm.presetPrinter.endGcode||null;printer.manufacturer=vm.presetPrinter.manufacturer||null;printer.abilities=vm.presetPrinter.abilities||null;printer.gcodeFlavour=vm.presetPrinter.gcodeFlavour||"GCODE_FLAVOR_REPRAP"}printer.port=vm.port;if(vm.device){printer.device={};printer.device.id=vm.device}printer.baudrate=25e4;printer.active=false;if(printer.extruders.length<1){$notification.addNotification({title:"Extruder Missing",message:"Please add atleast one extruder!",channel:"system",type:"error"})}else{if(!vm.manualSetup&&vm.presetPrinter.notPreset&&vm.presetPrinter.id){if(vm.overridePrevious){angular.merge(vm.presetPrinter,printer);Printer.resource.$update(vm.presetPrinter,function(response){$notification.addNotification({title:"Settings Saved",message:"Printer Settings Saved",channel:"system",type:"success"});$rootScope.$emit("modal.printers.setup",true);$rootScope.$emit("modal.printers.saved",true);return true})}else{Printer.resource.$save(printer,function(response){$rootScope.$emit("modal.printers.setup",true);$rootScope.$emit("modal.printers.saved",true)})}}else{Printer.resource.$save(printer,function(response){$rootScope.$emit("modal.printers.setup",true);$rootScope.$emit("modal.printers.saved",true)})}}if(vm.materials.length>0&&vm.sliceprofiles.length>0||vm.environmentLocation!=="cloud"){$scope.closeThisDialog()}else{vm.setupSettings=true}}function addExtruder(item){extruder_index++;vm.customPrinter.extruders.push({name:"Extruder "+extruder_index,nozzleSize:vm.customPrinter.extruders[0].nozzleSize,filamentDiameter:vm.customPrinter.extruders[0].filamentDiameter})}function removeExtruder(item){if(vm.customPrinter.extruders.length<2){$notification.addNotification({title:"Extruder Missing",message:"You need to have at least one extruder!",channel:"system",type:"error"})}else{var index=vm.customPrinter.extruders.indexOf(item);vm.customPrinter.extruders.splice(index,1)}}function printerChanged(printer){if(printer==vm.searchedPresetPrinter){vm.savedPresetPrinter=null}else if(printer==vm.savedPresetPrinter){vm.searchedPresetPrinter=null}vm.presetPrinter=printer;vm.presetPrinter.editedName=vm.presetPrinter.editedName||vm.presetPrinter.name;vm.customPrinter.name=angular.copy(vm.presetPrinter.editedName);vm.customPrinter.bed=angular.copy(vm.presetPrinter.bed);vm.customPrinter.bed.printerType=vm.customPrinter.bed.printerType||"CARTESIAN";vm.customPrinter.axis=angular.copy(vm.presetPrinter.axis);vm.customPrinter.extruders=angular.copy(vm.presetPrinter.extruders);vm.overridePrevious=true}function printerEditName(){vm.customPrinter.name=vm.presetPrinter.editedName}$socket.socket.on("printer.connected",function(data){Printer.resource.$promise.then(function(result){if(!foundPrinter(Printer.resource,data)){vm.detecting=false;vm.targets=1;vm.port=data.port;vm.device=data.device||"Local device";console.log("unknown printer found")}})});angular.extend(vm,{addExtruder:addExtruder,removeExtruder:removeExtruder,submitForm:submitForm,printerChanged:printerChanged,printerEditName:printerEditName,checkPresets:checkPresets,getPresets:getPresets,getSavedPresets:getSavedPresets,getSliceprofilePresets:getSliceprofilePresets,sliceprofilePresetsChanged:sliceprofilePresetsChanged,getMaterialPresets:getMaterialPresets,materialPresetsChanged:materialPresetsChanged,initMaterialPresets:initMaterialPresets,saveSettings:saveSettings,closeSetup:closeSetup,isEmpty:isEmpty,savePrinter:savePrinter,navigate:navigate})}function CheckPrinterController(ngDialog){var vm=this}MainController.$inject=["$auth","$http","$api","Printer","Device","$socket","$scope","$rootScope","$timeout","$notification","$filter","ngDialog","Material","Sliceprofile","$location"];angular.module("component.printer.setup",[]).controller("PrinterSetupController",MainController)})();(function(){function PrinterController($scope,ngDialog,$rootScope,Printer){var vm=this;vm.readytoPrint=$scope.ngDialogData.readytoPrint;vm.printer=Printer.resource;vm.deviceAvailable=function(value){if(vm.readytoPrint){return value.port&&(value.device&&value.device.id!=""&&value.deviceStatus=="online"||vm.environmentLocation=="local")}else{return true}};function onPrinterSelect(id){Printer.$setActive({id:id});$scope.closeThisDialog()}angular.extend(vm,{onPrinterSelect:onPrinterSelect})}PrinterController.$inject=["$scope","ngDialog","$rootScope","Printer"];angular.module("component.printjob-printer",[]).controller("ModalPrinterController",PrinterController)})();(function(){function SaveSliceprofileController($scope,Sliceprofile,$notification,$rootScope){var vm=this;vm.sliceprofile=$scope.ngDialogData;function saveSliceprofile(){Sliceprofile.resource.$save(vm.sliceprofile,function(response){$notification.addNotification({title:"Settings Saved",message:"Slice profile Settings Saved",channel:"system",type:"success"});$scope.closeThisDialog();$rootScope.$emit("modal.sliceprofile.saved",true)},function(e){$notification.addNotification({title:e.statusName,message:e.message,channel:"system",type:"error"})})}angular.extend(vm,{saveSliceprofile:saveSliceprofile})}function PrintjobController($location,$auth,$api,$notification,$scope,ngDialog,$rootScope,$timeout,Printer,Material,Sliceprofile,Slicer,$filter){var vm=this;var viewerSettings=JSON.parse(window.localStorage.getItem("formide.viewer:settings"))||{};var printerDialog;Printer.$active.status=Printer.$active.status||"offline";vm.addToQueue=window.localStorage.getItem("formide.settings:addToQueue")==="true";vm.models=[];vm.sliceprofiles=[];vm.materials=[];vm.slicing=false;vm.sliceSettings=false;vm.activeTab="fan";vm.environmentLocation=window.ENV.location;if($scope.ngDialogData.printer){var reopenedFiles=$scope.ngDialogData.sliceSettings.files;Printer.$setActive({id:$scope.ngDialogData.printer.id})}var printerType;if(Printer.$active.bed&&Printer.$active.bed.printerType=="DELTA"&&Printer.$active.bed.placeOfOrigin=="CENTER"){printerType="round"}else{printerType="xyz"}extrudersEnable();function setAdvancedSettings(){vm.savedAdvancedSettings=vm.savedAdvancedSettings||JSON.parse(window.localStorage.getItem("formide.settings:advancedSlice"));vm.savedAdvancedSettings=$scope.ngDialogData.sliceSettings||vm.savedAdvancedSettings;if(!vm.savedAdvancedSettings){vm.savedAdvancedSettings={brim:{use:false,extruder:0},raft:{use:false,extruder:0},skirt:{use:true,extruder:0},support:{use:false,extruder:0}}}if(!vm.savedAdvancedSettings.fan){vm.savedAdvancedSettings.fan={use:true}}vm.settings={bed:{use:true},queue:{use:false},brim:{use:vm.savedAdvancedSettings.brim.use,extruder:vm.savedAdvancedSettings.brim.extruder},raft:{use:vm.savedAdvancedSettings.raft.use,extruder:vm.savedAdvancedSettings.raft.extruder},skirt:{use:vm.savedAdvancedSettings.skirt.use,extruder:vm.savedAdvancedSettings.skirt.extruder},support:{use:vm.savedAdvancedSettings.support.use,extruder:vm.savedAdvancedSettings.support.extruder},fan:{use:vm.savedAdvancedSettings.fan.use,extruder:vm.savedAdvancedSettings.fan.extruder},override:vm.savedAdvancedSettings.override||{},files:vm.savedAdvancedSettings.files||[],postProcessing:vm.savedAdvancedSettings.postProcessing||[]};if(Printer.$active.extruders&&Printer.$active.extruders.length===1){vm.settings.brim.extruder=0;vm.settings.raft.extruder=0;vm.settings.skirt.extruder=0;vm.settings.support.extruder=0;vm.settings.fan.extruder=0}Sliceprofile.resource.$promise.then(function(){getSliceprofiles()});Material.resource.$promise.then(function(){getMaterials()})}function init(models){if(vm.models.length>0){var difference=modelsDifference(vm.models,models);for(var i in difference.removed){if(typeof difference.removed[i]==="object")removeModel(difference.removed[i])}if(difference.added.length>0){for(var i in difference.added){if(typeof difference.added[i]==="object")addModel(difference.added[i])}}else{vm.loadingModels=false}}else{for(var i in models){if(typeof models[i]==="object")addModel(models[i])}}}function modelsDifference(previous,current){try{var previousid=previous.map(function(val){if(typeof val==="object")return val.id});var currentid=current.map(function(val){if(typeof val==="object")return val.id});var id_added=currentid.filter(function(x){return previousid.indexOf(x)<0});var id_removed=previousid.filter(function(x){return currentid.indexOf(x)<0});var difference={added:[],removed:[]};for(var i in current){for(var key in id_added){if(current[i].id==id_added[key]){difference.added.push(current[i]);break}}}for(var i in previous){for(var key in id_removed){if(previous[i].id==id_removed[key]){difference.removed.push(previous[i]);break}}}return difference}catch(e){if(window.DEBUG)console.error("Could not calculate difference between models!")}}function removeModel(model){try{formideSDK.removeModel({modelId:model.modelId},function(response,err){formideSDK.unselectModel();formideSDK.refreshScene()})}catch(e){var index=vm.models.indexOf(model);vm.models.splice(index,1);if(window.DEBUG){console.warn("Could not add model to the viewer!",e)}}if(vm.modelsLength===vm.models.length){populatePrintJobName()}}function addModel(model){vm.loadingModels=true;if(model.filesize>2e7)vm.largeModel=true;try{formideSDK.addModel({url:window.PATH.api+"/files/download/?id="+model.id+"&hash="+model.hash+"&access_token="+window.localStorage.getItem("formide.auth:token"),name:model.filename},function(response,err){if(typeof viewerSettings.defaultModelColor!=="object"){viewerSettings.defaultModelColor={r:70,g:97,b:230};setSettings(viewerSettings)}formideSDK.allowModelTranslate({modelId:response.modelId,allow:true});formideSDK.allowModelRotate({modelId:response.modelId,allow:true});formideSDK.allowModelScale({modelId:response.modelId,allow:true});if(vm.reopenedPrintjob){for(var i=0;i<reopenedFiles.length;i++){if(reopenedFiles[i].modelId==model.id){var file=reopenedFiles[i];reopenedFiles.splice(i,1);break}}if(!file){console.log("error");model.extruder=0;formideSDK.setModelColor({modelId:response.modelId,r:viewerSettings.defaultModelColor.r,g:viewerSettings.defaultModelColor.g,b:viewerSettings.defaultModelColor.b});formideSDK.putModelOnBed({modelId:response.modelId});$notification.addNotification({title:"Warning",message:"Unable to load transformations from previous slicing",type:"info",duration:-1,actions:[{title:"Continue",callback:function(){return true}}],popup:true})}else{model.extruder=file.extruder||0;formideSDK.setModelColor({modelId:response.modelId,r:file.color.r,g:file.color.g,b:file.color.b});formideSDK.setModelRotation({modelId:response.modelId,x:file.rotation.x,y:file.rotation.y,z:file.rotation.z});formideSDK.setModelScale({modelId:response.modelId,x:file.scale.x,y:file.scale.y,z:file.scale.z});formideSDK.setModelPosition({modelId:response.modelId,x:file.position.x/1e3,y:file.position.y/1e3,z:file.position.z/1e3})}}else{model.extruder=0;formideSDK.setModelColor({modelId:response.modelId,r:viewerSettings.defaultModelColor.r,g:viewerSettings.defaultModelColor.g,b:viewerSettings.defaultModelColor.b});formideSDK.putModelOnBed({modelId:response.modelId})}model.modelId=response.modelId;vm.models.push(model);if(!$scope.$$phase){$scope.$apply()}if(vm.modelsLength===vm.models.length){vm.loadingModels=false;vm.largeModel=false;vm.reopenedPrintjob=false;populatePrintJobName()}})}catch(e){model.modelId=0;model.extruder=0;vm.models.push(model);if(window.DEBUG){console.warn("Could not add model to the viewer!",e)}vm.loadingModels=false;vm.largeModel=false}}function populatePrintJobName(){for(var i=0;i<vm.models.length;i++){if(i==0){vm.printJobName=$filter("title")(vm.models[i].prettyname)}else{vm.printJobName=vm.printJobName+" + "+$filter("title")(vm.models[i].prettyname)}}}function hideSettings(){vm.hideAside=true;var canvas=document.getElementById("3d-viewer");canvas.style.height="1074px";canvas.style.margin="-150px 0 0 0";canvas.style.width="100%";var inputs=document.getElementById("transformation-inputs");inputs.style.margin="0 0 0 4rem"}function showSettings(){vm.hideAside=false;var canvas=document.getElementById("3d-viewer");canvas.style.height="725px";canvas.style.margin="0 0 0 0";canvas.style.width="100%";var inputs=document.getElementById("transformation-inputs");inputs.style.margin="0 0 0 0"}function getSliceprofiles(){vm.sliceprofile=vm.sliceprofile||{};vm.sliceprofiles=Sliceprofile.resource;if($scope.ngDialogData.files){vm.selectedProfile=$scope.ngDialogData.sliceProfile;vm.sliceprofile.orginal=angular.copy($scope.ngDialogData.sliceProfile);vm.sliceprofile.selected=angular.copy($scope.ngDialogData.sliceProfile);angular.merge(vm.sliceprofile.selected.settings,$scope.ngDialogData.sliceSettings.override)}else if(vm.sliceprofiles[0]){vm.selectedProfile=vm.sliceprofiles[0];vm.sliceprofile.orginal=angular.copy(vm.sliceprofiles[0]);vm.sliceprofile.selected=angular.copy(vm.sliceprofiles[0])}}function refreshSliceprofile(sliceprofile){vm.sliceprofiles=Sliceprofile.resource;vm.sliceprofile.orginal=angular.copy(sliceprofile);vm.sliceprofile.selected=angular.copy(sliceprofile);vm.settings.override={}}function setOverrides(key1,key2){if(vm.sliceprofile.orginal.settings[key1][key2]!==vm.sliceprofile.selected.settings[key1][key2]){if(!vm.settings.override[key1]){vm.settings.override[key1]={}}vm.settings.override[key1][key2]=vm.sliceprofile.selected.settings[key1][key2]}else{delete vm.settings.override[key1][key2];if(isEmpty(vm.settings.override[key1])){delete vm.settings.override[key1]}}}function undoOverrides(){vm.sliceprofile.selected=angular.copy(vm.sliceprofile.orginal);vm.settings.override={}}function saveSliceprofile(){var newSliceprofile={name:vm.sliceprofile.selected.name,settings:vm.sliceprofile.selected.settings};ngDialog.open({className:"printjob-printer-dialog",template:"saveSliceprofile",controller:"ModalSaveSliceprofileController",controllerAs:"modal",data:newSliceprofile,trapFocus:false})}vm.tabs={};$api.req("GET","/slicer/reference").then(function(data,status,headers,config){vm.types=data.sliceProfile;for(var i in data.sliceProfile){vm.tabs[i]=data.sliceProfile[i]}vm.katanaVersion=data.version});function selectTab(tabName){vm.activeTab=tabName}function isEmpty(obj){return Object.keys(obj).length===0}function getMaterials(){vm.material=vm.material||{};vm.material.selected=[];vm.materials=Material.resource;vm.bed=vm.bed||{};if($scope.ngDialogData.materials){vm.material.selected=$scope.ngDialogData.materials;if(vm.material.selected.length<Printer.$active.extruders.length){for(var i=0;i<Printer.$active.extruders.length-vm.material.selected.length;i++){vm.material.selected.push(vm.material.selected[0])}}for(var i=0;i<Printer.$active.extruders.length;i++){Printer.$active.extruders[i].disable=!$scope.ngDialogData.sliceSettings.extruders[i].use}countExtruderDisable();vm.settings.bed=vm.savedAdvancedSettings.bed;for(var i=0;i<vm.materials.length;i++){if(vm.settings.bed.id==vm.materials[i].id){vm.bed.material=vm.materials[i];break}}}else{if(Printer.$active.extruders){for(var i=0;i<Printer.$active.extruders.length;i++){vm.material.selected[i]=vm.materials[0]}}vm.bed.material=vm.bed.material||vm.materials[0];setBedOverrides(vm.bed.material)}}function refreshMaterial(material,index){if(material&&index==0){vm.bed.material=material;setBedOverrides(material)}vm.materials=Material.resource;vm.selectedMaterialIds=[];for(var i=0;i<vm.material.selected.length;i++){if(vm.material.selected[i]){vm.selectedMaterialIds.push(vm.material.selected[i].id)}}}function extruderDisable(extruder){extruder.disable=!extruder.disable;countExtruderDisable()}function countExtruderDisable(){vm.hideExtruderSettings=false;vm.extrudersDisabled=0;for(var i=0;i<Printer.$active.extruders.length;i++){if(Printer.$active.extruders[i].disable){vm.extrudersDisabled++}}if(Printer.$active.extruders.length-vm.extrudersDisabled<2){vm.hideExtruderSettings=true}}function extrudersEnable(){if(Printer.$active.extruders){for(var i=0;i<Printer.$active.extruders.length;i++){Printer.$active.extruders[i].disable=false}}vm.hideExtruderSettings=false;vm.extrudersDisabled=0}function setBedOverrides(material){material=material||{};vm.settings.bed=vm.settings.bed||{};vm.settings.bed.id=material.id;vm.settings.bed.temperature=material.bedTemperature;vm.settings.bed.firstLayersTemperature=material.firstLayersBedTemperature}$scope.$on("files.addMore.files",function(event,models){vm.modelsLength=models.length;init(models)});function toggleAddToQueue(){window.localStorage.setItem("formide.settings:addToQueue",vm.addToQueue);
}function choosePrinter(){var data={readytoPrint:false};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:data,preCloseCallback:function(){Printer.$active.status=Printer.$active.status||"offline";formideSDK.unselectModel();setupPrinter();refreshMaterial();extrudersEnable();formideSDK.refreshScene();return true}})}function setupPrinter(){if(Printer.$active.bed){try{var r=Printer.$active.bed.diameter/2||Printer.$active.bed.x/2;var printerType;if(Printer.$active.bed.printerType=="DELTA"&&Printer.$active.bed.placeOfOrigin=="CENTER"){printerType="round"}else{printerType="xyz"}var bedChange;if(appSettings.printer.type!==printerType){bedChange=true}appSettings.printer.type=printerType;formideSDK.setPrintSize({x:Printer.$active.bed.x,y:Printer.$active.bed.y,z:Printer.$active.bed.z,r:r},function(response,err){formideSDK.showPrintBed({show:true,type:printerType});formideSDK.resetCameraPosition();formideSDK.centerCameraOnBed();if(bedChange){formideSDK.recenterAllModels()}viewerSettings.showPrintBed=true;setSettings(viewerSettings)})}catch(e){console.error("Failed setting printer bed size",e)}}else{console.info("No printer selected, defaulting to standard bed size!");formideSDK.showPrintBed({show:true,type:"xyz"})}}function addMoreFiles(){$rootScope.$emit("files.addMore",true)}function callCounter(count,callback){count=count||1;return function(){--count||callback()}}function newPrintjob(){vm.slicing=true;var done=callCounter(vm.modelsLength,checkPrintjobBed);vm.bedError=[];for(var i=0;i<vm.models.length;i++){formideSDK.getModelTransformations({modelId:vm.models[i].modelId},function(response,err){if(response.aboveBed||response.belowBed){vm.bedError.push({i:i,aboveBed:response.aboveBed,belowBed:response.belowBed})}done()})}}function checkPrintjobBed(){if(vm.bedError.length==vm.modelsLength){var message;if(vm.modelsLength==1&&vm.bedError[0].aboveBed){message="The model is above the bed. Are you sure you would like to continue slicing?"}else if(vm.modelsLength==1&&vm.bedError[0].belowBed){message="The model is below the bed. Are you sure you would like to continue slicing?"}else{message="All models are either above or below the bed. Are you sure you would like to continue slicing?"}$notification.addNotification({title:"Slice Warning",message:message,type:"info",duration:-1,actions:[{title:"Cancel",callback:function(){vm.slicing=false;console.log("abort!");return true}},{title:"Continue",callback:function(){checkPrintjobExt();return true}}],popup:true})}else{checkPrintjobExt()}}function checkPrintjobExt(){if(Printer.$active.extruders.length==vm.extrudersDisabled){$notification.addNotification({title:"Extruder Warning",message:"All extruders have been disabled. At lease one extruder is required to slice.",type:"error",duration:-1,actions:[{title:"Close",callback:function(){console.log("abort!");return true}}],popup:true})}else{createPrintjob()}}function createPrintjob(){var sliceprofile=vm.sliceprofile.selected;var materials=vm.material.selected;var models=vm.models;var printer=Printer.$active;var settings=vm.settings;var name=vm.printJobName;settings.extruders=[];for(var i=0;i<Printer.$active.extruders.length;i++){settings.extruders.push({use:!Printer.$active.extruders[i].disable})}if(materials.length>1){if(vm.hideExtruderSettings){for(var i=0;i<Printer.$active.extruders.length;i++){if(!Printer.$active.extruders[i].disable){settings.brim.extruder=i;settings.raft.extruder=i;settings.skirt.extruder=i;settings.support.extruder=i;for(var r=0;r<models.length;r++){models[r].extruder=i}break}}}}for(var key in vm.postProcessing){if(key==="BUILDER_COLORMIXER"&&vm.postProcessing[key].use){var options=vm.postProcessing[key].options;function convertKeyValueToArray(obj){var arr=[];for(var key in obj){if(obj.hasOwnProperty(key)){arr.push(obj[key])}}return arr}settings.postProcessing.push({name:"BUILDER_COLORMIXER",options:{startRatio:convertKeyValueToArray(options.startRatio),endRatio:convertKeyValueToArray(options.endRatio)}})}}Slicer.slice(sliceprofile,materials,models,printer,settings,name).then(function successCallback(response){vm.slicing=false;$rootScope.$emit("slicer.started",true);if(window.DEBUG)console.info("Slicing started!",response);$scope.closeThisDialog()},function errorCallback(e){vm.slicing=false;if(window.DEBUG)console.error("Slicing started failed!",e);$notification.addNotification({title:"Slicing Started Failed",message:e,channel:"system",type:"error"})})}function setSettings(result){window.localStorage.setItem("formide.viewer:settings",JSON.stringify(result))}function saveAdvancedSettings(){if(vm.material.selected.length>1){vm.savedAdvancedSettings={brim:{use:vm.settings.brim.use,extruder:vm.settings.brim.extruder},raft:{use:vm.settings.raft.use,extruder:vm.settings.raft.extruder},skirt:{use:vm.settings.skirt.use,extruder:vm.settings.skirt.extruder},support:{use:vm.settings.support.use,extruder:vm.settings.support.extruder}}}else if(vm.material.selected.length===1){vm.savedAdvancedSettings={brim:{use:vm.settings.brim.use,extruder:vm.savedAdvancedSettings.brim.extruder},raft:{use:vm.settings.raft.use,extruder:vm.savedAdvancedSettings.raft.extruder},skirt:{use:vm.settings.skirt.use,extruder:vm.savedAdvancedSettings.skirt.extruder},support:{use:vm.settings.support.use,extruder:vm.savedAdvancedSettings.support.extruder}}}window.localStorage.setItem("formide.settings:advancedSlice",JSON.stringify(vm.savedAdvancedSettings))}function appFunction(){var self=this;this.init=function(){formideSDK.setBackgroundColor({r:255,g:255,b:255});if($scope.ngDialogData.files){var missingData=false;var message="Previously used data no longer available:";if(!$scope.ngDialogData.printer){missingData=true;var printerMessage=" Printer";message=message+printerMessage}if(!$scope.ngDialogData.sliceProfile){missingData=true;if(printerMessage){var sliceprofileMessage=", Slice Profile"}else{var sliceprofileMessage=" Slice Profile"}message=message+sliceprofileMessage}if($scope.ngDialogData.materials.length==0){missingData=true;if(printerMessage||sliceprofileMessage){var materialMessage=", Materials"}else{var materialMessage=" Materials"}message=message+materialMessage}if(missingData){$notification.addNotification({title:"Warning",message:message,type:"info",duration:-1,actions:[{title:"Continue",callback:function(){return true}}],popup:true})}}viewerSettings.showPrintBed=viewerSettings.showPrintBed===undefined?true:viewerSettings.showPrintBed;setSettings(viewerSettings);formideSDK.showPrintBed({show:viewerSettings.showPrintBed,type:printerType});setAdvancedSettings();formideSDK.on("modelCopied",function(response){var clonedModel={};for(var i in vm.models){if(response.copiedModel==vm.models[i].modelId){clonedModel=angular.copy(vm.models[i]);break}}clonedModel.modelId=response.newModel;clonedModel.extruder=0;vm.models.push(clonedModel);populatePrintJobName()});formideSDK.on("modelRemoved",function(response){for(var i in vm.models){if(response.model==vm.models[i].modelId){vm.models.splice(i,1);break}}});formideSDK.on("modelSelected",function(response){vm.selectedModel=response.model.modelId});formideSDK.on("modelUnselected",function(event){vm.selectedModel=null});try{if($scope.ngDialogData.files){vm.reopenedPrintjob=true;vm.modelsLength=$scope.ngDialogData.files.length;init($scope.ngDialogData.files)}else{vm.modelsLength=$scope.ngDialogData.length;init($scope.ngDialogData)}}catch(e){if(window.DEBUG)console.error("No models added to be sliced!",e)}}}var appSettings={models:{xyzprinter:"./public/assets/data/models/simplePrinter.dae",deltaprinter:"./public/assets/data/models/deltaPrinter.dae",attachmentPoint:"./public/assets/data/models/attachmentPoint.dae",scalePivot:"./public/assets/data/models/scalePivot.obj",translatePivot:"./public/assets/data/models/translatePivot.obj",rotatePivot:"./public/assets/data/models/rotatePivot.obj",ruler:"./public/assets/data/models/ruler.obj",rotationRuler:"./public/assets/data/models/rulerRotation.obj"},materials:{scalePivot:"./public/assets/data/materials/scalePivot.mtl",translatePivot:"./public/assets/data/materials/translatePivot.mtl",rotatePivot:"./public/assets/data/materials/rotatePivot.mtl",ruler:"./public/assets/data/materials/ruler.mtl",virtualGrid:"./public/assets/data/materials/virtualGrid.tga"},api:{baseUrl:window.PATH.api,accessToken:window.localStorage.getItem("formide.auth:token")},toggleBedtype:"toggle",printer:{size:{x:Printer.$active.bed?Printer.$active.bed.x:200,y:Printer.$active.bed?Printer.$active.bed.y:200,z:Printer.$active.bed?Printer.$active.bed.z:200,r:Printer.$active.bed?Printer.$active.bed.diameter/2||Printer.$active.bed.x/2:140},type:printerType}};angular.extend(vm,{appFunction:appFunction,appSettings:appSettings,choosePrinter:choosePrinter,refreshSliceprofile:refreshSliceprofile,refreshMaterial:refreshMaterial,newPrintjob:newPrintjob,addMoreFiles:addMoreFiles,printer:Printer,toggleAddToQueue:toggleAddToQueue,saveAdvancedSettings:saveAdvancedSettings,hideSettings:hideSettings,showSettings:showSettings,extruderDisable:extruderDisable,selectTab:selectTab,saveSliceprofile:saveSliceprofile,setOverrides:setOverrides,undoOverrides:undoOverrides,isEmpty:isEmpty})}PrintjobController.$inject=["$location","$auth","$api","$notification","$scope","ngDialog","$rootScope","$timeout","Printer","Material","Sliceprofile","Slicer","$filter"];SaveSliceprofileController.$inject=["$scope","Sliceprofile","$notification","$rootScope"];angular.module("component.printjob",[]).controller("ModalPrintjobController",PrintjobController).controller("ModalSaveSliceprofileController",SaveSliceprofileController).filter("inArray",function($filter){return function(list,arrayFilter,element){if(arrayFilter){return $filter("filter")(list,function(listItem){return arrayFilter.indexOf(listItem[element])!=-1})}}})})();(function(){function MainController($api,$auth,$rootScope,ngDialog,$notification,Upload,$window){var vm=this;vm.imagesRootLocation=window.PATH.images;vm.settings={};vm.errorMessage="";vm.maxStorage=1073741824*5;function getAccount(){switch(window.ENV.location){case"cloud":$api.get("/me/full").then(function(data,status,headers,config){vm.settings=data;vm.settings.n3rd=window.localStorage.getItem("formide.settings:n3rd")==="true"});break;default:}}function toggleN3rdM0d3(){window.localStorage.setItem("formide.settings:n3rd",vm.settings.n3rd);$notification.addNotification({title:"N3rd Mode Toggled",message:"N3rd mode has been toggled "+(vm.settings.n3rd?"on":"off"),type:"info",duration:2e3});$window.location.reload()}var access_token=window.localStorage.getItem("formide.auth:token");var upload=function(files){if(files&&files.length){var file=files[0];Upload.upload({headers:{Authorization:"Bearer "+access_token},url:window.PATH.api+"/me/avatar",file:file}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("uploading...",progressPercentage)}).success(function(data,status,headers,config){$notification.addNotification({title:"Avatar Changed",message:"Your account avatar has been updated",type:"success",duration:2e3});getAccount()})}};function saveAccount(){vm.errorMessage="";if(vm.settings.password||vm.settings.passwordValidate){if(vm.settings.password!=vm.settings.passwordValidate){vm.errorMessage="Passwords fields don't match!";return}}if(!vm.settings.email){vm.errorMessage="Invalid email address!";return}if(vm.settings.username.length<5){vm.errorMessage="Username must be greater than 5 characters!";return}$api.put("/me",{username:vm.settings.username,email:vm.settings.email,password:vm.settings.password||"",fullName:vm.settings.fullName,"public":vm.settings.public}).then(function(data,status,headers,config){$notification.addNotification({title:"Settings changed",message:"Your account settings have been saved",type:"success",duration:2e3});getAccount()})}function connectIntegration(integration){window.location=window.PATH.api+"/integrations/"+integration+"/login"}function disconnectIntegration(integration){$api.delete("/me/integrations/"+integration).then(function(response){$notification.addNotification({title:"Account disconnected",message:integration+" has been disconnected from your Formide account",type:"info",duration:2e3});getAccount()})}getAccount();angular.extend(vm,{saveAccount:saveAccount,upload:upload,toggleN3rdM0d3:toggleN3rdM0d3,connectIntegration:connectIntegration,disconnectIntegration:disconnectIntegration})}MainController.$inject=["$api","$auth","$rootScope","ngDialog","$notification","Upload","$window"];angular.module("component.settings.account",[]).controller("SettingsAccountController",MainController)})();(function(){function MainController($location,$auth,$api){var vm=this;vm.imagesRootLocation=window.PATH.images;vm.logs=[];vm.resultsPage=1;vm.logsPerPage=10;vm.busy=false;vm.detailStatus={};function getLogs(){$api.get("/logs?limit="+vm.logsPerPage).then(function(data){vm.logs=data})}getLogs();function nextPage(){if(vm.busy)return;vm.busy=true;$api.get("/logs?limit="+vm.logsPerPage+"&offset="+vm.resultsPage*vm.logsPerPage).then(function(data){var items=data.results;for(var i=0;i<items.length;i++){vm.logs.push(items[i])}vm.busy=false;vm.resultsPage++})}angular.extend(vm,{nextPage:nextPage})}MainController.$inject=["$location","$auth","$api"];angular.module("component.settings.logs",[]).controller("SettingsLogsController",MainController)})();(function(){function MainController($router,$routeParams,$timeout,$location,$auth){var vm=this;if($routeParams.childRoute===undefined){$timeout(function(){switch(window.ENV.location){case"cloud":$location.path("settings/account");break;default:$location.path("settings/device")}})}angular.extend(vm,{routeConfig:MainController.$routeConfig})}MainController.$inject=["$router","$routeParams","$timeout","$location","$auth"];MainController.$routeConfig=[{path:"/",redirectTo:"/"},{path:"/account",nav:{name:"Account",title:"Account Settings"},env:"cloud",component:{subView:"settingsAccount"},as:"settingsAccount"}];angular.module("component.settings",[]).controller("SettingsController",MainController)})();function foundPrinter(resource,data){for(var i in resource){var printer=resource[i];switch(window.ENV.location){case"cloud":if(printer.port===data.port&&printer.device.id===data.device)return true;break;default:if(printer.port===data.port)return true}}return false}(function(){var logoutTitle;var env=null;if(!localStorage.getItem("formide:env")){getEnv(function(env){setEnv(env)})}else{try{env=localStorage.getItem("formide:env");setEnv(env);getEnv()}catch(e){getEnv(function(env){setEnv(env)})}}function getEnv(callback){httpGetAsync(window.PATH.root+"/api/env",function(envResponse){localStorage.setItem("formide:env",envResponse);if(callback&&typeof callback=="function"){return callback(envResponse)}})}function setEnv(response){try{var response=JSON.parse(response)}catch(e){var response={};console.error(e)}window.ENV.name=response.name||"local-interface";window.ENV.version=response.version||"0.0.0";window.ENV.type=response.environment||"development";window.ENV.location=response.location||"local";window.ENV.theme=response.theme||"formide";window.PATH.root=window.location.protocol+"//"+window.location.hostname+":"+window.location.port;switch(window.ENV.location){case"cloud":console.log("cloud");window.PATH.api=response.apiUrl||"https://api.formide.com";window.PATH.socket=window.PATH.api;window.PATH.images="https://storage.googleapis.com/images.formide.com";if(window.location.hash=="")window.location.hash="#/dashboard";logoutTitle="Switch Accounts";break;default:console.log("local");window.PATH.api=window.location.protocol+"//"+window.location.hostname+":1337/api";window.PATH.socket=window.location.protocol+"//"+window.location.hostname+":1337";window.PATH.images=window.location.protocol+"//"+window.location.hostname+":1337/api/db/files";if(window.location.hash=="")window.location.hash="#/files";logoutTitle="Logout"}if(!window.localStorage.getItem("formide.auth:token")&&window.ENV.location==="cloud"){var session_url=window.PATH.root;httpGetAsync(session_url+"/api/auth/session",function(response){try{var response=JSON.parse(response)}catch(e){var response={}}if(response.accessToken){window.localStorage.setItem("formide.auth:token",response.accessToken)}angular.element(document).ready(function(){angular.bootstrap(document,["app"]);angularLoaded()})})}else{angular.element(document).ready(function(){angular.bootstrap(document,["app"]);angularLoaded()})}if(!localStorage.getItem("formide.viewer:settings")){var colors=[{r:70,g:97,b:230},{r:203,g:70,b:230},{r:230,g:70,b:97},{r:230,g:203,b:70},{r:97,g:230,b:70},{r:70,g:230,b:203},{r:114,g:115,b:128},{r:56,g:58,b:81}];var settings={};settings.defaultModelColor=colors[Math.floor(Math.random()*colors.length)];localStorage.setItem("formide.viewer:settings",JSON.stringify(settings))}}function MainController($scope,$rootScope,$router,$location,$api,$http,$socket,$notification,ngDialog,$timeout,Device,Printer,Upload,File,Printjob,Queue,$routeParams,$interval){var vm=this;var registrationToken=$location.search().registration_token;if(registrationToken){window.localStorage.setItem("formide:registrationToken",registrationToken);$location.search("registration_token",null)}if(window.localStorage.getItem("formide:registrationToken")){deviceSetupDialog(window.localStorage.getItem("formide:registrationToken"))}var cloudCode=$location.search().cloud_code;if(cloudCode){window.localStorage.setItem("formide:cloudCode",cloudCode);$location.search("cloud_code",null)}if(window.localStorage.getItem("formide:cloudCode")){customSetupDialog(window.localStorage.getItem("formide:cloudCode"))}vm.loggedin=function(){return window.localStorage.getItem("formide.auth:token")==null||window.localStorage.getItem("formide.auth:token")=="undefined"?false:true};var onboardingState=false;var onboardingSetup=$location.search().setup;vm.environmentLocation=window.ENV.location;vm.setupLocation=window.PATH.setup;vm.unknownPrinter=false;vm.loaded=false;vm.theme=window.ENV.theme;$timeout(function(){vm.loaded=true},200);$rootScope.bodyNoScroll=false;$rootScope.floatingWebcam=false;$rootScope.pageOffsetHeight=0;$rootScope.sidebar={width:340,controller:"SidebarController",template:"sidebar/componentTemplate.html"};$rootScope.fileUploading=false;$scope.$watch(function(){return vm.droppedFiles},function(newValue,oldValue){if(newValue&&newValue.length>0&&$location.$$path=="/files"&&!$rootScope.fileUploading){if(vm.environmentLocation=="cloud"){var files=newValue}else{var files=newValue[0];if(newValue.length>1){$notification.addNotification({title:"Local Upload",message:"Only one file can be uploaded at a time",channel:"device",type:"info"})}}var access_token=window.localStorage.getItem("formide.auth:token");var uploadUrl=window.PATH.api+"/files/upload";var parentFolder=$location.search().folder;if(parentFolder&&parentFolder!=0){uploadUrl=uploadUrl+"?parentFolder="+parentFolder}var data={headers:{Authorization:"Bearer "+access_token},url:uploadUrl,file:files};ngDialog.open({template:"files-pre-upload/componentView.html",controller:"FilePreUploadController",controllerAs:"modal",className:"files-pre-upload",showClose:true,closeByEscape:false,closeByDocument:false,data:data})}});vm.sidebarInvisible=window.localStorage.getItem("formide.sidebar:invisible")==="true";$rootScope.sidebarInvisible=vm.sidebarInvisible;vm.setSidebarInvisible=function(){window.scrollTo(0,0);vm.sidebarInvisible=vm.sidebarInvisible?false:true;window.localStorage.setItem("formide.sidebar:invisible",vm.sidebarInvisible);$rootScope.$emit("trigger.resize",true);$rootScope.sidebarInvisible=vm.sidebarInvisible};$rootScope.setSidebarInvisible=vm.setSidebarInvisible;vm.setSidebarHide=function(){$rootScope.sidebar=false};$rootScope.setSidebarHide=vm.setSidebarHide;vm.setSidebarShow=function(){$rootScope.sidebar=true};$rootScope.setSidebarShow=vm.setSidebarShow;vm.printers=[];vm.activeRoute="landing";function onboarding(currentStep){var devicesCount;$api.get("/devices").then(function(response){devicesCount=response.length;if(vm.loggedin()&&!onboardingState&&(currentStep=="setupDeviceFinished"||currentStep=="setupChooseDevice"||!window.localStorage.getItem("formide.onboarding:success")&&devicesCount===0||onboardingSetup)){onboardingState=true;currentStep=currentStep||"setupWelcome";ngDialog.open({className:"ngdialog-onboarding",template:"onboarding/componentView.html",controller:"OnboardingController",controllerAs:"modal",data:{currentStep:currentStep},showClose:false,closeByEscape:false,closeByDocument:false,preCloseCallback:function(value){onboardingState=false;return true}})}})}var newPrinterDialogOpen=false;function printerSetupDialog(device,port,detected,integrated){if(!newPrinterDialogOpen){ngDialog.open({className:"ngdialog-setup",template:"printer-setup/componentView.html",controller:"PrinterSetupController",controllerAs:"modal",data:{device:device,port:port,printerFound:detected},preCloseCallback:function(value){newPrinterDialogOpen=false;return true}});newPrinterDialogOpen=true}return true}var newDeviceDialogOpen=false;function deviceSetupDialog(registrationToken){if(!newDeviceDialogOpen){ngDialog.open({className:"ngdialog-setup",template:"device-setup/componentView.html",controller:"DeviceSetupController",controllerAs:"modal",data:{registrationToken:registrationToken},showClose:false,closeByEscape:false,closeByDocument:false,preCloseCallback:function(value){newDeviceDialogOpen=false;return true}});newDeviceDialogOpen=true}return true}function customSetupDialog(cloudCode){if(!newDeviceDialogOpen){ngDialog.open({className:"ngdialog-setup",template:"device-setup/componentView.html",controller:"DeviceSetupController",controllerAs:"modal",data:{cloudCode:cloudCode},showClose:false,closeByEscape:false,closeByDocument:false,preCloseCallback:function(value){newDeviceDialogOpen=false;return true}});newDeviceDialogOpen=true}return true}$rootScope.printerSetupDialog=printerSetupDialog;$rootScope.deviceSetupDialog=deviceSetupDialog;$rootScope.onboarding=onboarding;var urlParams=$location.search();switch(window.ENV.location){case"cloud":if(urlParams.onboarding&&!onboardingState){onboarding(urlParams.onboarding)}else if(!onboardingState){onboarding()}break;default:}angular.extend(vm,{routeConfig:MainController.$routeConfig,notifications:$notification.active,printerSetupDialog:printerSetupDialog,deviceSetupDialog:deviceSetupDialog,onboarding:onboarding,deviceSetupDialog:deviceSetupDialog});$socket.authenticate();$rootScope.$on("formide.device:updated",function(){$socket.reconnect()});var state,visibilityChange;if(typeof document.hidden!=="undefined"){visibilityChange="visibilitychange";state="visibilityState"}else if(typeof document.mozHidden!=="undefined"){visibilityChange="mozvisibilitychange";state="mozVisibilityState"}else if(typeof document.msHidden!=="undefined"){visibilityChange="msvisibilitychange";state="msVisibilityState"}else if(typeof document.webkitHidden!=="undefined"){visibilityChange="webkitvisibilitychange";state="webkitVisibilityState"}document.addEventListener(visibilityChange,function(){if(document[state]=="visible"){$socket.reconnect()}},false);$socket.socket.on("printer.failed",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"error",save:true})});$socket.socket.on("printer.connected",function(data){Printer.resource.$promise.then(function(result){if(!foundPrinter(Printer.resource,data))vm.selectedPort=data.port});$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"info"})});$socket.socket.on("printer.disconnected",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"info"})});$socket.socket.on("printer.finished",function(data){console.log("finished");$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"success",save:true})});$socket.socket.on("printer.warning",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"info"})});$socket.socket.on("printer.error",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"printer",type:"error",duration:-1,popup:true,actions:[{title:"Cancel",callback:function(){return true}}]})});$socket.socket.on("slicer.started",function(data){console.log("slicer started",data)});$socket.socket.on("slicer.failed",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"slicer",type:"error",save:true})});$socket.socket.on("slicer.finished",function(response){console.log("slicer.finished",response);if(vm.environmentLocation==="local"){if(!Printer.$active.port){$notification.addNotification({title:response.title,message:response.message,channel:"slicer",duration:-1,type:"success",save:true})}else{$notification.addNotification({title:response.title,message:response.message,channel:"slicer",duration:-1,type:"success",save:true,actions:[{title:"Close",callback:function(){return true}},{title:"Add to queue",callback:function(){Queue.$addToQueue({filetype:"text/stl"},{id:response.data.id}).then(function(){$timeout(function(){$location.path("print/queue")})});return true}}]})}}else{$notification.addNotification({title:response.title,message:response.message,channel:"slicer",duration:-1,type:"success",save:true,actions:[{title:"Close",callback:function(){return true}},{title:"View G-code",callback:function(){var gcodeData={printjob:response.data,file:{filetype:"text/stl"}};ngDialog.open({template:"gcode-viewer/componentView.html",controller:"GcodeViewerController",controllerAs:"modal",className:"printjob-dialog",data:gcodeData,showClose:true,trapFocus:false,preCloseCallback:function(){$interval.cancel($rootScope.animationInterval);return true}});return true}},{title:"Add to queue",callback:function(){if(!Printer.$active.port||Printer.$active.deviceStatus!=="online"){var dialogData={readytoPrint:true};printerDialog=ngDialog.open({template:"printjob-printer/componentView.html",className:"printjob-printer-dialog",controller:"ModalPrinterController",controllerAs:"modal",data:dialogData,preCloseCallback:function(){Queue.$addToQueue({filetype:"text/stl"},{id:response.data.id}).then(function(){$timeout(function(){$location.path("print/queue")})});return true}})}else{Queue.$addToQueue({filetype:"text/stl"},{id:response.data.id}).then(function(){$timeout(function(){$location.path("print/queue")})})}return true}}]})}});$socket.socket.on("device.connected",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"device",type:"info"})});$socket.socket.on("device.disconnected",function(data){$notification.addNotification({title:data.title,message:data.message,channel:"device",type:"info"})})}function componentLoaderConfig($componentLoaderProvider){$componentLoaderProvider.setTemplateMapping(function(name){var dashName=dashCase(name);return dashName+"/componentView.html"})}componentLoaderConfig.$inject=["$componentLoaderProvider"];MainController.$inject=["$scope","$rootScope","$router","$location","$api","$http","$socket","$notification","ngDialog","$timeout","Device","Printer","Upload","File","Printjob","Queue","$routeParams","$interval"];MainController.$routeConfig=[{path:"/dashboard",nav:{name:"Dashboard",title:"Dashboard"},loggedIn:true,env:"cloud",dashboard:true,component:{mainView:"dashboard"},as:"dashboard"},{path:"/files",nav:{name:"Library",title:"Uploaded STL- and GCODE files"},loggedIn:true,component:{mainView:"files"},as:"files"},{path:"/files/:fileId/new/sliced",component:{mainView:"filesNewSliced"},as:"filesNewSliced"},{path:"/manage",nav:{name:"Manage",title:"Manage your printers and settings"},loggedIn:true,component:{mainView:"manage"},as:"manage"},{path:"/print",nav:{name:"Print",title:"Control your selected 3D printer"},loggedIn:true,component:{mainView:"print"},as:"print"},{path:"/",env:"cloud",nav:{name:"Learn",title:"Go to the help center"},loggedIn:true,as:"/",href:"http://support.formide.com"},{path:"/settings",nav:{name:"Account",title:"Account Settings"},loggedIn:true,env:"cloud",component:{mainView:"settings"},rightSide:true,as:"settings"},{path:"/login",nav:{name:logoutTitle,title:logoutTitle},component:{mainView:"authLogin"},as:"authLogin",rightSide:true},{path:"/connectWifi",component:{mainView:"connectWifi"},as:"connectWifi"},{path:"/landing",component:{mainView:"landing"},as:"landing"}];angular.module("app",["module.angular","module.vendor","module.filters","module.templateCache","module.services","module.shared","module.core","module.components","filter.tenth","filter.float","filter.seconds","filter.unique","filter.smartduration","filter.smartbytes","ui.select","formide.viewer","service.slicer","service.sidebar","core.header","component.printer.setup","component.device.setup","component.auth.login","component.auth.logout","component.onboarding","component.connectWifi","component.dashboard","component.print","component.print.jobs","component.print.queue","component.print.controls","component.print.monitor","component.print.console","component.manage","component.manage.sliceprofiles","component.manage.printers","component.manage.device","component.manage.device.update","component.manage.materials","component.manage.devices","component.manage.devices.info","component.manage.devices.setup","component.manage.devices.sessions","component.manage.devices.update","component.settings","component.settings.account","component.settings.logs","component.files","component.files.details","component.files.preUpload","component.files.upload","component.printjob","component.printjob-printer","component.gcode-viewer","component.gcode-download","component.discover","component.discover.search","component.discover.models","component.formide-info"]).config(componentLoaderConfig).controller("AppController",MainController).run(function($window,$rootScope){$rootScope.online=navigator.onLine;$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=false})},false);$window.addEventListener("online",function(){$rootScope.$apply(function(){$rootScope.online=true})},false)})})();(function(){angular.module("templateCache.components",[]).run(["$templateCache",function($templateCache){"use strict";"use strict";$templateCache.put("auth-login/componentView.html",'<div class=login ng-if="app.environmentLocation !== \'cloud\'"><article ng-if="authLogin.loginPage == \'cloudCode\'"><div class=formideConnect><section class="logo logo--large"><svg version=1.1 baseprofile=full xmlns=http://www.w3.org/2000/svg viewbox="0 0 128 128" rel=logo><lineargradient id=strokeGradient gradientunits=userSpaceOnUse x1=64 y1=127.8776 x2=64 y2=0.1224><stop offset=0 style="stop-color:#2192D2"><stop offset=1 style="stop-color:#5FC6F3"></lineargradient><path style=fill:none;stroke:#46b1e6;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;shape-rendering:geometric-precision d="\n'+"\t\t\t\t   M102.202,59.171c0,0-8.327-11.914-17.334-24.799C74.244,19.174,62.67,2.622,62.67,2.622L33.505,25.107L17.716,91.418l20.031,33.867\n"+"\t\t\t\t   l46.678,0.092c0,0,9.292-9.086,16.739-16.37c4.965-4.856,9.12-8.922,9.12-8.922L102.202,59.171z M62.67,2.622l22.198,31.75\n"+"\t\t\t\t   L77.732,54.84l-23.434,5.772L62.67,2.622z M60.823,74.021l11.906,3.725L63.038,90.75l-9.523-9.059L60.823,74.021z M53.514,81.691\n"+"\t\t\t\t   l-14.556-3.105l15.34-17.974l6.525,13.409L53.514,81.691z M60.823,74.021l-6.525-13.409l23.434-5.772l8.818,30.911l-13.821-8.004\n"+"\t\t\t\t   c-0.092-0.057,0.123,0.039,0,0L60.823,74.021z M33.505,25.107L62.67,2.622l-8.372,57.99l-15.34,17.974L17.716,91.418L33.505,25.107z\n"+"\t\t\t\t    M17.716,91.418l21.242-12.832l14.556,3.105l9.523,9.059l-1.86,18.547l-23.43,15.988L17.716,91.418z M37.747,125.285l23.43-15.988\n"+"\t\t\t\t   l23.248,16.08L37.747,125.285z M84.425,125.378l-23.248-16.08l1.86-18.547l9.691-13.004c0,0,7.225,4.184,13.821,8.004\n"+"\t\t\t\t   c5.524,3.199,10.61,6.146,10.61,6.146l4.005,17.11L84.425,125.378z M97.159,91.897L97.159,91.897l-10.61-6.146L77.732,54.84\n"+'\t\t\t\t   l7.136-20.469l17.334,24.799l8.082,40.922l-9.12,8.915L97.159,91.897z"></svg><h1>Formide</h1></section><section><hgroup class=u-textCenter><h1>Connect to Formide</h1></hgroup><p class="u-textCenter u-margin-top-3 u-margin-bottom-1">Clicking connect will link your device to Formide and allow you to use the full power of the cloud.</p><p class="u-textCenter u-margin-bottom-3">Once complete, you will be redirected.</p><p class="u-textCenter u-margin-bottom-1">If this is a custom device it must first be whitelisted.</p><p class=u-textCenter>You can request this via <a href="mailto:hello@formide.com?subject=I would like to whitelist my device">Email</a></p><div class="u-textCenter u-margin-top-3"><button class="btn btn--primary" ng-click=authLogin.connectToFormide() ng-disabled="authLogin.connecting && !authLogin.url" ng-click=""><span ng-if=!authLogin.url>Connect <i ng-if=authLogin.connecting class="fa fa-refresh fa-spin"></i></span> <span ng-if=authLogin.url>Go to Formide</span></button><div ng-if=authLogin.connectingError class="text-base-alert-color u-margin-top-1">{{authLogin.connectingError}}</div></div></section></div><div class="navBox navBox--right"><div class=navBox__tab ng-click="authLogin.setLoginPage(\'localLogin\')"><a class=anchor__link>Local Login <i class="fa fa-angle-right"></i></a></div></div></article><article ng-if="authLogin.loginPage == \'localLogin\'"><div class=localLogin><section class="logo logo--large"><svg version=1.1 baseprofile=full xmlns=http://www.w3.org/2000/svg viewbox="0 0 128 128" rel=logo><lineargradient id=strokeGradient gradientunits=userSpaceOnUse x1=64 y1=127.8776 x2=64 y2=0.1224><stop offset=0 style="stop-color:#2192D2"><stop offset=1 style="stop-color:#5FC6F3"></lineargradient><path style=fill:none;stroke:#46b1e6;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;shape-rendering:geometric-precision d="\n'+"\t\t\t\t   M102.202,59.171c0,0-8.327-11.914-17.334-24.799C74.244,19.174,62.67,2.622,62.67,2.622L33.505,25.107L17.716,91.418l20.031,33.867\n"+"\t\t\t\t   l46.678,0.092c0,0,9.292-9.086,16.739-16.37c4.965-4.856,9.12-8.922,9.12-8.922L102.202,59.171z M62.67,2.622l22.198,31.75\n"+"\t\t\t\t   L77.732,54.84l-23.434,5.772L62.67,2.622z M60.823,74.021l11.906,3.725L63.038,90.75l-9.523-9.059L60.823,74.021z M53.514,81.691\n"+"\t\t\t\t   l-14.556-3.105l15.34-17.974l6.525,13.409L53.514,81.691z M60.823,74.021l-6.525-13.409l23.434-5.772l8.818,30.911l-13.821-8.004\n"+"\t\t\t\t   c-0.092-0.057,0.123,0.039,0,0L60.823,74.021z M33.505,25.107L62.67,2.622l-8.372,57.99l-15.34,17.974L17.716,91.418L33.505,25.107z\n"+"\t\t\t\t    M17.716,91.418l21.242-12.832l14.556,3.105l9.523,9.059l-1.86,18.547l-23.43,15.988L17.716,91.418z M37.747,125.285l23.43-15.988\n"+"\t\t\t\t   l23.248,16.08L37.747,125.285z M84.425,125.378l-23.248-16.08l1.86-18.547l9.691-13.004c0,0,7.225,4.184,13.821,8.004\n"+"\t\t\t\t   c5.524,3.199,10.61,6.146,10.61,6.146l4.005,17.11L84.425,125.378z M97.159,91.897L97.159,91.897l-10.61-6.146L77.732,54.84\n"+'\t\t\t\t   l7.136-20.469l17.334,24.799l8.082,40.922l-9.12,8.915L97.159,91.897z"></svg><h1>The Element</h1></section><section><hgroup class=u-textCenter><h1>Local Login</h1></hgroup><form class=login-fields ng-submit=authLogin.submitLoginForm()><input ng-model=authLogin.user.email class=text-input placeholder="Email Address"> <input type=password ng-model=authLogin.user.password class=text-input placeholder=Password> <input type=submit class="btn btn--primary" value="Sign in"> <span ng-if=authLogin.loading><i class="fa fa-2x fa-refresh fa-spin text-base-primary-color u-posAbsolute u-margin-left-1"></i></span> <span ng-if=!authLogin.loading class="u-margin-left-1 text-base-alert-color">{{ authLogin.errorMessage }}</span></form><section class=infoBox><i class="fa fa-info-circle"></i><p>Note that you are logging into the Element locally. If it is for the first time you can use the follow:</p><p>Username: <strong>admin@local</strong><br>Password:&nbsp; <strong>admin</strong></p><p>To use the full suite of features visit <a href=https://platform.formide.com><strong>Formide</strong></a></p></section></section></div><div class="navBox navBox--left"><div class=navBox__tab ng-click="authLogin.setLoginPage(\'cloudCode\')"><a class=anchor__link><i class="fa fa-angle-left"></i> Connect to Formide</a></div></div></article></div><article class="fade loading-queue-state u-textCenter" ng-if="app.environmentLocation === \'cloud\'"><br><br><br><br><h4><i class="fa fa-2x fa-globe"></i></h4><h5 class=loader>Redirecting <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h5><h6><a href="\'../../api/auth/login">Click here if the page does not redirect you.</a></h6></article>');
$templateCache.put("auth-logout/componentView.html","");$templateCache.put("connect-wifi/componentView.html",'<div class="login content content--small" style="max-width: 465px"><article><br><br><br><br><br><br><section class="animated fadeInDown"><hgroup class=u-textCenter><h1>Device Wifi Changed</h1></hgroup><p>The Wifi on your device has been sucessfully changed</p><p>If you would like to continue using the local interface, please navigate to the new IP address of your device</p><p>Assistance on how to on find the Element\'s IP address can be found <a href=https://formide.zendesk.com/hc/en-us/articles/206881739-What-is-my-Element-s-IP-address- target=_blank>here</a></p></section></article></div>');$templateCache.put("dashboard/componentView.html",'<section class="is-header dashboard-header"><nav class="nav in-header core-nav core-nav-sub"><ul class="list-inline u-textNoWrap"><li class=active><a>Dashboard</a></li><li class=xs-hide><a id=latestChanges></a></li></ul></nav></section><article id=dashboard class=inner-page-content><ul class="panel-container layout"><li dashboard-panel header-title="\'Last 5 Slices\'" header-icon="\'katana--white\'" class="layout__item u-1/2-sm"><dashboard-slices></dashboard-slices></li><li dashboard-panel header-title="\'Storage\'" header-icon="\'fa-hdd-o\'" class="layout__item u-1/2-sm"><dashboard-storage></dashboard-storage></li><li dashboard-panel header-title="\'Latest News\'" header-icon="\'fa-newspaper-o\'" header-btn=dashboard.newsHeaderBtn class="layout__item u-1/2-sm"><dashboard-news></dashboard-news></li><li dashboard-panel header-title="\'Community\'" header-icon="\'fa-commenting-o\'" header-btn=dashboard.communityHeaderBtn class="layout__item u-1/2-sm"><dashboard-community></dashboard-community></li></ul></article>');$templateCache.put("device-setup/componentView.html",'<div class="content content--small onboarding"><section><div ng-if=!modal.setupComplete><figure class="onboarding-figure xs-hide"><img class="balloon-image balloon-image--element" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"> <img class=main-image src=public/assets/images/setup/setup_element.png width=280 height=280 alt=Printer></figure><br><h2><i class=fa ng-class="modal.detecting ? \'fa-refresh fa-spin text-base-orange\' : \'fa-check text-base-green\'"></i> <span ng-if=modal.detecting>Searching for Device</span> <span ng-if="!modal.detecting && modal.registrationToken">Device found</span> <span ng-if="!modal.detecting && modal.cloudCode">Set up Complete</span></h2><div ng-if=modal.errorMessage class="text--error u-margin-bottom-1">{{ modal.errorMessage }}</div><div ng-if=" modal.warningMessage" class="text--error u-margin-bottom-1" style="width: 400px;line-height: 1.5rem">{{ modal.warningMessage }}</div><div class=entry-content><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.closeSetup()>Cancel</button> <button ng-disabled=modal.detecting class="btn action--secondary" ng-click=modal.finishRegistration()><span ng-if=modal.registrationToken>Finish setup</span> <span ng-if=modal.cloudCode>Set up a Printer</span></button></div></div></div><div ng-if=modal.setupComplete><figure class="onboarding-figure xs-hide"><img class="balloon-image balloon-image--printer" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"> <img class=main-image src=public/assets/images/setup/setup_printer.png width=280 height=280 alt=Printer></figure><h2><i class="fa fa-check text-base-green"></i> Element setup complete</h2><p>You can now set up your printer</p><p>Click on the \'Set up a Printer\' button below to get started</p><div class=entry-content><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.closeConnectPrinter()>Close</button> <button class="btn action--secondary" ng-click=modal.connectPrinter()>Set up a Printer</button></div></div></div></section></div>');$templateCache.put("discover-accounts/componentView.html",'<h3>Accounts</h3><article class=block><div class=layout><discover-thumbnail ng-repeat="item in discoverAccounts.accounts" class="layout__item u-1/5" title="{{item.firstname}} {{item.lastname}}" tagline={{item.filename}} image={{item.avatar}}></discover-thumbnail></div></article>');$templateCache.put("discover-models/componentView.html",'<article class=threedshapes><div class="file-container layout"><li ng-repeat="item in discoverModels.threedshapes" ng-click="discover.previewModal(\'threedshapes\', item)" context-menu data-target="menu-{{ $index }}" class="file-block layout__item" ng-class="{\'file-block--selected\': file.$selected}"><div class="entry-content block-selection"><header><h3 class=u-textTruncate>{{item.title | title}}</h3><h4 class=u-textTruncate>{{item.description}}</h4></header><div class="layout layout--withoutGutter layout--alignCenter btn--slice-container"><button class="btn btn--white btn--slice text-base-primary">Download</button></div><img ng-src={{item.thumb}} alt=""></div></li><p ng-if=discoverModels.noResults class="layout__item u-1/1">No search results found!</p><p ng-if="discoverModels.busy && !discoverModels.noResults" class="layout__item u-1/1 loader">Loading models<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></p></div></article>');$templateCache.put("discover-search/componentView.html",'<h3>Search Results</h3><section id=search-models><h3>Models from 3DShapes</h3><article class=threedshapes><div class="file-container layout"><li ng-repeat="item in discoverSearch.threedshapes" ng-click="discover.previewModal(\'threedshapes\', item)" context-menu data-target="menu-{{ $index }}" class="file-block layout__item" ng-class="{\'file-block--selected\': file.$selected}"><div class="entry-content block-selection"><header><h3 class=u-textTruncate>{{item.title | title}}</h3><h4 class=u-textTruncate>{{item.description}}</h4></header><a class="btn btn--white btn--slice text-base-primary">Download</a> <img ng-src={{item.thumb}} alt=""></div></li><p ng-if="discoverSearch.threedshapes.length < 1 && !discoverSearch.busy" class="layout__item u-1/1">No search results found!</p><p ng-if=discoverSearch.busy class="layout__item u-1/1 loader">Loading models<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></p></div></article></section>');$templateCache.put("discover/componentView.html",'<section class="discover-header is-header"><header><form ng-submit=discover.doSearch()><fieldset><label class=search-bar><input ng-model=discover.searchQuery ng-change=discover.doSearch() ng-model-options="{ debounce: 500 }" class=text-input placeholder="Search 3d models"> <button><i class="fa fa-2x fa-search"></i></button></label></fieldset></form><div class="u-textRight di-logo"><a href=http://3dindustri.es target=_blank title="Powered by 3D Industries"><img width=95px src=./public/assets/images/poweredby_3di_c.png alt="Powered by 3D Industries"></a></div></header><nav core-nav core-nav-sub route-config=discover.routeConfig role="primary navigation" rel=nav></nav></section><div ng-viewport=subView class="inner-page-content discover-content"></div>');$templateCache.put("discover/previewModal.html",'<h3>{{modal.data.title | title}}</h3><div class=discover-viewer-wrapper><div class="viewer-loading fade" ng-if=modal.viewerLoading><h4><i class="fa fa-2x fa-refresh fa-spin"></i></h4><h6 class=loader>Loading Model <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6></div><formide-viewer app=modal.appFunction style="margin: 0 auto" width=320px height=320px settings=modal.appSettings></formide-viewer></div><br><hr class="rule"><section class=u-textRight><button class="btn btn--secondary" ng-click=closeThisDialog()>Cancel</button> <button class=btn ng-if="modal.downloading[modal.id] == undefined" ng-click="modal.downloadFile(modal.id, modal.data.title)">Add to Library</button> <button ng-if="modal.downloading[modal.id].status == \'downloading\'" class="btn loader">Downloading<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></button> <a ng-if="modal.downloading[modal.id].success == true" ng-click="modal.navigate(\'files\'); closeThisDialog()" class=btn>Go to Library</a> <small ng-if="modal.downloading[modal.id].success == false">Download Failed</small></section>');$templateCache.put("files-details/fileDetailsModal.html",'<article class="hentry article--modal files-details" ng-init="modal.editMode = false" ng-class="{\'edit-mode\': modal.editMode, \'loadingOverlay-cover\': modal.loadingEdit || modal.viewerLoading}"><header><div class="layout layout--alignMiddle"><div class="layout__item u-fit"><a ng-click=modal.toggleEdit() class="pill pill--primary xs-hide"><i class="fa fa-pencil"></i> Edit</a></div><div class="layout__item u-fill-sm"><h3 class=entry-title ng-if=modal.editMode><input class=text-input ng-model=modal.file.prettyname placeholder=Filename maxlength=100></h3><h3 class=entry-title ng-if=!modal.editMode>{{modal.file.prettyname}}</h3></div><div class="layout__item u-fit-sm"><button ng-if="!modal.editMode && modal.file.filetype == \'text/stl\'" ng-click=modal.newPrintjob([modal.file]) class="btn btn--large action-btn-large">Slice and Print</button> <button ng-if="!modal.editMode && modal.file.filetype == \'text/gcode\'" ng-click=modal.addToQueue(modal.file) class="btn btn--large action-btn-large">Add to Queue</button></div></div></header><section class=entry-content><div class=layout><div class="details layout__item u-fill" ng-class=modal.detailsClass()><section class=preview-wrapper ng-if="modal.file.filetype == \'text/stl\'"><ul rn-carousel rn-carousel-index=modal.carouselIndex class=carousel ng-class="{blurred: blurred}" ng-if=!modal.editMode><li ng-repeat="image in modal.file.images"><div ng-if="modal.environmentLocation === \'cloud\'" style="background-image: url(\'{{modal.imagesRootLocation}}/{{image}}\')" class=bgimage></div><div ng-if="modal.environmentLocation === \'local\'" style="background-image: url(\'{{ modal.imagesRootLocation + \'/\' + modal.file.id + \'/images/\' + image + \'?access_token=\' + modal.access_token }}\')" class=bgimage></div></li></ul><formide-viewer ng-init=modal.loadedViewer() ng-if=modal.editMode app=modal.appFunction width=320px height=320px style="margin: 0 auto" settings=modal.appViewerSettings></formide-viewer><ul class="list-inline upload-thumbnails buttonslist fade" ng-if=modal.editMode><li><figure ng-click=modal.takeScreenshot() class=icon><i class="fa fa-camera"></i></figure></li></ul></section><ul class="list-inline file-thumbnails" ng-if="modal.file.filetype == \'text/stl\'"><li ng-repeat="image in modal.file.images"><a class="remove bounce" ng-if=modal.editMode ng-click=modal.removeScreenshot($index)><i class="fa fa-times text-base-red"></i></a> <a class=thumb ng-style="{\'thumb--selected\': modal.carouselIndex == $index}" ng-click="modal.carouselIndex = $index"><img ng-if="modal.environmentLocation === \'cloud\'" draggable=false ng-src="{{ modal.imagesRootLocation + \'/\' + image }}"> <img ng-if="modal.environmentLocation === \'local\'" ng-src="{{ modal.imagesRootLocation + \'/\' + modal.file.id + \'/images/\' + image + \'?access_token=\' + modal.access_token }}" alt="" draggable=false></a></li><li class="add-new bounce" ng-if=!modal.editMode><a class=thumb ng-click=modal.toggleEdit()><i class="fa fa-plus"></i></a></li><li class="add-new bounce" ng-if=modal.thumbnailLoading><a class=thumb><i class="fa fa-spin fa-refresh"></i></a></li></ul><section class="footer details" ng-class="{\'gcodeFooter\': modal.file.filetype == \'text/gcode\'}"><h3>Details</h3><ul class=form-fields ng-if=modal.editMode><li><ui-select multiple tagging tagging-label="" ng-model=modal.file.tags theme=select2 title="Choose a color" style="width: 100%"><ui-select-match placeholder="Tags (optional)">{{$item}}</ui-select-match><ui-select-choices repeat="tag in modal.tags">{{tag}}</ui-select-choices></ui-select></li><li><textarea name=name ng-model=modal.file.description rows=2 class=text-input placeholder="Description (optional)"></textarea></li><li class=u-textRight><a class="btn btn--secondary" ng-click=modal.cancelEdit()>Cancel</a> <a class=btn ng-click="modal.saveModelfile(modal.file) && modal.cancelEdit()">Save File</a></li></ul><div class=form-fields ng-if=!modal.editMode><h5>Tags: <span ng-repeat="tag in modal.file.tags">{{tag}}<span ng-if="tag != modal.file.tags[modal.file.tags.length-1]">,&nbsp;</span></span></h5><h5 class=description>Description: {{modal.file.description}}</h5></div></section></div><div ng-if="!modal.editMode && modal.file.filetype !== \'text/gcode\'" class="slicing-history layout__item u-1/2-sm"><h3 class=history-header>Slice History</h3><table class="table--formide table--formide--clean" ng-if="modal.file.filetype !== \'text/gcode\'"><tbody ng-if=modal.file.$resolved ng-repeat="printjob in modal.file.printJobs | filter:searchFilter | orderBy:\'updatedAt\':true" ng-init="modal.initTooltip[$index] = false"><tr><td colspan=2 class=printjob-name>{{printjob.name | title}}</td><td colspan=2 ng-if=printjob.sliceFinished><span class=u-textTruncate>{{printjob.updatedAt | timeAgo}}</span></td><td colspan=2 ng-if=!printjob.sliceFinished><span ng-if=!printjob.sliceResponse.msg>Slicing in progress<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></span> <span ng-if=printjob.sliceResponse.msg class=text-base-red>{{printjob.sliceResponse.msg}}</span></td></tr><tr class=xs-hide ng-if="modal.environmentLocation === \'cloud\'"><td width=25%><button ng-if="printjob.sliceSettings.files[0].modelId.length > 10" ng-click=modal.newPrintjob(printjob) class="btn btn--small btn--tertiary action-btn"><span class=u-textNoWrap>Re-Slice</span></button></td><td width=25% class=sm-and-down-hide><button ng-disabled=!printjob.gcode ng-click=modal.openGcodeViewer(printjob) class="btn btn--small btn--tertiary action-btn">View <span class=u-textNoWrap>G-code</span></button></td><td width=25%><button ng-disabled=!printjob.gcode ng-click=modal.downloadGcode(printjob) class="btn btn--small btn--tertiary action-btn">Download <span class=u-textNoWrap>G-code</span></button></td><td width=25%><button ng-click=modal.removePrintjob(printjob.id) class="btn btn--small btn--alert action-btn"><i class="fa fa-trash-o"></i></button></td></tr><tr class=xs-hide ng-if="modal.environmentLocation === \'cloud\'"><td colspan=4><button ng-disabled="!printjob.sliceFinished || printjob.addingToQueue" ng-click="modal.addToQueue(modal.file, printjob)" class="btn btn--small btn--primary action-btn" style="font-size: 13px">Add to Queue <i ng-if=printjob.addingToQueue class="fa fa-refresh fa-spin"></i></button></td></tr><tr class=sm-hide ng-if="modal.environmentLocation === \'cloud\'"><td colspan=2 width=50%><button ng-disabled=!printjob.sliceFinished ng-click="modal.addToQueue(modal.file, printjob)" class="btn btn--small btn--primary action-btn">Add to Queue</button></td><td colspan=2 width=50%><button ng-click=modal.removePrintjob(printjob.id) class="btn btn--small btn--alert action-btn"><i class="fa fa-trash-o"></i></button></td></tr><tr ng-if="modal.environmentLocation === \'local\'"><td colspan=2 width=50%><button ng-disabled=!printjob.sliceFinished ng-click="modal.addToQueue(modal.file, printjob)" class="btn btn--small btn--primary action-btn">Add to Queue</button></td><td colspan=2 width=50%><button ng-click=modal.removePrintjob(printjob.id) class="btn btn--small btn--alert action-btn"><i class="fa fa-trash-o"></i></button></td></tr><tr><td colspan=4><a add-new ng-init="toggleMore = false" ng-click="toggleMore = !toggleMore"><i class=fa ng-class="{true:\'fa-minus\',false:\'fa-plus\'}[toggleMore]"></i> More info</a></td></tr><tr><td class=table--sub-container colspan=4><slice-details-list printjob=printjob ng-if=toggleMore></slice-details-list></td></tr></tbody><tr ng-if="modal.file.filetype !== \'text/gcode\' && (!modal.file.printJobs || (modal.file.printJobs | filter:searchFilter).length < 1) && modal.file.$resolved"><td colspan=4><h5 class=u-margin-left-0><strong>This file has not been sliced before!</strong></h5><h6>You still need to <i><a ng-click=modal.newPrintjob([modal.file])>Slice and Print</a></i> this file for the first time! After slicing the file will appear in this list.</h6></td></tr><tr ng-if=!modal.file.$resolved><td colspan=4 class=u-textCenter><h4><i class="fa fa-2x fa-refresh fa-spin"></i></h4><h6 class=loader>Loading slice history <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6></td></tr></table></div><div ng-if="!modal.editMode && modal.file.filetype == \'text/gcode\' && modal.environmentLocation == \'cloud\'" class="layout__item u-fit g-code-container xs-hide"><button ng-click=modal.openGcodeViewer() class="btn btn--large btn--tertiary action-btn-large">View G-code</button></div></div></section></article><div class=loadingOverlay ng-if="modal.loadingEdit || modal.viewerLoading"><h4><i class="fa fa-2x fa-refresh fa-spin"></i></h4><h6 class=loader>Loading <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6></div>');$templateCache.put("files-pre-upload/componentView.html",'<article class="hentry article--modal"><header class=u-padding-bottom-_5><h3 class="entry-title layout-item u-fit">Upload</h3></header><section class="entry-content upload-panel"><div class=layout><section class="layout__item u-1/1"><div class="click-upload layout layout--alignCenter layout--alignMiddle" ng-class="{\'uploading\': $root.fileUploading}" ng-disabled=$root.fileUploading ngf-select=modal.upload($files) ngf-multiple=true ngf-pattern="\'text/*\'"><div ng-if="!$root.fileUploading || modal.loadingDrive || modal.loadingDropbox" class="layout__item u-fit"><i ng-if="modal.environmentLocation === \'cloud\'" class="fa fa-cloud-upload large grey"></i> <i ng-if="modal.environmentLocation === \'local\'" class="fa fa-upload large grey"></i></div><div class="layout__item u-fit" ng-if=!$root.fileUploading><h4>Click here to Upload a file...</h4></div><div class="layout__item u-2/3" ng-if="$root.fileUploading && !modal.loadingDrive && !modal.loadingDropbox"><h6 class=u-textCenter>Progress: {{$root.uploadProgress}}%</h6><progress-bar valuenow={{$root.uploadProgress}} valuemax=100></progress-bar></div><div class="layout__item u-fit" ng-if="modal.loadingDrive || modal.loadingDropbox"><h4 class="u-textCenter loader">Uploading<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h4></div></div></section><section class="layout__item u-1/1" ng-if="modal.environmentLocation === \'cloud\' && !modal.dragDrop"><h5>Or add a file directly from a Shared Link <span class=toggleMore ng-init="toggleMore = false" ng-click="toggleMore = !toggleMore"><i class="fa grey" ng-class="{true:\'fa-minus\',false:\'fa-plus\'}[toggleMore]"></i> More info</span></h5><section class=moreInfo ng-if=toggleMore><h5 class=text>Files can be uploaded directly to formide from Google Drive or Dropbox by using their shareable link. This can save you time and effort. For a helpful guide on how to do this, please use the links below:</h5><div class="layout link"><div class="layout__item u-1/2 u-textCenter"><h5><a href=https://formide.zendesk.com/hc/en-us/articles/208952109-How-do-I-upload-an-STL-file-to-my-account#drive target=_blank>How to upload using Google Drive</a></h5></div><div class="layout__item u-1/2 u-textCenter"><h5><a href=https://formide.zendesk.com/hc/en-us/articles/208952109-How-do-I-upload-an-STL-file-to-my-account#dropbox target=_blank>How to upload using Dropbox</a></h5></div></div></section></section><section class="layout__item u-1/2-sm u-1/1" ng-if="modal.environmentLocation === \'cloud\' && !modal.dragDrop"><div class=containter-drive><img src=./public/assets/images/googleDrive_logo.png class="logo"><form><div class="layout link"><div class="layout__item u-5/6 input-container"><i class="fa fa-link grey"></i><input class=text-input ng-disabled="modal.loadingDropbox || modal.loadingDrive || $root.fileUploading" ng-model=modal.driveLink placeholder="Paste in shareable link..."></div><div class="layout__item u-1/6 btn-container"><button class="btn btn--white btn--submit" type=submit ng-disabled="modal.loadingDropbox || modal.loadingDrive || $root.fileUploading" ng-click=modal.submitDriveLink()><i class=fa ng-class="{true:\'fa-refresh fa-spin\',false:\'fa-caret-right\'}[modal.loadingDrive]"></i></button></div></div></form></div></section><section class="layout__item u-1/2-sm u-1/1 layout__right" ng-if="modal.environmentLocation === \'cloud\' && !modal.dragDrop"><div class=containter-dropbox><img src=./public/assets/images/dropbox_logo.png class="logo"><form><div class="layout link"><div class="layout__item u-5/6 input-container"><i class="fa fa-link grey"></i><input class=text-input ng-disabled="modal.loadingDropbox || modal.loadingDrive || $root.fileUploading" ng-model=modal.dropboxLink placeholder="Paste in shareable link..."></div><div class="layout__item u-1/6 btn-container"><button class="btn btn--white btn--submit" type=submit ng-disabled="modal.loadingDropbox || modal.loadingDrive || $root.fileUploading" ng-click=modal.submitDropboxLink()><i class=fa ng-class="{true:\'fa-refresh fa-spin\',false:\'fa-caret-right\'}[modal.loadingDropbox]"></i></button></div></div></form></div></section><section class="layout__item u-1/1" ng-if=modal.URLerrorMessage><p class=error>{{modal.URLerrorMessage}}</p></section></div></section></article>');$templateCache.put("files-upload/fileUploadModal.html",'<article class="hentry article--modal" ng-init="editMode = false" ng-class="{\'edit-mode\': editMode}"><header><h3 class=entry-title ng-if="modal.model.filetype !== \'text/gcode\'">Take Screenshot</h3><h3 class=entry-title ng-if="modal.model.filetype == \'text/gcode\'">Upload Complete</h3></header><section id=uploadModel class=entry-content><div ng-if=!modal.URLupload class="progress-container layout"><h6 class="u-textTruncate layout__item u-2/3" title="Original filename: {{modal.model.filename}}"><i class="fa fa-file-text-o"></i> {{modal.model.filename}}</h6></div><div ng-if=!modal.URLupload><div class=preview ng-if="modal.model.filetype !== \'text/gcode\'"><h4>Preview</h4><h6 ng-if="files.environmentLocation === \'cloud\'">Align the preview to generate a thumbnail image on save.</h6><div class="viewer-loading fade" ng-if=modal.viewerLoading><h4><i class="fa fa-2x fa-refresh fa-spin"></i></h4><h6 class=loader>Processing File <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6></div><formide-viewer ng-init=modal.loadedViewer(modal.model) app=modal.appFunction width=320px height=320px style="margin: 0 auto" settings=modal.appViewerSettings></formide-viewer></div><div class=u-textRight><a ng-click=modal.cancelModelfile(modal.model) class="btn btn--secondary">Cancel</a> <a ng-click=modal.saveModelfile(modal.model) class=btn>Save</a></div></div></section></article>');$templateCache.put("files/componentView.html",'<section class="files-header is-header"><div class="layout layout--withoutGutter layout--alignMiddle"><div class="layout__item u-fill-sm u-fit"><nav class="nav in-header core-nav core-nav-sub"><ul class="list-inline u-textNoWrap xs-hide"><li class=active ng-if="files.currentFolder.id == files.folderPath[0].id"><a>Library</a></li><li ng-if="files.folderPath.length > 2"><a ng-click=files.selectParentFolder({id:0})>Library</a> <i class=gt></i></li><li ng-repeat="folder in files.folderPath | filter: {id: \'!\' + files.currentFolder.id} | limitTo:-1" library-drag-drop file="{id: folder.id, filetype:\'path\'}" mousedown=files.mousedown dragbox=files.dragbox dialogaway=files.dialogAway&quot;&quot; drop=files.handleDrop><a ng-click=files.selectParentFolder(folder)>{{folder.prettyname | removeFiletype | removeDashes | title}}</a> <i class=gt></i></li><li ng-if="files.currentFolder.id != files.folderPath[0].id" class=active><a>{{files.currentFolder.prettyname | removeFiletype | removeDashes | title}}</a></li></ul><ul class="list-inline u-textNoWrap sm-hide"><li class=returnArrow ng-if="files.currentFolder.id != files.folderPath[0].id"><a ng-click=files.selectParentFolder(files.folderPath[files.folderPath.length-2])><i class="fa fa-arrow-left"></i></a></li><li class=active><a>{{files.currentFolder.prettyname | removeFiletype | removeDashes | title}}</a></li></ul></nav></div><div class="files-controls layout__item u-fit-sm u-fit"><ul ng-if="(files.currentFolder.children | filter: files.selectedFilter).length > 0" class="fileOptionsList fade"><li><a ng-click="files.deleteToggle((files.currentFolder.children | filter: files.selectedFilter)); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() class="icon icon--remove" data-tooltip-bottom=Delete><i class="fa fa-trash-o" ng-class="{ \'icon--selected--red\': files.deleteOverlay }"></i></a></li><li ng-if="files.environmentLocation === \'cloud\'"><a ng-click="files.downloadFile((files.currentFolder.children | filter: files.selectedFilter));$event.stopPropagation();" ng-mousedown=$event.stopPropagation() class=icon data-tooltip-bottom=Download><i class="fa fa-download"></i></a></li><li ng-if="(files.currentFolder.children | filter: files.selectedFilterSTL).length > 0"><a ng-click="files.newPrintjob((files.currentFolder.children | filter: files.selectedFilterSTL)); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() class="icon slice" data-tooltip-bottom=Slice><i class=katana ng-class="{ \'purple\': files.environmentLocation === \'local\' }"></i></a></li></ul><ul class=optionsList><li class=xs-hide><a class="icon u-padding-right-0" ng-click=files.setFilesView() data-tooltip-bottom="Toggle View"><i ng-if=!files.filesViewList class="fa fa-list"></i> <i ng-if=files.filesViewList class="fa fa-th"></i></a></li><li ng-if="files.environmentLocation === \'local\'"><a ng-disabled=files.dialogAway class="icon upload" ng-disabled=$root.fileUploading ngf-select=files.upload_local($files) ngf-pattern="\'text/*\'" data-tooltip-bottom="Upload Files"><i class="fa fa-upload"></i></a></li><li ng-if="files.environmentLocation === \'cloud\'"><a ng-disabled=files.dialogAway class="icon upload" ng-click=files.upload() data-tooltip-bottom="Upload Files"><i class="fa fa-cloud-upload"></i></a></li><li ng-if="files.environmentLocation === \'cloud\'"><a ng-click="files.folderToggle(); files.fileToMove = (files.currentFolder.children | filter: files.selectedFilter); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() class=icon data-tooltip-bottom=Folders><i class="fa fa-folder-o" ng-class="{ \'icon--selected\': files.folderListOverlay }"></i></a></li><li ng-if="files.environmentLocation === \'cloud\'"><a class="icon sort" ng-click="files.sortToggle(); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() data-tooltip-bottom=Sort><i class="fa fa-sort-amount-desc" ng-class="{ \'icon--selected\': files.filesSortOverlay }"></i></a></li><li ng-if="files.environmentLocation === \'cloud\'"><a class=icon ng-click="files.filterToggle(); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() data-tooltip-bottom=Filter><i class="fa fa-search" ng-class="{ \'icon--selected\': files.filesFilterOverlay }"></i></a></li></ul></div></div></section><div class=printJob-return ng-if=files.dialogAway><h5 ng-click=files.backToPrintjob()>Return to viewer</h5></div><article id=files class=inner-page-content ng-keyup=files.checkKey($event) ng-mousedown="files.mousedown = true" ng-mouseup="files.mousedown = false; files.removeRectangle();" ng-mousemove=files.drawRectangle($event) ng-right-click=files.showGlobalMenu($event) pagination pagination-next-page=files.getNextPage pagination-scroll-distance=1><ul ng-if=!files.filesViewList class="file-container layout"><li class="file-block layout__item" id=file{{file.id}} ng-class="{\'file-block--selected\': file.$selected, \'file-block--dialog\': files.dialogAway}" ng-repeat="file in files.currentFolder.children" ng-click="files.selectFile($index, $event, file)" ng-dblclick=files.toggleFileDetails(file) ng-right-click="$event.stopPropagation(); files.showMenu($event, file);"><div class="entry-content block-selection" id={{file.id}} library-drag-drop file=file drop=files.handleDrop ng-mousedown="files.dragbox = false; $event.stopPropagation();"><header><h3 ng-show="!file.editName && !files.dialogAway" ng-click="file.editName = !file.editName; $event.stopPropagation();" class=u-textTruncate>{{file.prettyname | removeFiletype | removeDashes | title}}</h3><div ng-if="file.editName && !files.dialogAway" class=editName><form ng-submit="files.renameFile(file); file.editName = false;"><input ng-dblclick=$event.stopPropagation(); ng-click=$event.stopPropagation(); ng-blur="files.renameFile(file); file.editName = false;" ng-model=file.prettyname focus=file.editName maxlength="100"> <button ng-click="files.renameFile(file); file.editName = false; $event.stopPropagation();" class=saveName>&times;</button></form></div><h3 ng-show=files.dialogAway class=u-textTruncate>{{file.prettyname | removeFiletype | removeDashes | title}}</h3><h4 class=u-textTruncate>{{file.createdAt | timeAgo}}</h4></header><div class="layout layout--withoutGutter layout--alignCenter btn--slice-container"><button ng-if="!files.dialogAway && file.filetype === \'text/stl\' && (files.currentFolder.children | filter: files.selectedFilter).length < 2" ng-click=$event.stopPropagation();files.newPrintjob([file]); class="btn btn--white btn--slice text-base-primary xs-hide"><i class=katana-btn></i>Slice</button> <button ng-if="!files.dialogAway && file.filetype === \'text/gcode\' && (files.currentFolder.children | filter: files.selectedFilter).length < 2" ng-click=$event.stopPropagation();files.addToQueue(file); class="btn btn--white btn--slice text-base-primary xs-hide"><span class=bounce ng-if=!files.addingToQueue>Print</span> <span class=bounce ng-if=files.addingToQueue>Processing...</span></button> <button ng-if="!files.dialogAway && file.filetype === \'folder\'" ng-click="$event.stopPropagation(); files.selectFolder(file)" class="btn btn--white btn--slice text-base-primary xs-hide">Open</button></div><div ng-if="file.filetype === \'text/stl\' && !file.$selected && files.dialogAway" class="u-textCenter text-base-primary-color addBtn"><i class="fa fa-2x fa-plus-circle"></i><br><span>Add</span></div><img ng-if="file.filetype === \'text/stl\' && files.environmentLocation === \'local\' && file.images[0]" ng-src="{{ files.imagesRootLocation + \'/\' + file.id + \'/images/\' + file.images[0] + \'?access_token=\' + files.access_token }}" alt="" draggable=false> <img ng-if="file.filetype === \'text/stl\' && files.environmentLocation === \'cloud\' && file.images[0]" ng-src="{{ files.imagesRootLocation + \'/\' + file.images[0] }}" alt="" draggable=false> <img ng-if="file.filetype === \'text/stl\' && !file.images[0]" ng-src=./public/assets/images/stl_emptystate.png alt="" class=u-padding-2 draggable=false> <img ng-if="file.filetype === \'text/gcode\'" ng-src=./public/assets/images/gcode_emptystate.png alt="" class=u-padding-2 draggable=false> <i ng-if="file.filetype === \'folder\'" class=folder></i></div></li><li ng-if=!files.resolved class="layout__item u-full u-textCenter u-margin-top-2"><i class="fa fa-refresh fa-spin fa-3x text-base-primary-color"></i></li></ul><section ng-if="files.filesViewList && files.currentFolder.children.length > 0" id=listView class=block ng-class="{ \'cloud\': files.environmentLocation === \'cloud\' }"><table class="table--formide table--formide--responsive"><thead><tr ng-if="files.environmentLocation === \'cloud\'"><th class=name><a ng-click="files.setFilesSortBy(\'prettyname\'); files.getFiles(true);">Name <i ng-if="files.filesSortBy != \'prettyname\'" class="fa fa-sort"></i> <i ng-if="files.filesSortBy == \'prettyname\' && files.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="files.filesSortBy == \'prettyname\' && files.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th><a ng-click="files.setFilesSortBy(\'filetype\'); files.getFiles(true);">Type <i ng-if="files.filesSortBy != \'filetype\'" class="fa fa-sort"></i> <i ng-if="files.filesSortBy == \'filetype\' && files.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="files.filesSortBy == \'filetype\' && files.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th><a ng-click="files.setFilesSortBy(\'createdAt\'); files.getFiles(true);">Created <i ng-if="files.filesSortBy != \'createdAt\'" class="fa fa-sort"></i> <i ng-if="files.filesSortBy == \'createdAt\' && files.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="files.filesSortBy == \'createdAt\' && files.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th><a ng-click="files.setFilesSortBy(\'filesize\'); files.getFiles(true);">Size <i ng-if="files.filesSortBy != \'filesize\'" class="fa fa-sort"></i> <i ng-if="files.filesSortBy == \'filesize\' && files.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="files.filesSortBy == \'filesize\' && files.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th>Actions</th></tr><tr ng-if="files.environmentLocation !== \'cloud\'"><th class=name ng-class="{ \'local\': files.environmentLocation === \'local\' }">Name</th><th>Type</th><th>Created</th><th>Size</th><th>Actions</th></tr></thead><tbody><tr ng-repeat="file in files.currentFolder.children" ng-click="files.selectFile($index, $event, file);" ng-dblclick=files.toggleFileDetails(file) ng-right-click="$event.stopPropagation(); files.showMenu($event, file);" class=table__item ng-class="{\'tr--selected\': file.$selected}"><td data-th=Name class=name id={{file.id}} library-drag-drop file=file drop=files.handleDrop><div class=icon-container><span ng-if="file.filetype == \'folder\' && (!file.editName || files.dialogAway)" class="icon xs-hide"><i class=folder></i></span> <span ng-if="file.filetype !== \'folder\' && (!file.editName || files.dialogAway)" class="icon xs-hide"><img ng-if="file.filetype === \'text/stl\' && files.environmentLocation === \'local\' && file.images[0]" ng-src="{{ files.imagesRootLocation + \'/\' + file.id + \'/images/\' + file.images[0] + \'?access_token=\' + files.access_token }}" alt="" draggable=false> <img ng-if="file.filetype === \'text/stl\' && files.environmentLocation === \'cloud\' && file.images[0]" ng-src="{{ files.imagesRootLocation + \'/\' + file.images[0] }}" alt="" draggable=false> <img ng-if="file.filetype === \'text/stl\' && !file.images[0]" ng-src=./public/assets/images/stl_emptystate.png alt="" draggable=false> <img ng-if="file.filetype === \'text/gcode\'" ng-src=./public/assets/images/gcode_emptystate.png alt="" draggable=false></span></div><span class=name ng-show="!file.editName && !files.dialogAway" ng-click="file.editName = !file.editName; $event.stopPropagation();">{{file.prettyname | removeFiletype | removeDashes | title}}</span> <span class=editName ng-show="file.editName && !files.dialogAway"><form ng-submit="files.renameFile(file); file.editName = false;"><input ng-click=$event.stopPropagation(); ng-blur="files.renameFile(file); file.editName = false;" ng-change="file.editName = true" ng-model=file.prettyname focus=file.editName maxlength="100"> <button ng-click="files.renameFile(file); file.editName = false; $event.stopPropagation();" class=saveName>&times;</button></form></span> <span class=name ng-class="{ \'local\': files.environmentLocation === \'local\' }" ng-show=files.dialogAway>{{file.prettyname | removeFiletype | removeDashes | title}}</span></td><td data-th=Type>{{file.filetype | title}}</td><td data-th=Created>{{file.updatedAt | timeAgo}}</td><td ng-if="file.filetype !== \'folder\'" data-th=Size>{{ file.filesize | smartbytes:1 }}</td><td ng-if="file.filetype === \'folder\' && file.children != 1" data-th=Size>{{ file.children }} items</td><td ng-if="file.filetype === \'folder\' && file.children == 1" data-th=Size>1 item</td><td class="actions table__item__controls"><button ng-if="!files.dialogAway && file.filetype === \'text/stl\'" class="btn btn--small btn--tertiary btn--slice" ng-click=$event.stopPropagation();files.newPrintjob([file]); title=Slice><i class=katana-btn ng-class="{ \'purple\': files.environmentLocation === \'local\' }"></i></button> <button ng-if="!files.dialogAway && file.filetype === \'text/gcode\'" class="btn btn--small btn--tertiary btn--slice" ng-click=$event.stopPropagation();files.addToQueue(file); title=Print><i class=katana-btn ng-class="{ \'purple\': files.environmentLocation === \'local\' }"></i></button> <button ng-if="!files.dialogAway && file.filetype === \'text/stl\'" class="btn btn--small btn--tertiary" ng-click=$event.stopPropagation();files.toggleFileDetails(file); title=Details><i class="fa fa-history"></i></button></td></tr></tbody></table><div ng-if=!files.resolved class="u-textCenter u-margin-top-1 u-margin-bottom-1"><i class="fa fa-refresh fa-spin fa-2x text-base-primary-color"></i></div></section><section class=animate-show ng-show="files.currentFolder.children.length == 0 && files.currentFolder.id == files.folderPath[0].id && files.resolved" id=uploadInvite><div class="layout layout--alignCenter u-margin-top-3"><div class="icon layout__item u-fit"><i class="fa fa-files-o"></i></div><div class="layout__item u-2/5-sm u-3/5"><h2 class=xs-hide>Drag your files here</h2><p class=xs-hide>Or Upload them by using the <span class=upload-icon ng-click=files.upload() title="Upload Files"><i ng-if="files.environmentLocation === \'cloud\'" class="fa fa-cloud-upload"></i> <i ng-if="files.environmentLocation === \'local\'" class="fa fa-upload"></i></span> button</p><h2 class=sm-hide>Upload files</h2><p class=sm-hide>Upload files using the <span class=upload-icon ng-click=files.upload() title="Upload Files"><i ng-if="files.environmentLocation === \'cloud\'" class="fa fa-cloud-upload"></i> <i ng-if="files.environmentLocation === \'local\'" class="fa fa-upload"></i></span> button</p></div></div></section><library-overlay id=menu{{files.menuData.id}} class=xs-hide ng-if="files.showMenuOverlay && !files.folderListMenu && !files.deleteListMenu" ng-style=files.positionMenu overlay-close=files.showMenuOverlay overlay-title="{{files.menuData.prettyname | removeFiletype | removeDashes | title}}"><div class=body><div class=item ng-click="files.toggleFileDetails(files.menuData); files.showMenuOverlay = false;" label=View><i class="fa fa-eye"></i>View</div><div class=item ng-if="files.environmentLocation === \'cloud\'" ng-click="files.folderListMenu = true; files.fileToMove = [files.menuData]" label="Move to Folder"><i class="fa fa-folder-o"></i>Move to Folder</div><div class=item ng-if="files.environmentLocation === \'cloud\'" ng-click=files.downloadFile([files.menuData]) label=Download><i class="fa fa-cloud-download"></i>Download</div><div class=item ng-click="files.menuData.editName = true; files.showMenuOverlay = false;" label=Rename><i class="fa fa-pencil"></i>Rename</div><div class=item ng-click="files.removeConfirmMultiple([files.menuData]); files.deleteListMenu = true" label=Delete><i class="fa fa-trash-o"></i>Delete</div></div></library-overlay><library-overlay id=menu{{files.menuData.id}} class=xs-hide ng-if="files.showMenuOverlay && files.folderListMenu" ng-style=files.positionMenu overlay-close=files.folderListMenu overlay-title="Move to"><div class=body><div class=item ng-click="files.createFolder(files.fileToMove); files.showMenuOverlay = false; files.folderListMenu = false;"><i class="fa fa-folder-open-o"></i>New Folder</div><div ng-if="files.currentFolder.id != files.folderPath[0].id && files.fileToMove.length > 0" class=item ng-click="files.addToFolder(files.fileToMove, files.folderPath[files.folderPath.length-2]); files.showMenuOverlay = false; files.folderListMenu = false;"><i class="fa fa-external-link"></i>Parent Folder</div><div class="item u-textTruncate" ng-repeat="folder in files.currentFolder.children | filter: {filetype: \'folder\', id: \'!\' + files.menuData.id}" ng-click="files.addToFolder(files.fileToMove, folder); files.showMenuOverlay = false; files.folderListMenu = false;"><i class="fa fa-folder-o"></i>{{folder.prettyname | removeFiletype | removeDashes | title}}</div></div></library-overlay><library-overlay id=menu{{files.menuData.id}} class=xs-hide ng-if="files.showMenuOverlay && files.deleteListMenu" ng-style=files.positionMenu overlay-close=files.deleteListMenu overlay-title=Delete><div class=body><div class="item-static u-textTruncate"><div ng-init="thumbnail = false" ng-mouseover="thumbnail = true" ng-mouseleave="thumbnail = false" class=u-inline><span ng-if="files.environmentLocation === \'cloud\'"><img ng-if="files.menuData.filetype === \'text/stl\' && files.menuData.images[0]" class=smallImg ng-src="{{ files.imagesRootLocation + \'/\' + files.menuData.images[0] }}" alt=""> <img ng-if="files.menuData.filetype === \'text/gcode\'" class=smallImg ng-src=./public/assets/images/gcode_emptystate.png alt=""> <img ng-if="files.menuData.filetype === \'text/stl\' && !files.menuData.images[0]" class=smallImg ng-src=./public/assets/images/stl_emptystate.png alt=""> <i ng-if="files.menuData.filetype === \'folder\'" class="fa fa-folder-o"></i></span></div><div class="imageThumbnail delete" type=context ng-if="thumbnail && files.menuData.filetype === \'text/stl\' && files.menuData.images[0]" id="thumbnail-{{ $index }}"><div class=overlay-container><div class=body><img ng-src="{{ files.imagesRootLocation + \'/\' + files.menuData.images[0] }}" alt=""></div></div></div>{{files.menuData.prettyname | removeFiletype | removeDashes | title}}<div class=contains ng-if="files.menuData.filetype === \'folder\' && files.menuData.children != 1">contains {{ files.menuData.children }} items</div><div class=contains ng-if="files.menuData.filetype === \'folder\' && files.menuData.children == 1">contains 1 item</div></div></div><footer><div ng-if="files.menuData.filetype === \'folder\'" class="item u-textLeft" ng-click="files.deleteFolderContent = !files.deleteFolderContent"><span class=checkbox><i ng-if=!files.deleteFolderContent class="fa fa-square-o"></i><i ng-if=files.deleteFolderContent class="fa fa-check-square-o"></i></span>Delete folder\'s content</div><button class="btn btn--primary" ng-click="files.removeMultiple([files.menuData]); files.deleteListMenu = false; files.showMenuOverlay = false;">Confirm</button></footer></library-overlay><library-overlay id=menu ng-if="files.showGlobalMenuOverlay && files.environmentLocation === \'cloud\'" ng-style=files.positionGlobalMenu overlay-close=files.showGlobalMenuOverlay overlay-title=Create><div class=body><div class=item ng-click="files.createFolder(); files.showGlobalMenuOverlay = false;"><i class="fa fa-folder-open-o"></i>Create New Folder</div></div></library-overlay><library-overlay overlay-title="{{files.fileToMove.length > 0 ? \'Move to\' : \'Create\'}}" ng-if=files.folderListOverlay ng-class="{ \'overlaySidebarClosed\': $root.sidebarInvisible }"><div class=body><div class=item ng-click="files.createFolder(); files.folderListOverlay = false" ng-if="files.fileToMove.length == 0"><i class="fa fa-folder-open-o"></i>New Folder</div><div class=item ng-click=files.createFolder(files.fileToMove) ng-if="files.fileToMove.length > 0"><i class="fa fa-folder-open-o"></i>New Folder</div><div ng-if="files.currentFolder.id != files.folderPath[0].id && files.fileToMove.length > 0" class=item ng-click="files.addToFolder(files.fileToMove, files.folderPath[files.folderPath.length-2])"><i class="fa fa-external-link"></i>Parent Folder</div><div class="item u-textTruncate" ng-repeat="folder in files.currentFolder.children | filter: {filetype: \'folder\', id: \'!\' + files.fileToMove[0].id}" ng-click="files.addToFolder(files.fileToMove, folder)"><i class="fa fa-folder-o"></i>{{folder.prettyname | removeFiletype | removeDashes | title}}</div></div></library-overlay><library-overlay overlay-title="Sort by" ng-if=files.filesSortOverlay ng-class="{ \'overlaySidebarClosed\': $root.sidebarInvisible }"><div class=body><div class=item ng-click="files.setFilesSortBy(\'prettyname\'); files.getFiles(true);"><span class=checkbox><i ng-if="files.filesSortBy != \'prettyname\'" class="fa fa-square-o"></i><i ng-if="files.filesSortBy == \'prettyname\'" class="fa fa-check-square-o"></i></span>Name <span ng-if="files.filesSortBy == \'prettyname\'">- {{files.sortOrder === \'-\' ? \'Desc\' : \'Asc\'}}</span></div><div class=item ng-click="files.setFilesSortBy(\'filetype\'); files.getFiles(true);"><span class=checkbox><i ng-if="files.filesSortBy != \'filetype\'" class="fa fa-square-o"></i><i ng-if="files.filesSortBy == \'filetype\'" class="fa fa-check-square-o"></i></span>Type <span ng-if="files.filesSortBy == \'filetype\'">- {{files.sortOrder === \'-\' ? \'Desc\' : \'Asc\'}}</span></div><div class=item ng-click="files.setFilesSortBy(\'createdAt\'); files.getFiles(true);"><span class=checkbox><i ng-if="files.filesSortBy != \'createdAt\'" class="fa fa-square-o"></i><i ng-if="files.filesSortBy == \'createdAt\'" class="fa fa-check-square-o"></i></span>Created <span ng-if="files.filesSortBy == \'createdAt\'">- {{files.sortOrder === \'-\' ? \'Desc\' : \'Asc\'}}</span></div><div class=item ng-click="files.setFilesSortBy(\'filesize\'); files.getFiles(true);"><span class=checkbox><i ng-if="files.filesSortBy != \'filesize\'" class="fa fa-square-o"></i><i ng-if="files.filesSortBy == \'filesize\'" class="fa fa-check-square-o"></i></span>Size <span ng-if="files.filesSortBy == \'filesize\'">- {{files.sortOrder === \'-\' ? \'Desc\' : \'Asc\'}}</span></div></div></library-overlay><library-overlay ng-if=files.filesFilterOverlay ng-class="{ \'overlaySidebarClosed\': $root.sidebarInvisible }"><div class=top><div class=title><div class=fileSearch><i class="fa fa-search icon--selected"></i> <input ng-click=$event.stopPropagation() on-enter="files.filesFilterOverlay = false" ng-model=files.filesSearchValue ng-change=files.getFiles(true) placeholder="Filter Library..."></div></div></div><div class=body><div class=u-padding-bottom-1>Filter by type</div><div class=item ng-click="files.filesFilterBy = \'all\'; files.getFiles(true);"><span class=checkbox><i ng-if="files.filesFilterBy != \'all\'" class="fa fa-square-o"></i><i ng-if="files.filesFilterBy == \'all\'" class="fa fa-check-square-o"></i></span>All</div><div class=item ng-click="files.filesFilterBy = \'folder\'; files.getFiles(true);"><span class=checkbox><i ng-if="files.filesFilterBy != \'folder\'" class="fa fa-square-o"></i><i ng-if="files.filesFilterBy == \'folder\'" class="fa fa-check-square-o"></i></span>Folder</div><div class=item ng-click="files.filesFilterBy = \'text/stl\'; files.getFiles(true);"><span class=checkbox><i ng-if="files.filesFilterBy != \'stl\'" class="fa fa-square-o"></i><i ng-if="files.filesFilterBy == \'text/stl\'" class="fa fa-check-square-o"></i></span>STL</div><div class=item ng-click="files.filesFilterBy = \'text/gcode\'; files.getFiles(true);"><span class=checkbox><i ng-if="files.filesFilterBy != \'gcode\'" class="fa fa-square-o"></i><i ng-if="files.filesFilterBy == \'text/gcode\'" class="fa fa-check-square-o"></i></span>Gcode</div></div></library-overlay><library-overlay overlay-title=Delete ng-if=files.deleteOverlay ng-class="{ \'overlaySidebarClosed\': $root.sidebarInvisible }"><div class=body><div class="item-static u-textTruncate" ng-repeat="file in files.filesToDelete"><div ng-init="thumbnail = false" ng-mouseover="thumbnail = true" ng-mouseleave="thumbnail = false" class=u-inline><span ng-if="files.environmentLocation === \'cloud\'"><img ng-if="file.filetype === \'text/stl\' && file.images[0]" class=smallImg ng-src="{{ files.imagesRootLocation + \'/\' + file.images[0] }}" alt=""> <img ng-if="file.filetype === \'text/gcode\'" class=smallImg ng-src=./public/assets/images/gcode_emptystate.png alt=""> <img ng-if="file.filetype === \'text/stl\' && !file.images[0]" class=smallImg ng-src=./public/assets/images/stl_emptystate.png alt=""> <i ng-if="file.filetype === \'folder\'" class="fa fa-folder-o"></i></span></div><div class="imageThumbnail delete" type=context ng-if="thumbnail && file.filetype === \'text/stl\' && file.images[0]" id="thumbnail-{{ $index }}"><div class=overlay-container><div class=body><img ng-src="{{ files.imagesRootLocation + \'/\' + file.images[0] }}" alt=""></div></div></div>{{file.prettyname | removeFiletype | removeDashes | title}}<div class=contains ng-if="file.filetype === \'folder\' && file.children != 1">contains {{ file.children }} items</div><div class=contains ng-if="file.filetype === \'folder\' && file.children == 1">contains 1 item</div></div></div><footer><div ng-if=files.filesToDeleteFolder class="item u-textLeft" ng-click="files.deleteFolderContent = !files.deleteFolderContent"><span class=checkbox><i ng-if=!files.deleteFolderContent class="fa fa-square-o"></i><i ng-if=files.deleteFolderContent class="fa fa-check-square-o"></i></span>Delete folder\'s content</div><button class="btn btn--primary" ng-click="files.removeMultiple(files.filesToDelete); files.deleteOverlay = false;">Confirm</button></footer></library-overlay><div ng-if="files.dragbox && !files.filesViewList" id=dragbox class=xs-hide ng-style=files.dragboxStyle></div></article>');
$templateCache.put("formide-info/componentView.html",'<section class="logo logo--large"><svg version=1.1 baseprofile=full xmlns=http://www.w3.org/2000/svg viewbox="0 0 128 128" rel=logo><lineargradient id=strokeGradient gradientunits=userSpaceOnUse x1=64 y1=127.8776 x2=64 y2=0.1224><stop offset=0 style="stop-color:#2192D2"><stop offset=1 style="stop-color:#5FC6F3"></lineargradient><path style=fill:none;stroke:#46b1e6;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;shape-rendering:geometric-precision d="\n'+"\t   M102.202,59.171c0,0-8.327-11.914-17.334-24.799C74.244,19.174,62.67,2.622,62.67,2.622L33.505,25.107L17.716,91.418l20.031,33.867\n"+"\t   l46.678,0.092c0,0,9.292-9.086,16.739-16.37c4.965-4.856,9.12-8.922,9.12-8.922L102.202,59.171z M62.67,2.622l22.198,31.75\n"+"\t   L77.732,54.84l-23.434,5.772L62.67,2.622z M60.823,74.021l11.906,3.725L63.038,90.75l-9.523-9.059L60.823,74.021z M53.514,81.691\n"+"\t   l-14.556-3.105l15.34-17.974l6.525,13.409L53.514,81.691z M60.823,74.021l-6.525-13.409l23.434-5.772l8.818,30.911l-13.821-8.004\n"+"\t   c-0.092-0.057,0.123,0.039,0,0L60.823,74.021z M33.505,25.107L62.67,2.622l-8.372,57.99l-15.34,17.974L17.716,91.418L33.505,25.107z\n"+"\t\tM17.716,91.418l21.242-12.832l14.556,3.105l9.523,9.059l-1.86,18.547l-23.43,15.988L17.716,91.418z M37.747,125.285l23.43-15.988\n"+"\t   l23.248,16.08L37.747,125.285z M84.425,125.378l-23.248-16.08l1.86-18.547l9.691-13.004c0,0,7.225,4.184,13.821,8.004\n"+"\t   c5.524,3.199,10.61,6.146,10.61,6.146l4.005,17.11L84.425,125.378z M97.159,91.897L97.159,91.897l-10.61-6.146L77.732,54.84\n"+'\t   l7.136-20.469l17.334,24.799l8.082,40.922l-9.12,8.915L97.159,91.897z"></svg><h1>Formide</h1></section><section class=infoBox><i class="fa fa-info-circle"></i><p>To use the full suite of features available from the cloud, please visit: <a href=https://platform.formide.com><strong>https://platform.formide.com</strong></a></p><p>These features include:</p><ul><li>Monitor your printers from anywhere</li><li>Invite anyone to your 3D printer</li><li>Discover new models</li><li>Organize your projects</li></ul><p>Already have an account? Link the Element <a ng-click=modal.connectToCloud()><strong>here</strong></a></p></section>');$templateCache.put("gcode-download/componentView.html",'<section class=modal><i class="fa fa-info-circle"></i><p>You can stream this G-code directly to your 3D printer by using The Element.</p><p><a href="https://www.printr.com/product/the-element/" target=_blank>Click here to purchase The Element today!</a></p><p>Other key features include:</p><ul><li>Monitor your prints from anywhere</li><li>Queue models to be printed</li><li>Invite anyone to use your 3D printer</li></ul><p><a ng-click=modal.downloadGcode()>No thanks, I just want to download this G-code</a></p></section>');$templateCache.put("gcode-viewer/componentView.html",'<header class=header--sticky ng-class="{\'hide--aside\': modal.hideAside}"><a class="hide--aside-btn xs-hide" ng-click=modal.hideSettings()><img src=./public/assets/images/hamburger_collapse.svg alt=""></a><h3 style="line-height: 1">G-code Viewer</h3><section class="actions layout" ng-if="modal.filetype !== \'live\'"><div ng-if="modal.filetype !== \'text/gcode\'" class="layout__item u-1/2 u-margin-bottom-1"><button class="btn btn--tertiary" style="width:100%; min-width: 0" ng-disabled=modal.loadingModels ng-click=modal.downloadGcodeModal()>Download</button></div><div ng-if="modal.filetype !== \'text/gcode\'" class="layout__item u-1/2 u-margin-bottom-1"><button class="btn btn--tertiary" style="width:100%; min-width: 0" ng-disabled=modal.loadingModels ng-click=modal.newPrintjob()>Re-Slice</button></div><div class="layout__item u-1/1"><button class="btn btn--primary" style="width:100%; min-width: 0" ng-disabled=modal.loadingModels ng-click=modal.addToQueue()>Add to Queue</button></div></section></header><aside class=gcode-viewer-aside ng-class="{\'hide--aside\': modal.hideAside, \'liveGcode\': modal.filetype == \'live\'}"><article><fieldset><div class="layout u-margin-bottom-_5"><div class="layout__item u-fill"><h4 class=text-base-primary-color>Selected Printer</h4></div><div class="layout__item u-fit u-padding-left-0"><button ng-click=modal.choosePrinter() class="btn btn--secondary printer-btn">Change Printer</button></div></div><section class=u-margin-left-1><hgroup ng-if=modal.printer.$active.selected><h5>{{modal.printer.$active.name}} <span ng-class="{\'printing\':\'pill--success\', \'paused\':\'pill--warning\', \'online\':\'pill--success\', \'connecting\':\'pill--warning\', \'offline\': \'\'}[modal.printer.$active.status]" class=pill><abbr title="{{modal.printer.$active.name}} is currently {{modal.printer.$active.status}}">{{modal.printer.$active.status | title}}</abbr></span></h5><small ng-if="modal.printer.$active.bed.printerType != \'DELTA\'">Buildvolume: {{modal.printer.$active.bed.x}} x {{modal.printer.$active.bed.y}} x {{modal.printer.$active.bed.z}} <span ng-if=modal.printer.$active.bed.heated>(heated)</span></small> <small ng-if="modal.printer.$active.bed.printerType == \'DELTA\'">Buildvolume: {{modal.printer.$active.bed.diameter}} x {{modal.printer.$active.bed.z}} <span ng-if=modal.printer.$active.bed.heated>(heated)</span></small></hgroup><hgroup ng-if=!modal.printer.$active.selected><h5>No Printer Selected!</h5><small>Please select a printer to slice.</small></hgroup></section></fieldset><fieldset style="border-bottom: none"><h4 class=text-base-primary-color ng-if="modal.filetype !== \'text/gcode\'">Slice Details</h4><p ng-if="modal.filetype == \'text/gcode\'" class=noDetails>Slice details unavailable for custom G-codes</p><slice-details-list printjob=modal.printjob ng-if="modal.filetype !== \'text/gcode\' && !modal.loadingPrintjob"></slice-details-list><div class="fade u-textCenter" ng-if=modal.loadingPrintjob><p><i class="fa fa-3x fa-refresh fa-spin"></i></p></div></fieldset></article></aside><article class="modal-main gcode-viewer-main xs-hide" ng-class="{\'fullScreen\': modal.hideAside}"><a class=show--aside-btn ng-if="modal.hideAside && !modal.hideAsideToggle" ng-click=modal.showSettings()><img src=./public/assets/images/hamburger_expand.svg alt=""></a><div class="viewer-loading fade" ng-if=modal.loadingModels><h4><i class="fa fa-4x fa-refresh fa-spin"></i></h4><h6 class=loader>Loading Models <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6></div><formide-viewer app=modal.appFunction width=100% height=100% settings=modal.appSettings></formide-viewer></article>');$templateCache.put("manage-device-update/componentView.html",'<header><h5><a ng-click="manageDeviceUpdate.navigate(\'manage/device\')">Manage Device</a> / <span>Update</span></h5></header><h3>Local Element</h3><h4>Software update</h4><button class=btn ng-click=manageDeviceUpdate.doUpdate() ng-disabled="!manageDeviceUpdate.deviceUpdateNeeded.needsUpdate || manageDeviceUpdate.updating">Start Update Process</button> <span class=u-margin-left-1>{{ manageDeviceUpdate.deviceUpdateNeeded.message }}</span><section class="block u-margin-top-1" ng-class="{\'block--disabled\': !manageDeviceUpdate.updating}"><h5>Progress</h5><progress-bar ng-class="{\'progress--undefined\': manageDeviceUpdate.valuenow < 100}" valuenow={{manageDeviceUpdate.valuenow}} valuemax=100></progress-bar><br><div ng-if="manageDeviceUpdate.updating && !manageDeviceUpdate.updated"><i class="fa fa-refresh fa-spin"></i> Updating, the device will come back online once updated.</div><div ng-if="manageDeviceUpdate.updating && manageDeviceUpdate.updated"><i class="fa fa-check-circle"></i> {{ manageDeviceUpdate.deviceUpdateStatus.message }}!</div></section>');$templateCache.put("manage-device/componentView.html",'<header class=layout><div class="layout__item u-1/2"><h3>Manage Device</h3></div><div class="u-textRight layout__item u-1/2"><a ng-click="manageDevice.navigate(\'/manage/device/update\')" class="btn btn--tertiary">Update Device</a></div></header><h4>Storage</h4><article class=block><progress-bar valuenow="{{manageDevice.diskspace.total - manageDevice.diskspace.free}}" valuemax={{manageDevice.diskspace.total}}></progress-bar><p class=u-margin-bottom-0>{{(manageDevice.diskspace.total - manageDevice.diskspace.free) | smartbytes:1}} used of {{manageDevice.diskspace.total | smartbytes:1}} &mdash; <a ng-click="manageDevice.navigate(\'/files\')">You can free up storage by removing files from the Library</a></p></article><br><header><hgroup><h4>Wi-Fi</h4></hgroup></header><h5>Currently connected to {{manageDevice.network.ssid}}</h5><article class=block><form role=form><fieldset><ul class=form-fields><li><label for="">SSID</label><select class=text-input ng-options="ssid.ssid as ssid.ssid for ssid in manageDevice.ssids" ng-model=manageDevice.wifi.ssid><option value="" disabled selected style="display: none">Select a SSID</option></select></li><li><label for="">Password</label><input type=password class=text-input ng-model=manageDevice.wifi.password placeholder=Password></li></ul></fieldset><div class=layout><div class="layout__item u-1/2"><a class="btn btn--primary" ng-click=manageDevice.connectWifi()>Connect</a></div><div class="u-textRight layout__item u-1/2"><a class="btn btn--secondary" ng-click=manageDevice.resetWifi()>Reset Wi-Fi Connection</a></div></div></form></article><br><header class=layout><hgroup class="layout__item u-1/2"><h4>Users</h4></hgroup><div class="u-textRight layout__item u-1/2"><a class="btn btn--tertiary" ng-click=manageDevice.createModal()>Add user</a></div></header><article class=block><table class="table--formide table--formide--responsive"><thead><tr><th>Email</th><th>Admin</th><th>Owner</th><th></th></tr></thead><tbody><tr ng-repeat="user in manageDevice.users" class=table__item><td data-th=Email>{{user.email}}</td><td data-th=Admin>{{user.isAdmin ? \'yes\' : \'no\'}}</td><td data-th=Owner>{{user.isOwner ? \'yes\' : \'no\'}}</td><td class="table__item__controls u-textRight"><a class="btn btn--small btn--tertiary" ng-click=manageDevice.updateModal(user)><i class="fa fa-pencil"></i></a> <a class="btn btn--small btn--alert" ng-click=manageDevice.deleteUser(user)><i class="fa fa-trash-o"></i></a></td></tr></tbody></table></article><script type=text/ng-template id=inviteModal><form role="form">\n'+"\t\t <fieldset>\n"+'            <ul class="form-fields">\n'+"                <li>\n"+'                \t<label for="">Email</label>\n'+'                    <input type="text" class="text-input" ng-model="modal.user.email" placeholder="Email">\n'+"                </li>\n"+"\n"+"                <p>You can edit the password and permissions of an invited user after the invitation is sent.</p>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <hr class="rule">\n'+"\n"+'        <a class="btn btn--primary" ng-click="modal.submitInvite(modal.user); closeThisDialog()">Invite</a>\n'+'\t\t<a class="btn btn--secondary" ng-click="closeThisDialog()">Cancel</a>\n'+'\t</form></script><script type=text/ng-template id=settingsModal><form role="form">\n'+"\t\t <fieldset>\n"+'            <ul class="form-fields">\n'+"                <li>\n"+'                \t<label for="">Email</label>\n'+'                    <input type="text" class="text-input" ng-model="modal.user.email" placeholder="Email">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for="">Password</label>\n'+'                    <input type="password" class="text-input" ng-model="modal.user.password" placeholder="Password">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for=""><input ng-disabled="modal.user.isOwner" type="checkbox" ng-model="modal.user.isAdmin" ng-true-value="true" ng-false-value="false"> Admin</label>\n'+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <hr class="rule">\n'+"\n"+'        <a class="btn btn--primary" ng-click="modal.submitForm(modal.user); closeThisDialog()">Save</a>\n'+'\t\t<a class="btn btn--secondary" ng-click="closeThisDialog()">Cancel</a>\n'+"\t</form></script>");$templateCache.put("manage-devices-info/componentView.html",'<header><h5><a ng-click="manageDevicesInfo.navigate(\'/manage/devices\')">Manage Devices</a> / <span>{{ manageDevicesInfo.device.name }}</span></h5></header><device-list-item device=manageDevicesInfo.device class=block-selection edit=true></device-list-item><section class=layout><sub-section class="layout__item u-2/3-sm u-1/1"><p><a ng-click="manageDevicesInfo.navigate(\'manage/devices/\'+manageDevicesInfo.device.id+\'/update\')" class="btn btn--small btn--secondary"><i class="fa fa-refresh"></i> Update Device</a> <a ng-click="manageDevicesInfo.navigate(\'manage/devices/\'+manageDevicesInfo.device.id+\'/sessions\')" class="btn btn--small btn--secondary"><i class="fa fa-bolt"></i> Show device sessions</a> <button ng-click=manageDevicesInfo.goToLocalInterface() class="btn btn--small btn--tertiary"><i class="fa fa-cloud"></i> Local Interface</button></p></sub-section><sub-section class="layout__item u-1/1"><p ng-if="manageDevicesInfo.device.status == \'online\'"><small><strong>MAC address</strong> {{ manageDevicesInfo.device.macAddress }} &emsp; <strong>External IP</strong> {{ manageDevicesInfo.device.session.ip }} &emsp; <strong>Internal IP</strong> {{ manageDevicesInfo.device.session.ip_internal }} &emsp; <strong>Port</strong> {{ manageDevicesInfo.device.session.port }}</small></p><p ng-if="manageDevicesInfo.device.status == \'offline\'"><small><strong>MAC address</strong> {{ manageDevicesInfo.device.macAddress }}</small></p></sub-section></section><hr class="rule"><h4>Users</h4><article class=block><h5 ng-if=manageDevicesInfo.device.isAdmin>Invite New Users</h5><form role=form ng-if=manageDevicesInfo.device.isAdmin><fieldset class=u-margin-bottom><ul class=form-fields><li><textarea class=text-input ng-model=manageDevicesInfo.inviteEmail rows=3 placeholder="One email address per line">\n'+'\t\t\t\t</textarea></li></ul></fieldset><a class="btn btn--tertiary" ng-click=manageDevicesInfo.sendInvitations(manageDevicesInfo.inviteEmail)>Send Invitations</a><br><br></form><table class="table--formide table--formide--responsive"><thead><tr><th class=xs-hide></th><th>Username</th><th>Device</th><th>Admin</th><th>Owner</th><th></th></tr></thead><tbody><tr ng-repeat="user in manageDevicesInfo.deviceUsers"><td class=xs-hide><avatar-img size=32 src="manageDevicesInfo.imagesRootLocation + \'/\' + user.user.avatar" title=user.user.username circle=true></avatar-img></td><td data-th=Username ng-if=user.user><abbr title={{user.user.username}}>{{user.user.username}}</abbr></td><td data-th=Username ng-if=!user.user><abbr title="This user still has to active his account.">Pending</abbr></td><td data-th=Device>{{user.name}}</td><td data-th=Admin><input type=checkbox ng-disabled="user.isOwner || !(manageDevicesInfo.device.isAdmin || manageDevicesInfo.device.isOwner)" ng-change=manageDevicesInfo.permissionChanged(user) ng-model=user.isAdmin ng-true-value=true ng-false-value=false></td><td data-th=Owner><input type=checkbox ng-disabled=true ng-model=user.isOwner ng-true-value=true ng-false-value=false></td><td data-th="Remove User"><a ng-if="!user.isOwner && (manageDevicesInfo.device.isAdmin || manageDevicesInfo.device.isOwner) && user.user.id != manageDevicesInfo.me.id" ng-click=manageDevicesInfo.removedeviceUser(user)><i class="text-base-red fa fa-times"></i></a></td></tr></tbody></table></article><article class=block ng-if="!(manageDevicesInfo.device.isAdmin || manageDevicesInfo.device.isOwner)"><p>You are not an admin for this device, therefore you can not access the user settings.</p></article><br><h4 class=text-base-red>Danger Zone</h4><article class=block ng-if=manageDevicesInfo.device.isOwner><h5>Revoke Ownership</h5><p><small>If you revoke ownership from this device it not only removes you but also any other users connected to this device. This also will reset the device\'s Wi-Fi.</small></p><p><button ng-click=manageDevicesInfo.revokeOwnership() class="btn btn--alert">Revoke Ownership</button></p></article><article class=block ng-if=!manageDevicesInfo.device.isOwner><h5>Revoke Access</h5><p><small>If you revoke access of this device you will not be able to use it anymore. Other users will stay connected to this device.</small></p><p><a ng-click=manageDevicesInfo.removedeviceUser() class="btn btn--alert">Revoke Access</a></p></article><script type=text/ng-template id=localInterfaceModal><section class="logo logo--large">\n'+'\t\t<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" rel="logo">\n'+'\t\t<linearGradient id="strokeGradient" gradientUnits="userSpaceOnUse" x1="64" y1="127.8776" x2="64" y2="0.1224">\n'+'\t\t   <stop  offset="0" style="stop-color:#2192D2"/>\n'+'\t\t   <stop  offset="1" style="stop-color:#5FC6F3"/>\n'+"\t\t</linearGradient>\n"+"\n"+'\t\t<path style="fill:none;stroke:#46b1e6;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;shape-rendering:geometric-precision;" d="\n'+"\t\t   M102.202,59.171c0,0-8.327-11.914-17.334-24.799C74.244,19.174,62.67,2.622,62.67,2.622L33.505,25.107L17.716,91.418l20.031,33.867\n"+"\t\t   l46.678,0.092c0,0,9.292-9.086,16.739-16.37c4.965-4.856,9.12-8.922,9.12-8.922L102.202,59.171z M62.67,2.622l22.198,31.75\n"+"\t\t   L77.732,54.84l-23.434,5.772L62.67,2.622z M60.823,74.021l11.906,3.725L63.038,90.75l-9.523-9.059L60.823,74.021z M53.514,81.691\n"+"\t\t   l-14.556-3.105l15.34-17.974l6.525,13.409L53.514,81.691z M60.823,74.021l-6.525-13.409l23.434-5.772l8.818,30.911l-13.821-8.004\n"+"\t\t   c-0.092-0.057,0.123,0.039,0,0L60.823,74.021z M33.505,25.107L62.67,2.622l-8.372,57.99l-15.34,17.974L17.716,91.418L33.505,25.107z\n"+"\t\t\tM17.716,91.418l21.242-12.832l14.556,3.105l9.523,9.059l-1.86,18.547l-23.43,15.988L17.716,91.418z M37.747,125.285l23.43-15.988\n"+"\t\t   l23.248,16.08L37.747,125.285z M84.425,125.378l-23.248-16.08l1.86-18.547l9.691-13.004c0,0,7.225,4.184,13.821,8.004\n"+"\t\t   c5.524,3.199,10.61,6.146,10.61,6.146l4.005,17.11L84.425,125.378z M97.159,91.897L97.159,91.897l-10.61-6.146L77.732,54.84\n"+'\t\t   l7.136-20.469l17.334,24.799l8.082,40.922l-9.12,8.915L97.159,91.897z"/>\n'+"\t\t</svg>\n"+'\t\t<h1 class="localLogo">The Element</h1>\n'+"\t</section>\n"+"\n"+'\t<section class="infoBox">\n'+'\t\t<i class="fa fa-info-circle"></i>\n'+"\t\t<p>\n"+"\t\t\tIt's possible to use The Element in an offline mode by connecting directly to it's IP address. Very convenient for when there's no Internet available. Note, however, that there is reduced functionality when connected to the Element locally.\n"+"\t\t</p>\n"+"\t\t<p>\n"+"\t\t\tTo connect to the local interface of the Element, first ensure that you are on the same network as the device then click connect.\n"+"\t\t</p>\n"+"\n"+'\t\t<div class="u-textCenter">\n'+'\t\t\t<button ng-click="modal.connectToLocal()" class="btn btn--tertiary" ng-disabled="modal.connectingLocal">Connect <i ng-if="modal.connectingLocal" class="fa fa-refresh fa-spin"></i></button>\n'+"\t\t</div>\n"+"\n"+'\t\t<p ng-if="modal.connectingError" class="text-base-alert-color u-margin-top-2">\n'+"\t\t\tError connecting. Ensure that your device is online and you are connected to the same network.\n"+"\t\t</p>\n"+"\t</section></script>");$templateCache.put("manage-devices-sessions/componentView.html",'<header><h5><a ng-click="manageDevicesSessions.navigate(\'/manage/devices\')">Manage Devices</a> / <a ng-click="manageDevicesSessions.navigate(\'manage/devices/\'+manageDevicesSessions.device.id)">{{ manageDevicesSessions.device.name }}</a> / <span>Sessions</span></h5></header><device-list-item device=manageDevicesSessions.device class=block-selection></device-list-item><h4>Recent sessions</h4><section class=block><table class=table--formide><tr><th>Started</th><th>Location</th><th>IP</th><th>IP (internal)</th></tr><tr ng-repeat="session in manageDevicesSessions.sessions"><td>{{ session.createdAt | timeAgo }}</td><td>{{ session.sessionData.geo.city }}</td><td>{{ session.sessionData.ip }}</td><td>{{ session.sessionData.ip_internal }}</td></tr></table></section>');$templateCache.put("manage-devices-setup/componentView.html","<header><h3>Finish setup</h3></header>");$templateCache.put("manage-devices-update/componentView.html",'<header><h5><a ng-click="manageDevicesUpdate.navigate(\'/manage/devices\')">Manage Devices</a> / <a ng-click="manageDevicesUpdate.navigate(\'manage/devices/\'+manageDevicesUpdate.device.id)">{{ manageDevicesUpdate.device.name }}</a> / <span>Update</span></h5></header><device-list-item device=manageDevicesUpdate.device class=block-selection></device-list-item><h4>Software update</h4><div class="layout layout--withoutGutter"><div class="layout-item u-fit update-btn-container"><button class=btn ng-click=manageDevicesUpdate.doUpdate() ng-disabled="manageDevicesUpdate.loadingPrinters || !manageDevicesUpdate.deviceUpdateNeeded.needsUpdate || manageDevicesUpdate.updating">Start Update Process</button></div><div class="layout-item u-fill-sm" ng-if="!manageDevicesUpdate.deviceUpdateNeeded.message && manageDevicesUpdate.device.status == \'online\'"><i class="fa fa-refresh fa-spin text-base-primary-color" style="font-size: 2rem"></i></div><div class="layout-item u-fill-sm" ng-if="manageDevicesUpdate.deviceUpdateNeeded.message && !manageDevicesUpdate.deviceBusy">{{ manageDevicesUpdate.deviceUpdateNeeded.message }} <span ng-if=manageDevicesUpdate.deviceUpdateNeeded.version>( v{{manageDevicesUpdate.deviceUpdateNeeded.version}} )</span> <span ng-if=manageDevicesUpdate.deviceUpdateNeeded.releaseNotesURL>- <a target=_blank href={{manageDevicesUpdate.deviceUpdateNeeded.releaseNotesURL}}>See what\'s new</a></span></div><div class="layout-item u-fill-sm" ng-if=manageDevicesUpdate.deviceBusy>Device in use, please finish any prints before updating.</div></div><section class="block u-margin-top-1" ng-if=manageDevicesUpdate.updating><h5>Progress</h5><progress-bar ng-class="{\'progress--undefined\': manageDevicesUpdate.valuenow < 100}" valuenow={{manageDevicesUpdate.valuenow}} valuemax=100></progress-bar><br><div ng-if="manageDevicesUpdate.updating && !manageDevicesUpdate.updated"><i class="fa fa-refresh fa-spin"></i> Updating, the device will come back online once updated.</div><div ng-if="manageDevicesUpdate.updating && manageDevicesUpdate.updated"><i class="fa fa-check text-base-green"></i> {{ manageDevicesUpdate.deviceUpdateStatus.message }}!</div></section><section class="block u-margin-top-1" ng-if=manageDevicesUpdate.deviceUpdateStatus.timestamp><h5 class=u-margin-bottom-1>Previous Update</h5><table class=previous-update><tbody><tr><td>Timestamp</td><td>{{manageDevicesUpdate.deviceUpdateStatus.timestamp}}</td></tr><tr><td>Response</td><td>{{manageDevicesUpdate.deviceUpdateStatus.message}}</td></tr></tbody></table></section><script type=text/ng-template id=updating><section class="updatingInfo">\n'+'\t\t<figure class="onboarding-figure">\n'+'\t\t\t<img class="main-image" src="public/assets/images/setup/setup_element.png" width="280" height="280" alt="Printer">\n'+"\t\t</figure>\n"+"\t</section>\n"+"\n"+'\t<section class="infoBox">\n'+'\t\t<i class="fa fa-info-circle"></i>\n'+"\t\t<p>For the best connectivity, ensure that the Element is standing upright</p>\n"+'\t\t<div class="u-textCenter">\n'+'\t\t\t<button ng-click="modal.close()" class="btn btn--tertiary">Close</button>\n'+"\t\t</div>\n"+"\t</section></script>");$templateCache.put("manage-devices/componentView.html",'<article><header class=layout><div class="layout__item u-1/2"><h3>Manage Devices</h3></div><div class="u-textRight layout__item u-1/2"><p><a ng-click="$root.onboarding(\'setupChooseDevice\');" class="btn btn--tertiary">Set up a New Device</a></p><p></p></div></header><section ng-if="manageDevices.devices.length > 0"><ul device-list><li device-list-item ng-repeat="device in devices = (manageDevices.devices | filter: manageDevices.deviceFilter | orderBy: manageDevices.deviceSortFunction)" device=device class=block-selection></li></ul></section><section class=animate-show ng-show="manageDevices.devices.length < 1 && manageDevices.invite" id=invite><div class="layout layout--alignCenter"><div class="icon layout__item u-fit"><img src=public/assets/images/the_element_grey.png alt="Set me up!"></div><div class="layout__item u-3/5 u-1/2-sm"><h2>Set up a New Device</h2><p>Click the button <a ng-click="$root.onboarding(\'setupChooseDevice\')">\'Set up a New Device\'</a> to get started with your device</p></div></div></section></article>');$templateCache.put("manage-materials/componentView.html",'<article><header class=layout><div class="layout__item u-1/2"><h3>Manage Materials</h3></div><div class="u-textRight layout__item u-1/2"><a class="btn btn--tertiary" ng-click=manageMaterials.createModal()>Add a New Material</a></div></header><section class=block ng-if="manageMaterials.materials.length > 0"><table class="table--formide table--formide--responsive"><thead><tr><th ng-if="manageMaterials.environmentLocation == \'cloud\'"><a ng-click="manageMaterials.setSortBy(\'name\')">Name <i ng-if="manageMaterials.sort != \'name\'" class="fa fa-sort"></i> <i ng-if="manageMaterials.sort == \'name\' && manageMaterials.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="manageMaterials.sort == \'name\' && manageMaterials.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="manageMaterials.environmentLocation == \'cloud\'"><a ng-click="manageMaterials.setSortBy(\'createdAt\')">Added <i ng-if="manageMaterials.sort != \'createdAt\'" class="fa fa-sort"></i> <i ng-if="manageMaterials.sort == \'createdAt\' && manageMaterials.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="manageMaterials.sort == \'createdAt\' && manageMaterials.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="manageMaterials.environmentLocation == \'cloud\'"><a ng-click="manageMaterials.setSortBy(\'type\')">Type <i ng-if="manageMaterials.sort != \'type\'" class="fa fa-sort"></i> <i ng-if="manageMaterials.sort == \'type\' && manageMaterials.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="manageMaterials.sort == \'type\' && manageMaterials.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="manageMaterials.environmentLocation == \'local\'">Name</th><th ng-if="manageMaterials.environmentLocation == \'local\'">Added</th><th ng-if="manageMaterials.environmentLocation == \'local\'">Type</th><th>Ext Temp</th><th>Bed Temp</th><th></th></tr></thead><tbody><tr ng-repeat="material in manageMaterials.materials | orderBy : manageMaterials.sortOrder + manageMaterials.sort" ng-class="{selected: material.id === activeMaterial.id}"><td data-th=Name class=name>{{ material.name }}</td><td data-th=Added>{{material.createdAt | timeAgo}}</td><td data-th=Type>{{ material.type }}</td><td data-th="Ext Temp">{{ material.temperature }} &deg;C</td><td data-th="Bed Temp">{{ material.bedTemperature }} &deg;C</td><td class="table__item__controls u-textRight"><a ng-if=!material.preset class="btn btn--small btn--tertiary" ng-click=manageMaterials.updateModal(material)><i class="fa fa-pencil"></i></a> <a ng-if=!material.preset class="btn btn--small btn--alert" ng-click=manageMaterials.deleteMaterial(material)><i class="fa fa-trash-o"></i></a></td></tr></tbody></table></section><div ng-if=!manageMaterials.$resolved class="u-textCenter u-margin-top-1 u-margin-bottom-1"><i class="fa fa-refresh fa-spin fa-3x text-base-primary-color"></i></div><section class=animate-show ng-show="manageMaterials.materials.length == 0 && manageMaterials.$resolved" id=invite><div class="layout layout--alignCenter"><div class="icon u-fit"><i class="fa fa-circle-o-notch"></i></div><div class="layout__item u-3/5 u-1/2-sm"><h2>Add a New Material</h2><p>Click the button <a ng-click=manageMaterials.createModal()>\'Add a New Material\'</a> to get started with setting up a material</p></div></div></section></article><script type=text/ng-template id=settingsModal><form role="form" name="material">\n'+'        <fieldset ng-if="modal.environmentLocation === \'cloud\' || modal.presets.length > 0" class="u-margin-bottom-1">\n'+'            <ul class="form-fields">\n'+"                <li>\n"+'                    <label for="">Select a material from one of the presets</label>\n'+"\n"+"                    <ui-select\n"+'                        ng-model="modal.preset"\n'+'                        ng-change="modal.presetChanged()"\n'+'                        ng-init="presets = modal.initPresets()"\n'+'                        theme="select2"\n'+'                        style="width: 100%">\n'+'                        <ui-select-match placeholder="Select a printer, start typing to search presets...">{{$select.selected.name}}</ui-select-match>\n'+"                        <ui-select-choices\n"+'                            refresh="modal.getPresets($select.search)"\n'+'                            refresh-delay="500"\n'+'                            repeat="item in modal.presets">\n'+'                            <div class="layout">\n'+'                                <div class="layout__item u-1/2">\n'+'                                    <span ng-bind-html="::item.name | highlight: $select.search"></span>\n'+"                                </div>\n"+'\t\t\t\t\t\t\t\t<div class="layout__item u-1/2 u-textRight">\n'+'                                    <span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if="item.preset"></span>\n'+"                                </div>\n"+"                            </div>\n"+"\n"+"\n"+"                        </ui-select-choices>\n"+"                    </ui-select>\n"+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+"        <h4>Custom Material</h4>\n"+"        <fieldset>\n"+'            <ul class="form-fields materialSettings">\n'+"                <li>\n"+'                    <label for="">Material Name</label>\n'+'                    <input type="text" class="text-input" ng-model="modal.material.name" placeholder="Material Name">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for="">Material Type</label>\n'+'                    <input type="text" class="text-input" ng-model="modal.material.type" placeholder="Material Type">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for="">Extruder Temperature</label>\n'+'\t\t\t\t\t<range-slider min="25" max="450" step="1" ng-model="modal.material.temperature" value="{slider:modal.material.temperature}" input-field="true" pretty-min="25&deg;C" pretty-max=450&deg;C></range-slider>\n'+"                </li>\n"+"\n"+"                <li>\n"+'\t\t\t\t\t<label for="">First Layers Temperature</label>\n'+'\t\t\t\t\t<range-slider min="25" max="450" step="1" ng-model="modal.material.firstLayersTemperature" value="{slider:modal.material.firstLayersTemperature}" input-field="true" pretty-min="25&deg;C" pretty-max=450&deg;C></range-slider>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="">Bed Temperature</label>\n'+'\t\t\t\t\t<range-slider min="25" max="150" step="1" ng-model="modal.material.bedTemperature" value="{slider:modal.material.bedTemperature}" input-field="true" pretty-min="25&deg;C" pretty-max=150&deg;C></range-slider>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="">First Layers Bed Temperature</label>\n'+'\t\t\t\t\t<range-slider min="25" max="150" step="1" ng-model="modal.material.firstLayersBedTemperature" value="{slider:modal.material.firstLayersBedTemperature}" input-field="true" pretty-min="25&deg;C" pretty-max=150&deg;C></range-slider>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="">Feed Rate</label>\n'+'\t\t\t\t\t<range-slider min="1" max="500" step="1" ng-model="modal.material.feedRate" value="{slider:modal.material.feedRate}" input-field="true" pretty-min="1%" pretty-max=500%></range-slider>\n'+"                </li>\n"+"\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <hr class="rule">\n'+'\t\t<div class="submit-btn-group">\n'+'\t        <button class="btn btn--primary" ng-disabled="material.$invalid" ng-click="modal.submitForm(modal.material) && closeThisDialog()">Save</button>\n'+'\t\t\t<button class="btn btn--secondary" ng-click="closeThisDialog()">Cancel</button>\n'+"\t\t</div>\n"+"\t</form></script>");
$templateCache.put("manage-printers/componentView.html",'<article><header class=layout><div class="layout__item u-1/2"><h3>Manage Printers</h3></div><div class="u-textRight layout__item u-1/2"><a class="btn btn--tertiary" ng-click=managePrinters.printerSetupDialog()>Add a New 3D Printer</a></div></header><section class=block ng-if="(managePrinters.printer.length > 0 && managePrinters.environmentLocation == \'cloud\') || ((managePrinters.printer | filter: {preset: false}).length > 0 && managePrinters.environmentLocation == \'local\')"><table ng-if="managePrinters.environmentLocation == \'cloud\'" class="table--formide table--formide--responsive table--printers"><thead><tr><th><a ng-click="managePrinters.setSortBy(\'name\')">Name <i ng-if="managePrinters.sort != \'name\'" class="fa fa-sort"></i> <i ng-if="managePrinters.sort == \'name\' && managePrinters.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="managePrinters.sort == \'name\' && managePrinters.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th><a ng-click="managePrinters.setSortBy(\'createdAt\')">Added <i ng-if="managePrinters.sort != \'createdAt\'" class="fa fa-sort"></i> <i ng-if="managePrinters.sort == \'createdAt\' && managePrinters.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="managePrinters.sort == \'createdAt\' && managePrinters.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th><a ng-click="managePrinters.setSortBy(\'device\')">Device <i ng-if="managePrinters.sort != \'device\'" class="fa fa-sort"></i> <i ng-if="managePrinters.sort == \'device\' && managePrinters.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="managePrinters.sort == \'device\' && managePrinters.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th>Build Volume</th><th>Heated</th><th></th></tr></thead><thead ng-if="printers.length > 0 && (editPrinters.length > 0 || otherPrinters.length > 0)"><tr><th colspan=6>Your printers</th></tr></thead><tbody><tr ng-repeat="printer in printers = (managePrinters.printer | filter: {createdBy: managePrinters.user.id} | orderBy : managePrinters.sortOrder + managePrinters.sort)" class=table__item><td data-th=Name class=name>{{ printer.name }}</td><td data-th=Added>{{printer.createdAt | timeAgo}}</td><td data-th=Device>{{ (printer.deviceName)? printer.deviceName : \'-\' }}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType != \'DELTA\'">{{ printer.bed.x }} x {{ printer.bed.y }} x {{ printer.bed.z }}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType == \'DELTA\'">{{ printer.bed.diameter }} x {{ printer.bed.z }} (Delta)</td><td data-th="Heated bed" class=heated><i class="fa fa-fire text-base-orange" ng-if=printer.bed.heated></i></td><td class="table__item__controls u-textRight"><a ng-if=!printer.preset class="btn btn--small btn--tertiary" ng-click=managePrinters.updateModal(printer)><i class="fa fa-pencil"></i></a> <a ng-if=!printer.preset class="btn btn--small btn--alert" ng-click=managePrinters.deletePrinter(printer)><i class="fa fa-trash-o"></i></a></td></tr></tbody><thead ng-if="editPrinters.length > 0 && (printers.length > 0 || otherPrinters.length > 0)"><tr><th colspan=6>Printers you can edit</th></tr></thead><tbody><tr ng-repeat="printer in editPrinters = (managePrinters.printer | filter: {device: {isAdmin: true}, createdBy: \'!\'+managePrinters.user.id} | orderBy : managePrinters.sortOrder + managePrinters.sort)" class=table__item><td data-th=Name class=name>{{ printer.name }}</td><td data-th=Added>{{printer.createdAt | timeAgo}}</td><td data-th=Device>{{ (printer.deviceName)? printer.deviceName : \'-\' }}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType != \'DELTA\'">{{ printer.bed.x }} x {{ printer.bed.y }} x {{ printer.bed.z }}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType == \'DELTA\'">{{ printer.bed.diameter }} x {{ printer.bed.z }} (Delta)</td><td data-th="Heated bed" class=heated><i class="fa fa-fire text-base-orange" ng-if=printer.bed.heated></i></td><td class="table__item__controls u-textRight"><a ng-if=!printer.preset class="btn btn--small btn--tertiary" ng-click=managePrinters.updateModal(printer)><i class="fa fa-pencil"></i></a> <a ng-if=!printer.preset class="btn btn--small btn--alert" ng-click=managePrinters.deletePrinter(printer)><i class="fa fa-trash-o"></i></a></td></tr></tbody><thead ng-if="otherPrinters.length > 0 && (editPrinters.length > 0 || printers.length > 0)"><tr><th colspan=6>Other Printers</th></tr></thead><tbody><tr ng-repeat="printer in otherPrinters = (managePrinters.printer | filter: {device: {isAdmin: false}, createdBy: \'!\'+managePrinters.user.id} | orderBy : managePrinters.sortOrder + managePrinters.sort)" class=table__item><td data-th=Name class=name>{{ printer.name }}</td><td data-th=Added>{{printer.createdAt | timeAgo}}</td><td data-th=Device>{{ printer.deviceName }}</td><td data-th="Bed Volume">{{ printer.bed.x }}x{{ printer.bed.y }}x{{ printer.bed.z }}</td><td data-th="Heated bed" class=heated><i class="fa fa-fire text-base-orange" ng-if=printer.bed.heated></i></td><td class="table__item__controls u-textRight"></td></tr></tbody></table><table ng-if="managePrinters.environmentLocation == \'local\'" class="table--formide table--formide--responsive"><thead><tr><th>Name</th><th>Added</th><th>Build Volume</th><th>Heated</th><th></th></tr></thead><tbody><tr ng-repeat="printer in printers = (managePrinters.printer | filter: {preset: false})" class=table__item><td data-th=Name class=name>{{ printer.name }}</td><td data-th=Added>{{printer.createdAt | timeAgo}}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType != \'DELTA\'">{{ printer.bed.x }} x {{ printer.bed.y }} x {{ printer.bed.z }}</td><td data-th="Bed Volume" ng-if="printer.bed.printerType == \'DELTA\'">{{ printer.bed.diameter }} x {{ printer.bed.z }} (Delta)</td><td data-th="Heated bed" class=heated><i class="fa fa-fire text-base-orange" ng-if=printer.bed.heated></i></td><td class="table__item__controls u-textRight"><a ng-if=!printer.preset class="btn btn--small btn--tertiary" ng-click=managePrinters.updateModal(printer)><i class="fa fa-pencil"></i></a> <a ng-if=!printer.preset class="btn btn--small btn--alert" ng-click=managePrinters.deletePrinter(printer)><i class="fa fa-trash-o"></i></a></td></tr></tbody></table></section><div ng-if=!managePrinters.$resolved class="u-textCenter u-margin-top-1 u-margin-bottom-1"><i class="fa fa-refresh fa-spin fa-3x text-base-primary-color"></i></div><section class=animate-show ng-show="(managePrinters.printer.length == 0 || (managePrinters.printer | filter: {preset: false}).length == 0 && managePrinters.environmentLocation == \'local\') && managePrinters.$resolved" id=invite><div class="layout layout--alignCenter"><div class="icon layout__item u-fit"><img src=public/assets/images/printer_grey.png alt="Set me up!"></div><div class="layout__item u-3/5 u-1/2-sm"><h2>Add a New Printer</h2><p>Click the button <a ng-click=app.printerSetupDialog()>\'Add a New 3D Printer\'</a> to get started with your printer</p></div></div></section></article><script type=text/ng-template id=settingsModal><form role="form">\n'+"\t\t <fieldset>\n"+'            <ul class="form-fields">\n'+"                <li>\n"+'                \t<label for="">Printer Name</label>\n'+'                    <input type="text" class="text-input" ng-model="modal.printer.name" placeholder="Printer Name">\n'+"                </li>\n"+"\n"+"                <li ng-show=\"modal.environmentLocation == 'cloud'\">\n"+'                \t<label for="">Device</label>\n'+'                    <a ng-if="modal.devices.length < 1" ng-click="$root.onboarding(\'setupChooseDevice\');" class="btn btn--tertiary">Setup a New Device</a>\n'+'                    <select ng-if="modal.devices.length > 0" ng-options="device.id as device.name for device in modal.devices" ng-model="modal.printer.device.id" ng-change="modal.getAvailablePorts()" class="text-input"></select>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for="">USB port</label>\n'+"\n"+'\t\t\t\t\t<div class="layout">\n'+'\t\t\t\t\t\t<div class="layout__item u-fill">\n'+'\t\t                    <select ng-model="modal.printer.port" class="text-input">\n'+'\t\t                        <option ng-repeat="port in modal.ports" value="{{ port.port }}" ng-selected="modal.printer.port === port.port">{{ port.port }} ({{ port.status }})</option>\n'+"\t\t                    </select>\n"+"\t\t\t\t\t\t</div>\n"+'\t\t\t\t\t\t<div class="layout__item u-fit">\n'+'\t\t                    <a ng-click="modal.getAvailablePorts()" title="Refresh list">\n'+'\t\t\t\t\t\t\t\t<i class="fa fa-refresh" ng-class="{ \'fa-spin\': modal.refreshingPorts === true }"></i>\n'+"\t\t\t\t\t\t\t</a>\n"+"\t\t\t\t\t\t</div>\n"+"                </li>\n"+"\n"+"                <li ng-init=\"(!modal.printer.bed.printerType) ? modal.printer.bed.printerType = 'CARTESIAN' : ''\">\n"+'                    <label for="">Printer type</label>\n'+'                    <select ng-model="modal.printer.bed.printerType" class="text-input">\n'+'                        <option value="CARTESIAN" selected>Normal (XYZ)</option>\n'+'                        <option value="DELTA">Delta</option>\n'+"                    </select>\n"+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="">Bed center\n'+'                        <small class="u-textRight text-base-primary-color u-pullRight xs-hide"><span data-tooltip="XYZ defaults to corner, delta defaults to center. Here you can override"><i class="fa fa-info-circle"></i> Info</span></small>\n'+"                    </label>\n"+'                    <select ng-model="modal.printer.bed.placeOfOrigin" class="text-input">\n'+'                        <option value="CORNER" selected>Corner</option>\n'+'                        <option value="CENTER">Center</option>\n'+"                    </select>\n"+"                </li>\n"+"\n"+"                <li ng-if=\"modal.printer.bed.printerType == 'CARTESIAN'\">\n"+'                \t<label for="">Build Volume X</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.bed.x" placeholder="Build Volume X">\n'+'                    <span class="text-input__type">mm</span>\n'+"                </li>\n"+"\n"+"                <li ng-if=\"modal.printer.bed.printerType == 'CARTESIAN'\">\n"+'                \t<label for="">Build Volume Y</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.bed.y" placeholder="Build Volume Y">\n'+'                    <span class="text-input__type">mm</span>\n'+"                </li>\n"+"\n"+"                <li ng-if=\"modal.printer.bed.printerType == 'DELTA'\" ng-init=\"(!modal.printer.bed.diameter) ? modal.printer.bed.diameter = modal.printer.bed.x : ''\">\n"+'                    <label for="">Bed diameter</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.bed.diameter" placeholder="Diameter">\n'+'                    <span class="text-input__type">mm</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                \t<label for="" ng-if="modal.printer.bed.printerType == \'CARTESIAN\'">Build Volume Z</label>\n'+'                    <label for="" ng-if="modal.printer.bed.printerType == \'DELTA\'">Height</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.bed.z" placeholder="Build Volume Z">\n'+'                    <span class="text-input__type">mm</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+"                    <label>Invert Axis</label>\n"+"\n"+'\t\t\t\t\t<div class="layout">\n'+'\t\t\t\t\t\t<div class="layout__item u-1/3-sm axis-type">\n'+"\n"+"\t\t\t\t\t\t\t<select\n"+'\t\t\t\t\t\t\t\tclass="text-input"\n'+"\t\t                        ng-init=\"modal.printer.axis.x = modal.printer.axis.x || 1; switchAxisX = [{text: 'X-axis Normal', id: 1}, {text: 'X-axis Inverted', id: -1}]\"\n"+'\t\t                        ng-model="modal.printer.axis.x"\n'+'\t\t                        ng-options="value.id as value.text\n'+'\t\t                            for value in switchAxisX">\n'+"\t\t                    </select>\n"+"\n"+"\t\t\t\t\t\t</div>\n"+'\t\t\t\t\t\t<div class="layout__item u-1/3-sm axis-type">\n'+"\n"+"\t\t                    <select\n"+'\t\t\t\t\t\t\t\tclass="text-input"\n'+"\t\t                        ng-init=\"modal.printer.axis.y = modal.printer.axis.y || 1; switchAxisY = [{text: 'Y-axis Normal', id: 1}, {text: 'Y-axis Inverted', id: -1}]\"\n"+'\t\t                        ng-model="modal.printer.axis.y"\n'+'\t\t                        ng-options="value.id as value.text\n'+'\t\t                            for value in switchAxisY">\n'+"\t\t                    </select>\n"+"\n"+"\t\t\t\t\t\t</div>\n"+'\t\t\t\t\t\t<div class="layout__item u-1/3-sm axis-type">\n'+"\n"+"\t\t                    <select\n"+'\t\t\t\t\t\t\t\tclass="text-input"\n'+"\t\t                        ng-init=\"modal.printer.axis.z = modal.printer.axis.z || 1; switchAxisZ = [{text: 'Z-axis Normal', id: 1}, {text: 'Z-axis Inverted', id: -1}]\"\n"+'\t\t                        ng-model="modal.printer.axis.z"\n'+'\t\t                        ng-options="value.id as value.text\n'+'\t\t                            for value in switchAxisZ">\n'+"\t\t                    </select>\n"+"\n"+"\t\t\t\t\t\t</div>\n"+"\t\t\t\t\t</div>\n"+"\n"+"                </li>\n"+"\n"+"                <li>\n"+'\t\t\t\t\t<label><input type="checkbox" ng-model="modal.printer.bed.heated"> Heated Bed</label>\n'+"                </li>\n"+"\n"+"                <li ng-if=\"modal.environmentLocation == 'local'\">\n"+'                    <label for="">Max. extruder temperature</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.maxTemperature" placeholder="Temperature">\n'+'                    <span class="text-input__type">&deg;C</span>\n'+"                </li>\n"+"\n"+"                <li ng-if=\"modal.printer.bed.heated && modal.environmentLocation == 'local'\">\n"+'                    <label for="">Max. bed temperature</label>\n'+'                    <input type="number" class="text-input" ng-model="modal.printer.maxBedTemperature" placeholder="Temperature">\n'+'                    <span class="text-input__type">&deg;C</span>\n'+"                </li>\n"+"\n"+'\t\t\t\t<hr class="rule">\n'+"\n"+'                <div class="layout">\n'+'                    <div class="layout__item u-1/2"><h3>Extruders</h3></div>\n'+'\t\t\t\t\t<div class="layout__item u-1/2 u-textRight"><a ng-click="modal.addExtruder()" class="btn btn--tertiary">+ Add Extruder</a></div>\n'+"                </div>\n"+"\n"+'                <li class="layout">\n'+'                    <div ng-repeat="extruder in modal.printer.extruders track by $index" class="layout__item u-1/3-sm u-1/2">\n'+'    \t\t\t\t\t<ul class="form-fields block block--extruder">\n'+"    \t\t\t\t\t\t<li>\n"+'    \t\t\t\t\t\t\t<label for="">Extruder Name (tag)</label>\n'+'    \t\t                    <input type="text" class="text-input" ng-model="extruder.name" placeholder="Extruder Name">\n'+"    \t\t                </li>\n"+"\n"+"    \t\t                <li>\n"+'    \t\t                \t<label for="">Nozzle diameter <small>(micron)</small></label>\n'+'    \t\t                    <input type="number" class="text-input" ng-init="extruder.id = $index" ng-model="extruder.nozzleSize" placeholder="Nozzle Size">\n'+"    \t\t                </li>\n"+"\n"+"                            <li>\n"+'                            \t<label for="">Filament diameter <small>(micron)</small></label>\n'+'                                <input type="number" class="text-input" ng-model="extruder.filamentDiameter" placeholder="Diameter">\n'+"                            </li>\n"+"\n"+"    \t\t                <li>\n"+'\t\t\t\t\t\t\t\t<a class="btn btn--small btn--alert u-margin-left-_5" ng-click="modal.removeExtruder(extruder)"><i class="fa fa-times"></i> Remove Extruder</a>\n'+"    \t\t                </li>\n"+"    \t\t\t\t\t</ul>\n"+"                    </div>\n"+"                </li>\n"+"\n"+'\t\t\t\t<hr class="rule">\n'+"\n"+"                <h3>G-code</h3>\n"+"\n"+"                <li>\n"+'                    <label for="" title="G-code to add on the top of the file">Start G-code</label>\n'+"\n"+"                    <input\n"+'                        type="text"\n'+'                        class="text-input"\n'+'                        ng-list=","\n'+'                        required="true"\n'+'                        placeholder="Start G-code"\n'+'                        ng-model="modal.printer.startGcode">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="" title="G-code to add on the bottom of the file">End G-code</label>\n'+"\n"+"                    <input\n"+'                        type="text"\n'+'                        class="text-input"\n'+'                        ng-list=","\n'+'                        required="true"\n'+'                        placeholder="End G-code"\n'+'                        ng-model="modal.printer.endGcode">\n'+"                </li>\n"+"\n"+"                <li>\n"+'                    <label for="" title="Type of G-code dialect, these are to commonly used standards">G-code Flavour</label>\n'+"\n"+"                    <select\n"+'                        class="text-input"\n'+'                        required="true"\n'+'                        ng-model="modal.printer.gcodeFlavour"\n'+'                        ng-options="item.name as item.label for item in modal.defaultSliceprofile.gcode.gcodeFlavour.options">\n'+'                            <option value="">Select an option</option>\n'+"                    </select>\n"+"                </li>\n"+"\n"+'\t\t\t\t<div class="layout">\n'+'\t\t\t\t\t<div class="layout__item u-1/2"><h3>Custom commands</h3></div>\n'+'\t\t\t\t\t<div class="layout__item u-1/2 u-textRight"><a ng-click="modal.addCustomCommand()" class="btn btn--tertiary">+ Add Command</a></div>\n'+"\t\t\t\t</div>\n"+"\n"+'                <li class="layout">\n'+'                    <div ng-repeat="customCommand in modal.printer.customCommands track by $index" class="layout__item u-1/3-sm u-1/2">\n'+'    \t\t\t\t\t<ul class="form-fields block block--extruder">\n'+"    \t\t\t\t\t\t<li>\n"+'    \t\t\t\t\t\t\t<label for="">Label</label>\n'+'    \t\t                    <input type="text" class="text-input" ng-model="customCommand.label" placeholder="Label">\n'+"    \t\t                </li>\n"+"\n"+"                            <li>\n"+'    \t\t\t\t\t\t\t<label for="">G-code Command</label>\n'+'    \t\t                    <input type="text" class="text-input" ng-model="customCommand.command" placeholder="Command">\n'+"    \t\t                </li>\n"+"\n"+"    \t\t                <li>\n"+'\t\t\t\t\t\t\t\t<a class="btn btn--small btn--alert u-margin-left-_5" ng-click="modal.removeCustomCommand(customCommand)"><i class="fa fa-times"></i> Remove Command</a>\n'+"    \t\t                </li>\n"+"    \t\t\t\t\t</ul>\n"+"                    </div>\n"+'\t\t\t\t\t<div class="layout__item u-1/1" ng-if="modal.printer.customCommands.length < 1">\n'+"\t\t\t\t\t\t<p>\n"+'\t\t\t\t\t\t\tCustom commands are short gcode strings that you can either set up yourself manually or that come as a preset with your specific printer. More information on custom commands can be found <a href="https://formide.zendesk.com/hc/en-us/articles/211766525-What-are-Custom-Commands-" target="_blank">here</a>.\n'+"\t\t\t\t\t\t</p>\n"+"\n"+"\t\t\t\t\t</div>\n"+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <hr class="rule">\n'+"\n"+'\t\t<div class="submit-btn-group">\n'+'\t\t\t<button class="btn btn--primary" ng-click="modal.submitForm(modal.printer); closeThisDialog()">Save</button>\n'+'\t\t\t<button class="btn btn--secondary" ng-click="closeThisDialog()">Cancel</button>\n'+"\t\t</div>\n"+"\n"+"\t</form></script>");$templateCache.put("manage-sliceprofiles/componentView.html",'<article><header class=layout><div class="layout__item u-1/2"><h3>Manage Slice Profiles</h3></div><div class="u-textRight layout__item u-1/2"><a class="btn btn--tertiary" ng-click=manageSliceprofiles.advancedCreateModal()>Add a New Slice Profile</a></div></header><section class=block ng-if="manageSliceprofiles.sliceprofiles.length > 0"><table class="table--formide table--formide--responsive"><thead><tr><th ng-if="manageSliceprofiles.environmentLocation == \'cloud\'"><a ng-click="manageSliceprofiles.setSortBy(\'name\')">Name <i ng-if="manageSliceprofiles.sort != \'name\'" class="fa fa-sort"></i> <i ng-if="manageSliceprofiles.sort == \'name\' && manageSliceprofiles.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="manageSliceprofiles.sort == \'name\' && manageSliceprofiles.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="manageSliceprofiles.environmentLocation == \'cloud\'"><a ng-click="manageSliceprofiles.setSortBy(\'createdAt\')">Added <i ng-if="manageSliceprofiles.sort != \'createdAt\'" class="fa fa-sort"></i> <i ng-if="manageSliceprofiles.sort == \'createdAt\' && manageSliceprofiles.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="manageSliceprofiles.sort == \'createdAt\' && manageSliceprofiles.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="manageSliceprofiles.environmentLocation == \'local\'">Name</th><th ng-if="manageSliceprofiles.environmentLocation == \'local\'">Added</th><th>Layerheight</th><th>Speed</th><th>Infill</th><th></th></tr></thead><tbody><tr ng-repeat="sliceprofile in manageSliceprofiles.sliceprofiles | orderBy : manageSliceprofiles.sortOrder + manageSliceprofiles.sort" class=table__item><td data-th=Name class=name>{{ sliceprofile.name }}</td><td data-th=Added>{{sliceprofile.createdAt | timeAgo}}</td><td data-th=Layerheight>{{ sliceprofile.settings.layers.layerHeight }} micron</td><td data-th=Speed>{{ sliceprofile.settings.movement.infillSpeed }} mm/s</td><td data-th=Infill>{{ sliceprofile.settings.infill.amount }} %</td><td class="table__item__controls u-textRight"><a ng-if=!sliceprofile.preset class="btn btn--small btn--tertiary" ng-click=manageSliceprofiles.advancedUpdateModal(sliceprofile)><i class="fa fa-pencil"></i></a> <a ng-if=!sliceprofile.preset class="btn btn--small btn--alert" ng-click=manageSliceprofiles.deleteSliceprofile(sliceprofile)><i class="fa fa-trash-o"></i></a></td></tr></tbody></table></section><div ng-if=!manageSliceprofiles.$resolved class="u-textCenter u-margin-top-1 u-margin-bottom-1"><i class="fa fa-refresh fa-spin fa-3x text-base-primary-color"></i></div><section class=animate-show ng-show="manageSliceprofiles.sliceprofiles.length == 0 && manageSliceprofiles.$resolved" id=invite><div class="layout layout--alignCenter"><div class="icon u-fit"><i class="fa fa-cogs"></i></div><div class="layout__item u-3/5 u-1/2-sm"><h2>Add a New Slice Profile</h2><p>Click the button <a ng-click=manageSliceprofiles.advancedCreateModal()>\'Add a Slice Profile\'</a> to get started with creating a slice profile</p></div></div></section></article><script type=text/ng-template id=advancedSettingsModal><div ng-if="!modal.update && modal.environmentLocation === \'cloud\'" class="xs-hide">\n'+"        <h4>Drag and drop import</h4>\n"+"\n"+'        <div class="file-upload"\n'+"            add-new\n"+"            ngf-select\n"+"            ngf-drop\n"+'            ngf-drag-over-class="dragover" ngf-change="modal.upload($files)">\n'+"\n"+'            <article class="layout layout--alignCenter slicer-options">\n'+'                <section class="layout__item u-1/6">\n'+'                    <a href="https://ultimaker.com/en/products/cura-software">\n'+'                        <img src="./public/assets/images/slicers/Cura.png" alt="Cura">\n'+"                    </a>\n"+"                </section>\n"+"\n"+'\t\t\t\t<section class="layout__item u-1/6">\n'+'                    <a href="https://www.simplify3d.com/" class="coming-soon">\n'+"                        <span>Coming Soon</span>\n"+'                        <img src="./public/assets/images/slicers/Simplify3D.png" alt="Simplify3D">\n'+"                    </a>\n"+"                </section>\n"+"\n"+'\t\t\t\t<section class="layout__item u-1/6">\n'+'                    <a href="http://slic3r.org/" class="coming-soon">\n'+"                        <span>Coming Soon</span>\n"+'                        <img src="./public/assets/images/slicers/Slic3r.png" alt="Slic3r">\n'+"                    </a>\n"+"                </section>\n"+"\n"+'\t\t\t\t<section class="layout__item u-1/6">\n'+'                    <a href="http://www.kisslicer.com/" class="coming-soon">\n'+"                        <span>Coming Soon</span>\n"+'                        <img src="./public/assets/images/slicers/KISS.png" alt="KISS">\n'+"                    </a>\n"+"                </section>\n"+"            </article>\n"+"        </div>\n"+"\n"+"        <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div>\n"+"    </div>\n"+"\n"+'    <form role="form" name="customSliceprofile">\n'+"\n"+'        <fieldset ng-if="modal.environmentLocation === \'cloud\' || modal.presets.length > 0" class="u-margin-bottom-1">\n'+'            <ul class="form-fields">\n'+"                <li>\n"+'                    <label for="">Select a slice profile from one of the presets</label>\n'+"\n"+"                    <ui-select\n"+'                        ng-model="modal.preset"\n'+'                        ng-change="modal.presetChanged()"\n'+'                        theme="select2"\n'+'                        style="width: 100%">\n'+"\n"+'                        <ui-select-match placeholder="Start typing to search presets...">\n'+"                            {{$select.selected.name}}\n"+"                        </ui-select-match>\n"+"                        <ui-select-choices\n"+'                            refresh="modal.getPresets($select.search)"\n'+'                            refresh-delay="500"\n'+'                            repeat="item in modal.presets">\n'+"\n"+'                            <div class="layout">\n'+'                                <div class="layout__item u-1/2">\n'+'                                    <span ng-bind-html="::item.name | highlight: $select.search"></span>\n'+"                                </div>\n"+'\t\t\t\t\t\t\t\t<div class="layout__item u-1/2 u-textRight">\n'+'                                    <span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if="item.preset"></span>\n'+"                                </div>\n"+"                            </div>\n"+"                        </ui-select-choices>\n"+"                    </ui-select>\n"+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+"        <h4>Custom Slice Profile</h4>\n"+"        <fieldset>\n"+'            <ul class="form-fields">\n'+"                <li>\n"+'                   <label for="sliceprofile-name">Slice Profile Name</label>\n'+"\n"+'                   <input type="text" class="text-input" ng-model="modal.sliceprofile.name" placeholder="Slice profile Name">\n'+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <ul class="list-tabs u-margin-top-2">\n'+"            <li ng-click=\"modal.setSlicePreference('quick')\" ng-class=\"{'active': modal.slicePreference == 'quick'}\">\n"+"                Quick\n"+"            </li>\n"+"            <li ng-click=\"modal.setSlicePreference('advanced')\" ng-class=\"{'active': modal.slicePreference == 'advanced'}\">\n"+"                Advanced\n"+"            </li>\n"+"            <li ng-click=\"modal.setSlicePreference('json')\" ng-class=\"{'active': modal.slicePreference == 'json'}\">\n"+"                Json\n"+"            </li>\n"+'\t\t\t<div class="katanaVersion">\n'+"                v{{modal.katanaVersion}}\n"+"            </div>\n"+"        </ul>\n"+"\n"+'        <div ng-if="modal.slicePreference == \'advanced\'" class="advanced-settings">\n'+'            <ul class="list-inline">\n'+'                <li class="btn btn--pill" ng-repeat="(key, parameters) in modal.tabs" ng-click="modal.selectTab(key)" ng-class="{\'active\': modal.activeTab == key}"><a>{{ key | title}}</a></li>\n'+"            </ul>\n"+"\n"+"    \t    <br/>\n"+'    \t    <hr class="rule">\n'+"\n"+'            <fieldset ng-repeat="(key, parameters) in modal.types" ng-if="modal.activeTab == key">\n'+"\n"+'                <ul class="form-fields">\n'+"                    <li\n"+'                        ng-repeat="(settingsName, settings) in parameters"\n'+"                        ng-if=\"settings.type != 'hidden'\">\n"+"\n"+"                        <div ng-if=\"settings.type == 'Boolean'\">\n"+'                            <label title="{{::settings.description}}"\n'+'\t\t\t\t\t\t\t\tng-click="modal.sliceprofile.settings[key][settingsName] = !modal.sliceprofile.settings[key][settingsName]">\n'+'\t\t\t\t\t\t\t\t\t<span class="checkbox">\n'+'\t\t\t\t\t\t\t\t\t\t<i ng-if="!modal.sliceprofile.settings[key][settingsName]" class="fa fa-square-o"></i>\n'+'\t\t\t\t\t\t\t\t\t\t<i ng-if="modal.sliceprofile.settings[key][settingsName]" class="fa fa-check-square-o"></i>\n'+"\t\t\t\t\t\t\t\t\t</span>\n"+"\t\t\t\t\t\t\t\t\t{{(settings.label || settingsName) | title}}\n"+'\t\t\t\t\t\t\t\t\t<small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide">\n'+'\t\t\t\t\t\t\t\t\t\t<span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span>\n'+"\t\t\t\t\t\t\t\t\t</small>\n"+"                            </label>\n"+"                        </div>\n"+"\n"+"                        <div ng-if=\"settings.type == 'String' && settings.options.length > 0\">\n"+'                            <label for="" title="{{::settings.description}}">{{(settings.label || settingsName) | title}} <small ng-if="settings.unit" ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide"><span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span></small></label>\n'+"\n"+"                            <select\n"+'                                class="text-input"\n'+'                                ng-required="{{::settings.mandatory || false}}"\n'+'                                ng-model="modal.sliceprofile.settings[key][settingsName]"\n'+'                                ng-options="item.name as item.label for item in settings.options">\n'+'                                    <option value="" disabled selected style="display: none;">Select an option</option>\n'+"        \t\t\t\t\t</select>\n"+"                        </div>\n"+"\n"+"                        <div ng-if=\"(settings.type == 'Int' || settings.type == 'Float') && (!settings.maxvalue || !settings.minvalue)\">\n"+'                            <label for="" title="{{::settings.description}}">{{(settings.label || settingsName) | title}} <small ng-if="settings.unit" ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.maxvalue >= 0 || settings.minvalue >= 0">(</small><small ng-if="settings.minvalue >= 0">min: {{::settings.minvalue}}</small><small ng-if="settings.maxvalue >= 0 && settings.minvalue >= 0">&nbsp;</small><small ng-if="settings.maxvalue >= 0">max: {{::settings.maxvalue}}</small><small ng-if="settings.maxvalue >= 0 || settings.minvalue >= 0">)</small> <small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide"><span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span></small></label>\n'+"\n"+"                            <input\n"+'                                type="number"\n'+'                                class="text-input"\n'+'\t\t\t\t\t\t\t\tname="{{(settings.label || settingsName) | title}}"\n'+'                                ng-attr-max="{{settings.maxvalue >= 0 ? settings.maxvalue : undefined}}"\n'+'                                ng-attr-min="{{settings.minvalue >= 0 ? settings.minvalue : undefined}}"\n'+'                                ng-required="{{::settings.mandatory || false}}"\n'+'                                placeholder="{{(settings.label || settingsName) | title}}"\n'+'                                ng-model="modal.sliceprofile.settings[key][settingsName]">\n'+"                        </div>\n"+"\n"+"                        <div ng-if=\"(settings.type == 'Int' || settings.type == 'Float') && (settings.minvalue && settings.maxvalue)\">\n"+'                            <label for="" title="{{::settings.description}}">{{(settings.label || settingsName) | title}} <small ng-if="settings.unit" ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide"><span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span></small></label>\n'+"\n"+'                            <range-slider min="{{settings.minvalue || 0}}" max="{{settings.maxvalue || 100}}" step="1" ng-model="modal.sliceprofile.settings[key][settingsName]" value="{slider:modal.sliceprofile.settings[key][settingsName]}" ng-required="{{::settings.mandatory || false}}" pretty-min="{{settings.minvalue}}" pretty-max="{{settings.maxvalue}}" input-field="true"></range-slider>\n'+"                        </div>\n"+"\n"+"                        <div ng-if=\"settings.type == 'String[]'\">\n"+'                            <label for="" title="{{::settings.description}}">{{(settings.label || settingsName) | title}} <small ng-if="settings.unit" ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide"><span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span></small></label>\n'+"\n"+"                            <input\n"+'                                type="text"\n'+'                                class="text-input"\n'+'                                ng-list=","\n'+'                                ng-required="{{::settings.mandatory || false}}"\n'+'                                placeholder="{{(settings.label || settingsName) | title}}"\n'+'                                ng-model="modal.sliceprofile.settings[key][settingsName]">\n'+"                        </div>\n"+"\n"+"                        <div ng-if=\"setting.type == 'String' && !settings.options\">\n"+'                            <label for="" title="{{::settings.description}}">{{(settings.label || settingsName) | title}} <small ng-if="settings.unit" ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.description" class="u-textRight text-base-primary-color xs-hide"><span data-tooltip="{{::settings.description}}"><i class="fa fa-info-circle"></i> Info</span></small></label>\n'+"\n"+"                            <input\n"+'                                type="text"\n'+'                                class="text-input"\n'+'                                ng-required="{{::settings.mandatory || false}}"\n'+'                                placeholder="{{(settings.label || settingsName) | title}}"\n'+'                                ng-model="modal.sliceprofile.settings[key][settingsName]">\n'+"                        </div>\n"+"                    </li>\n"+"                </ul>\n"+"            </fieldset>\n"+"        </div>\n"+"\n"+"        <fieldset ng-if=\"modal.slicePreference == 'quick'\">\n"+'            <ul class="form-fields">\n'+"                <li>\n"+'                   <label for="sliceprofile-layerheight">Layerheight</label>\n'+"\n"+'                   <input type="number" class="text-input" ng-model="modal.sliceprofile.settings.layers.layerHeight" placeholder="Layer Height">\n'+'                   <span class="text-input__type">micron</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                   <label for="sliceprofile-layerheight">Inner Wall Speed</label>\n'+"\n"+'                   <input type="number" class="text-input" ng-model="modal.sliceprofile.settings.movement.innerWallSpeed" placeholder="Inner wall speed">\n'+'                   <span class="text-input__type">mm/s</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                   <label for="sliceprofile-layerheight">Outer Wall Speed</label>\n'+"\n"+'                   <input type="number" class="text-input" ng-model="modal.sliceprofile.settings.movement.outerWallSpeed" placeholder="Outer wall speed">\n'+'                   <span class="text-input__type">mm/s</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                   <label for="sliceprofile-layerheight">Infill Speed</label>\n'+"\n"+'                   <input type="number" class="text-input" ng-model="modal.sliceprofile.settings.movement.infillSpeed" placeholder="Infill speed">\n'+'                   <span class="text-input__type">mm/s</span>\n'+"                </li>\n"+"\n"+"                <li>\n"+'                   <label for="sliceprofile-layerheight">Infill Percentage</label>\n'+"\n"+'                   <input type="number" class="text-input" ng-model="modal.sliceprofile.settings.infill.amount" placeholder="Infill">\n'+'                   <span class="text-input__type">%</span>\n'+"                </li>\n"+"            </ul>\n"+"        </fieldset>\n"+"\n"+'        <div ng-if="modal.slicePreference == \'json\'" class="advanced-settings">\n'+'            <ul class="form-fields">\n'+"                <li>\n"+'                    <label for="">JSON Formatted Advanced settings</label>\n'+'                    <textarea rows="24" ng-model="modal.sliceprofile.settings" json-text></textarea>\n'+"        </div>\n"+"\n"+"\t\t<br/>\n"+'\t    <hr class="rule">\n'+"\n"+'\t\t<div class="validationError" ng-if="customSliceprofile.$error.required[0].$name">{{customSliceprofile.$error.required[0].$name}} is mandatory, please enter a value!</div>\n'+'\t\t<div class="validationError" ng-if="customSliceprofile.$error.min[0].$name && !customSliceprofile.$error.required[0].$name">{{customSliceprofile.$error.min[0].$name}} is too small, please increase it\'s value!</div>\n'+'\t\t<div class="validationError" ng-if="customSliceprofile.$error.max[0].$name && !customSliceprofile.$error.min[0].$name && !customSliceprofile.$error.required[0].$name">{{customSliceprofile.$error.max[0].$name}} is too large, please reduce it\'s value!</div>\n'+"\n"+'\t\t<div class="submit-btn-group">\n'+'\t        <button class="btn btn--primary" ng-disabled="customSliceprofile.$invalid" ng-click="modal.submitForm(modal.sliceprofile); closeThisDialog()">Save</button>\n'+'\t\t\t<button class="btn btn--secondary" ng-click="closeThisDialog()">Cancel</button>\n'+"\t\t</div>\n"+"\n"+"    </form></script>");
$templateCache.put("manage/componentView.html",'<section class="settings-header is-header"><nav core-nav core-nav-sub route-config=manage.routeConfig role="primary navigation" rel=nav class="nav in-header"></nav></section><div ng-viewport=subView class="fade inner-page-content"></div>');$templateCache.put("onboarding/componentView.html",'<div class="content content--small onboarding" ng-switch=modal.currentStep><section ng-switch-default><div class=figure-container><figure class="onboarding-figure xs-hide"><img class=main-image src=public/assets/images/setup/setup_welcome.png width=280 height=280 alt=Welcome></figure><img class="balloon-image balloon-image--welcome xs-hide" src=public/assets/images/setup/setup_hi.png alt=""></div><br><h2>Welcome to Formide!</h2><div class=entry-content><p>After buying an Element, Printer with Formide support, or installing a manual version, complete the following steps to continue.</p><br><p><a href=http://printr.com>Haven\'t bought an Element yet?</a></p><hr class=rule><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.useFormide();>Skip Setup</button> <button class="btn action--secondary" ng-click="modal.currentStep = \'setupChooseDevice\'">Get Started</button></div></div></section><section ng-switch-when=setupChooseDevice><h2>Choose the type of device you wish to set up:</h2><div class="selectDevice element" ng-click="modal.currentStep = \'setupSingleDevice\'"><div class="layout layout--alignMiddle layout--withoutGutter"><div class="u-fit-sm u-1/1"><img src=public/assets/images/setup/setup_element.png width=150 height=150 alt="" draggable=false></div><div class="u-fill-sm u-1/1"><h3>The Element</h3></div></div></div><div class="selectDevice integrated" ng-click="modal.setupDeviceError = \'\'; modal.currentStep = \'setupIntegratedPrinter\'"><div class="layout layout--alignMiddle layout--withoutGutter"><div class="u-fill-sm u-1/1"><h3>Integrated<br class="xs-hide"><span class=sm-hide>&nbsp;</span>Printer</h3></div><div class="u-fit-sm u-1/1"><img src=public/assets/images/setup/setup_integrated.png width=150 height=150 alt="" draggable=false></div></div></div><p>Info on setting up a custom device can be found <a class=anchor__link>here</a></p><hr class=rule><div class="actions u-textCenter"><button class="btn btn--tertiary" ng-click=modal.useFormide();>Cancel</button></div></section><section ng-switch-when=setupIntegratedPrinter><div class=figure-container><figure class="onboarding-figure xs-hide"><img class=main-image src=public/assets/images/setup/setup_integrated_code.png width=180 height=180 alt=Printer style="margin: 58px 0 0 50px"></figure><img class="balloon-image balloon-image--integrated xs-hide" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"></div><br><h2><i class="fa fa-check text-base-green"></i> Set up an Integrated Printer</h2><div class=entry-content><div class=numberCircleList><div class=numberCircle>1</div><span class=numberCircleText>Connect your printer to Wi-Fi</span></div><div class=numberCircleList><div class=numberCircle>2</div><span class=numberCircleText>Generate a Cloud Code and enter below</span></div><form id=cloudCodeForm><section class="layout layout--alignCenter"><div class="cloudCode layout-item u-fit"><input focus-next id=cloudCode_c1 max-length=1 class=text-input placeholder=_ ng-model=modal.cloudCode.c1> <input focus-next max-length=1 class=text-input placeholder=_ ng-model=modal.cloudCode.c2> <input focus-next max-length=1 class=text-input placeholder=_ ng-model=modal.cloudCode.c3> <input focus-next max-length=1 class=text-input placeholder=_ ng-model=modal.cloudCode.c4> <input focus-next submit=modal.submitCloudCode max-length=1 class=text-input placeholder=_ ng-model=modal.cloudCode.c5></div></section><p class="u-margin-top-1_5 u-margin-bottom-0">More info on how to do this on your printer can be found <a>here</a></p><br><hr class=rule><p class=loadErrorMessage>{{modal.setupDeviceError}}</p><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click="modal.currentStep = \'setupChooseDevice\'">Go Back</button> <button class="btn action--secondary" ng-disabled=modal.loading ng-click=modal.submitCloudCode()>Continue <i ng-if=modal.loading class="fa fa-refresh fa-spin"></i></button></div></form></div></section><section ng-switch-when=setupSingleDevice><div class=figure-container><figure class="onboarding-figure xs-hide"><img class=main-image src=public/assets/images/setup/the_element_power.png width=250 height=160 alt=Printer style="margin: 80px 0 0 10px"></figure><img class="balloon-image balloon-image--element xs-hide" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"></div><br><h2><i class="fa fa-check text-base-green"></i> Set up the Element</h2><div class=entry-content><div class=numberCircleList><div class=numberCircle>1</div><span class=numberCircleText><strong>Connect the Element to a power supply</strong> using the Micro USB cable that came with the Element</span></div><div class=numberCircleList><div class=numberCircle>2</div><span class=numberCircleText>On your computer, <strong>connect to the Wi-Fi network \'The-Element-xxxxxx\'</strong></span></div><div class=numberCircleList><div class=numberCircle>3</div><span class=numberCircleText>Then continue to the next step</span></div><br><hr class=rule><p class=loadErrorMessage>{{modal.loadErrorMessage}}</p><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click="modal.currentStep = \'setupChooseDevice\'">Go Back</button> <button class="btn action--secondary" ng-disabled=!modal.connectedToElement ng-click=modal.redirectToSetup()>Continue</button></div></div></section><section ng-switch-when=setupDeviceFinished><div class=figure-container><figure class="onboarding-figure xs-hide"><img class=main-image src=public/assets/images/setup/setup_printer.png width=280 height=280 alt=Printer></figure><img class="balloon-image balloon-image--printer xs-hide" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"></div><br><h2><i class="fa fa-check text-base-green"></i> Wi-Fi Credentials Saved</h2><div class=entry-content><p>The Wi-Fi credentials have been saved and your Element is now connected to your Wi-Fi network.</p><br><hr class=rule><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.useFormide();>Close</button> <button class="btn action--secondary" ng-click="modal.register(); modal.currentStep = \'setupPrinter\'">Connect a Printer</button></div></div></section><section ng-switch-when=setupIntegratedFinished><figure class="onboarding-figure xs-hide"><img ng-if="modal.setupDevice.deviceType == \'integrated_felix\'" class=logo-image src=public/assets/images/setup/felix.png width=227 height=117 alt=Printer> <img ng-if="modal.setupDevice.deviceType == \'integrated_builder\'" class=logo-image src=public/assets/images/setup/builder.png width=227 height=117 alt=Printer> <img ng-if="modal.setupDevice.deviceType == \'custom_device\'" src=public/assets/images/setup/setup_printer.png width=280 height=280 alt=Printer></figure><br><h2><i class="fa fa-check text-base-green"></i>Device linked</h2><div class=entry-content><p>Your device is now linked to your Formide account</p><br><hr class=rule><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.useFormide();>Close</button> <button ng-if="modal.setupDevice.deviceType != \'custom_device\'" class="btn action--secondary" ng-click=modal.setupIntegratedFinished()>Configure your Printer</button> <button ng-if="modal.setupDevice.deviceType == \'custom_device\'" class="btn action--secondary" ng-click="modal.currentStep = \'setupPrinter\'">Connect a Printer</button></div></div></section><section ng-switch-when=setupPrinter><div class=figure-container><figure class="onboarding-figure xs-hide"><img class=main-image src=public/assets/images/setup/setup_printer.png width=280 height=280 alt=Printer></figure><img class="balloon-image balloon-image--printer xs-hide" src=public/assets/images/setup/setup_set-me-up.png alt="Set me up!"></div><br><h2><i class=fa ng-class="(modal.printer.resource.length < 1) ? \'fa-refresh fa-spin text-base-orange\' : \'fa-check text-base-green\'"></i> Connect your printer</h2><div class=entry-content><p>Congratulations on setting up The Element!<br>Already the last step is connecting the USB of your printer to The Element.</p><br><p><a ng-click="modal.printerSetupDialog() && closeThisDialog()" style="btn btn--secondary">Set up a Printer</a></p><hr class=rule><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click="modal.currentStep = \'setupDevice\'">Go Back</button> <button class="btn action--secondary" ng-disabled="modal.printer.resource.length < 1" ng-click=modal.useFormide();>Start using Formide!</button></div></div></section></div>');$templateCache.put("print-console/componentView.html","<article id=printer-console><h3>Printer Console</h3><p ng-if=\"printConsole.printer.$active.status == 'offline'\">This printer is currently offline.</p><p ng-if=\"printConsole.printer.$active.status == 'printing' || printConsole.printer.$active.status == 'paused' || printConsole.printer.status == 'heating'\">This printer is currently printing.</p><command-line ng-class=\"{'block--disabled': (printConsole.printer.$active.status == 'offline' || printConsole.printer.status == 'printing' || printConsole.printer.status == 'paused' || printConsole.printer.status == 'heating')}\" commands=printConsole.commands></command-line></article>");$templateCache.put("print-controls/componentView.html","<article id=printer-controls><h3>Printer Controls</h3><p ng-if=\"printControls.devices.length < 1 && printControls.environmentLocation == 'cloud'\">You currently have no devices set up on this account</p><p ng-if=\"printControls.devices.length > 0 && printControls.printer.$active.status == 'offline'\">This printer is currently offline</p><p ng-if=\"printControls.printer.$active.status == 'printing' || printControls.printer.$active.status == 'paused'\">This printer is currently printing</p><p ng-if=\"printControls.printer.$active.status == 'heating'\">This printer is currently heating. Controls will become available once it has finished</p><section class=block ng-class=\"{'block--disabled': (printControls.printer.$active.status == 'offline' || (printControls.devices.length < 1  && printControls.environmentLocation == 'cloud') )}\" ng-if=\"printControls.printer.$active.status !== 'printing'  && printControls.printer.$active.status !== 'paused' && printControls.printer.$active.status !== 'heating'\"><h4>Axis</h4><printer-controls axis-pos=printControls.printer.$active.axis extruders=printControls.printer.$active.extruders disable-input=\"printControls.printer.$active.status == 'offline'\"></printer-controls></section><div ng-if=\"printControls.printer.$active.status == 'printing'  || printControls.printer.$active.status == 'paused' || printControls.printer.$active.status == 'heating'\" class=u-posRelative><section class=block ng-class=\"{'block--disabled': (!printControls.printer.$active.speedMultiplier || printControls.printer.$active.status == 'heating')}\"><h4>Tune</h4><h5>Print Speed</h5><fieldset class=tune-container><div class=layout><label class=\"layout__item u-fit u-textCenter\"><printer-controls-speed size=45 speed=printControls.printSpeed min=1 max=500 class=icon></printer-controls-speed></label><section class=\"layout__item u-fill\"><printer-controls-slider min=1 max=500 gcode=printControls.tuneGcode.printSpeed value=printControls.printSpeed input-field=true pretty-min=1% pretty-max=500% disable-input=\"!printControls.checkValue(printControls.printer.$active.speedMultiplier) || printControls.printer.$active.status == 'heating'\"></printer-controls-slider></section></div></fieldset><h5>Flow Rate</h5><fieldset class=tune-container><div class=layout><label class=\"layout__item u-fit u-textCenter\"><printer-controls-flow-rate size=45 speed=printControls.flowRate min=1 max=500 class=icon></printer-controls-flow-rate></label><section class=\"layout__item u-fill\"><printer-controls-slider min=1 max=500 gcode=printControls.tuneGcode.flowRate value=printControls.flowRate input-field=true pretty-min=1% pretty-max=500% disable-input=\"!printControls.checkValue(printControls.printer.$active.flowRate) || printControls.printer.$active.status == 'heating'\"></printer-controls-slider></section></div></fieldset><h5>Fan Speed</h5><fieldset class=tune-container><div class=layout><label class=\"layout__item u-fit u-textCenter\"><printer-controls-fan size=45 speed=printControls.fanSpeed max=100 class=icon></printer-controls-fan></label><section class=\"layout__item u-fill\"><printer-controls-slider min=0 max=100 gcode=printControls.tuneGcode.fanSpeed value=printControls.fanSpeed input-field=true pretty-min=0% pretty-max=100% disable-input=\"!printControls.checkValue(printControls.printer.$active.fanSpeed) || printControls.printer.$active.status == 'heating'\"></printer-controls-slider></section></div></fieldset></section><div ng-if=!printControls.printer.$active.speedMultiplier class=updateOverlay><h4>To use this feature, please update your device</h4><a class=\"btn btn--secondary\" ng-if=\"printControls.environmentLocation == 'cloud'\" ng-click=\"printControls.navigate('manage/devices/'+printControls.printer.$active.device.id+'/update')\">Update</a> <a class=\"btn btn--secondary\" ng-if=\"printControls.environmentLocation == 'local'\" ng-click=\"printControls.navigate('manage/device/update')\">Update</a></div></div><section class=block ng-class=\"{'block--disabled': (printControls.printer.$active.status == 'offline' || (printControls.devices.length < 1  && printControls.environmentLocation == 'cloud') )}\" ng-if=\"printControls.printer.$active.status !== 'printing' && printControls.printer.$active.status !== 'paused' && printControls.printer.$active.status !== 'heating' && printControls.printer.$active.customCommands.length > 0\"><h4>Custom Commands</h4><button ng-repeat=\"customCommand in printControls.printer.$active.customCommands\" class=\"btn btn--secondary u-margin-right-_5\" ng-click=printControls.runCustomCommand(customCommand.command) ng-disabled=\"printControls.printer.$active.status == 'offline'\">{{ customCommand.label }}</button></section><section class=block ng-class=\"{'block--disabled': (printControls.printer.$active.status == 'offline' || printControls.printer.$active.status == 'heating' || (printControls.devices.length < 1  && printControls.environmentLocation == 'cloud') )}\"><h4>Temperature</h4><sub-section class=temperature ng-repeat=\"extruder in printControls.printer.$active.extruders\"><h5>Extruder {{$index + 1}}</h5><temperature-bar valuenow={{extruder.temp}} valuetarget={{extruder.targetTemp}} valuemax={{printControls.maxExtTemp}}></temperature-bar><p class=u-textRight><label for=\"\">Set Final Temperature <input ng-change=printControls.runExtruderCommand($index) ng-model=printControls.targetTempExt[$index] ng-model-options=\"{debounce: 500}\" type=number class=text-input min=0 max={{printControls.maxExtTemp}} ng-disabled=\"printControls.printer.$active.status == 'offline' || printControls.printer.$active.status == 'heating'\">&deg;C</label></p><hr class=\"rule\"></sub-section><h5>Bed</h5><section ng-switch=printControls.printer.$active.bed.heated class=temperature><div ng-switch-when=false><p>This printer does not feature a heated bed.</p></div><div ng-switch-default><temperature-bar valuenow={{printControls.printer.$active.bed.temp}} valuetarget={{printControls.printer.$active.bed.targetTemp}} valuemax={{printControls.maxBedTemp}}></temperature-bar><p class=u-textRight><label for=\"\">Set Final Temperature <input ng-change=printControls.runBedCommand() ng-model=printControls.targetTempBed ng-model-options=\"{debounce: 500}\" type=number class=text-input min=0 valuemax={{printControls.maxBedTemp}} ng-disabled=\"printControls.printer.$active.status == 'offline' || printControls.printer.$active.status == 'heating'\">&deg;C</label></p></div></section></section></article>");$templateCache.put("print-jobs/componentView.html",'<div class=printjobs-menu-btns><a class=icon ng-click="printJobs.filterToggle(); $event.stopPropagation();" ng-mousedown=$event.stopPropagation() data-tooltip-bottom=Filter><i class="fa fa-search" ng-class="{ \'icon--selected\': printJobs.filterOverlay }"></i></a></div><article class=printjobs><header class=layout><div class="layout__item u-1/2"><h3>Print Jobs</h3></div></header><section class=block ng-if="printJobs.printjobs.length > 0" pagination pagination-next-page=printJobs.getNextPage pagination-scroll-distance=1><table class="table--formide table--formide--responsive"><thead><tr><th ng-if="printJobs.environmentLocation == \'cloud\'"><a ng-click="printJobs.setSortBy(\'name\')">Name <i ng-if="printJobs.sort != \'name\'" class="fa fa-sort"></i> <i ng-if="printJobs.sort == \'name\' && printJobs.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="printJobs.sort == \'name\' && printJobs.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="printJobs.environmentLocation == \'cloud\'"><a ng-click="printJobs.setSortBy(\'createdAt\')">Created <i ng-if="printJobs.sort != \'createdAt\'" class="fa fa-sort"></i> <i ng-if="printJobs.sort == \'createdAt\' && printJobs.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="printJobs.sort == \'createdAt\' && printJobs.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="printJobs.environmentLocation == \'cloud\'"><a ng-click="printJobs.setSortBy(\'printer\')">Printer <i ng-if="printJobs.sort != \'printer\'" class="fa fa-sort"></i> <i ng-if="printJobs.sort == \'printer\' && printJobs.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="printJobs.sort == \'printer\' && printJobs.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="printJobs.environmentLocation == \'cloud\'" class=md-and-down-hide><a ng-click="printJobs.setSortBy(\'sliceProfile\')">Slice Profile <i ng-if="printJobs.sort != \'sliceProfile\'" class="fa fa-sort"></i> <i ng-if="printJobs.sort == \'sliceProfile\' && printJobs.sortOrder == \'-\'" class="fa fa-sort-asc"></i> <i ng-if="printJobs.sort == \'sliceProfile\' && printJobs.sortOrder == \'+\'" class="fa fa-sort-desc"></i></a></th><th ng-if="printJobs.environmentLocation == \'local\'">Name</th><th ng-if="printJobs.environmentLocation == \'local\'">Created</th><th ng-if="printJobs.environmentLocation == \'local\'">Printer</th><th ng-if="printJobs.environmentLocation == \'local\'" class=md-and-down-hide>Slice Profile</th><th></th></tr></thead><tbody><tr ng-repeat="job in printJobs.printjobs" class=table__item><td data-th=Name class=name>{{job.name | title}}</td><td data-th=Created>{{job.createdAt | timeAgo}}</td><td data-th=Printer class=name>{{job.printer.name | title}}</td><td data-th="Slice Profile" class="name md-and-down-hide">{{job.sliceProfile.name | title}}</td><td class="actions table__item__controls"><button ng-if="printJobs.environmentLocation == \'cloud\'" ng-click=printJobs.openGcodeViewer(job) class="btn btn--small btn--tertiary sm-and-down-hide">View <span class=u-textNoWrap>G-code</span></button> <button ng-click=printJobs.addToQueue(job) class="btn btn--small btn--primary">Add to Queue</button> <button ng-click=printJobs.removePrintjob(job) class="btn btn--small btn--alert"><i class="fa fa-trash-o"></i></button></td></tr></tbody></table></section><div ng-if=!printJobs.$resolved class="u-textCenter u-margin-top-1 u-margin-bottom-1"><i class="fa fa-refresh fa-spin fa-3x text-base-primary-color"></i></div><section ng-if="printJobs.printjobs.length == 0 && printJobs.$resolved" id=invite><div class="layout layout--alignCenter"><div class="icon layout__item u-fit"><img src="public/assets/images/stl_emptystate_grey.png"></div><div class="layout__item u-3/5 u-1/2-sm"><h2>Create a Print Job</h2><p>Slice one or multiple files in your <a ng-click="printJobs.navigate(\'files\')">Library</a> to create a print job. The Print Job will appear here so that you can print it later.</p></div></div></section></article><library-overlay ng-if=printJobs.filterOverlay ng-class="{ \'overlaySidebarClosed\': $root.sidebarInvisible }"><div class=top><div class=title><div class=fileSearch><i class="fa fa-search icon--selected"></i> <input ng-click=$event.stopPropagation() on-enter="printJobs.filterOverlay = false" ng-model=printJobs.filterSearchValue ng-change=printJobs.getPrintjobs() placeholder="Filter Print Jobs..."></div></div></div><div class=body><div class=u-padding-bottom-1>Show print jobs for...</div><div class=item ng-click="printJobs.filterPrintjobs(\'selected\')"><span class=checkbox><i ng-if="printJobs.filterBy != \'selected\'" class="fa fa-square-o"></i><i ng-if="printJobs.filterBy == \'selected\'" class="fa fa-check-square-o"></i></span>Selected Printer</div><div class=item ng-click="printJobs.filterPrintjobs(\'all\')"><span class=checkbox><i ng-if="printJobs.filterBy != \'all\'" class="fa fa-square-o"></i><i ng-if="printJobs.filterBy == \'all\'" class="fa fa-check-square-o"></i></span>All Printers</div></div></library-overlay>');$templateCache.put("print-monitor/componentView.html",'<article id=currently-printing ng-if="(printMonitor.queue.resource | filter: {status: \'printing\'}).length > 0 && printMonitor.printer.$active.deviceStatus !== \'offline\' "><h3>Monitor Print</h3><ul queue-list class=u-margin-bottom-1><li queue-list-item ng-repeat="item in printingQueue = (printMonitor.queue.resource | filter: {status: \'printing\'})" queue-item=item method=printMonitor.removeFromQueue class=block></li></ul><div class="tune-values xs-hide"><div class="layout layout--alignMiddle"><div class="layout__item u-1/3"><div class=tune-block><h5 class=tune-header>Print Speed</h5><div class="layout layout--alignMiddle"><div class="layout__item u-1/2 u-textRight"><printer-controls-speed size=45 speed=printMonitor.printSpeed min=1 max=500 class=icon></printer-controls-speed></div><div class="layout__item u-1/2 u-textLeft"><h4>{{printMonitor.printSpeed}}%</h4></div></div></div></div><div class="layout__item u-1/3"><div class=tune-block><h5 class=tune-header>Flow Rate</h5><div class="layout layout--alignMiddle"><div class="layout__item u-1/2 u-textRight"><printer-controls-flow-rate size=45 speed=printMonitor.flowRate min=1 max=500 class=icon></printer-controls-flow-rate></div><div class="layout__item u-1/2 u-textLeft"><h4>{{printMonitor.flowRate}}%</h4></div></div></div></div><div class="layout__item u-1/3"><div class=tune-block><h5 class=tune-header>Fan Speed</h5><div class="layout layout--alignMiddle"><div class="layout__item u-1/2 u-textRight"><printer-controls-fan size=45 speed=printMonitor.fanSpeed max=100 class=icon></printer-controls-fan></div><div class="layout__item u-1/2 u-textLeft"><h4>{{printMonitor.fanSpeed}}%</h4></div></div></div></div></div></div></article><div ng-show="(printMonitor.queue.resource | filter: {status: \'printing\'}).length < 1" ng-switch=printMonitor.printer.$active.deviceStatus class=u-margin-bottom-1><h3>Monitor Print</h3><div ng-switch-when=online><article id=loading-queue-state class="fade loading-queue-state u-textCenter" ng-if="printMonitor.printer.$active.status !== \'offline\'"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 class=loader>No items printing</h5><a class=fade ng-click="printMonitor.navigate(\'print/queue\')" add-new>View queue</a></article><article id=loading-queue-state class="fade loading-queue-state u-textCenter u-margin-bottom-2" ng-if="printMonitor.printer.$active.status == \'offline\'"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 class=loader>This printer is currently offline</h5></article></div><div ng-switch-when=offline><article id=loading-queue-state class="fade loading-queue-state u-textCenter u-margin-bottom-2"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 ng-if="printMonitor.environmentLocation === \'cloud\'" class=loader>This device is offline</h5><h5 ng-if="printMonitor.environmentLocation === \'local\'" class=loader>This printer is offline</h5></article></div><div ng-switch-default><article id=loading-queue-state class="fade loading-queue-state u-textCenter u-margin-bottom-2"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 ng-if="printMonitor.environmentLocation === \'cloud\'" class=loader>No device set up</h5><h5 ng-if="printMonitor.environmentLocation === \'local\'" class=loader>No printer connected</h5></article></div></div><hr class="rule u-margin-top-1"><ul class="panel-container layout"><li dashboard-panel header-title="\'Webcam\'" header-icon="\'fa-video-camera\'" header-btn=printMonitor.webcamBtn header-btn-disable="$root.webcamError || printMonitor.printer.$active.deviceStatus !== \'online\'" class="webcam-panel layout__item u-1/2-sm"><dashboard-webcam></dashboard-webcam></li><li dashboard-panel header-title="\'Temperatures\'" header-icon="\'fa-line-chart\'" class="temperatures-panel layout__item u-1/2-sm"><dashboard-temperatures></dashboard-temperatures></li></ul>');$templateCache.put("print-queue/componentView.html",'<article id=currently-printing ng-if="(printQueue.queue.resource | filter: {status: \'printing\'}).length > 0 && printQueue.printer.$active.deviceStatus !== \'offline\' "><h3>Currently Printing</h3><ul queue-list class=u-margin-bottom-1><li queue-list-item ng-repeat="item in printingQueue = (printQueue.queue.resource | filter: {status: \'printing\'})" queue-item=item method=printQueue.removeFromQueue class=block></li></ul><hr class="rule"></article><div ng-switch=printQueue.printer.$active.deviceStatus class=u-margin-bottom-1><div ng-switch-when=online><article id=printing-queue><h3>Print Queue</h3><ul queue-list><li queue-list-item ng-repeat="item in waitingQueue = (printQueue.queue.resource | filter: printQueue.filterQueue) | orderBy:\'updatedAt\'" queue-item=item method=printQueue.removeFromQueue class=block></li></ul></article><article ng-if="printQueue.queue.$resolved && (printQueue.queue.resource | filter: printQueue.filterFinished).length < 1" id=empty-queue-state class="fade empty-queue-state u-textCenter"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5>Currently there are no items in your queue.</h5></article><article ng-if=!printQueue.queue.$resolved id=loading-queue-state class="fade loading-queue-state u-textCenter"><h4><i class="fa fa-2x fa-refresh fa-spin"></i></h4><h5 class=loader>Loading Queue <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h5></article><a class=fade ng-click="printQueue.navigate(\'/print/jobs\')" add-new>Add to queue</a></div><div ng-switch-when=offline><h3>Print Queue</h3><article id=loading-queue-state class="fade loading-queue-state u-textCenter"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 ng-if="printQueue.environmentLocation === \'cloud\'" class=loader>Queue could not be loaded, this device is offline.</h5><h5 ng-if="printQueue.environmentLocation === \'local\'" class=loader>Queue could not be loaded, this printer is offline.</h5></article></div><div ng-switch-default><h3>Print Queue</h3><article id=loading-queue-state class="fade loading-queue-state u-textCenter"><h4><i class="fa fa-2x fa-file-o"></i></h4><h5 ng-if="printQueue.environmentLocation === \'cloud\'" class=loader>Queue could not be loaded, no device set up.</h5><h5 ng-if="printQueue.environmentLocation === \'local\'" class=loader>Queue could not be loaded, no printer connected.</h5></article></div></div>');$templateCache.put("print/componentView.html",'<section class="print-header is-header"><nav core-nav core-nav-sub route-config=print.routeConfig role="primary navigation" rel=nav class="nav in-header"></nav></section><div ng-viewport=subView class=inner-page-content></div>');$templateCache.put("printer-setup/componentView.html",'<div class="content content--small onboarding"><section><div ng-if=!modal.setupSettings><div class=figure-container><figure class="onboarding-figure pulse-border xs-hide" ng-class="modal.detecting ? \'detecting\' : \'found\'"><img ng-if=modal.detecting class=main-image src=public/assets/images/setup/the_element_printer.png width=250 height=150 alt=Printer style="margin: 75px 0 0 18px"> <img ng-if=!modal.detecting class=main-image src=public/assets/images/setup/setup_printer.png width=280 height=280 alt=Printer></figure><img ng-if=modal.detecting class="balloon-image balloon-image--printer xs-hide" src=public/assets/images/setup/setup_plug-me-in.png alt="Set me up!"></div><br><h3 ng-if=modal.detecting>Plug your printer into the USB port of The Element to detect it</h3><h3 ng-if=!modal.detecting>Your printer has been detected</h3><form name=form class=entry-content><fieldset><ul class=form-fields><li ng-if="modal.environmentLocation === \'cloud\' || modal.showPresets"><label for="">Select a printer from one of the presets</label><ui-select ng-model=modal.searchedPresetPrinter ng-change=modal.printerChanged(modal.searchedPresetPrinter) theme=select2 style="width: 100%" ng-click="modal.manualSetup = false"><ui-select-match placeholder="Start typing to search presets...">{{$select.selected.name}}</ui-select-match><ui-select-choices refresh=modal.getPresets($select.search) refresh-delay=500 repeat="item in modal.presets"><div class=layout><div class="layout__item u-1/2"><span ng-bind-html="::item.name | highlight: $select.search"></span></div><div class="layout__item u-1/2 u-textRight"><span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if=item.preset></span></div></div></ui-select-choices></ui-select></li><li><label for="" ng-if="modal.environmentLocation === \'cloud\' || modal.showPresets">Or select a previously saved printer</label><label for="" ng-if="modal.environmentLocation === \'local\' && !modal.showPresets">Select a previously saved printer</label><ui-select ng-model=modal.savedPresetPrinter ng-change=modal.printerChanged(modal.savedPresetPrinter) ng-init=modal.getSavedPresets() theme=select2 style="width: 100%" ng-click="modal.manualSetup = false"><ui-select-match placeholder="Select or search for a saved printer...">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="item in modal.savedPresets | filter: $select.search"><div class=layout><div class="layout__item u-1/2"><span ng-bind-html="::item.name | highlight: $select.search"></span></div><div class="layout__item u-1/2 u-textRight"><span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if=item.preset></span></div></div></ui-select-choices></ui-select><br><br><span>Or <a ng-init="modal.manualSetup = false" ng-click="modal.manualSetup = ! modal.manualSetup">Manually Setup a Printer</a></span></li></ul></fieldset><fieldset ng-show="!modal.manualSetup && !modal.editSetup && modal.presetPrinter"><ul class=form-fields><li><label for="">Printer Name</label><input class=text-input ng-value=modal.presetPrinter.name ng-model=modal.presetPrinter.editedName ng-change=modal.printerEditName() placeholder="Printer Name"></li><li ng-if=modal.savedPresetPrinter.notPreset><label><input type=checkbox ng-model=modal.overridePrevious> Override Previous Saved Printer Settings</label></li><li><a ng-init="modal.editSetup = false" ng-click="modal.editSetup = ! modal.editSetup">Edit Printer Settings</a></li></ul></fieldset><fieldset ng-show="modal.manualSetup || modal.editSetup" class=u-margin-top-1><ul class=form-fields><li><label for="">Printer Name</label><input class=text-input ng-model=modal.customPrinter.name ng-required=true placeholder="Printer Name"></li><li ng-if=modal.presetPrinter.notPreset><label><input type=checkbox ng-model=modal.overridePrevious> Override Previous Saved Printer</label></li><li ng-init="(!modal.customPrinter.bed.printerType) ? modal.customPrinter.bed.printerType = \'CARTESIAN\' : \'\'"><label for="">Printer type</label><select ng-model=modal.customPrinter.bed.printerType class=text-input><option value=CARTESIAN selected>Normal (XYZ)</option><option value=DELTA>Delta</option></select></li><li ng-if="modal.customPrinter.bed.printerType == \'CARTESIAN\'"><label for="">Build Volume X</label><input type=number class=text-input ng-model=modal.customPrinter.bed.x ng-required=true placeholder="Build Volume X"> <span class=text-input__type>mm</span></li><li ng-if="modal.customPrinter.bed.printerType == \'CARTESIAN\'"><label for="">Build Volume Y</label><input type=number class=text-input ng-model=modal.customPrinter.bed.y ng-required=true placeholder="Build Volume Y"> <span class=text-input__type>mm</span></li><li ng-if="modal.customPrinter.bed.printerType == \'DELTA\'"><label for="">Bed diameter</label><input type=number class=text-input ng-model=modal.customPrinter.bed.diameter ng-required=true placeholder=Diameter> <span class=text-input__type>mm</span></li><li><label for="" ng-if="modal.customPrinter.bed.printerType == \'CARTESIAN\'">Build Volume Z</label><label for="" ng-if="modal.customPrinter.bed.printerType == \'DELTA\'">Height</label><input type=number class=text-input ng-model=modal.customPrinter.bed.z ng-required=true placeholder="Build Volume Z"> <span class=text-input__type>mm</span></li><li><label>Invert Axis</label><div class=layout><div class="layout__item u-1/3-sm axis-type"><select class=text-input ng-init="modal.customPrinter.axis.x = modal.customPrinter.axis.x || 1; switchAxisX = [{text: \'X-axis Normal\', id: 1}, {text: \'X-axis Inverted\', id: -1}]" ng-model=modal.customPrinter.axis.x ng-options="value.id as value.text\n'+'\t   \t\t                            for value in switchAxisX"></select></div><div class="layout__item u-1/3-sm axis-type"><select class=text-input ng-init="modal.customPrinter.axis.y = modal.customPrinter.axis.y || 1; switchAxisY = [{text: \'Y-axis Normal\', id: 1}, {text: \'Y-axis Inverted\', id: -1}]" ng-model=modal.customPrinter.axis.y ng-options="value.id as value.text\n'+'\t   \t\t                            for value in switchAxisY"></select></div><div class="layout__item u-1/3-sm axis-type"><select class=text-input ng-init="modal.customPrinter.axis.z = modal.customPrinter.axis.z || 1; switchAxisZ = [{text: \'Z-axis Normal\', id: 1}, {text: \'Z-axis Inverted\', id: -1}]" ng-model=modal.customPrinter.axis.z ng-options="value.id as value.text\n'+'\t   \t\t                            for value in switchAxisZ"></select></div></div></li><li><label><input type=checkbox ng-model=modal.customPrinter.bed.heated> Heated Bed</label></li><div class=layout><div class="layout__item u-1/2"><h4>Extruders</h4></div><div class="layout__item u-1/2 u-textRight"><a ng-click=modal.addExtruder() class="btn btn--tertiary btn--small">+ Add Extruder</a></div></div><li class=layout><div ng-repeat="extruder in modal.customPrinter.extruders track by $index" class="layout__item u-1/2"><ul class="form-fields block block--extruder"><li><label for="">Extruder name</label><input class=text-input ng-model=extruder.name ng-required=true placeholder="Extruder Name"></li><li><label for="">Nozzle diameter <small>(micron)</small></label><input type=number class=text-input ng-init="extruder.id = $index" ng-model=extruder.nozzleSize ng-required=true placeholder="Nozzle Size"></li><li><label for="">Filament diameter <small>(micron)</small></label><input type=number class=text-input ng-model=extruder.filamentDiameter ng-required=true placeholder=Diameter></li><li><a class="btn btn--small btn--alert u-margin-left-_5" ng-click=modal.removeExtruder(extruder)><i class="fa fa-times"></i> Remove Extruder</a></li></ul></div></li><li><a ng-show=modal.editSetup ng-click="modal.editSetup = ! modal.editSetup">Close Printer Settings</a></li></ul></fieldset><hr class=rule><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.closeSetup()>Close</button> <button class="btn action--secondary" ng-click=modal.submitForm(form.$invalid) ng-disabled="(!modal.searchedPresetPrinter && !modal.savedPresetPrinter && (!modal.manualSetup || form.$invalid)) || modal.disableSaveBtn">Save Printer</button></div></form></div><div ng-if="modal.setupSettings && !modal.setupComplete"><h2><i class="fa fa-check text-base-green"></i> Printer setup complete</h2><p>You can now setup a new slice profile and material:</p><fieldset><ul class=form-fields><li><label for="">Select a slice profile from one of the presets</label><ui-select ng-model=modal.sliceprofilePreset ng-change=modal.sliceprofilePresetsChanged() theme=select2 style="width: 100%"><ui-select-match placeholder="Start typing to search presets...">{{$select.selected.name}}</ui-select-match><ui-select-choices refresh=modal.getSliceprofilePresets($select.search) refresh-delay=500 repeat="item in modal.sliceprofilePresets"><div class=layout><div class="layout__item u-1/2"><span ng-bind-html="::item.name | highlight: $select.search"></span></div><div class="layout__item u-1/2 u-textRight"><span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if=item.sliceprofilePreset></span></div></div></ui-select-choices></ui-select></li></ul></fieldset><fieldset><ul class=form-fields><li><label for="">Select a material from one of the presets</label><ui-select ng-model=modal.materialPreset ng-change=modal.materialPresetsChanged() ng-init="materialPresets = modal.initMaterialPresets()" theme=select2 style="width: 100%"><ui-select-match placeholder="Select a material, start typing to search presets...">{{$select.selected.name}}</ui-select-match><ui-select-choices refresh=modal.getMaterialPresets($select.search) refresh-delay=500 repeat="item in modal.materialPresets"><div class=layout><div class="layout__item u-1/2"><span ng-bind-html="::item.name | highlight: $select.search"></span></div><div class="layout__item u-1/2 u-textRight"><span ng-bind-html="\'(Verified Preset)\'| highlight: $select.search" ng-if=item.materialPreset></span></div></div></ui-select-choices></ui-select></li></ul></fieldset><br><hr class=rule><div class=entry-content><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.closeSetup()>Close</button> <button ng-if=modal.isEmpty(modal.sliceprofile) class="btn action--secondary btn--disabled">Save Settings</button> <button ng-if=!modal.isEmpty(modal.sliceprofile) class="btn action--secondary" ng-click="modal.saveSettings(modal.sliceprofile, modal.material);">Save Settings</button></div></div></div><div ng-if="modal.setupSettings && modal.setupComplete"><h2><i class="fa fa-check text-base-green"></i> Congratulations setup complete</h2><p class=twitter><a href="https://twitter.com/home?status=I%20just%20upgraded%20my%203D%20printer%20with%20the%20Element!%20%0A%23Printr%20%23theElement%20%233dprinting" target=”_blank”><i class="fa fa-twitter"></i> Tweet about this</a></p><p>You can now start printing models from your Library</p><br><hr class=rule><div class=entry-content><div class="actions clearfix"><button class="btn btn--tertiary action--primary" ng-click=modal.closeSetup()>Close</button> <a class="btn action--secondary" ng-click="modal.navigate(\'files\'); closeThisDialog()">Go to Library</a></div></div></div></section></div>');
$templateCache.put("printjob-printer/componentView.html",'<h3 class=printerHeader ng-if=!modal.readytoPrint>Select a Printer</h3><h3 class=printerHeader ng-if=modal.readytoPrint>Select an Available Printer</h3><small ng-if=modal.readytoPrint class="text-base-primary-color xs-hide"><span data-tooltip-bottom="Printers that are connected to an online device"><i class="fa fa-info-circle"></i> Info</span></small><form ng-if="(modal.printer | filter: modal.deviceAvailable).length > 1 || !modal.readytoPrint"><fieldset class=u-margin-bottom-_5><label class=search-bar><input ng-model=modal.filter ng-init="modal.filter = \'\'" class=text-input placeholder="Filter 3D Printers"> <button><i class="fa fa-search"></i></button></label></fieldset></form><div class=limit-height><div ng-if="(modal.printer | filter: modal.deviceAvailable).length > 0 || !modal.readytoPrint"><br><h4>Active Printers</h4><ul class=list-ui><li class=list-ui__item ng-repeat="printer in onlinePrinters = (modal.printer | filter: {active: true}  | orderBy: modal.printerSortFunction)" ng-click=modal.onPrinterSelect(printer.id)><section class=device-settings><hgroup><h3><status-icon size=24px status=printer.status></status-icon>{{printer.name}}</h3><small ng-if="printer.bed.printerType != \'DELTA\'">Buildvolume: {{printer.bed.x}} x {{printer.bed.y}} x {{printer.bed.z}} <span ng-if=printer.bed.heated>(heated)</span></small> <small ng-if="printer.bed.printerType == \'DELTA\'">Buildvolume: {{printer.bed.diameter}} x {{printer.bed.z}} <span ng-if=printer.bed.heated>(heated)</span></small></hgroup></section></li><li class=list-ui__item ng-if="onlinePrinters.length < 1">Currently no online printers</li></ul><br></div><div ng-if="(modal.printer | filter: {active: false}  | filter: modal.deviceAvailable).length > 0 || !modal.readytoPrint"><br><h4>Offline Printers</h4><ul class=list-ui><li class=list-ui__item ng-repeat="printer in offlinePrinters = (modal.printer | filter: {active: false} | filter:modal.filter | filter: modal.deviceAvailable)" ng-click=modal.onPrinterSelect(printer.id)><section class=device-settings><hgroup><h3><status-icon size=24px status=printer.status></status-icon>{{printer.name}}</h3><small ng-if="printer.bed.printerType != \'DELTA\'">Buildvolume: {{printer.bed.x}} x {{printer.bed.y}} x {{printer.bed.z}} <span ng-if=printer.bed.heated>(heated)</span></small> <small ng-if="printer.bed.printerType == \'DELTA\'">Buildvolume: {{printer.bed.diameter}} x {{printer.bed.z}} <span ng-if=printer.bed.heated>(heated)</span></small></hgroup></section></li><li class=list-ui__item ng-if="offlinePrinters.length < 1">Currently no offline printers</li></ul><br></div><ul class=list-ui ng-if="(modal.printer | filter: modal.deviceAvailable).length < 1 && modal.readytoPrint"><li class=list-ui__item>Currently no available printers<br><br>Connect a device and printer to queue items</li></ul></div>');$templateCache.put("printjob/componentView.html",'<header class=header--sticky ng-class="{\'hide--aside\': modal.hideAside}"><a class="hide--aside-btn xs-hide" ng-if=!modal.sliceSettings ng-click=modal.hideSettings()><img src=./public/assets/images/hamburger_collapse.svg alt=""></a><h3 style="line-height: 1.2">Slice <span class=fade ng-if="modal.models.length > 1 && !modal.loadingModels">{{modal.models.length}} models</span></h3><section class="actions layout"><div class="layout__item u-1/2 xs-hide"><button class="btn btn--tertiary" style="width:100%; min-width: 0" ng-disabled="modal.models.length == 0 || modal.loadingModels || modal.slicing || modal.sliceSettings" ng-click="modal.addMoreFiles() && $event.stopPropagation()">Add Files</button></div><div class="layout__item u-1/2-sm u-1/1"><button class="btn btn--primary" style="width:100%; min-width: 0" ng-disabled="!modal.printer.$active.selected || modal.models.length == 0 || modal.loadingModels || modal.slicing || !modal.material.selected[0] || !modal.sliceprofile.selected" ng-click="modal.newPrintjob(); modal.saveAdvancedSettings()">Slice <i ng-if=modal.slicing class="fa fa-refresh fa-spin"></i></button></div></section></header><aside ng-class="{\'hide--aside\': modal.hideAside}"><article><fieldset><h5 class=text-base-primary-color><span class=number>1</span><span class="u-padding-left-2 u-block">Enter a print job name</span></h5><section><input class="text-input u-margin-bottom-1_5" ng-model=modal.printJobName></section></fieldset><fieldset><div class="layout u-margin-bottom-_5"><div class="layout__item u-fill"><h5 class=text-base-primary-color><span class=number>2</span><span class="u-padding-left-2 u-block">Select a printer</span></h5></div><div class="layout__item u-fit u-padding-left-0"><button ng-click=modal.choosePrinter() class="btn btn--secondary printer-btn">Change Printer</button></div></div><section class=device-settings><hgroup ng-if=modal.printer.$active.selected><h5>{{modal.printer.$active.name}} <span ng-class="{\'printing\':\'pill--success\', \'paused\':\'pill--warning\', \'online\':\'pill--success\', \'connecting\':\'pill--warning\', \'offline\': \'\'}[modal.printer.$active.status]" class=pill><abbr title="{{modal.printer.$active.name}} is currently {{modal.printer.$active.status}}">{{modal.printer.$active.status | title}}</abbr></span></h5><small ng-if="modal.printer.$active.bed.printerType != \'DELTA\'">Buildvolume: {{modal.printer.$active.bed.x}} x {{modal.printer.$active.bed.y}} x {{modal.printer.$active.bed.z}} <span ng-if=modal.printer.$active.bed.heated>(heated)</span></small> <small ng-if="modal.printer.$active.bed.printerType == \'DELTA\'">Buildvolume: {{modal.printer.$active.bed.diameter}} x {{modal.printer.$active.bed.z}} <span ng-if=modal.printer.$active.bed.heated>(heated)</span></small></hgroup><hgroup ng-if=!modal.printer.$active.selected><h5>No Printer Selected!</h5><small>Please select a printer to slice.</small></hgroup></section></fieldset><fieldset><h5 class=text-base-primary-color><span class=number>3</span><span class="u-padding-left-2 u-block">Select a Slice Profile</span></h5><section><ui-select class=sliceprofile-select ng-model=modal.selectedProfile ng-change=modal.refreshSliceprofile(modal.selectedProfile) theme=select2><ui-select-match placeholder="Select a quality">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="sliceprofile in modal.sliceprofiles | propsFilter: {name: $select.search}"><div ng-bind-html="sliceprofile.name | highlight: $select.search"></div></ui-select-choices></ui-select></section><div class="u-textRight u-margin-bottom-1_5 xs-hide"><button ng-click="modal.sliceSettings = !modal.sliceSettings" class="btn btn--secondary sliceprofile-btn">Override Slice Settings</button></div></fieldset><fieldset><h5 class=text-base-primary-color><span class=number>4</span><span class="u-padding-left-2 u-block">Select materials</span></h5><section ng-if="modal.printer.$active.extruders.length < 1">This printer does not have any extruders!</section><section ng-if="modal.printer.$active.extruders.length >= 1" ng-repeat="extruder in modal.printer.$active.extruders" class=u-posRelative><small><strong>{{extruder.name}}</strong> (EXT{{$index + 1}})</small><div class="checkbox checkbox-ext" ng-if="modal.printer.$active.extruders.length > 1" ng-click=modal.extruderDisable(extruder) title="{{ !extruder.disable ? \'Disable\' : \'Enable\'}}"><i ng-if=extruder.disable class="fa fa-square-o"></i> <i ng-if=!extruder.disable class="fa fa-check-square-o"></i></div><ui-select ng-disabled=extruder.disable ng-model=modal.material.selected[$index] ng-change="modal.refreshMaterial(modal.material.selected[$index], $index)" theme=select2><ui-select-match ng-style="{color: (extruder.disable ? \'#999999\' : \'#161720\') }" placeholder="Select a material">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="material in modal.materials | propsFilter: {name: $select.search, type: $select.search}"><div ng-bind-html="material.name | highlight: $select.search"></div></ui-select-choices></ui-select></section></fieldset><a add-new ng-init="modal.toggleAdvanced = false" ng-click="modal.toggleAdvanced = !modal.toggleAdvanced"><i class=fa ng-class="{true:\'fa-minus\',false:\'fa-plus\'}[modal.toggleAdvanced]"></i> Advanced</a><div ng-if=modal.toggleAdvanced><fieldset ng-if="modal.printer.$active.extruders.length > 1 && !modal.hideExtruderSettings"><label>Select model extruder</label><section ng-repeat="modelfile in modal.models" class=extruder><small ng-class="{\'text-base-primary-color\': modal.selectedModel == modelfile.modelId}">Extruder for {{::modelfile.prettyname}}</small><br><selection-list name=extruder-{{$index}} extruders=modal.material.selected ng-model=modal.models[$index].extruder ng-class="{\'selected\': modal.selectedModel == modelfile.modelId}"></selection-list><small class="selectedFlag text-base-primary-color xs-hide" ng-if="modal.selectedModel == modelfile.modelId">(model selected)</small></section></fieldset><fieldset class=advanced-item ng-if=modal.printer.$active.bed.heated><section class=layout><label class="layout__item u-fill u-margin-bottom-1" ng-click="modal.settings.bed.use = !modal.settings.bed.use"><span class=checkbox title="{{ modal.settings.bed.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.bed.use class="fa fa-square-o"></i> <i ng-if=modal.settings.bed.use class="fa fa-check-square-o"></i></span> Heated Bed</label><small class="u-textRight text-base-primary-color layout__item u-fit xs-hide"><span title="Heated Bed Having a heated bed improves the print quality. Most printers come with this option nowadays. A heated bed keeps the plastic warm and prevents warping (curling edges when cooling down)."><i class="fa fa-info-circle"></i> Info</span></small><div class="layout__item u-1/1" ng-if=modal.settings.bed.use><ui-select ng-if="(modal.material.selected | unique).length > 1 && !modal.hideExtruderSettings" ng-model=modal.bed.material ng-change="modal.refreshMaterial(modal.bed.material, 0)" theme=select2><ui-select-match placeholder="Select a material">{{modal.bed.material.name}}</ui-select-match><ui-select-choices repeat="material in modal.materials | inArray:modal.selectedMaterialIds:\'id\' | propsFilter: {name: $select.search, type: $select.search}"><div ng-bind-html="material.name | highlight: $select.search"></div></ui-select-choices></ui-select><ul class=form-fields><li><label for="">Bed Temperature</label><range-slider min=25 max=150 step=1 ng-model=modal.settings.bed.temperature value={slider:modal.settings.bed.temperature} input-field=true pretty-min=25&deg;C pretty-max=150&deg;C></range-slider></li><li><label for="">First Layers Bed Temperature</label><range-slider min=25 max=150 step=1 ng-model=modal.settings.bed.firstLayersTemperature value={slider:modal.settings.bed.firstLayersTemperature} input-field=true pretty-min=25&deg;C pretty-max=150&deg;C></range-slider></li></ul></div></section></fieldset><fieldset class=advanced-item><div class=layout><label ng-click="modal.settings.brim.use = !modal.settings.brim.use" class="layout__item u-fill"><img src=./public/assets/images/icons/brim.svg class="icon"> <span class=checkbox title="{{ modal.settings.brim.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.brim.use class="fa fa-square-o"></i> <i ng-if=modal.settings.brim.use class="fa fa-check-square-o"></i></span> Brim</label><small class="u-textRight text-base-primary-color layout__item u-fit xs-hide"><span title="Brim A brim are a few lines around and touching the model. You can use it to stabilise your model during printing when it has a small area touching the printer bed."><i class="fa fa-info-circle"></i> Info<span></span></span></small><div class="layout__item u-1/1"><selection-list name=brim extruders=modal.material.selected ng-if="modal.printer.$active.extruders.length > 1 && !modal.hideExtruderSettings" ng-model=modal.settings.brim.extruder></selection-list></div></div></fieldset><fieldset class=advanced-item><div class=layout><label ng-click="modal.settings.raft.use = !modal.settings.raft.use" class="layout__item u-fill"><img src=./public/assets/images/icons/raft.svg class="icon"> <span class=checkbox title="{{ modal.settings.raft.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.raft.use class="fa fa-square-o"></i> <i ng-if=modal.settings.raft.use class="fa fa-check-square-o"></i></span> Raft</label><small class="u-textRight text-base-primary-color layout__item u-fit xs-hide"><span title="Raft A raft is a small supporting structure between the printer bed and your model. It makes taking off the model from the bed easier with some materials and model shapes."><i class="fa fa-info-circle"></i> Info<span></span></span></small><div class="layout__item u-1/1"><selection-list name=raft extruders=modal.material.selected ng-if="modal.printer.$active.extruders.length > 1 && !modal.hideExtruderSettings" ng-model=modal.settings.raft.extruder></selection-list></div></div></fieldset><fieldset class=advanced-item><div class=layout><label ng-click="modal.settings.skirt.use = !modal.settings.skirt.use" class="layout__item u-fill"><img src=./public/assets/images/icons/skirt.svg class="icon"> <span class=checkbox title="{{ modal.settings.skirt.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.skirt.use class="fa fa-square-o"></i> <i ng-if=modal.settings.skirt.use class="fa fa-check-square-o"></i></span> Skirt</label><small class="u-textRight text-base-primary-color layout__item u-fit xs-hide"><span title="Skirt A skirt are a few layers at some distance from the model. It\'s used to get the flow going so you don\'t start with missing lines in your print."><i class="fa fa-info-circle"></i> Info<span></span></span></small><div class="layout__item u-1/1"><selection-list name=skirt extruders=modal.material.selected ng-if="modal.printer.$active.extruders.length > 1 && !modal.hideExtruderSettings" ng-model=modal.settings.skirt.extruder></selection-list></div></div></fieldset><fieldset class=advanced-item><div class=layout><label ng-click="modal.settings.support.use = !modal.settings.support.use" class="layout__item u-fill"><img src=./public/assets/images/icons/support.svg class="icon"> <span class=checkbox title="{{ modal.settings.support.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.support.use class="fa fa-square-o"></i> <i ng-if=modal.settings.support.use class="fa fa-check-square-o"></i></span> Support</label><small class="u-textRight text-base-primary-color layout__item u-fit xs-hide"><span title="Support Some models are complicated to print and need a supporting structure to prevent them from falling over or melting. More advanced support settings can be found in sliceprofile settings."><i class="fa fa-info-circle"></i> Info<span></span></span></small><div class="layout__item u-1/1"><selection-list name=support extruders=modal.material.selected ng-if="modal.printer.$active.extruders.length > 1 && !modal.hideExtruderSettings" ng-model=modal.settings.support.extruder></selection-list></div></div></fieldset><fieldset class=advanced-item><div class=layout><label class="layout__item u-fill" ng-click="modal.settings.fan.use = !modal.settings.fan.use"><printer-fan size=24 speed=50 max=100 class=icon></printer-fan><span class="checkbox u-margin-left-_5" title="{{ modal.settings.fan.use ? \'Disable\' : \'Enable\'}}"><i ng-if=!modal.settings.fan.use class="fa fa-square-o"></i> <i ng-if=modal.settings.fan.use class="fa fa-check-square-o"></i></span> Fan</label></div></fieldset><fieldset class=advanced-item ng-if="modal.printer.$active.abilities.indexOf(\'builderColorMixing\') > -1"><label ng-click="modal.postProcessing[\'BUILDER_COLORMIXER\'].use = !modal.postProcessing[\'BUILDER_COLORMIXER\'].use" ng-init="modal.postProcessing[\'BUILDER_COLORMIXER\'].use = false"><span class="checkbox u-margin-left-_5" title="{{ modal.postProcessing[\'BUILDER_COLORMIXER\'].use ? \'Disable\' : \'Enable\'}}"><i ng-if="!modal.postProcessing[\'BUILDER_COLORMIXER\'].use" class="fa fa-square-o"></i> <i ng-if="modal.postProcessing[\'BUILDER_COLORMIXER\'].use" class="fa fa-check-square-o"></i></span> Material Mixing</label><section ng-repeat="modelfile in modal.models" class=materialMix><h5 class=u-margin-bottom-1>Material mix for {{::modelfile.prettyname}}</h5><section>Start<range-slider min=0 max=100 step=1 ng-model="modal.postProcessing[\'BUILDER_COLORMIXER\'].options.startRatio[$index]" value="{slider:modal.postProcessing[\'BUILDER_COLORMIXER\'].options.startRatio[$index]}" ng-init="modal.postProcessing[\'BUILDER_COLORMIXER\'].options.startRatio[$index] = 100" pretty-min="Material 1" pretty-max="Material 2" show-value=true></range-slider></section><section>End<range-slider min=0 max=100 step=1 ng-model="modal.postProcessing[\'BUILDER_COLORMIXER\'].options.endRatio[$index]" value="{slider:modal.postProcessing[\'BUILDER_COLORMIXER\'].options.endRatio[$index]}" ng-init="modal.postProcessing[\'BUILDER_COLORMIXER\'].options.endRatio[$index] = 0" pretty-min="Material 1" pretty-max="Material 2" show-value=true></range-slider></section></section></fieldset></div></article></aside><article class="modal-main xs-hide" ng-class="{\'fullScreen\': modal.hideAside}"><div ng-if=modal.sliceSettings class=advanced-settings><div class="layout layout--withoutGutter layout--alignMiddle u-margin-bottom-1_5"><div class="layout__item u-fill"><h4 class="text-base-primary-color u-margin-bottom-0">Overrides</h4></div><div class="layout__item u-fit u-margin-left-1"><button class="btn btn-header btn--tertiary" ng-click=modal.undoOverrides() ng-disabled=modal.isEmpty(modal.settings.override)>Undo Changes</button></div><div class="layout__item u-fit u-margin-left-1"><button class="btn btn-header btn--primary" ng-click=modal.saveSliceprofile() ng-disabled=modal.isEmpty(modal.settings.override)>Save For Later</button></div><div class="layout__item u-fit u-margin-left-1"><button class="btn btn-header btn--secondary" ng-click="modal.sliceSettings = false">Hide</button></div></div><ul class=list-inline><li class="btn btn--pill" ng-repeat="(key, parameters) in modal.tabs" ng-click=modal.selectTab(key) ng-class="{\'active\': modal.activeTab == key}"><a>{{ key | title}}</a></li></ul><hr class=rule><fieldset ng-repeat="(key, parameters) in modal.types" ng-if="modal.activeTab == key"><ul class=form-fields><li ng-repeat="(settingsName, settings) in parameters" ng-if="settings.type != \'hidden\'"><div ng-if="settings.type == \'Boolean\'"><label title={{::settings.description}} ng-click="modal.sliceprofile.selected.settings[key][settingsName] = !modal.sliceprofile.selected.settings[key][settingsName];\n'+'\t\t\t\t\t\t\t\t\t\tmodal.setOverrides(key, settingsName)"><span class=checkbox><i ng-if=!modal.sliceprofile.selected.settings[key][settingsName] class="fa fa-square-o"></i> <i ng-if=modal.sliceprofile.selected.settings[key][settingsName] class="fa fa-check-square-o"></i></span> {{(settings.label || settingsName) | title}} <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label></div><div ng-if="settings.type == \'String\' && settings.options.length > 0"><label for="" title={{::settings.description}}>{{(settings.label || settingsName) | title}} <small ng-if=settings.unit ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label><select class=text-input ng-required="{{::settings.mandatory || false}}" ng-model=modal.sliceprofile.selected.settings[key][settingsName] ng-change="modal.setOverrides(key, settingsName)" ng-options="item.name as item.label for item in settings.options"><option value="" disabled selected style="display: none">Select an option</option></select></div><div ng-if="(settings.type == \'Int\' || settings.type == \'Float\') && (!settings.maxvalue || !settings.minvalue)"><label for="" title={{::settings.description}}>{{(settings.label || settingsName) | title}} <small ng-if=settings.unit ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if="settings.maxvalue >= 0 || settings.minvalue >= 0">(</small><small ng-if="settings.minvalue >= 0">min: {{::settings.minvalue}}</small><small ng-if="settings.maxvalue >= 0 && settings.minvalue >= 0">&nbsp;</small><small ng-if="settings.maxvalue >= 0">max: {{::settings.maxvalue}}</small><small ng-if="settings.maxvalue >= 0 || settings.minvalue >= 0">)</small> <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label><input type=number class=text-input name="{{(settings.label || settingsName) | title}}" ng-attr-max="{{settings.maxvalue >= 0 ? settings.maxvalue : undefined}}" ng-attr-min="{{settings.minvalue >= 0 ? settings.minvalue : undefined}}" ng-required="{{::settings.mandatory || false}}" placeholder="{{(settings.label || settingsName) | title}}" ng-model=modal.sliceprofile.selected.settings[key][settingsName] ng-change="modal.setOverrides(key, settingsName)"></div><div ng-if="(settings.type == \'Int\' || settings.type == \'Float\') && (settings.minvalue && settings.maxvalue)"><label for="" title={{::settings.description}}>{{(settings.label || settingsName) | title}} <small ng-if=settings.unit ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label><range-slider min="{{settings.minvalue || 0}}" max="{{settings.maxvalue || 100}}" step=1 ng-required="{{::settings.mandatory || false}}" pretty-min={{settings.minvalue}} pretty-max={{settings.maxvalue}} input-field=true value="{slider: modal.sliceprofile.selected.settings[key][settingsName]}" ng-model=modal.sliceprofile.selected.settings[key][settingsName] ng-change="modal.setOverrides(key, settingsName)"></range-slider></div><div ng-if="settings.type == \'String[]\'"><label for="" title={{::settings.description}}>{{(settings.label || settingsName) | title}} <small ng-if=settings.unit ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label><input class=text-input ng-list=, ng-required="{{::settings.mandatory || false}}" placeholder="{{(settings.label || settingsName) | title}}" ng-model=modal.sliceprofile.selected.settings[key][settingsName] ng-change="modal.setOverrides(key, settingsName)"></div><div ng-if="setting.type == \'String\' && !settings.options"><label for="" title={{::settings.description}}>{{(settings.label || settingsName) | title}} <small ng-if=settings.unit ng-bind-html="settings.unit | trustedIcon"></small> <small ng-if=settings.description class="u-textRight text-base-primary-color xs-hide"><span data-tooltip={{::settings.description}}><i class="fa fa-info-circle"></i> Info</span></small></label><input class=text-input ng-required="{{::settings.mandatory || false}}" placeholder="{{(settings.label || settingsName) | title}}" ng-model=modal.sliceprofile.selected.settings[key][settingsName] ng-change="modal.setOverrides(key, settingsName)"></div></li></ul></fieldset></div><a class=show--aside-btn ng-if=modal.hideAside ng-click=modal.showSettings()><img src=./public/assets/images/hamburger_expand.svg alt=""></a><div class="viewer-loading fade" ng-if=modal.loadingModels><h4><i class="fa fa-4x fa-refresh fa-spin"></i></h4><h6 class=loader>Loading Models <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6><h6 ng-if=modal.largeModel class=loader>This model is larger than 20MBs, loading might take a little longer</h6></div><formide-viewer app=modal.appFunction width=100% height=100% on-save=modal.fileUpdated settings=modal.appSettings></formide-viewer></article><div class="viewer-return fade"></div><script type=text/ng-template id=saveSliceprofile><div class="saveSliceprofile">\n'+"\t\t<h3>Save Overrides as New Slice Profile</h3>\n"+"\t\t<p>\n"+"\t\t\tSave the updated settings as a new Slice Profile so that you can use them again later\n"+"\t\t</p>\n"+"\n"+'\t\t<form name="sliceprofile">\n'+'\t\t\t<label for="" title="{{::settings.description}}" class="u-margin-bottom-_5">New Slice Profile Name</label>\n'+"\n"+"\t\t\t<input\n"+'\t\t\t\ttype="text"\n'+'\t\t\t\tclass="text-input"\n'+'\t\t\t\tng-required="true"\n'+'\t\t\t\tplaceholder="New Slice Profile Name"\n'+'\t\t\t\tng-model="modal.sliceprofile.name"/>\n'+"\t\t</form>\n"+"\n"+'\t\t<div class="submit-btn-group u-margin-top-1_5">\n'+'\t\t\t<button class="btn btn-header btn--primary" ng-click="modal.saveSliceprofile()" ng-disabled="sliceprofile.$invalid">Save As New</button>\n'+'\t\t\t<button class="btn btn-header btn--secondary" ng-click="closeThisDialog()">Cancel</button>\n'+"\t\t</div>\n"+"\t</div></script>");$templateCache.put("settings-account/componentView.html",'<article id=account><h3>Account settings</h3><form class=block><fieldset><ul class=form-fields><li><label for="">Email <small class=text-base-red>Required</small></label><input type=email class="text-input ng-invalid" ng-required=true placeholder=Email ng-model=settingsAccount.settings.email></li><li><label for="">Username <small class=text-base-red>Required</small></label><input class="text-input ng-valid" ng-required=true placeholder=Username ng-model=settingsAccount.settings.username></li><li><label for="">Full name <small class=text-base-red>Required</small></label><input class=text-input ng-required=true placeholder="Full name" ng-model=settingsAccount.settings.fullName></li></ul></fieldset><fieldset><h3>Change password</h3><ul class=form-fields><li><label for="">Password</label><input type=password class=text-input ng-required=true placeholder=Password ng-model=settingsAccount.settings.password></li><li><label for="">Retype password</label><input type=password class=text-input ng-required=true placeholder="Retype password" ng-model=settingsAccount.settings.passwordValidate></li></ul></fieldset><a class=btn ng-click=settingsAccount.saveAccount()>Save Account Settings</a> <span class=text-warning>{{ settingsAccount.errorMessage }}</span></form><form class=block><fieldset><h3>Upload Avatar</h3><a class=avatar-wrapper ngf-select accept=image/* ngf-change=settingsAccount.upload($files)><avatar-img size=128 src="settingsAccount.imagesRootLocation + \'/\' + settingsAccount.settings.avatar" title=settingsAccount.settings.username circle=true></avatar-img></a></fieldset><p>Click on your Avatar to select a new image</p></form><form class=block><fieldset><h3>Integrations</h3><ul class=form-fields><li class=layout><div class="layout__item u-2/3-sm u-1/1"><label for=""><i class="fa fa-facebook"></i> Facebook</label><p><small>The Facebook integration allows you to log in to Formide using your Facebook account.</small></p></div><div class="layout__item u-1/3-sm u-1/1"><br><a ng-if=settingsAccount.settings.facebook class="btn bnt--small btn--alert" ng-click="settingsAccount.disconnectIntegration(\'facebook\')">Disconnect</a><p ng-if=!settingsAccount.settings.facebook><small>To connect this integration, use the Facebook option when logging into Formide.</small></p></div></li><li class=layout><div class="layout__item u-2/3-sm u-1/1"><label for=""><i class="fa fa-google"></i> Google</label><p><small>The Google integration allows you to log in to Formide using your Google account.</small></p></div><div class="layout__item u-1/3-sm u-1/1"><br><p ng-if=!settingsAccount.settings.google><small>To connect this integration, use the Google option when logging into Formide.</small></p><a ng-if=settingsAccount.settings.google class="btn bnt--small btn--alert" ng-click="settingsAccount.disconnectIntegration(\'google\')">Disconnect</a></div></li></ul></fieldset></form><form class=block><fieldset class=u-margin-bottom-0><h3>Other Settings</h3><ul class=form-fields><li><label for=""><i class="fa fa-graduation-cap"></i> N3RD M0D3 <input type=checkbox ng-model=settingsAccount.settings.n3rd ng-change=settingsAccount.toggleN3rdM0d3() ng-true-value=true ng-false-value=false></label><p><small>Nerd mode enables the printer console where you can enter custom G-codes.</small></p></li></ul></fieldset></form></article>');$templateCache.put("settings-logs/componentView.html",'<div class=layout><div class=row><bgf-pagination url="\'http://localhost:3000/logs\'" link-group-size=2 collection=words></bgf-pagination><ul><li ng-repeat="w in words">{{w}}</li></ul><bgf-pagination passive=true url="\'http://localhost:3000/logs\'" link-group-size=2 collection=words></bgf-pagination></div><div id=settings-log class="layout__item u-1/1"><div class=block><div class=layout ng-repeat="log in settingsLogs.logs"><div class="layout__item u-1/12-sm u-1/1"><div class=logIcon ng-if="log.type === \'account\'"><avatar-img ng-if=log.data.image size=32 src="settingsLogs.imagesRootLocation + \'/\' + log.data.image.hash" title=log.data.image.filename circle=true></avatar-img></div><div class=logIcon ng-if="log.type === \'slicer\'"><i class="fa fa-magic fa-2x" ng-class="log.level === \'success\': \'text-base-green\'"></i></div><div class=logIcon ng-if="log.type === \'printer\'"></div></div><div class="layout__item u-11/12-sm u-1/1"><span class="small text-base-secondary u-textLeft">{{ log.createdAt | date:\'medium\'}}</span><br><div class=layout><div class="layout__item u-1/3"><p>{{ log.message | title }}</p></div><div class="layout__item u-2/3"><div class=infoList><ul class="list-bare small"><li ng-if="log.type === \'slicer\' && log.data.sliceResponse"><i class="fa fa-clock-o"></i> <b>Printing time:</b> {{ log.data.sliceResponse.data.time | duration }}<br><br></li><li ng-if="log.type === \'slicer\' && log.data.printjob"><i class="fa fa-file-o"></i> <b>Files included:</b> <span ng-repeat="file in log.data.printjob.files">{{ file.filename }}</span><br><br></li><li ng-if="log.type === \'slicer\' && log.data.printjob"><i class="fa fa-info-circle"></i> <b>Slice ID:</b> {{ log.data.printjob.responseId }}<br><br></li><li ng-if="log.type === \'account\' && log.data.image"><i class="fa fa-file-image-o"></i> <b>File:</b> {{ log.data.image.filename }} ({{ log.data.image.filetype }})<br><br></li></ul></div></div></div><br><hr class="rule"></div></div></div></div></div>');$templateCache.put("settings/componentView.html",'<section class="settings-header is-header"><nav core-nav core-nav-sub route-config=settings.routeConfig role="primary navigation" rel=nav class="nav in-header"></nav></section><div ng-viewport=subView class="fade inner-page-content"></div>')}])})();(function(){angular.module("templateCache.core",[]).run(["$templateCache",function($templateCache){"use strict";"use strict";$templateCache.put("header/componentTemplate.html",'<div class=header__content><ul class="list-inline navigation-container"><li class="navigation-home xs-hide"><a class=header__item ng-click="vm.navigate(\'/dashboard\')" ng-if="vm.environmentLocation == \'cloud\'"><img src=./public/assets/images/favicon.png alt="" class="formide-logo"></a> <a class=header__item ng-click="vm.navigate(\'/files\')" ng-if="vm.environmentLocation == \'local\'"><img src=./public/assets/images/favicon.png alt="" class="formide-logo"><div ng-if="vm.environmentLocation === \'local\'" class=logo_element>The Element</div></a></li><li class="logo__mobile sm-hide"><a class=header__item ng-click=vm.toggleMobilenav();><img src=./public/assets/images/favicon.png alt="" class="formide-logo"></a></li><li ng-if=!vm.logout class=sm-hide><a ng-click=vm.toggleMobilenav()><i class=fa ng-class="{\'fa-angle-down\': vm.mobilenavInvisible, \'fa-angle-up\': !vm.mobilenavInvisible}"></i></a></li><li class="hide--sidebar sm-hide" ng-if="!vm.logout && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn))" ng-click=$root.setSidebarInvisible()><img src=./public/assets/images/hamburger_collapse.svg alt=""></li><li class=navigation ng-if=!vm.logout ng-class="{\'showMobileNav\': !vm.mobilenavInvisible}"><ng-transclude></ng-transclude></li></ul></div>');
$templateCache.put("nav/componentTemplate.html",'<section class="layout layout--withoutGutter layout--alignMiddle"><ul class="list-inline layout__item u-fill" ng-if="!vm.subNav && !vm.showNotificationsPalm"><li ng-repeat="route in vm.routes" ng-class="{ active: route.nav.active}" ng-if="(!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn)) && (!route.rightSide)"><a ng-if=!route.href ng-click="route.onClick();$root.bodyNoScroll = false;vm.navigate(route.path);" title="{{ ::route.nav.title }}">{{ ::route.nav.name }}</a> <a ng-if=route.href ng-click=route.onClick() ng-href="{{ :: route.href }}" target=_blank title="{{ ::route.nav.title }}">{{ ::route.nav.name }}</a></li></ul><ul class="list-inline layout__item u-fit xs-hide" ng-if=!vm.subNav><div ng-if="!vm.showAvatarMenu && !vm.showNotifications && vm.notifications.list.length > 0" class="pill pill--notifications">{{vm.notifications.list.length}}</div><li class="avatar-menu avatar-wrapper" ng-class="{\'open\':vm.showAvatarMenu, \'openNotifications\':vm.showNotifications, \'local\':vm.environmentLocation == \'local\'}" ng-style=vm.notificationsHeight ng-click=$event.stopPropagation();><avatar-img ng-click=vm.openAvatarMenu() size=40 src=vm.userImg title=vm.account.username circle=true></avatar-img><ul class="avatar-menu-items animate-if" ng-if="vm.showAvatarMenu && !vm.showNotifications"><li class=avatar-menu-item ng-repeat="route in vm.routes" ng-class="{ active: route.nav.active}" ng-click=vm.closeAvatarMenu() ng-if="(!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn)) && (route.rightSide)"><a ng-click=route.onClick();vm.navigate(route.path) title={{::route.nav.title}}>{{::route.nav.name}}</a></li><li class=avatar-menu-item ng-click=vm.openNotifications()><a>Notifications<div ng-if="vm.notifications.list.length > 0" class="pill pill--notifications">{{vm.notifications.list.length}}</div></a></li></ul><section class="listNotifications animate-if" ng-style=vm.notificationsHeight ng-if=vm.showNotifications><h3>Notifications</h3><a class="btn btn--small btn--white" ng-click=vm.notificationsClearAll()>Clear Notifications</a><br><br><section ng-repeat="(channel, notifications) in vm.notifications.list | groupBy: \'channel\'"><h5>{{channel | title}}</h5><ul notification-list><li notification-list-item ng-repeat="notification in notifications" notification-id=notification.id title=notification.title description=notification.description count=notification.count updated-at=notification.updatedAt></li></ul></section><p ng-if="vm.notifications.list.length < 1">No notifications yet...</p></section></li><li class=sidebarToggle><span ng-if="route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn)"><a class=sm-and-down-hide ng-click="$root.setSidebarInvisible(); vm.scrollToTop()"><img ng-src="{{$root.sidebarInvisible ? \'./public/assets/images/hamburger_collapse.svg\' : \'./public/assets/images/hamburger_expand.svg\'}}"></a> <a class=md-hide ng-click="$root.setSidebarInvisible(); vm.scrollToTop()"><img ng-src="{{$root.sidebarInvisible ? \'./public/assets/images/hamburger_expand.svg\' : \'./public/assets/images/hamburger_collapse.svg\'}}"></a></span></li></ul></section><ul class="list-inline right-side-nav sm-hide" ng-if="!vm.subNav && !vm.showNotificationsPalm"><li class=avatar-menu-item ng-click="vm.showNotificationsPalm = true"><a>Notifications<div ng-if="vm.notifications.list.length > 0" class="pill pill--notifications">{{vm.notifications.list.length}}</div></a></li><li ng-repeat="route in vm.routes | orderBy: \'nav.name\'" ng-class="{ active: route.nav.active}" ng-if="(!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn)) && (route.rightSide)"><a ng-click="route.onClick(); $root.bodyNoScroll = false;vm.navigate(route.path);" title={{::route.nav.title}}>{{::route.nav.name}}</a></li></ul><section class="listNotifications animate-if" ng-if=vm.showNotificationsPalm><h3><a class=back ng-click="vm.showNotificationsPalm = false"><i class="fa fa-arrow-left"></i></a> Notifications</h3><br><section ng-repeat="(channel, notifications) in vm.notifications.list | groupBy: \'channel\'"><h5>{{channel | title}}</h5><ul notification-list><li notification-list-item ng-repeat="notification in notifications" notification-id=notification.id title=notification.title description=notification.description count=notification.count updated-at=notification.updatedAt></li></ul></section><p ng-if="vm.notifications.list.length < 1" class=u-padding-left-1>No notifications yet...</p></section><ul class="list-inline u-textNoWrap xs-hide" ng-if=vm.subNav><li ng-repeat="route in vm.routes" ng-class="{ active: route.nav.active}" ng-if="(!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn))"><a ng-click=route.onClick();vm.navigate(route.parent+route.path); title={{::route.nav.title}}>{{::route.nav.name}}</a></li></ul><ul class="list-inline u-textNoWrap sm-hide" ng-class="{\'open\': vm.showSubNav}" ng-if=vm.subNav><li ng-repeat="route in vm.routes | filter: {nav: {active: true}}" class=active ng-if="(!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn))" ng-click="vm.showSubNav = !vm.showSubNav"><a>{{::route.nav.name}} <span ng-if=!vm.showSubNav><i class="fa fa-angle-down"></i></span> <span ng-if=vm.showSubNav><i class="fa fa-angle-up"></i></span></a></li><li ng-repeat="route in vm.routes | filter: {nav: {active: false}}" ng-if="vm.showSubNav && (!route.env || vm.environmentLocation === route.env) && (!route.expression || vm.validateExpression(route.expression)) && (route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn))" ng-click="vm.showSubNav = false"><a ng-click=route.onClick();vm.navigate(route.parent+route.path);>{{::route.nav.name}}</a></li></ul>');$templateCache.put("sidebar/componentTemplate.html",'<article class=main-sidebar-content><section ng-if="vm.environmentLocation === \'local\' && vm.showCloudMsg" class="getStarted u-textCenter xs-hide"><h3>Use the full power of the Cloud</h3><a class="btn btn--white" ng-click=vm.getStarted()>Get Started</a></section><section class="sm-hide sidebar-header"><div ng-if="route.loggedIn === undefined || (route.loggedIn && vm.isLoggedIn) || (!route.loggedIn && !vm.isLoggedIn)" class=hide--sidebar ng-click=$root.setSidebarInvisible()><img src=./public/assets/images/hamburger_expand.svg alt=""></div><h3 class=title>Printers</h3></section><section class=fade id=sidebar-printers><h3 class="xs-hide title">Printers</h3><div ng-if="vm.devices.length < 1 && vm.environmentLocation === \'cloud\' && vm.resolved" class=u-textCenter><h3>No Devices Set Up</h3><p>You currently have no devices set up on this account</p><button ng-click="vm.onboarding(\'setupChooseDevice\')" class="btn btn--white">Set up a New Device</button><br><br><br></div><div ng-if="vm.resolved && (vm.printer | filter: vm.deviceIsSetup).length < 1 && (vm.devices.length > 0 || vm.environmentLocation === \'local\')" class=u-textCenter><h3>No Printers Connected</h3><p>You currently have no printers connected on this account</p><button ng-click=vm.printerSetupDialog() class="btn btn--white">Connect a New 3D Printer</button></div><div ng-if="vm.resolved && (vm.printer | filter: vm.deviceIsSetup).length > 0"><h4>Selected Printer</h4><ul printer-list ng-if=vm.printerActive><li printer-list-item printer=vm.printerActive type=selected class=selected-printer></li></ul><p ng-if=!vm.printerActive class=selected-printer-message>You currently have no selected printer<br>Click on a printer below to select it</p><br></div><div ng-if="vm.resolved && (vm.printer | filter: {active: true} | filter: vm.deviceIsSetup).length > 0"><h4>Active Printers</h4><ul printer-list><li printer-list-item ng-repeat="printer in onlinePrinters = (vm.printer | filter: {active: true} | filter: vm.deviceIsSetup | orderBy: vm.printerSortFunction)" type=active printer=printer></li><li ng-if="vm.resolved && onlinePrinters.length < 1" class=fade><p>No printers are currently online...</p></li></ul><br></div><div ng-if="vm.resolved && (vm.printer | filter: {active: false} | filter: vm.deviceIsSetup).length > 0"><h4>Offline Printers</h4><ul printer-list><li printer-list-item ng-repeat="printer in offlinePrinters = (vm.printer | filter: {active: false} | filter: vm.deviceIsSetup)" type=offline printer=printer></li><li ng-if="vm.resolved && offlinePrinters.length < 1" class=fade><p>No printers are currently offline...</p></li></ul></div><div ng-if=!vm.resolved class=u-textCenter><i class="fa fa-refresh fa-spin fa-3x"></i></div></section></article><div ng-if="vm.unknownPrinter || vm.slicingInProgress" class="btn-container xs-hide"><div ng-if="vm.unknownPrinter && !vm.slicingInProgress" ng-click=vm.printerSetupDialog() class=setup-printer><div class=layout><span class="layout__item u-1/6"><i class="fa fa-2x fa-bell"></i></span> <small class="layout__item u-5/6">An unknown printer has been detected, click to set up this printer!</small></div></div><div ng-if=vm.slicingInProgress class=slicer-progress><svg xmlns=http://www.w3.org/2000/svg width=100% height=80px viewbox="0 0 32 32" preserveaspectratio="xMaxYMid slice"><defs><clippath id=mask><circle cx=16 cy=16 r="16"></clippath></defs><path fill=none stroke=#CE6E3E stroke-width=.2 opacity=.1 d=" M-32 4 C-24 4 -24 28 -16 28 C-8 28 -8 4 0 4 C8 4 8 28 16 28 C24 28 24 8 32 8 "><animatetransform attributename=transform type=translate values=" 0 0; 32 0 " dur=6s repeatcount="indefinite"></path><path fill=none stroke=#CE6E3E stroke-width=.2 opacity=.3 d=" M-32 12 C-24 12 -24 20 -16 20 C-8 20 -8 12 0 12 C8 12 8 20 16 20 C24 20 24 12 32 12 "><animatetransform attributename=transform type=translate values=" 0 0; 32 0 " dur=3s repeatcount="indefinite"></path><path fill=none stroke=#CE6E3E stroke-width=.2 opacity=.5 d=" M-32 8 C-24 8 -24 24 -16 24 C-8 24 -8 8 0 8 C8 8 8 24 16 24 C24 24 24 8 32 8 "><animatetransform attributename=transform type=translate values=" 0 0; 32 0 " dur=2s repeatcount="indefinite"></path></svg><h6 class=loader>Slicing in progress <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></h6><div ng-style={opacity:vm.setVisible($index)} ng-repeat="message in vm.sliceMessages"><small>{{message | title}}</small></div></div></div><ng-transclude></ng-transclude>')}])})();(function(){angular.module("templateCache.shared",[]).run(["$templateCache",function($templateCache){"use strict";"use strict";$templateCache.put("add-new/componentTemplate.html","<ng-transclude></ng-transclude>");$templateCache.put("alert-box/componentTemplate.html",'<div class="entry-content layout" id=notification-content-{{vm.alertId}} title="{{vm.type | title}} Notification" ng-class="{\'has-actions\': vm.actions.length > 0}"><h5 class="layout__item u-4/5">{{vm.title}}</h5><div class="layout__item u-textRight u-1/5"><a class=icon--close ng-if="!(vm.actions.length > 0)" ng-click=vm.closeNotification() title="Close this notification"><i class="fa fa-times"></i></a></div><p class="layout__item u-1/1"><small>{{vm.message}}</small></p><p ng-if=vm.link class="layout__item u-1/1 u-margin-top-_5"><small><span ng-if=vm.link.pretext>{{vm.link.pretext}}</span> <a href={{vm.link.href}} target=_blank style="color: #46b1e6">{{vm.link.text}}</a></small></p></div><ul title="Notification Actions" id=notification-actions-{{vm.alertId}} class=alert-actions id=alert-actions ng-if="vm.actions.length > 0"><li ng-repeat="(name, action) in vm.actions"><a ng-click=vm.executeCallback(action.callback) ng-attr-title={{action.title}}>{{action.title}}</a></li></ul>');$templateCache.put("avatar-img/componentTemplate.html","<figure class=photo title={{vm.title}} ng-style=vm.style><ng-transclude></ng-transclude><figcaption>{{vm.title}}</figcaption></figure>");$templateCache.put("command-line/componentTemplate.html",'<article class=terminal onclick="document.getElementById(\'terminal-input\').focus()"><section id=terminal-output><p ng-repeat="line in vm.lines" class={{::line.class}} id=cmd-{{$index}} ng-bind-html=line.text></p></section><section class=terminal--input><input id=terminal-input wrap=off ng-model=vm.input ng-keydown=vm.terminalInputKeydown($event.keyCode)></section></article>');$templateCache.put("dashboard-community/componentTemplate.html",'<table class="dashboard-news table--formide"><tbody class=article ng-repeat="article in vm.articles | limitTo:5 | orderBy:\'created_at\':true"><tr class=tr--title ng-init="readMore = false" ng-click="readMore = !readMore"><td><div class=title id="news-{{ $index }}" ng-class="{ \'open\': readMore, \'truncateCell\': !readMore && vm.truncateCell(\'news-\'+$index) }">{{article.title}}</div></td><td class=td--pill><div class="pill pill--primary">{{article.comment_count}}</div></td></tr><tr ng-if=readMore class=summary><td colspan=2 ng-bind-html="article.details | trustedHTML"></td></tr><tr ng-if=readMore class=summary><td colspan=2><a href={{article.html_url}} target=_blank>Continue reading</a></td></tr></tbody></table>');$templateCache.put("dashboard-news/componentTemplate.html",'<table class=table--formide><tbody class=article ng-repeat="article in vm.articles"><tr ng-init="readMore = false" ng-click="readMore = !readMore"><td colspan="{{vm.isUpdateArticle(article.id) ? 1 : 2}}"><div class=title id="news-{{ $index }}" ng-class="{ \'open\': readMore, \'truncateCell\': !readMore && vm.truncateCell(\'news-\'+$index) }">{{article.title}}</div></td><td ng-if=vm.isUpdateArticle(article.id) class=td--btn><button class="btn btn--small btn--primary" ng-click="$event.stopPropagation(); vm.updateDevice()">Update</button></td></tr><tr ng-if=readMore class=summary><td colspan=2 ng-bind-html="article.summary | trustedHTML"></td></tr><tr ng-if=readMore class=summary><td colspan=2><a href={{article.permalinkUrl}} target=_blank>Continue reading</a></td></tr></tbody></table><script type=text/ng-template id=updateDevice><h3 class="printerHeader">Select an Online Device to Update</h3>\n'+"\n"+'\t<div class="limit-height">\n'+"\n"+'\t    <ul class="list-ui list-ui--small">\n'+"\t        <li\n"+'\t            class="list-ui__item"\n'+'\t            ng-repeat="device in modal.onlineDevices"\n'+'\t            ng-click="modal.updateDevice(device.id)"\n'+'\t\t\t\tng-if="modal.resolved">\n'+'\t            <section class="device-settings">\n'+"\t                <hgroup>\n"+'\t                    <h3 class="u-margin-bottom-0">{{device.name}} <span class="tag" ng-if="device.session.version">v{{device.session.version}}</span></h3>\n'+"\t                </hgroup>\n"+"\t            </section>\n"+"\t        </li>\n"+'\t        <li class="list-ui__item" ng-if="modal.onlineDevices.length < 1 && modal.resolved">\n'+"\t\t\t\tCurrently no devices online\n"+"\t\t\t</li>\n"+'\t\t\t<li ng-if="!modal.resolved">\n'+'\t\t\t\t<div class="u-textCenter" style="padding: 0.5rem 0;">\n'+'\t\t\t\t\t<i class="fa fa-2x fa-refresh fa-spin"></i>\n'+"\t\t\t\t</div>\n"+"\t\t\t</li>\n"+"\t    </ul>\n"+"\t</div></script>");$templateCache.put("dashboard-panel/componentTemplate.html",'<div class="panel entry-content"><header><div class=layout><h4 class=layout__item ng-class="{\'u-fit\': vm.headerBtn}"><i class=fa ng-class=vm.headerIcon></i>{{::vm.headerTitle}}</h4><div ng-if=vm.headerBtn class="layout__item u-fill u-textRight"><button ng-disabled=vm.headerBtnDisable ng-click=vm.headerBtn.action() class="btn btn--small btn--white">{{::vm.headerBtn.title}}</button></div></div></header><div class=body><ng-transclude></ng-transclude></div></div>');$templateCache.put("dashboard-queue/componentTemplate.html",'<table class=table--formide><tbody ng-switch=vm.printer.$active.deviceStatus><tr ng-switch-when=online ng-if=vm.queue.$resolved ng-repeat="item in vm.queue.resource | orderBy: vm.filterQueue"><td><div class=truncateCell>{{item.printJob.name | title}}</div></td><td class=td--btn><button ng-if="item.status !== \'printing\'" class="btn btn--small btn--tertiary" ng-click="vm.startPrint(item.id, item.gcode, item.status)" ng-disabled="vm.printer.$active.status !== \'online\' || item.status === \'downloading\'"><span ng-if="item.status !== \'downloading\'">Print</span> <i ng-if="item.status === \'downloading\'" class="fa fa-refresh fa-spin"></i></button><div class=u-textRight ng-if="item.status === \'printing\'">{{vm.printer.$active.progress | ceil }} %</div></td></tr><tr ng-switch-when=online ng-if="vm.queue.$resolved && (vm.queue.resource | filter: vm.filterFinished).length < 1"><td class=u-textCenter>Currently there are no items in your queue.</td></tr><tr ng-switch-when=online ng-if=!vm.queue.$resolved><td class=u-textCenter>Loading Queue <span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></td></tr><tr ng-switch-when=online ng-if=vm.queue.$resolved><td colspan=2><a class=fade ng-click="vm.navigate(\'files\')" add-new>Add more items</a></td></tr><tr ng-switch-when=offline><td class=u-textCenter>Queue could not be loaded, the device is offline.</td></tr><tr ng-switch-default><td class=u-textCenter>Queue could not be loaded, no device set up.</td></tr></tbody></table>');$templateCache.put("dashboard-slices/componentTemplate.html",'<table class=table--formide><tbody><tr ng-if="vm.lastSlices.length > 0" ng-repeat="printjob in vm.lastSlices"><td><div id="slice-{{ $index }}" class=slice-name ng-class="{ \'truncateCell\': vm.truncateCell(\'slice-\'+$index) }">{{printjob.name | title}}</div></td><td class="td--btn sm-and-down-hide"><button ng-click=vm.openGcodeViewer(printjob) class="btn btn--small btn--tertiary">View <span class=u-textNoWrap>G-code</span></button></td><td class=td--btn><button ng-click=vm.addToQueue(printjob) class="btn btn--small btn--primary">Add to Queue</button></td></tr><tr ng-if="vm.lastSlices.length < 1 && vm.resolved"><td class="u-textCenter u-padding-top-1">Currently no completed slices<br><br>Go to the <a ng-click="vm.navigate(\'files\')">Library</a> to start slicing</td></tr><tr ng-if=!vm.resolved><td colspan=3 class=u-textCenter><i class="fa fa-refresh fa-spin fa-2x text-base-primary-color"></i></td></tr></tbody></table>');$templateCache.put("dashboard-storage/componentTemplate.html",'<div class="container layout layout--withoutGutter layout--alignMiddle layout--alignCenter"><div class="storageChart layout__item u-fill"><canvas id=doughnut height=300 width=300 class="chart chart-doughnut" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-dataset-override=vm.chart.datasetOverride chart-options=vm.chart.options></canvas><div class=label><h3>{{vm.storage.percentageUsedRnd}}%<br><small>used</small></h3></div><div class=info><h3>of 5.0 GB</h3></div></div></div>');$templateCache.put("dashboard-temperatures/componentTemplate.html",'<div class="container layout layout--withoutGutter layout--alignMiddle layout--alignCenter"><div class="layout__item u-fill"><canvas id=line height=300 width=300 class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series chart-options=vm.chart.options chart-colors=vm.chart.colors></canvas></div></div>');$templateCache.put("dashboard-webcam/componentTemplate.html",'<figure class="layout layout--alignCenter layout--alignMiddle layout--withoutGutter" ng-class="{\'webcamLoaded\': vm.webcamLoaded, \'webcamError\': $root.webcamError}"><div ng-if=vm.showClose ng-click="$root.floatingWebcam = false; $event.stopPropagation();" class=close>&times;</div><div ng-show="!$root.webcamError || !vm.webcamLoaded" class="layout__item webcam-container"><figcaption ng-if="!$root.webcamError && vm.webcamLoaded" class="pill pill--small">Live <i class="fa fa-circle text-base-red faa-flash animated"></i></figcaption><img ng-if="vm.printer.$active.deviceStatus == \'online\'" draggable=false ng-show=!$root.webcamError ng-src={{vm.webcamPath}} onerror="angular.element(this).scope().$root.webcamError = true" onload="angular.element(this).scope().vm.webcamLoaded = true"><div ng-if=$root.webcamError class=webcam-placeholder><span ng-if="vm.environmentLocation == \'local\'">Connect a webcam to your device</span> <span ng-if="vm.environmentLocation == \'cloud\'">Connect a webcam to your device and enable port forwarding on your router<br><br>More infomation can be found <a href=https://formide.zendesk.com/hc/en-us/articles/212076949 target=_blank>here</a></span></div></div><div ng-if="!vm.webcamLoaded && !$root.webcamError && vm.printer.$active.deviceStatus == \'online\'" class="webcam-loading layout__item"><span class=loader>Loading<span class=loader__dot>.</span><span class=loader__dot>.</span><span class=loader__dot>.</span></span></div></figure>');$templateCache.put("device-list-item/componentTemplate.html",'<article class=layout><section class="layout__item deviceImg u-textCenter xs-hide"><img ng-src="./public/assets/images/icons/{{ ::vm.device.deviceType }}.png" height="92px"></section><section class="layout__item u-fill"><header class=layout><section class="layout__item u-fill"><h4 ng-if=!vm.edit class="text-base-primary u-textTruncate"><a ng-click="vm.navigate(\'manage/devices/\'+vm.device.id)">{{ vm.device.name }}</a> <span ng-if=vm.device.isOwner>Owner</span> <span ng-if="vm.device.isAdmin && !vm.device.isOwner">Admin</span></h4><input ng-if=vm.edit ng-model=vm.device.name ng-change=vm.changeName(vm.device) ng-model-options="{ debounce: 500 }" class="text-input u-margin-bottom-_5" placeholder="Rename Device"></section><section class="u-textRight layout__item u-fit"><span ng-class="{\'online\':\'pill--success\', \'offline\': \'\'}[vm.device.status]" class=pill><abbr title="{{ ::vm.device.name }} is currently {{vm.device.status}}">{{vm.device.status}}</abbr></span></section></header><div ng-if=vm.device.session.geo><small><strong><i class="fa fa-globe"></i> Location</strong> <a href="https://www.google.nl/maps?q={{vm.device.session.geo.city}}+{{vm.device.session.geo.country}}">{{vm.device.session.geo.city}}, {{vm.device.session.geo.country}}</a></small></div><footer class="layout u-margin-top-_5"><section class="layout__item u-2/3 u-textTruncate"><span class=tag ng-if=vm.device.session.version>v{{vm.device.session.version}}</span></section><section ng-if=!vm.edit class="u-textRight layout__item u-1/3"><a class="btn btn--small btn--tertiary" ng-click="vm.navigate(\'manage/devices/\'+vm.device.id)"><i class="fa fa-pencil"></i></a></section></footer></section></article>');$templateCache.put("device-list/componentTemplate.html","<ng-transclude></ng-transclude>");$templateCache.put("device-status-icon/componentTemplate.html","<span></span>");$templateCache.put("library-overlay/componentTemplate.html",'<div class=overlay-container ng-click=$event.stopPropagation() ng-mousedown=$event.stopPropagation()><div ng-if=vm.overlayTitle class=top><div class=title>{{vm.overlayTitle}}</div></div><div ng-if=vm.overlayClose ng-click="vm.overlayClose = false" class=close>&times;</div><ng-transclude></ng-transclude></div>');$templateCache.put("notification-list-item/componentTemplate.html",'<header class=layout><h4 class="layout__item u-4/5 title u-textTruncate" title="{{vm.count}} notifications of \'{{vm.title}}\'"><span class=count ng-if="vm.count > 1">{{vm.count}}</span> {{vm.title}} <span class=time>{{vm.updatedAt | timeAgo}}</span></h4><span class="layout__item u-1/5 u-textRight"><a class=remove ng-click=vm.clearSingle(vm.notificationId)><i class="fa fa-times"></i></a></span></header><ng-transclude></ng-transclude><article><p class=description><small>{{vm.description}}</small></p></article>');$templateCache.put("notification-list/componentTemplate.html","<ng-transclude></ng-transclude>");$templateCache.put("printer-controls-fan/componentTemplate.html",'<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width=45 height=45 style="animation-duration: {{ (1 / (vm.speed / vm.max)) * 250 | ceil}}ms;-webkit-animation-duration:{{ (1 / (vm.speed / vm.max)) * 250 | ceil}}ms" viewbox="0 0 97 98" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink xmlns:sketch=http://www.bohemiancoding.com/sketch/ns><g id=Page-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd sketch:type=MSPage><g id=noun_11995_cc sketch:type=MSLayerGroup fill=#878896><g id=Group sketch:type=MSShapeGroup><path d="M57.318,55.732 C55.535,57.863 52.949,59.279 50.041,59.521 C50.32,76.953 36.044,76.605 40.828,88.757 C45.542,97.487 49.725,99.169 58.95,94.566 C81.271,83.336 67.768,65.6 57.318,55.732 Z M40.767,42.329 C42.3,40.38 44.49,38.988 46.994,38.473 C46.177,20.091 61.043,20.669 56.176,8.303 C51.463,-0.428 47.28,-2.111 38.055,2.492 C14.955,14.117 30.223,32.704 40.767,42.329 Z M38.651,50.773 C20.083,52.757 19.906,37.712 7.766,43.271 C-0.695,48.453 -2.149,52.721 2.949,61.682 C15.7,83.922 33.233,68.141 42.341,57.1 C40.439,55.518 39.098,53.297 38.651,50.773 Z M93.752,35.814 C81.199,13.924 64.018,28.869 54.795,39.874 C57.182,41.371 58.918,43.778 59.541,46.593 C76.641,45.547 77.129,59.631 88.936,54.225 C97.396,49.043 98.85,44.775 93.752,35.814 Z M50.729,45.103 C50.225,44.844 49.661,44.686 49.057,44.664 C48.618,44.648 48.19,44.708 47.789,44.825 C46.882,45.09 46.109,45.667 45.591,46.439 C45.192,47.034 44.943,47.743 44.915,48.512 C44.902,48.879 44.941,49.234 45.021,49.574 C45.228,50.455 45.726,51.227 46.414,51.778 C47.06,52.298 47.87,52.624 48.763,52.657 C48.943,52.663 49.118,52.655 49.292,52.637 C50.405,52.532 51.39,51.969 52.05,51.131 C52.558,50.49 52.874,49.689 52.907,48.809 C52.923,48.407 52.876,48.018 52.78,47.648 C52.488,46.54 51.734,45.618 50.729,45.103 Z" id=Shape></path></g></g></g></svg>');$templateCache.put("printer-controls-flow-rate/componentTemplate.html",' <span class=rectangle></span> <span class=nozzle></span> <span class=flow style="animation-duration: {{vm.duration}}"></span>');$templateCache.put("printer-controls-slider/componentTemplate.html",'<section class=layout><div class=layout__item ng-class="vm.inputField ? \'u-5/6-sm u-2/3\' : \'u-1/1\'"><div class="progress-bar progress-bar-slider"><input class=progress-slider type=range min={{vm.min}} max={{vm.max}} step={{vm.step}} float ng-model=vm.value ng-change=vm.postTuneGcode() ng-model-options="{ debounce: 100 }" ng-disabled=vm.disableInput><div class=inner ng-style="{ width: ((vm.value - vm.min) / (vm.max - vm.min)) * 100 + \'%\' || \'0%\' }"></div><span ng-if=vm.prettyMin class="pretty-value pretty--min">{{vm.prettyMin | title}}</span> <span ng-if=vm.prettyMax class="pretty-value pretty--max">{{vm.prettyMax | title}}</span></div></div><div class="layout__item u-1/6-sm u-1/3 u-textCenter input-container" ng-if=vm.inputField><input type=number class=text-input min={{vm.min}} max={{vm.max}} ng-model=vm.value ng-change=vm.postTuneGcode() ng-model-options="{ debounce: 500 }" ng-disabled="vm.disableInput"><div class=symbol>%</div></div></section>');$templateCache.put("printer-controls-speed/componentTemplate.html",' <span class=rectangle style="animation-duration: {{vm.duration}}"></span> <span class=frame></span>');$templateCache.put("printer-controls/componentTemplate.html",'<div class="layout xs-hide"><section class="layout__item u-3/5 three-axis u-padding-left-0"><div ng-repeat="axis in vm.axis" class="{{::axis.key}}--axis axis" ng-class="{vertical: \'axis--vertical\', horizontal:\'u-textNoWrap axis--horizontal\'}[axis.orientation]"><div class=positive><abbr>+ {{::axis.key}}</abbr> <button class=control-button title="Move {{::axis.key}}-axis {{::item}} mm" style="background-color: rgba(220, 220, 222, {{::vm.setOpacity(item, axis.positive)}})" ng-click="vm.move(axis.key, item)" ng-repeat="item in axis.positive" ng-disabled=vm.disableInput>{{::item}}</button></div><div class=negative><abbr>- {{::axis.key}}</abbr> <button class=control-button title="Move {{::axis.key}}-axis {{::item}} mm" style="background-color: rgba(220, 220, 222, {{::vm.setOpacity(item, axis.positive)}})" ng-click="vm.move(axis.key, item)" ng-repeat="item in axis.negative" ng-disabled=vm.disableInput>{{::item}}</button></div></div></section><section class="extruder layout__item u-fill"><div ng-repeat="extruder in vm.extruders" ng-init="extruderIndex = $index" class="axis--vertical axis"><div class=positive><abbr>Retract</abbr> <button class=control-button title="Move extruder {{extruderIndex}} {{::item}} mm" ng-style="{\'background-color\': \'rgba(238, 222, 137, \'+vm.setOpacity(item, vm.extruder_settings.extrude)+\')\'}" ng-click=vm.printerCtrl.extruder(extruderIndex).retract(item) ng-repeat="item in vm.extruder_settings.retract | orderBy:item:reverse" ng-disabled=vm.disableInput>{{::item}}</button></div><abbr title="Extruder {{::extruder.id + 1}}" class=ext>EXT {{::$index + 1}}</abbr><div class=negative><abbr>Extrude</abbr> <button class=control-button title="Move {{extruderIndex}}-axis {{::item}} mm" ng-style="{\'background-color\': \'rgba(238, 222, 137, \'+vm.setOpacity(item, vm.extruder_settings.extrude)+\')\'}" ng-click=vm.printerCtrl.extruder(extruderIndex).extrude(item) ng-repeat="item in vm.extruder_settings.extrude | orderBy:item:reverse" ng-disabled=vm.disableInput>{{::item}}</button></div></div></section><section class="layout__item u-1/1"><button ng-click=vm.printerCtrl.home.all() class="btn btn--primary" ng-disabled=vm.disableInput>Home All Axis</button> <button ng-click=vm.printerCtrl.home.x() class="btn btn--secondary" ng-disabled=vm.disableInput>Home X-Axis</button> <button ng-click=vm.printerCtrl.home.y() class="btn btn--secondary" ng-disabled=vm.disableInput>Home Y-Axis</button> <button ng-click=vm.printerCtrl.home.z() class="btn btn--secondary" ng-disabled=vm.disableInput>Home Z-Axis</button></section></div><div class="palm-controls sm-hide"><section><h5>Scale Factor</h5><div class=u-textCenter><a ng-click=vm.printerCtrl.home.all() class="btn btn--large btn--secondary btn--round"><i class="fa fa-home"></i></a> &emsp; <a ng-click="vm.scaleFactor = 0.1" class="btn btn--secondary btn--round btn--large" ng-class="{\'btn--tertiary\': vm.scaleFactor == 0.1}">0.1</a> <a ng-click="vm.scaleFactor = 1" class="btn btn--secondary btn--round btn--large" ng-class="{\'btn--tertiary\': vm.scaleFactor == 1}">1</a> <a ng-click="vm.scaleFactor = 10" class="btn btn--secondary btn--round btn--large" ng-class="{\'btn--tertiary\': vm.scaleFactor == 10}">10</a> <a ng-click="vm.scaleFactor = 100" class="btn btn--secondary btn--round btn--large" ng-class="{\'btn--tertiary\': vm.scaleFactor == 100}">100</a></div></section><br><br><hr class="rule"><center><section class=three-axis ng-init="vm.scaleFactor = 10"><div ng-repeat="axis in vm.axis" class="{{::axis.key}}--axis axis" ng-class="{vertical: \'axis--vertical\', horizontal:\'u-textNoWrap axis--horizontal\'}[axis.orientation]"><div class=positive><abbr>+ {{::axis.key}}</abbr> <a class=control-button title="Move {{::axis.key}}-axis {{vm.scaleFactor}} mm" style="background-color: rgb(220, 220, 222)" ng-click="vm.move(axis.key, vm.scaleFactor)">{{vm.scaleFactor}}</a></div><div class=negative><abbr>- {{::axis.key}}</abbr> <a class=control-button title="Move {{::axis.key}}-axis {{(vm.scaleFactor * -1)}} mm" style="background-color: rgb(220, 220, 222)" ng-click="vm.move(axis.key, (vm.scaleFactor * -1))">{{(vm.scaleFactor * -1)}}</a></div></div></section></center><center><section class="extruder u-inlineBlock" ng-init="vm.scaleFactor = 10"><div ng-repeat="extruder in vm.extruders" ng-init="extruderIndex = $index" class="axis--vertical axis"><div class=positive><abbr>Retract</abbr> <a class=control-button title="Move extruder {{extruderIndex}} {{(vm.scaleFactor * -1)}} mm" style="background-color: rgb(238, 222, 137)" ng-click="vm.printerCtrl.extruder(extruderIndex).retract((vm.scaleFactor * -1))">{{(vm.scaleFactor * -1)}}</a></div><abbr title="Extruder {{::extruder.id + 1}}" class=ext>EXT {{::$index + 1}}</abbr><div class=negative><abbr>Extrude</abbr> <a class=control-button title="Move {{extruderIndex}}-axis {{vm.scaleFactor}} mm" style="background-color: rgb(238, 222, 137)" ng-click=vm.printerCtrl.extruder(extruderIndex).extrude(vm.scaleFactor)>{{vm.scaleFactor}}</a></div></div></section></center></div>');
$templateCache.put("printer-fan/componentTemplate.html",'<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width=24 height=24 style="animation-duration: {{ (1 / (vm.speed / vm.max)) * 250 | ceil}}ms;-webkit-animation-duration:{{ (1 / (vm.speed / vm.max)) * 250 | ceil}}ms" viewbox="0 0 97 98" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink xmlns:sketch=http://www.bohemiancoding.com/sketch/ns><g id=Page-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd sketch:type=MSPage><g id=noun_11995_cc sketch:type=MSLayerGroup fill=#878896><g id=Group sketch:type=MSShapeGroup><path d="M57.318,55.732 C55.535,57.863 52.949,59.279 50.041,59.521 C50.32,76.953 36.044,76.605 40.828,88.757 C45.542,97.487 49.725,99.169 58.95,94.566 C81.271,83.336 67.768,65.6 57.318,55.732 Z M40.767,42.329 C42.3,40.38 44.49,38.988 46.994,38.473 C46.177,20.091 61.043,20.669 56.176,8.303 C51.463,-0.428 47.28,-2.111 38.055,2.492 C14.955,14.117 30.223,32.704 40.767,42.329 Z M38.651,50.773 C20.083,52.757 19.906,37.712 7.766,43.271 C-0.695,48.453 -2.149,52.721 2.949,61.682 C15.7,83.922 33.233,68.141 42.341,57.1 C40.439,55.518 39.098,53.297 38.651,50.773 Z M93.752,35.814 C81.199,13.924 64.018,28.869 54.795,39.874 C57.182,41.371 58.918,43.778 59.541,46.593 C76.641,45.547 77.129,59.631 88.936,54.225 C97.396,49.043 98.85,44.775 93.752,35.814 Z M50.729,45.103 C50.225,44.844 49.661,44.686 49.057,44.664 C48.618,44.648 48.19,44.708 47.789,44.825 C46.882,45.09 46.109,45.667 45.591,46.439 C45.192,47.034 44.943,47.743 44.915,48.512 C44.902,48.879 44.941,49.234 45.021,49.574 C45.228,50.455 45.726,51.227 46.414,51.778 C47.06,52.298 47.87,52.624 48.763,52.657 C48.943,52.663 49.118,52.655 49.292,52.637 C50.405,52.532 51.39,51.969 52.05,51.131 C52.558,50.49 52.874,49.689 52.907,48.809 C52.923,48.407 52.876,48.018 52.78,47.648 C52.488,46.54 51.734,45.618 50.729,45.103 Z" id=Shape></path></g></g></g></svg>');$templateCache.put("printer-list-item/componentTemplate.html",'<header ng-click="vm.printerService.$setActive({id: vm.printer.id})"><hgroup class=layout><h3 class="layout__item u-fit"><status-icon size=24px status=vm.printer.status></status-icon></h3><h3 class="layout__item u-fill printer-title u-textTruncate">{{vm.printer.name}}</h3></hgroup><h4 ng-if="vm.environmentLocation == \'cloud\'" style="margin-bottom: 5px">Device: {{vm.printer.deviceName}}<device-status-icon ng-class="{online:\'online\', offline:\'offline\'}[vm.printer.deviceStatus]"></device-status-icon></h4><section class="layout layout--withoutGutter layout--alignMiddle progress-container" ng-if="vm.printer.status === \'printing\' || vm.printer.status === \'paused\'"><progress-bar class="layout__item u-fill" valuenow={{vm.printer.progress}} valuemax=100></progress-bar><h6 class="layout__item u-fit">{{ ((vm.printer.progress / 100) * 100) | ceil }}%</h6></section><div class="layout layout--smallGutter progressControls" ng-if="vm.type === \'selected\'"><div class="layout__item u-1/5 progressControl"><a ng-click="vm.navigate(\'/print/queue\');$root.setSidebarInvisible()" title=Queue class="btn btn--white btn--small md-hide"><i class="fa fa-list-ol"></i></a> <a title=Queue ng-click="vm.navigate(\'/print/queue\')" class="btn btn--white btn--small sm-and-down-hide"><i class="fa fa-list-ol"></i></a></div><div class="layout__item u-1/5 progressControl u-posRelative"><a ng-click="vm.navigate(\'/print/monitor\');$root.setSidebarInvisible()" class="btn btn--small btn--white md-hide" id=webcam-feed title="View Live"><i class="fa fa-video-camera"></i></a> <a ng-click="vm.navigate(\'/print/monitor\')" class="btn btn--small btn--white sm-and-down-hide" id=webcam-feed title="View Live"><i class="fa fa-video-camera"></i></a></div><div class="layout__item u-1/5 progressControl"><a title=Controls ng-click="vm.navigate(\'/print/controls\');$root.setSidebarInvisible()" class="btn btn--white btn--small md-hide"><i class="fa fa-arrows"></i></a> <a title=Controls ng-click="vm.navigate(\'/print/controls\')" class="btn btn--white btn--small sm-and-down-hide"><i class="fa fa-arrows"></i></a></div><div class="layout__item u-1/5 progressControl" ng-if="vm.printer.status === \'printing\' || vm.printer.status == \'heating\'" ng-init="vm.executingCommand = false"><button class="btn btn--small btn--white" ng-click=vm.pausePrint() title=Pause><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-pause\'}[vm.executingCommand]" class=fa></i></button></div><div class="layout__item u-1/5 progressControl" ng-if="vm.printer.status === \'paused\'" ng-init="vm.executingCommand = false"><button class="btn btn--small btn--white" ng-click=vm.resumePrint() title=Play><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-play\'}[vm.executingCommand]" class=fa></i></button></div><div class="layout__item u-1/5 progressControl" ng-if="vm.printer.status === \'printing\' || vm.printer.status === \'paused\' || vm.printer.status == \'heating\'" ng-init="vm.executingCommand = false"><button class="btn btn--small btn--white stop" ng-class="{true: \'btn--disabled\'}[vm.executingCommand]" ng-click=vm.stopPrint() title=Stop><i class="fa fa-stop"></i></button></div></div></header>');$templateCache.put("printer-list/componentTemplate.html","<ng-transclude></ng-transclude>");$templateCache.put("printer-speed/componentTemplate.html",' <span class=rectangle style="animation-duration: {{vm.duration}}"></span> <span class=frame></span>');$templateCache.put("progress-bar/componentTemplate.html",'<div role=progress aria-valuenow={{vm.valuenow}} aria-valuemin=0 aria-valuemax={{::vm.valuemax}} class=progress title="Progress {{ ((vm.valuenow / vm.valuemax) * 100) | ceil }}%" style="width: {{ ((vm.valuenow / vm.valuemax) * 100) | ceil }}%">{{ ((vm.valuenow / vm.valuemax) * 100) | ceil }}%</div>');$templateCache.put("queue-list-item/componentTemplate.html",'<div class="layout layout--alignMiddle"><figure class="layout__item u-1/6-sm xs-hide"><img ng-if="vm.queueItem.printJob.files[0].filetype !== \'text/gcode\' && vm.environmentLocation === \'cloud\' && vm.queueItem.origin === \'cloud\' && vm.queueItem.printJob.files[0].images[0]" ng-src="{{ vm.imagesRootLocation + \'/\' + vm.queueItem.printJob.files[0].images[0] }}" alt="" draggable=false> <img ng-if="vm.queueItem.printJob.files[0].filetype !== \'text/gcode\' && vm.environmentLocation === \'local\' && vm.queueItem.origin === \'local\' && vm.queueItem.printJob.files[0].images[0]" ng-src="{{ vm.imagesRootLocation + \'/\' + vm.queueItem.printJob.files[0].id + \'/images/\' + vm.queueItem.printJob.files[0].images[0] + \'?access_token=\' + vm.access_token }}" alt="" draggable=false> <img ng-if="vm.queueItem.printJob.files[0].filetype !== \'text/gcode\' && ( !vm.queueItem.printJob.files[0].images[0] || vm.environmentLocation != vm.queueItem.origin )" src=./public/assets/images/stl_emptystate.png alt="" draggable=false class=u-padding-1_5> <img ng-if="vm.queueItem.printJob.files[0].filetype === \'text/gcode\'" src=./public/assets/images/gcode_emptystate.png alt="" draggable=false class=u-padding-1_5></figure><section class="layout__item u-5/6-sm u-1/1"><div class="layout layout--alignMiddle"><header class="layout__item u-1/1"><div class="layout layout--alignMiddle"><hgroup class="layout__item u-fill"><h4 class="u-textTruncate text-base-primary-color queue-item-name">{{ vm.queueItem.printJob.name }}</h4></hgroup><aside ng-if="vm.queueItem.status != \'queued\' && vm.queueItem.status != \'downloading\'" ng-switch=vm.printer.status class="layout__item u-1/3-sm u-textRight"><section ng-switch-when=printing class="layout layout--smallGutter" ng-init="vm.executingCommand = false"><div class="layout__item u-1/2"><a class="btn btn--tertiary actionButton u-1/1" style="min-width: 0" ng-click=vm.pausePrint()><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-pause\'}[vm.executingCommand]" class=fa></i></a></div><div class="layout__item u-1/2"><a class="btn btn--alert actionButton u-1/1" style="min-width: 0" ng-class="{true: \'btn--disabled\'}[vm.executingCommand]" ng-click=vm.stopPrint()><i class="fa fa-stop"></i></a></div></section><section ng-switch-when=heating class="layout layout--smallGutter" ng-init="vm.executingCommand = false"><div class="layout__item u-1/2"><a class="btn btn--tertiary actionButton u-1/1" style="min-width: 0" ng-click=vm.pausePrint()><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-pause\'}[vm.executingCommand]" class=fa></i></a></div><div class="layout__item u-1/2"><a class="btn btn--alert actionButton u-1/1" style="min-width: 0" ng-class="{true: \'btn--disabled\'}[vm.executingCommand]" ng-click=vm.stopPrint()><i class="fa fa-stop"></i></a></div></section><section ng-switch-when=paused class="layout layout--smallGutter" ng-init="vm.executingCommand = false"><div class="layout__item u-1/2"><a class="btn btn--tertiary actionButton u-1/1" style="min-width: 0" ng-click=vm.resumePrint()><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-play\'}[vm.executingCommand]" class=fa></i></a></div><div class="layout__item u-1/2"><a class="btn btn--alert actionButton u-1/1" style="min-width: 0" ng-class="{true: \'btn--disabled\'}[vm.executingCommand]" ng-click=vm.stopPrint()><i class="fa fa-stop"></i></a></div></section><section ng-switch-default class=u-textRight ng-init="vm.executingCommand = false"><h4><i class="fa fa-refresh fa-spin"></i></h4></section></aside><aside class="layout__item u-fit-sm u-1/1 added" ng-if="vm.queueItem.status == \'queued\' || vm.queueItem.status == \'downloading\'"><h6 class="u-textTruncate u-margin-bottom-0">Added {{vm.queueItem.updatedAt | timeAgo }} <span ng-if="vm.queueItem.origin === \'cloud\' && vm.environmentLocation === \'local\'">from the cloud</span> <span ng-if="vm.queueItem.origin === \'local\' && vm.environmentLocation === \'cloud\'">locally</span></h6></aside></div></header><div class="layout__item u-1/1"><hr class="rule"></div><footer class="layout__item u-1/1"><div class="layout layout--alignMiddle" ng-if="vm.queueItem.status == \'queued\' || vm.queueItem.status == \'downloading\'"><section class="layout__item u-2/3-sm u-1/1"><p ng-if="vm.queueItem.printJob.sliceMethod !== \'custom\'" class="u-textTruncate expected-printing-time"><small><i class="fa fa-clock-o hide-on-palm"></i> Expected Printing Time <span class=value>{{ vm.queueItem.printJob.sliceResponse.time * 10 | smartduration}}</span></small></p></section><section class="layout__item u-1/3-sm u-1/1 u-textRight"><div class="layout layout--smallGutter"><div class="layout__item u-1/2"><button class="btn btn--tertiary u-1/1" style="min-width: 0" ng-click="vm.startPrint(vm.queueItem.id, vm.queueItem.gcode)" ng-disabled="vm.printer.status !== \'online\' || vm.queueItem.status === \'downloading\'"><span ng-if="vm.queueItem.status !== \'downloading\'">Print</span> <span ng-if="vm.queueItem.status === \'downloading\'"><i class="fa fa-refresh fa-spin"></i></span></button></div><div class="layout__item u-1/2"><button class="btn btn--alert u-1/1" style="min-width: 0" ng-click=vm.onClick(vm.queueItem.id)><i ng-class="{true: \'fa-refresh fa-spin\', false: \'fa-trash-o\'}[vm.clicked]" class=fa></i></button></div></div></section></div><div class=layout ng-if="vm.queueItem.status != \'queued\' && vm.queueItem.status != \'downloading\'"><section class="layout__item u-1/1"><p class="u-textTruncate expected-printing-time u-margin-bottom-_5"><small>Progress: {{vm.printer.progress | ceil }} % <span class=xs-hide ng-if="vm.printer.remainingPrintingTime && vm.printer.remainingPrintingTime > 0">&mdash; <i class="fa fa-clock-o hide-on-palm"></i> Remaining Printing Time {{vm.printer.remainingPrintingTime * 10 | smartduration}}</span></small></p><progress-bar valuemax=100 valuenow={{vm.printer.progress}}></progress-bar></section></div></footer></div></section></div>');$templateCache.put("queue-list/componentTemplate.html","<ng-transclude></ng-transclude>");$templateCache.put("range-slider/componentTemplate.html",'<section class=layout><div class="layout__item u-1/4" ng-if=inputField><input type=number class="text-input text-input--small" min={{min}} max={{max}} ng-change=updateModel(value.slider) ng-model="value.slider"></div><div class=layout__item ng-class="inputField ? \'u-3/4\' : \'u-1/1\'"><div class="progress-bar progress-bar-slider"><input ng-change=updateModel(value.slider) class=progress-slider type=range min={{min}} max={{max}} step={{step}} ng-model=value.slider float><div class=inner ng-style="{ width: ((value.slider - min) / (max - min)) * 100 + \'%\' || \'0%\' }"></div><span ng-if=prettyMin class="pretty-value pretty--min">{{prettyMin | title}}<span ng-if=showValue>: {{value | title}}%</span></span> <span ng-if=prettyMax class="pretty-value pretty--max">{{prettyMax | title}}<span ng-if=showValue>: {{100 - value | title}}%</span></span></div></div></section>');$templateCache.put("selection-block/componentTemplate.html",'<label class=block-selection title="Select {{::vm.item.name}}" ng-class="{\'active\': vm.ngModel.id == vm.item.id}"><h4 class="u-textTruncate text-base-primary-color"><input type=radio name=sliceSettings.{{::vm.item.name}} ng-value=vm.item ng-checked="vm.ngModel.id == vm.item.id" ng-model="vm.ngModel"> {{::vm.item.name}}</h4><ng-transclude></ng-transclude></label>');$templateCache.put("selection-list/componentTemplate.html",'<label ng-repeat="extruder in vm.extruders track by $index"><input type=radio name=settings.{{vm.name}}.use ng-value=$index ng-model=vm.ngModel> <abbr title="Extruder {{$index + 1}}">EXT {{$index + 1}}</abbr></label><label ng-if=!vm.extruders title="Please select a material for atleast one of your extruders first.">None selected</label>');$templateCache.put("slice-details-list/componentTemplate.html",'<table class="table--formide table--formide--clean" id=table--sliceDetails><tbody><tr ng-if=vm.printjob.sliceFinished><td><i class="fa fa-clock-o grey"></i></td><td>Estimated Time:</td><td>{{vm.printjob.sliceResponse.time * 10 | smartduration}}</td></tr><tr ng-repeat="file in vm.printjob.files"><td class=thumbnail ng-mouseover="thumbnail = true" ng-mouseleave="thumbnail = false"><img draggable=false ng-src="{{ vm.imagesRootLocation + \'/\' + file.images[0] }}" class="icon"><div class=imageThumbnail type=context ng-if=thumbnail id="thumbnail-{{ $index }}"><div class=overlay-container><div class=body><img ng-src="{{ vm.imagesRootLocation + \'/\' + file.images[0] }}" alt=""></div></div></div></td><td>Model<span ng-if="vm.printjob.files.length > 1">&nbsp;{{$index + 1}}</span>:</td><td>{{file.prettyname}}</td></tr><tr><td><i class="fa fa-cogs grey"></i></td><td>Slice Profile:</td><td ng-if=vm.printjob.sliceProfile.name>{{vm.printjob.sliceProfile.name}}</td><td ng-if=!vm.printjob.sliceProfile.name class=text-base-alert-color>No longer available</td></tr><tr><td><img draggable=false src=public/assets/images/printer_grey.png class="icon"></td><td>Printer:</td><td ng-if=vm.printjob.printer.name>{{vm.printjob.printer.name}}</td><td ng-if=!vm.printjob.printer.name class=text-base-alert-color>No longer available</td></tr><tr ng-repeat="material in vm.printjob.materials" ng-if=vm.printjob.sliceSettings.extruders[$index].use><td><i class="fa fa-circle-o-notch grey"></i></td><td ng-if="vm.printjob.materials.length == 1">Material:</td><td ng-if="vm.printjob.materials.length > 1">Material <span class=u-textNoWrap>(Ext {{$index + 1}}):</span></td><td ng-if=material.name>{{material.name}}</td><td ng-if=!material.name class=text-base-alert-color>No longer available</td></tr><tr ng-if="vm.printjob.materials.length == 0"><td><i class="fa fa-circle-o-notch grey"></i></td><td>Material:</td><td class=text-base-alert-color>No longer available</td></tr><tr ng-if="vm.printjob.printer.bed.heated && vm.printjob.sliceSettings.bed.use"><td><i class="fa fa-fire text-base-orange"></i></td><td>Heated Bed:</td><td>{{vm.printjob.sliceSettings.bed.temperature}}&deg;C</td></tr><tr ng-if=vm.printjob.sliceSettings.brim.use><td><img draggable=false src=./public/assets/images/icons/brim.svg class="icon"></td><td>Brim</td></tr><tr ng-if=vm.printjob.sliceSettings.raft.use><td><img draggable=false src=./public/assets/images/icons/raft.svg class="icon"></td><td>Raft</td></tr><tr ng-if=vm.printjob.sliceSettings.skirt.use><td><img draggable=false src=./public/assets/images/icons/skirt.svg class="icon"></td><td>Skirt</td></tr><tr ng-if=vm.printjob.sliceSettings.support.use><td><img draggable=false src=./public/assets/images/icons/support.svg class="icon"></td><td>Support</td></tr><tr ng-if=vm.printjob.sliceSettings.fan.use><td><printer-fan size=24 speed=vm.printjob.sliceRequest.fan.max max=100 class=icon></printer-fan></td><td>Fan:</td><td>{{vm.printjob.sliceRequest.fan.max}}%</td></tr><tr><td><span class="icon icon--bordered"><span style="height: {{((vm.printjob.sliceRequest.layers.layerHeight - 50) / (300 - 50)) * 100}}%; width: 100%"></span></span></td><td>Layer Height:</td><td>{{vm.printjob.sliceRequest.layers.layerHeight}}mu</td></tr><tr><td><span class="icon icon--bordered"><span style="width: {{((vm.printjob.sliceRequest.layers.numberOutlines - 1) / (10 - 1)) * 100}}%; height: 100%"></span></span></td><td>Wall Thickness:</td><td>{{vm.printjob.sliceRequest.layers.numberOutlines}} Lines</td></tr><tr><td><img draggable=false ng-src="./public/assets/images/icons/infill_{{ vm.printjob.sliceRequest.infill.amount | tenth }}.svg" class="infill icon"></td><td>Infill:</td><td>{{vm.printjob.sliceRequest.infill.amount}}%</td></tr><tr><td><printer-speed size=24 speed=vm.printjob.sliceRequest.movement.printSpeed min=10 max=200 class=icon></printer-speed></td><td>Print Speed:</td><td>{{vm.printjob.sliceRequest.movement.printSpeed}}mms</td></tr></tbody></table>');$templateCache.put("status-icon/componentTemplate.html","<div title=\"Printer is {{vm.status | title}}\" ng-class=\"{'online': vm.status == 'online', 'printing': vm.status == 'printing', 'heating': vm.status == 'heating', 'connecting': vm.status == 'connecting', 'paused': vm.status == 'paused', 'error': vm.status == 'error', 'offline': vm.status == 'offline'}\"><i ng-if=\"vm.status == 'connecting'\" class=\"fa fa-refresh fa-spin\"></i> <i ng-if=\"vm.status == 'heating'\" class=\"fa fa-fire\"></i> <i ng-if=\"vm.status == 'paused'\" class=\"fa fa-pause\"></i> <i ng-if=\"vm.status == 'error'\" class=\"fa fa-exclamation\"></i> <i ng-if=\"vm.status == 'printing'\" class=\"fa fa-play\"></i> <svg width=20px height=20px viewbox=\"0 0 24 24\" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink xmlns:sketch=http://www.bohemiancoding.com/sketch/ns><defs><circle id=circle cx=12 cy=12 r=12></circle></defs><mask id=mask fill=white><use xlink:href=#circle></use></mask><use id=Mask class=circle-stroke stroke-width=2 fill=transparent xlink:href=#circle></use></svg></div>");$templateCache.put("temperature-bar/componentTemplate.html",'<div role=progressbar aria-valuenow={{vm.valuetarget}} aria-valuemin=0 aria-valuemax={{::vm.valuemax}} class=target title="Target temperature {{vm.valuetarget}}&deg;C" style="width: {{ ((vm.valuetarget / vm.valuemax) * 100) | ceil }}%">{{vm.valuetarget}}&deg;C</div><div role=progressbar aria-valuenow={{vm.valuenow}} aria-valuemin=0 aria-valuemax={{::vm.valuemax}} class=progress title="Current temperature {{vm.valuenow}}&deg;C" style="width: {{ ((vm.valuenow / vm.valuemax) * 100) | ceil }}%">{{vm.valuenow}}&deg;C</div>Max: {{::vm.valuemax}}&deg;C')}])})();